
 <!DOCTYPE HTML>
<html lang="zh-CN">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
  <meta name="baidu-site-verification" content="vqJV77bZM6">
  
    <title>图像渲染优化技巧 | 图像渲染优化技巧 | Swift 教程 - Swift 语言学习 - Swift code - SwiftGG 翻译组 - 高质量的 Swift 译文网站</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="SwiftGG">
    

    <meta name="keywords" content="图像渲染,优化,swift语言,swift翻译,swift学习">
    <meta name="applicable-device" content="pc,mobile">
    <meta name="description" content="长期以来，iOS 开发人员就为一个奇怪的问题所困扰：‘如何对一张图像进行渲染优化？’本文试图为这个由来已久的问题提供一个明确的答案。">
<meta name="keywords" content="图像渲染,优化">
<meta property="og:type" content="article">
<meta property="og:title" content="图像渲染优化技巧">
<meta property="og:url" content="https://swift.gg/2019/11/01/image-resizing/index.html">
<meta property="og:site_name" content="SwiftGG">
<meta property="og:description" content="长期以来，iOS 开发人员就为一个奇怪的问题所困扰：‘如何对一张图像进行渲染优化？’本文试图为这个由来已久的问题提供一个明确的答案。">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="https://nshipster.com/assets/image-resizing-earth-5eaad58ee8c9b4f79595ef7271d19afa50f2240f128465746b3c930c1d420524.jpg">
<meta property="og:image" content="https://nshipster.com/assets/image-resizing-app-screenshot-02998a420a75691f6b5c8de44ba24d6119853776bd78bb9e1bfa3a36cdd7d48d.png">
<meta property="og:updated_time" content="2019-11-01T01:32:50.399Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="图像渲染优化技巧">
<meta name="twitter:description" content="长期以来，iOS 开发人员就为一个奇怪的问题所困扰：‘如何对一张图像进行渲染优化？’本文试图为这个由来已久的问题提供一个明确的答案。">
<meta name="twitter:image" content="https://nshipster.com/assets/image-resizing-earth-5eaad58ee8c9b4f79595ef7271d19afa50f2240f128465746b3c930c1d420524.jpg">

    
    <link rel="alternative" href="/atom.xml" title="SwiftGG" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/favicon_new.ico">
    
    
    <link rel="apple-touch-icon" href="/img/logo_new.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/logo_new.jpg">
    
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/gitment.css">
</head>
</html>
  <body>
    <header>
      
<div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/logo_new.png" alt="SwiftGG" title="SwiftGG"></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="SwiftGG">SwiftGG</a></h1>
				<h2 class="blog-motto">走心的 Swift 翻译组</h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="菜单">
			</a></div>
			<nav class="animated">
				<ul>
					 
						<li><a href="/">首页</a></li>
					
						<li><a href="/archives">归档</a></li>
					
						<li><a href="/about">关于</a></li>
					
						<li><a href="/stat">统计</a></li>
					
						<li><a href="https://swiftgg.gitbook.io/swift/">Swift 官方文档翻译</a></li>
					
					<li>
 					
					
					</li>
				</ul>
			</nav>			
</div>
    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
  
	<article itemprop="articleBody"> 
		
  <header class="article-info clearfix">
    <h1 itemprop="name">
      
        <a href="/2019/11/01/image-resizing/" target="_blank" title="图像渲染优化技巧" itemprop="url">图像渲染优化技巧</a>
    </h1>
    <p class="article-time">
      <time datetime="2019-11-01T00:00:00.000Z" itemprop="datePublished">2019-11-01</time>
      <span style="margin-left: 0.5em;"><i class="icon-eye-open"></i> <span class="viewcount"></span></span>
    </p>
  </header>

	<div class="article-content">
		
		<blockquote>
<p>作者：Mattt，<a href="https://nshipster.com/image-resizing/" target="_blank" rel="noopener">原文链接</a>，原文日期：2019-05-06<br>译者：ericchuhong；校对：<a href="http://numbbbbb.com/" target="_blank" rel="noopener">numbbbbb</a>，<a href="https://github.com/WAMaker" target="_blank" rel="noopener">WAMaker</a>；定稿：<a href="https://github.com/Pancf" target="_blank" rel="noopener">Pancf</a></p>
</blockquote>
<!--此处开始正文-->
<p>长期以来，iOS 开发人员一直被一个奇怪的问题困扰着：</p>
<p><em>“如何对一张图像进行渲染优化？”</em></p>
<p>这个令人困扰的问题，是由于开发者和平台的相互不信任引起的。各种各样的代码示例充斥着 Stack Overflow，每个人都声称只有自己的方法是真正的解决方案 —— 而别人的是错的。</p>
<a id="more"></a>
<p>在本周的文章中，我们将介绍 5 种不同的 iOS 图像渲染优化技巧（在 MacOS 上时适当地将 <code>UIImage</code> 转换成 <code>NSImage</code>）。相比于对每一种情况都规定一种方法，我们将从人类工程学和性能表现方面进行衡量，以便你更好地理解什么时该用哪一种，不该用哪一些。</p>
<blockquote>
<p>你可以自己下载、构建和运行 <a href="https://github.com/NSHipster/Image-Resizing-Example" target="_blank" rel="noopener">示例项目代码</a> 来试验这些图像渲染优化技巧。</p>
</blockquote>
<hr>
<h2 id="图像渲染优化的时机和理由"><a href="#图像渲染优化的时机和理由" class="headerlink" title="图像渲染优化的时机和理由"></a>图像渲染优化的时机和理由</h2><p>在开始之前，让我们先讨论一下<em>为什么</em>需要对图像进行渲染优化。毕竟，<code>UIImageView</code> 会自动根据 <a href="https://developer.apple.com/documentation/uikit/uiview/1622619-contentmode" target="_blank" rel="noopener"><code>contentmode</code> 属性</a> 规定的行为缩放和裁剪图像。在绝大多数情况下，<code>.scaleAspectFit</code>、<code>.scaleAspectFill</code> 或 <code>.scaleToFill</code> 已经完全满足你的所需。</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">imageView.contentMode = .scaleAspectFit</span><br><span class="line">imageView.image = image</span><br></pre></td></tr></table></figure>
<hr>
<p>那么，什么时候对图像进行渲染优化才有意义呢？<br><br><strong>当它明显大于</strong> <strong><code>UIImageView</code></strong> <strong>显示尺寸的时候</strong></p>
<hr>
<p>看看来自 <a href="https://visibleearth.nasa.gov" target="_blank" rel="noopener">NASA 视觉地球相册集锦</a> 的这张 <a href="https://visibleearth.nasa.gov/view.php?id=78314" target="_blank" rel="noopener">令人赞叹的图片</a>：</p>
<p><img src="https://nshipster.com/assets/image-resizing-earth-5eaad58ee8c9b4f79595ef7271d19afa50f2240f128465746b3c930c1d420524.jpg" alt="image-resizing-earth"></p>
<p>想要完整渲染这张宽高为 12,000 px 的图片，需要高达 20 MB 的空间。对于当今的硬件来说，你可能不会在意这么少兆字节的占用。但那只是它压缩后的尺寸。要展示它，<code>UIImageView</code> 首先需要把 JPEG 数据解码成位图（bitmap），如果要在一个 <code>UIImageView</code> 上按原样设置这张全尺寸图片，你的应用内存占用将会激增到<strong>几百兆</strong>，对用户明显没有什么好处（毕竟，屏幕能显示的像素有限）。但只要在设置 <code>UIImageView</code> 的 <code>image</code> 属性之前，将图像渲染的尺寸调整成 <code>UIImageView</code> 的大小，你用到的内存就会少一个数量级：</p>
<table>
<thead>
<tr>
<th></th>
<th>内存消耗 <em>(MB)</em></th>
</tr>
</thead>
<tbody>
<tr>
<td>无下采样</td>
<td>220.2</td>
</tr>
<tr>
<td>下采样</td>
<td>23.7</td>
</tr>
</tbody>
</table>
<p>这个技巧就是众所周知的<em>下采样（downsampling）</em>，在这些情况下，它可以有效地优化你应用的性能表现。如果你想了解更多关于下采样的知识或者其它图形图像的最佳实践，请参照 <a href="https://developer.apple.com/videos/play/wwdc2018/219/" target="_blank" rel="noopener">来自 WWDC 2018 的精彩课程</a>。</p>
<p>而现在，很少有应用程序会尝试一次性加载这么大的图像了，但是也跟我从设计师那里拿到的图片资源不会差<em>太</em>多。<em>（认真的吗？一张颜色渐变的</em> <em>PNG</em> <em>图片要</em> <em>3</em> <em>MB?）</em> 考虑到这一点，让我们来看看有什么不同的方法，可以让你用来对图像进行优化或者下采样。</p>
<blockquote>
<p>不用说，这里所有从 URL 加载的示例图像都是针对<strong>本地</strong>文件。记住，在应用的主线程同步使用网络请求图像<strong>绝不</strong>是什么好主意。</p>
</blockquote>
<hr>
<h2 id="图像渲染优化技巧"><a href="#图像渲染优化技巧" class="headerlink" title="图像渲染优化技巧"></a>图像渲染优化技巧</h2><p>优化图像渲染的方法有很多种，每种都有不同的功能和性能特性。我们在本文看到的这些例子，架构层次跨度上从底层的 Core Graphics、vImage、Image I/O 到上层的 Core Image 和 UIKit 都有。</p>
<ol>
<li><a href="#technique-1-drawing-to-a-uigraphicsimagerenderer">绘制到 UIGraphicsImageRenderer 上</a></li>
<li><a href="#technique-2-drawing-to-a-core-graphics-context">绘制到 Core Graphics Context 上</a></li>
<li><a href="#technique-3-creating-a-thumbnail-with-image-io">使用 Image I/O 创建缩略图像</a></li>
<li><a href="#technique-4-lanczos-resampling-with-core-image">使用 Core Image 进行 Lanczos 重采样</a></li>
<li><a href="#technique-5-image-scaling-with-vimage">使用 vImage 优化图片渲染</a></li>
</ol>
<p>为了统一调用方式，以下的每种技术共用一个公共接口方法：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">resizedImage</span><span class="params">(at url: URL, <span class="keyword">for</span> size: CGSize)</span></span> -&gt; <span class="type">UIImage?</span> &#123; &lt;#...#&gt; &#125;</span><br><span class="line"></span><br><span class="line">imageView.image = resizedImage(at: url, <span class="keyword">for</span>: size)</span><br></pre></td></tr></table></figure>
<p>这里，<code>size</code> 的计量单位不是用 <code>pixel</code>，而是用 <code>point</code>。想要计算出你调整大小后图像的等效尺寸，用主 <code>UIScreen</code> 的 <code>scale</code>，等比例放大你 <code>UIImageView</code> 的 <code>size</code> 大小：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> scaleFactor = <span class="type">UIScreen</span>.main.scale</span><br><span class="line"><span class="keyword">let</span> scale = <span class="type">CGAffineTransform</span>(scaleX: scaleFactor, y: scaleFactor)</span><br><span class="line"><span class="keyword">let</span> size = imageView.bounds.size.applying(scale)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>如果你是在异步加载一张大图，使用一个过渡动画让图像逐渐显示到 <code>UIImageView</code> 上。例如:</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewController</span>: <span class="title">UIViewController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@IBOutlet</span> <span class="keyword">var</span> imageView: <span class="type">UIImageView!</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewWillAppear</span><span class="params">(<span class="number">_</span> animated: Bool)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.viewWillAppear(animated)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> url = <span class="type">Bundle</span>.main.url(forResource: <span class="string">"Blue Marble West"</span>,</span><br><span class="line">                                withExtension: <span class="string">"tiff"</span>)!</span><br><span class="line"></span><br><span class="line">        <span class="type">DispatchQueue</span>.global(qos: .userInitiated).async &#123;</span><br><span class="line">            <span class="keyword">let</span> image = resizedImage(at: url, <span class="keyword">for</span>: <span class="keyword">self</span>.imageView.bounds.size)</span><br><span class="line"></span><br><span class="line">            <span class="type">DispatchQueue</span>.main.sync &#123;</span><br><span class="line">                <span class="type">UIView</span>.transition(with: <span class="keyword">self</span>.imageView,</span><br><span class="line">                                duration: <span class="number">1.0</span>,</span><br><span class="line">                                options: [.curveEaseOut, .transitionCrossDissolve],</span><br><span class="line">                                animations: &#123;</span><br><span class="line">                                    <span class="keyword">self</span>.imageView.image = image</span><br><span class="line">                                &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<p><a name="technique-1-drawing-to-a-uigraphicsimagerenderer"></a></p>
<h3 id="技巧-1-绘制到-UIGraphicsImageRenderer-上"><a href="#技巧-1-绘制到-UIGraphicsImageRenderer-上" class="headerlink" title="技巧 #1: 绘制到 UIGraphicsImageRenderer 上"></a>技巧 #1: 绘制到 UIGraphicsImageRenderer 上</h3><p>图像渲染优化的最上层 API 位于 UIKit 框架中。给定一个 <code>UIImage</code>，你可以绘制到 <code>UIGraphicsImageRenderer</code> 的上下文（context）中以渲染缩小版本的图像：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"></span><br><span class="line"><span class="comment">// 技巧 #1</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">resizedImage</span><span class="params">(at url: URL, <span class="keyword">for</span> size: CGSize)</span></span> -&gt; <span class="type">UIImage?</span> &#123;</span><br><span class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> image = <span class="type">UIImage</span>(contentsOfFile: url.path) <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> renderer = <span class="type">UIGraphicsImageRenderer</span>(size: size)</span><br><span class="line">    <span class="keyword">return</span> renderer.image &#123; (context) <span class="keyword">in</span></span><br><span class="line">        image.draw(<span class="keyword">in</span>: <span class="type">CGRect</span>(origin: .zero, size: size))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><a href="https://developer.apple.com/documentation/uikit/uigraphicsimagerenderer" target="_blank" rel="noopener"><code>UIGraphicsImageRenderer</code></a> 是一项相对较新的技术，在 iOS 10 中被引入，用以取代旧版本的 <code>UIGraphicsBeginImageContextWithOptions</code> / <code>UIGraphicsEndImageContext</code> API。你通过指定以 <code>point</code> 计量的 <code>size</code> 创建了一个 <code>UIGraphicsImageRenderer</code>。<code>image</code> 方法带有一个闭包参数，返回的是一个经过闭包处理后的位图。最终，原始图像便会在缩小到指定的范围内绘制。</p>
<blockquote>
<p>在不改变图像原始纵横比（aspect ratio）的情况下，缩小图像原始的尺寸来显示通常很有用。<a href="https://developer.apple.com/documentation/avfoundation/1390116-avmakerect" target="_blank" rel="noopener"><code>AVMakeRect(aspectRatio:insideRect:)</code></a> 是在 AVFoundation 框架中很方便的一个函数，负责帮你做如下的计算：</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> func AVFoundation.AVMakeRect</span><br><span class="line"><span class="keyword">let</span> rect = <span class="type">AVMakeRect</span>(aspectRatio: image.size, insideRect: imageView.bounds)</span><br></pre></td></tr></table></figure>
<p><a name="technique-2-drawing-to-a-core-graphics-context"></a></p>
<h3 id="技巧-2：绘制到-Core-Graphics-Context-中"><a href="#技巧-2：绘制到-Core-Graphics-Context-中" class="headerlink" title="技巧 #2：绘制到 Core Graphics Context 中"></a>技巧 #2：绘制到 Core Graphics Context 中</h3><p>Core Graphics / Quartz 2D 提供了一系列底层 API 让我们可以进行更多高级的配置。</p>
<p>给定一个 <code>CGImage</code> 作为暂时的位图上下文，使用 <code>draw(_:in:)</code> 方法来绘制缩放后的图像：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"><span class="keyword">import</span> CoreGraphics</span><br><span class="line"></span><br><span class="line"><span class="comment">// 技巧 #2</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">resizedImage</span><span class="params">(at url: URL, <span class="keyword">for</span> size: CGSize)</span></span> -&gt; <span class="type">UIImage?</span> &#123;</span><br><span class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> imageSource = <span class="type">CGImageSourceCreateWithURL</span>(url <span class="keyword">as</span> <span class="type">NSURL</span>, <span class="literal">nil</span>),</span><br><span class="line">        <span class="keyword">let</span> image = <span class="type">CGImageSourceCreateImageAtIndex</span>(imageSource, <span class="number">0</span>, <span class="literal">nil</span>)</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> context = <span class="type">CGContext</span>(data: <span class="literal">nil</span>,</span><br><span class="line">                            width: <span class="type">Int</span>(size.width),</span><br><span class="line">                            height: <span class="type">Int</span>(size.height),</span><br><span class="line">                            bitsPerComponent: image.bitsPerComponent,</span><br><span class="line">                            bytesPerRow: image.bytesPerRow,</span><br><span class="line">                            space: image.colorSpace ?? <span class="type">CGColorSpace</span>(name: <span class="type">CGColorSpace</span>.sRGB)!,</span><br><span class="line">                            bitmapInfo: image.bitmapInfo.rawValue)</span><br><span class="line">    context?.interpolationQuality = .high</span><br><span class="line">    context?.draw(image, <span class="keyword">in</span>: <span class="type">CGRect</span>(origin: .zero, size: size))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> scaledImage = context?.makeImage() <span class="keyword">else</span> &#123; <span class="keyword">return</span> <span class="literal">nil</span> &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="type">UIImage</span>(cgImage: scaledImage)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这个 <code>CGContext</code> 初始化方法接收了几个参数来构造一个上下文，包括了必要的宽高参数，还有在给出的色域范围内每个颜色通道所需要的内存大小。在这个例子中，这些参数都是通过 <code>CGImage</code> 这个对象获取的。下一步，设置 <code>interpolationQuality</code> 属性为 <code>.high</code> 指示上下文在保证一定的精度上填充像素。<code>draw(_:in:)</code> 方法则是在给定的宽高和位置绘制图像，可以让图片在特定的边距下裁剪，也可以适用于一些像是人脸识别之类的图像特性。最后 <code>makeImage()</code> 从上下文获取信息并且渲染到一个 <code>CGImage</code> 值上（之后会用来构造 <code>UIImage</code> 对象）。</p>
<p><a name="technique-3-creating-a-thumbnail-with-image-io"></a></p>
<h3 id="技巧-3：使用-Image-I-O-创建缩略图像"><a href="#技巧-3：使用-Image-I-O-创建缩略图像" class="headerlink" title="技巧 #3：使用 Image I/O 创建缩略图像"></a>技巧 #3：使用 Image I/O 创建缩略图像</h3><p>Image I/O 是一个强大（却鲜有人知）的图像处理框架。抛开 Core Graphics 不说，它可以读写许多不同图像格式，访问图像的元数据，还有执行常规的图像处理操作。这个框架通过先进的缓存机制，提供了平台上最快的图片编码器和解码器，甚至可以增量加载图片。</p>
<p>这个重要的 <code>CGImageSourceCreateThumbnailAtIndex</code> 提供了一个带有许多不同配置选项的 API，比起在 Core Graphics 中等价的处理操作要简洁得多：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> ImageIO</span><br><span class="line"></span><br><span class="line"><span class="comment">// 技巧 #3</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">resizedImage</span><span class="params">(at url: URL, <span class="keyword">for</span> size: CGSize)</span></span> -&gt; <span class="type">UIImage?</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> options: [<span class="type">CFString</span>: <span class="type">Any</span>] = [</span><br><span class="line">        kCGImageSourceCreateThumbnailFromImageIfAbsent: <span class="literal">true</span>,</span><br><span class="line">        kCGImageSourceCreateThumbnailWithTransform: <span class="literal">true</span>,</span><br><span class="line">        kCGImageSourceShouldCacheImmediately: <span class="literal">true</span>,</span><br><span class="line">        kCGImageSourceThumbnailMaxPixelSize: <span class="built_in">max</span>(size.width, size.height)</span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> imageSource = <span class="type">CGImageSourceCreateWithURL</span>(url <span class="keyword">as</span> <span class="type">NSURL</span>, <span class="literal">nil</span>),</span><br><span class="line">        <span class="keyword">let</span> image = <span class="type">CGImageSourceCreateThumbnailAtIndex</span>(imageSource, <span class="number">0</span>, options <span class="keyword">as</span> <span class="type">CFDictionary</span>)</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="type">UIImage</span>(cgImage: image)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>给定一个 <code>CGImageSource</code> 和一系列配置选项，<code>CGImageSourceCreateThumbnailAtIndex(_:_:_:)</code> 函数创建了一个图像的缩略图。优化尺寸大小的操作是通过 <code>kCGImageSourceThumbnailMaxPixelSize</code> 完成的，它根据图像原始宽高比指定的最大尺寸来缩放图像。通过设定 <code>kCGImageSourceCreateThumbnailFromImageIfAbsent</code> 或 <code>kCGImageSourceCreateThumbnailFromImageAlways</code> 选项，Image I/O 可以自动缓存优化后的结果以便后续调用。</p>
<p><a name="technique-4-lanczos-resampling-with-core-image"></a></p>
<h3 id="技巧-4：使用-Core-Image-进行-Lanczos-重采样"><a href="#技巧-4：使用-Core-Image-进行-Lanczos-重采样" class="headerlink" title="技巧 #4：使用 Core Image 进行 Lanczos 重采样"></a>技巧 #4：使用 Core Image 进行 Lanczos 重采样</h3><p>Core Image 内置了 <a href="https://en.wikipedia.org/wiki/Lanczos_resampling" target="_blank" rel="noopener">Lanczos 重采样（resampling）</a> 功能，它是以 <code>CILanczosScaleTransform</code> 的同名滤镜命名的。虽然可以说它是在 UIKit 层级之上的 API，但无处不在的 key-value 编写方式导致它使用起来很不方便。</p>
<p>即便如此，它的处理模式还是一致的。</p>
<p>创建转换滤镜，对滤镜进行配置，最后渲染输出图像，这样的步骤和其他任何 Core Image 的工作流没什么不同。</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"><span class="keyword">import</span> CoreImage</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> sharedContext = <span class="type">CIContext</span>(options: [.useSoftwareRenderer : <span class="literal">false</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment">// 技巧 #4</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">resizedImage</span><span class="params">(at url: URL, scale: CGFloat, aspectRatio: CGFloat)</span></span> -&gt; <span class="type">UIImage?</span> &#123;</span><br><span class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> image = <span class="type">CIImage</span>(contentsOf: url) <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="built_in">filter</span> = <span class="type">CIFilter</span>(name: <span class="string">"CILanczosScaleTransform"</span>)</span><br><span class="line">    <span class="built_in">filter</span>?.setValue(image, forKey: kCIInputImageKey)</span><br><span class="line">    <span class="built_in">filter</span>?.setValue(scale, forKey: kCIInputScaleKey)</span><br><span class="line">    <span class="built_in">filter</span>?.setValue(aspectRatio, forKey: kCIInputAspectRatioKey)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> outputCIImage = <span class="built_in">filter</span>?.outputImage,</span><br><span class="line">        <span class="keyword">let</span> outputCGImage = sharedContext.createCGImage(outputCIImage,</span><br><span class="line">                                                        from: outputCIImage.extent)</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="type">UIImage</span>(cgImage: outputCGImage)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这个名叫 <code>CILanczosScaleTransform</code> 的 Core Image 滤镜分别接收了 <code>inputImage</code>、<code>inputScale</code> 和 <code>inputAspectRatio</code> 三个参数，每一个参数的意思也都不言自明。</p>
<p>更有趣的是，<code>CIContext</code> 在这里被用来创建一个 <code>UIImage</code>（间接通过 <code>CGImageRef</code> 表示），因为 <code>UIImage(CIImage:)</code> 经常不能按我们本意使用。创建 <code>CIContext</code> 是一个代价很昂贵的操作，所以使用上下文缓存以便重复的渲染工作。</p>
<blockquote>
<p>一个 <code>CIContext</code> 可以使用 GPU 或者 CPU（慢很多）渲染创建出来。通过指定构造方法中的 <code>.useSoftwareRenderer</code> 选项来选择使用哪个硬件。<em>（提示：用更快的那个，你觉得呢？）</em></p>
</blockquote>
<p><a name="technique-5-image-scaling-with-vimage"></a></p>
<h3 id="技巧-5-使用-vImage-优化图片渲染"><a href="#技巧-5-使用-vImage-优化图片渲染" class="headerlink" title="技巧 #5: 使用 vImage 优化图片渲染"></a>技巧 #5: 使用 vImage 优化图片渲染</h3><p>最后一个了，它是古老的 <a href="https://developer.apple.com/documentation/accelerate" target="_blank" rel="noopener">Accelerate 框架</a> —— 更具体点来说，它是 <code>vImage</code> 的图像处理子框架。</p>
<p>vImage 附带有 <a href="https://developer.apple.com/documentation/accelerate/vimage/vimage_operations/image_scaling" target="_blank" rel="noopener">一些不同的功能</a>，可以用来裁剪图像缓冲区大小。这些底层 API 保证了高性能同时低能耗，但会导致你对缓冲区的管理操作增加（更不用说要编写更多的代码了）：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"><span class="keyword">import</span> Accelerate.vImage</span><br><span class="line"></span><br><span class="line"><span class="comment">// 技巧 #5</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">resizedImage</span><span class="params">(at url: URL, <span class="keyword">for</span> size: CGSize)</span></span> -&gt; <span class="type">UIImage?</span> &#123;</span><br><span class="line">    <span class="comment">// 解码源图像</span></span><br><span class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> imageSource = <span class="type">CGImageSourceCreateWithURL</span>(url <span class="keyword">as</span> <span class="type">NSURL</span>, <span class="literal">nil</span>),</span><br><span class="line">        <span class="keyword">let</span> image = <span class="type">CGImageSourceCreateImageAtIndex</span>(imageSource, <span class="number">0</span>, <span class="literal">nil</span>),</span><br><span class="line">        <span class="keyword">let</span> properties = <span class="type">CGImageSourceCopyPropertiesAtIndex</span>(imageSource, <span class="number">0</span>, <span class="literal">nil</span>) <span class="keyword">as</span>? [<span class="type">CFString</span>: <span class="type">Any</span>],</span><br><span class="line">        <span class="keyword">let</span> imageWidth = properties[kCGImagePropertyPixelWidth] <span class="keyword">as</span>? vImagePixelCount,</span><br><span class="line">        <span class="keyword">let</span> imageHeight = properties[kCGImagePropertyPixelHeight] <span class="keyword">as</span>? vImagePixelCount</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 定义图像格式</span></span><br><span class="line">    <span class="keyword">var</span> format = vImage_CGImageFormat(bitsPerComponent: <span class="number">8</span>,</span><br><span class="line">                                      bitsPerPixel: <span class="number">32</span>,</span><br><span class="line">                                      colorSpace: <span class="literal">nil</span>,</span><br><span class="line">                                      bitmapInfo: <span class="type">CGBitmapInfo</span>(rawValue: <span class="type">CGImageAlphaInfo</span>.first.rawValue),</span><br><span class="line">                                      version: <span class="number">0</span>,</span><br><span class="line">                                      decode: <span class="literal">nil</span>,</span><br><span class="line">                                      renderingIntent: .defaultIntent)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> error: vImage_Error</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建并初始化源缓冲区</span></span><br><span class="line">    <span class="keyword">var</span> sourceBuffer = vImage_Buffer()</span><br><span class="line">    <span class="keyword">defer</span> &#123; sourceBuffer.data.deallocate() &#125;</span><br><span class="line">    error = vImageBuffer_InitWithCGImage(&amp;sourceBuffer,</span><br><span class="line">                                         &amp;format,</span><br><span class="line">                                         <span class="literal">nil</span>,</span><br><span class="line">                                         image,</span><br><span class="line">                                         vImage_Flags(kvImageNoFlags))</span><br><span class="line">    <span class="keyword">guard</span> error == kvImageNoError <span class="keyword">else</span> &#123; <span class="keyword">return</span> <span class="literal">nil</span> &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建并初始化目标缓冲区</span></span><br><span class="line">    <span class="keyword">var</span> destinationBuffer = vImage_Buffer()</span><br><span class="line">    error = vImageBuffer_Init(&amp;destinationBuffer,</span><br><span class="line">                              vImagePixelCount(size.height),</span><br><span class="line">                              vImagePixelCount(size.width),</span><br><span class="line">                              format.bitsPerPixel,</span><br><span class="line">                              vImage_Flags(kvImageNoFlags))</span><br><span class="line">    <span class="keyword">guard</span> error == kvImageNoError <span class="keyword">else</span> &#123; <span class="keyword">return</span> <span class="literal">nil</span> &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 优化缩放图像</span></span><br><span class="line">    error = vImageScale_ARGB8888(&amp;sourceBuffer,</span><br><span class="line">                                 &amp;destinationBuffer,</span><br><span class="line">                                 <span class="literal">nil</span>,</span><br><span class="line">                                 vImage_Flags(kvImageHighQualityResampling))</span><br><span class="line">    <span class="keyword">guard</span> error == kvImageNoError <span class="keyword">else</span> &#123; <span class="keyword">return</span> <span class="literal">nil</span> &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 从目标缓冲区创建一个 CGImage 对象</span></span><br><span class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> resizedImage =</span><br><span class="line">        vImageCreateCGImageFromBuffer(&amp;destinationBuffer,</span><br><span class="line">                                      &amp;format,</span><br><span class="line">                                      <span class="literal">nil</span>,</span><br><span class="line">                                      <span class="literal">nil</span>,</span><br><span class="line">                                      vImage_Flags(kvImageNoAllocate),</span><br><span class="line">                                      &amp;error)?.takeRetainedValue(),</span><br><span class="line">        error == kvImageNoError</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="type">UIImage</span>(cgImage: resizedImage)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里使用 Accelerate API 进行的明确操作，比起目前为止讨论到的其他优化方法更加底层。但暂时不管这些不友好的类型申明和函数名称的话，你会发现这个方法相当直接了当。</p>
<ul>
<li>首先，根据你传入的图像创建一个输入的源缓冲区，</li>
<li>接着，创建一个输出的目标缓冲区来接受优化后的图像，</li>
<li>然后，在源缓冲区裁剪图像数据，然后传给目标缓冲区，</li>
<li>最后，从目标缓冲区中根据处理完后的图像创建 <code>UIImage</code> 对象。</li>
</ul>
<hr>
<h2 id="性能对比"><a href="#性能对比" class="headerlink" title="性能对比"></a>性能对比</h2><p>那么这些不同的方法是如何相互对比的呢？</p>
<p><a href="https://github.com/NSHipster/Image-Resizing-Example" target="_blank" rel="noopener">这个项目</a> 是一些 <a href="https://nshipster.com/benchmarking/" target="_blank" rel="noopener">性能对比</a> 结果，运行环境是 iPhone 7 iOS 12.2。</p>
<p><img src="https://nshipster.com/assets/image-resizing-app-screenshot-02998a420a75691f6b5c8de44ba24d6119853776bd78bb9e1bfa3a36cdd7d48d.png" alt="image-resizing-app-screenshot"></p>
<p>下面的这些数字是多次迭代加载、优化、渲染之前那张 <a href="https://visibleearth.nasa.gov/view.php?id=78314" target="_blank" rel="noopener">超大地球图片</a> 的平均时间：</p>
<table>
<thead>
<tr>
<th></th>
<th>耗时 <em>(seconds)</em></th>
</tr>
</thead>
<tbody>
<tr>
<td>技巧 #1: <code>UIKit</code></td>
<td>0.1420</td>
</tr>
<tr>
<td>技巧 #2: <code>Core Graphics</code> <sup>1</sup></td>
<td>0.1722</td>
</tr>
<tr>
<td>技巧 #3: <code>Image I/O</code></td>
<td>0.1616</td>
</tr>
<tr>
<td>技巧 #4: <code>Core Image</code> <sup>2</sup></td>
<td>2.4983</td>
</tr>
<tr>
<td>技巧 #5: <code>vImage</code></td>
<td>2.3126</td>
</tr>
</tbody>
</table>
<p><sup>1</sup> &nbsp;<br>设置不同的 <code>CGInterpolationQuality</code> 值出来的结果是一致的，在性能上的差异可以忽略不计。</p>
<p><sup>2</sup> &nbsp;<br>若在 <code>CIContext</code> 创建时设置 <code>kCIContextUseSoftwareRenderer</code> 的值为 <code>true</code>，会导致耗时相比基础结果慢一个数量级。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><ul>
<li><strong>UIKit</strong>, <strong>Core</strong> <strong>Graphics</strong>, 和 <strong>Image</strong> <strong>I/O</strong> 都能很好地用于大部分图片的优化操作。如果（在 iOS 平台，至少）要选择一个的话，<code>UIGraphicsImageRenderer</code> 是你最佳的选择。</li>
<li><strong>Core</strong> <strong>Image</strong> 在图像优化渲染操作方面性能表现优越。实际上，根据 Apple 官方 <a href="https://developer.apple.com/library/mac/documentation/graphicsimaging/Conceptual/CoreImaging/ci_performance/ci_performance.html#//apple_ref/doc/uid/TP30001185-CH10-SW1" target="_blank" rel="noopener"><em>Core</em> <em>Image</em> <em>编程规范中的性能最佳实践单元</em></a>，你应该使用 Core Graphics 或 Image I/O 对图像进行裁剪和下采样，而不是用 Core Image。</li>
<li>除非你已经在使用 <strong><code>vImage</code></strong>，否则在大多数情况下用到底层的 Accelerate API 所需的额外工作可能是不合理的。</li>
</ul>
<blockquote>
<p>本文由 SwiftGG 翻译组翻译，已经获得作者翻译授权，最新文章请访问 <a href="http://swift.gg">http://swift.gg</a>。</p>
</blockquote>
  
	</div>
		<footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/Miscellaneous/">Miscellaneous</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/图像/">图像</a>
  </div>

</div>



	<div class="article-share" id="share">
	
	  <div data-url="https://swift.gg/2019/11/01/image-resizing/" data-title="图像渲染优化技巧 | SwiftGG" data-tsina="null" class="share clearfix">
	  </div>
	
	</div>


</footer>

   	       
	</article>
	
<nav class="article-nav clearfix">
 

<div class="next">
<a href="/2019/10/29/extensions-everywhere/" title="每一点进步都是快乐：无处不在的扩展">
 <strong>下一篇</strong><br> 
 <span>每一点进步都是快乐：无处不在的扩展
</span>
</a>
</div>

</nav>

	


<section id="comments" class="comment">
  <div id="gitcomment">
  </div>
  <script src="https://imsun.github.io/gitment/dist/gitment.browser.js"></script>
  <script>
    var gitment = new Gitment({
      id: "2019/11/01/image-resizing/",
      owner: "SwiftGGBot",
      repo: "gg-comment",
      oauth: {
        client_id: "8ed6aa0071e9d92f7ffc",
        client_secret: "29cc2c70290fad40a967780e5b49d86501348ddf",
      },
    })
    gitment.render('gitcomment')
    </script>
</section>



</div>  
      <div class="openaside"><a class="navbutton" href="#" title="显示侧边栏"></a></div>

  <div id="toc" class="toc-aside">
  <strong class="toc-title">文章目录</strong>
 
 <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#图像渲染优化的时机和理由"><span class="toc-number">1.</span> <span class="toc-text">图像渲染优化的时机和理由</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#图像渲染优化技巧"><span class="toc-number">2.</span> <span class="toc-text">图像渲染优化技巧</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#技巧-1-绘制到-UIGraphicsImageRenderer-上"><span class="toc-number">2.1.</span> <span class="toc-text">技巧 #1: 绘制到 UIGraphicsImageRenderer 上</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#技巧-2：绘制到-Core-Graphics-Context-中"><span class="toc-number">2.2.</span> <span class="toc-text">技巧 #2：绘制到 Core Graphics Context 中</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#技巧-3：使用-Image-I-O-创建缩略图像"><span class="toc-number">2.3.</span> <span class="toc-text">技巧 #3：使用 Image I/O 创建缩略图像</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#技巧-4：使用-Core-Image-进行-Lanczos-重采样"><span class="toc-number">2.4.</span> <span class="toc-text">技巧 #4：使用 Core Image 进行 Lanczos 重采样</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#技巧-5-使用-vImage-优化图片渲染"><span class="toc-number">2.5.</span> <span class="toc-text">技巧 #5: 使用 vImage 优化图片渲染</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#性能对比"><span class="toc-number">3.</span> <span class="toc-text">性能对比</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#总结"><span class="toc-number">4.</span> <span class="toc-text">总结</span></a></li></ol>
 
  </div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="隐藏侧边栏"></a></div>
<aside class="clearfix">

  
<div class="categorieslist">
	<p class="asidetitle">分类</p>
		<ul>
		
		  
			<li><a href="/categories/APPVENTURE/" title="APPVENTURE">APPVENTURE<sup>15</sup></a></li>
		  
		
		  
			<li><a href="/categories/Andyy-Hope/" title="Andyy Hope">Andyy Hope<sup>4</sup></a></li>
		  
		
		  
			<li><a href="/categories/AppCoda/" title="AppCoda">AppCoda<sup>44</sup></a></li>
		  
		
		  
			<li><a href="/categories/Arthur-Knopper/" title="Arthur Knopper">Arthur Knopper<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/Big-O-Note-Taking/" title="Big O Note-Taking">Big O Note-Taking<sup>2</sup></a></li>
		  
		
		  
			<li><a href="/categories/Coding-Explorer-Blog/" title="Coding Explorer Blog">Coding Explorer Blog<sup>3</sup></a></li>
		  
		
		  
			<li><a href="/categories/Crunchy-Development/" title="Crunchy Development">Crunchy Development<sup>26</sup></a></li>
		  
		
		  
			<li><a href="/categories/Erica-Sadun/" title="Erica Sadun">Erica Sadun<sup>68</sup></a></li>
		  
		
		  
			<li><a href="/categories/IOSCREATOR/" title="IOSCREATOR">IOSCREATOR<sup>29</sup></a></li>
		  
		
		  
			<li><a href="/categories/Jacob-Bandes-Storch/" title="Jacob Bandes-Storch">Jacob Bandes-Storch<sup>2</sup></a></li>
		  
		
		  
			<li><a href="/categories/Jameson-Quave/" title="Jameson Quave">Jameson Quave<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/JamesonQuave-com/" title="JamesonQuave.com">JamesonQuave.com<sup>18</sup></a></li>
		  
		
		  
			<li><a href="/categories/Jesse-Squires/" title="Jesse Squires">Jesse Squires<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/KHANLOU/" title="KHANLOU">KHANLOU<sup>22</sup></a></li>
		  
		
		  
			<li><a href="/categories/Khanlou/" title="Khanlou">Khanlou<sup>2</sup></a></li>
		  
		
		  
			<li><a href="/categories/Mike-Ash/" title="Mike Ash">Mike Ash<sup>16</sup></a></li>
		  
		
		  
			<li><a href="/categories/Miscellaneous/" title="Miscellaneous">Miscellaneous<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/Swift/NSHipster/" title="NSHipster">NSHipster<sup>10</sup></a></li>
		  
		
		  
			<li><a href="/categories/NSHipster/" title="NSHipster">NSHipster<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/Natasha-The-Robot/" title="Natasha The Robot">Natasha The Robot<sup>48</sup></a></li>
		  
		
		  
			<li><a href="/categories/PhotoKit/Ole-Begemann/" title="Ole Begemann">Ole Begemann<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/Ole-Begemann/" title="Ole Begemann">Ole Begemann<sup>38</sup></a></li>
		  
		
		  
			<li><a href="/categories/Ole-Begemannh/" title="Ole Begemannh">Ole Begemannh<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/Olivier-Halligon/" title="Olivier Halligon">Olivier Halligon<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/Open-Source-Swift/" title="Open Source Swift">Open Source Swift<sup>11</sup></a></li>
		  
		
		  
			<li><a href="/categories/POP/" title="POP">POP<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/PhotoKit/" title="PhotoKit">PhotoKit<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/Raj-Kandathi/" title="Raj Kandathi">Raj Kandathi<sup>6</sup></a></li>
		  
		
		  
			<li><a href="/categories/Reinder-de-Vries/" title="Reinder de Vries">Reinder de Vries<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/Russ-Bishop/" title="Russ Bishop">Russ Bishop<sup>8</sup></a></li>
		  
		
		  
			<li><a href="/categories/POP/SWIFT/" title="SWIFT">SWIFT<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/Soroush-Khanlou/" title="Soroush Khanlou">Soroush Khanlou<sup>2</sup></a></li>
		  
		
		  
			<li><a href="/categories/Ole-Begemann/Swift/" title="Swift">Swift<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/Swift/" title="Swift">Swift<sup>16</sup></a></li>
		  
		
		  
			<li><a href="/categories/Olivier-Halligon/Swift/" title="Swift">Swift<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/Mike-Ash/Swift/" title="Swift">Swift<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/Swift-and-Painless/" title="Swift and Painless">Swift and Painless<sup>11</sup></a></li>
		  
		
		  
			<li><a href="/categories/iOS/Swift-入门/" title="Swift 入门">Swift 入门<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/Swift-进阶/" title="Swift 进阶">Swift 进阶<sup>3</sup></a></li>
		  
		
		  
			<li><a href="/categories/The-Always-Right-Institute/" title="The Always Right Institute">The Always Right Institute<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/Think-and-Build/" title="Think and Build">Think and Build<sup>2</sup></a></li>
		  
		
		  
			<li><a href="/categories/Thomas-Hanning/" title="Thomas Hanning">Thomas Hanning<sup>22</sup></a></li>
		  
		
		  
			<li><a href="/categories/Thoughtbot/" title="Thoughtbot">Thoughtbot<sup>3</sup></a></li>
		  
		
		  
			<li><a href="/categories/Tomasz-Szulc/" title="Tomasz Szulc">Tomasz Szulc<sup>9</sup></a></li>
		  
		
		  
			<li><a href="/categories/Wooji-Juice/" title="Wooji Juice">Wooji Juice<sup>2</sup></a></li>
		  
		
		  
			<li><a href="/categories/alisoftware/" title="alisoftware">alisoftware<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/alloc-init/" title="alloc-init">alloc-init<sup>6</sup></a></li>
		  
		
		  
			<li><a href="/categories/appcoda/" title="appcoda">appcoda<sup>2</sup></a></li>
		  
		
		  
			<li><a href="/categories/codingexplorer/" title="codingexplorer">codingexplorer<sup>2</sup></a></li>
		  
		
		  
			<li><a href="/categories/iAchieved-it/" title="iAchieved.it">iAchieved.it<sup>24</sup></a></li>
		  
		
		  
			<li><a href="/categories/iOS/" title="iOS">iOS<sup>2</sup></a></li>
		  
		
		  
			<li><a href="/categories/AppCoda/iOS/" title="iOS">iOS<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/iOS/iOS-开发/" title="iOS 开发">iOS 开发<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/iOS-开发/" title="iOS 开发">iOS 开发<sup>3</sup></a></li>
		  
		
		  
			<li><a href="/categories/khanlou-com/" title="khanlou.com">khanlou.com<sup>2</sup></a></li>
		  
		
		  
			<li><a href="/categories/machinethink/" title="machinethink">machinethink<sup>3</sup></a></li>
		  
		
		  
			<li><a href="/categories/medium-com/" title="medium.com">medium.com<sup>12</sup></a></li>
		  
		
		  
			<li><a href="/categories/mikeash-com/" title="mikeash.com">mikeash.com<sup>9</sup></a></li>
		  
		
		  
			<li><a href="/categories/radex-io/" title="radex.io">radex.io<sup>3</sup></a></li>
		  
		
		  
			<li><a href="/categories/swift-org/" title="swift.org">swift.org<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/swiftandpainless/" title="swiftandpainless">swiftandpainless<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/swiftjectivec/" title="swiftjectivec">swiftjectivec<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/thomashanning/" title="thomashanning">thomashanning<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/uraimo/" title="uraimo">uraimo<sup>15</sup></a></li>
		  
		
		  
			<li><a href="/categories/原创文章/" title="原创文章">原创文章<sup>6</sup></a></li>
		  
		
		  
			<li><a href="/categories/投稿/" title="投稿">投稿<sup>7</sup></a></li>
		  
		
		  
			<li><a href="/categories/直播资源/" title="直播资源">直播资源<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/社区问答/" title="社区问答">社区问答<sup>19</sup></a></li>
		  
		
		</ul>
</div>


  
<div class="tagslist">
	<p class="asidetitle">标签</p>
		<ul class="clearfix">
		
			
				<li><a href="/tags/Swift-进阶/" title="Swift 进阶">Swift 进阶<sup>170</sup></a></li>
			
		
			
				<li><a href="/tags/Swift-入门/" title="Swift 入门">Swift 入门<sup>130</sup></a></li>
			
		
			
				<li><a href="/tags/Swift/" title="Swift">Swift<sup>110</sup></a></li>
			
		
			
				<li><a href="/tags/iOS-开发/" title="iOS 开发">iOS 开发<sup>85</sup></a></li>
			
		
			
				<li><a href="/tags/Swift-跨平台/" title="Swift 跨平台">Swift 跨平台<sup>14</sup></a></li>
			
		
			
				<li><a href="/tags/Swift-开源信息/" title="Swift 开源信息">Swift 开源信息<sup>11</sup></a></li>
			
		
			
				<li><a href="/tags/NSHipster/" title="NSHipster">NSHipster<sup>10</sup></a></li>
			
		
			
				<li><a href="/tags/教程/" title="教程">教程<sup>7</sup></a></li>
			
		
			
				<li><a href="/tags/WatchOS-2/" title="WatchOS 2">WatchOS 2<sup>7</sup></a></li>
			
		
			
				<li><a href="/tags/Swift-3/" title="Swift 3">Swift 3<sup>7</sup></a></li>
			
		
			
				<li><a href="/tags/iOS-入门/" title="iOS 入门">iOS 入门<sup>6</sup></a></li>
			
		
			
				<li><a href="/tags/Xcode/" title="Xcode">Xcode<sup>5</sup></a></li>
			
		
			
				<li><a href="/tags/Apple-TV-开发/" title="Apple TV 开发">Apple TV 开发<sup>5</sup></a></li>
			
		
			
				<li><a href="/tags/iOS-9/" title="iOS 9">iOS 9<sup>4</sup></a></li>
			
		
			
				<li><a href="/tags/IOSCREATOR/" title="IOSCREATOR">IOSCREATOR<sup>4</sup></a></li>
			
		
			
				<li><a href="/tags/Jesse-Squires/" title="Jesse Squires">Jesse Squires<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/Objective-C/" title="Objective-C">Objective-C<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/社区问答/" title="社区问答">社区问答<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/iOS/" title="iOS">iOS<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/Swift-2/" title="Swift 2">Swift 2<sup>3</sup></a></li>
			
		
		</ul>
</div>


  <div class="linkslist">
  <p class="asidetitle">友情链接</p>
    <ul>
        
          <li>
            
            	<a href="http://c4ios.swift.gg" target="_blank" title="C4iOS 教程">C4iOS 教程</a>
            
          </li>
        
          <li>
            
            	<a href="http://swift.gg/2016/03/14/live-video/" target="_blank" title="SwiftGG直播">SwiftGG直播</a>
            
          </li>
        
          <li>
            
            	<a href="http://t.swift.gg/" target="_blank" title="T 沙龙">T 沙龙</a>
            
          </li>
        
          <li>
            
            	<a href="http://codebuild.me" target="_blank" title="Code Build Me">Code Build Me</a>
            
          </li>
        
          <li>
            
            	<a href="http://www.saitjr.com" target="_blank" title="//TODO:">//TODO:</a>
            
          </li>
        
          <li>
            
            	<a href="http://www.5isjyx.com/" target="_blank" title="chiba">chiba</a>
            
          </li>
        
          <li>
            
            	<a href="http://blog.cee.moe" target="_blank" title="Perfect Freeze">Perfect Freeze</a>
            
          </li>
        
          <li>
            
            	<a href="http://www.swiftyper.com" target="_blank" title="小锅的 swift 之路">小锅的 swift 之路</a>
            
          </li>
        
          <li>
            
            	<a href="http://www.futantan.com/" target="_blank" title="Prayer 的博客">Prayer 的博客</a>
            
          </li>
        
          <li>
            
            	<a href="http://blog.csdn.net/mmoaay" target="_blank" title="画渣程序猿 mmoaay">画渣程序猿 mmoaay</a>
            
          </li>
        
          <li>
            
            	<a href="http://linusling.com" target="_blank" title="小铁匠的 swift 之路">小铁匠的 swift 之路</a>
            
          </li>
        
          <li>
            
            	<a href="http://www.jianshu.com/users/596f2ba91ce9/latest_articles" target="_blank" title="ppppppmst 的简书博客">ppppppmst 的简书博客</a>
            
          </li>
        
          <li>
            
            	<a href="http://chenmingbiao.github.io/" target="_blank" title="CMB 的博客">CMB 的博客</a>
            
          </li>
        
          <li>
            
            	<a href="http://wxgbridgeq.github.io/" target="_blank" title="BridgeQ">BridgeQ</a>
            
          </li>
        
          <li>
            
            	<a href="http://chengway.in" target="_blank" title="walkingway 的博客">walkingway 的博客</a>
            
          </li>
        
          <li>
            
            	<a href="http://blog.dianqk.org" target="_blank" title="靛青K">靛青K</a>
            
          </li>
        
          <li>
            
            	<a href="http://alanmelody.com/" target="_blank" title="JackAlan">JackAlan</a>
            
          </li>
        
          <li>
            
            	<a href="http://www.swiftconchina.com" target="_blank" title="SwiftConChina">SwiftConChina</a>
            
          </li>
        
          <li>
            
            	<a href="http://swiftcn.io" target="_blank" title="Swift 中国">Swift 中国</a>
            
          </li>
        
          <li>
            
            	<a href="https://boxueio.com/" target="_blank" title="泊学">泊学</a>
            
          </li>
        
          <li>
            
            	<a href="https://bearychat.com/" target="_blank" title="BearyChat">BearyChat</a>
            
          </li>
        
          <li>
            
            	<a href="http://bbs.php-z.com" target="_blank" title="PHP-Z 论坛">PHP-Z 论坛</a>
            
          </li>
        
          <li>
            
            	<a href="http://www.swiftguide.cn" target="_blank" title="官方文档">官方文档</a>
            
          </li>
        
          <li>
            
            	<a href="https://www.upyun.com/" target="_blank" title="又拍云赞助图床">又拍云赞助图床</a>
            
          </li>
        
    </ul>
</div>

  


  <div class="rsspart">
	<a href="/atom.xml" target="_blank" title="rss">RSS 订阅</a>
</div>

  <div class="wechatpart">
	<p class="asidetitle">微信公众号</p>
	<img src="/img/wechat.jpg">
</div>

</aside>
</div>
    </div>
    <footer>


<div id="footer">
	
	<div class="social-font">
		
		
		
		
		
		
		
		
		
		
	</div>
			
		

		<p class="copyright">
		Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/wuchong/jacman" target="_blank" title="Jacman">Jacman</a> © 2019 
		
		<a href="/about" target="_blank" title="SwiftGG">SwiftGG</a>
		
		 | 
		<a href="http://www.miitbeian.gov.cn" target="_blank">浙ICP备14022870号-3</a>
		</p>
</div>
<img src="/img/logo_new.jpg" style="position: fixed; top: -9999px;height: 500px;width: 500px;">
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/jquery.qrcode-0.12.0.min.js"></script>
<script src="//cdn.jsdelivr.net/npm/leancloud-storage@3.15.0/dist/av-min.js"></script>
<script src="/js/mm.js"></script>
<script src="/js/subscribe.js"></script>

<div id="swiftweekly" style="display:none;">
  <img id="closeme" src="/img/close.png">
  <span id="sw_slogan">SwiftUI 重磅教程专属优惠：<b><a style="color: white;text-decoration:underline;" target="_blank" href="https://j.youzan.com/H9aEpi">使用 SwiftGG 优惠码，半价基础上再减 20 元！</a></b>&nbsp;</span>
  <!-- <form id="content"> -->
    <!-- <input name="email" id="sw_email" placeholder="输入邮箱地址" type="email" /><a class="sw_sub">订阅</a> -->
  <!-- </form> -->
</div>

<script>
(function(){
    var bp = document.createElement('script');
    bp.src = '//push.zhanzhang.baidu.com/push.js';
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>

<script type="text/javascript">
$(document).ready(function(){

  

  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
      
      $('#toc.toc-aside').css('display', 'none');
        
    }
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  c.click(function(){
    ta.css('display', 'block').addClass('fadeIn');
  });
  o.click(function(){
    ta.css('display', 'none');
  });
  $(window).scroll(function(){
    ta.css("top",Math.max(140,320-$(this).scrollTop()));
  });
});
</script>


<script type="text/javascript">
$(document).ready(function(){ 
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina'),
      description = $this.attr('description');
  var html = [
  '<div class="hoverqrcode clearfix"></div>',
  '<a class="overlay" id="qrcode"></a>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="微信"></a>',
  '<a href="http://widget.renren.com/dialog/share?resourceUrl=' + encodedUrl + '&srcUrl=' + encodedUrl + '&title=' + title +'" class="article-share-renren" target="_blank" title="人人"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="微博"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);

  $('.hoverqrcode').hide();

  var myWidth = 0;
  function updatehoverqrcode(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
    var qrsize = myWidth > 1024 ? 200:100;
    var options = {render: 'image', size: qrsize, fill: '#2ca6cb', text: url, radius: 0.5, quiet: 1};
    var p = $('.article-share-qrcode').position();
    $('.hoverqrcode').empty().css('width', qrsize).css('height', qrsize)
                          .css('left', p.left-qrsize/2+20).css('top', p.top-qrsize-10)
                          .qrcode(options);
  };
  $(window).resize(function(){
    $('.hoverqrcode').hide();
  });
  $('.article-share-qrcode').click(function(){
    updatehoverqrcode();
    $('.hoverqrcode').toggle();
  });
  $('.article-share-qrcode').hover(function(){}, function(){
      $('.hoverqrcode').hide();
  });
});   
</script>









<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>



<!-- Analytics Begin -->

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-66150920-1', 'auto');
  ga('send', 'pageview');

</script>





<!-- Analytics End -->

<!-- Totop Begin -->
<!--
	<div id="totop">
	<a title="返回顶部"><img src="/img/scrollup.png"></a>
	</div>
	<script src="/js/totop.js"></script>
-->
<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML">
</script>


<!-- MathJax End -->

<!-- Tiny_search Begin -->

<!-- Tiny_search End -->

  </body>
</html>
