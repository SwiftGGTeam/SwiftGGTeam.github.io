<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>SwiftGG</title>
  
  <subtitle>èµ°å¿ƒçš„ Swift ç¿»è¯‘ç»„</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://swift.gg/"/>
  <updated>2019-02-19T03:45:15.660Z</updated>
  <id>https://swift.gg/</id>
  
  <author>
    <name>SwiftGG</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>åè®®ä¸­çš„ç§æœ‰å±æ€§</title>
    <link href="https://swift.gg/2019/02/18/protocols-private-properties/"/>
    <id>https://swift.gg/2019/02/18/protocols-private-properties/</id>
    <published>2019-02-18T00:00:00.000Z</published>
    <updated>2019-02-19T03:45:15.660Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ä½œè€…ï¼šOlivier Halligonï¼Œ<a href="http://alisoftware.github.io/swift/protocols/2018/09/02/protocols-private-properties/" target="_blank" rel="noopener">åŸæ–‡é“¾æ¥</a>ï¼ŒåŸæ–‡æ—¥æœŸï¼š2018-09-02<br>è¯‘è€…ï¼š<a href="https://github.com/dzyding" target="_blank" rel="noopener">ç°s</a>ï¼›æ ¡å¯¹ï¼š<a href="http://numbbbbb.com/" target="_blank" rel="noopener">numbbbbb</a>ï¼Œ<a href="http://linusling.com" target="_blank" rel="noopener">å°é“åŒ Linus</a>ï¼›å®šç¨¿ï¼š<a href="http://forelax.space" target="_blank" rel="noopener">Forelax</a></p></blockquote><!--æ­¤å¤„å¼€å§‹æ­£æ–‡--><p>åœ¨ Swift ä¸­ï¼Œåè®®ä¸­å£°æ˜çš„å±æ€§æ²¡æœ‰è®¿é—®æ§åˆ¶çš„èƒ½åŠ›ã€‚å¦‚æœåè®®ä¸­åˆ—å‡ºäº†æŸä¸ªå±æ€§ï¼Œåˆ™å¿…é¡»ä½¿éµå®ˆåè®®çš„ç±»å‹æ˜¾å¼å£°æ˜è¿™äº›å±æ€§ã€‚  </p><p>ä¸è¿‡æœ‰äº›æ—¶å€™ï¼Œå°½ç®¡ä½ ä¼šåœ¨åè®®ä¸­å£°æ˜ä¸€äº›å±æ€§ï¼Œä½†ä½ æ˜¯è¦åˆ©ç”¨è¿™äº›å±æ€§æ¥æä¾›ä½ çš„å®ç°ï¼Œå¹¶ä¸å¸Œæœ›è¿™äº›å±æ€§åœ¨ç±»å‹çš„å¤–éƒ¨è¢«ä½¿ç”¨ã€‚è®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜ã€‚ </p><a id="more"></a><h2 id="ä¸€ä¸ªç®€å•çš„ä¾‹å­"><a href="#ä¸€ä¸ªç®€å•çš„ä¾‹å­" class="headerlink" title="ä¸€ä¸ªç®€å•çš„ä¾‹å­"></a>ä¸€ä¸ªç®€å•çš„ä¾‹å­</h2><p>å‡è®¾ä½ éœ€è¦åˆ›å»ºä¸€ä¸ªä¸“é—¨çš„å¯¹è±¡æ¥ç®¡ç†ä½ çš„è§†å›¾æ§åˆ¶å™¨ï¼ˆViewControllersï¼‰å¯¼èˆªï¼Œæ¯”å¦‚ä¸€ä¸ªåè°ƒå™¨ï¼ˆCoordinatorï¼‰ã€‚  </p><p>æ¯ä¸ªåè°ƒå™¨éƒ½æœ‰ä¸€ä¸ªæ ¹æ§åˆ¶å™¨ <code>UINavigationController</code>ï¼Œå¹¶å…±äº«ä¸€äº›é€šç”¨çš„åŠŸèƒ½ï¼Œæ¯”å¦‚åœ¨å®ƒä¸Šé¢æ¨è¿›ï¼ˆpushï¼‰å’Œå¼¹å‡ºï¼ˆpopï¼‰å…¶ä»– ViewControllerã€‚æ‰€ä»¥æœ€åˆå®ƒçœ‹èµ·æ¥å¯èƒ½æ˜¯è¿™æ · <a href="#foot1" id="1"><sup>[1]</sup></a>ï¼š  </p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Coordinator.swift</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">Coordinator</span> </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> navigationController: <span class="type">UINavigationController</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">  <span class="keyword">var</span> childCoordinator: <span class="type">Coordinator</span>? &#123; <span class="keyword">get</span> <span class="keyword">set</span> &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">push</span><span class="params">(viewController: UIViewController, animated: Bool)</span></span></span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">present</span><span class="params">(childViewController: UIViewController, animated: Bool)</span></span></span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">pop</span><span class="params">(animated: Bool)</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Coordinator</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">push</span><span class="params">(viewController: UIViewController, animated: Bool = <span class="literal">true</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">self</span>.navigationController.pushViewController(viewController, animated: animated)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">present</span><span class="params">(childCoordinator: Coordinator, animated: Bool)</span></span> &#123;</span><br><span class="line">    <span class="keyword">self</span>.navigationController.present(childCoordinator.navigationController, animated: animated) &#123; [<span class="keyword">weak</span> <span class="keyword">self</span>] <span class="keyword">in</span></span><br><span class="line">      <span class="keyword">self</span>?.childCoordinator = childCoordinator</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">pop</span><span class="params">(animated: Bool = <span class="literal">true</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> childCoordinator = <span class="keyword">self</span>.childCoordinator &#123;</span><br><span class="line">      <span class="keyword">self</span>.dismissViewController(animated: animated) &#123; [<span class="keyword">weak</span> <span class="keyword">self</span>] <span class="keyword">in</span></span><br><span class="line">        <span class="keyword">self</span>?.childCoordinator = <span class="literal">nil</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">self</span>.navigationController.popViewController(animated: animated)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“æˆ‘ä»¬æƒ³è¦å£°æ˜ä¸€ä¸ªæ–°çš„ <code>Coordinator</code> å¯¹è±¡æ—¶ï¼Œä¼šåƒè¿™æ ·åšï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// MainCoordinator.swift</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MainCoordinator</span>: <span class="title">Coordinator</span> </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> navigationController: <span class="type">UINavigationController</span> = <span class="type">UINavigationController</span>()</span><br><span class="line">  <span class="keyword">var</span> childCoordinator: <span class="type">Coordinator</span>?</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">showTutorialPage1</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">let</span> vc = makeTutorialPage(<span class="number">1</span>, coordinator: <span class="keyword">self</span>)</span><br><span class="line">    <span class="keyword">self</span>.push(viewController: vc)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">showTutorialPage2</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">let</span> vc = makeTutorialPage(<span class="number">2</span>, coordinator: <span class="keyword">self</span>)</span><br><span class="line">    <span class="keyword">self</span>.push(viewController: vc)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">makeTutorialPage</span><span class="params">(<span class="number">_</span> num: Int, coordinator: Coordinator)</span></span> -&gt; <span class="type">UIViewController</span> &#123; â€¦ &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="é—®é¢˜ï¼šæ³„æ¼å®ç°ç»†èŠ‚"><a href="#é—®é¢˜ï¼šæ³„æ¼å®ç°ç»†èŠ‚" class="headerlink" title="é—®é¢˜ï¼šæ³„æ¼å®ç°ç»†èŠ‚"></a>é—®é¢˜ï¼šæ³„æ¼å®ç°ç»†èŠ‚</h2><p>è¿™ä¸ªè§£å†³æ–¹æ¡ˆåœ¨ <code>protocol</code> çš„å¯è§æ€§ä¸Šæœ‰ä¸¤ä¸ªé—®é¢˜ï¼š  </p><ul><li>æ¯å½“æˆ‘ä»¬æƒ³è¦å£°æ˜ä¸€ä¸ªæ–°çš„ <code>Coordinator</code> å¯¹è±¡ï¼Œéƒ½å¿…é¡»æ˜¾å¼çš„å£°æ˜ä¸€ä¸ª <code>let navigationController: UINavigationController</code> å±æ€§å’Œä¸€ä¸ª <code>var childCoordinator: Coordinator?</code> å±æ€§ã€‚<strong>è™½ç„¶ï¼Œåœ¨éµå®ˆåè®®çš„ç±»å‹ç°å®ä¸­ï¼Œæˆ‘ä»¬å¹¶æ²¡æœ‰æ˜¾å¼çš„ä½¿ç”¨ä»–ä»¬</strong> - ä½†å®ƒä»¬å°±åœ¨é‚£é‡Œï¼Œå› ä¸ºæˆ‘ä»¬éœ€è¦å®ƒä»¬ä½œä¸ºé»˜è®¤çš„å®ç°æ¥ä¾› <code>protocol Coordinator</code> æ­£å¸¸å·¥ä½œã€‚  </li><li>æˆ‘ä»¬å¿…é¡»å£°æ˜çš„è¿™ä¸¤ä¸ªå±æ€§å…·æœ‰ä¸ <code>MainCoordinator</code> ç›¸åŒçš„å¯è§æ€§ï¼ˆåœ¨æœ¬ä¾‹ä¸­ä¸ºéšå¼ <code>internalï¼ˆå†…éƒ¨ï¼‰</code> è®¿é—®æ§åˆ¶çº§åˆ«ï¼‰ï¼Œå› ä¸ºè¿™æ˜¯ <code>protocol Coordinator</code> çš„å¿…å¤‡æ¡ä»¶ã€‚è¿™ä½¿å¾—å®ƒä»¬å¯¹å¤–éƒ¨å¯è§ï¼Œå°±åƒåœ¨ç¼–ç æ—¶å¯ä»¥ä½¿ç”¨ <code>MainCoordinator</code>ã€‚  </li></ul><p>æ‰€ä»¥é—®é¢˜æ˜¯æˆ‘ä»¬æ¯æ¬¡éƒ½è¦å£°æ˜ä¸€äº›å±æ€§â€”â€”å³ä½¿å®ƒåªæ˜¯ä¸€äº›å®ç°ç»†èŠ‚ï¼Œè€Œä¸”è¿™äº›å®ç°ç»†èŠ‚ä¼šé€šè¿‡å¤–éƒ¨æ¥å£è¢«æ³„æ¼ï¼Œä»è€Œå…è®¸ç±»çš„è®¿é—®è€…åšä¸€äº›æœ¬ä¸åº”è¯¥è¢«å…è®¸çš„äº‹ï¼Œä¾‹å¦‚ï¼š  </p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> mainCoord = <span class="type">MainCoordinator</span>()</span><br><span class="line"><span class="comment">// è®¿é—®è€…ä¸åº”è¯¥è¢«å…è®¸ç›´æ¥è®¿é—® navigationController ï¼Œä½†æ˜¯ä»–ä»¬å¯ä»¥</span></span><br><span class="line">mainCoord.navigationController.dismissViewController(animated: <span class="literal">true</span>)</span><br><span class="line"><span class="comment">// ä»–ä»¬ä¹Ÿä¸åº”è¯¥è¢«å…è®¸åšè¿™æ ·çš„äº‹æƒ…</span></span><br><span class="line">mainCoord.childCoordinator = mainCoord</span><br></pre></td></tr></table></figure><p>ä¹Ÿè®¸ä½ ä¼šè®¤ä¸ºï¼Œæ—¢ç„¶æˆ‘ä»¬ä¸å¸Œæœ›å®ƒä»¬æ˜¯å¯è§çš„ï¼Œé‚£ä¹ˆå¯ä»¥ç›´æ¥åœ¨ç¬¬ä¸€æ®µä»£ç çš„ <code>protocol</code> ä¸­ä¸å£°æ˜è¿™ä¸¤ä¸ªå±æ€§ã€‚ä½†æ˜¯å¦‚æœæˆ‘ä»¬è¿™æ ·åšï¼Œå°†æ— æ³•é€šè¿‡ <code>extension Coordinator</code> æ¥æä¾›é»˜è®¤çš„å®ç°ï¼Œå› ä¸ºé»˜è®¤çš„å®ç°éœ€è¦è¿™ä¸¤ä¸ªå±æ€§å­˜åœ¨ä»¥ä¾¿å®ƒä»¬çš„ä»£ç è¢«ç¼–è¯‘ã€‚  </p><p>ä½ å¯èƒ½å¸Œæœ› Swift å…è®¸åœ¨åè®®ä¸­ç”³æ˜è¿™äº›å±æ€§ä¸º <code>fileprivate</code>ï¼Œä½†æ˜¯åœ¨ Swift 4 ä¸­ï¼Œä½ ä¸èƒ½åœ¨ <code>protocols</code> ä¸­ä½¿ç”¨ä»»ä½•è®¿é—®æ§åˆ¶çš„å…³é”®å­—ã€‚  </p><p>æ‰€ä»¥æˆ‘ä»¬å¦‚ä½•æ‰èƒ½è§£å†³è¿™ä¸ªâ€œæ—¢è¦æä¾›ç”¨åˆ°è¿™ä¸ªå±æ€§çš„é»˜è®¤å®ç°ï¼Œæœ‰ä¸è®©è¿™äº›å±æ€§å¯¹å¤–æš´éœ²â€çš„é—®é¢˜å‘¢ï¼Ÿ</p><h2 id="ä¸€ä¸ªè§£å†³æ–¹æ¡ˆ"><a href="#ä¸€ä¸ªè§£å†³æ–¹æ¡ˆ" class="headerlink" title="ä¸€ä¸ªè§£å†³æ–¹æ¡ˆ"></a>ä¸€ä¸ªè§£å†³æ–¹æ¡ˆ</h2><p>å®ç°è¿™ä¸€ç‚¹çš„ä¸€ä¸ªæŠ€å·§æ˜¯å°†è¿™äº›å±æ€§éšè—åœ¨ä¸­é—´å¯¹è±¡ä¸­ï¼Œå¹¶åœ¨è¯¥å¯¹è±¡ä¸­å°†å¯¹åº”çš„å±æ€§å£°æ˜ä¸º <code>fileprivate</code>ã€‚  </p><p>é€šè¿‡è¿™ç§æ–¹å¼ï¼Œå°½ç®¡æˆ‘ä»¬ä¾æ—§åœ¨å¯¹åº”ç±»å‹çš„å…¬å…±æ¥å£ä¸­å£°æ˜äº†å±æ€§ï¼Œä½†æ˜¯æ¥å£çš„è®¿é—®è€…å´ä¸èƒ½è®¿é—®è¯¥å¯¹è±¡çš„å†…éƒ¨å±æ€§ã€‚è€Œæˆ‘ä»¬å¯¹äºåè®®çš„é»˜è®¤å®ç°å´èƒ½å¤Ÿè®¿é—®å®ƒä»¬ â€”â€” åªè¦å®ƒä»¬åœ¨åŒä¸€ä¸ªæ–‡ä»¶ä¸­è¢«å£°æ˜å°±è¡Œäº†ï¼ˆå› ä¸ºå®ƒä»¬æ˜¯ <code>fileprivate</code> ï¼‰ã€‚  </p><p>çœ‹èµ·æ¥å°±åƒè¿™æ ·ï¼š  </p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Coordinator.swift</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CoordinatorComponents</span> </span>&#123;</span><br><span class="line">  <span class="keyword">fileprivate</span> <span class="keyword">let</span> navigationController: <span class="type">UINavigationController</span> = <span class="type">UINavigationController</span>()</span><br><span class="line">  <span class="keyword">fileprivate</span> <span class="keyword">var</span> childCoordinator: <span class="type">Coordinator</span>? = <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">Coordinator</span>: <span class="title">AnyObject</span> </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> coordinatorComponents: <span class="type">CoordinatorComponents</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">push</span><span class="params">(viewController: UIViewController, animated: Bool)</span></span></span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">present</span><span class="params">(childCoordinator: Coordinator, animated: Bool)</span></span></span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">pop</span><span class="params">(animated: Bool)</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Coordinator</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">push</span><span class="params">(viewController: UIViewController, animated: Bool = <span class="literal">true</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">self</span>.coordinatorComponents.navigationController.pushViewController(viewController, animated: animated)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">present</span><span class="params">(childCoordinator: Coordinator, animated: Bool = <span class="literal">true</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">let</span> childVC = childCoordinator.coordinatorComponents.navigationController</span><br><span class="line">    <span class="keyword">self</span>.coordinatorComponents.navigationController.present(childVC, animated: animated) &#123; [<span class="keyword">weak</span> <span class="keyword">self</span>] <span class="keyword">in</span></span><br><span class="line">      <span class="keyword">self</span>?.coordinatorComponents.childCoordinator = childCoordinator <span class="comment">// retain the child strongly</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">pop</span><span class="params">(animated: Bool = <span class="literal">true</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">let</span> privateAPI = <span class="keyword">self</span>.coordinatorComponents</span><br><span class="line">    <span class="keyword">if</span> privateAPI.childCoordinator != <span class="literal">nil</span> &#123;</span><br><span class="line">      privateAPI.navigationController.dismiss(animated: animated) &#123; [<span class="keyword">weak</span> privateAPI] <span class="keyword">in</span></span><br><span class="line">        privateAPI?.childCoordinator = <span class="literal">nil</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      privateAPI.navigationController.popViewController(animated: animated)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç°åœ¨ï¼Œéµå®ˆåè®®çš„ <code>MainCoordinator</code> ç±»å‹ï¼š  </p><ul><li>ä»…éœ€è¦å£°æ˜ä¸€ä¸ª <code>let coordinatorComponents = CoordinatorComponents()</code> å±æ€§ï¼Œå¹¶ä¸ç”¨çŸ¥é“ <code>CoordinatorComponents</code> ç±»å‹çš„å†…éƒ¨æœ‰äº›ä»€ä¹ˆï¼ˆéšè—äº†å®ç°ç»†èŠ‚ï¼‰ã€‚  </li><li>åœ¨ <code>MainCoordinator.swift</code> æ–‡ä»¶ä¸­ï¼Œä¸èƒ½è®¿é—® <code>coordinatorComponents</code> çš„ä»»ä½•å±æ€§ï¼Œå› ä¸ºå®ƒä»¬è¢«å£°æ˜ä¸º <code>fileprivate</code>ã€‚  </li></ul><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainCoordinator</span>: <span class="title">Coordinator</span> </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> coordinatorComponents = <span class="type">CoordinatorComponents</span>()</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">showTutorialPage1</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">let</span> vc = makeTutorialPage(<span class="number">1</span>, coordinator: <span class="keyword">self</span>)</span><br><span class="line">    <span class="keyword">self</span>.push(viewController: vc)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">showTutorialPage2</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">let</span> vc = makeTutorialPage(<span class="number">2</span>, coordinator: <span class="keyword">self</span>)</span><br><span class="line">    <span class="keyword">self</span>.push(viewController: vc)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">makeTutorialPage</span><span class="params">(<span class="number">_</span> num: Int, coordinator: Coordinator)</span></span> -&gt; <span class="type">UIViewController</span> &#123; â€¦ &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“ç„¶ï¼Œä½ ä»ç„¶éœ€è¦åœ¨éµå®ˆåè®®çš„ç±»å‹ä¸­å£°æ˜ <code>let coordinatorComponents</code> æ¥æä¾›å­˜å‚¨ï¼Œè¿™ä¸ªå£°æ˜å¿…é¡»æ˜¯å¯è§çš„ï¼ˆä¸èƒ½æ˜¯ <code>private</code>ï¼‰ï¼Œå› ä¸ºè¿™æ˜¯éµå®ˆ <code>protocol Coordinator</code> æ‰€è¦æ±‚çš„ä¸€éƒ¨åˆ†ã€‚ä½†æ˜¯ï¼š  </p><ul><li>åªéœ€è¦å£°æ˜ 1 ä¸ªå±æ€§ï¼Œå–ä»£ä¹‹å‰çš„ 2 ä¸ªï¼ˆåœ¨æ›´å¤æ‚çš„æƒ…å†µä¸‹ä¼šæœ‰æ›´å¤šï¼‰ã€‚  </li><li>æ›´é‡è¦çš„æ˜¯ï¼Œå³ä½¿å®ƒå¯ä»¥ä»éµå®ˆåè®®çš„ç±»å‹çš„å®ç°ä¸­è®¿é—®ï¼Œä¹Ÿå¯ä»¥ä»å¤–éƒ¨æ¥å£è®¿é—®ï¼Œä½ å´ä¸èƒ½å¯¹å®ƒåšä»»ä½•äº‹æƒ…ã€‚  </li></ul><p>å½“ç„¶ï¼Œä½ ä»ç„¶å¯ä»¥è®¿é—® <code>myMainCoordinator.coordinatorComponents</code>ï¼Œä½†æ˜¯ä¸èƒ½ä½¿ç”¨å®ƒåšä»»ä½•äº‹æƒ…ï¼Œå› ä¸ºå®ƒæ‰€æœ‰çš„å±æ€§éƒ½æ˜¯ <code>fileprivate</code> ï¼  </p><h2 id="ç»“è®º"><a href="#ç»“è®º" class="headerlink" title="ç»“è®º"></a>ç»“è®º</h2><p>Swift å¯èƒ½æ— æ³•æä¾›ä½ æƒ³è¦çš„æ‰€æœ‰åŠŸèƒ½ã€‚ä½ å¯èƒ½å¸Œæœ›æœ‰æœä¸€æ—¥ <code>protocols</code> å…è®¸å¯¹å®ƒå£°æ˜éœ€è¦çš„å±æ€§å’Œæ–¹æ³•ä½¿ç”¨è®¿é—®æ§åˆ¶å…³é”®å­—ï¼Œæˆ–è€…é€šè¿‡æŸç§æ–¹å¼å°†å®ƒä»¬åœ¨å…¬å…± API ä¸­éšè—ã€‚  </p><p>ä½†ä¸æ­¤åŒæ—¶ï¼ŒæŒæ¡è¿™äº›æŠ€å·§å’Œå˜é€šæ–¹æ³•å¯ä»¥ä½¿ä½ çš„å…¬å…± API æ›´å¥½ã€æ›´å®‰å…¨ï¼Œé¿å…æ³„éœ²å®ç°ç»†èŠ‚æˆ–è€…è®¿é—®åœ¨å®ç°ä¹‹å¤–ä¸åº”è¯¥è¢«ä¿®æ”¹çš„å±æ€§ï¼ŒåŒæ—¶ä»ç„¶ä½¿ç”¨ <a href="http://alisoftware.github.io/swift/protocol/2015/11/08/mixins-over-inheritance/" target="_blank" rel="noopener">Mixin pattern</a> å¹¶æä¾›é»˜è®¤å®ç°ã€‚  </p><hr><p><a id="foot1" href="#1"><sup>[1]</sup></a>.è¿™æ˜¯ä¸€ä¸ªç®€åŒ–çš„ä¾‹å­ï¼›ä¸è¦å°†æ³¨æ„åŠ›é›†ä¸­åœ¨ Coordinator çš„å®ç° - å®ƒä¸æ˜¯è¿™ä¸ªä¾‹å­çš„é‡ç‚¹ï¼Œæ›´åº”è¯¥å…³æ³¨çš„æ˜¯éœ€è¦åœ¨åè®®ä¸­å£°æ˜å…¬å¼€å¯è®¿é—®çš„å±æ€§ã€‚</p><blockquote><p>æœ¬æ–‡ç”± SwiftGG ç¿»è¯‘ç»„ç¿»è¯‘ï¼Œå·²ç»è·å¾—ä½œè€…ç¿»è¯‘æˆæƒï¼Œæœ€æ–°æ–‡ç« è¯·è®¿é—® <a href="http://swift.gg">http://swift.gg</a>ã€‚</p></blockquote>]]></content>
    
    <summary type="html">
    
      é€šè¿‡å¦ä¸€ç§æ–¹å¼æ¥æ§åˆ¶åè®®ä¸­å±æ€§å’Œæ–¹æ³•çš„è®¿é—®æƒé™
    
    </summary>
    
      <category term="Olivier Halligon" scheme="https://swift.gg/categories/Olivier-Halligon/"/>
    
      <category term="Swift" scheme="https://swift.gg/categories/Olivier-Halligon/Swift/"/>
    
    
      <category term="åè®®" scheme="https://swift.gg/tags/%E5%8D%8F%E8%AE%AE/"/>
    
  </entry>
  
  <entry>
    <title>SwiftSyntax</title>
    <link href="https://swift.gg/2019/01/25/nshipster-swiftsyntax/"/>
    <id>https://swift.gg/2019/01/25/nshipster-swiftsyntax/</id>
    <published>2019-01-25T00:00:00.000Z</published>
    <updated>2019-02-19T03:45:15.660Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ä½œè€…ï¼šMatttï¼Œ<a href="https://nshipster.com/swiftsyntax/" target="_blank" rel="noopener">åŸæ–‡é“¾æ¥</a>ï¼ŒåŸæ–‡æ—¥æœŸï¼š2018-10-22<br>è¯‘è€…ï¼š<a href="https://dingtz.com/" target="_blank" rel="noopener">jojotov</a>ï¼›æ ¡å¯¹ï¼š<a href="http://numbbbbb.com/" target="_blank" rel="noopener">numbbbbb</a>ï¼Œ<a href="http://blog.yousanflics.com.cn" target="_blank" rel="noopener">Yousanflics</a>ï¼Œ<a href="http://www.jianshu.com/users/596f2ba91ce9/latest_articles" target="_blank" rel="noopener">pmst</a>ï¼›å®šç¨¿ï¼š<a href="http://forelax.space" target="_blank" rel="noopener">Forelax</a></p></blockquote><!--æ­¤å¤„å¼€å§‹æ­£æ–‡--><p><a href="https://github.com/apple/swift-syntax" target="_blank" rel="noopener">SwiftSyntax</a> æ˜¯ä¸€ä¸ªå¯ä»¥åˆ†æã€ç”Ÿæˆä»¥åŠè½¬æ¢ Swift æºä»£ç çš„ Swift åº“ã€‚å®ƒæ˜¯åŸºäº <a href="https://github.com/apple/swift/tree/master/lib/Syntax" target="_blank" rel="noopener">libSyntax</a> åº“å¼€å‘çš„ï¼Œå¹¶äº <a href="https://github.com/apple/swift-syntax/commit/909d336aefacdcbdd45ec6130471644c1ae929f5" target="_blank" rel="noopener">2017 å¹´ 8 æœˆ</a> ä» Swift è¯­è¨€çš„ä¸»ä»“åº“ä¸­åˆ†ç¦»å‡ºæ¥ï¼Œå•ç‹¬å»ºç«‹äº†ä¸€ä¸ªä»“åº“ã€‚</p><a id="more"></a><p>æ€»çš„æ¥è¯´ï¼Œè¿™äº›åº“éƒ½æ˜¯ä¸ºäº†ç»™ç»“æ„åŒ–ç¼–è¾‘ï¼ˆstructured editingï¼‰æä¾›å®‰å…¨ã€æ­£ç¡®ä¸”ç›´è§‚çš„å·¥å…·ã€‚å…³äºç»“æ„åŒ–ç¼–è¾‘ï¼Œåœ¨ <a href="https://github.com/apple/swift/blob/master/lib/Syntax/README.md#swift-syntax-and-structured-editing-library" target="_blank" rel="noopener">thusly</a> ä¸­æœ‰å…·ä½“çš„æè¿°:</p><blockquote><p>ä»€ä¹ˆæ˜¯ç»“æ„åŒ–ç¼–è¾‘ï¼Ÿç»“æ„åŒ–ç¼–è¾‘æ˜¯ä¸€ç§ç¼–è¾‘çš„ç­–ç•¥ï¼Œå®ƒå¯¹æºä»£ç çš„<em>ç»“æ„</em>æ›´åŠ æ•æ„Ÿï¼Œè€Œæºä»£ç çš„è¡¨ç¤ºï¼ˆä¾‹å¦‚å­—ç¬¦æˆ–è€…å­—èŠ‚ï¼‰åˆ™æ²¡é‚£ä¹ˆé‡è¦ã€‚è¿™å¯ä»¥ç»†åŒ–ä¸ºä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†ï¼šæ›¿æ¢æ ‡è¯†ç¬¦ï¼Œå°†å¯¹å…¨å±€æ–¹æ³•çš„è°ƒç”¨è½¬ä¸ºå¯¹æ–¹æ³•çš„è°ƒç”¨ï¼Œæˆ–è€…æ ¹æ®å·²å®šçš„è§„åˆ™è¯†åˆ«å¹¶æ ¼å¼åŒ–æ•´ä¸ªæºæ–‡ä»¶ã€‚</p></blockquote><p>åœ¨å†™è¿™ç¯‡æ–‡ç« æ—¶ï¼ŒSwiftSyntax ä»å¤„äºåœ¨å¼€å‘ä¸­å¹¶è¿›è¡Œ API è°ƒæ•´çš„é˜¶æ®µã€‚ä¸è¿‡ç›®å‰ä½ å·²ç»å¯ä»¥ä½¿ç”¨å®ƒå¯¹ Swift ä»£ç è¿›è¡Œä¸€äº›ç¼–ç¨‹å·¥ä½œã€‚</p><p>ç›®å‰ï¼Œ<a href="https://github.com/apple/swift/tree/master/lib/Migrator" target="_blank" rel="noopener">Swift Migrator</a> å·²ç»åœ¨ä½¿ç”¨ SwiftSyntax äº†ï¼Œå¹¶ä¸”åœ¨å¯¹å†…å’Œå¯¹å¤–å±‚é¢ä¸Šï¼Œå¯¹ SwiftSyntax çš„æ¥å…¥ä¹Ÿåœ¨ä¸æ–­åœ°åŠªåŠ›ç€ã€‚</p><h2 id="SwiftSyntax-å¦‚ä½•å·¥ä½œï¼Ÿ"><a href="#SwiftSyntax-å¦‚ä½•å·¥ä½œï¼Ÿ" class="headerlink" title="SwiftSyntax å¦‚ä½•å·¥ä½œï¼Ÿ"></a>SwiftSyntax å¦‚ä½•å·¥ä½œï¼Ÿ</h2><p>ä¸ºäº†æ˜ç™½ SwiftSyntax å¦‚ä½•å·¥ä½œï¼Œæˆ‘ä»¬é¦–å…ˆè¦å›å¤´çœ‹çœ‹ Swift ç¼–è¯‘å™¨çš„æ¶æ„ï¼š</p><p><img src="https://nshipster.com/assets/swift-compilation-diagram-8af7d0078f72cdaa8f50430e608f15a9d4214f5772439d2fd6904bb5a8a53c60.png" alt=""></p><p>Swift ç¼–è¯‘å™¨çš„ä¸»è¦èŒè´£æ˜¯æŠŠ Swift ä»£ç è½¬æ¢ä¸ºå¯æ‰§è¡Œçš„æœºå™¨ä»£ç ã€‚æ•´ä¸ªè¿‡ç¨‹å¯ä»¥åˆ’åˆ†ä¸ºå‡ ä¸ªç¦»æ•£çš„æ­¥éª¤ï¼Œä¸€å¼€å§‹ï¼Œ<a href="https://github.com/apple/swift/tree/master/lib/Parse" target="_blank" rel="noopener">è¯­æ³•åˆ†æå™¨</a> ä¼šç”Ÿæˆä¸€ä¸ªæŠ½è±¡è¯­æ³•æ ‘ï¼ˆASTï¼‰ã€‚ä¹‹åï¼Œè¯­ä¹‰åˆ†æå™¨ä¼šè¿›è¡Œå·¥ä½œå¹¶ç”Ÿæˆä¸€ä¸ªé€šè¿‡ç±»å‹æ£€æŸ¥çš„ ASTã€‚è‡³æ­¤æ­¥éª¤ï¼Œä»£ç ä¼šé™çº§åˆ° <a href="https://github.com/apple/swift/blob/master/docs/SIL.rst" target="_blank" rel="noopener">Swift ä¸­é—´å±‚è¯­è¨€</a>ï¼›éšå SIL ä¼šç»§ç»­è½¬æ¢å¹¶ä¼˜åŒ–è‡ªèº«ï¼Œé™çº§ä¸º <a href="http://llvm.org/docs/LangRef.html" target="_blank" rel="noopener">LLVM IR</a>ï¼Œå¹¶æœ€ç»ˆç¼–è¯‘ä¸ºæœºå™¨ä»£ç ã€‚</p><p>å¯¹äºæˆ‘ä»¬çš„è®¨è®ºæ¥è¯´ï¼Œæœ€é‡è¦çš„å…³é”®ç‚¹æ˜¯ SwiftSyntax çš„æ“ä½œç›®æ ‡æ˜¯ç¼–è¯‘è¿‡ç¨‹ç¬¬ä¸€æ­¥æ‰€ç”Ÿæˆçš„ ASTã€‚ä½†ä¹Ÿç”±äºè¿™æ ·ï¼ŒSwiftSyntax æ— æ³•å‘ŠçŸ¥ä½ ä»»ä½•å…³äºä»£ç çš„è¯­ä¹‰æˆ–ç±»å‹ä¿¡æ¯ã€‚</p><p>ä¸ SwiftSyntax ç›¸åï¼Œä¸€äº›å¦‚ <a href="https://github.com/apple/swift/tree/master/tools/SourceKit" target="_blank" rel="noopener">SourceKit</a> ä¹‹ç±»çš„å·¥å…·ï¼Œæ“ä½œçš„ç›®æ ‡ä¸ºæ›´å®¹æ˜“ç†è§£çš„ Swift ä»£ç ã€‚è¿™å¯ä»¥å¸®åŠ©æ­¤ç±»å·¥å…·å®ç°ä¸€äº›ç¼–è¾‘å™¨ç›¸å…³çš„ç‰¹æ€§ï¼Œä¾‹å¦‚ä»£ç è¡¥å…¨æˆ–è€…æ–‡ä»¶ä¹‹é—´çš„è·³è½¬ã€‚è™½ç„¶ SwiftSyntax ä¸èƒ½åƒ SourceKit ä¸€æ ·å®ç°è·³è½¬æˆ–è€…è¡¥å…¨çš„åŠŸèƒ½ï¼Œä½†åœ¨è¯­æ³•å±‚é¢ä¸Šä¹Ÿæœ‰å¾ˆå¤šåº”ç”¨åœºæ™¯ï¼Œä¾‹å¦‚ä»£ç æ ¼å¼åŒ–å’Œè¯­æ³•é«˜äº®ã€‚</p><h3 id="æ­ç§˜-AST"><a href="#æ­ç§˜-AST" class="headerlink" title="æ­ç§˜ AST"></a>æ­ç§˜ AST</h3><p>æŠ½è±¡è¯­æ³•æ ‘åœ¨æŠ½è±¡å±‚é¢ä¸Šæ¯”è¾ƒéš¾ä»¥ç†è§£ã€‚å› æ­¤æˆ‘ä»¬å…ˆç”Ÿæˆä¸€ä¸ªç¤ºä¾‹æ¥ä¸€ç¹å…¶è²Œã€‚</p><p>ç•™æ„ä¸€ä¸‹å¦‚ä¸‹çš„ä¸€è¡Œ Swift ä»£ç ï¼Œå®ƒå£°æ˜äº†ä¸€ä¸ªåä¸º <code>one()</code> çš„å‡½æ•°ï¼Œå‡½æ•°è¿”å›å€¼ä¸º <code>1</code>ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">one</span><span class="params">()</span></span> -&gt; <span class="type">Int</span> &#123; <span class="keyword">return</span> <span class="number">1</span> &#125;</span><br></pre></td></tr></table></figure><p>åœ¨å‘½ä»¤è¡Œä¸­å¯¹æ­¤æ–‡ä»¶è¿è¡Œ <code>swiftc</code> å‘½ä»¤å¹¶ä¼ å…¥ <code>-frontend -emit-syntax</code> å‚æ•°ï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> xcrun swiftc -frontend -emit-syntax ./One.swift</span></span><br></pre></td></tr></table></figure><p>è¿è¡Œçš„ç»“æœä¸ºä¸€ä¸² JSON æ ¼å¼çš„ ASTã€‚å½“ä½ ç”¨ JSON æ ¼å¼æ¥å±•ç¤ºæ—¶ï¼ŒAST çš„ç»“æ„ä¼šè¡¨ç°çš„æ›´åŠ æ¸…æ™°ï¼š</p><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"kind"</span>: <span class="string">"SourceFile"</span>,</span><br><span class="line">    <span class="attr">"layout"</span>: [&#123;</span><br><span class="line">        <span class="attr">"kind"</span>: <span class="string">"CodeBlockItemList"</span>,</span><br><span class="line">        <span class="attr">"layout"</span>: [&#123;</span><br><span class="line">            <span class="attr">"kind"</span>: <span class="string">"CodeBlockItem"</span>,</span><br><span class="line">            <span class="attr">"layout"</span>: [&#123;</span><br><span class="line">                <span class="attr">"kind"</span>: <span class="string">"FunctionDecl"</span>,</span><br><span class="line">                <span class="attr">"layout"</span>: [<span class="literal">null</span>, <span class="literal">null</span>, &#123;</span><br><span class="line">                    <span class="attr">"tokenKind"</span>: &#123;</span><br><span class="line">                        <span class="attr">"kind"</span>: <span class="string">"kw_func"</span></span><br><span class="line">                    &#125;,</span><br><span class="line">                    <span class="attr">"leadingTrivia"</span>: [],</span><br><span class="line">                    <span class="attr">"trailingTrivia"</span>: [&#123;</span><br><span class="line">                        <span class="attr">"kind"</span>: <span class="string">"Space"</span>,</span><br><span class="line">                        <span class="attr">"value"</span>: <span class="number">1</span></span><br><span class="line">                    &#125;],</span><br><span class="line">                    <span class="attr">"presence"</span>: <span class="string">"Present"</span></span><br><span class="line">                &#125;, &#123;</span><br><span class="line">                    <span class="attr">"tokenKind"</span>: &#123;</span><br><span class="line">                        <span class="attr">"kind"</span>: <span class="string">"identifier"</span>,</span><br><span class="line">                        <span class="attr">"text"</span>: <span class="string">"one"</span></span><br><span class="line">                    &#125;,</span><br><span class="line">                    <span class="attr">"leadingTrivia"</span>: [],</span><br><span class="line">                    <span class="attr">"trailingTrivia"</span>: [],</span><br><span class="line">                    <span class="attr">"presence"</span>: <span class="string">"Present"</span></span><br><span class="line">                &#125;, ...</span><br></pre></td></tr></table></figure><p>Python ä¸­çš„ <code>json.tool</code> æ¨¡å—æä¾›äº†ä¾¿æ·åœ°æ ¼å¼åŒ– JSON çš„èƒ½åŠ›ã€‚ä¸”å‡ ä¹æ‰€æœ‰çš„ macOS ç³»ç»Ÿéƒ½å·²ç»é›†æˆäº†æ­¤æ¨¡å—ï¼Œå› æ­¤æ¯ä¸ªäººéƒ½å¯ä»¥ä½¿ç”¨å®ƒã€‚ä¸¾ä¸ªä¾‹å­ï¼Œä½ å¯ä»¥ä½¿ç”¨å¦‚ä¸‹çš„å‘½ä»¤å¯¹ç¼–è¯‘çš„è¾“å‡ºç»“æœä½¿ç”¨ <code>json.tool</code> æ ¼å¼åŒ–ï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> xcrun swiftc -frontend -emit-syntax ./One.swift | python -m json.tool</span></span><br></pre></td></tr></table></figure><p>åœ¨æœ€å¤–å±‚ï¼Œå¯ä»¥çœ‹åˆ° <code>SourceFile</code>ï¼Œå®ƒç”± <code>CodeBlockItemList</code> ä»¥åŠ <code>CodeBlockItemList</code> å†…éƒ¨çš„ <code>CodeBlockItem</code> è¿™å‡ ä¸ªéƒ¨åˆ†ç»„æˆã€‚å¯¹äºè¿™ä¸ªç¤ºä¾‹æ¥è¯´ï¼Œä»…æœ‰ä¸€ä¸ª <code>CodeBlockItem</code> å¯¹åº”å‡½æ•°çš„å®šä¹‰ï¼ˆ<code>FunctionDecl</code>ï¼‰ï¼Œå…¶è‡ªèº«åŒ…å«äº†å‡ ä¸ªå­ç»„ä»¶å¦‚å‡½æ•°ç­¾åã€å‚æ•°é—­åŒ…å’Œè¿”å›é—­åŒ…ã€‚</p><p>æœ¯è¯­ trivia ç”¨äºæè¿°ä»»ä½•æ²¡æœ‰å®é™…è¯­æ³•æ„ä¹‰çš„ä¸œè¥¿ï¼Œä¾‹å¦‚ç©ºæ ¼ã€‚æ¯ä¸ªæ ‡è®°ç¬¦ï¼ˆTokenï¼‰å¯ä»¥æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªè¡Œå‰å’Œè¡Œå°¾çš„ triviaã€‚ä¾‹å¦‚ï¼Œåœ¨è¿”å›çš„é—­åŒ…ï¼ˆ<code>-&gt; Int</code>ï¼‰ä¸­çš„ <code>Int</code> åçš„ç©ºæ ¼å¯ä»¥ç”¨å¦‚ä¸‹çš„è¡Œå°¾ trivia è¡¨ç¤ºï¼š</p><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"kind"</span>: <span class="string">"Space"</span>,</span><br><span class="line">  <span class="attr">"value"</span>: <span class="number">1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å¤„ç†æ–‡ä»¶ç³»ç»Ÿé™åˆ¶"><a href="#å¤„ç†æ–‡ä»¶ç³»ç»Ÿé™åˆ¶" class="headerlink" title="å¤„ç†æ–‡ä»¶ç³»ç»Ÿé™åˆ¶"></a>å¤„ç†æ–‡ä»¶ç³»ç»Ÿé™åˆ¶</h3><p>SwiftSyntax é€šè¿‡ä»£ç†ç³»ç»Ÿçš„ <code>swiftc</code> è°ƒç”¨æ¥ç”ŸæˆæŠ½è±¡è¯­æ³•æ ‘ã€‚ä½†æ˜¯ï¼Œè¿™ä¹Ÿé™åˆ¶äº†ä»£ç å¿…é¡»æ”¾åœ¨æŸä¸ªæ–‡ä»¶æ‰èƒ½è¿›è¡Œå¤„ç†ï¼Œè€Œæˆ‘ä»¬å´ç»å¸¸éœ€è¦å¯¹ä»¥å­—ç¬¦ä¸²è¡¨ç¤ºçš„ä»£ç è¿›è¡Œå¤„ç†ã€‚</p><p>ä¸ºäº†è§£å†³è¿™ä¸ªé™åˆ¶ï¼Œå…¶ä¸­ä¸€ç§åŠæ³•æ˜¯æŠŠä»£ç å†™å…¥ä¸€ä¸ªä¸´æ—¶æ–‡ä»¶å¹¶ä¼ å…¥åˆ°ç¼–è¯‘å™¨ä¸­ã€‚</p><p><a href="https://nshipster.com/nstemporarydirectory/" target="_blank" rel="noopener">æˆ‘ä»¬æ›¾ç»å°è¯•è¿‡å†™å…¥ä¸´æ—¶æ–‡ä»¶</a>ï¼Œä½†ç›®å‰ï¼Œæœ‰æ›´å¥½çš„ API å¯ä»¥å¸®åŠ©æˆ‘ä»¬å®Œæˆè¿™é¡¹å·¥ä½œï¼Œå®ƒç”±  <a href="https://github.com/apple/swift-package-manager" target="_blank" rel="noopener">Swift Package Manager</a> æœ¬èº«æä¾›ã€‚åœ¨ä½ çš„ <code>Package.swift</code> æ–‡ä»¶ä¸­ï¼Œæ·»åŠ å¦‚ä¸‹çš„åŒ…ä¾èµ–å…³ç³»ï¼Œå¹¶æŠŠ <code>Utility</code> ä¾èµ–æ·»åŠ åˆ°æ­£ç¡®çš„ target ä¸­ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">.package(url: <span class="string">"https://github.com/apple/swift-package-manager.git"</span>, from: <span class="string">"0.3.0"</span>),</span><br></pre></td></tr></table></figure><p>ç°åœ¨ï¼Œä½ å¯ä»¥åƒä¸‹é¢è¿™æ ·å¼•å…¥ <code>Basic</code> æ¨¡å—å¹¶ä½¿ç”¨ <code>TemporaryFile</code> APIï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Basic</span><br><span class="line"><span class="keyword">import</span> Foundation</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> code: <span class="type">String</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> tempfile = <span class="keyword">try</span> <span class="type">TemporaryFile</span>(deleteOnClose: <span class="literal">true</span>)</span><br><span class="line"><span class="keyword">defer</span> &#123; tempfile.fileHandle.closeFile() &#125;</span><br><span class="line">tempfile.fileHandle.write(code.data(using: .utf8)!)</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> url = <span class="type">URL</span>(fileURLWithPath: tempfile.path.asString)</span><br><span class="line"><span class="keyword">let</span> sourceFile = <span class="keyword">try</span> <span class="type">SyntaxTreeParser</span>.parse(url)</span><br></pre></td></tr></table></figure><h2 id="æˆ‘ä»¬å¯ä»¥ç”¨-SwiftSyntax-åšä»€ä¹ˆ"><a href="#æˆ‘ä»¬å¯ä»¥ç”¨-SwiftSyntax-åšä»€ä¹ˆ" class="headerlink" title="æˆ‘ä»¬å¯ä»¥ç”¨ SwiftSyntax åšä»€ä¹ˆ"></a>æˆ‘ä»¬å¯ä»¥ç”¨ SwiftSyntax åšä»€ä¹ˆ</h2><p>ç°åœ¨æˆ‘ä»¬å¯¹ SwiftSyntax å¦‚ä½•å·¥ä½œå·²ç»æœ‰äº†è¶³å¤Ÿçš„ç†è§£ï¼Œæ˜¯æ—¶å€™è®¨è®ºä¸€ä¸‹å‡ ä¸ªä½¿ç”¨å®ƒçš„æ–¹å¼äº†ï¼</p><h3 id="ç¼–å†™-Swift-ä»£ç ï¼šåœ°ç‹±æ¨¡å¼"><a href="#ç¼–å†™-Swift-ä»£ç ï¼šåœ°ç‹±æ¨¡å¼" class="headerlink" title="ç¼–å†™ Swift ä»£ç ï¼šåœ°ç‹±æ¨¡å¼"></a>ç¼–å†™ Swift ä»£ç ï¼šåœ°ç‹±æ¨¡å¼</h3><p>æˆ‘ä»¬ç¬¬ä¸€ä¸ªæƒ³åˆ°ï¼Œä½†å´æ˜¯æœ€æ²¡æœ‰å®é™…æ„ä¹‰çš„ SwiftSyntax ç”¨ä¾‹å°±æ˜¯è®©ç¼–å†™ Swift ä»£ç çš„éš¾åº¦æå‡å‡ ä¸ªæ•°é‡çº§ã€‚</p><p>åˆ©ç”¨ SwiftSyntax ä¸­çš„ <code>SyntaxFactory</code> APIsï¼Œæˆ‘ä»¬å¯ä»¥ç”Ÿæˆå®Œæ•´çš„ Swift ä»£ç ã€‚ä¸å¹¸çš„æ˜¯ï¼Œç¼–å†™è¿™æ ·çš„ä»£ç å¹¶ä¸åƒé—²åº­æ•£æ­¥èˆ¬è½»æ¾ã€‚</p><p>ç•™æ„ä¸€ä¸‹å¦‚ä¸‹çš„ç¤ºä¾‹ä»£ç ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftSyntax</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> structKeyword = <span class="type">SyntaxFactory</span>.makeStructKeyword(trailingTrivia: .spaces(<span class="number">1</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> identifier = <span class="type">SyntaxFactory</span>.makeIdentifier(<span class="string">"Example"</span>, trailingTrivia: .spaces(<span class="number">1</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> leftBrace = <span class="type">SyntaxFactory</span>.makeLeftBraceToken()</span><br><span class="line"><span class="keyword">let</span> rightBrace = <span class="type">SyntaxFactory</span>.makeRightBraceToken(leadingTrivia: .newlines(<span class="number">1</span>))</span><br><span class="line"><span class="keyword">let</span> members = <span class="type">MemberDeclBlockSyntax</span> &#123; builder <span class="keyword">in</span></span><br><span class="line">    builder.useLeftBrace(leftBrace)</span><br><span class="line">    builder.useRightBrace(rightBrace)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> structureDeclaration = <span class="type">StructDeclSyntax</span> &#123; builder <span class="keyword">in</span></span><br><span class="line">    builder.useStructKeyword(structKeyword)</span><br><span class="line">    builder.useIdentifier(identifier)</span><br><span class="line">    builder.useMembers(members)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(structureDeclaration)</span><br></pre></td></tr></table></figure><p><em>å”·ã€‚</em>é‚£æœ€åè¿™æ®µä»£ç è®©æˆ‘ä»¬å¾—åˆ°äº†ä»€ä¹ˆå‘¢ï¼Ÿ</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Example</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><em>ä»¤äººçª’æ¯çš„æ“ä½œã€‚</em></p><p>è¿™ç»ä¸æ˜¯ä¸ºäº†å–ä»£ <a href="https://nshipster.com/swift-gyb/" target="_blank" rel="noopener">GYB</a> æ¥ç”¨äºæ¯å¤©çš„ä»£ç ç”Ÿæˆã€‚ï¼ˆäº‹å®ä¸Šï¼Œ<a href="https://github.com/apple/swift/blob/master/lib/Syntax/SyntaxKind.cpp.gyb" target="_blank" rel="noopener">libSyntax</a> å’Œ <a href="https://github.com/apple/swift-syntax/blob/master/Sources/SwiftSyntax/SyntaxKind.swift.gyb" target="_blank" rel="noopener">SwiftSyntax</a> éƒ½ä½¿ç”¨äº† <code>gyb</code> æ¥ç”Ÿæˆæ¥å£ã€‚</p><p>ä½†è¿™ä¸ªæ¥å£åœ¨æŸäº›ç‰¹æ®Šçš„é—®é¢˜ä¸Šå´æ ¼å¤–æœ‰ç”¨ã€‚ä¾‹å¦‚ï¼Œä½ æˆ–è®¸ä¼šä½¿ç”¨ SwiftSyntax æ¥å®ç°ä¸€ä¸ª Swift ç¼–è¯‘å™¨çš„ <a href="https://en.wikipedia.org/wiki/Fuzzing" target="_blank" rel="noopener">æ¨¡ç³Šæµ‹è¯•</a>ï¼Œä½¿ç”¨å®ƒå¯ä»¥éšæœºç”Ÿæˆä¸€ä¸ªè¡¨é¢æœ‰æ•ˆå´å®é™…ä¸Šéå¸¸å¤æ‚çš„ç¨‹åºï¼Œä»¥æ­¤æ¥è¿›è¡Œå‹åŠ›æµ‹è¯•ã€‚</p><h2 id="é‡å†™-Swift-ä»£ç "><a href="#é‡å†™-Swift-ä»£ç " class="headerlink" title="é‡å†™ Swift ä»£ç "></a>é‡å†™ Swift ä»£ç </h2><p><a href="https://github.com/apple/swift-syntax#example" target="_blank" rel="noopener">åœ¨ SwiftSyntax çš„ README ä¸­æœ‰ä¸€ä¸ªç¤ºä¾‹</a> å±•ç¤ºäº†å¦‚ä½•ç¼–å†™ä¸€ä¸ªç¨‹åºæ¥éå†æºæ–‡ä»¶ä¸­çš„æ•´å‹å¹¶æŠŠä»–ä»¬çš„å€¼åŠ  1ã€‚</p><p>é€šè¿‡è¿™ä¸ªï¼Œä½ åº”è¯¥å·²ç»æ¨æ–­å¾—å‡ºå¦‚ä½•ä½¿ç”¨å®ƒæ¥åˆ›å»ºä¸€ä¸ªå…¸å‹çš„ <code>swift-format</code> å·¥å…·ã€‚</p><p>ä½†ç°åœ¨ï¼Œæˆ‘ä»¬å…ˆè€ƒè™‘ä¸€ä¸ªç›¸å½“<em>æ²¡æœ‰</em>æ•ˆç‡â€”â€”å¹¶ä¸”å¯èƒ½åœ¨ä¸‡åœ£èŠ‚ï¼ˆğŸƒï¼‰è¿™ç§éœ€è¦æ£è›‹çš„åœºæ™¯æ‰åˆé€‚çš„ç”¨ä¾‹ï¼Œæºä»£ç é‡å†™ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftSyntax</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ZalgoRewriter</span>: <span class="title">SyntaxRewriter</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">visit</span><span class="params">(<span class="number">_</span> token: TokenSyntax)</span></span> -&gt; <span class="type">Syntax</span> &#123;</span><br><span class="line">        <span class="keyword">guard</span> <span class="keyword">case</span> <span class="keyword">let</span> .stringLiteral(text) = token.tokenKind <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> token</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> token.withKind(.stringLiteral(zalgo(text)))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a href="https://gist.github.com/mattt/b46ab5027f1ee6ab1a45583a41240033" target="_blank" rel="noopener"><code>zalgo</code></a> å‡½æ•°æ˜¯ç”¨æ¥åšä»€ä¹ˆçš„ï¼Ÿå¯èƒ½ä¸çŸ¥é“ä¼šæ›´å¥½â€¦â€¦</p><p>ä¸ç®¡æ€æ ·ï¼Œåœ¨ä½ çš„æºä»£ç ä¸­è¿è¡Œè¿™ä¸ªé‡å†™å™¨ï¼Œå¯ä»¥æŠŠæ‰€æœ‰çš„æ–‡æœ¬å­—ç¬¦ä¸²è½¬æ¢ä¸ºåƒä¸‹é¢ä¸€æ ·çš„æ•ˆæœï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Before ğŸ‘‹ğŸ˜„</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">"Hello, world!"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// After ğŸ¦‘ğŸ˜µ</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">"HÍÍÌ‚ÌŸÍ©elÍ¬ÍœÍ†ÌµlÍÌªÌ£ÌÍ oÌ‹Ì¡ÍÌ¼Í“Ì›, wÍ¢ÍÌ½Ì‡ÍªoÌ•ÌŒÌ©Í”Ì²ÍrÌ‰Ì Ì¡Í‚Í“Ì·lÌ˜Ì†Í¯ÌŠÌ³d!"</span>)</span><br></pre></td></tr></table></figure><p><em>é¬¼é­…ä¸€èˆ¬ï¼Œå¯¹å§ï¼Ÿ</em></p><h2 id="é«˜äº®-Swift-ä»£ç "><a href="#é«˜äº®-Swift-ä»£ç " class="headerlink" title="é«˜äº® Swift ä»£ç "></a>é«˜äº® Swift ä»£ç </h2><p>è®©æˆ‘ä»¬ç”¨ä¸€ä¸ªçœŸæ­£å®ç”¨çš„ä¸œè¥¿æ¥æ€»ç»“æˆ‘ä»¬å¯¹ SwiftSyntax çš„æ¢ç©¶ï¼šä¸€ä¸ª Swift è¯­æ³•é«˜äº®å·¥å…·ã€‚</p><p>ä»è¯­æ³•é«˜äº®å·¥å…·çš„æ„ä¹‰ä¸Šæ¥è¯´ï¼Œå®ƒå¯ä»¥æŠŠæºä»£ç æŒ‰æŸç§æ–¹å¼æ ¼å¼åŒ–ä¸ºæ˜¾ç¤ºæ›´ä¸ºå‹å¥½çš„ HTMLã€‚</p><p><a href="https://github.com/NSHipster/nshipster.com" target="_blank" rel="noopener">NSHipster é€šè¿‡ Jekyll æ­å»º</a>ï¼Œå¹¶ä½¿ç”¨äº† Ruby çš„åº“ <a href="https://github.com/jneen/rouge" target="_blank" rel="noopener">Rouge</a> æ¥æ¸²æŸ“ä½ åœ¨æ¯ç¯‡æ–‡ç« ä¸­çœ‹åˆ°çš„ç¤ºä¾‹ä»£ç ã€‚å°½ç®¡å¦‚æ­¤ï¼Œç”±äº Swift çš„å¤æ‚è¯­æ³•å’Œè¿‡å¿«è¿­ä»£ï¼Œæ¸²æŸ“å‡ºæ¥çš„ HTML å¹¶ä¸æ˜¯ 100% æ­£ç¡®ã€‚</p><p>ä¸åŒäº <a href="https://github.com/jneen/rouge/blob/master/lib/rouge/lexers/swift.rb" target="_blank" rel="noopener">å¤„ç†ä¸€å †éº»çƒ¦çš„æ­£åˆ™è¡¨è¾¾å¼</a>ï¼Œæˆ‘ä»¬å¯ä»¥æ„é€ ä¸€ä¸ª <a href="https://github.com/NSHipster/SwiftSyntaxHighlighter" target="_blank" rel="noopener">è¯­æ³•é«˜äº®å™¨</a> æ¥æ”¾å¤§ SwiftSyntax å¯¹è¯­è¨€çš„ç†è§£çš„ä¼˜åŠ¿ã€‚</p><p>æ ¹æ®è¿™ä¸ªæ ¸å¿ƒç›®çš„ï¼Œå®ç°çš„æ–¹æ³•å¯ä»¥å¾ˆç›´æ¥ï¼šå®ç°ä¸€ä¸ª <code>SyntaxRewriter</code> çš„å­ç±»å¹¶é‡å†™ <code>visit(_:)</code> æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•ä¼šåœ¨éå†æºæ–‡ä»¶çš„æ¯ä¸ªæ ‡è¯†ç¬¦æ—¶è¢«è°ƒç”¨ã€‚é€šè¿‡åˆ¤æ–­æ¯ç§ä¸åŒçš„æ ‡è¯†ç¬¦ç±»å‹ï¼Œä½ å¯ä»¥æŠŠç›¸åº”çš„å¯é«˜äº®æ ‡è¯†ç¬¦æ˜ å°„ä¸º HTML æ ‡è®°ã€‚</p><p>ä¾‹å¦‚ï¼Œæ•°å­—æ–‡æœ¬å¯ä»¥ç”¨ç±»åæ˜¯ <code>m</code> å¼€å¤´çš„ <code>&lt;span&gt;</code> å…ƒç´ æ¥è¡¨ç¤ºï¼ˆ<code>mf</code> è¡¨ç¤ºæµ®ç‚¹å‹ï¼Œ<code>mi</code> è¡¨ç¤ºæ•´å‹ï¼‰ã€‚å¦‚ä¸‹æ˜¯å¯¹åº”çš„åœ¨ <code>SyntaxRewriter</code> å­ç±»ä¸­çš„ä»£ç ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftSyntax</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SwiftSyntaxHighlighter</span>: <span class="title">SyntaxRewriter</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> html: <span class="type">String</span> = <span class="string">""</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">visit</span><span class="params">(<span class="number">_</span> token: TokenSyntax)</span></span> -&gt; <span class="type">Syntax</span> &#123;</span><br><span class="line">        <span class="keyword">switch</span> token.tokenKind &#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">        <span class="keyword">case</span> .floatingLiteral(<span class="keyword">let</span> string):</span><br><span class="line">            html += <span class="string">"&lt;span class=\"mf\"&gt;<span class="subst">\(string)</span>&lt;/span&gt;"</span></span><br><span class="line">        <span class="keyword">case</span> .integerLiteral(<span class="keyword">let</span> string):</span><br><span class="line">            <span class="keyword">if</span> string.hasPrefix(<span class="string">"0b"</span>) &#123;</span><br><span class="line">                html += <span class="string">"&lt;span class=\"mb\"&gt;<span class="subst">\(string)</span>&lt;/span&gt;"</span></span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> string.hasPrefix(<span class="string">"0o"</span>) &#123;</span><br><span class="line">                html += <span class="string">"&lt;span class=\"mo\"&gt;<span class="subst">\(string)</span>&lt;/span&gt;"</span></span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> string.hasPrefix(<span class="string">"0x"</span>) &#123;</span><br><span class="line">                html += <span class="string">"&lt;span class=\"mh\"&gt;<span class="subst">\(string)</span>&lt;/span&gt;"</span></span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                html += <span class="string">"&lt;span class=\"mi\"&gt;<span class="subst">\(string)</span>&lt;/span&gt;"</span></span><br><span class="line">            &#125;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> token</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å°½ç®¡ <code>SyntaxRewritere</code> é’ˆå¯¹æ¯ä¸€ç§ä¸åŒç±»å‹çš„è¯­æ³•å…ƒç´ ï¼Œéƒ½å·²ç»å®ç°äº† <code>visit(:)</code> æ–¹æ³•ï¼Œä½†æˆ‘å‘ç°ä½¿ç”¨ä¸€ä¸ª <code>switch</code> è¯­å¥å¯ä»¥æ›´ç®€å•åœ°å¤„ç†æ‰€æœ‰å·¥ä½œã€‚ï¼ˆåœ¨ <code>default</code> åˆ†æ”¯ä¸­æ‰“å°å‡ºæ— æ³•å¤„ç†çš„æ ‡è®°ç¬¦ï¼Œå¯ä»¥æ›´å¥½åœ°å¸®åŠ©æˆ‘ä»¬æ‰¾åˆ°é‚£äº›æ²¡æœ‰å¤„ç†çš„æƒ…å†µï¼‰ã€‚è¿™ä¸æ˜¯æœ€ä¼˜é›…çš„å®ç°ï¼Œä½†é‰´äºæˆ‘å¯¹ SwiftSyntax ä¸è¶³çš„ç†è§£ï¼Œè¿™æ˜¯ä¸ªè¾ƒå¥½çš„å¼€ç«¯ã€‚</p><p>ä¸ç®¡æ€æ ·ï¼Œåœ¨å‡ ä¸ªå°æ—¶çš„å¼€å‘å·¥ä½œåï¼Œæˆ‘å·²ç»å¯ä»¥åœ¨ Swift å¤§é‡çš„è¯­æ³•ç‰¹æ€§ä¸­ï¼Œç”Ÿæˆå‡ºæ¯”è¾ƒç†æƒ³çš„æ¸²æŸ“è¿‡çš„è¾“å‡ºã€‚</p><p><img src="https://nshipster.com/assets/swiftsyntaxhightlighter-example-output-829aa64ab4bdf73a2e3070aab017e21e3db37ca0ee35079f0e89e22594806df0.png" alt=""></p><p>è¿™ä¸ªé¡¹ç›®éœ€è¦ä¸€ä¸ªåº“å’Œå‘½ä»¤è¡Œå·¥å…·çš„æ”¯æŒã€‚å¿«å» <a href="https://github.com/NSHipster/SwiftSyntaxHighlighter" target="_blank" rel="noopener">å°è¯•ä¸€ä¸‹ </a>ç„¶åè®©æˆ‘çŸ¥é“ä½ çš„æƒ³æ³•å§ï¼</p><blockquote><p>æœ¬æ–‡ç”± SwiftGG ç¿»è¯‘ç»„ç¿»è¯‘ï¼Œå·²ç»è·å¾—ä½œè€…ç¿»è¯‘æˆæƒï¼Œæœ€æ–°æ–‡ç« è¯·è®¿é—® <a href="http://swift.gg">http://swift.gg</a>ã€‚</p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;ä½œè€…ï¼šMatttï¼Œ&lt;a href=&quot;https://nshipster.com/swiftsyntax/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;åŸæ–‡é“¾æ¥&lt;/a&gt;ï¼ŒåŸæ–‡æ—¥æœŸï¼š2018-10-22&lt;br&gt;è¯‘è€…ï¼š&lt;a href=&quot;https://dingtz.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;jojotov&lt;/a&gt;ï¼›æ ¡å¯¹ï¼š&lt;a href=&quot;http://numbbbbb.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;numbbbbb&lt;/a&gt;ï¼Œ&lt;a href=&quot;http://blog.yousanflics.com.cn&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Yousanflics&lt;/a&gt;ï¼Œ&lt;a href=&quot;http://www.jianshu.com/users/596f2ba91ce9/latest_articles&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;pmst&lt;/a&gt;ï¼›å®šç¨¿ï¼š&lt;a href=&quot;http://forelax.space&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Forelax&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;!--æ­¤å¤„å¼€å§‹æ­£æ–‡--&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/apple/swift-syntax&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;SwiftSyntax&lt;/a&gt; æ˜¯ä¸€ä¸ªå¯ä»¥åˆ†æã€ç”Ÿæˆä»¥åŠè½¬æ¢ Swift æºä»£ç çš„ Swift åº“ã€‚å®ƒæ˜¯åŸºäº &lt;a href=&quot;https://github.com/apple/swift/tree/master/lib/Syntax&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;libSyntax&lt;/a&gt; åº“å¼€å‘çš„ï¼Œå¹¶äº &lt;a href=&quot;https://github.com/apple/swift-syntax/commit/909d336aefacdcbdd45ec6130471644c1ae929f5&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;2017 å¹´ 8 æœˆ&lt;/a&gt; ä» Swift è¯­è¨€çš„ä¸»ä»“åº“ä¸­åˆ†ç¦»å‡ºæ¥ï¼Œå•ç‹¬å»ºç«‹äº†ä¸€ä¸ªä»“åº“ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="Swift" scheme="https://swift.gg/categories/Swift/"/>
    
      <category term="NSHipster" scheme="https://swift.gg/categories/Swift/NSHipster/"/>
    
    
      <category term="Swift" scheme="https://swift.gg/tags/Swift/"/>
    
      <category term="NSHipster" scheme="https://swift.gg/tags/NSHipster/"/>
    
  </entry>
  
  <entry>
    <title>ä»¥æµçš„å½¢å¼æ‰§è¡Œ Multipart è¯·æ±‚</title>
    <link href="https://swift.gg/2019/01/21/streaming-multipart-requests/"/>
    <id>https://swift.gg/2019/01/21/streaming-multipart-requests/</id>
    <published>2019-01-21T00:00:00.000Z</published>
    <updated>2019-02-19T03:45:15.660Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ä½œè€…ï¼šSoroush Khanlouï¼Œ<a href="http://khanlou.com/2018/11/streaming-multipart-requests/" target="_blank" rel="noopener">åŸæ–‡é“¾æ¥</a>ï¼ŒåŸæ–‡æ—¥æœŸï¼š2018-11-14<br>è¯‘è€…ï¼š<a href="https://www.jianshu.com/u/076cc5e18bb8" target="_blank" rel="noopener">éƒ‘ä¸€ä¸€</a>ï¼›æ ¡å¯¹ï¼š<a href="http://numbbbbb.com/" target="_blank" rel="noopener">numbbbbb</a>ï¼Œ<a href="http://www.jianshu.com/users/596f2ba91ce9/latest_articles" target="_blank" rel="noopener">pmst</a>ï¼›å®šç¨¿ï¼š<a href="http://forelax.space" target="_blank" rel="noopener">Forelax</a></p></blockquote><!--æ­¤å¤„å¼€å§‹æ­£æ–‡--><p>Foundation æ¡†æ¶ä¸­çš„ URL ç±»æä¾›äº†éå¸¸å…¨é¢çš„åŠŸèƒ½ï¼Œæ­¤åè¿˜åœ¨ iOS 7 ä¸­æ–°å¢äº† URLSession ç±»ã€‚å°½ç®¡å¦‚æ­¤ï¼ŒåŸºç¡€åº“ä¸­ä»ç„¶ç¼ºå°‘ multipart æ–‡ä»¶ä¸Šä¼ çš„åŠŸèƒ½ã€‚</p><a id="more"></a><h2 id="ä»€ä¹ˆæ˜¯-multipart-è¯·æ±‚ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯-multipart-è¯·æ±‚ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯ multipart è¯·æ±‚ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯ multipart è¯·æ±‚ï¼Ÿ</h2><p>Multipart ç¼–ç å®é™…ä¸Šå°±æ˜¯åœ¨ç½‘ç»œä¸­ä¸Šä¼ å¤§å‹æ–‡ä»¶çš„æ–¹æ³•ã€‚åœ¨æµè§ˆå™¨ä¸­ï¼Œæœ‰æ—¶å€™ä½ ä¼šé€‰æ‹©ä¸€ä¸ªæ–‡ä»¶ä½œä¸ºè¡¨å•æäº¤å†…å®¹çš„ä¸€éƒ¨åˆ†ã€‚è¿™ä¸ªæ–‡ä»¶ä¾¿æ˜¯ä»¥ multipart è¯·æ±‚çš„æ–¹å¼å®ç°ä¸Šä¼ çš„ã€‚</p><p>ä¹ä¸€çœ‹ï¼Œmultipart è¯·æ±‚å’Œä¸€èˆ¬è¯·æ±‚å·®ä¸å¤šã€‚ä¸åŒä¹‹å¤„æ˜¯ multipart è¯·æ±‚é¢å¤–ä¸º <code>HTTP</code> è¯·æ±‚ä½“æŒ‡å®šäº†å”¯ä¸€ç¼–ç ã€‚åŒ JSON ç¼–ç ï¼ˆ<code>{&quot;key&quot;: &quot;value&quot;}</code>ï¼‰æˆ–è€… URL å­—ç¬¦ç¼–ç  (<code>key=value</code>) ç›¸æ¯”ï¼Œmultipart ç¼–ç å¹²çš„äº‹ç•¥å¾®æœ‰æ‰€ä¸åŒã€‚å› ä¸º multipart è¯·æ±‚ä½“å®é™…ä¸Šåªæ˜¯ä¸€ä¸²å­—èŠ‚æµï¼Œæ¥æ”¶ç«¯å®ä½“åœ¨è§£ææ•°æ®æ—¶ï¼Œéœ€è¦çŸ¥é“å­—èŠ‚æµä¸­å„ä¸ªéƒ¨åˆ†ä¹‹é—´çš„ç•Œé™ã€‚æ‰€ä»¥ multipart è¯·æ±‚éœ€è¦ä½¿ç”¨ â€œboundariesâ€ æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚åœ¨è¯·æ±‚é¦–éƒ¨çš„ <code>Content-Type</code> ä¸­ï¼Œå¯ä»¥å®šä¹‰ boundaryï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Accept: application/json</span><br><span class="line">Content-Type: multipart/form-data; boundary=khanlou.comNczcJGcxe</span><br></pre></td></tr></table></figure><p>Boundary çš„å…·ä½“å†…å®¹å¹¶ä¸é‡è¦ï¼Œå”¯ä¸€éœ€è¦æ³¨æ„çš„æ˜¯ï¼šåœ¨è¯·æ±‚ä½“ä¸­ï¼Œboundary æ˜¯ä¸èƒ½é‡å¤å‡ºç°ï¼ˆè¿™æ ·æ‰èƒ½ä½“ç° boundary çš„ä½œç”¨ï¼‰ã€‚ä½ å¯ä»¥ä½¿ç”¨ UUID ä½œä¸º boundaryã€‚</p><p>è¯·æ±‚çš„æ¯ä¸€éƒ¨åˆ†å¯ä»¥æ˜¯æ™®é€šæ•°æ®ï¼ˆæ¯”å¦‚å›¾ç‰‡ï¼‰æˆ–è€…å…ƒæ•°æ®ï¼ˆä¸€èˆ¬æ˜¯æ–‡æœ¬ï¼Œå¯¹åº”ä¸€ä¸ªåå­—ï¼Œç»„æˆä¸€ä¸ªé”®å€¼å¯¹ï¼‰ã€‚å¦‚æœæ•°æ®æ˜¯å›¾ç‰‡çš„è¯ï¼Œé‚£å®ƒçœ‹èµ·æ¥åº”è¯¥æ˜¯è¿™æ ·çš„ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">--&lt;boundary&gt;</span><br><span class="line">Content-Disposition: form-data; name=&lt;name&gt;; filename=&lt;filename.jpg&gt;</span><br><span class="line">Content-Type: image/jpeg</span><br><span class="line"></span><br><span class="line">&lt;image data&gt;</span><br></pre></td></tr></table></figure><p>å¦‚æœæ˜¯æ™®é€šæ–‡æœ¬ï¼Œåˆ™æ˜¯è¿™æ ·ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">--&lt;boundary&gt;</span><br><span class="line">Content-Disposition: form-data; name=&lt;name&gt;</span><br><span class="line">Content-Type: text/plain</span><br><span class="line"></span><br><span class="line">&lt;some text&gt;</span><br></pre></td></tr></table></figure><p>è¯·æ±‚ç»“å°¾ä¼šæœ‰ä¸€ä¸ªå¸¦ç€ä¸¤ä¸ªè¿å­—ç¬¦çš„ boundaryï¼Œ<code>--&lt;boundary&gt;--</code>ã€‚ï¼ˆæ­¤å¤„éœ€è¦æ³¨æ„ï¼Œæ‰€æœ‰æ–°è¡Œå¿…é¡»æ˜¯å›è½¦æ¢è¡Œã€‚ï¼‰</p><p>ä»¥ä¸Šå°±æ˜¯å…³äº multipart è¯·æ±‚çš„æ‰€æœ‰å†…å®¹ï¼Œå¹¶ä¸æ˜¯ç‰¹åˆ«å¤æ‚ã€‚äº‹å®ä¸Šï¼Œå½“åœ¨å†™ç¬¬ä¸€ä¸ªæœ‰å…³ multipart ç¼–ç çš„å®¢æˆ·ç«¯å®ç°æ—¶ï¼Œæˆ‘æœ‰äº›æŠµè§¦é˜…è¯» multipart/form-data çš„ <a href="https://tools.ietf.org/html/rfc7578" target="_blank" rel="noopener">RFC</a>ã€‚å¯æ˜¯åœ¨å¼€å§‹é˜…è¯»ä¹‹åï¼Œæˆ‘å¯¹è¿™ä¸ªåè®®çš„ç†è§£æ›´æ·±äº†ã€‚æ•´ä¸ªæ–‡æ¡£å¯è¯»æ€§å¾ˆå¼ºï¼Œå¾ˆè½»æ˜“å°±èƒ½ç›´è¾¾çŸ¥è¯†çš„æºå¤´ã€‚</p><p>æˆ‘åœ¨å¼€æºçš„ <a href="https://github.com/backchannel/BackchannelSDK-iOS" target="_blank" rel="noopener">Backchannel SDK</a> å®ç°äº†ä¸Šè¿°åŠŸèƒ½ã€‚<a href="https://github.com/backchannel/BackchannelSDK-iOS/blob/master/Source/Image%20Chooser/BAKUploadAttachmentRequest.m" target="_blank" rel="noopener"><code>BAKUploadAttachmentRequest</code></a> å’Œ <a href="https://github.com/backchannel/BackchannelSDK-iOS/blob/master/Source/Image%20Chooser/BAKMultipartRequestBuilder.m" target="_blank" rel="noopener"><code>BAKMultipartRequestBuilder</code></a> ç±»åŒ…å«äº†å¤„ç† mulitipart çš„æ–¹æ³•ã€‚åœ¨è¿™ä¸ªé¡¹ç›®ä¸­ï¼Œä»…ä»…åŒ…å«äº†å¤„ç†å•ä¸ªæ–‡ä»¶çš„æƒ…å†µï¼Œå¹¶ä¸”æ²¡æœ‰åŒ…æ‹¬å…ƒæ•°æ®ã€‚ä½†æ˜¯ä½œä¸ºèŒƒä¾‹ï¼Œä¾æ—§å¾ˆå¥½åœ°å±•ç¤ºäº† mulitipart è¯·æ±‚æ˜¯å¦‚ä½•æ„å»ºçš„ã€‚å¯ä»¥é€šè¿‡æ·»åŠ é¢å¤–çš„å®ç°ä»£ç ï¼Œæ¥æ”¯æŒå…ƒæ•°æ®å’Œå¤šæ–‡ä»¶çš„åŠŸèƒ½ã€‚</p><p>æ— è®ºæ˜¯ä½¿ç”¨ä¸€ä¸ªè¯·æ±‚ä¸Šä¼ å¤šä¸ªæ–‡ä»¶ï¼Œè¿˜æ˜¯å¤šä¸ªè¯·æ±‚åˆ†åˆ«å¯¹åº”ä¸Šä¼ ä¸€ä¸ªæ–‡ä»¶ï¼Œæ¥å®ç°å¤šæ–‡ä»¶ä¸Šä¼ åŠŸèƒ½ï¼Œéƒ½ä¼šç¢°åˆ°ä¸€ä¸ªé—®é¢˜ã€‚è¿™ä¸ªé—®é¢˜å°±æ˜¯ï¼Œå¦‚æœä½ å°è¯•ä¸€æ¬¡æ€§ä¸Šä¼ å¾ˆå¤šæ–‡ä»¶çš„è¯ï¼Œapp å°†ä¼šé—ªé€€ã€‚è¿™æ˜¯å› ä¸ºä½¿ç”¨ <a href="https://github.com/backchannel/BackchannelSDK-iOS/blob/master/Source/Image%20Chooser/BAKMultipartRequestBuilder.m#L66-L70" target="_blank" rel="noopener">è¯¥ç‰ˆæœ¬çš„ä»£ç </a>ï¼ŒåŠ è½½çš„æ•°æ®ä¼šç›´æ¥è¿›å…¥å†…å­˜ï¼Œåœ¨å†…å­˜æš´æ¶¨çš„æƒ…å†µä¸‹ï¼Œå³ä½¿ä½¿ç”¨å½“ä¸‹æ€§èƒ½æœ€å¼ºçš„æ——èˆ°æ‰‹æœºä¹Ÿä¼šæœ‰é—ªé€€å‘ç”Ÿã€‚</p><h2 id="å°†ç¡¬ç›˜ä¸­æ•°æ®ä»¥æµçš„å½¢å¼è¯»å–"><a href="#å°†ç¡¬ç›˜ä¸­æ•°æ®ä»¥æµçš„å½¢å¼è¯»å–" class="headerlink" title="å°†ç¡¬ç›˜ä¸­æ•°æ®ä»¥æµçš„å½¢å¼è¯»å–"></a>å°†ç¡¬ç›˜ä¸­æ•°æ®ä»¥æµçš„å½¢å¼è¯»å–</h2><p>æœ€å¸¸è§çš„è§£å†³æ–¹æ³•æ˜¯å°†ç¡¬ç›˜ä¸­çš„æ•°æ®ä»¥æµçš„å½¢å¼è¯»å–å‡ºæ¥ã€‚å…¶æ ¸å¿ƒæ€æƒ³æ˜¯æ–‡ä»¶çš„å­—èŠ‚æ•°æ®ä¼šä¸€ç›´ä¿å­˜åœ¨ç¡¬ç›˜é‡Œï¼Œç›´åˆ°è¢«è¯»å–å¹¶å‘å¾€ç½‘ç»œã€‚å†…å­˜ä¸­åªä¿ç•™äº†å¾ˆå°ä¸€éƒ¨åˆ†çš„é•œåƒæ•°æ®ã€‚</p><p>ç›®å‰ï¼Œæˆ‘æƒ³å‡ºä¸¤ç§æ–¹æ³•å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚ç¬¬ä¸€ä¸ªæ–¹æ³•ï¼ŒæŠŠ multipart è¯·æ±‚ä½“ä¸­çš„æ‰€æœ‰æ•°æ®å†™åˆ°ç¡¬ç›˜çš„ä¸€ä¸ªæ–°æ–‡ä»¶ä¸­ï¼Œå¹¶ä½¿ç”¨ URLSession çš„ <code>uploadTask(with request: URLRequest, fromFile fileURL: URL)</code> æ–¹æ³•å°†æ–‡ä»¶è½¬åŒ–ä¸ºæµã€‚è¿™ä¸ªæ–¹æ³•å¯ä»¥å¥æ•ˆï¼Œä½†æˆ‘å¹¶ä¸æƒ³ä¸ºæ¯ä¸€ä¸ªè¯·æ±‚æ–°å»ºä¸€ä¸ªæ–°æ–‡ä»¶ä¿å­˜åˆ°ç¡¬ç›˜ä¸­ã€‚å› ä¸ºè¿™æ„å‘³ç€åœ¨è¯·æ±‚å‘å‡ºåï¼Œè¿˜éœ€è¦åˆ é™¤è¿™ä¸ªæ–‡ä»¶ã€‚</p><p>ç¬¬äºŒç§æ–¹æ³•æ˜¯å°†å†…å­˜å’Œç¡¬ç›˜çš„æ•°æ®åˆå¹¶åœ¨ä¸€èµ·ï¼Œå¹¶é€šè¿‡ç»Ÿä¸€çš„æ¥å£å‘ç½‘ç»œè¾“å‡ºæ•°æ®ã€‚</p><p>å¦‚æœä½ è§‰å¾—ç¬¬äºŒç§æ–¹æ³•å¬èµ·æ¥åƒæ˜¯ <a href="http://khanlou.com/2015/10/clustering/" target="_blank" rel="noopener">ç±»ç°‡</a>ï¼Œæ­å–œä½ ï¼Œå®Œå…¨æ­£ç¡®ã€‚å¾ˆå¤šå¸¸ç”¨ Cocoa ç±»éƒ½å…è®¸åˆ›å»ºå­ç±»ï¼Œå¹¶å®ç°ä¸€äº›çˆ¶ç±»æ–¹æ³•ï¼Œä½¿å…¶å’Œçˆ¶ç±»è¡¨ç°ä¸€è‡´ã€‚å›æƒ³ä¸€ä¸‹ <code>NSArray</code> çš„ <code>-count</code> å±æ€§å’Œ <code>-objectAtIndex:</code> æ–¹æ³•ã€‚å› ä¸º <code>NSArray</code> çš„æ‰€æœ‰å…¶å®ƒæ–¹æ³•éƒ½æ˜¯åŸºäº <code>-count</code> å±æ€§å’Œ <code>-objectAtIndex:</code> æ–¹æ³•å®ç°çš„ï¼Œä½ å¯ä»¥éå¸¸è½»æ˜“åœ°åˆ›å»ºä¼˜åŒ–ç‰ˆæœ¬çš„ <code>NSArray</code> å­ç±»ã€‚</p><p>ä½ å¯ä»¥åˆ›å»ºä¸€ä¸ª <code>NSData</code> å­ç±»ï¼Œå®ƒæ— éœ€çœŸæ­£ä»ç¡¬ç›˜è¯»å–æ•°æ®ï¼Œè€Œåªæ˜¯åˆ›å»ºä¸€ä¸ªæŒ‡é’ˆç›´æ¥æŒ‡å‘ç¡¬ç›˜ä¸­çš„æ•°æ®ã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯æ˜¯ä¸éœ€è¦æŠŠæ•°æ®è½½å…¥å†…å­˜ä¸­è¿›è¡Œè¯»å–ã€‚è¿™ç§æ–¹æ³•ç§°ä¸ºå†…å­˜æ˜ å°„ï¼ŒåŸºäº Unix æ–¹æ³• <code>mmap</code>ã€‚ä½ å¯ä»¥é€šè¿‡ <code>.mappedIfSafe</code> æˆ–è€… <code>alwaysMapped</code> é€‰é¡¹ï¼Œæ¥ä½¿ç”¨ <code>NSData</code> çš„è¿™é¡¹ç‰¹æ€§ã€‚å› ä¸º <code>NSData</code> æ˜¯ä¸€ä¸ªç±»ç°‡ï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ª <code>ConcatenatedData</code> å­ç±»ï¼ˆå°±åƒ <code>FlattenCollection</code> åœ¨ Swift ä¸­çš„å·¥ä½œæ–¹å¼ï¼‰ï¼Œè¯¥å­ç±»ä¼šå°†å¤šä¸ª <code>NSData</code> å¯¹è±¡è§†ä½œä¸€ä¸ªè¿ç»­çš„ <code>NSData</code>ã€‚å®Œæˆåˆ›å»ºä»¥åï¼Œæˆ‘ä»¬å°±åšå¥½æ‰€æœ‰å‡†å¤‡æ¥è§£å†³è¿™ä¸ªé—®é¢˜å•¦ã€‚</p><p>é€šè¿‡æŸ¥çœ‹ <code>NSData</code> æ‰€æœ‰åŸç”Ÿæ–¹æ³•ï¼Œå¯ä»¥å‘ç°ï¼Œéœ€è¦å®ç°çš„æ˜¯ <code>-count</code> å’Œ <code>-bytes</code>ã€‚å®ç° <code>-count</code> å¹¶ä¸éš¾ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠæ‰€æœ‰ <code>NSData</code> å¯¹è±¡çš„å¤§å°ç›¸åŠ å¾—åˆ°ï¼›ä½†åœ¨å®ç° <code>-bytes</code> æ—¶åˆ™ä¼šæœ‰ä¸ªé—®é¢˜ã€‚ <code>-bytes</code> éœ€è¦è¿”å›ä¸€ä¸ªæŒ‡å‘ä¸€æ®µè¿ç»­ç¼“å†²åŒºçš„æŒ‡é’ˆï¼Œè€Œç›®å‰æˆ‘ä»¬å¹¶æ²¡æœ‰è¿™ä¸ªæŒ‡é’ˆã€‚</p><p>åœ¨åŸºç¡€åº“ä¸­ï¼Œæä¾›äº† <code>NSInputStream</code> ç±»ç”¨äºå¤„ç†ä¸è¿ç»­çš„æ•°æ®ã€‚éå¸¸å¹¸è¿ï¼Œ<code>NSInputStream</code> åŒæ ·æ˜¯ä¸€ä¸ªç±»ç°‡ã€‚æˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªå­ç±»ï¼Œå°†å¤šæ¡æµåˆå¹¶ã€‚åœ¨ä½¿ç”¨å­ç±»æ—¶ï¼Œæ„Ÿè§‰ä¸Šå°±åƒæ˜¯ä¸€æ¡æµã€‚é€šè¿‡ä½¿ç”¨ <code>+inputStreamWithData:</code> å’Œ <code>+inputStreamWithURL:</code> æ–¹æ³•ï¼Œå¯ä»¥è½»æ˜“åœ°åˆ›å»ºä¸€æ¡è¾“å…¥æµï¼Œç”¨æ¥ä»£è¡¨ç¡¬ç›˜ä¸­çš„æ–‡ä»¶å’Œå†…å­˜ä¸­çš„æ•°æ®ï¼ˆæ¯”å¦‚ boundariesï¼‰ã€‚</p><p>é€šè¿‡é˜…è¯»æœ€å¥½çš„ç¬¬ä¸‰æ–¹ç½‘ç»œåº“æºä»£ç ï¼Œä½ ä¼šå‘ç° <a href="https://github.com/AFNetworking/AFNetworking" target="_blank" rel="noopener">AFNetworking</a> é‡‡ç”¨äº†<a href="https://github.com/AFNetworking/AFNetworking/blob/009e3bb6673edc183c4f2baf552ad7cccba94d58/AFNetworking/AFURLRequestSerialization.m#L896-L927" target="_blank" rel="noopener">è¿™ç§æ–¹æ³•</a>ã€‚ï¼ˆ<a href="https://github.com/Alamofire/Alamofire" target="_blank" rel="noopener">Alamofire</a>ï¼ŒSwift ç‰ˆæœ¬çš„ AFNetworkingï¼Œåˆ™é‡‡ç”¨äº†ç¬¬ä¸€ç§æ–¹æ³•ï¼Œ<a href="https://github.com/Alamofire/Alamofire/blob/ff16ce9e87aeb0ee1f30b28789db1fff01e8fb02/Source/MultipartFormData.swift#L432-L455" target="_blank" rel="noopener">å°†æ•°æ®å…¨éƒ¨åŠ è½½åˆ°å†…å­˜ä¸­</a>ï¼Œä½†å¦‚æœæ•°æ®é‡å¤ªå¤§ï¼Œå°±ä¼šå†™åˆ°ç¡¬ç›˜çš„ä¸€ä¸ªæ–‡ä»¶ä¸­ã€‚ï¼‰</p><h2 id="å°†æ‰€æœ‰éƒ¨åˆ†æ‹¼æ¥èµ·æ¥"><a href="#å°†æ‰€æœ‰éƒ¨åˆ†æ‹¼æ¥èµ·æ¥" class="headerlink" title="å°†æ‰€æœ‰éƒ¨åˆ†æ‹¼æ¥èµ·æ¥"></a>å°†æ‰€æœ‰éƒ¨åˆ†æ‹¼æ¥èµ·æ¥</h2><p>ä½ å¯ä»¥åœ¨ <a href="https://gist.github.com/khanlou/8cc2e3cb23ec8d03b1fc187f5922e244" target="_blank" rel="noopener">è¿™é‡Œ</a> çœ‹çœ‹æˆ‘çš„ä¸²è¡Œè¾“å…¥æµçš„å®ç°ï¼ˆæ˜¯ç”¨ Objective-C å®ç°çš„ï¼Œä»¥åæˆ‘å¯èƒ½è¿˜ä¼šå†™ä¸€ä¸ª Swift ç‰ˆæœ¬çš„ï¼‰ã€‚</p><p>é€šè¿‡ <code>SKSerialInputStream</code> ç±»ï¼Œå¯ä»¥å°†æµç»„åˆåœ¨ä¸€èµ·ã€‚ä¸‹é¢å±•ç¤ºäº†å‰ç¼€å’Œåç¼€å±æ€§ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">MultipartComponent</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> prefixData: <span class="type">Data</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> string = <span class="string">""</span><span class="string">"</span></span><br><span class="line"><span class="string">        <span class="subst">\(<span class="keyword">self</span>.boundary)</span></span></span><br><span class="line"><span class="string">        Content-Disposition: form-data; name="</span>\(<span class="keyword">self</span>.name); filename=<span class="string">"<span class="subst">\(<span class="keyword">self</span>.filename)</span>"</span></span><br><span class="line">        <span class="string">""</span><span class="string">"</span></span><br><span class="line"><span class="string">        return string.data(using: .utf8)</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    var postfixData: Data &#123;</span></span><br><span class="line"><span class="string">        return "</span>\r\n<span class="string">".data(using: .utf8)</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure><p>å°†å…ƒæ•°æ®å’Œæ–‡ä»¶çš„ <code>dataStream</code> ç»„åˆåœ¨ä¸€èµ·ï¼Œå¾—åˆ°ä¸€æ¡è¾“å…¥æµï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">MultipartComponent</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> inputStream: <span class="type">NSInputStream</span> &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">let</span> streams = [</span><br><span class="line">            <span class="type">NSInputStream</span>(data: prefixData),</span><br><span class="line">            <span class="keyword">self</span>.fileDataStream,</span><br><span class="line">            <span class="type">NSInputStream</span>(data: postfixData),</span><br><span class="line">        ]</span><br><span class="line">    </span><br><span class="line">        <span class="keyword">return</span> <span class="type">SKSerialInputStream</span>(inputStreams: streams)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ›å»ºå¥½æ¯ä¸€éƒ¨åˆ†è¾“å…¥æµä¹‹åï¼Œå°±å¯ä»¥æŠŠæ‰€æœ‰æµç»„åˆåœ¨ä¸€èµ·ï¼Œå¾—åˆ°ä¸€æ¡å®Œæ•´è¾“å…¥æµã€‚æ­¤å¤–ï¼Œåœ¨è¯·æ±‚ç»“å°¾è¿˜éœ€è¦æ·»åŠ ä¸€ä¸ª boundaryï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">RequestBuilder</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> bodyInputStream: <span class="type">NSInputStream</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> stream = parts</span><br><span class="line">            .<span class="built_in">map</span>(&#123; $<span class="number">0</span>.inputStream &#125;)</span><br><span class="line">            + [<span class="type">NSInputStream</span>(data: <span class="string">"--<span class="subst">\(<span class="keyword">self</span>.boundary)</span>--"</span>.data(using: .utf8))]</span><br><span class="line">    </span><br><span class="line">        <span class="keyword">return</span> <span class="type">SKSerialInputStream</span>(inputStreams: streams)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ€åï¼Œå°† <code>bodyInputStream</code> èµ‹å€¼ç»™ URL è¯·æ±‚çš„ <code>httpBodyStream</code> å±æ€§ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> urlRequest = <span class="type">URLRequest</span>(url: url)</span><br><span class="line"></span><br><span class="line">urlRequest.httpBodyStream = requestBuilder.bodyInputStream;</span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼Œ<code>httpBodyStream</code> å’Œ <code>httpBody</code> ä¸¤ä¸ªå±æ€§æ˜¯äº’æ–¥çš„â€”â€”ä¸¤ä¸ªå±æ€§ä¸ä¼šåŒæ—¶ç”Ÿæ•ˆã€‚è®¾ç½® <code>httpBodyStream</code> ä¼šä½¿å¾— <code>Data</code> ç‰ˆæœ¬ <code>httpBody</code> å¤±æ•ˆï¼Œåä¹‹äº¦ç„¶ã€‚</p><p>æµæ–‡ä»¶ä¸Šä¼ çš„å…³é”®æ˜¯èƒ½å¤Ÿå°†å¤šæ¡è¾“å…¥æµåˆå¹¶æˆä¸€æ¡æµã€‚<code>SKSerialInputStream</code> ç±»å®Œæˆäº†æ•´ä¸ªå·¥ä½œã€‚å°½ç®¡è¯´å­ç±»åŒ– <code>NSInputStream</code> æœ‰ä¸€äº›å›°éš¾ï¼Œå¯ä¸€æ—¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å°±ç¦»æˆåŠŸä¸è¿œå•¦ã€‚</p><h2 id="å­ç±»åŒ–è¿‡ç¨‹ä¸­éœ€è¦æ³¨æ„çš„é—®é¢˜"><a href="#å­ç±»åŒ–è¿‡ç¨‹ä¸­éœ€è¦æ³¨æ„çš„é—®é¢˜" class="headerlink" title="å­ç±»åŒ–è¿‡ç¨‹ä¸­éœ€è¦æ³¨æ„çš„é—®é¢˜"></a>å­ç±»åŒ–è¿‡ç¨‹ä¸­éœ€è¦æ³¨æ„çš„é—®é¢˜</h2><p>å­ç±»åŒ– <code>NSInputStream</code> çš„è¿‡ç¨‹ä¸ä¼šå¤ªè½»æ¾ï¼Œç”šè‡³å¯ä»¥è¯´å¾ˆå›°éš¾ã€‚ä½ å¿…é¡»å®ç° 9 ä¸ªæ–¹æ³•ã€‚å…¶ä¸­çš„ 7 ä¸ªæ–¹æ³•ï¼Œçˆ¶ç±»åªæœ‰ä¸€äº›å¾®ä¸è¶³é“çš„é»˜è®¤å®ç°ã€‚è€Œåœ¨æ–‡æ¡£ä¸­åªæåˆ°äº† 9 ä¸ªæ–¹æ³•ä¸­çš„ 3 ä¸ªï¼Œæ‰€ä»¥ä½ è¿˜å¾—å®ç° 6 ä¸ª <code>NSStream</code> ï¼ˆ<code>NSInputStream</code> çš„çˆ¶ç±»ï¼‰çš„æ–¹æ³•ï¼Œå…¶ä¸­æœ‰ 2 ä¸ªæ˜¯ run loop æ–¹æ³•ï¼Œå¹¶å…è®¸ç©ºå®ç°ã€‚åœ¨è¿™ä¹‹å‰ï¼Œä½ è¿˜éœ€è¦é¢å¤– <a href="http://blog.bjhomer.com/2011/04/subclassing-nsinputstream.html" target="_blank" rel="noopener">å®ç° 3 ä¸ªç§æœ‰æ–¹æ³•</a>ï¼Œä¸è¿‡ç°åœ¨ä¸å¿…å®ç°äº†ã€‚æ­¤å¤–ï¼Œè¿˜éœ€è¦å®šä¹‰ 3 ä¸ª<code>åªè¯»</code>å±æ€§ï¼š<code>streamStatus</code>ï¼Œ<code>streamError</code>ï¼Œ<code>delegate</code>ã€‚</p><p>åœ¨å¤„ç†å®Œä¸Šè¿°å­ç±»åŒ–ç›¸å…³çš„ç»†èŠ‚åï¼Œæ¥ä¸‹æ¥çš„æŒ‘æˆ˜æ˜¯åˆ›å»ºä¸€ä¸ª <code>NSInputStream</code> å­ç±»ï¼Œå…¶è¡Œä¸ºåº”è¯¥å’Œ API ä½¿ç”¨è€…æ‰€æœŸæœ›çš„ä¿æŒä¸€è‡´ã€‚ç„¶è€Œï¼Œè¿™ä¸ªç±»çŠ¶æ€çš„é‡åº¦è€¦åˆæ˜¯ä¸å®¹æ˜“è¢«äººå‘ç°çš„ã€‚</p><p>æœ‰ä¸€äº›çŠ¶æ€éœ€è¦ä¿è¯è¡Œä¸ºä¸€è‡´ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œ<code>hasBytesAvailable</code> æ˜¯ä¸åŒäºå…¶å®ƒçŠ¶æ€çš„ï¼Œä½†è¿˜æ˜¯å­˜åœ¨ç»†å¾®çš„è”ç³»ã€‚åœ¨æˆ‘æœ€è¿‘å‘ç°çš„ä¸€ä¸ª bug é‡Œï¼Œ<code>hasBytesAvailable</code> å±æ€§ä¼šè¿”å› <code>self.currentIndex != self.inputStreams.count</code>ï¼Œä½†æ˜¯è¿™ä¼šé€ æˆä¸€ä¸ª bugï¼Œæµä¼šä¸€ç›´å¤„äºå¼€å¯çš„çŠ¶æ€ï¼Œå¹¶æœ€ç»ˆé€ æˆè¯·æ±‚è¶…æ—¶ã€‚ä¿®å¤è¿™ä¸ª bug çš„åŠæ³•æ˜¯æ”¹ä¸ºè¿”å› <code>YES</code>ï¼Œä½†æˆ‘ä¸€ç›´æ²¡æœ‰æ‰¾åˆ°è¿™ä¸ª bug çš„æ ¹æºæ‰€åœ¨ã€‚</p><p>å¦å¤–ä¸€ä¸ªçŠ¶æ€ <code>streamStatus</code>ï¼Œå­˜åœ¨è®¸å¤šå¯èƒ½çš„å€¼ï¼Œå…¶ä¸­æ¯”è¾ƒé‡è¦çš„ä¸¤ä¸ªå€¼æ˜¯ <code>NSStreamStatusOpen</code> å’Œ <code>NSStreamStatusClosed</code>ã€‚</p><p>æœ€åä¸€ä¸ªæ¯”è¾ƒæœ‰æ„æ€çš„çŠ¶æ€æ˜¯å­—èŠ‚æ•°ï¼Œä» <code>read</code> æ–¹æ³•ä¸­è¿”å›å€¼ã€‚è¿™ä¸ªå±æ€§é™¤äº†ä¼šè¿”å›æ­£æ•´å‹æ•°ä¹‹å¤–ï¼Œè¿˜ä¼šè¿”å› -1ï¼Œ-1 ä»£è¡¨æœ‰é”™è¯¯äº§ç”Ÿï¼Œéœ€è¦è¿›ä¸€æ­¥æ£€æŸ¥éç©ºå±æ€§ <code>streamError</code> æ¥è·å–æ›´å¤šä¿¡æ¯ã€‚å­—èŠ‚æ•°è¿˜å¯ä»¥è¿”å› 0ï¼Œæ ¹æ®æ–‡æ¡£æè¿°ï¼Œè¿™æ˜¯æ ‡æ˜æµç»“å°¾çš„å¦å¤–ä¸€ç§æ–¹å¼ã€‚</p><p>æ–‡æ¡£å¹¶ä¸ä¼šå‘Šè¯‰ä½ å“ªäº›çŠ¶æ€çš„ç»„åˆæ˜¯æœ‰æ„ä¹‰çš„ã€‚æ¯”å¦‚è¯´æµäº§ç”Ÿä¸€ä¸ª <code>streamError</code>ï¼Œä½†çŠ¶æ€å´æ˜¯ <code>NSStreamStatusClosed</code>ï¼Œè€Œä¸æ˜¯ <code>NSStreamStatusError</code>ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹æ˜¯å¦ä¼šæœ‰é—®é¢˜ï¼Ÿæƒ³è¦ç®¡ç†å¥½æ‰€æœ‰çš„çŠ¶æ€éå¸¸éš¾ï¼Œä¸è¿‡åˆ°æœ€åç»ˆç©¶è¿˜æ˜¯èƒ½è§£å†³çš„ã€‚</p><p>å¯¹äº <code>SKSerialStream</code> ç±»ï¼Œæ˜¯å¦å¯ä»¥åœ¨æ‰€æœ‰æƒ…å†µä¸‹éƒ½èƒ½æ­£å¸¸å·¥ä½œï¼Œæˆ‘è¿˜ä¸æ˜¯ç‰¹åˆ«æœ‰ä¿¡å¿ƒã€‚ä½†çœ‹èµ·æ¥ï¼Œ<code>SKSerialStream</code> é€šè¿‡ä½¿ç”¨ URLSession èƒ½å¾ˆå¥½åœ°æ”¯æŒä¸Šä¼  multipart æ•°æ®ã€‚å¦‚æœä½ åœ¨ä½¿ç”¨è¿™ä»½ä»£ç çš„æ—¶å€™å‘ç°ä»»ä½•é—®é¢˜ï¼Œè¯·åŠ¡å¿…è”ç³»æˆ‘ï¼Œæˆ‘ä»¬å¯ä»¥ä¸€èµ·ä¸æ–­ä¼˜åŒ–è¿™ä¸ªç±»ã€‚</p><blockquote><p>æœ¬æ–‡ç”± SwiftGG ç¿»è¯‘ç»„ç¿»è¯‘ï¼Œå·²ç»è·å¾—ä½œè€…ç¿»è¯‘æˆæƒï¼Œæœ€æ–°æ–‡ç« è¯·è®¿é—® <a href="http://swift.gg">http://swift.gg</a>ã€‚</p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;ä½œè€…ï¼šSoroush Khanlouï¼Œ&lt;a href=&quot;http://khanlou.com/2018/11/streaming-multipart-requests/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;åŸæ–‡é“¾æ¥&lt;/a&gt;ï¼ŒåŸæ–‡æ—¥æœŸï¼š2018-11-14&lt;br&gt;è¯‘è€…ï¼š&lt;a href=&quot;https://www.jianshu.com/u/076cc5e18bb8&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;éƒ‘ä¸€ä¸€&lt;/a&gt;ï¼›æ ¡å¯¹ï¼š&lt;a href=&quot;http://numbbbbb.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;numbbbbb&lt;/a&gt;ï¼Œ&lt;a href=&quot;http://www.jianshu.com/users/596f2ba91ce9/latest_articles&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;pmst&lt;/a&gt;ï¼›å®šç¨¿ï¼š&lt;a href=&quot;http://forelax.space&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Forelax&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;!--æ­¤å¤„å¼€å§‹æ­£æ–‡--&gt;
&lt;p&gt;Foundation æ¡†æ¶ä¸­çš„ URL ç±»æä¾›äº†éå¸¸å…¨é¢çš„åŠŸèƒ½ï¼Œæ­¤åè¿˜åœ¨ iOS 7 ä¸­æ–°å¢äº† URLSession ç±»ã€‚å°½ç®¡å¦‚æ­¤ï¼ŒåŸºç¡€åº“ä¸­ä»ç„¶ç¼ºå°‘ multipart æ–‡ä»¶ä¸Šä¼ çš„åŠŸèƒ½ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="Khanlou" scheme="https://swift.gg/categories/Khanlou/"/>
    
    
      <category term="iOS å¼€å‘" scheme="https://swift.gg/tags/iOS-%E5%BC%80%E5%8F%91/"/>
    
      <category term="Swift" scheme="https://swift.gg/tags/Swift/"/>
    
      <category term="Objective-C" scheme="https://swift.gg/tags/Objective-C/"/>
    
  </entry>
  
  <entry>
    <title>Language Server Protocol</title>
    <link href="https://swift.gg/2019/01/15/nshipster-language-server-protocol/"/>
    <id>https://swift.gg/2019/01/15/nshipster-language-server-protocol/</id>
    <published>2019-01-15T00:00:00.000Z</published>
    <updated>2019-02-19T03:45:15.660Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ä½œè€…ï¼šMatttï¼Œ<a href="https://nshipster.com/language-server-protocol/" target="_blank" rel="noopener">åŸæ–‡é“¾æ¥</a>ï¼ŒåŸæ–‡æ—¥æœŸï¼š2018-11-19<br>è¯‘è€…ï¼š<a href="https://github.com/mobilefellow" target="_blank" rel="noopener">é›¨è°¨</a>ï¼›æ ¡å¯¹ï¼š<a href="http://numbbbbb.com/" target="_blank" rel="noopener">numbbbbb</a>ï¼Œ<a href="http://www.jianshu.com/users/596f2ba91ce9/latest_articles" target="_blank" rel="noopener">pmst</a>ï¼›å®šç¨¿ï¼š<a href="http://forelax.space" target="_blank" rel="noopener">Forelax</a></p></blockquote><!--æ­¤å¤„å¼€å§‹æ­£æ–‡--><p>ä¸Šä¸ªæœˆï¼Œè‹¹æœå…¬å¸ <a href="https://forums.swift.org/t/new-lsp-language-service-supporting-swift-and-c-family-languages-for-any-editor-and-platform/17024" target="_blank" rel="noopener">åœ¨ Swift.org è®ºå›ä¸Šå®£å¸ƒ</a>ï¼Œæ­£åœ¨ç€æ‰‹ä¸º Swift å’Œ C è¯­è¨€æ”¯æŒ <a href="https://microsoft.github.io/language-server-protocol/" target="_blank" rel="noopener">Language Server Protocol</a>ï¼ˆè¯­è¨€æœåŠ¡å™¨åè®®ï¼ŒLSPï¼‰ã€‚</p><blockquote><p>å¯¹äºè‹¹æœå…¬å¸è€Œè¨€ï¼Œä¸ºæ‰€æœ‰ Swift å¼€å‘è€… â€”â€” åŒ…æ‹¬éè‹¹æœå¹³å°ä¸Šçš„ â€”â€” æä¾›é«˜è´¨é‡çš„å·¥å…·æ”¯æŒéå¸¸é‡è¦ã€‚æˆ‘ä»¬å¸Œæœ›ä¸å¼€æºç¤¾åŒºåˆä½œï¼Œå°†ç²¾åŠ›é›†ä¸­åœ¨æ„å»º Xcode å’Œå…¶ä»–ç¼–è¾‘å™¨ã€å…¶ä»–å¹³å°å¯ä»¥å…±äº«çš„å…¬å…±åŸºç¡€è®¾æ–½ä¸Šã€‚ä¸ºå®ç°è¿™ä¸€ç›®æ ‡ï¼Œ[â€¦â€¦]ï¼Œæˆ‘ä»¬å†³å®šæ”¯æŒ LSPã€‚</p><p><em>Argyrios Kyrtzidisï¼Œ2018 å¹´ 10 æœˆ 15 æ—¥</em></p></blockquote><p><strong>è¿™å¯èƒ½æ˜¯è‹¹æœè‡ª 2014 å¹´å°† Swift ä½œä¸ºå¼€æºè½¯ä»¶å‘å¸ƒä»¥æ¥ï¼Œä¸º Swift åšå‡ºçš„æœ€é‡è¦çš„å†³å®šã€‚</strong> è¿™å¯¹äº APP å¼€å‘è€…æ¥è¯´æ˜¯ä¸€ä»¶å¤§äº‹ï¼Œå¯¹äºå…¶ä»–å¹³å°ä¸Šçš„ Swift å¼€å‘è€…æ¥è¯´æ›´æ˜¯ä¸€ä»¶å¤§äº‹ã€‚</p><p>ä¸ºäº†ç†è§£å…¶ä¸­çš„åŸå› ï¼Œæœ¬å‘¨çš„æ–‡ç« å°†ç ”ç©¶ Language Server Protocol è§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Œå®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Œä»¥åŠå®ƒçš„é•¿æœŸå½±å“å¯èƒ½æ˜¯ä»€ä¹ˆã€‚</p><a id="more"></a><blockquote><p><strong>æ›´æ–°</strong>ï¼šsourcekit-lsp é¡¹ç›®ç°åœ¨å·²ç»å¯ä»¥ <a href="https://github.com/apple/sourcekit-lsp" target="_blank" rel="noopener">åœ¨ GitHub ä¸Šè®¿é—®</a> äº†ã€‚</p></blockquote><hr><p>æƒ³è±¡è¿™æ ·ä¸€ä¸ªçŸ©é˜µï¼Œæ¯ä¸€è¡Œè¡¨ç¤ºä¸åŒçš„ç¼–ç¨‹è¯­è¨€ï¼ˆSwiftã€JavaScriptã€Rubyã€Python ç­‰ï¼‰ï¼Œæ¯ä¸€åˆ—è¡¨ç¤ºä¸åŒçš„ä»£ç ç¼–è¾‘å™¨ï¼ˆXcodeã€Visual Studioã€Vimã€Atom ç­‰ï¼‰ï¼Œè¿™æ ·æ¯ä¸ªå•å…ƒæ ¼è¡¨ç¤ºç‰¹å®šç¼–è¾‘å™¨å¯¹ä¸€ç§è¯­è¨€çš„æ”¯æŒçº§åˆ«ã€‚</p><p><img src="https://nshipster.com/assets/lsp-languages-times-editors-b9a398af0dea85f2ad6dcf5412fbcb451a43bc90091d5e3ab3b1140da9926b3e.svg" alt="lsp-languages-times-editors.svg"></p><p>ç„¶åï¼Œä½ å°±å‘ç°å„ç§ç»„åˆå½¢æˆäº†ä¸€ç§æ”¯ç¦»ç ´ç¢çš„å…¼å®¹ã€‚æœ‰äº›ç¼–è¾‘å™¨å’Œéƒ¨åˆ†è¯­è¨€æ·±åº¦é›†æˆï¼Œä½†é™¤æ­¤ä¹‹å¤–å‡ ä¹ä»€ä¹ˆéƒ½å¹²ä¸äº†ï¼›å…¶ä»–ç¼–è¾‘å™¨åˆ™æ¯”è¾ƒé€šç”¨ï¼Œå¯¹å¾ˆå¤šè¯­è¨€éƒ½æä¾›äº†åŸºæœ¬çš„æ”¯æŒã€‚ï¼ˆIDE è¿™ä¸ªæœ¯è¯­é€šå¸¸ç”¨æ¥æè¿°å‰è€…ã€‚)</p><p>ä¸¾ä¸ªå¥‡è‘©çš„ä¾‹å­ï¼š<em>ä½ ä¸ç”¨ Xcode æ¥å¼€å‘ APPï¼Œå´åç”¨æ¥å¹²å…¶ä»–äº‹æƒ…ã€‚</em></p><p>ä¸ºäº†æ›´å¥½åœ°æ”¯æŒæŸä¸€ç‰¹å®šçš„è¯­è¨€ï¼Œç¼–è¾‘å™¨å¿…é¡»ç¼–å†™ä¸€äº›é›†æˆä»£ç ï¼ˆintegration codeï¼‰â€”â€” è¦ä¹ˆç›´æ¥å†™åœ¨é¡¹ç›®é‡Œï¼Œè¦ä¹ˆé€šè¿‡æ’ä»¶ã€‚ç”±äºä¸åŒè¯­è¨€å’Œç¼–è¾‘å™¨çš„å®ç°æœºåˆ¶ä¸ä¸€æ ·ï¼Œå› æ­¤æ¯”æ–¹è¯´ Vim æ”¹è¿›äº†å¯¹ Ruby æ”¯æŒï¼Œä½†è¿™å¹¶ä¸èƒ½è®©å®ƒæ›´å¥½åœ°æ”¯æŒ Pythonï¼Œä¹Ÿä¸èƒ½è®© Ruby åœ¨ Atom ä¸Šè¿è¡Œåœ°æ›´å¥½ã€‚æœ€ç»ˆçš„ç»“æœæ˜¯ï¼šå¤§é‡ç²¾åŠ›æµªè´¹åœ¨äº†ä¸åŒæŠ€æœ¯çš„å…¼å®¹ä¸Šã€‚</p><p>æˆ‘ä»¬ä¸Šé¢æè¿°çš„æƒ…å†µé€šå¸¸è¢«ç§°ä¸º <em>M Ã— N é—®é¢˜</em>ï¼Œå³æœ€ç»ˆçš„é›†æˆæ–¹æ¡ˆæ•°é‡ä¸ºç¼–è¯‘å™¨æ•°é‡ M ä¸è¯­è¨€æ•°é‡ N çš„ä¹˜ç§¯ã€‚Language Server Protocol æ‰€åšçš„äº‹æƒ…å°±æ˜¯å°† M Ã— N é—®é¢˜å˜æˆ <em>M + N é—®é¢˜</em>ã€‚</p><p>ç¼–è¾‘å™¨ä¸å¿…å®ç°å¯¹æ¯ç§è¯­è¨€çš„æ”¯æŒï¼Œåªéœ€æ”¯æŒ LSP å³å¯ã€‚ä¹‹åï¼Œå®ƒå°±èƒ½åŒç­‰ç¨‹åº¦åœ°æ”¯æŒæ‰€æœ‰æ”¯æŒ LSP çš„è¯­è¨€ã€‚</p><p><img src="https://nshipster.com/assets/lsp-languages-plus-editors-904f780fa4a21e89b5b00bfe5fca39795dd54c1c4c67acf3f0fe095aaf09064d.svg" alt="lsp-languages-plus-editors.svg"></p><blockquote><p>Tomohiro Matsuyama åœ¨ 2010 å¹´å†™çš„ <a href="https://tkf.github.io/2013/06/04/Emacs-is-dead.html" target="_blank" rel="noopener">â€œEmacs ã¯æ­»ã‚“ã â€ (<em>â€œEmacs å·²æ­»â€</em>)</a> è¿™ç¯‡æ–‡ç« å°±å¯¹è¿™ç§é—®é¢˜åšå‡ºäº†ä¸€ä¸ªå¾ˆå¥½çš„è®ºè¿°ã€‚Matsuyama æè¿°äº† Emacs è„šæœ¬è¯­è¨€çš„å±€é™æ€§ï¼ˆä¸æ”¯æŒå¤šçº¿ç¨‹ã€åº•å±‚ API è¿‡å°‘ã€ç”¨æˆ·åŸºæ•°å¤ªå°ï¼‰ï¼Œä»–è®¤ä¸ºç¼–å†™æ’ä»¶çš„é¦–é€‰æ–¹æ³•åº”è¯¥æ˜¯ä¸å¤–éƒ¨ç¨‹åºè¿›è¡Œäº¤äº’ï¼Œè€Œä¸æ˜¯åŸç”Ÿå®ç°ã€‚</p></blockquote><p>Language Server Protocol ä¸ºæ”¯æŒçš„è¯­è¨€æä¾›äº†ä¸€å¥—é€šç”¨çš„åŠŸèƒ½é›†ï¼ŒåŒ…æ‹¬ï¼š</p><ul><li>è¯­æ³•é«˜äº®ï¼ˆSyntax Highlightingï¼‰</li><li>è‡ªåŠ¨æ ¼å¼åŒ–ï¼ˆAutomatic Formattingï¼‰</li><li>è‡ªåŠ¨è¡¥å…¨ï¼ˆAutocompleteï¼‰</li><li>è¯­æ³•ï¼ˆSyntaxï¼‰</li><li>å·¥å…·æç¤ºï¼ˆTooltipsï¼‰</li><li>å†…è”è¯Šæ–­ï¼ˆInline Diagnosticsï¼‰</li><li>è·³è½¬åˆ°å®šä¹‰ï¼ˆJump to Definitionï¼‰</li><li>é¡¹ç›®å†…æŸ¥æ‰¾å¼•ç”¨ï¼ˆFind References in Projectï¼‰</li><li>é«˜çº§æ–‡æœ¬å’Œç¬¦å·æœç´¢ï¼ˆAdvanced Text and Symbol Searchï¼‰</li></ul><p>å„ç§å·¥å…·å’Œç¼–è¾‘å™¨å¯ä»¥å°†ç²¾åŠ›ç”¨äºæå‡å¯ç”¨æ€§å’Œæä¾›æ›´é«˜çº§çš„åŠŸèƒ½ï¼Œè€Œä¸æ˜¯ä¸ºæ¯ç§æ–°æŠ€æœ¯å†é€ ä¸ªè½®å­ã€‚</p><h2 id="Language-Server-Protocol-çš„å·¥ä½œåŸç†"><a href="#Language-Server-Protocol-çš„å·¥ä½œåŸç†" class="headerlink" title="Language Server Protocol çš„å·¥ä½œåŸç†"></a>Language Server Protocol çš„å·¥ä½œåŸç†</h2><p>å¦‚æœä½ æ˜¯ä¸€ä¸ª iOS ç¨‹åºå‘˜ï¼Œé‚£ä¹ˆä¸€å®šå¾ˆç†Ÿæ‚‰ <em>server</em> å’Œ <em>protocol</em> è¿™ä¸¤ä¸ªæœ¯è¯­åœ¨ Web åº”ç”¨ç¨‹åºçš„ HTTP + JSON é€šä¿¡åœºæ™¯ä¸‹çš„å«ä¹‰ã€‚å®é™…ä¸Š Language Server Protocol å·®ä¸å¤šä¹Ÿæ˜¯è¿™ä¹ˆå·¥ä½œçš„ã€‚</p><p>å¯¹äº LSPï¼Œ<em>client</em> æ˜¯æŒ‡ç¼–è¾‘å™¨ â€”â€” æˆ–è€…æ›´å®½æ³›ä¸€ç‚¹ï¼Œæ˜¯æŒ‡å·¥å…·ï¼Œ<em>server</em> æ˜¯æŒ‡æœ¬åœ°ç‹¬ç«‹è¿›ç¨‹é‡Œè¿è¡Œçš„ä¸€ä¸ªå¤–éƒ¨ç¨‹åºã€‚</p><p>è‡³äºåå­—ä¸­åŒ…å« <em>protocol</em>ï¼Œæ˜¯å› ä¸º LSP ç±»ä¼¼äºä¸€ä¸ªç²¾ç®€ç‰ˆçš„ HTTPï¼š</p><ul><li>æ¯ä¸ªæ¶ˆæ¯éƒ½ç”±æŠ¥å¤´éƒ¨åˆ†å’Œå†…å®¹éƒ¨åˆ†ç»„æˆã€‚</li><li>æŠ¥å¤´éƒ¨åˆ†åŒ…å«ä¸€ä¸ªå¿…å¡«çš„ <code>Content-Length</code> å­—æ®µï¼Œç”¨äºè¯´æ˜å†…å®¹éƒ¨åˆ†çš„å¤§å°ï¼ˆä»¥å­—èŠ‚ä¸ºå•ä½ï¼‰ï¼Œä»¥åŠä¸€ä¸ªå¯é€‰çš„ <code>Content-Type</code> å­—æ®µï¼ˆé»˜è®¤å€¼ä¸º <code>application/vscode-jsonrpc; charset=utf-8</code>ï¼‰ã€‚</li><li>å†…å®¹éƒ¨åˆ†ä½¿ç”¨ <a href="https://www.jsonrpc.org/specification" target="_blank" rel="noopener">JSON-RPC</a> æè¿°è¯·æ±‚ã€å“åº”å’Œé€šçŸ¥çš„ç»“æ„ã€‚</li></ul><p>æ¯å½“å·¥å…·ä¸­å‘ç”Ÿäº†ä»€ä¹ˆäº‹æƒ…ï¼Œæ¯”å¦‚ç”¨æˆ·éœ€è¦è·³è½¬åˆ°ç¬¦å·çš„å®šä¹‰ï¼Œå·¥å…·å°±ä¼šå‘ server å‘é€ä¸€ä¸ªè¯·æ±‚ã€‚server æ¥æ”¶åˆ°è¯¥è¯·æ±‚ï¼Œç„¶åè¿”å›é€‚å½“çš„å“åº”ã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Parent</span> </span>&#123;&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Child</span>: <span class="title">Parent</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure><p><img src="https://nshipster.com/assets/lsp-jump-to-definition-f76ae15d897ab30706c101e7300cd299ad97f6b910ed79ce4890351c2805ae56.gif" alt="lsp-jump-to-definition.gif"></p><p>ä»¥ä¸‹æ˜¯ LSP å¦‚ä½•åœ¨å¹•åå®ç°è¿™ç§äº¤äº’ï¼š</p><p>é¦–å…ˆï¼Œå½“ç”¨æˆ·æ‰“å¼€ Swift ä»£ç æ—¶ï¼Œè‹¥ Swift language server å¹¶æœªè¿è¡Œï¼Œç¼–è¾‘å™¨å°†åœ¨ä¸€ä¸ªç‹¬ç«‹è¿›ç¨‹ä¸­å¯åŠ¨å®ƒï¼Œå¹¶æ‰§è¡Œä¸€äº›é¢å¤–çš„é…ç½®ã€‚</p><p>å½“ç”¨æˆ·æ‰§è¡Œ â€œè·³è½¬åˆ°å®šä¹‰ï¼ˆjump to definitionï¼‰â€ æŒ‡ä»¤æ—¶ï¼Œç¼–è¾‘å™¨å‘ Swift language server å‘é€ä»¥ä¸‹è¯·æ±‚ï¼š</p><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"jsonrpc"</span>: <span class="string">"2.0"</span>,</span><br><span class="line">  <span class="attr">"id"</span>: <span class="number">1</span>,</span><br><span class="line">  <span class="attr">"method"</span>: <span class="string">"textDocument/definition"</span>,</span><br><span class="line">  <span class="attr">"params"</span>: &#123;</span><br><span class="line">    <span class="attr">"textDocument"</span>: &#123;</span><br><span class="line">      <span class="attr">"uri"</span>: <span class="string">"file:///Users/NSHipster/Example.swift"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"position"</span>: &#123;</span><br><span class="line">      <span class="attr">"line"</span>: <span class="number">1</span>,</span><br><span class="line">      <span class="attr">"character"</span>: <span class="number">13</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ”¶åˆ°è¿™ä¸ªè¯·æ±‚åï¼ŒSwift language server ä½¿ç”¨ <a href="https://github.com/apple/swift/tree/master/tools/SourceKit" target="_blank" rel="noopener">SourceKit</a> ç­‰ç¼–è¯‘å™¨å·¥å…·æ¥æ ‡è¯†ç›¸åº”çš„ä»£ç å®ä½“ï¼Œå¹¶åœ¨ä»£ç çš„ä¸Šä¸€è¡Œæ‰¾åˆ°å…¶å£°æ˜çš„ä½ç½®ã€‚ç„¶å language server ç”¨ä»¥ä¸‹æ¶ˆæ¯è¿›è¡Œå“åº”:</p><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"jsonrpc"</span>: <span class="string">"2.0"</span>,</span><br><span class="line">  <span class="attr">"id"</span>: <span class="number">1</span>,</span><br><span class="line">  <span class="attr">"result"</span>: &#123;</span><br><span class="line">    <span class="attr">"uri"</span>: <span class="string">"file:///Users/NSHipster/Example.swift"</span>,</span><br><span class="line">    <span class="attr">"range"</span>: &#123;</span><br><span class="line">      <span class="attr">"start"</span>: &#123;</span><br><span class="line">        <span class="attr">"line"</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">"character"</span>: <span class="number">6</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">"end"</span>: &#123;</span><br><span class="line">        <span class="attr">"line"</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">"character"</span>: <span class="number">12</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ€åï¼Œç¼–è¾‘å™¨å¯¼èˆªåˆ°æ–‡ä»¶(åœ¨æœ¬ä¾‹ä¸­ï¼Œè¯¥æ–‡ä»¶å·²ç»æ‰“å¼€)ï¼Œå°†å…‰æ ‡ç§»åŠ¨åˆ°è¯¥èŒƒå›´ï¼Œå¹¶é«˜äº®æ˜¾ç¤ºå‡ºæ¥ã€‚</p><p>è¿™ç§æ–¹æ³•çš„ç¾å¦™ä¹‹å¤„åœ¨äºï¼Œç¼–è¾‘å™¨å®Œæˆæ‰€æœ‰è¿™äº›æ“ä½œæ—¶ï¼Œé™¤äº† .swift æ–‡ä»¶ä¸ Swift ä»£ç ç›¸å…³ä»¥å¤–ï¼Œå¯¹ Swift ç¼–ç¨‹è¯­è¨€ä¸€æ— æ‰€çŸ¥ã€‚ç¼–è¾‘å™¨éœ€è¦åšçš„å°±æ˜¯ä¸ language server å¯¹è¯å¹¶æ›´æ–° UIã€‚è€Œä¸”ç¼–è¾‘å™¨çŸ¥é“å¦‚ä½•åšåˆ°è¿™ä¸€ç‚¹åï¼Œå°±å¯ä»¥éµå¾ªç›¸åŒçš„è¿‡ç¨‹ï¼Œä¸ä»»ä½•å¸¦æœ‰ language server çš„è¯­è¨€æ‰€ç¼–å†™çš„ä»£ç è¿›è¡Œäº¤äº’ã€‚</p><h2 id="Clang-LLVM-é‡Œçš„-Language-Server-Protocol"><a href="#Clang-LLVM-é‡Œçš„-Language-Server-Protocol" class="headerlink" title="Clang / LLVM é‡Œçš„ Language Server Protocol"></a>Clang / LLVM é‡Œçš„ Language Server Protocol</h2><p>å¦‚æœä½ è§‰å¾—ä¹‹å‰çš„ <em>M + N</em> å›¾æœ‰ç‚¹çœ¼ç†Ÿï¼Œé‚£å¯èƒ½æ˜¯å› ä¸º LLVM ä¹Ÿé‡‡ç”¨äº†åŒæ ·çš„æ–¹æ³•ã€‚</p><p>LLVM çš„æ ¸å¿ƒæ˜¯ä¸­é—´è¡¨ç¤ºï¼ˆintermediate representationï¼ŒIRï¼‰ã€‚LLVM æ‰€æ”¯æŒçš„è¯­è¨€ä½¿ç”¨ <em>ç¼–è¯‘å™¨å‰ç«¯ï¼ˆcompiler frontendï¼‰</em> ç”Ÿæˆ IRï¼Œå†ä½¿ç”¨ <em>ç¼–è¯‘å™¨åç«¯ï¼ˆcompiler backendï¼‰</em> å°† IR ç”Ÿæˆæ‰€æ”¯æŒå¹³å°çš„æœºå™¨ç ã€‚</p><p><img src="https://nshipster.com/assets/lsp-llvm-ir-34a10847cbe6519370c1b5e92def8f82b2ebde71aa2440c88880283bd5cbaf0a.svg" alt="lsp-llvm-ir.svg"></p><blockquote><p>å¦‚æœä½ æƒ³äº†è§£ Swift ä»£ç ç¼–è¯‘çš„æ›´å¤šç»†èŠ‚ï¼Œè¯·æŸ¥çœ‹ <a href="https://nshipster.com/swiftsyntax/" target="_blank" rel="noopener">æˆ‘ä»¬å…³äº SwiftSyntax çš„æ–‡ç« </a>ã€‚</p></blockquote><p><a href="https://clang.llvm.org" target="_blank" rel="noopener">Clang</a> æ˜¯ C è¯­è¨€çš„ LLVM ç¼–è¯‘å™¨å‰ç«¯ã€‚Swift ä¸ Objective-C çš„äº’æ“ä½œæ€§ï¼ˆinter-operabilityï¼‰å°±æ˜¯é å®ƒå®ç°çš„ã€‚åœ¨æœ€è¿‘çš„ 5.0.0 ç‰ˆæœ¬ä¸­ï¼ŒClang æ·»åŠ äº†ä¸€ä¸ªåä¸º <a href="https://clang.llvm.org/extra/clangd.html" target="_blank" rel="noopener">Clangd</a> çš„æ–°å·¥å…·ï¼Œå®ƒæ˜¯ LLVM å¯¹ Language Server Protocol çš„å®ç°ã€‚</p><p>2018 å¹´ 4 æœˆï¼Œ<a href="http://lists.llvm.org/pipermail/cfe-dev/2018-April/057668.html" target="_blank" rel="noopener">è‹¹æœå…¬å¸å‘ LLVM é‚®ä»¶ç»„å®£å¸ƒ</a>ï¼Œå°†æŠŠå¼€å‘çš„é‡å¿ƒä» <a href="https://clang.llvm.org/doxygen/group__CINDEX.html" target="_blank" rel="noopener">libclang</a> è½¬å‘ Clangdï¼Œä»¥å…¶ä½œä¸ºåˆ›å»ºäº¤äº’å·¥å…·çš„ä¸»è¦æ–¹å¼ã€‚</p><p>ç°åœ¨ä½ å¯èƒ½ä¼šæƒ³ï¼Œ<em>â€œé‚£åˆæ€æ ·ï¼Ÿâ€</em> è‹¹æœå…¬å¸æ˜¯ LLVM é¡¹ç›®æœ€é‡è¦çš„æ”¯æŒè€…ä¹‹ä¸€ï¼Œè¯¥é¡¹ç›®åˆ›å§‹äºº Chris Lattner å·²ç»åœ¨è‹¹æœå…¬å¸å·¥ä½œäº†åå¤šå¹´ã€‚è‹¹æœå…¬å¸å†³å®šä»ä¸é€æ˜çš„ Clang å·¥å…·åˆ‡æ¢åˆ°å¦ä¸€ä¸ªï¼Œä¼¼ä¹æ˜¯ä¸€ä¸ªå®ç°ç»†èŠ‚äº†(å¯ä»¥è¿™ä¹ˆè¯´)ã€‚</p><p>è¿™ä¸ªå®˜å®£å¾ˆæœ‰è¶£çš„ä¸€ç‚¹æ˜¯ï¼ŒClangd ä¼¼ä¹å®Œå…¨æ˜¯åœ¨è‹¹æœä»¥å¤–å¼€å‘çš„ï¼Œè°·æ­Œå’Œå…¶ä»–å…¬å¸ä¹Ÿåšå‡ºäº†é‡å¤§è´¡çŒ®ã€‚è¿™ä¸ªå®˜å®£æ ‡å¿—ç€æœªæ¥å·¥å…·å¼€å‘æ–¹å‘çš„é‡å¤§è½¬å˜ â€”â€” å…­ä¸ªæœˆå Swift.org è®ºå›å°†è¯å®è¿™ä¸€ç‚¹ã€‚</p><h2 id="è‹¹æœæ”¯æŒ-Language-Server-Protocol-çš„æ½œåœ¨å½±å“"><a href="#è‹¹æœæ”¯æŒ-Language-Server-Protocol-çš„æ½œåœ¨å½±å“" class="headerlink" title="è‹¹æœæ”¯æŒ Language Server Protocol çš„æ½œåœ¨å½±å“"></a>è‹¹æœæ”¯æŒ Language Server Protocol çš„æ½œåœ¨å½±å“</h2><p>æ ¹æ®è‹¹æœå…¬å¸ 10 æœˆä»½å‘å¸ƒçš„ LSP å…¬å‘Šï¼Œæˆ‘ä»¬é¢„è®¡åœ¨æœªæ¥å‡ å‘¨å†…ï¼ˆæ’°å†™æœ¬æ–‡æ—¶ï¼Œæœ€æ—© 11 æœˆä¸­æ—¬ï¼‰å°†çœ‹åˆ°è¯¥é¡¹ç›®çš„é¦–æ‰¹ä»£ç ã€‚</p><p>è¦æ„Ÿå—è¿™äº›å‘å±•çš„å…¨éƒ¨å½±å“è¿˜éœ€è¦ä¸€äº›æ—¶é—´ï¼Œä½†è¯·ç›¸ä¿¡æˆ‘ï¼šä½ çš„è€å¿ƒæ˜¯å€¼å¾—çš„ã€‚æˆ‘ç›¸ä¿¡ä»¥ä¸‹æ˜¯ LSP åœ¨æœªæ¥å‡ ä¸ªæœˆå’Œå‡ å¹´å°†ä¼šå‘ç”Ÿçš„ä¸€äº›äº‹æƒ…ã€‚</p><h3 id="Swift-å˜æˆä¸€ç§æ›´åŠ é€šç”¨çš„ç¼–ç¨‹è¯­è¨€"><a href="#Swift-å˜æˆä¸€ç§æ›´åŠ é€šç”¨çš„ç¼–ç¨‹è¯­è¨€" class="headerlink" title="Swift å˜æˆä¸€ç§æ›´åŠ é€šç”¨çš„ç¼–ç¨‹è¯­è¨€"></a>Swift å˜æˆä¸€ç§æ›´åŠ é€šç”¨çš„ç¼–ç¨‹è¯­è¨€</h3><p>è™½ç„¶ Swift ä¸»è¦ç”¨äº APP å¼€å‘ï¼Œä½†å®ƒä»ä¸€å¼€å§‹å°±è¢«è®¾è®¡æˆä¸€ç§åŠŸèƒ½å¼ºå¤§çš„é€šç”¨ç¼–ç¨‹è¯­è¨€ã€‚åœ¨ <a href="https://www.tensorflow.org/swift/" target="_blank" rel="noopener">Swift for TensorFlow</a>ã€<br><a href="https://github.com/apple/swift-nio" target="_blank" rel="noopener">SwiftNIO</a> å’Œå…¶ä»–é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬æ­£å¼€å§‹çœ‹åˆ° Swift æ‰¿è¯ºçš„åœ¨ App Store ä¹‹å¤–çš„ä½¿ç”¨ã€‚</p><p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œé˜»ç¢ Swift è¢«ä¸»æµé‡‡ç”¨çš„æœ€å¤§å› ç´ ä¹‹ä¸€æ˜¯å®ƒå¯¹ Xcode çš„ä¾èµ–ã€‚</p><p>äººä»¬ä¼šæœ‰å¾ˆå¤šè´¨ç–‘ï¼Œå½“æœ‰é‚£ä¹ˆå¤šä¼˜ç§€çš„ã€é—¨æ§›ä½å¾ˆå¤šçš„æ›¿ä»£æ–¹æ¡ˆå¯é€‰çš„æƒ…å†µä¸‹ï¼Œä¸ºä»€ä¹ˆè¿˜è¦è®© Web å¼€å‘è€…æˆ–æœºå™¨å­¦ä¹ å·¥ç¨‹å¸ˆä»…ä»…ä¸ºäº†å°è¯• Swift è€Œå»ä¸‹è½½ Xcodeï¼Ÿæ”¯æŒ Language Server Protocol å¯ä»¥è®©è‹¹æœç”Ÿæ€åœˆä»¥å¤–çš„äººæ›´å®¹æ˜“åœ°ä½¿ç”¨ä»–ä»¬ç†Ÿæ‚‰å·¥å…·å»æ„Ÿå— Swiftã€‚</p><h3 id="Xcode-å˜å¾—æ›´å¥½"><a href="#Xcode-å˜å¾—æ›´å¥½" class="headerlink" title="Xcode å˜å¾—æ›´å¥½"></a>Xcode å˜å¾—æ›´å¥½</h3><p>æ”¯æŒ LSP ä¸ä»…ä»…æ˜¯è®© Swift åœ¨å…¶ä»–ç¼–è¾‘å™¨ä¸­è¿è¡Œåœ°æ›´å¥½ï¼ŒXcode ä¹Ÿå°†å—ç›ŠåŒªæµ…ã€‚</p><p>çœ‹çœ‹è‹¹æœ Swift é¡¹ç›®è´Ÿè´£äºº Ted Kremenek çš„ <a href="https://forums.swift.org/t/new-lsp-language-service-supporting-swift-and-c-family-languages-for-any-editor-and-platform/17024/29" target="_blank" rel="noopener">è¿™ç¯‡è®ºå›å¸–å­</a>:</p><blockquote><p>@akyrtzi æ‰€æè¿°çš„ LSP æœåŠ¡å°†æ¯”ä»Šå¤©çš„ SourceKit æ›´å¼ºå¤§ã€‚</p></blockquote><p>LSP å¯¹ Xcode å›¢é˜Ÿæ¥è¯´æ˜¯ä¸€ä¸ªæœºé‡ï¼Œè®©ä»–ä»¬ä½¿ç”¨ä¸€ç§æ–°çš„æ–¹æ³•å®ç° Swift é›†æˆï¼Œå¹¶å¯ä»¥å°†å…¶åº”ç”¨åœ¨è¯­è¨€å’Œå·¥å…·è‡ª 1.0 ç‰ˆæœ¬å‘å¸ƒä»¥æ¥å››å¹´ä¸­çš„æ‰€æœ‰æ”¹è¿›ä¸Šã€‚</p><h3 id="Xcodeï¼ˆæœ€ç»ˆï¼‰å˜å¾—æ›´å¼ºå¤§"><a href="#Xcodeï¼ˆæœ€ç»ˆï¼‰å˜å¾—æ›´å¼ºå¤§" class="headerlink" title="Xcodeï¼ˆæœ€ç»ˆï¼‰å˜å¾—æ›´å¼ºå¤§"></a>Xcodeï¼ˆæœ€ç»ˆï¼‰å˜å¾—æ›´å¼ºå¤§</h3><p>LSP çš„å¥½å¤„å¹¶ä¸é™äº Swift å’Œ Objective-Cï¼Œ<a href="https://forums.swift.org/t/new-lsp-language-service-supporting-swift-and-c-family-languages-for-any-editor-and-platform/17024/33" target="_blank" rel="noopener">Argyrios åœ¨é‚£ä¸ªå¸–å­çš„å¦ä¸€ä¸ªç•™è¨€ä¸­æŒ‡å‡º</a>ï¼š</p><blockquote><p>Xcode ä½¿ç”¨æˆ‘ä»¬æ–°çš„ LSP æœåŠ¡ï¼Œè¿™æ„å‘³ç€å®ƒä¹Ÿå¯ä»¥ä½¿ç”¨å…¶ä»– LSP æœåŠ¡ï¼Œæˆ‘ä»¬å¯¹æ­¤å¾ˆæ„Ÿå…´è¶£ï¼Œä¸è¿‡ç›®å‰æš‚æ— å…·ä½“è®¡åˆ’ã€‚</p></blockquote><p>ç›®å‰çš„å·¥ä½œé‡ç‚¹æ˜¯æ”¹è¿› Swiftã€‚ä½†æ˜¯ï¼Œä¸€æ—¦å®ç°äº†è¿™ä¸€ç‚¹ï¼Œå°±åº”è¯¥èƒ½ç›¸å¯¹ç®€å•åœ°å°†è¿™äº›ä¼˜åŒ–è½¬ç§»åˆ°æ”¯æŒ LSP çš„å…¶ä»–è¯­è¨€ä¸­ã€‚</p><hr><p>è½¯ä»¶çš„æ¶æ„åæ˜ äº†åˆ›å»ºå®ƒçš„ç»„ç»‡çš„ç»“æ„å’Œä»·å€¼ã€‚åœ¨æŸç§ç¨‹åº¦ä¸Šï¼Œåä¹‹äº¦ç„¶ã€‚</p><p>é€šè¿‡è®© Xcode æ”¯æŒå¼€æ”¾çš„ Language Server Protocol æ ‡å‡†ï¼Œè‹¹æœæ­£åœ¨å±¥è¡Œå…¶åœ¨è‹¹æœç”Ÿæ€ç³»ç»Ÿä¹‹å¤–çš„å¹³å°ä¸Šå®ç° Swift æˆåŠŸçš„æ‰¿è¯ºã€‚æˆ‘è®¤ä¸ºè¿™æ˜¯å¯è¡Œçš„ï¼šå·¥å…·ï¼ˆæˆ–ç¼ºå°‘å·¥å…·ï¼‰é€šå¸¸æ˜¯æŠ€æœ¯è·å¾—äººå¿ƒçš„å…³é”®å†³å®šå› ç´ ã€‚ä½†æˆ–è®¸æ›´é‡è¦çš„æ˜¯ï¼Œæˆ‘è®¤ä¸ºè¿™ä¸€å†³å®šè¡¨æ˜ï¼Œå…¬å¸å†…éƒ¨ï¼ˆè‡³å°‘æ˜¯ä¸€å°éƒ¨åˆ†ï¼‰å¯¹åˆä½œå’Œé€æ˜åº¦çš„æ„æ„¿æœ‰æ‰€å¢å¼ºã€‚</p><blockquote><p>æœ¬æ–‡ç”± SwiftGG ç¿»è¯‘ç»„ç¿»è¯‘ï¼Œå·²ç»è·å¾—ä½œè€…ç¿»è¯‘æˆæƒï¼Œæœ€æ–°æ–‡ç« è¯·è®¿é—® <a href="http://swift.gg">http://swift.gg</a>ã€‚</p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;ä½œè€…ï¼šMatttï¼Œ&lt;a href=&quot;https://nshipster.com/language-server-protocol/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;åŸæ–‡é“¾æ¥&lt;/a&gt;ï¼ŒåŸæ–‡æ—¥æœŸï¼š2018-11-19&lt;br&gt;è¯‘è€…ï¼š&lt;a href=&quot;https://github.com/mobilefellow&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;é›¨è°¨&lt;/a&gt;ï¼›æ ¡å¯¹ï¼š&lt;a href=&quot;http://numbbbbb.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;numbbbbb&lt;/a&gt;ï¼Œ&lt;a href=&quot;http://www.jianshu.com/users/596f2ba91ce9/latest_articles&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;pmst&lt;/a&gt;ï¼›å®šç¨¿ï¼š&lt;a href=&quot;http://forelax.space&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Forelax&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;!--æ­¤å¤„å¼€å§‹æ­£æ–‡--&gt;
&lt;p&gt;ä¸Šä¸ªæœˆï¼Œè‹¹æœå…¬å¸ &lt;a href=&quot;https://forums.swift.org/t/new-lsp-language-service-supporting-swift-and-c-family-languages-for-any-editor-and-platform/17024&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;åœ¨ Swift.org è®ºå›ä¸Šå®£å¸ƒ&lt;/a&gt;ï¼Œæ­£åœ¨ç€æ‰‹ä¸º Swift å’Œ C è¯­è¨€æ”¯æŒ &lt;a href=&quot;https://microsoft.github.io/language-server-protocol/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Language Server Protocol&lt;/a&gt;ï¼ˆè¯­è¨€æœåŠ¡å™¨åè®®ï¼ŒLSPï¼‰ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;å¯¹äºè‹¹æœå…¬å¸è€Œè¨€ï¼Œä¸ºæ‰€æœ‰ Swift å¼€å‘è€… â€”â€” åŒ…æ‹¬éè‹¹æœå¹³å°ä¸Šçš„ â€”â€” æä¾›é«˜è´¨é‡çš„å·¥å…·æ”¯æŒéå¸¸é‡è¦ã€‚æˆ‘ä»¬å¸Œæœ›ä¸å¼€æºç¤¾åŒºåˆä½œï¼Œå°†ç²¾åŠ›é›†ä¸­åœ¨æ„å»º Xcode å’Œå…¶ä»–ç¼–è¾‘å™¨ã€å…¶ä»–å¹³å°å¯ä»¥å…±äº«çš„å…¬å…±åŸºç¡€è®¾æ–½ä¸Šã€‚ä¸ºå®ç°è¿™ä¸€ç›®æ ‡ï¼Œ[â€¦â€¦]ï¼Œæˆ‘ä»¬å†³å®šæ”¯æŒ LSPã€‚&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Argyrios Kyrtzidisï¼Œ2018 å¹´ 10 æœˆ 15 æ—¥&lt;/em&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;è¿™å¯èƒ½æ˜¯è‹¹æœè‡ª 2014 å¹´å°† Swift ä½œä¸ºå¼€æºè½¯ä»¶å‘å¸ƒä»¥æ¥ï¼Œä¸º Swift åšå‡ºçš„æœ€é‡è¦çš„å†³å®šã€‚&lt;/strong&gt; è¿™å¯¹äº APP å¼€å‘è€…æ¥è¯´æ˜¯ä¸€ä»¶å¤§äº‹ï¼Œå¯¹äºå…¶ä»–å¹³å°ä¸Šçš„ Swift å¼€å‘è€…æ¥è¯´æ›´æ˜¯ä¸€ä»¶å¤§äº‹ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†ç†è§£å…¶ä¸­çš„åŸå› ï¼Œæœ¬å‘¨çš„æ–‡ç« å°†ç ”ç©¶ Language Server Protocol è§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Œå®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Œä»¥åŠå®ƒçš„é•¿æœŸå½±å“å¯èƒ½æ˜¯ä»€ä¹ˆã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="Swift" scheme="https://swift.gg/categories/Swift/"/>
    
      <category term="NSHipster" scheme="https://swift.gg/categories/Swift/NSHipster/"/>
    
    
      <category term="Swift" scheme="https://swift.gg/tags/Swift/"/>
    
      <category term="NSHipster" scheme="https://swift.gg/tags/NSHipster/"/>
    
  </entry>
  
  <entry>
    <title>Swift å‚»ç“œæŠ€å·§ #6ï¼šæœ‰åŠ¨ç”»æˆ–æ— åŠ¨ç”»</title>
    <link href="https://swift.gg/2019/01/07/stupid-swift-tricks-6-animations/"/>
    <id>https://swift.gg/2019/01/07/stupid-swift-tricks-6-animations/</id>
    <published>2019-01-07T00:00:00.000Z</published>
    <updated>2019-02-19T03:45:15.660Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ä½œè€…ï¼šWooji Juiceï¼Œ<a href="http://www.wooji-juice.com/blog/stupid-swift-tricks-6-animations.html" target="_blank" rel="noopener">åŸæ–‡é“¾æ¥</a>ï¼ŒåŸæ–‡æ—¥æœŸï¼š2018-11-14<br>è¯‘è€…ï¼š<a href="https://github.com/alejx" target="_blank" rel="noopener">çŸ³æ¦´</a>ï¼›æ ¡å¯¹ï¼š<a href="http://numbbbbb.com/" target="_blank" rel="noopener">numbbbbb</a>ï¼Œ<a href="https://github.com/Cee" target="_blank" rel="noopener">Cee</a>ï¼›å®šç¨¿ï¼š<a href="http://forelax.space" target="_blank" rel="noopener">Forelax</a></p></blockquote><!--æ­¤å¤„å¼€å§‹æ­£æ–‡--><p>æµç•…çš„åŠ¨ç”»ä¸€å¼€å§‹å°±è¢«è®¤ä¸ºæ˜¯ iOS åº”ç”¨çš„ç‰¹ç‚¹ä¹‹ä¸€ã€‚è¿™ä¸ä»…å½’åŠŸäº iOS ç³»ç»Ÿå¼ºå¤§çš„åŠ¨ç”»å¼•æ“ï¼ˆä»è€Œä½¿å¾— App èƒ½å¤Ÿä¸€è¾¹å±•ç¤ºæµç•…çš„åŠ¨ç”»ä¸€è¾¹åšç€å…¶ä»–çš„äº‹æƒ…ï¼‰ï¼Œè¿˜å½’åŠŸäºç³»ç»Ÿæä¾›çš„éå¸¸æ–¹ä¾¿çš„åŠ¨ç”» APIï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æ— åŠ¨ç”»</span></span><br><span class="line">doStuff()</span><br><span class="line"><span class="comment">// æœ‰åŠ¨ç”»</span></span><br><span class="line"><span class="type">UIView</span>.animate(withDuration: <span class="number">1</span>) &#123; doStuff() &#125;</span><br></pre></td></tr></table></figure><p>åªéœ€è¦å°†ä½ çš„ä»£ç æ”¾è¿› blockï¼ˆé—­åŒ…ï¼‰ä¸­ï¼Œå°±å¯ä»¥è®©å®ƒä»¬æ‹¥æœ‰æµç•…çš„ç¼“å…¥ç¼“å‡ºçš„åŠ¨ç”»æ•ˆæœã€‚</p><p>ç„¶è€Œï¼Œå¦‚æœä½ ä½¿ç”¨è¿‡è¿™å¥—ç³»ç»Ÿï¼Œä½ å¯èƒ½ä¼šé‡åˆ°ä¸€äº›é—®é¢˜ã€‚è¿™ä¸ªç³»ç»Ÿå¯ä»¥å®Œç¾åœ°å¤„ç†ç®€å•çš„æƒ…å†µï¼Œæ¯”å¦‚è®©ä¸€ä¸ªä¸œè¥¿æ·¡å…¥ã€æ·¡å‡ºï¼Œæˆ–æ”¹å˜å®ƒçš„é¢œè‰²ï¼Œä½†åœ¨æ›´å¤æ‚çš„æƒ…å†µä¸‹ï¼Œè¿™ç§æ–¹æ³•å°±ä¼šå¼€å§‹å‡ºç°é—®é¢˜ã€‚</p><a id="more"></a><p>ä¾‹å¦‚ä¸‹é¢è¿™ä¸ªä¾‹å­ï¼Œä½ æƒ³è¦æ·¡å‡ºä¸€ä¸ªå…ƒç´ ï¼Œç„¶ååˆ é™¤å®ƒã€‚<code>UIView</code> æ”¯æŒè¿™ç§æ“ä½œï¼š<br><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="type">UIView</span>.animate(withDuration: <span class="number">1</span>, animations:</span><br><span class="line">&#123;</span><br><span class="line">someting.alpha = <span class="number">0</span></span><br><span class="line">&#125;, completion:</span><br><span class="line">&#123;</span><br><span class="line">something.removeFormSuperView()</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p><p>ä½†ä½ åªèƒ½æŠŠæ‰€æœ‰ä¸œè¥¿éƒ½å†™åœ¨ <code>completion</code> block é‡Œæ—¶æ‰ä¼šå·¥ä½œã€‚åœ¨å¤§å‹é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬éœ€è¦æŠŠå¤æ‚çš„ä»»åŠ¡æ‹†è§£æˆå°çš„æ–¹æ³•ã€‚ä½†é—®é¢˜å°±åœ¨è¿™äº›æ–¹æ³•ä¸­ï¼Œåƒåœ¨ä¸Šä¸ªä¾‹å­ä¸­çš„ <code>doStuff()</code>ï¼Œæˆ‘ä»¬æ— æ³•åœ¨ <code>completion</code> block ä¸­æ·»åŠ ä»£ç ã€‚</p><p>æˆ‘ä»¬ä¹Ÿæ— æ³•å¾—çŸ¥åŠ¨ç”»æœ‰å¤šé•¿ï¼ˆç”šè‡³éƒ½ä¸çŸ¥é“æœ‰æ²¡æœ‰åŠ¨ç”»ï¼‰ï¼Œæ‰€ä»¥å¦‚æœæˆ‘ä»¬æ²¡æœ‰åŠæ³•ç®€å•åœ°å’ŒåŠ¨ç”»æ—¶é—´ä¹‹é—´åŒæ­¥ï¼ˆå¦‚åœ¨ <a href="http://www.wooji-juice.com/products/ferrite/" target="_blank" rel="noopener">ä¸€ä¸ªéŸ³é¢‘ç¼–è¾‘è½¯ä»¶</a> ä¸­è®©è¿›åº¦æ¡åŒæ­¥å‰è¿›ï¼‰ã€‚</p><p>æ€»çš„æ¥è¯´ï¼Œæˆ‘ä»¬æ— æ³•è·çŸ¥å…³äºåŠ¨ç”»çš„<em>ä¿¡æ¯</em>ï¼Œä»–ä»¬ä»…ä»…æ˜¯æ‰§è¡Œä»£ç ï¼Œè¿›è¡Œæˆ–ä¸è¿›è¡ŒåŠ¨ç”»ï¼Œå¹¶ä¸ä¼šå—æˆ‘ä»¬æ§åˆ¶ã€‚</p><p>å¦‚æœæˆ‘ä»¬åœ¨è§†å›¾ä¸­æ·»åŠ å¸¦æœ‰ Auto Layout çš„æ–°å…ƒç´ ï¼Œäº‹æƒ…å°±ä¼šå˜å¾—æ›´å¤æ‚ï¼šä½ éœ€è¦å°å¿ƒåœ°è°ƒç”¨ <code>UIView.performWithoutAnimation { }</code>ï¼Œå¦åˆ™æ–°å‡ºç°çš„è§†å›¾å°±ä¼šä» <code>(x: 0, y: 0, w: 0, h: 0)</code> ç¬ç§»åˆ°å®ƒä»¬çš„ç›®æ ‡ä½ç½®ã€‚</p><h2 id="è§†å›¾å±æ€§-Animator"><a href="#è§†å›¾å±æ€§-Animator" class="headerlink" title="è§†å›¾å±æ€§ Animator"></a>è§†å›¾å±æ€§ Animator</h2><p>å¾ˆé•¿æ—¶é—´ä»¥æ¥ï¼Œæˆ‘ä¸€ç›´åœ¨æ”¹å˜ä»£ç ä¸­åŠ¨ç”»çš„å†™æ³•ã€‚æœ€å¼€å§‹æˆ‘å†™äº†æˆ‘è‡ªå·±çš„ <code>AnimationContext</code> ç±»æ¥ååŠ©ï¼Œåæ¥è‹¹æœæä¾›äº†ä»–ä»¬åŠŸèƒ½ç›¸åŒçš„ <code>UIViewPropertyAnimator</code>ï¼Œç°åœ¨æˆ‘ä¼šåœ¨æ‰€æœ‰å¯èƒ½çš„åœ°æ–¹ä½¿ç”¨å®ƒã€‚</p><p>ä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘å‘ç°æœ€æœ‰æ•ˆçš„æ–¹æ³•æ˜¯å†™ä¸€ä¸ªã€Œå¯åŠ¨ç”»ã€çš„æ–¹æ³•å¹¶æ˜¾å¼æ¥å—ä¸€ä¸ª animator å‚æ•°ï¼š<br><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">doStuff</span><span class="params">(with animator: UIViewPropertyAnimator? = <span class="literal">nil</span>)</span></span></span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ä¹‹åæˆ‘å°±å¯ä»¥ç›´æ¥è°ƒç”¨ <code>doStuff()</code> ä¸æ·»åŠ åŠ¨ç”»å¹¶å®Œæˆä»»åŠ¡ï¼Œæˆ–è°ƒç”¨ <code>doStuff(with: UIViewPropertyAnimator(duration: 1, curve: .easeInOut))</code> æˆ–åŠ å…¶ä»–çš„å‚æ•°å»å®Œæˆä»»åŠ¡å¹¶æ·»åŠ åŠ¨ç”»ã€‚</p><p>ï¼ˆå®é™…æƒ…å†µä¸­ï¼Œä¸Šè¿°æ–¹æ³•é€šå¸¸ä¼šè¢«ç§°ä½œ <code>reflectCurrentState()</code> æˆ–å…¶ä»–ç‰¹å®šé¢†åŸŸçš„åå­—ï¼›è¯¥æ–¹æ³•æ‰§è¡Œæ‰€æœ‰å¿…è¦çš„ä¿®æ”¹ï¼Œå¹¶å°†è§†å›¾ä¸æœ€æ–°çš„æ•°æ®åŒæ­¥ã€‚è¯¥æ–¹æ³•ä¸€èˆ¬ä¸ä¼šè¢«æœ¬è§†å›¾ä»¥å¤–çš„ä»£ç è°ƒç”¨ï¼Œè€Œæ˜¯è¢«è§†å›¾è‡ªå·±è°ƒç”¨ï¼Œç„¶åä¼šæ ¹æ®éœ€è¦ç»§ç»­è°ƒç”¨å…¶ä»–å†…éƒ¨æ–¹æ³•ï¼Œæˆ–å°† animator ä¼ ç»™å…¶ä»–å†…éƒ¨æ–¹æ³•ã€‚ä¸è¿‡è¿™ä¸åœ¨æœ¬æ–‡çš„è®¨è®ºèŒƒå›´å†…ã€‚ï¼‰</p><p><code>doStuff()</code> å¯ä»¥åƒä¹‹å‰ä¸€æ ·ï¼Œå¸¦æœ‰æˆ–ä¸å¸¦æœ‰åŠ¨ç”»æ‰§è¡Œä¸€ä¸ªä»»åŠ¡ã€‚ä½†ç°åœ¨å®ƒå¸¦æœ‰äº†æ›´å¤šä¿¡æ¯ï¼šå®ƒçŸ¥é“è‡ªå·±æ˜¯å¦æ‰§è¡ŒåŠ¨ç”»ï¼›å®ƒå¯ä»¥è¯»å– animator çš„ <code>duration</code> å±æ€§ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰ã€‚ä»–å¯ä»¥è°ƒç”¨ animator çš„ <code>addAnimation</code> æ¥æ˜ç¡®åœ°æŒ‡å®šå“ªäº›ä»£ç éœ€è¦åŠ¨ç”»ï¼Œå¹¶ç›´æ¥æ‰§è¡Œä¸éœ€è¦åŠ¨ç”»çš„ä»£ç ï¼›ä»–å¯ä»¥è°ƒç”¨ <code>addCompletion</code> æ¥å¤„ç† <code>removeFromSuperView()</code> æˆ–å…¶ä»–æ–¹æ³•ã€‚</p><p>ä»¥ä¸Šéƒ½æ˜¯ç›¸æ¯”äºä¹‹å‰æ”¹è¿›çš„åœ°æ–¹ï¼Œä½†ä¹Ÿä¸æ˜¯æ²¡æœ‰é—®é¢˜ã€‚å°¤å…¶æ˜¯å®ƒå¼€å§‹å˜å¾—æœ‰ç‚¹å•°å—¦ï¼š</p><ol><li><code>doStuff(with: ...)</code> éœ€è¦å†™å…¥ä¸€ä¸ªå¾ˆé•¿çš„ <code>UIViewPropertyAnimator</code> æ„é€ å‡½æ•°ã€‚ä¸æ˜¯å¾ˆç†æƒ³ï¼Œä¸è¿‡è·Ÿä¸‹é¢æ¯”èµ·æ¥ä¸ç®—ä»€ä¹ˆï¼š</li><li>åœ¨ <code>doStuff()</code> å†…éƒ¨ï¼Œéœ€è¦æ£€æŸ¥ <code>UIViewPropertyAnimator</code> æ˜¯å¦å­˜åœ¨å¹¶è°ƒæ•´ä»£ç ã€‚</li></ol><p>æˆ‘ä»¬ä¸èƒ½ç®€å•çš„ä¾èµ– optional chainingï¼ˆå¯é€‰é“¾å¼è°ƒç”¨)ï¼ˆå¦‚ <code>animator?.addcompletion { something.removeFromSuperview() }</code>ï¼‰ï¼Œå› ä¸ºå¦‚æœ animator æ˜¯ <code>nil</code> ä¼šå¯¼è‡´ block ä¸­çš„ä»£ç è¢«ç›´æ¥è·³è¿‡ï¼Œç„¶è€Œæ— è®ºæœ‰æ²¡æœ‰åŠ¨ç”»ï¼Œæˆ‘ä»¬éƒ½å¸Œæœ›è¯¥è§†å›¾åœ¨çˆ¶è§†å›¾ä¸­è¢«ç§»é™¤ã€‚</p><p>ä¸ºäº†ä¿è¯æ­£ç¡®çš„è¡Œä¸ºï¼Œä½ çš„ä»£ç ä¼šç±»ä¼¼è¿™ä¸ªæ ·å­ï¼š<br><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">doStuff</span><span class="params">(with animator: UIViewPropertyAnimator? = <span class="literal">nil</span>)</span></span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> <span class="keyword">let</span> animator = animator</span><br><span class="line">&#123;</span><br><span class="line"><span class="number">_</span> <span class="keyword">in</span> something.removeFromSuperview()</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">something.removeFromSuperview()</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>Objective-C çˆ±å¥½è€…å³ä½¿ç§ä¸èµ· Optionalï¼ˆå¯é€‰ï¼‰ä¹Ÿç¬‘ä¸å‡ºæ¥ â€“ ä½¿ç”¨ Objective-C ä¹Ÿä¸ä¼šæ”¹å–„è¿™ç§æƒ…å†µï¼š<br><figure class="highlight objc"><table><tr><td class="code"><pre><span class="line">- (<span class="keyword">void</span>) doStuffWithAnimator: (<span class="keyword">nullable</span> <span class="built_in">UIViewPropertyAnimator</span> *) animator</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (animator != <span class="literal">nil</span>)</span><br><span class="line">&#123;</span><br><span class="line">[animator addCompletion: ^(<span class="built_in">UIViewAnimatingPosition</span> position)</span><br><span class="line">&#123;</span><br><span class="line">[something removeFromSuperview];</span><br><span class="line">&#125;];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">[something removeFromSuperView];</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ä¸€æ—¦ä½ åœ¨ç”Ÿäº§ç¯å¢ƒä¸­æƒ³ä½¿ç”¨è¿™æ ·çš„ä»£ç ï¼Œä½ æœ€ç»ˆä¼šå†™å‡ºæ›´æ‚ä¹±ã€æ›´éš¾äºé˜…è¯»å’Œç»´æŠ¤çš„ä»£ç ã€‚</p><p>å¹¸è¿çš„æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥è¿›ä¸€æ­¥çš„æ”¹è¿›è¿™æ®µä»£ç ã€‚</p><h2 id="Optional-ä¸æ˜¯-Nil-çš„å¦ä¸€ä¸ªå«æ³•"><a href="#Optional-ä¸æ˜¯-Nil-çš„å¦ä¸€ä¸ªå«æ³•" class="headerlink" title="Optional ä¸æ˜¯ Nil çš„å¦ä¸€ä¸ªå«æ³•"></a>Optional ä¸æ˜¯ <code>Nil</code> çš„å¦ä¸€ä¸ªå«æ³•</h2><p>æ”¹è¿›è¿™æ®µä»£ç çš„è¯€çªå°±åœ¨äºï¼Œ<code>UIViewPropertyAnimator</code> åœ¨è¿™é‡Œæ˜¯ Optionalï¼Œå…³é”®ç‚¹å°±åœ¨äº Optional åœ¨ Swift ä¸­çš„æ„ä¹‰ã€‚</p><p>æœ‰çš„æ—¶å€™äººä»¬ä¼šæŠ±æ€¨ Swift çš„ Optional éå¸¸çƒ¦äººï¼Œå› ä¸ºåœ¨ Objective-C ä¸­ï¼ˆObjective-C ä¸­ä½¿ç”¨ <code>nil</code> æŒ‡é’ˆæ¥æ›¿ä»£ Swift ä¸­çš„ Optionalï¼‰ä½ å¯ä»¥ç›´æ¥å¯¹æŒ‡é’ˆè°ƒç”¨æ–¹æ³•ã€‚</p><p>Objective-C ä¸ä¼šæŠ±æ€¨æŒ‡é’ˆæ˜¯ä¸æ˜¯ <code>nil</code>ï¼šå¦‚æœæŒ‡é’ˆéç©ºï¼Œæ–¹æ³•ä¼šç›´æ¥è¢«è°ƒç”¨ï¼›å¦‚æœæ˜¯ç©ºæŒ‡é’ˆï¼Œè°ƒç”¨ä¼šè¢«æ— å£°åœ°å¿½ç•¥æ‰ï¼Œä¸ç”¨ç¨‹åºå‘˜åšå…¶ä»–çš„äº‹æƒ…ã€‚</p><p>æˆ‘ä¸åŒæ„è¿™ä¸ªæ„è§ã€‚åœ¨ Swift ä¸­ï¼Œåœ¨ä½ çŸ¥é“ä½ åœ¨åšä»€ä¹ˆçš„æƒ…å†µä¸‹ï¼Œä½ åªéœ€è¦åŠ ä¸€ä¸ª <code>?</code>ï¼Œå¹¶ä¸æ˜¯ä¸€ä¸ªå¾ˆå¤§çš„è´Ÿæ‹…ã€‚ä½†æ˜¯ç”±äºæœ‰äº† Swift çš„ Optionalï¼Œæˆ‘ä»¬å¯ä»¥åšæ›´å¤šäº‹æƒ…ã€‚</p><p>å› ä¸ºåœ¨ Swift ä¸­ï¼ŒOptional æ˜¯ä¸€ä¸ªâ€œçœŸå®çš„ä¸œè¥¿â€ï¼Œè€Œä¸æ˜¯â€œç¼ºå°‘çš„ä¸œè¥¿â€ã€‚æ— è®ºä¸€ä¸ª Optional çš„å€¼æ˜¯ä»€ä¹ˆï¼Œå°±ç®—æ˜¯ <code>nil</code>ï¼Œå®ƒä¹Ÿæ˜¯ä¸€ä¸ªæšä¸¾å€¼ï¼Œä½ å¯ä»¥å¯¹å®ƒè°ƒç”¨æ–¹æ³•ï¼Œè°ƒç”¨çš„æ–¹æ³•ä¹Ÿä¼šè¢«æ‰§è¡Œã€‚<a href="http://www.wooji-juice.com/blog/stupid-swift-tricks-5-enums" target="_blank" rel="noopener">è®²çœŸçš„ï¼ŒSwift çš„æšä¸¾è¶…çº§å¥½ç”¨ï¼</a></p><p>ï¼ˆæœ‰è¶£çš„æ˜¯ï¼Œåœ¨ Objective-C ç±»ä¸­å¯¹ Swift çš„ <code>nil</code> çš„åº•å±‚è¡¨ç¤º<em>å°±æ˜¯</em>ç©ºæŒ‡é’ˆï¼Œæ‰€ä»¥å®ƒä»¬çš„æ•ˆç‡è¿˜æ˜¯å¾ˆé«˜çš„ã€‚ä½†æ˜¯è¯­æ³•å±‚é¢ï¼Œå®ƒä»¬éå¸¸çš„ä¸åŒã€‚æˆ‘ä»¬ä¼šåœ¨æ¥ä¸‹æ¥åˆ©ç”¨è¿™ä¸ªæ€§è´¨ã€‚ï¼‰</p><p>å› ä¸ºåœ¨ Swift ä¸­ï¼Œä½ å¯ä»¥å¯¹å‡ ä¹æ‰€æœ‰ç±»å‹æ·»åŠ æ‹“å±•ï¼Œä¸ä»…ä»…æ˜¯ Objective-C ç±»ã€‚ä½ å¯ä»¥ï¼š<br><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Optional</span> <span class="title">where</span> <span class="title">Wrapped</span> == <span class="title">UIViewPropertyAnimator</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    @discardableResult</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">addCompletion</span><span class="params">(<span class="number">_</span> block: @escaping <span class="params">(UIViewAnimatingPosition)</span></span></span>-&gt;()) -&gt; <span class="type">Optional</span>&lt;<span class="type">UIViewPropertyAnimator</span>&gt;</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> animator = <span class="keyword">self</span></span><br><span class="line">        &#123;</span><br><span class="line">            animator.addCompletion(block)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            block(.end)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">self</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>è¿™æ®µä»£ç å°†éš¾çœ‹çš„ä»£ç ç§»åŠ¨åˆ°äº† Optional çš„åº“ä¸­ï¼ˆä½†åªé’ˆå¯¹ <code>UIViewPropertyAnimator</code>ï¼‰ã€‚ç°åœ¨ï¼Œä½ çš„è§†å›¾å¯ä»¥ï¼š<br><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">doStuff</span><span class="params">(with animator: UIViewPropertyAnimator? = <span class="literal">nil</span>)</span></span></span><br><span class="line">&#123;</span><br><span class="line">animator.addCompletion &#123; <span class="number">_</span> <span class="keyword">in</span> something.removeFromSuperview() &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ç°åœ¨å›è°ƒå‡½æ•°æ€»ä¼šè¢«æ‰§è¡Œï¼Œæ— è®ºæœ‰æ²¡æœ‰ animatorã€‚</p><p>ï¼ˆæ³¨æ„ <code>animator</code> å’Œ <code>addCompletion</code> ä¹‹é—´æ²¡æœ‰ <code>?</code>ï¼‰</p><p>å¦‚æœæœ‰ animatorï¼Œblock ä¸­çš„ä»£ç ä¼šåœ¨åŠ¨ç”»å®Œæˆæ—¶è¢«è°ƒç”¨ï¼›å¦‚æœæ²¡æœ‰ animatorï¼Œblock ä¸­çš„ä»£ç ä¼šè¢«ç«‹å³è°ƒç”¨ï¼Œå› ä¸º <code>nil</code> Optional ä»ç„¶æ˜¯ Optionalï¼Œæ‹¥æœ‰æ‰€æœ‰ Optional çš„æ–¹æ³•ï¼Œå½“ç„¶ä¹ŸåŒ…æ‹¬æˆ‘ä»¬åˆšåˆšæ·»åŠ çš„æ–¹æ³• â€“ è€Œä¸æ˜¯ä¸€ä¸ªåä¸‹æ‰€æœ‰çš„æ»šè½åˆ°å®ƒè¡¨é¢çš„æ–¹æ³•è°ƒç”¨çš„é»‘æ´ã€‚</p><p>æˆ‘è¿˜æœ‰ç±»ä¼¼çš„æ‹“å±•æ–¹æ³•æ¥æ‰§è¡Œæ€»æ˜¯éœ€è¦è¢«æ‰§è¡Œçš„ä»»åŠ¡ï¼Œæœ‰äº›æ˜¯åŠ¨ç”»çš„ä¸€éƒ¨åˆ†ï¼Œæˆ–å…¶ä»–çš„ç«‹å³æ‰§è¡Œçš„ä»£ç ï¼šå¦‚æœæˆ‘æƒ³è®©ä¸€ä¸ªå…ƒç´ ç¼“å…¥ï¼Œæˆ‘ä¼šåœ¨æŠŠå…ƒç´ æ”¾å…¥è§†å›¾ä¹‹å‰å°† alpha å€¼è®¾ç½®æˆ 0ï¼Œç„¶åè°ƒç”¨ <code>animator.perform { something.alpha = 1 }</code> æ¥ä¿è¯å®ƒæ— è®ºæœ‰æ²¡æœ‰åŠ¨ç”»éƒ½ä¼šå˜å¾—å¯è§ã€‚</p><p>ä¸ Optional æ— å…³ï¼Œæˆ‘è¿˜åœ¨ <code>UIViewPropertyAnimator</code> ä¸­æ·»åŠ äº†ä¸€äº›é™æ€æ–¹æ³•æ¥ç”Ÿæˆä¸€äº›å¸¸è§çš„åŠ¨ç”»ï¼Œå¦‚ï¼š<code>static func spring(...)</code>ã€<code>static func linear(...)</code>ã€‚Swift çš„åç§°è§£ææ–¹æ³•å†³å®šäº†ä½ å¯ä»¥å†™å‡ºæ›´ç®€æ´çš„ä»£ç ï¼Œå¦‚ï¼š<code>doStuff(with: .spring(duration: 1))</code>ã€‚</p><p>å½“ç„¶ï¼Œä»¥ä¸Šåªæ˜¯ä¸€äº›å°çš„ä»£ç æŠ€å·§ï¼Œè€Œä¸æ˜¯é‡æ–°æ„æƒ³ä»£ç æˆ–åº”ç”¨ç»“æ„ã€‚ä½†æ˜¯éšç€é¡¹ç›®çš„å¤æ‚åº¦å¢åŠ ï¼Œåƒè¿™ç§å°çš„æ”¹è¿›ä¹Ÿä¼šå åŠ èµ·æ¥ï¼Œå¸®åŠ©æˆ‘ä»¬å¯¹æŠ—ä¸æ–­å¢åŠ çš„å¤æ‚åº¦ï¼Œç»´æŒå¤§å‹é¡¹ç›®çš„å¯æ§æ€§ã€‚è°¢è°¢ä½ ï¼ŒSwiftã€‚<a href="https://www.youtube.com/watch?v=9jtU9BbReQk" target="_blank" rel="noopener">Thwift</a>.</p><blockquote><p>æœ¬æ–‡ç”± SwiftGG ç¿»è¯‘ç»„ç¿»è¯‘ï¼Œå·²ç»è·å¾—ä½œè€…ç¿»è¯‘æˆæƒï¼Œæœ€æ–°æ–‡ç« è¯·è®¿é—® <a href="http://swift.gg">http://swift.gg</a>ã€‚</p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;ä½œè€…ï¼šWooji Juiceï¼Œ&lt;a href=&quot;http://www.wooji-juice.com/blog/stupid-swift-tricks-6-animations.html&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;åŸæ–‡é“¾æ¥&lt;/a&gt;ï¼ŒåŸæ–‡æ—¥æœŸï¼š2018-11-14&lt;br&gt;è¯‘è€…ï¼š&lt;a href=&quot;https://github.com/alejx&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;çŸ³æ¦´&lt;/a&gt;ï¼›æ ¡å¯¹ï¼š&lt;a href=&quot;http://numbbbbb.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;numbbbbb&lt;/a&gt;ï¼Œ&lt;a href=&quot;https://github.com/Cee&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Cee&lt;/a&gt;ï¼›å®šç¨¿ï¼š&lt;a href=&quot;http://forelax.space&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Forelax&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;!--æ­¤å¤„å¼€å§‹æ­£æ–‡--&gt;
&lt;p&gt;æµç•…çš„åŠ¨ç”»ä¸€å¼€å§‹å°±è¢«è®¤ä¸ºæ˜¯ iOS åº”ç”¨çš„ç‰¹ç‚¹ä¹‹ä¸€ã€‚è¿™ä¸ä»…å½’åŠŸäº iOS ç³»ç»Ÿå¼ºå¤§çš„åŠ¨ç”»å¼•æ“ï¼ˆä»è€Œä½¿å¾— App èƒ½å¤Ÿä¸€è¾¹å±•ç¤ºæµç•…çš„åŠ¨ç”»ä¸€è¾¹åšç€å…¶ä»–çš„äº‹æƒ…ï¼‰ï¼Œè¿˜å½’åŠŸäºç³»ç»Ÿæä¾›çš„éå¸¸æ–¹ä¾¿çš„åŠ¨ç”» APIï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight swift&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// æ— åŠ¨ç”»&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;doStuff()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// æœ‰åŠ¨ç”»&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;type&quot;&gt;UIView&lt;/span&gt;.animate(withDuration: &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;) &amp;#123; doStuff() &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;åªéœ€è¦å°†ä½ çš„ä»£ç æ”¾è¿› blockï¼ˆé—­åŒ…ï¼‰ä¸­ï¼Œå°±å¯ä»¥è®©å®ƒä»¬æ‹¥æœ‰æµç•…çš„ç¼“å…¥ç¼“å‡ºçš„åŠ¨ç”»æ•ˆæœã€‚&lt;/p&gt;
&lt;p&gt;ç„¶è€Œï¼Œå¦‚æœä½ ä½¿ç”¨è¿‡è¿™å¥—ç³»ç»Ÿï¼Œä½ å¯èƒ½ä¼šé‡åˆ°ä¸€äº›é—®é¢˜ã€‚è¿™ä¸ªç³»ç»Ÿå¯ä»¥å®Œç¾åœ°å¤„ç†ç®€å•çš„æƒ…å†µï¼Œæ¯”å¦‚è®©ä¸€ä¸ªä¸œè¥¿æ·¡å…¥ã€æ·¡å‡ºï¼Œæˆ–æ”¹å˜å®ƒçš„é¢œè‰²ï¼Œä½†åœ¨æ›´å¤æ‚çš„æƒ…å†µä¸‹ï¼Œè¿™ç§æ–¹æ³•å°±ä¼šå¼€å§‹å‡ºç°é—®é¢˜ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="Wooji Juice" scheme="https://swift.gg/categories/Wooji-Juice/"/>
    
    
      <category term="Swift" scheme="https://swift.gg/tags/Swift/"/>
    
      <category term="æ•™ç¨‹" scheme="https://swift.gg/tags/%E6%95%99%E7%A8%8B/"/>
    
  </entry>
  
  <entry>
    <title>Hacking Hit Tests</title>
    <link href="https://swift.gg/2018/12/27/hacking-hit-tests/"/>
    <id>https://swift.gg/2018/12/27/hacking-hit-tests/</id>
    <published>2018-12-27T00:00:00.000Z</published>
    <updated>2019-02-19T03:45:13.515Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ä½œè€…ï¼šSoroush Khanlouï¼Œ<a href="http://khanlou.com/2018/09/hacking-hit-tests/" target="_blank" rel="noopener">åŸæ–‡é“¾æ¥</a>ï¼ŒåŸæ–‡æ—¥æœŸï¼š2018-09-07<br>è¯‘è€…ï¼š<a href="https://nemocdz.github.io/" target="_blank" rel="noopener">Nemocdz</a>ï¼›æ ¡å¯¹ï¼š<a href="http://blog.yousanflics.com.cn" target="_blank" rel="noopener">Yousanflics</a>ï¼Œ<a href="http://www.jianshu.com/users/596f2ba91ce9/latest_articles" target="_blank" rel="noopener">pmst</a>ï¼›å®šç¨¿ï¼š<a href="http://forelax.space" target="_blank" rel="noopener">Forelax</a></p></blockquote><!--æ­¤å¤„å¼€å§‹æ­£æ–‡--><p>å›æƒ³ <a href="https://developer.apple.com/videos/play/wwdc2015/408/" target="_blank" rel="noopener">Crusty æ•™æˆ‘ä»¬ä½¿ç”¨é¢å‘åè®®ç¼–ç¨‹</a>ä¹‹å‰çš„æ—¥å­ï¼Œæˆ‘ä»¬å¤§å¤šä½¿ç”¨ç»§æ‰¿æ¥å…±äº«ä»£ç çš„å®ç°ã€‚é€šå¸¸åœ¨ UIKit ç¼–ç¨‹ä¸­ï¼Œä½ å¯èƒ½ä¼šç”¨ <code>UIView</code> çš„å­ç±»å»æ·»åŠ ä¸€äº›å­è§†å›¾ï¼Œé‡å†™ <code>-layoutSubviews</code>ï¼Œç„¶åé‡å¤è¿™äº›å·¥ä½œã€‚ä¹Ÿè®¸ä½ è¿˜ä¼šé‡å†™ <code>-drawRect</code>ã€‚ä½†å½“ä½ éœ€è¦åšä¸€äº›ç‰¹åˆ«çš„äº‹æƒ…æ—¶ï¼Œå°±éœ€è¦çœ‹çœ‹ <code>UIView</code> ä¸­å…¶ä»–å¯ä»¥è¢«é‡å†™çš„æ–¹æ³•ã€‚</p><a id="more"></a><p><code>UIKit</code> æœ‰ä¸ªååˆ†å¤æ€ªçš„åœ°æ–¹ï¼Œé‚£æ˜¯å®ƒçš„è§¦æ‘¸äº‹ä»¶å¤„ç†ç³»ç»Ÿã€‚å®ƒä¸»è¦åŒ…æ‹¬ä¸¤ä¸ªæ–¹æ³•ï¼Œ<code>-pointInstide:withEvent:</code> å’Œ <code>-hitTest:withEvent:</code>ã€‚</p><p><code>-pointInside:</code> ä¼šå‘Šè¯‰è°ƒç”¨è€…ç»™å®šç‚¹æ˜¯å¦åŒ…å«åœ¨æŒ‡å®šçš„è§†å›¾åŒºåŸŸä¸­ã€‚è€Œ <code>-hitTest:</code> ç”¨ <code>pointInside:</code> è¿™ä¸ªæ–¹æ³•æ¥å‘Šè¯‰è°ƒç”¨è€…å“ªä¸ªå­è§†å›¾ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰æ˜¯å½“å‰è§¦æ‘¸åœ¨ç»™å®šç‚¹çš„æ¥æ”¶è€…ã€‚ç°åœ¨æˆ‘æ¯”è¾ƒæ„Ÿå…´è¶£çš„æ˜¯åé¢è¿™ä¸ªæ–¹æ³•ã€‚</p><p>è‹¹æœçš„æ–‡æ¡£å‹‰å¼ºèƒ½å¤Ÿè®©ä½ ç†è§£æ€ä¹ˆé‡æ–°å®ç°è¿™ä¸ªæ–¹æ³•ã€‚åœ¨ä½ å­¦ä¼šæ€ä¹ˆé‡æ–°å®ç°æ–¹æ³•ä¹‹å‰ï¼Œä½ éƒ½ä¸èƒ½æ”¹å˜å®ƒçš„åŠŸèƒ½ã€‚æ¥ä¸‹æ¥è®©æˆ‘ä»¬çœ‹ä¸€é <a href="https://developer.apple.com/documentation/uikit/uiview/1622469-hittest?language=objc" target="_blank" rel="noopener">æ–‡æ¡£</a>ï¼Œå¹¶å°è¯•é‡å†™è¿™ä¸ªå‡½æ•°ã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">hitTest</span><span class="params">(<span class="number">_</span> point: CGPoint, with event: UIEvent?)</span></span> -&gt; <span class="type">UIView</span>? &#123;</span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é¦–å…ˆï¼Œè®©æˆ‘ä»¬ä»æ–‡æ¡£çš„ç¬¬äºŒæ®µå¼€å§‹å§ï¼š</p><blockquote><p>è¿™ä¸ªæ–¹æ³•ä¼šå¿½ç•¥é‚£äº›éšè—çš„è§†å›¾ï¼Œç¦ç”¨ç”¨æˆ·äº¤äº’è§†å›¾å’Œ alpha ç­‰çº§å°äº 0.01 çš„è§†å›¾ã€‚</p></blockquote><p>è®©æˆ‘ä»¬é€šè¿‡ä¸€äº› <code>gurad</code> è¯­å¥æ¥å¿«é€Ÿé¢„å¤„ç†è¿™äº›å‰ææ¡ä»¶ã€‚</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">override func hitTest(_ point: CGPoint, with event: UIEvent?) -&gt; UIView? &#123;</span><br><span class="line"></span><br><span class="line">guard isUserInteractionEnabled else &#123; return nil &#125;</span><br><span class="line"></span><br><span class="line">guard !isHidden else &#123; return nil &#125;</span><br><span class="line"></span><br><span class="line">guard alpha &gt;= 0.01 else &#123; return nil &#125;</span><br><span class="line"></span><br><span class="line">// ...</span><br></pre></td></tr></table></figure><p>ç›¸å½“ç®€å•å§ã€‚é‚£æ¥ä¸‹æ¥æ˜¯ï¼Ÿ</p><blockquote><p>è¿™ä¸ªæ–¹æ³•è°ƒç”¨ <code>pointInside:withEvent:</code> æ–¹æ³•æ¥éå†æ¥æ”¶è§†å›¾å±‚çº§ä¸­æ¯ä¸€ä¸ªå­è§†å›¾ï¼Œæ¥å†³å®šå“ªä¸ªå­è§†å›¾æ¥æ¥æ”¶è¯¥è§¦æ‘¸äº‹ä»¶ã€‚</p></blockquote><p>é€å­—é˜…è¯»æ–‡æ¡£åï¼Œæ„Ÿè§‰ <code>-pointInside:</code> ä¼šåœ¨æ¯ä¸€ä¸ªå­è§†å›¾é‡Œè¢«è°ƒç”¨ï¼ˆç”¨ä¸€ä¸ª for å¾ªç¯ï¼‰ï¼Œä½†è¿™å¹¶ä¸æ˜¯å®Œå…¨æ­£ç¡®çš„ã€‚</p><p>æ„Ÿè°¢è¿™ä¸ª <a href="https://twitter.com/an0/status/1038254836016394240" target="_blank" rel="noopener">è¯»è€…</a>ã€‚é€šè¿‡ä»–åœ¨ <code>-hitTest:</code> å’Œ <code>-pointInside:</code> ä¸­æ”¾ç½®äº†æ–­ç‚¹çš„è¯•éªŒï¼Œæˆ‘ä»¬çŸ¥é“ <code>-pointInside:</code> ä¼šåœ¨ <code>self</code> ä¸­è°ƒç”¨ï¼ˆåœ¨æœ‰ä¸Šé¢é‚£äº› guard çš„æƒ…å†µä¸‹ï¼‰ï¼Œè€Œä¸æ˜¯åœ¨æ¯ä¸€ä¸ªå­è§†å›¾ä¸­ã€‚ æ‰€ä»¥åº”è¯¥æ·»åŠ å¦å¤–çš„ guard è¯­å¥ï¼Œåƒä¸‹é¢è¿™è¡Œä»£ç ä¸€æ ·ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">guard</span> <span class="keyword">self</span>.point(inside: point, with: event) <span class="keyword">else</span> &#123; <span class="keyword">return</span> <span class="literal">nil</span> &#125;</span><br></pre></td></tr></table></figure><p><code>-pointInside:</code> æ˜¯ <code>UIView</code> å¦ä¸€ä¸ªéœ€è¦é‡å†™çš„æ–¹æ³•ã€‚å®ƒçš„é»˜è®¤å®ç°ä¼šæ£€æŸ¥ä¼ å…¥çš„æŸä¸ªç‚¹æ˜¯å¦åŒ…å«åœ¨è§†å›¾çš„ <code>bounds</code> ä¸­ã€‚å¦‚æœè°ƒç”¨ <code>-pointInside</code> è¿”å› trueï¼Œé‚£ä¹ˆæ„å‘³ç€è§¦æ‘¸äº‹ä»¶å‘ç”Ÿåœ¨å®ƒçš„ bounds ä¸­ã€‚</p><p>ç†è§£å®Œè¿™ä¸ªå°å°çš„å·®åˆ«åï¼Œæˆ‘ä»¬å¯ä»¥ç»§ç»­é˜…è¯»æ–‡æ¡£äº†ï¼š</p><blockquote><p>å¦‚æœ <code>-pointInside:withEvnet:</code> è¿”å› YESï¼Œé‚£ä¹ˆå­è§†å›¾çš„å±‚çº§ä¹Ÿä¼šè¿›è¡Œç±»ä¼¼çš„éå†ç›´åˆ°æ‰¾åˆ°åŒ…å«æŒ‡å®šç‚¹çš„æœ€å‰é¢çš„è§†å›¾ã€‚</p></blockquote><p>æ‰€ä»¥ï¼Œä»è¿™é‡ŒçŸ¥é“æˆ‘ä»¬éœ€è¦éå†è§†å›¾æ ‘ã€‚è¿™æ„å‘³ç€å¾ªç¯éå†æ‰€æœ‰çš„è§†å›¾ï¼Œå¹¶è°ƒç”¨ <code>-hitTest:</code> åœ¨å®ƒä»¬æ¯ä¸€ä¸ªä¸Šå»æ‰¾åˆ°åˆé€‚çš„å­è§†å›¾ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¿™ä¸ªæ–¹æ³•æ˜¯é€’å½’çš„ã€‚</p><p>ä¸ºäº†éå†è§†å›¾å±‚çº§ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªå¾ªç¯ã€‚ç„¶è€Œï¼Œè¿™ä¸ªæ–¹æ³•å…¶ä¸­ä¸€ä¸ªæ›´åäººç±»çš„æ˜¯éœ€è¦åå‘éå†è§†å›¾ã€‚å­è§†å›¾æ•°ç»„ä¸­å°¾éƒ¨çš„è§†å›¾åè€Œä¼šå¤„åœ¨ Z è½´ä¸­<em>æ›´é«˜</em>çš„ä½ç½®ï¼Œæ‰€ä»¥å®ƒä»¬åº”è¯¥è¢«æœ€å…ˆæ£€éªŒã€‚ï¼ˆå¦‚æœæ²¡æœ‰è¿™ç¯‡ <a href="http://smnh.me/hit-testing-in-ios/" target="_blank" rel="noopener">æ–‡ç« </a>ï¼Œæˆ‘å¯è®°ä¸èµ·è¿™ä¸ªç‚¹ã€‚ï¼‰</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ...</span></span><br><span class="line"><span class="keyword">for</span> subview <span class="keyword">in</span> subviews.reversed() &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ...</span></span><br></pre></td></tr></table></figure><p>ä¼ å…¥çš„åæ ‡ç‚¹ä¼šè½¬æ¢åˆ°<em>å½“å‰</em>è§†å›¾çš„åæ ‡ç³»ä¸­ï¼Œè€Œéæˆ‘ä»¬å…³å¿ƒå­è§†å›¾ä¸­ã€‚å¹¸è¿çš„æ˜¯ï¼ŒUIKit ç»™äº†ä¸€ä¸ªå¤„ç†å‡½æ•°ï¼Œå»è½¬æ¢åæ ‡ç‚¹çš„å‚è€ƒç³»åˆ°å…¶ä»–ä»»ä½•çš„è§†å›¾çš„ frame çš„å‚è€ƒç³»ä¸­ã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ...</span></span><br><span class="line"><span class="keyword">for</span> subview <span class="keyword">in</span> subviews.reversed() &#123;</span><br><span class="line"><span class="keyword">let</span> convertedPoint = subview.convert(point, from: <span class="keyword">self</span>)</span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ...</span></span><br></pre></td></tr></table></figure><p>ä¸€æ—¦æœ‰äº†è½¬æ¢åçš„åæ ‡ç‚¹ï¼Œæˆ‘ä»¬å°±å¯ä»¥å¾ˆç®€å•åœ°è¯¢é—®æ¯ä¸€ä¸ªå­è§†å›¾è¯¥ç‚¹çš„ç›®æ ‡è§†å›¾ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœç‚¹å¤„äºè¯¥è§†å›¾å¤–éƒ¨ï¼ˆä¹Ÿå°±æ˜¯è¯´ï¼Œ<code>-pointInside:</code> è¿”å› <em>false</em>ï¼‰ï¼Œ<code>-hitTest</code> ä¼šè¿”å› nilã€‚è¿™æ—¶å°±åº”è¯¥æ£€æŸ¥å±‚çº§é‡Œçš„ä¸‹ä¸€ä¸ªå­è§†å›¾ã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ...</span></span><br><span class="line"><span class="keyword">let</span> convertedPoint = subview.convert(point, from: <span class="keyword">self</span>)</span><br><span class="line"><span class="keyword">if</span> <span class="keyword">let</span> candidate = subview.hitTest(convertedPoint, with: event) &#123;</span><br><span class="line"><span class="keyword">return</span> candidate</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//...</span></span><br></pre></td></tr></table></figure><p>ä¸€æ—¦æˆ‘ä»¬æœ‰äº†åˆé€‚çš„å¾ªç¯è¯­å¥ï¼Œæœ€åä¸€ä»¶éœ€è¦åšçš„äº‹æ˜¯ <code>return self</code>ã€‚å¦‚æœè§†å›¾æ˜¯å¯è¢«ç‚¹å‡»ï¼ˆè¢«æˆ‘ä»¬çš„ <code>guard</code> è¯­å¥æ–­è¨€è¿‡çš„æƒ…å†µï¼‰ï¼Œä½†å´æ²¡æœ‰å­è§†å›¾æƒ³è¦å¤„ç†è¿™ä¸ªè§¦æ‘¸çš„è¯ï¼Œæ„å‘³ç€å½“å‰è§†å›¾ï¼Œä¹Ÿå°±æ˜¯ <code>self</code>ï¼Œæ˜¯è¿™ä¸ªè§¦æ‘¸æ­£ç¡®çš„ç›®æ ‡ã€‚</p><p>è¿™æ˜¯å®Œæ•´çš„ç®—æ³•ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">hitTest</span><span class="params">(<span class="number">_</span> point: CGPoint, with event: UIEvent?)</span></span> -&gt; <span class="type">UIView</span>? &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">guard</span> isUserInteractionEnabled <span class="keyword">else</span> &#123; <span class="keyword">return</span> <span class="literal">nil</span> &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">guard</span> !isHidden <span class="keyword">else</span> &#123; <span class="keyword">return</span> <span class="literal">nil</span> &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">guard</span> alpha &gt;= <span class="number">0.01</span> <span class="keyword">else</span> &#123; <span class="keyword">return</span> <span class="literal">nil</span> &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">guard</span> <span class="keyword">self</span>.point(inside: point, with: event) <span class="keyword">else</span> &#123; <span class="keyword">return</span> <span class="literal">nil</span> &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> subview <span class="keyword">in</span> subviews.reversed() &#123;</span><br><span class="line"><span class="keyword">let</span> convertedPoint = subview.convert(point, from: <span class="keyword">self</span>)</span><br><span class="line"><span class="keyword">if</span> <span class="keyword">let</span> candidate = subview.hitTest(convertedPoint, with: event) &#123;</span><br><span class="line"><span class="keyword">return</span> candidate</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">self</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç°åœ¨æˆ‘ä»¬æœ‰äº†ä¸€ä¸ªå‚è€ƒçš„å®ç°ï¼Œå¯ä»¥å¼€å§‹ä¿®æ”¹å®ƒæ¥å®ç°å…·ä½“çš„è¡Œä¸ºã€‚</p><p>åœ¨ä¹‹å‰çš„è¿™ç¯‡æ’­å®¢<a href="http://khanlou.com/2013/04/changing-the-size-of-a-paging-scroll-view/" target="_blank" rel="noopener">ã€ŠChanging the size of a paging scroll viewã€‹</a>ä¸­ï¼Œæˆ‘å°±å·²ç»è®¨è®ºè¿‡å…¶ä¸­ä¸€ç§è¡Œä¸ºã€‚æˆ‘è°ˆåˆ°ä¸€ç§â€œè½åå¹¶è¯¥è¢«åºŸå¼ƒâ€çš„æ–¹æ³•æ¥äº§ç”Ÿè¿™ç§æ•ˆæœã€‚æœ¬è´¨ä¸Šï¼Œä½ å¿…é¡»ï¼š</p><ol><li>å…³æ‰ <code>clipsToBounds</code></li><li>åœ¨æ»‘åŠ¨åŒºåŸŸä¸­æ”¾ä¸€ä¸ªééšè—è§†å›¾</li><li>åœ¨ééšè—è§†å›¾ä¸Šé‡å†™ <code>-hitTest:</code> æ¥ä¼ é€’æ‰€æœ‰è§¦æ‘¸åˆ° scrollview ä¸­</li></ol><p><code>-hitTest:</code> æ–¹æ³•æ˜¯è¿™ç§æŠ€æœ¯çš„åŸºçŸ³ã€‚å› ä¸ºåœ¨ UIKit ä¸­ï¼ŒhitTest æ–¹æ³•ä¼šä»£ç†ç»™æ¯ä¸€ä¸ªè§†å›¾å»å®ç°ï¼Œå†³å®šè§¦æ‘¸äº‹ä»¶ä¼ é€’ç»™å“ªä¸ªè§†å›¾æ¥æ”¶ã€‚è¿™å¯ä»¥è®©ä½ å»é‡å†™é»˜è®¤çš„å®ç°ï¼ˆæœŸæœ›å’Œæ™®é€šçš„å®ç°ï¼‰å¹¶æ›¿æ¢å®ƒä¸ºä½ æƒ³åšçš„ï¼Œç”šè‡³è¿”å›ä¸€ä¸ªä¸æ˜¯åŸå§‹è§†å›¾çš„å­è§†å›¾ã€‚å¤šä¹ˆç–¯ç‹‚ã€‚</p><p>è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹å¦ä¸€ä¸ªä¾‹å­ã€‚å¦‚æœä½ å·²ç»ç”¨è¿‡ <a href="http://beacon.party/" target="_blank" rel="noopener">Beacon</a> ä»Šå¹´çš„ç‰ˆæœ¬ï¼Œä½ ä¼šæ³¨æ„åˆ°æ»‘åŠ¨åˆ é™¤äº‹ä»¶è¡Œä¸ºçš„ç‰©ç†æ•ˆæœæ„Ÿè§‰ä¸Šå’Œå…¶ä»–ç”¨åŸç”Ÿç³»ç»Ÿå®ç°çš„æ•ˆæœæœ‰ç‚¹ä¸ä¸€æ ·ã€‚è¿™æ˜¯å› ä¸ºç”¨ç³»ç»Ÿçš„é€”å¾„ä¸èƒ½å®Œå…¨è·å¾—æˆ‘ä»¬æƒ³è¦çš„è¡¨ç°ï¼Œæ‰€ä»¥éœ€è¦è‡ªå·±é‡æ–°å®ç°è¿™ä¸ªåŠŸèƒ½ã€‚</p><p>å¦‚ä½ æ‰€æƒ³ï¼Œé‡å†™æ»‘åŠ¨å’Œåå¼¹ç‰©ç†æ•ˆæœä¸éœ€è¦é‚£ä¹ˆå¤æ‚ï¼Œæ‰€ä»¥æˆ‘ä»¬ç”¨ä¸€ä¸ª <code>UIScrollView</code> å’Œå°† <code>pagingEnabled</code> è®¾ä¸º true æ¥è·å¾—å°½å¯èƒ½è‡ªç”±çš„åå¼¹åŠ›ã€‚ç”¨å’Œ<a href="http://khanlou.com/2013/04/changing-the-size-of-a-paging-scroll-view/" target="_blank" rel="noopener">è¿™ç¯‡æ—§åšå®¢</a>é‡Œè¯´çš„ç±»ä¼¼çš„æŠ€æœ¯ï¼Œå°†æ»‘åŠ¨çš„è§†å›¾çš„ <code>bounds</code> è®¾ç½®å¾—æ›´å°ä¸€äº›å¹¶å°† <code>panGestureRecognizer</code> ç§»åˆ°äº‹ä»¶çš„ cell é¡¶å±‚çš„ä¸€ä¸ªè¦†ç›–è§†å›¾ä¸­ï¼Œæ¥è®¾ç½®ä¸€ä¸ªè‡ªå®šä¹‰é¡µé¢å¤§å°ã€‚</p><p>ç„¶è€Œï¼Œå½“è¦†ç›–è§†å›¾æ­£ç¡®çš„ä¼ é€’è§¦æ‘¸äº‹ä»¶åˆ° scroll view æ—¶ï¼Œé‚£é‡Œä¼šæœ‰è¦†ç›–è§†å›¾ä¸èƒ½æ­£ç¡®æ‹¦æˆªçš„å…¶ä»–äº‹ä»¶ã€‚cell åŒ…å«ç€æŒ‰é’®ï¼Œåƒ â€œjoin eventâ€ æŒ‰é’®å’Œ â€œdelete eventâ€ æŒ‰é’®ï¼Œéƒ½éœ€è¦æ¥æ”¶è§¦æ‘¸ã€‚æœ‰å‡ ç§è‡ªå®šä¹‰å®ç°åœ¨ <code>-hitTest:</code> ä¸­å¯ä»¥å¤„ç†è¿™ç§æƒ…å†µï¼Œå…¶ä¸­ä¸€ç§å®ç°å°±æ˜¯ç›´æ¥æ£€æŸ¥è¿™ä¸¤ä¸ªæŒ‰é’®çš„å­è§†å›¾ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">hitTest</span><span class="params">(<span class="number">_</span> point: CGPoint, with event: UIEvent?)</span></span> -&gt; <span class="type">UIView</span>? &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">guard</span> isUserInteractionEnabled <span class="keyword">else</span> &#123; <span class="keyword">return</span> <span class="literal">nil</span> &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">guard</span> !isHidden <span class="keyword">else</span> &#123; <span class="keyword">return</span> <span class="literal">nil</span> &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">guard</span> alpha &gt;= <span class="number">0.01</span> <span class="keyword">else</span> &#123; <span class="keyword">return</span> <span class="literal">nil</span> &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">guard</span> <span class="keyword">self</span>.point(inside: point, with: event) <span class="keyword">else</span> &#123; <span class="keyword">return</span> <span class="literal">nil</span> &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> joinButton.point(inside: convert(point, to: joinButton), with: event) &#123;</span><br><span class="line"><span class="keyword">return</span> joinButton</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> isDeleteButtonOpen &amp;&amp; deleteButton.point(inside: convert(point, to: deleteButton), with: event) &#123;</span><br><span class="line"><span class="keyword">return</span> deleteButton</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">super</span>.hitTest(point, with: event)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ç§æ–¹æ³•ä¼šæ­£ç¡®åœ°ä¼ é€’æ­£ç¡®çš„ç‚¹å‡»äº‹ä»¶åˆ°æ­£ç¡®çš„çš„æŒ‰é’®ä¸­ï¼Œè€Œä¸”ä¸ç”¨æ‰“æ–­æ˜¾ç¤ºåˆ é™¤æŒ‰é’®çš„æ»‘åŠ¨è¡¨ç°ã€‚ï¼ˆä½ å¯ä»¥å°è¯•åªå¿½ç•¥ <code>deletionOverlay</code>ï¼Œä¸è¿‡å®ƒä¸ä¼šæ­£ç¡®çš„ä¼ é€’æ»‘åŠ¨äº‹ä»¶ã€‚ï¼‰</p><p><code>-hitTest:</code> æ˜¯è§†å›¾ä¸­ä¸€ä¸ªå¾ˆå°‘é‡å†™çš„åœ°æ–¹ï¼Œä½†æ˜¯åœ¨éœ€è¦æ—¶ï¼Œå¯ä»¥æä¾›å…¶ä»–å·¥å…·å¾ˆéš¾åšåˆ°çš„è¡Œä¸ºã€‚ç†è§£å¦‚ä½•è‡ªå·±å®ç°æœ‰åŠ©äºéšæ„æ›¿æ¢å®ƒã€‚ä½ å¯ä»¥ç”¨è¿™ä¸ªæŠ€æœ¯å»æ‰©å¤§ç‚¹å‡»çš„ç›®æ ‡åŒºåŸŸï¼Œå»é™¤è§¦æ‘¸å¤„ç†ä¸­çš„æŸäº›å­è§†å›¾ï¼Œè€Œä¸ç”¨æŠŠå®ƒä»¬ä»å¯è§çš„å±‚çº§ä¸­å»æ‰ï¼Œåˆæˆ–æ˜¯ç”¨ä¸€ä¸ªè§†å›¾ä½œä¸ºå¦ä¸€ä¸ªå°†å“åº”è§¦æ‘¸çš„è§†å›¾çš„å…œåº•ã€‚æ‰€æœ‰ä¸œè¥¿éƒ½æ˜¯å¯èƒ½çš„ã€‚</p><blockquote><p>æœ¬æ–‡ç”± SwiftGG ç¿»è¯‘ç»„ç¿»è¯‘ï¼Œå·²ç»è·å¾—ä½œè€…ç¿»è¯‘æˆæƒï¼Œæœ€æ–°æ–‡ç« è¯·è®¿é—® <a href="http://swift.gg">http://swift.gg</a>ã€‚</p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;ä½œè€…ï¼šSoroush Khanlouï¼Œ&lt;a href=&quot;http://khanlou.com/2018/09/hacking-hit-tests/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;åŸæ–‡é“¾æ¥&lt;/a&gt;ï¼ŒåŸæ–‡æ—¥æœŸï¼š2018-09-07&lt;br&gt;è¯‘è€…ï¼š&lt;a href=&quot;https://nemocdz.github.io/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Nemocdz&lt;/a&gt;ï¼›æ ¡å¯¹ï¼š&lt;a href=&quot;http://blog.yousanflics.com.cn&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Yousanflics&lt;/a&gt;ï¼Œ&lt;a href=&quot;http://www.jianshu.com/users/596f2ba91ce9/latest_articles&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;pmst&lt;/a&gt;ï¼›å®šç¨¿ï¼š&lt;a href=&quot;http://forelax.space&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Forelax&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;!--æ­¤å¤„å¼€å§‹æ­£æ–‡--&gt;
&lt;p&gt;å›æƒ³ &lt;a href=&quot;https://developer.apple.com/videos/play/wwdc2015/408/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Crusty æ•™æˆ‘ä»¬ä½¿ç”¨é¢å‘åè®®ç¼–ç¨‹&lt;/a&gt;ä¹‹å‰çš„æ—¥å­ï¼Œæˆ‘ä»¬å¤§å¤šä½¿ç”¨ç»§æ‰¿æ¥å…±äº«ä»£ç çš„å®ç°ã€‚é€šå¸¸åœ¨ UIKit ç¼–ç¨‹ä¸­ï¼Œä½ å¯èƒ½ä¼šç”¨ &lt;code&gt;UIView&lt;/code&gt; çš„å­ç±»å»æ·»åŠ ä¸€äº›å­è§†å›¾ï¼Œé‡å†™ &lt;code&gt;-layoutSubviews&lt;/code&gt;ï¼Œç„¶åé‡å¤è¿™äº›å·¥ä½œã€‚ä¹Ÿè®¸ä½ è¿˜ä¼šé‡å†™ &lt;code&gt;-drawRect&lt;/code&gt;ã€‚ä½†å½“ä½ éœ€è¦åšä¸€äº›ç‰¹åˆ«çš„äº‹æƒ…æ—¶ï¼Œå°±éœ€è¦çœ‹çœ‹ &lt;code&gt;UIView&lt;/code&gt; ä¸­å…¶ä»–å¯ä»¥è¢«é‡å†™çš„æ–¹æ³•ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="KHANLOU" scheme="https://swift.gg/categories/KHANLOU/"/>
    
    
      <category term="iOSå¼€å‘" scheme="https://swift.gg/tags/iOS%E5%BC%80%E5%8F%91/"/>
    
  </entry>
  
  <entry>
    <title>å›ºå®šå¤§å°çš„æ•°ç»„</title>
    <link href="https://swift.gg/2018/12/24/fixed-sized-arrays/"/>
    <id>https://swift.gg/2018/12/24/fixed-sized-arrays/</id>
    <published>2018-12-24T00:00:00.000Z</published>
    <updated>2019-02-19T03:45:13.515Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ä½œè€…ï¼šRuss Bishopï¼Œ<a href="http://www.russbishop.net/fixed-sized-arrays" target="_blank" rel="noopener">åŸæ–‡é“¾æ¥</a>ï¼ŒåŸæ–‡æ—¥æœŸï¼š2018-10-30<br>è¯‘è€…ï¼š<a href="https://github.com/zhongWJ" target="_blank" rel="noopener">zhongWJ</a>ï¼›æ ¡å¯¹ï¼š<a href="http://numbbbbb.com/" target="_blank" rel="noopener">numbbbbb</a>ï¼Œ<a href="https://github.com/Cee" target="_blank" rel="noopener">Cee</a>ï¼›å®šç¨¿ï¼š<a href="http://forelax.space" target="_blank" rel="noopener">Forelax</a></p></blockquote><!--æ­¤å¤„å¼€å§‹æ­£æ–‡--><p>å‡è®¾æˆ‘ä»¬æƒ³è¦ç”¨ <code>statfs()</code> æ–¹æ³•æ¥ç¡®å®šæŸä¸ªæŒ‚è½½ç‚¹æ‰€å¯¹åº”çš„ <code>BSD</code> è®¾å¤‡åã€‚ä¾‹å¦‚æŒ‚è½½ç‚¹ <code>/Volumes/MyDisk</code> å¯¹åº”çš„ <code>BSD</code> è®¾å¤‡æ˜¯ <code>/dev/disk6s2</code>ã€‚</p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">statfs</span> <span class="title">fsinfo</span>;</span></span><br><span class="line"><span class="keyword">if</span> (statfs(path, &amp;fsinfo) != <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="comment">//é”™è¯¯</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><a id="more"></a><p>åŒç­‰çš„ Swift ä»£ç å¦‚ä¸‹ï¼Œåªä¸è¿‡å¤šäº†ä¸ª <code>POSIX</code> é”™è¯¯å¸®åŠ©æ–¹æ³•ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">posix_expects_zero</span>&lt;R: BinaryInteger&gt;<span class="params">(<span class="number">_</span> f: @autoclosure <span class="params">()</span></span></span> <span class="keyword">throws</span> -&gt; <span class="type">R</span>) <span class="keyword">throws</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> returncode = <span class="keyword">try</span> f()</span><br><span class="line">    <span class="keyword">if</span> returncode != <span class="number">0</span> &#123;</span><br><span class="line">        <span class="comment">// å¦‚æœéœ€è¦ï¼Œè¯·åœ¨æ­¤å¤„æ›¿æ¢ä¸ºè‡ªå®šä¹‰çš„é”™è¯¯ç±»å‹ã€‚</span></span><br><span class="line">        <span class="comment">// NSError ä¼šè‡ªåŠ¨å¸®æˆ‘ä»¬é€šè¿‡é”™è¯¯ç å¾—åˆ°å¯¹åº”çš„ C å­—ç¬¦ä¸²é”™è¯¯æ¶ˆæ¯ã€‚</span></span><br><span class="line">        <span class="keyword">throw</span> <span class="type">NSError</span>(</span><br><span class="line">            domain: <span class="type">NSPOSIXErrorDomain</span>,</span><br><span class="line">            code: <span class="built_in">numericCast</span>(returncode),</span><br><span class="line">            userInfo: <span class="literal">nil</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// é‡‡ç”¨é»˜è®¤çš„ç©ºåˆå§‹åŒ–æ–¹æ³•ã€‚Swift èƒ½æ¨æ–­å‡ºç»“æ„ä½“ç±»å‹ï¼Œ</span></span><br><span class="line"><span class="comment">// ä½†ä¸ºäº†è¡¨ç¤ºå¾—æ›´æ¸…æ¥šï¼Œè¿™é‡Œæ˜¾å¼æŒ‡å®šç±»å‹</span></span><br><span class="line"><span class="keyword">var</span> fsinfo: statfs = statfs()</span><br><span class="line">statfs(path, &amp;fsinfo)</span><br></pre></td></tr></table></figure><h2 id="C-çš„å¼•å…¥ç‰©"><a href="#C-çš„å¼•å…¥ç‰©" class="headerlink" title="C çš„å¼•å…¥ç‰©"></a>C çš„å¼•å…¥ç‰©</h2><p><code>statfs()</code> å‡½æ•°åœ¨ C è¯­è¨€çš„å®šä¹‰æ˜¯ <code>int statfs(const char *path, struct statfs *info)</code>ã€‚<code>statfs</code> ç»“æ„ä½“æœ‰å¤šä¸ªå­—æ®µï¼Œä½†æˆ‘ä»¬åªå…³æ³¨ <code>mount-from-name</code>ï¼š</p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">statfs</span> &#123;</span></span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">    <span class="keyword">char</span> f_mntfromname[MAXPATHLEN];</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>åœ¨è‹¹æœå¹³å°ä¸Š MAXPATHLEN == PATH_MAX == 1024ã€‚</p><p>å¦‚æœä½ åœ¨ä»£ç é‡Œç¡¬ç¼–ç  1024 è€Œä¸æ˜¯ç”¨æ›´åˆé€‚çš„å®ï¼Œå°å¿ƒæˆ‘çš„é¬¼é­‚ä¼šç¼ ç€ä½ å’Œä½ çš„å®¶æ—åäºŒä»£å“¦ã€‚</p></blockquote><p>å™¢å“¦ã€‚ä¸€ä¸ªå›ºå®šå¤§å°çš„æ•°ç»„ã€‚å½“è¢«å¼•å…¥ Swift ä¸­æ—¶ï¼Œå®ƒä¼šè¢«å½“åšä¸€ä¸ªæœ‰ 1024 ä¸ªå…ƒç´ çš„å…ƒç»„ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">var</span> f_mntfromname: (<span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>)</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªç±»å‹ä¸æ˜¯å¾ˆå®ç”¨ã€‚é‚£æˆ‘ä»¬èƒ½ä¸èƒ½åšç‚¹ä»€ä¹ˆå‘¢ï¼Ÿç”±äºè¿™ç¯‡åšå®¢çš„å­˜åœ¨ï¼Œä½ å¯èƒ½å·²ç»çŒœåˆ°ç­”æ¡ˆæ˜¯ã€Œ<em>æ˜¯</em>ã€ã€‚</p><h2 id="C-å­—ç¬¦ä¸²"><a href="#C-å­—ç¬¦ä¸²" class="headerlink" title="C å­—ç¬¦ä¸²"></a>C å­—ç¬¦ä¸²</h2><p>è¿™ä¸ªå›ºå®šå¤§å°çš„æ•°ç»„åŒ…å«äº† <code>char</code>ã€‚ç”±äºæ–‡æ¡£æœªæ›¾æåŠï¼Œæ‰€ä»¥æˆ‘ä»¬å¹¶ä¸çŸ¥é“æ˜¯å¦é€šè¿‡ç©ºå­—ç¬¦æ¥è¡¨ç¤ºæ•°ç»„çš„ç»ˆæ­¢ã€‚ä»¤äººæ¼ç«çš„æ˜¯ï¼Œæ–‡æ¡£æš—ç¤ºåœ¨ 64 ä½ç³»ç»Ÿä¸Šï¼Œ<code>f_fstypename</code> å­—æ®µæ˜¯ç”±ç©ºå­—ç¬¦ç»ˆæ­¢ï¼Œä½†å¯¹äº mount to/from ä¸¤ä¸ªå­—æ®µå´åªå­—æœªæã€‚è¿™ä¸¤ä¸ªå­—æ®µæ˜¯æ ¹æ®è¢«å®šä¹‰ä¸º <code>PATH_MAX</code> çš„ <code>MAXPATHLEN</code> å®æ¥å®šä¹‰çš„è€Œä¸æ˜¯ç›´æ¥æ ¹æ® <code>PATH_MAX</code> å®ï¼Œè€Œ <code>PATH_MAX</code> å®é€šå¸¸æš—ç¤ºæ•°ç»„ç”±ç©ºå­—ç¬¦æ¥è¡¨ç¤ºç»ˆæ­¢ã€‚æˆ‘ä»¬æ˜¯ä¸æ˜¯åº”è¯¥ä»ä¸­å¾—åˆ°ä¸€ç‚¹å¯å‘å‘¢ï¼Ÿ</p><p>å¯¹äºå›ºå®šå¤§å°çš„æ•°ç»„ï¼Œæœ‰ä¸€äº› C API ä»ç„¶é‡‡ç”¨ç©ºç»ˆæ­¢ç¬¦ï¼ˆæ‰€ä»¥çœŸå®çš„å­—ç¬¦ä¸²é•¿åº¦æœ€é•¿å¯ä»¥æ˜¯ <code>sizeof(array) - 1</code>ï¼‰ï¼Œè€Œå¦ä¸€äº›åˆ™ä¹æ„å¡«å……æ•´ä¸ªç¼“å†²åŒºï¼ˆæ‰€ä»¥ä¸ä»¥ç©ºå­—ç¬¦ç»“å°¾çš„å­—ç¬¦ä¸²é•¿åº¦æœ€é•¿å¯ä»¥æ˜¯ <code>sizeof(array)</code>ï¼‰ã€‚è¿™å°±æ˜¯é‚£ç§æœ‰å®³çš„ç»Šè„šçŸ³ï¼Œå®ƒè®©ä½ çš„ç¨‹åºçœ‹èµ·æ¥è¿è¡Œæ­£å¸¸å¹¶é€šè¿‡æ‰€æœ‰æµ‹è¯•ï¼Œç„¶åç¢°åˆ°æŸäº›æ–°çš„ FizzyWizz ç¡¬ç›˜ç³»ç»Ÿä¼šæœ‰çš„å¥‡æ€ªçš„è¾¹ç•Œæƒ…å†µæ—¶ï¼Œå½“çªç„¶ç¢°åˆ°ä¸€ä¸ªåˆšå¥½ç”± 1024 ä¸ªå­—ç¬¦ç»„æˆçš„åç§°ç‰¹åˆ«é•¿çš„ BSD è®¾å¤‡æ—¶ï¼Œç»“æœå°±æ˜¯ä½ çš„ç¨‹åºå‡ºç°äº†ã€Œ<em>å¯åˆ©ç”¨å†…å­˜æŸå</em>ã€é”™è¯¯ã€‚</p><p>è¿™äº›å€¼å¾ˆæœ‰å¯èƒ½æ˜¯ç©ºå­—ç¬¦ç»ˆæ­¢çš„ï¼ˆä¹Ÿå¯èƒ½ä¸æ˜¯ï¼‰ï¼Œä½†æˆ‘ä¼šå‘Šè¯‰ä½ å¦‚ä½•æ¥å¤„ç†è¿™ä¸ªé—®é¢˜ï¼Œä»¥ä¾¿åœ¨ä¸¤ç§æƒ…å†µä¸‹éƒ½é€‚ç”¨ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬å†ä¹Ÿä¸éœ€è¦è€ƒè™‘è¿™ä¸ªé—®é¢˜ï¼Œä»è€Œé™ä½å¤§è„‘è´Ÿè·ã€‚åœ¨å…¶ä»–åœºæ™¯å¤ç”¨è¿™ä¸ªä»£ç çš„äººä¹Ÿä¸éœ€è¦å†è€ƒè™‘è¿™ä¸ªé—®é¢˜äº†ã€‚æ—¢ç„¶æœ‰è¿™ä¹ˆå¤§çš„å¥½å¤„ï¼Œä½•ä¸é©¬ä¸Šå¼€å§‹ï¼Ÿ</p><p>åé¢˜äº†ï¼Œè®©æˆ‘ä»¬å›åˆ°æ­£é¢˜â€¦â€¦</p><h2 id="éƒ¨åˆ†è§£å†³æ–¹æ¡ˆ"><a href="#éƒ¨åˆ†è§£å†³æ–¹æ¡ˆ" class="headerlink" title="éƒ¨åˆ†è§£å†³æ–¹æ¡ˆ"></a>éƒ¨åˆ†è§£å†³æ–¹æ¡ˆ</h2><p>é¦–å…ˆæˆ‘ä»¬éœ€è¦è®¡ç®—å­—æ®µçš„åç§»é‡ã€‚ç”¨æ–°çš„ <code>MemoryLayout.offset</code> æ–¹æ³•å¯ä»¥å¾—åˆ°ç»“æœï¼š<code>MemoryLayout&lt;statfs&gt;.offset(of: \Darwin.statfs.f_mntfromname)!</code>ã€‚ç”±äºç»“æ„ä½“å’Œå‡½æ•°åå­—ç›¸åŒï¼Œå½“æˆ‘ä»¬æ„é€ å…³é”®è·¯å¾„æ—¶ï¼Œéœ€è¦æä¾›å®Œæ•´çš„è·¯å¾„åï¼ˆfully-qualified nameï¼‰ï¼Œå¦åˆ™ä¼šå¾—åˆ°ã€Œ<em>æ— æ³•ç¡®å®šæœ‰æ­§ä¹‰çš„å¼•ç”¨è·¯å¾„</em>ã€çš„é”™è¯¯ã€‚æˆ‘ä»¬å¯ä»¥å¼ºåˆ¶è§£åŒ…è¿”å›å€¼å› ä¸ºæˆ‘ä»¬çŸ¥é“å…³é”®è·¯å¾„æœ‰æ•ˆå¹¶ä¸”å­—æ®µæœ‰åç§»é‡ã€‚</p><p>å°†å­—æ®µçš„å†…å­˜å¸ƒå±€åç§»é‡åŠ ä¸Š <code>withUnsafePointer</code> æŒ‡é’ˆå°±å¯ä»¥å¾—åˆ°ä¸€ä¸ªæŒ‡å‘ç»“æ„ä½“å­—æ®µèµ·å§‹å†…å­˜çš„æŒ‡é’ˆã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™ç§æ–¹å¼åˆ›å»ºä¸€ä¸ªå­—ç¬¦ä¸²å¯¹è±¡ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">return</span> <span class="built_in">withUnsafePointer</span>(to: fsinfo, &#123; (ptr) -&gt; <span class="type">String</span>? <span class="keyword">in</span></span><br><span class="line">    <span class="keyword">let</span> offset = <span class="type">MemoryLayout</span>&lt;statfs&gt;.offset(of: \<span class="type">Darwin</span>.statfs.f_mntfromname)!</span><br><span class="line">    <span class="keyword">let</span> fieldPtr = (<span class="type">UnsafeRawPointer</span>(ptr) + offset).assumingMemoryBound(to: <span class="type">UInt8</span>.<span class="keyword">self</span>)</span><br><span class="line">    <span class="keyword">if</span> fieldPtr[<span class="built_in">count</span> - <span class="number">1</span>] != <span class="number">0</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> data = <span class="type">Data</span>(bytes: <span class="type">UnsafeRawPointer</span>(fieldPtr), <span class="built_in">count</span>: <span class="built_in">count</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="type">String</span>(data: data, encoding: .utf8)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="type">String</span>(cString: fieldPtr)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬é¦–å…ˆå¿«é€Ÿæ£€æŸ¥äº†ç¼“å†²åŒºæ˜¯å¦æ˜¯ç©ºå­—ç¬¦ç»“å°¾ã€‚å¦‚æœæ˜¯ï¼Œå°±é‡‡ç”¨ C å­—ç¬¦ä¸²è¿™æ¡æ·å¾„ã€‚åä¹‹ï¼Œä¸ºäº†ä¾¿äºä½¿ç”¨ String çš„é•¿åº¦é™åˆ¶æ„é€ æ–¹æ³•ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª Data å®ä¾‹ã€‚çœ‹èµ·æ¥ç”¨ <code>Data(bytesNoCopy:count:deallocator:)</code> ä¹Ÿè¡Œï¼Œä½† <code>String(data:encoding:)</code> åˆå§‹åŒ–æ–¹æ³•å¹¶ä¸ä¿è¯æ‹·è´ Data åº•å±‚çš„ç¼“å†²åŒºï¼Œ<code>Data</code> çš„æ„é€ è¿‡ç¨‹ä¹ŸåŒæ ·å¦‚æ­¤ã€‚è™½ç„¶è¿™ç§æƒ…å†µæå°‘è§ï¼Œæˆ‘ä»¬è¿˜æ˜¯è°¨æ…ä¸ºå¥½ã€‚ï¼ˆå‡å¦‚ç›®å‰çš„æ–¹æ³•ä¼šå¯¼è‡´æ€§èƒ½é—®é¢˜ï¼Œæˆ‘å¯èƒ½ä¼šèŠ±æ—¶é—´è°ƒç ”å…¶ä»–æ–¹æ¡ˆã€‚ï¼‰</p><p>æœ‰ä¸€ç§å¯èƒ½æƒ…å†µæ˜¯ï¼Œå…ˆå†™å…¥ç”±ç©ºå­—ç¬¦ç»ˆæ­¢çš„è¾ƒçŸ­çš„å­—ç¬¦ä¸²åˆ°ç¼“å†²åŒºï¼Œå‰©ä½™çš„éƒ¨åˆ†åˆ™æ˜¯è¢«åƒåœ¾æ•°æ®å¡«å……ã€‚ç”±äº Swift åœ¨åˆå§‹åŒ–ç»“æ„ä½“æ—¶ä¼šå¼ºåˆ¶æ¸…é™¤å†…å­˜ï¼Œæ‰€ä»¥åªæœ‰å½“å†…æ ¸æ‹·è´åƒåœ¾æ•°æ®åˆ°è¿™å—åœ°å€æ—¶ï¼Œä¸Šè¿°æƒ…å†µæ‰å¯èƒ½å‘ç”Ÿã€‚æˆ‘ä»¬å¯ä»¥å¿½ç•¥è¿™ç§æƒ…å†µï¼Œå› ä¸ºå†…æ ¸ä¼šå°½é‡é¿å…æ³„æ¼å†…æ ¸å†…å­˜åˆ°ç”¨æˆ·ç©ºé—´ï¼Œå¦åˆ™æˆ‘ä»¬å°±åªèƒ½ç”¨æ›´è€—æ—¶çš„æ–¹å¼äº†ã€‚ï¼ˆå°†è¿™äº›å­—èŠ‚è½¬æ¢ä¸ºå­—ç¬¦ä¸²çš„æ–¹å¼æ•°ä¸èƒœæ•°ï¼Œæˆ‘è¿™é‡Œå°±ä¸ä¸€ä¸€åˆ—ä¸¾äº†ã€‚ï¼‰</p><p>ç°åœ¨æˆ‘ä»¬æ¥å®ç° <code>statfs</code> çš„æ‰©å±•ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">statfs</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> mntfromname: <span class="type">String</span>? &#123;</span><br><span class="line">        <span class="keyword">mutating</span> <span class="keyword">get</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">withUnsafePointer</span>(to: fsinfo, &#123; (ptr) -&gt; <span class="type">String</span>? <span class="keyword">in</span></span><br><span class="line">                <span class="keyword">let</span> offset = <span class="type">MemoryLayout</span>&lt;statfs&gt;.offset(of: \<span class="type">Darwin</span>.statfs.f_mntfromname)!</span><br><span class="line">                <span class="keyword">let</span> fieldPtr = (<span class="type">UnsafeRawPointer</span>(ptr) + offset).assumingMemoryBound(to: <span class="type">UInt8</span>.<span class="keyword">self</span>)</span><br><span class="line">                <span class="keyword">let</span> <span class="built_in">count</span> = <span class="type">Int</span>(<span class="type">MAXPATHLEN</span>)</span><br><span class="line">                <span class="keyword">if</span> fieldPtr[<span class="built_in">count</span> - <span class="number">1</span>] != <span class="number">0</span> &#123;</span><br><span class="line">                    <span class="keyword">let</span> data = <span class="type">Data</span>(bytes: <span class="type">UnsafeRawPointer</span>(fieldPtr), <span class="built_in">count</span>: <span class="built_in">count</span>)</span><br><span class="line">                    <span class="keyword">return</span> <span class="type">String</span>(data: data, encoding: .utf8)</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="type">String</span>(cString: fieldPtr)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ®µä»£ç å¾ˆç®¡ç”¨ï¼Œä½†å‡å¦‚æˆ‘ä»¬ä¹Ÿæƒ³å¤„ç†åˆ«çš„å­—æ®µï¼Œä¾‹å¦‚ <code>f_mntoname</code> å‘¢ï¼Ÿå¤åˆ¶ä»£ç ä¼¼ä¹ä¸æ€ä¹ˆå¥½ï¼Œæ‰€ä»¥è®©è¿™æ®µä»£ç æ”¯æŒæ³›å‹ï¼Œä½¿ä¹‹æ›´åŠ é€šç”¨æ‰å¯¹ï¼›æˆ‘ä»¬åªéœ€è¦æ¥å— key path å’Œ count ä½œä¸ºå‚æ•°ï¼Œå†ç¨ä½œä¿®æ”¹å°±å¯ä»¥äº†ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">fixedArrayToString</span>&lt;T&gt;<span class="params">(t: T, keyPath: PartialKeyPath&lt;T&gt;, <span class="built_in">count</span>: Int)</span></span> -&gt; <span class="type">String</span>? &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">withUnsafePointer</span>(to: t) &#123; (ptr) -&gt; <span class="type">String</span>? <span class="keyword">in</span></span><br><span class="line">        <span class="keyword">let</span> offset = <span class="type">MemoryLayout</span>&lt;<span class="type">T</span>&gt;.offset(of: keyPath)!</span><br><span class="line">        <span class="keyword">let</span> fieldPtr = (<span class="type">UnsafeRawPointer</span>(ptr) + offset).assumingMemoryBound(to: <span class="type">UInt8</span>.<span class="keyword">self</span>)</span><br><span class="line">        <span class="keyword">if</span> fieldPtr[<span class="built_in">count</span> - <span class="number">1</span>] != <span class="number">0</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> data = <span class="type">Data</span>(bytes: <span class="type">UnsafeRawPointer</span>(fieldPtr), <span class="built_in">count</span>: <span class="built_in">count</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="type">String</span>(data: data, encoding: .utf8)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="type">String</span>(cString: fieldPtr)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">statfs</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> mntfromname: <span class="type">String</span>? &#123;</span><br><span class="line">        <span class="keyword">get</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> fixedArrayToString(</span><br><span class="line">                t: <span class="keyword">self</span>,</span><br><span class="line">                keyPath: \<span class="type">Darwin</span>.statfs.f_mntfromname,</span><br><span class="line">                <span class="built_in">count</span>: <span class="type">Int</span>(<span class="type">MAXPATHLEN</span>))</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> mntonname: <span class="type">String</span>? &#123;</span><br><span class="line">        <span class="keyword">get</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> fixedArrayToString(</span><br><span class="line">                t: <span class="keyword">self</span>,</span><br><span class="line">                keyPath: \<span class="type">Darwin</span>.statfs.f_mntonname,</span><br><span class="line">                <span class="built_in">count</span>: <span class="type">Int</span>(<span class="type">MAXPATHLEN</span>))</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ç»“è¯­"><a href="#ç»“è¯­" class="headerlink" title="ç»“è¯­"></a>ç»“è¯­</h2><p>ç°åœ¨ä½ çŸ¥é“æ€ä¹ˆæŠŠæœ‰ N ä¸ªå…ƒç´ çš„å…ƒç»„å˜æˆæ›´å®ç”¨çš„ä¸œè¥¿äº†å§ã€‚</p><blockquote><p>æœ¬æ–‡ç”± SwiftGG ç¿»è¯‘ç»„ç¿»è¯‘ï¼Œå·²ç»è·å¾—ä½œè€…ç¿»è¯‘æˆæƒï¼Œæœ€æ–°æ–‡ç« è¯·è®¿é—® <a href="http://swift.gg">http://swift.gg</a>ã€‚</p></blockquote>]]></content>
    
    <summary type="html">
    
      å¦‚ä½•åœ¨ Swift ä¸­å¤„ç†ä» C è¯­è¨€å¼•å…¥çš„å›ºå®šå¤§å°æ•°ç»„
    
    </summary>
    
      <category term="Swift" scheme="https://swift.gg/categories/Swift/"/>
    
    
      <category term="Swift" scheme="https://swift.gg/tags/Swift/"/>
    
  </entry>
  
  <entry>
    <title>Swift å±æ€§è§‚å¯Ÿå™¨</title>
    <link href="https://swift.gg/2018/12/17/swift-property-observers/"/>
    <id>https://swift.gg/2018/12/17/swift-property-observers/</id>
    <published>2018-12-17T00:00:00.000Z</published>
    <updated>2019-02-19T03:45:13.515Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ä½œè€…ï¼šMatttï¼Œ<a href="https://nshipster.com/swift-property-observers/" target="_blank" rel="noopener">åŸæ–‡é“¾æ¥</a>ï¼ŒåŸæ–‡æ—¥æœŸï¼š2018-08-20<br>è¯‘è€…ï¼š<a href="http://wuqiuhao.github.io" target="_blank" rel="noopener">Hale</a>ï¼›æ ¡å¯¹ï¼š<a href="http://numbbbbb.com/" target="_blank" rel="noopener">numbbbbb</a>ï¼Œ<a href="http://www.jianshu.com/users/596f2ba91ce9/latest_articles" target="_blank" rel="noopener">pmst</a>ï¼Œ<a href="http://blog.yousanflics.com.cn" target="_blank" rel="noopener">Yousanflics</a>ï¼›å®šç¨¿ï¼š<a href="http://forelax.space" target="_blank" rel="noopener">Forelax</a></p></blockquote><!--æ­¤å¤„å¼€å§‹æ­£æ–‡--><p>åˆ°äº† 20 ä¸–çºª 30 å¹´ä»£ï¼ŒRube Goldberg å·²æˆä¸ºå®¶å–»æˆ·æ™“çš„åå­—ï¼Œä¸ <a href="https://upload.wikimedia.org/wikipedia/commons/a/a9/Rube_Goldberg%27s_%22Self-Operating_Napkin%22_%28cropped%29.gif" target="_blank" rel="noopener">â€œè‡ªè¥é¤å·¾â€</a> ç­‰æ¼«ç”»ä¸­æç»˜çš„å¥‡å¼‚å¤æ‚å’Œå¼‚æƒ³å¤©å¼€çš„å‘æ˜åŒä¹‰ã€‚å¤§çº¦åœ¨åŒä¸€æ—¶æœŸï¼Œé˜¿å°”ä¼¯ç‰¹Â·çˆ±å› æ–¯å¦å¯¹å°¼å°”æ–¯Â·ç»å°”é‡å­åŠ›å­¦çš„æ™®éè§£é‡Šè¿›è¡Œäº† <a href="https://en.wikipedia.org/wiki/EPR_paradox" target="_blank" rel="noopener">æ‰¹åˆ¤</a>ï¼Œå¹¶ä»ä¸­æå‡ºäº†â€œé¬¼é­…ä¼¼çš„è¿œè·ä½œç”¨â€è¿™ä¸€è¯æ±‡ã€‚</p><p>è¿‘ä¸€ä¸ªä¸–çºªä¹‹åï¼Œç°ä»£è½¯ä»¶å¼€å‘å·²ç»è¢«è§†ä¸ºå¯èƒ½æˆä¸º Goldbergian è£…ç½®çš„å…¸èŒƒâ€”â€”é€šè¿‡é‡å­è®¡ç®—æœºç›¸ä¿¡æˆ‘ä»¬ä¼šè¶Šæ¥è¶Šæ¥è¿‘è¿™ä¸ªé¬¼é­…çš„é¢†åŸŸã€‚</p><p>ä½œä¸ºè½¯ä»¶å¼€å‘äººå‘˜ï¼Œæˆ‘ä»¬æå€¡å°½å¯èƒ½å‡å°‘ä»£ç ä¸­çš„è¿œç¨‹æ“ä½œã€‚è¿™æ˜¯æ ¹æ®ä¸€äº›ä¼—æ‰€å‘¨çŸ¥çš„è§„èŒƒæ³•åˆ™å¾—å‡ºçš„ï¼Œå¦‚ <a href="https://en.wikipedia.org/wiki/Single_responsibility_principle" target="_blank" rel="noopener">å•ä¸€èŒè´£åŸåˆ™</a>ã€<a href="https://en.wikipedia.org/wiki/Principle_of_least_astonishment" target="_blank" rel="noopener">æœ€å°‘æ„å¤–åŸåˆ™</a> å’Œ <a href="https://en.wikipedia.org/wiki/Law_of_Demeter" target="_blank" rel="noopener">ç¬›ç±³ç‰¹æ³•åˆ™</a>ã€‚å°½ç®¡å®ƒä»¬å¯èƒ½ä¼šå¯¹ä»£ç äº§ç”Ÿä¸€å®šçš„å‰¯ä½œç”¨ï¼Œä½†æ›´å¤šçš„æ—¶å€™è¿™äº›åŸåˆ™èƒ½ä½¿ä»£ç é€»è¾‘å˜å¾—æ¸…æ™°ã€‚</p><p>è¿™æ˜¯æœ¬å‘¨å…³äº Swift å±æ€§è§‚å¯Ÿæ–‡ç« çš„ç„¦ç‚¹ï¼Œå®ƒæå‡ºäº†ä¸€ç§å†…ç½®çš„è½»é‡çº§æ›¿ä»£æ–¹æ¡ˆï¼Œé€‚ç”¨äºæ›´æ­£å¼çš„è§£å†³æ–¹æ¡ˆï¼Œå¦‚æ¨¡å‹ - è§†å›¾ - è§†å›¾æ¨¡å‹ï¼ˆMVVMï¼‰å‡½æ•°å“åº”å¼ç¼–ç¨‹ï¼ˆFRPï¼‰ã€‚</p><a id="more"></a><p>Swift ä¸­æœ‰ä¸¤ç§å±æ€§ï¼š<em>å­˜å‚¨å±æ€§</em>ï¼Œå®ƒä»¬å°†çŠ¶æ€å’Œå¯¹è±¡ç›¸å…³è”ï¼›<em>è®¡ç®—å±æ€§</em>ï¼Œåˆ™æ ¹æ®è¯¥çŠ¶æ€æ‰§è¡Œè®¡ç®—ã€‚ä¾‹å¦‚ï¼Œ</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">S</span> </span>&#123;</span><br><span class="line">    <span class="comment">// å­˜å‚¨å±æ€§</span></span><br><span class="line">    <span class="keyword">var</span> stored: <span class="type">String</span> = <span class="string">"stored"</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// è®¡ç®—å±æ€§</span></span><br><span class="line">    <span class="keyword">var</span> computed: <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"computed"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“ä½ å£°æ˜ä¸€ä¸ªå­˜å‚¨å±æ€§ï¼Œä½ å¯ä»¥ä½¿ç”¨é—­åŒ…å®šä¹‰ä¸€ä¸ª <em>å±æ€§è§‚å¯Ÿå™¨</em>ï¼Œè¯¥é—­åŒ…ä¸­çš„ä»£ç ä¼šåœ¨å±æ€§è¢«è®¾å€¼çš„æ—¶å€™æ‰§è¡Œã€‚<code>willSet</code> è§‚å¯Ÿå™¨ä¼šåœ¨å±æ€§è¢«èµ‹æ–°å€¼ä¹‹å‰è¢«è¿è¡Œï¼Œ<code>didSet</code> è§‚å¯Ÿå™¨åˆ™ä¼šåœ¨å±æ€§è¢«èµ‹æ–°å€¼ä¹‹åè¿è¡Œã€‚æ— è®ºæ–°å€¼æ˜¯å¦ç­‰äºå±æ€§çš„æ—§å€¼å®ƒä»¬éƒ½ä¼šè¢«æ‰§è¡Œã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">S</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> stored: <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">willSet</span> &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"willSet was called"</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"stored is now equal to <span class="subst">\(<span class="keyword">self</span>.stored)</span>"</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"stored will be set to <span class="subst">\(newValue)</span>"</span>)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">didSet</span> &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"didSet was called"</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"stored is now equal to <span class="subst">\(<span class="keyword">self</span>.stored)</span>"</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"stored was previously set to <span class="subst">\(oldValue)</span>"</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¾‹å¦‚ï¼Œè¿è¡Œä¸‹é¢çš„ä»£ç åœ¨æ§åˆ¶å°çš„è¾“å‡ºå¦‚ä¸‹ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> s = <span class="type">S</span>(stored: <span class="string">"first"</span>)</span><br><span class="line">s.stored = <span class="string">"second"</span></span><br></pre></td></tr></table></figure><ul><li>willSet was called</li><li>stored is now equal to first</li><li>stored will be set to second</li><li>didSet was called</li><li>stored is now equal to second</li><li>stored was previously set to first</li></ul><blockquote><p>éœ€è¦æ³¨æ„çš„æ˜¯å½“å±æ€§åœ¨åˆå§‹åŒ–æ–¹æ³•ä¸­è¿›è¡Œèµ‹å€¼æ—¶ï¼Œä¸ä¼šè§¦å‘è§‚å¯Ÿå™¨çš„ä»£ç ã€‚ä» Swift4.2 å¼€å§‹ï¼Œä½ å¯ä»¥å°†èµ‹å€¼é€»è¾‘åŒ…è£…åœ¨ <code>defer</code> ä»£ç å—æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä½†è¿™æ˜¯ <a href="https://twitter.com/jckarter/status/926459181661536256" target="_blank" rel="noopener">ä¸€ä¸ªå¾ˆå¿«å°±ä¼šè¢«ä¿®å¤çš„é—®é¢˜</a>ï¼Œå› æ­¤ä½ ä¸éœ€è¦ä¾èµ–äºè¿™ç§è¡Œä¸ºã€‚</p></blockquote><p>Swift çš„å±æ€§è§‚å¯Ÿå™¨ä»ä¸€å¼€å§‹å°±æ˜¯è¯­è¨€çš„ä¸€éƒ¨åˆ†ã€‚ä¸ºäº†æ›´å¥½åœ°ç†è§£å…¶åŸç†ï¼Œè®©æˆ‘ä»¬å¿«é€Ÿäº†è§£ä¸€ä¸‹å®ƒåœ¨ Objective-C ä¸­çš„å·¥ä½œåŸç†ã€‚</p><h1 id="Objective-C-ä¸­çš„å±æ€§"><a href="#Objective-C-ä¸­çš„å±æ€§" class="headerlink" title="Objective-C ä¸­çš„å±æ€§"></a>Objective-C ä¸­çš„å±æ€§</h1><p>ä»æŸç§æ„ä¹‰ä¸Šè¯´ï¼ŒObjective-C ä¸­çš„æ‰€æœ‰å±æ€§éƒ½æ˜¯è¢«è®¡ç®—å‡ºæ¥çš„ã€‚æ¯æ¬¡é€šè¿‡ç‚¹è¯­æ³•è®¿é—®å±æ€§æ—¶ï¼Œéƒ½ä¼šè½¬æ¢ä¸ºç­‰æ•ˆçš„ getter æˆ– setter æ–¹æ³•è°ƒç”¨ã€‚è¿™äº›è°ƒç”¨æœ€ç»ˆè¢«ç¼–è¯‘æˆæ¶ˆæ¯å‘é€ï¼Œéšåå†æ‰§è¡Œè¯»å–æˆ–å†™å…¥å®ä¾‹å˜é‡çš„æ–¹æ³•ã€‚</p><figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ç‚¹è¯­æ³•è®¿é—®</span></span><br><span class="line">person.name = <span class="string">@"Johnny"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ...ç­‰ä»·äº</span></span><br><span class="line">[person setName:<span class="string">@"Johnny"</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// ...å®ƒè¢«ç¼–è¯‘æˆ</span></span><br><span class="line">objc_msgSend(person, <span class="keyword">@selector</span>(setName:), <span class="string">@"Johnny"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ...æœ€ç»ˆå®ç°</span></span><br><span class="line">person-&gt;_name = <span class="string">@"Johnny"</span>;</span><br></pre></td></tr></table></figure><p>ç¼–ç¨‹è¿‡ç¨‹ä¸­æˆ‘ä»¬é€šå¸¸æƒ³è¦é¿å…å¼•å…¥å‰¯ä½œç”¨ï¼Œå› ä¸ºå®ƒä¼šå¯¼è‡´éš¾ä»¥æ¨æ–­ç¨‹åºçš„è¡Œä¸ºã€‚ä½†å¾ˆå¤š Objective-C å¼€å‘è€…å·²ç»ä¾èµ–äºè¿™ç§ç‰¹æ€§ï¼Œä»–ä»¬ä¼šæ ¹æ®éœ€è¦åœ¨ getter æˆ– setter ä¸­æ³¨å…¥å„ç§é¢å¤–çš„è¡Œä¸ºã€‚</p><p>Swift çš„å±æ€§è®¾è®¡ä½¿è¿™äº›æ¨¡å¼æ›´åŠ æ ‡å‡†åŒ–ï¼Œå¹¶å¯¹è£…é¥°çŠ¶æ€è®¿é—®ï¼ˆå­˜å‚¨å±æ€§ï¼‰çš„å‰¯ä½œç”¨å’Œé‡å®šå‘çŠ¶æ€è®¿é—®ï¼ˆè®¡ç®—å±æ€§ï¼‰çš„å‰¯ä½œç”¨è¿›è¡Œäº†åŒºåˆ†ã€‚å¯¹äºå­˜å‚¨å±æ€§ï¼Œ<code>willSet</code> å’Œ <code>didSet</code> è§‚å¯Ÿå™¨å°†æ›¿æ¢ä½ åœ¨ ivar è®¿é—®æ—¶çš„ä»£ç ã€‚å¯¹äºè®¡ç®—å±æ€§ï¼Œ<code>get</code> å’Œ <code>set</code> è®¿é—®å™¨å¯èƒ½ä¼šæ›¿æ¢åœ¨ Objective-C ä¸­å®ç°çš„ä¸€äº› <code>@dynamic</code> å±æ€§ã€‚</p><p>æ­£å› ä¸ºå¦‚æ­¤ï¼Œæˆ‘ä»¬æ‰å¯ä»¥è·å–æ›´ä¸€è‡´çš„è¯­ä¹‰ï¼Œå¹¶æ›´å¥½åœ°ä¿è¯é”®å€¼è§‚å¯Ÿï¼ˆKVOï¼‰å’Œå¥å€¼ç¼–ç ï¼ˆKVCï¼‰ç­‰å±æ€§äº¤äº’æœºåˆ¶ã€‚</p><p>é‚£ä¹ˆä½ å¯ä»¥ä½¿ç”¨ Swift å±æ€§è§‚å¯Ÿå™¨åšäº›ä»€ä¹ˆå‘¢ï¼Ÿä»¥ä¸‹æ˜¯ä¸€äº›ä¾›ä½ å‚è€ƒçš„æƒ³æ³•ï¼š</p><h1 id="æ ‡å‡†åŒ–æˆ–éªŒè¯å€¼"><a href="#æ ‡å‡†åŒ–æˆ–éªŒè¯å€¼" class="headerlink" title="æ ‡å‡†åŒ–æˆ–éªŒè¯å€¼"></a>æ ‡å‡†åŒ–æˆ–éªŒè¯å€¼</h1><p>æœ‰æ—¶ï¼Œä½ å¸Œæœ›å¯¹ç±»å‹ç¡®å®šçš„å€¼å¢åŠ é¢å¤–çš„çº¦æŸã€‚</p><p>ä¾‹å¦‚ï¼Œä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªå’Œæ”¿åºœæœºæ„å¯¹æ¥çš„åº”ç”¨ç¨‹åºï¼Œä½ éœ€è¦ä¿è¯ç”¨æˆ·å¡«å†™äº†æ‰€æœ‰çš„å¿…å¡«é¡¹å¹¶ä¸”ä¸åŒ…å«éæ³•çš„å€¼æ‰èƒ½æäº¤è¡¨å•ã€‚</p><p>å¦‚æœä¸€ä¸ªè¡¨å•è¦æ±‚åç§°å­—æ®µä½¿ç”¨å¤§å†™å­—æ¯ä¸”ä¸ä½¿ç”¨é‡éŸ³ç¬¦å·ï¼Œä½ å¯ä»¥ä½¿ç”¨ <code>didSet</code> å±æ€§è§‚å¯Ÿå™¨è‡ªåŠ¨å»é™¤é‡éŸ³ç¬¦å·å¹¶è½¬åŒ–ä¸ºå¤§å†™ã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> name: <span class="type">String</span>? &#123;</span><br><span class="line">    <span class="keyword">didSet</span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.name = <span class="keyword">self</span>.name?</span><br><span class="line">                        .applyingTransform(.stripDiacritics,</span><br><span class="line">                                            <span class="built_in">reverse</span>: <span class="literal">false</span>)?</span><br><span class="line">                        .uppercased()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¹¸è¿çš„æ˜¯åœ¨è§‚å¯Ÿå™¨å†…éƒ¨è®¾ç½®å±æ€§ä¸ä¼šè§¦å‘é¢å¤–çš„å›è°ƒï¼Œæ‰€ä»¥ä¸Šé¢çš„ä»£ç ä¸­ä¸ä¼šäº§ç”Ÿæ— é™å¾ªç¯ã€‚æˆ‘ä»¬ä¹‹æ‰€ä»¥ä¸ä½¿ç”¨ <code>willSet</code> è§‚å¯Ÿå™¨æ˜¯å› ä¸ºå³ä½¿æˆ‘ä»¬åœ¨å…¶å›è°ƒä¸­è¿›è¡Œä»»ä½•èµ‹å€¼ï¼Œéƒ½ä¼šåœ¨å±æ€§è¢«èµ‹äºˆ <code>newValue</code> æ—¶è¦†ç›–ã€‚</p><p>è™½ç„¶è¿™ç§æ–¹æ³•å¯ä»¥è§£å†³ä¸€æ¬¡æ€§é—®é¢˜ï¼Œä½†åƒè¿™æ ·éœ€è¦é‡å¤ä½¿ç”¨çš„ä¸šåŠ¡é€»è¾‘å¯ä»¥å°è£…åˆ°ä¸€ä¸ªç±»å‹ä¸­ã€‚</p><p>æ›´å¥½çš„è®¾è®¡æ˜¯åˆ›å»ºä¸€ä¸ª <code>NormalizedText</code> ç±»å‹ï¼Œå®ƒå°è£…äº†è¦ä»¥è¿™ç§å½¢å¼è¾“å…¥çš„æ–‡æœ¬çš„è§„åˆ™ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">NormalizedText</span> </span>&#123;</span><br><span class="line">    <span class="class"><span class="keyword">enum</span> <span class="title">Error</span>: <span class="title">Swift</span>.<span class="title">Error</span> </span>&#123;</span><br><span class="line">        <span class="keyword">case</span> empty</span><br><span class="line">        <span class="keyword">case</span> excessiveLength</span><br><span class="line">        <span class="keyword">case</span> unsupportedCharacters</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">let</span> maximumLength = <span class="number">32</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> value: <span class="type">String</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">init</span>(<span class="number">_</span> string: <span class="type">String</span>) <span class="keyword">throws</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> string.isEmpty &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="type">Error</span>.empty</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">guard</span> <span class="keyword">let</span> value = string.applyingTransform(.stripDiacritics,</span><br><span class="line">                                                   <span class="built_in">reverse</span>: <span class="literal">false</span>)?</span><br><span class="line">                                .uppercased(),</span><br><span class="line">              value.canBeConverted(to: .ascii)</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">             <span class="keyword">throw</span> <span class="type">Error</span>.unsupportedCharacters</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">guard</span> value.<span class="built_in">count</span> &lt; <span class="type">NormalizedText</span>.maximumLength <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="type">Error</span>.excessiveLength</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">self</span>.value = value</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸€ä¸ªå¯æŠ›å‡ºå¼‚å¸¸çš„åˆå§‹åŒ–æ–¹æ³•å¯ä»¥å‘è°ƒç”¨è€…å‘é€é”™è¯¯ä¿¡æ¯ï¼Œè¿™æ˜¯ <code>didSet</code> è§‚å¯Ÿå™¨æ— æ³•åšåˆ°çš„ã€‚ç°åœ¨é¢å¯¹ <a href="https://zh.wikipedia.org/wiki/%E5%85%B0%E9%9F%A6%E5%B0%94%E6%99%AE%E5%B0%94%E5%8F%A4%E5%9B%A0%E5%90%89%E5%B0%94%E6%88%88%E6%A0%BC%E9%87%8C%E6%83%A0%E5%B0%94%E6%81%A9%E5%BE%B7%E7%BD%97%E5%B8%83%E5%B0%94%E5%85%B0%E8%92%82%E8%A5%BF%E5%88%A9%E5%A5%A5%E6%88%88%E6%88%88%E6%88%88%E8%B5%AB" target="_blank" rel="noopener">å…°éŸ¦å°”æ™®å°”å¤å› å‰å°”æˆˆæ ¼é‡Œæƒ å°”æ©å¾·ç½—å¸ƒå°”å…°è’‚è¥¿åˆ©å¥¥æˆˆæˆˆæˆˆèµ«</a> çš„ <em>çº¦ç¿°å°¼</em> è¿™æ ·çš„éº»çƒ¦åˆ¶é€ è€…ï¼Œæˆ‘ä»¬èƒ½ä¸ºä»–åšäº›ä»€ä¹ˆï¼ï¼ˆæ¢è¨€ä¹‹ï¼Œä»¥åˆç†çš„æ–¹å¼ä¼ è¾¾é”™è¯¯æ¯”æä¾›æ— æ•ˆçš„æ•°æ®æ›´å¥½ï¼‰</p><h1 id="ä¼ æ’­ä¾èµ–çŠ¶æ€"><a href="#ä¼ æ’­ä¾èµ–çŠ¶æ€" class="headerlink" title="ä¼ æ’­ä¾èµ–çŠ¶æ€"></a>ä¼ æ’­ä¾èµ–çŠ¶æ€</h1><p>å±æ€§è§‚å¯Ÿå™¨çš„å¦ä¸€ä¸ªæ½œåœ¨ç”¨ä¾‹æ˜¯å°†çŠ¶æ€ä¼ æ’­åˆ°ä¾èµ–äºè§†å›¾æ§åˆ¶å™¨çš„ç»„ä»¶ã€‚</p><p>è€ƒè™‘ä¸‹é¢çš„ <code>Track</code> æ¨¡å‹ç¤ºä¾‹å’Œä¸€ä¸ªå‘ˆç°å®ƒçš„ <code>TrackViewController</code>ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Track</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> title: <span class="type">String</span></span><br><span class="line">    <span class="keyword">var</span> audioURL: <span class="type">URL</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TrackViewController</span>: <span class="title">UIViewController</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> player: <span class="type">AVPlayer</span>?</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> track: <span class="type">Track</span>? &#123;</span><br><span class="line">        <span class="keyword">willSet</span> &#123;</span><br><span class="line">            <span class="keyword">self</span>.player?.pause()</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">didSet</span> &#123;</span><br><span class="line">            <span class="keyword">guard</span> <span class="keyword">let</span> track = <span class="keyword">self</span>.track <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">self</span>.title = track.title</span><br><span class="line"></span><br><span class="line">            <span class="keyword">let</span> item = <span class="type">AVPlayerItem</span>(url: track.audioURL)</span><br><span class="line">            <span class="keyword">self</span>.player = <span class="type">AVPlayer</span>(playerItem: item)</span><br><span class="line">            <span class="keyword">self</span>.player?.play()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“è§†å›¾æ§åˆ¶å™¨çš„ <code>track</code> å±æ€§è¢«èµ‹å€¼ï¼Œä»¥ä¸‹äº‹æƒ…ä¼šè‡ªåŠ¨å‘ç”Ÿï¼š</p><ul><li>ä¹‹å‰è½¨é“çš„éŸ³é¢‘éƒ½ä¼šæš‚åœ</li><li>è§†å›¾æ§åˆ¶å™¨çš„ <code>title</code> ä¼šè¢«è®¾ç½®ä¸ºæ–°è½¨é“å¯¹è±¡çš„æ ‡é¢˜</li><li>æ–°è½¨é“å¯¹è±¡çš„éŸ³é¢‘ä¿¡æ¯ä¼šè¢«åŠ è½½å¹¶æ’­æ”¾</li></ul><p>å¾ˆé…·, å¯¹å—?</p><p>ä½ ç”šè‡³å¯ä»¥åƒ <a href="https://www.youtube.com/watch?v=TVAhhVrpkwM" target="_blank" rel="noopener"><em>æ•é¼ è®°</em> ä¸­æç»˜çš„åœºæ™¯</a> ä¸€æ ·ï¼Œå°†è¡Œä¸ºä¸å¤šä¸ªè§‚å¯Ÿå±æ€§çº§è”èµ·æ¥ã€‚</p><p>å½“ç„¶ï¼Œè§‚å¯Ÿå™¨ä¹Ÿå­˜åœ¨ä¸€å®šçš„å‰¯ä½œç”¨ï¼Œå®ƒä½¿å¾—æœ‰äº›å¤æ‚çš„è¡Œä¸ºéš¾ä»¥è¢«æ¨æ–­ï¼Œè¿™æ˜¯æˆ‘ä»¬åœ¨ç¼–ç¨‹ä¸­éœ€è¦é¿å…çš„ã€‚ä»Šååœ¨ä½¿ç”¨è¿™ä¸€ç‰¹æ€§çš„åŒæ—¶ä¹Ÿéœ€è¦æ³¨æ„è¿™ä¸€ç‚¹ã€‚</p><p>ç„¶è€Œï¼Œåœ¨è¿™æ‘‡æ‘‡æ¬²å çš„æŠ½è±¡å¡”çš„é¡¶ç«¯ï¼Œä¸€å®šé™åº¦çš„ç³»ç»Ÿæ··ä¹±æ˜¯è¯±äººçš„ï¼Œæœ‰æ—¶æ˜¯å€¼å¾—çš„ã€‚ä¸€ç›´éµå¾ªè§„åˆ™çš„æ˜¯æ³¢å°”ç†è®ºè€Œéçˆ±å› æ–¯å¦ã€‚</p><blockquote><p>æœ¬æ–‡ç”± SwiftGG ç¿»è¯‘ç»„ç¿»è¯‘ï¼Œå·²ç»è·å¾—ä½œè€…ç¿»è¯‘æˆæƒï¼Œæœ€æ–°æ–‡ç« è¯·è®¿é—® <a href="http://swift.gg">http://swift.gg</a>ã€‚</p></blockquote>]]></content>
    
    <summary type="html">
    
      æœ¬æ–‡ä»‹ç»äº† Swift ä¸­çš„å±æ€§è§‚å¯Ÿå™¨ï¼Œå¹¶ä»‹ç»äº†ä¸€äº›æ¯”è¾ƒå¸¸è§çš„é€‚ç”¨åœºæ™¯ã€‚
    
    </summary>
    
      <category term="Swift" scheme="https://swift.gg/categories/Swift/"/>
    
      <category term="NSHipster" scheme="https://swift.gg/categories/Swift/NSHipster/"/>
    
    
      <category term="Swift" scheme="https://swift.gg/tags/Swift/"/>
    
      <category term="NSHipster" scheme="https://swift.gg/tags/NSHipster/"/>
    
  </entry>
  
  <entry>
    <title>å¸ƒéš†è¿‡æ»¤å™¨ä¸ Swift 4.2</title>
    <link href="https://swift.gg/2018/12/13/bloom-filters/"/>
    <id>https://swift.gg/2018/12/13/bloom-filters/</id>
    <published>2018-12-13T00:00:00.000Z</published>
    <updated>2019-02-19T03:45:13.515Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ä½œè€…ï¼šSoroush Khanlouï¼Œ<a href="http://khanlou.com/2018/09/bloom-filters/" target="_blank" rel="noopener">åŸæ–‡é“¾æ¥</a>ï¼ŒåŸæ–‡æ—¥æœŸï¼š2018-09-19<br>è¯‘è€…ï¼š<a href="https://github.com/WAMaker" target="_blank" rel="noopener">WAMaker</a>ï¼›æ ¡å¯¹ï¼š<a href="http://numbbbbb.com/" target="_blank" rel="noopener">numbbbbb</a>ï¼Œ<a href="http://linusling.com" target="_blank" rel="noopener">å°é“åŒ Linus</a>ï¼›å®šç¨¿ï¼š<a href="http://forelax.space" target="_blank" rel="noopener">Forelax</a></p></blockquote><!--æ­¤å¤„å¼€å§‹æ­£æ–‡--><p>Swift 4.2 ä¸ºå“ˆå¸Œçš„å®ç°å¸¦æ¥äº†ä¸€äº›æ–°çš„å˜åŒ–ã€‚åœ¨æ­¤ä¹‹å‰ï¼Œå“ˆå¸Œäº¤ç”±å¯¹è±¡æœ¬èº«å…¨æƒä»£ç†ã€‚å½“ä½ å‘å¯¹è±¡ç´¢å– <code>å“ˆå¸Œå€¼ï¼ˆhashValueï¼‰</code>æ—¶ï¼Œå®ƒä¼šæŠŠå¤„ç†å¥½çš„æ•´å‹å€¼ä½œä¸ºå“ˆå¸Œå€¼è¿”å›ã€‚è€Œç°åœ¨ï¼Œå®ç°äº† <code>Hashable</code> åè®®çš„å¯¹è±¡åˆ™æè¿°äº†å®ƒçš„å‚æ•°æ˜¯å¦‚ä½•ç»„åˆï¼Œå¹¶ä¼ é€’ç»™ä½œä¸ºå…¥å‚çš„ <code>Hasher</code> å¯¹è±¡ã€‚è¿™æ ·åšæœ‰ä»¥ä¸‹å‡ ç‚¹å¥½å¤„ï¼š</p><ul><li>å†™å‡ºå¥½çš„å“ˆå¸Œç®—æ³•å¾ˆéš¾ã€‚Swift çš„ä½¿ç”¨è€…ä¸éœ€è¦çŸ¥é“å¦‚ä½•ç»„åˆå‚æ•°æ¥è·å¾—æ›´å¥½çš„å“ˆå¸Œå€¼ã€‚</li><li>å‡ºäºä¸æå€¡ç”¨æˆ·ä»¥ä»»ä½•å½¢å¼å­˜å‚¨å“ˆå¸Œå€¼ï¼Œä»¥åŠ <a href="https://twitter.com/jckarter/status/1042453831496327168" target="_blank" rel="noopener">ä¸€äº›å®‰å…¨æ–¹é¢å› ç´ </a> çš„è€ƒè™‘ï¼Œå“ˆå¸Œå€¼åœ¨ç¨‹åºæ¯æ¬¡è¿è¡Œçš„æ—¶å€™éƒ½åº”è¯¥æœ‰æ‰€ä¸åŒã€‚æè¿°æ€§çš„å“ˆå¸Œå…è®¸å“ˆå¸Œå‡½æ•°çš„ç§å­åœ¨æ¯æ¬¡ç¨‹åºè¿è¡Œçš„æ—¶å€™å‘ç”Ÿæ”¹å˜ã€‚</li><li>èƒ½å®ç°æ›´å¤šæœ‰æ„æ€çš„æ•°æ®ç»“æ„ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬è¿™ç¯‡æ–‡ç« æ¥ä¸‹æ¥ä¼šèšç„¦çš„ã€‚</li></ul><a id="more"></a><p>æˆ‘ä¹‹å‰å†™è¿‡ä¸€ç¯‡å…³äº <a href="http://khanlou.com/2016/07/implementing-dictionary-in-swift/" target="_blank" rel="noopener">å¦‚ä½•ä½¿ç”¨ Swift çš„ <code>Hashable</code> åè®®ä»é›¶å®ç° <code>Dictionary</code></a> çš„æ–‡ç« ï¼ˆå…ˆé˜…è¯»å®ƒä¼šå¸®åŠ©ä½ é˜…è¯»æœ¬æ–‡ï¼Œä½†è¿™ä¸æ˜¯å¿…é¡»çš„ï¼‰ã€‚ä»Šå¤©ï¼Œæˆ‘æƒ³è°ˆè®ºä¸€ç§ä¸åŒç±»å‹çš„ï¼ŒåŸºäºæ¦‚ç‡æ€§è€Œéæ˜ç¡®æ€§çš„æ•°æ®ç»“æ„ï¼šå¸ƒéš†è¿‡æ»¤å™¨ï¼ˆBloom Filtersï¼‰ã€‚æˆ‘ä»¬ä¼šä½¿ç”¨ Swift 4.2 çš„æ–°ç‰¹æ€§ï¼ŒåŒ…æ‹¬æ–°çš„å“ˆå¸Œæ¨¡å‹æ¥æ„å»ºå®ƒã€‚</p><p>å¸ƒéš†è¿‡æ»¤å™¨å¾ˆæ€ªå¼‚ã€‚æƒ³è±¡è¿™æ ·ä¸€ç§æ•°æ®ç»“æ„ï¼š</p><ul><li>ä½ èƒ½å¤Ÿå¾€é‡Œæ’å…¥æ•°æ®</li><li>ä½ èƒ½å¤ŸæŸ¥è¯¢ä¸€ä¸ªå€¼æ˜¯å¦å­˜åœ¨</li><li>åªéœ€è¦å°‘é‡å­˜å‚¨èµ„æºå°±èƒ½å­˜å‚¨å¤§é‡å¯¹è±¡</li></ul><p>ä½†æ˜¯ï¼š</p><ul><li>ä½ ä¸èƒ½æšä¸¾å…¶ä¸­çš„å¯¹è±¡</li><li>å®ƒæœ‰æ—¶ä¼šå‡ºç°è¯¯æŠ¥ï¼ˆä½†ä¸ä¼šå‡ºç°æ¼æŠ¥ï¼‰</li><li>ä½ ä¸èƒ½ä»ä¸­ç§»é™¤æ•°æ®</li></ul><p>ä»€ä¹ˆæ—¶å€™ä¼šæƒ³è¦è¿™ç§æ•°æ®ç»“æ„å‘¢ï¼ŸMedium ä½¿ç”¨å®ƒä»¬æ¥ <a href="https://blog.medium.com/what-are-bloom-filters-1ec2a50c68ff" target="_blank" rel="noopener">è·Ÿè¸ªåšæ–‡çš„é˜…è¯»çŠ¶æ€</a>ã€‚å¿…åº”ä½¿ç”¨å®ƒä»¬åš <a href="https://www.youtube.com/watch?v=80LKF2qph6I" target="_blank" rel="noopener">æœç´¢ç´¢å¼•</a>ã€‚ä½ å¯ä»¥ä½¿ç”¨å®ƒä»¬æ¥æ„å»ºä¸€ä¸ªç¼“å­˜ï¼Œåœ¨æ— éœ€è®¿é—®æ•°æ®åº“çš„æƒ…å†µä¸‹å°±èƒ½åˆ¤æ–­ç”¨æˆ·åæ˜¯å¦æœ‰æ•ˆï¼ˆä¾‹å¦‚åœ¨ @-mention ä¸­ï¼‰ã€‚åƒæœåŠ¡å™¨è¿™æ ·å¯èƒ½æ‹¥æœ‰å·¨å¤§çš„è§„æ¨¡ï¼Œå´ä¸ä¸€å®šæœ‰å·¨å¤§èµ„æºçš„åœºæ™¯ä¸­ï¼Œå®ƒä»¬ä¼šéå¸¸æœ‰ç”¨ã€‚</p><p>ï¼ˆå¦‚æœä½ ä¹‹å‰åšè¿‡å›¾å½¢æ–¹é¢çš„å·¥ä½œï¼Œå¯èƒ½å¥½å¥‡å®ƒæ˜¯å¦‚ä½•ä¸ <a href="https://en.wikipedia.org/wiki/Bloom_(shader_effect" target="_blank" rel="noopener">é«˜å…‰è¿‡æ»¤å™¨</a>) äº§ç”Ÿè”ç³»çš„ã€‚ç­”æ¡ˆæ˜¯æ²¡æœ‰è”ç³»ã€‚é«˜å…‰è¿‡æ»¤å™¨ï¼ˆbloom filtersï¼‰æ˜¯å°å†™çš„ bï¼Œè€Œå¸ƒéš†è¿‡æ»¤å™¨ï¼ˆBloom Filtersï¼‰æ˜¯ç”±ä¸€ä¸ªå«å¸ƒéš†çš„äººå‘½åçš„ã€‚å®Œå…¨æ˜¯ä¸ªå·§åˆã€‚ï¼‰</p><p>é‚£å®ƒä»¬æ˜¯å¦‚ä½•è¿ä½œçš„å‘¢ï¼Ÿ</p><p>å°†å¯¹è±¡æ”¾å…¥å¸ƒéš†è¿‡æ»¤å™¨å¦‚åŒå°†å®ƒæ”¾å…¥é›†åˆæˆ–å­—å…¸ï¼šè®¡ç®—å¯¹è±¡çš„å“ˆå¸Œå€¼ï¼Œå¹¶æ ¹æ®å­˜å‚¨æ•°ç»„çš„å¤§å°å¯¹å“ˆå¸Œå€¼æ±‚ä½™ã€‚å°±è¿™ç‚¹è€Œè¨€ï¼Œä½¿ç”¨å¸ƒéš†è¿‡æ»¤å™¨åªéœ€è¦ä¿®æ”¹è¯¥ç´¢å¼•å¤„çš„å€¼ï¼šå°† false æ”¹ä¸º trueï¼Œè€Œä¸ç”¨åƒä½¿ç”¨é›†åˆæˆ–å­—å…¸é‚£æ ·ï¼ŒæŠŠå¯¹è±¡å­˜æ”¾åˆ°ç´¢å¼•ä½ç½®ã€‚</p><p>æˆ‘ä»¬å…ˆé€šè¿‡ä¸€ä¸ªç®€å•çš„ä¾‹å­æ¥ç†è§£è¿‡æ»¤å™¨æ˜¯å¦‚æœè¿ä½œçš„ï¼Œä¹‹åå†å¯¹å®ƒè¿›è¡Œæ‰©å±•ã€‚æƒ³è±¡ä¸€ä¸ªæ‹¥æœ‰ 8 ä¸ª false å€¼çš„å¸ƒå°”æ•°ç»„ï¼ˆæˆ–ç§°ä¹‹ä¸º <a href="https://gist.github.com/natecook1000/552dc3d23d2fc4a54d2e9fcd309e59e9" target="_blank" rel="noopener">æ¯”ç‰¹æ•°ç»„</a>ï¼‰ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">| 0 | 1 | 2 | 3 | 4 | 5 | 6 | 7 |</span><br><span class="line">---------------------------------</span><br><span class="line">|   |   |   |   |   |   |   |   |</span><br></pre></td></tr></table></figure><p>å®ƒä»£è¡¨äº†æˆ‘ä»¬çš„å¸ƒéš†è¿‡æ»¤å™¨ã€‚æˆ‘æƒ³è¦æ’å…¥å­—ç¬¦ä¸²â€œsoroushâ€ã€‚å®ƒçš„å“ˆå¸Œå€¼æ˜¯ 9192644045266971309ï¼Œå½“è¿™ä¸ªå€¼ä½™ 8 æ—¶å¾—åˆ° 5ã€‚æˆ‘ä»¬ä¿®æ”¹é‚£ä¸€ä½çš„å€¼ã€‚</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">| 0 | 1 | 2 | 3 | 4 | 5 | 6 | 7 |</span><br><span class="line">---------------------------------</span><br><span class="line">|   |   |   |   |   | * |   |   |</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥æˆ‘æƒ³è¦æ’å…¥å­—ç¬¦ä¸²â€œswiftâ€ï¼Œå®ƒçš„å“ˆå¸Œå€¼æ˜¯ 7052914221234348788ï¼Œä½™ 8 å¾— 4ï¼Œä¿®æ”¹ç´¢å¼• 4 çš„å€¼ã€‚</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">| 0 | 1 | 2 | 3 | 4 | 5 | 6 | 7 |</span><br><span class="line">---------------------------------</span><br><span class="line">|   |   |   |   | * | * |   |   |</span><br></pre></td></tr></table></figure><p>è¦æµ‹è¯•å¸ƒéš†è¿‡æ»¤å™¨æ˜¯å¦åŒ…å«â€œsoroushâ€ï¼Œæˆ‘å†æ¬¡è®¡ç®—å®ƒçš„å“ˆå¸Œå€¼å¹¶æ±‚ä½™ï¼Œä»æ—§å¾—åˆ°ä½™æ•° 5ï¼Œå¯¹åº”å€¼æ˜¯ trueã€‚â€œsoroushâ€ç¡®å®åœ¨å¸ƒéš†è¿‡æ»¤å™¨ä¸­ã€‚</p><p>ç„¶è€Œä»…ä»…æµ‹è¯•èƒ½å¤Ÿé€šè¿‡çš„ç”¨ä¾‹æ˜¯ä¸å¤Ÿçš„ï¼Œæˆ‘ä»¬éœ€è¦å†™ä¸€äº›ä¼šå¯¼è‡´å¤±è´¥çš„ç”¨ä¾‹ã€‚æµ‹è¯•å­—ç¬¦ä¸²â€œkhanlouâ€å–ä½™å¾—åˆ°çš„ç´¢å¼•å€¼æ˜¯ 2ï¼Œå› æ­¤æˆ‘ä»¬çŸ¥é“å®ƒä¸åœ¨å¸ƒéš†è¿‡æ»¤å™¨ä¸­ã€‚åˆ°æ­¤ä¸ºæ­¢ä¸€åˆ‡éƒ½å¥½ã€‚æ¥ä¸‹å»ä¸€ä¸ªæµ‹è¯•ï¼šå¯¹â€œhashableâ€å­—ç¬¦ä¸²å–ä½™å¾—åˆ°çš„ç´¢å¼•å€¼æ˜¯ 5ï¼Œè¿™å°±å‘ç”Ÿäº†ä¸€æ¬¡å†²çªï¼å³ä½¿è¿™ä¸ªå€¼ä»æ¥æ²¡æœ‰è¢«åŠ å…¥è¿‡ï¼Œè¿‡æ»¤å™¨ä»è¿”å›äº† trueã€‚è¿™ä¾¿æ˜¯å¸ƒéš†è¿‡æ»¤å™¨ä¼šå‘ç”Ÿè¯¯æŠ¥çš„ä¾‹å­ã€‚</p><p>æœ‰ä¸¤ä¸ªä¸»è¦çš„ç­–ç•¥å¯ä»¥å°½å¯èƒ½å‡å°‘è¯¯æŠ¥ã€‚ç¬¬ä¸€ä¸ªç­–ç•¥ï¼Œä¹Ÿæ˜¯ä¸¤ä¸ªç­–ç•¥ä¸­ç›¸å¯¹æœ‰è¶£çš„ï¼šæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸åŒçš„å“ˆå¸Œå‡½æ•°è®¡ç®—ä¸¤æ¬¡æˆ–ä¸‰æ¬¡å“ˆå¸Œå€¼è€Œéä¸€æ¬¡ã€‚åªè¦å®ƒä»¬éƒ½æ˜¯è¡¨ç°è‰¯å¥½çš„å“ˆå¸Œå‡½æ•°ï¼ˆå‡åŒ€åˆ†å¸ƒï¼Œä¸€è‡´æ€§ï¼Œæœ€å°çš„ç¢°æ’å‡ ç‡ï¼‰ï¼Œæˆ‘ä»¬å°±èƒ½ä¸ºæ¯ä¸ªå€¼ç”Ÿæˆå¤šä¸ªç´¢å¼•æ”¹å˜å¸ƒå°”å€¼ã€‚è¿™æ¬¡ï¼Œæˆ‘ä»¬è®¡ç®—ä¸¤æ¬¡â€œsoroushâ€çš„å“ˆå¸Œå€¼ï¼Œç”Ÿæˆ 2 ä¸ªç´¢å¼•å¹¶æ”¹å˜å¸ƒå°”å€¼ã€‚è¿™æ—¶ï¼Œå½“æˆ‘ä»¬æ£€æŸ¥â€œkhanlouâ€æ˜¯å¦åœ¨å¸ƒéš†è¿‡æ»¤å™¨ä¸­ï¼Œå…¶ä¸­ä¸€ä¸ªå“ˆå¸Œå€¼å¯èƒ½ä¼šå’Œâ€œsoroushâ€çš„ä¸€ä¸ªå“ˆå¸Œå€¼å†²çªï¼Œä½†ä¸¤ä¸ªå€¼åŒæ—¶å‘ç”Ÿå†²çªçš„å¯èƒ½æ€§å°±ä¼šå˜å¾—å¾ˆå°ã€‚ä½ å¯ä»¥æŠŠè¿™ä¸ªæ•°å­—æ‰©å¤§ã€‚åœ¨ä¸‹é¢çš„ä»£ç æˆ‘ä¼šåš 3 æ¬¡å“ˆå¸Œè®¡ç®—ï¼Œä½†ä½ å¯ä»¥åšæ›´å¤šæ¬¡ã€‚</p><p>å½“ç„¶ï¼Œå¦‚æœä½ è®¡ç®—æ›´å¤šæ¬¡å“ˆå¸Œå€¼ï¼Œæ¯ä¸ªå…ƒç´ åœ¨å¸ƒå°”æ•°ç»„ä¸­ä¼šå æ®æ›´å¤šçš„ç©ºé—´ã€‚äº‹å®ä¸Šï¼Œç°åœ¨çš„æ•°æ®å‡ ä¹ä¸å ç”¨ç©ºé—´ã€‚8 ä¸ªå¸ƒå°”å€¼çš„æ•°ç»„å¯¹åº” 1 å­—èŠ‚ã€‚æ‰€ä»¥ç¬¬äºŒä¸ªå‡å°è¯¯æŠ¥çš„ç­–ç•¥æ˜¯æ‰©å¤§æ•°ç»„çš„è§„æ¨¡ã€‚æˆ‘ä»¬èƒ½å°†æ•°ç»„å˜å¾—è¶³å¤Ÿå¤§è€Œä¸ç”¨æ‹…å¿ƒå®ƒçš„ç©ºé—´æ¶ˆè€—ã€‚ä¸‹é¢çš„ä»£ç ä¸­æˆ‘ä»¬ä¼šé»˜è®¤ä½¿ç”¨ 512 æ¯”ç‰¹å¤§å°çš„æ•°ç»„ã€‚</p><p>ç°åœ¨ï¼Œå³ä½¿åŒæ—¶ä½¿ç”¨è¿™äº›ç­–ç•¥ï¼Œä½ ä¾ç„¶ä¼šå¾—åˆ°å†²çªï¼Œå³è¯¯æŠ¥ï¼Œä½†å†²çªçš„å‡ ç‡ä¼šå‡å°ã€‚è¿™æ˜¯å¸ƒéš†è¿‡æ»¤å™¨çš„ä¸€ä¸ªç¼ºé™·ï¼Œä½†åœ¨åˆé€‚çš„åœºæ™¯ç”¨å®ƒæ¥èŠ‚çœé€Ÿåº¦ä¸ç©ºé—´æ˜¯ä¸€ç¬”ä¸é”™çš„äº¤æ˜“ã€‚</p><p>åœ¨å¼€å§‹å…·ä½“çš„ä»£ç ä¹‹å‰æˆ‘æœ‰å¦å¤–ä¸‰ç‚¹æƒ³è¦è°ˆè°ˆã€‚é¦–å…ˆï¼Œä½ ä¸èƒ½æ”¹å˜å¸ƒéš†è¿‡æ»¤å™¨çš„å¤§å°ã€‚å½“ä½ å¯¹å“ˆå¸Œå€¼å–ä½™æ—¶ï¼Œè¿™æ˜¯åœ¨ç ´åä¿¡æ¯ï¼Œåœ¨ä¸ä¿ç•™åŸå§‹å“ˆå¸Œå€¼çš„æƒ…å†µä¸‹ä½ ä¸èƒ½å›æº¯ä¹‹å‰çš„ä¿¡æ¯ â€”â€” ä¿ç•™åŸå§‹å€¼ç›¸å½“äºå¦å†³äº†è¿™ä¸ªæ•°æ®ç»“æ„èŠ‚çº¦ç©ºé—´çš„ä¼˜åŠ¿ã€‚</p><p>å…¶æ¬¡ï¼Œä½ èƒ½çœ‹åˆ°æƒ³è¦æšä¸¾å¸ƒéš†è¿‡æ»¤å™¨æ‰€æœ‰çš„å€¼æ˜¯å¤šä¹ˆå¼‚æƒ³å¤©å¼€ã€‚ä½ ä¸å†æ‹¥æœ‰è¿™äº›å€¼ï¼Œåªæ˜¯å®ƒä»¬ä»¥å“ˆå¸Œå½¢å¼å­˜åœ¨çš„æ›¿ä»£å“ã€‚</p><p>æœ€åï¼Œä½ åŒæ ·èƒ½çœ‹åˆ°æƒ³è¦ä»å¸ƒéš†è¿‡æ»¤å™¨ä¸­ç§»é™¤å…ƒç´ æ˜¯ä¸å¯èƒ½çš„ã€‚å¦‚æœæƒ³å°†å¸ƒå°”å€¼å˜å› falseï¼Œä½ å¹¶ä¸çŸ¥é“æ˜¯å“ªäº›å€¼å°†å®ƒå˜ä¸º trueã€‚æ˜¯å‡†å¤‡ç§»é™¤çš„å€¼è¿˜æ˜¯å…¶å®ƒå€¼ï¼Ÿè¿™æ ·åšä¼šé€ æˆæ¼æŠ¥å’Œè¯¯æŠ¥ã€‚ï¼ˆè¿™å¯¹ä½ æ¥è¯´å¯èƒ½æ˜¯å€¼å¾—æƒè¡¡çš„ï¼‰ä½ å¯ä»¥åœ¨æ¯ä¸ªç´¢å¼•ä¸Šä¿ç•™è®¡æ•°è€Œéå¸ƒå°”å€¼æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œè™½ç„¶ä¿ç•™è®¡æ•°è¿˜æ˜¯ä¼šå¸¦æ¥å­˜å‚¨é—®é¢˜ï¼Œä½†æ ¹æ®ä½¿ç”¨åœºæ™¯çš„ä¸åŒï¼Œè¿™æ ·åšæˆ–è®¸æ˜¯å€¼å¾—çš„ã€‚</p><p>åºŸè¯ä¸å¤šè¯´ï¼Œè®©æˆ‘ä»¬å¼€å§‹ç€æ‰‹ç¼–ç ã€‚æˆ‘åœ¨è¿™é‡Œåšçš„ä¸€äº›å†³ç­–å’Œä½ å¯èƒ½ä¼šåšçš„æœ‰æ‰€ä¸åŒï¼Œç¬¬ä¸€ä¸ªä¸åŒå°±æ˜¯è¦ä¸è¦è®©å¯¹è±¡æ”¯æŒèŒƒå‹ã€‚æˆ‘è®¤ä¸ºè®©å¯¹è±¡åŒ…å«æ›´å¤šå…³äºå®ƒéœ€è¦å­˜å‚¨å†…å®¹çš„å…ƒæ•°æ®æ˜¯æœ‰æ„ä¹‰çš„ï¼Œä½†å¦‚æœä½ å‘ç°è¿™æ ·åšé™åˆ¶å¤ªå¤šï¼Œä½ å¯ä»¥æ”¹å˜å®ƒã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">BloomFilter</span>&lt;<span class="title">Element</span>: <span class="title">Hashable</span>&gt; </span>&#123;</span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬éœ€è¦å­˜å‚¨ä¸¤ç§ä¸»è¦çš„æ•°æ®ã€‚ç¬¬ä¸€ä¸ªæ˜¯ <code>data</code>ï¼Œç”¨äºè¡¨ç¤ºæ¯”ç‰¹æ•°ç»„ã€‚å®ƒå­˜å‚¨äº†æ‰€æœ‰å’Œå“ˆå¸Œå€¼æœ‰å…³çš„æ ‡è®°ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">var</span> data: [<span class="type">Bool</span>]</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦ä¸åŒçš„å“ˆå¸Œå‡½æ•°ã€‚ä¸€äº›å¸ƒéš†è¿‡æ»¤å™¨ç¡®å®ä¼šä½¿ç”¨ä¸åŒçš„æ–¹æ³•è®¡ç®—å“ˆå¸Œå€¼ï¼Œä½†æˆ‘è§‰å¾—ä½¿ç”¨ç›¸åŒçš„ç®—æ³•ï¼ŒåŒæ—¶æ··å…¥ä¸€ä¸ªéšæœºç”Ÿæˆçš„å€¼ä¼šæ›´ç®€å•ã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">let</span> seeds: [<span class="type">Int</span>]</span><br></pre></td></tr></table></figure><p>å½“åˆå§‹åŒ–å¸ƒéš†è¿‡æ»¤å™¨æ—¶ï¼Œæˆ‘ä»¬éœ€è¦åˆå§‹åŒ–è¿™ä¸¤ä¸ªå®ä¾‹å˜é‡ã€‚æ¯”ç‰¹æ•°ç»„ä¼šç®€å•çš„é‡å¤ <code>false</code> å€¼æ¥åˆå§‹åŒ–ï¼Œè€Œç§å­å€¼åˆ™ä½¿ç”¨ Swift 4.2 çš„æ–° API <code>Int.random</code> æ¥ç”Ÿæˆæˆ‘ä»¬éœ€è¦çš„ç§å­å€¼ã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">init</span>(size: <span class="type">Int</span>, hashCount: <span class="type">Int</span>) &#123;</span><br><span class="line">data = <span class="type">Array</span>(repeating: <span class="literal">false</span>, <span class="built_in">count</span>: size)</span><br><span class="line">seeds = (<span class="number">0</span>..&lt;hashCount).<span class="built_in">map</span>(&#123; <span class="number">_</span> <span class="keyword">in</span> <span class="type">Int</span>.random(<span class="keyword">in</span>: <span class="number">0</span>..&lt;<span class="type">Int</span>.<span class="built_in">max</span>) &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŒæ—¶ï¼Œåˆ›å»ºä¸€ä¸ªå¸¦æœ‰é»˜è®¤å€¼çš„ä¾¿åˆ©æ„é€ å™¨ã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">init</span>() &#123;</span><br><span class="line"><span class="keyword">self</span>.<span class="keyword">init</span>(size: <span class="number">512</span>, hashCount: <span class="number">3</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬è¦å®ç°ä¸¤ä¸ªä¸»è¦çš„æ–¹æ³•ï¼š<code>insert</code> å’Œ <code>contains</code>ã€‚å®ƒä»¬éƒ½éœ€è¦æ¥æ”¶å…ƒç´ ä½œä¸ºå‚æ•°å¹¶ä¸ºæ¯ä¸€ä¸ªç§å­å€¼è®¡ç®—å‡ºå¯¹åº”çš„å“ˆå¸Œå€¼ã€‚ç§æœ‰çš„å¸®åŠ©æ–¹æ³•ä¼šå¾ˆæœ‰ç”¨ã€‚ç”±äºç§å­å€¼ä»£è¡¨äº†â€œä¸åŒçš„â€å“ˆå¸Œå‡½æ•°ï¼Œæˆ‘ä»¬å°±éœ€è¦ä¸ºæ¯ä¸€ä¸ªç§å­ç”Ÿæˆå¯¹åº”çš„å“ˆå¸Œå€¼ã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">hashes</span><span class="params">(<span class="keyword">for</span> element: Element)</span></span> -&gt; [<span class="type">Int</span>] &#123;</span><br><span class="line"><span class="keyword">return</span> seeds.<span class="built_in">map</span>(&#123; seed -&gt; <span class="type">Int</span> <span class="keyword">in</span></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line">&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¦å®ç°å‡½æ•°ä¸»ä½“ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ª <code>Hasher</code> å¯¹è±¡ï¼ˆSwift 4.2 æ–°ç‰¹æ€§ï¼‰ï¼Œå°†æƒ³è¦è¿›è¡Œå“ˆå¸Œè®¡ç®—çš„å¯¹è±¡ä¼ ç»™å®ƒã€‚å¸¦ä¸Šç§å­ç¡®ä¿äº†ç”Ÿæˆçš„å“ˆå¸Œå€¼ä¸ä¼šå†²çªã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">hashes</span><span class="params">(<span class="keyword">for</span> element: Element)</span></span> -&gt; [<span class="type">Int</span>] &#123;</span><br><span class="line"><span class="keyword">return</span> seeds.<span class="built_in">map</span>(&#123; seed -&gt; <span class="type">Int</span> <span class="keyword">in</span></span><br><span class="line"><span class="keyword">var</span> hasher = <span class="type">Hasher</span>()</span><br><span class="line">hasher.combine(element)</span><br><span class="line">hasher.combine(seed)</span><br><span class="line"><span class="keyword">let</span> hashValue = <span class="built_in">abs</span>(hasher.finalize())</span><br><span class="line"><span class="keyword">return</span> hashValue</span><br><span class="line">&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŒæ—¶ï¼Œæ³¨æ„å“ˆå¸Œå€¼çš„ç»å¯¹å€¼ã€‚å“ˆå¸Œè®¡ç®—æœ‰å¯èƒ½äº§ç”Ÿè´Ÿæ•°ï¼Œè¿™ä¼šå¯¼è‡´æˆ‘ä»¬çš„æ•°ç»„è®¿é—®å´©æºƒã€‚å–ç»å¯¹å€¼æ“ä½œå‡å°‘äº† 1 æ¯”ç‰¹çš„ä¿¡æ¯ç†µï¼Œå¯¹æˆ‘ä»¬æ¥è¯´æ˜¯æœ‰ç›Šçš„ã€‚</p><p>ç†æƒ³çš„æƒ…å†µæ˜¯ä½ èƒ½å¤Ÿä½¿ç”¨ç§å­æ¥åˆå§‹åŒ– <code>Hasher</code> è€Œä¸æ˜¯æŠŠå®ƒæ··åˆè¿›å»ã€‚Swift çš„ <code>Hasher</code> ä¼šåœ¨æ¯æ¬¡ç¨‹åºå¯åŠ¨çš„æ—¶å€™è¢«åˆ†é…ä¸€ä¸ªä¸åŒçš„ç§å­ï¼ˆé™¤éä½  <a href="https://github.com/apple/swift-evolution/blob/master/proposals/0206-hashable-enhancements.md#effect-on-abi-stability" target="_blank" rel="noopener">è®¾ç½®å›ºå®šçš„ç¯å¢ƒå˜é‡</a> è®©ç§å­åœ¨ä¸åŒå¯åŠ¨é—´ä¿æŒä¸€è‡´ï¼Œè€Œè¿™æ ·åšé€šå¸¸æ˜¯ä¸€äº›æµ‹è¯•ç›®çš„ï¼‰ï¼Œæ„å‘³ç€ä½ ä¸èƒ½æŠŠè¿™äº›å€¼å†™åˆ°ç£ç›˜ä¸Šã€‚å¦‚æœæˆ‘ä»¬æ§åˆ¶äº† <code>Hasher</code> çš„ç§å­ï¼Œæˆ‘ä»¬å°±èƒ½å°†è¿™äº›å€¼å†™åˆ°ç£ç›˜ä¸Šäº†ã€‚è€Œå°±åƒè¿™ä¸ªå¸ƒéš†è¿‡æ»¤å™¨å±•ç¤ºçš„é‚£æ ·ï¼Œå®ƒåº”è¯¥åªè¢«ç”¨äºå†…å­˜ç¼“å­˜ã€‚</p><p><code>hashes(for:)</code> æ–¹æ³•å®Œæˆäº†å¾ˆå¤šç¹é‡çš„å·¥ä½œï¼Œè®© <code>insert</code> æ–¹æ³•éå¸¸ç®€æ´ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">mutating</span> <span class="function"><span class="keyword">func</span> <span class="title">insert</span><span class="params">(<span class="number">_</span> element: Element)</span></span> &#123;</span><br><span class="line">hashes(<span class="keyword">for</span>: element)</span><br><span class="line">.forEach(&#123; hash <span class="keyword">in</span></span><br><span class="line">data[hash % data.<span class="built_in">count</span>] = <span class="literal">true</span></span><br><span class="line">&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç”Ÿæˆæ‰€æœ‰çš„å“ˆå¸Œå€¼ï¼Œåˆ†åˆ«ä½™ä¸Š <code>data</code> æ•°ç»„çš„é•¿åº¦ï¼Œå¹¶è®¾ç½®å¯¹åº”ç´¢å¼•ä½çš„å€¼ä¸º <code>true</code>ã€‚</p><p><code>contains</code> æ–¹æ³•ä¹ŸåŒæ ·ç®€å•ï¼ŒåŒæ—¶ä¹Ÿç»™äº†æˆ‘ä»¬ä½¿ç”¨ Swift 4.2 å¦ä¸€ä¸ªæ–°ç‰¹æ€§ <code>allSatisfy</code> çš„æœºä¼šã€‚è¿™ä¸ªæ–°æ–¹æ³•å¯ä»¥åˆ¤æ–­åºåˆ—ä¸­çš„æ‰€æœ‰å¯¹è±¡æ˜¯å¦éƒ½é€šè¿‡äº†æŸé¡¹ç”¨ block è¡¨ç¤ºçš„æµ‹è¯•ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">contains</span><span class="params">(<span class="number">_</span> element: Element)</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line"><span class="keyword">return</span> hashes(<span class="keyword">for</span>: element)</span><br><span class="line">.allSatisfy(&#123; hash <span class="keyword">in</span></span><br><span class="line">data[hash % data.<span class="built_in">count</span>]</span><br><span class="line">&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å› ä¸º <code>data[hash % data.count]</code> çš„ç»“æœå·²ç»æ˜¯å¸ƒå°”å€¼äº†ï¼Œå®ƒä¸ <code>allSatisfy</code> ååˆ†å¥‘åˆã€‚</p><p>ä½ ä¹Ÿå¯ä»¥æ·»åŠ  <code>isEmpty</code> æ–¹æ³•ç”¨æ¥æ£€æµ‹ <code>data</code> ä¸­çš„æ‰€æœ‰å€¼æ˜¯å¦éƒ½æ˜¯ falseã€‚</p><p>å¸ƒéš†è¿‡æ»¤å™¨æ˜¯ä¸€ç§å¥‡æ€ªçš„æ•°æ®ç»“æ„ã€‚æˆ‘ä»¬æ¥è§¦çš„å¤§å¤šæ•°æ•°æ®ç»“æ„éƒ½æ˜¯æ˜ç¡®æ€§çš„ã€‚å½“æŠŠä¸€ä¸ªå¯¹è±¡æ”¾å…¥å­—å…¸ä¸­æ—¶ï¼Œä½ çŸ¥é“é‚£ä¸ªå€¼ä¹‹åä¸€ç›´åœ¨é‚£å„¿ã€‚è€Œå¸ƒéš†è¿‡æ»¤å™¨æ˜¯æ¦‚ç‡æ€§çš„ï¼Œç‰ºç‰²ç¡®å®šæ€§æ¥æ¢å–ç©ºé—´å’Œé€Ÿåº¦ã€‚å¸ƒéš†è¿‡æ»¤å™¨ä¸æ˜¯ä½ ä¼šæ¯å¤©ç”¨çš„æ•°æ®ç»“æ„ï¼Œä½†å½“ä½ ç¡®å®éœ€è¦å®ƒæ—¶ï¼Œå°±ä¼šæ„Ÿå—åˆ°æœ‰å®ƒçœŸå¥½ã€‚</p><blockquote><p>æœ¬æ–‡ç”± SwiftGG ç¿»è¯‘ç»„ç¿»è¯‘ï¼Œå·²ç»è·å¾—ä½œè€…ç¿»è¯‘æˆæƒï¼Œæœ€æ–°æ–‡ç« è¯·è®¿é—® <a href="http://swift.gg">http://swift.gg</a>ã€‚</p></blockquote>]]></content>
    
    <summary type="html">
    
      æœ¬æ–‡æè¿°äº†å¦‚ä½•ä½¿ç”¨ Swift 4.2 æ–°ç‰¹æ€§ Hashable å®ç°å¸ƒéš†è¿‡æ»¤å™¨ã€‚
    
    </summary>
    
      <category term="Khanlou" scheme="https://swift.gg/categories/Khanlou/"/>
    
    
      <category term="Swift" scheme="https://swift.gg/tags/Swift/"/>
    
  </entry>
  
  <entry>
    <title>è®©æˆ‘ä»¬æ„å»ºä¸€ä¸ªSwift.Array</title>
    <link href="https://swift.gg/2018/12/06/friday-qa-2015-04-17-lets-build-swiftarray/"/>
    <id>https://swift.gg/2018/12/06/friday-qa-2015-04-17-lets-build-swiftarray/</id>
    <published>2018-12-06T00:00:00.000Z</published>
    <updated>2019-02-19T03:45:13.515Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ä½œè€…ï¼šMike Ashï¼Œ<a href="https://www.mikeash.com/pyblog/friday-qa-2015-04-17-lets-build-swiftarray.html" target="_blank" rel="noopener">åŸæ–‡é“¾æ¥</a>ï¼ŒåŸæ–‡æ—¥æœŸï¼š2015-04-17<br>è¯‘è€…ï¼š<a href="https://github.com/dzyding" target="_blank" rel="noopener">ç°s</a>ï¼›æ ¡å¯¹ï¼š<a href="http://numbbbbb.com/" target="_blank" rel="noopener">numbbbbb</a>ï¼Œ<a href="http://forelax.space" target="_blank" rel="noopener">Forelax</a>ï¼›å®šç¨¿ï¼š<a href="http://forelax.space" target="_blank" rel="noopener">Forelax</a></p></blockquote><!--æ­¤å¤„å¼€å§‹æ­£æ–‡--><p>Swift 1.2 ç°å·²ç»ä½œä¸º Xcode 6.3 çš„ä¸€éƒ¨åˆ†è€Œå‘å¸ƒï¼Œåœ¨æ–°çš„ API ä¸­æœ‰ä¸€ä¸ªå…è®¸æˆ‘ä»¬ä½¿ç”¨å€¼ç±»å‹å»ºç«‹é«˜æ•ˆçš„æ•°æ®ç»“æ„ï¼Œæ¯”å¦‚ Swift æ ‡å‡†åº“ä¸­çš„ <code>Array</code> ç±»å‹ã€‚ä»Šå¤©ï¼Œæˆ‘ä»¬å°†é‡æ–°ç°å® <code>Array</code> çš„æ ¸å¿ƒåŠŸèƒ½ã€‚</p><a id="more"></a><h2 id="å€¼ç±»å‹å’Œå¼•ç”¨ç±»å‹"><a href="#å€¼ç±»å‹å’Œå¼•ç”¨ç±»å‹" class="headerlink" title="å€¼ç±»å‹å’Œå¼•ç”¨ç±»å‹"></a>å€¼ç±»å‹å’Œå¼•ç”¨ç±»å‹</h2><p>åœ¨æˆ‘ä»¬å¼€å§‹ä¹‹å‰ï¼Œå¿«é€Ÿçš„å¤ä¹ ä¸€ä¸‹å€¼ç±»å‹å’Œå¼•ç”¨ç±»å‹ã€‚åœ¨ objc ä»¥åŠå¤§éƒ¨åˆ†å…¶ä»–é¢å‘å¯¹è±¡çš„è¯­è¨€ä¸­ï¼Œæˆ‘ä»¬æ‰€ä½¿ç”¨å¯¹è±¡çš„æŒ‡é’ˆæˆ–è€…å¼•ç”¨éƒ½å±äº <strong>å¼•ç”¨ç±»å‹</strong>ã€‚ä½ å¯ä»¥æŠŠä¸€ä¸ªå¯¹è±¡çš„å¼•ç”¨èµ‹å€¼ç»™ä¸€ä¸ªå˜é‡ï¼š</p><figure class="highlight objc"><table><tr><td class="code"><pre><span class="line">MyClass *a = ...;</span><br></pre></td></tr></table></figure><p>ç°åœ¨ä½ å¯ä»¥å°†è¿™ä¸ªå˜é‡çš„å€¼å¤åˆ¶ç»™å¦ä¸€ä¸ªå˜é‡ï¼š</p><figure class="highlight objc"><table><tr><td class="code"><pre><span class="line">MyClass *b = a;</span><br></pre></td></tr></table></figure><p>ç°åœ¨ a å’Œ b éƒ½æŒ‡å‘åŒä¸€ä¸ªå¯¹è±¡ã€‚å¦‚æœè¿™ä¸ªå¯¹è±¡æ˜¯å¯å˜çš„ï¼Œé‚£ä¹ˆå¯¹å…¶ä¸­ä¸€ä¸ªå˜é‡çš„æ”¹å˜åŒæ ·ä¼šå‘ç”Ÿåœ¨å¦ä¸€ä¸ªå˜é‡ä¸Šã€‚</p><p><strong>å€¼ç±»å‹</strong> å°±æ˜¯ç±»ä¼¼ Objective-C ä¸­ <code>int</code> è¿™æ ·çš„å­˜åœ¨ã€‚ä½¿ç”¨å€¼ç±»å‹ï¼Œå˜é‡åŒ…å«çš„æ˜¯çœŸå®çš„å€¼ï¼Œå¹¶ä¸æ˜¯å€¼çš„å¼•ç”¨ã€‚å½“ä½ ç”¨ = ç»™å¦ä¸€ä¸ªå˜é‡èµ‹å€¼ï¼Œæ˜¯å°†å€¼çš„æ‹·è´å‰¯æœ¬èµ‹å€¼ç»™äº†å¦ä¸€ä¸ªå˜é‡ã€‚æ¯”å¦‚ï¼š</p><figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="keyword">int</span> a = <span class="number">42</span>;</span><br><span class="line"><span class="keyword">int</span> b = a;</span><br><span class="line">b++;</span><br></pre></td></tr></table></figure><p>ç°åœ¨ï¼Œb çš„å€¼æ˜¯ 43ï¼Œä½†æ˜¯ a ä¾ç„¶æ˜¯ 42ã€‚  </p><p>åœ¨ Swift ä¸­ï¼Œ<code>class</code> å±äºå¼•ç”¨ç±»å‹ï¼Œ<code>struct</code> å±äºå€¼ç±»å‹ã€‚<br>å¦‚æœä½ ä½¿ç”¨ = å°†ä¸€ä¸ª <code>class</code> å®ä¾‹çš„å¼•ç”¨èµ‹å€¼ç»™å¦ä¸€ä¸ªå˜é‡ï¼Œä½ å°†å¾—åˆ°è¿™ä¸ªå®ä¾‹çš„ä¸€ä¸ªæ–°å¼•ç”¨ã€‚å¯¹è¿™ä¸ªå®ä¾‹çš„ä¿®æ”¹å¯¹æ¯ä¸€ä¸ªå¼•ç”¨å¯è§ã€‚<br>å¦‚æœä½ ä½¿ç”¨ = å°†ä¸€ä¸ª <code>struct</code> å®ä¾‹çš„å¼•ç”¨èµ‹å€¼ç»™å¦ä¸€ä¸ªå˜é‡ï¼Œä½ å°†å¾—åˆ°è¿™ä¸ªå®ä¾‹çš„ä¸€ä¸ªå‰¯æœ¬ï¼Œä¸åŸå§‹æ•°æ®ç›¸äº’ç‹¬ç«‹ã€‚  </p><p>ä¸å¤§å¤šæ•°è¯­è¨€ä¸åŒï¼ŒSwift æ ‡å‡†åº“ä¸­çš„æ•°ç»„å’Œå­—å…¸éƒ½æ˜¯å€¼ç±»å‹ã€‚æ¯”å¦‚ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> a = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line"><span class="keyword">var</span> b = a</span><br><span class="line">b.append(<span class="number">4</span>)</span><br></pre></td></tr></table></figure><p>åœ¨å¤§éƒ¨åˆ†è¯­è¨€ä¸­ï¼Œè¿™æ®µä»£ç ï¼ˆæˆ–è€…ç­‰æ•ˆçš„ä»£ç ï¼‰è¿è¡Œä»¥åï¼Œ a å’Œ b å°†éƒ½æ˜¯ä¸€ä¸ªæŒ‡å‘æ•°ç»„ <code>[1, 2, 3, 4]</code> çš„å¼•ç”¨ã€‚ä½†æ˜¯åœ¨ Swift ä¸­ï¼Œa æ˜¯æŒ‡å‘æ•°ç»„ <code>[1, 2, 3]</code> çš„å¼•ç”¨ï¼Œb æ˜¯æŒ‡å‘æ•°ç»„ <code>[1, 2, 3, 4]</code> çš„å¼•ç”¨ã€‚</p><h2 id="å€¼ç±»å‹çš„å®ç°"><a href="#å€¼ç±»å‹çš„å®ç°" class="headerlink" title="å€¼ç±»å‹çš„å®ç°"></a>å€¼ç±»å‹çš„å®ç°</h2><p>å¦‚æœä½ çš„å¯¹è±¡æ‹¥æœ‰çš„å±æ€§æ˜¯å›ºå®šçš„ï¼Œåœ¨ Swift ä¸­æŠŠå®ƒç”³æ˜æˆå€¼ç±»å‹æ˜¯å¾ˆç®€å•çš„ï¼šåªéœ€è¦æŠŠæ‰€æœ‰çš„å±æ€§æ”¾å…¥ä¸€ä¸ª <code>struct</code> ä¸­å³å¯ã€‚æ¯”å¦‚ï¼Œå¦‚æœä½ éœ€è¦ä¸€ä¸ª 2D çš„ <code>Point</code> å€¼ç±»å‹ï¼Œä½ å¯ä»¥ç®€å•çš„ç”³æ˜ä¸€ä¸ª <code>struct</code> åŒ…å« x å’Œ y ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Point</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> x: <span class="type">Int</span></span><br><span class="line">    <span class="keyword">var</span> y: <span class="type">Int</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¾ˆå¿«çš„ï¼Œä½ å°±ç”³æ˜äº†ä¸€ä¸ªå€¼ç±»å‹ã€‚ä½†æ˜¯å¦‚ä½•å®ç°ç±»ä¼¼ <code>Array</code> è¿™æ ·çš„å€¼ç±»å‹å‘¢ï¼Ÿä½ æ— æ³•æŠŠæ•°ç»„é‡Œé¢æ‰€æœ‰æ•°æ®æ”¾å…¥ <code>struct</code> çš„ç”³æ˜ä¸­ï¼Œå› ä¸ºåœ¨å†™ä»£ç çš„è¿‡ç¨‹ä¸­ä½ æ— æ³•é¢„æ–™ä½ å°†ä¼šåœ¨æ•°ç»„ä¸­æ”¾å¤šå°‘æ•°æ®ã€‚ä½ å¯ä»¥åˆ›å»ºä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘æ‰€æœ‰çš„æ•°æ®ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Array</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> ptr: <span class="type">UnsafeMutablePointer</span>&lt;<span class="type">T</span>&gt;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŒæ—¶ï¼Œä½ éœ€è¦åœ¨è¯¥ <code>struct</code> æ¯æ¬¡<strong>åˆ†é…</strong>å’Œ<strong>é”€æ¯</strong>çš„æ—¶å€™è¿›è¡Œä¸€äº›ç‰¹æ®Šæ“ä½œã€‚  </p><ul><li>åœ¨åˆ†é…çš„è¿‡ç¨‹ä¸­ï¼Œä½ éœ€è¦æŠŠåŒ…å«çš„æ•°æ®æ‹·è´ä¸€ä»½æ”¾åˆ°ä¸€ä¸ªæ–°çš„å†…å­˜åœ°å€ï¼Œè¿™æ—¶æ–°çš„ <code>struct</code> å°±ä¸ä¼šå’ŒåŸæ•°æ®å…±äº«åŒä¸€ä»½æ•°æ®äº†ã€‚  </li><li>åœ¨é”€æ¯çš„è¿‡ç¨‹ä¸­ï¼Œ<code>ptr</code> æŒ‡é’ˆä¹Ÿéœ€è¦æ­£å¸¸é”€æ¯ã€‚  </li></ul><p>åœ¨ Swift ä¸­ä¸å…è®¸å¯¹ <code>struct</code> çš„åˆ†é…å’Œé”€æ¯è¿‡ç¨‹è¿›è¡Œè‡ªå®šä¹‰ã€‚</p><p>é”€æ¯æ“ä½œå¯ä»¥ä½¿ç”¨ä¸€ä¸ª <code>class</code> å®ç°ï¼Œå®ƒæä¾›äº† <code>deinit</code>ã€‚åŒæ—¶å¯ä»¥åœ¨è¿™é‡Œå¯¹æŒ‡é’ˆè¿›è¡Œé”€æ¯ã€‚<code>class</code> å¹¶ä¸æ˜¯å€¼ç±»å‹ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥å°† <code>class</code> ä½œä¸ºä¸€ä¸ªå†…éƒ¨å±æ€§æä¾›ç»™ <code>struct</code> ä½¿ç”¨ï¼Œå¹¶æŠŠæ•°ç»„ä½œä¸º <code>struct</code> æš´éœ²ç»™å¤–éƒ¨æ¥å£ã€‚çœ‹èµ·æ¥å°±åƒè¿™æ ·ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ArrayImpl</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> ptr: <span class="type">UnsafeMutablePointer</span>&lt;<span class="type">T</span>&gt;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">deinit</span> &#123;</span><br><span class="line">        ptr.destroy(...)</span><br><span class="line">        ptr.dealloc(...)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Array</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> impl: <span class="type">ArrayImpl</span>&lt;<span class="type">T</span>&gt;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ—¶åœ¨ <code>Array</code> ä¸­ç”³æ˜çš„æ–¹æ³•ï¼Œå®ƒçš„å®é™…æ“ä½œéƒ½æ˜¯åœ¨ <code>ArrayImpl</code> ä¸Šè¿›è¡Œçš„ã€‚</p><p>åˆ°è¿™é‡Œå°±å¯ä»¥ç»“æŸäº†å—ï¼Ÿå°½ç®¡æˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ <code>struct</code>ï¼Œ ä½†æ˜¯ä½¿ç”¨çš„ä¾æ—§æ˜¯å¼•ç”¨ç±»å‹ã€‚å¦‚æœå°†è¿™ä¸ª <code>struct</code> æ‹·è´ä¸€ä»½ï¼Œæˆ‘ä»¬å°†è·å¾—ä¸€ä¸ªæ–°çš„ <code>struct</code>ï¼ŒæŒæœ‰çš„ä»ç„¶æ˜¯ä¹‹å‰çš„ <code>ArrayImpl</code>ã€‚ç”±äºæˆ‘ä»¬æ— æ³•è‡ªå®šä¹‰ <code>struct</code> çš„åˆ†é…è¿‡ç¨‹ï¼Œæ‰€ä»¥æ²¡æœ‰åŠæ³•åŒæ ·æŠŠ <code>ArrayImpl</code> ä¹Ÿæ‹·è´ä¸€ä»½ã€‚  </p><p>è¿™ä¸ªé—®é¢˜çš„è§£å†³æ–¹æ³•æ˜¯æ”¾å¼ƒåœ¨åˆ†é…çš„è¿‡ç¨‹ä¸­è¿›è¡Œæ‹·è´ï¼Œè€Œæ˜¯åœ¨ <code>ArrayImpl</code> å‘ç”Ÿæ”¹å˜çš„æ—¶å€™è¿›è¡Œæ‹·è´ã€‚å…³é”®åœ¨äºï¼Œå°±ç®—ä¸€ä¸ªæ‹·è´å‰¯æœ¬ä¸åŸå§‹æ•°æ®å…±äº«ä¸€ä¸ªå¼•ç”¨ï¼Œä½†æ˜¯åªè¦è¿™ä¸ªå¼•ç”¨çš„æ•°æ®ä¸å‘ç”Ÿæ”¹å˜ï¼Œå€¼ç±»å‹çš„è¯­ä¹‰å°±ä¾æ—§æˆç«‹ã€‚åªæœ‰å½“è¿™ä¸ªå…±äº«æ•°æ®çš„å€¼å‘ç”Ÿæ”¹å˜æ—¶ï¼Œå€¼ç±»å‹å’Œå¼•ç”¨ç±»å‹æ‰æœ‰äº†æ˜æ˜¾çš„åŒºåˆ«ã€‚  </p><p>æ¯”å¦‚ï¼Œåœ¨å®ç° <code>append</code> æ–¹æ³•çš„æ—¶å€™ä½ å¯ä»¥å…ˆå¯¹ <code>ArrayImpl</code> è¿›è¡Œ <code>copy</code> (å‡è®¾ <code>ArrayImpl</code> çš„å®ç°ä¸­æœ‰ä¸€ä¸ª <code>copy</code> æ–¹æ³•ï¼Œé‚£ä¹ˆå°† <code>impl</code> å¼•ç”¨æ”¹ä¸ºåŸå§‹å€¼çš„ <code>copy</code>)ï¼š  </p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">mutating</span> <span class="function"><span class="keyword">func</span> <span class="title">append</span><span class="params">(value: T)</span></span> &#123;</span><br><span class="line">    impl = impl.copy()</span><br><span class="line">    impl.append(value)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ · Array å°±æ˜¯ä¸€ä¸ªå€¼ç±»å‹äº†ã€‚å°½ç®¡ a å’Œ b åœ¨åˆšèµ‹å€¼å®Œæ—¶ä»ç„¶å…±äº«åŒä¸€ä¸ª <code>impl</code> å¼•ç”¨ ï¼Œä½†æ˜¯ä»»ä½•ä¼šæ”¹å˜ <code>impl</code> çš„æ–¹æ³•éƒ½å°†å¯¹å…¶è¿›è¡Œä¸€æ¬¡ <code>copy</code>ï¼Œå› æ­¤ä¿ç•™äº†ä¸å…±äº«æ•°æ®çš„é”™è§‰ã€‚  </p><p>ç°åœ¨å¯ä»¥æ­£å¸¸å·¥ä½œäº†ï¼Œä½†æ˜¯æ•ˆç‡å´éå¸¸ä½ã€‚æ¯”å¦‚ï¼š  </p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> a: [<span class="type">Int</span>] = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="number">0</span>..&lt;<span class="number">1000</span> &#123;</span><br><span class="line">    a.append(i)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å°½ç®¡ä½¿ç”¨è€…æ— æ³•çœ‹åˆ°å®ƒï¼Œä½†æ˜¯å®ƒå°†åœ¨å¾ªç¯çš„æ¯æ¬¡è¿­ä»£ä¸­å¤åˆ¶å†…å­˜ä¸­çš„æ•°æ®ï¼Œç„¶åç«‹å³é”€æ¯ä¹‹å‰çš„æ•°æ®å†…å­˜ã€‚å¦‚ä½•æ‰èƒ½ä¼˜åŒ–å®ƒå‘¢ï¼Ÿ</p><h2 id="isUniquelyReferenced"><a href="#isUniquelyReferenced" class="headerlink" title="isUniquelyReferenced"></a>isUniquelyReferenced</h2><p>è¿™æ˜¯ä¸€ä¸ª Swift 1.2 ä¸­æ–°å¼•å…¥çš„ APIã€‚å®ƒæ¼‚äº®çš„å®ç°äº†å®ƒå­—é¢ä¸Šçš„æ„æ€ã€‚èµ‹äºˆå®ƒä¸€ä¸ªå¯¹è±¡çš„å¼•ç”¨ç„¶åå®ƒå°†å‘Šè¯‰ä½ è¿™ä¸ªå¼•ç”¨æ˜¯å¦ä¸ºç‹¬ç«‹çš„ã€‚å…·ä½“æ¥è¯´ï¼Œå½“è¿™ä¸ªå¯¹è±¡æœ‰ä¸”ä»…æœ‰ä¸€ä¸ªå¼ºå¼•ç”¨æ—¶ï¼Œå°±ä¼šè¿”å› <code>true</code>ã€‚  </p><p>æˆ‘ä»¬çŒœæµ‹è¿™ä¸ª API ä¼šæ£€æŸ¥å¯¹è±¡çš„å¼•ç”¨è®¡æ•°ï¼Œå¹¶ä¸”åœ¨å¼•ç”¨è®¡æ•°ä¸º 1 çš„æ—¶å€™è¿”å› <code>true</code> ã€‚é‚£ Swift ä¸ºä»€ä¹ˆä¸ç›´æ¥æä¾›ä¸€ä¸ªæ¥å£æ¥æŸ¥è¯¢å¼•ç”¨è®¡æ•°å‘¢ï¼Ÿå¯èƒ½åœ¨å®ç°ä¸Šè¿™ä¸ªæ¥å£ä¸å¤ªå¥½åšï¼Œå¹¶ä¸”å¼•ç”¨è®¡æ•°å±äºæ¯”è¾ƒå®¹æ˜“è¢«æ»¥ç”¨çš„ä¿¡æ¯ï¼Œæ‰€ä»¥ Swift æä¾›äº†è¿™ä¸ªå°è£…è¿‡çš„ï¼Œæ›´åŠ å®‰å…¨çš„æ¥å£ã€‚</p><p>ä½¿ç”¨è¿™ä¸ª APIï¼Œä¹‹å‰å¯¹ <code>append</code> æ–¹æ³•çš„å®ç°å°†å¯ä»¥æ”¹æˆåªæœ‰åœ¨éœ€è¦çš„æ—¶å€™æ‰å¯¹å†…å­˜ä¸­çš„æ•°æ®è¿›è¡Œå¤åˆ¶: </p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">    <span class="keyword">mutating</span> <span class="function"><span class="keyword">func</span> <span class="title">append</span><span class="params">(value: T)</span></span> &#123;</span><br><span class="line">        <span class="keyword">if</span> !isUniquelyReferencedNonObjc(&amp;impl) &#123;</span><br><span class="line">            impl = impl.copy()</span><br><span class="line">        &#125;</span><br><span class="line">        impl.append(value)</span><br><span class="line">    &#125;</span><br><span class="line">``` </span><br><span class="line"></span><br><span class="line">è¿™ä¸ª <span class="type">API</span> å®é™…ä¸Šæ˜¯ä¸€ç»„ä¸‰ä¸ªæ–¹æ³•ä¸­çš„ä¸€ä¸ªã€‚å­˜åœ¨äº <span class="type">Xcode</span> è‡ªå¸¦çš„ <span class="type">Swift</span> æ ‡å‡†åº“ä¸­:  </span><br><span class="line"></span><br><span class="line">```swift</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">isUniquelyReferenced</span>&lt;T : NonObjectiveCBase&gt;<span class="params">(<span class="keyword">inout</span> object: T)</span></span> -&gt; <span class="type">Bool</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">isUniquelyReferencedNonObjC</span>&lt;T&gt;<span class="params">(<span class="keyword">inout</span> object: T?)</span></span> -&gt; <span class="type">Bool</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">isUniquelyReferencedNonObjC</span>&lt;T&gt;<span class="params">(<span class="keyword">inout</span> object: T)</span></span> -&gt; <span class="type">Bool</span></span><br></pre></td></tr></table></figure><p>è¿™äº›æ–¹æ³•åªèƒ½ä½œç”¨åœ¨çº¯ Swift class ä¸­ï¼Œå¹¶ä¸æ”¯æŒ @objc ç±»å‹ã€‚ç¬¬ä¸€ä¸ªæ–¹æ³•å¿…é¡»ç¡®ä¿ T ä¸º <code>NonObjectiveCBase</code> çš„å­ç±»ã€‚å¦å¤–ä¸¤ä¸ªæ–¹æ³•å¯¹å‚æ•°çš„ç±»å‹å¹¶ä¸åšè¦æ±‚ï¼Œåªæ˜¯å½“ç±»å‹ä¸º @objc æ—¶ç›´æ¥è¿”å› falseã€‚  </p><p>æˆ‘æ— æ³•è®©æˆ‘çš„ä»£ç ä»¥ <code>NonObjectiveCBase</code> ç±»å‹æ¥ç¼–è¯‘ï¼Œæ‰€ä»¥ä½¿ç”¨äº† <code>isUniquelyReferencedNonObjC</code> æ¥ä»£æ›¿ã€‚ä»åŠŸèƒ½ä¸Šæ¥è¯´ï¼Œå®ƒä»¬å¹¶æ²¡æœ‰åŒºåˆ«ã€‚  </p><blockquote><p>è¯‘è€…æ³¨ï¼š<br>æ–‡ç« ä¸­æ‰€é˜è¿°çš„ <code>isUniquelyReferencedNonObjC</code> API å·²ç»åœ¨ Swift 3.1 çš„æ—¶å€™è¢«æ›¿æ¢ä¸º <code>isKnownUniquelyReferenced</code><br>è¯¦æƒ…å¯ä»¥å‚è€ƒ swift-evolution ä¸­çš„è¿™æ¡ <a href="https://github.com/apple/swift-evolution/blob/master/proposals/0125-remove-nonobjectivecbase.md" target="_blank" rel="noopener">å»ºè®®</a></p></blockquote><h2 id="ArrayImpl"><a href="#ArrayImpl" class="headerlink" title="ArrayImpl"></a>ArrayImpl</h2><p>è®©æˆ‘ä»¬å¼€å§‹å®ç° Swift.Arrayï¼Œé¦–å…ˆä» <code>ArrayImpl</code> å¼€å§‹ï¼Œç„¶åæ‰æ˜¯ <code>Array</code>ã€‚  </p><p>åœ¨è¿™é‡Œæˆ‘å¹¶ä¸ä¼šé‡æ–°å®ç° <code>Array</code> å®Œæ•´çš„ APIï¼Œåªæ˜¯å®ç°æ»¡è¶³å…¶æ­£å¸¸è¿è¡Œçš„åŸºæœ¬åŠŸèƒ½ï¼Œå¹¶å±•ç¤ºå®ƒæ¶‰åŠçš„åŸç†ã€‚  </p><p><code>ArrayImpl</code> æœ‰ä¸‰ä¸ªå±æ€§ï¼šæŒ‡é’ˆï¼Œæ•°ç»„å…ƒç´ çš„æ€»æ•°ï¼Œä»¥åŠå·²ç”³è¯·å†…å­˜ç©ºé—´ä¸­çš„å‰©ä½™å®¹é‡ã€‚åªæœ‰æŒ‡é’ˆå’Œå…ƒç´ çš„æ€»æ•°æ˜¯å¿…é¡»çš„ï¼Œä½†æ˜¯ç›¸æ¯”ç”³è¯·æ›´å¤šçš„å†…å­˜ç©ºé—´ï¼Œå®æ—¶ç›‘æ§å‰©ä½™å®¹é‡å¹¶æŒ‰éœ€ç”³è¯·ï¼Œæˆ‘ä»¬å¯ä»¥é¿å…ä¸€å¤§ç¬”æ˜‚è´µçš„å†…å­˜é‡æ–°åˆ†é…ã€‚ä¸‹é¢æ˜¯ç±»å¼€å§‹çš„éƒ¨åˆ†ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ArrayImpl</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> space: <span class="type">Int</span></span><br><span class="line">    <span class="keyword">var</span> <span class="built_in">count</span>: <span class="type">Int</span></span><br><span class="line">    <span class="keyword">var</span> ptr: <span class="type">UnsafeMutablePointer</span>&lt;<span class="type">T</span>&gt;</span><br></pre></td></tr></table></figure><p>åœ¨ <code>init</code> æ–¹æ³•ä¸­éœ€è¦ä¸€ä¸ªè®¡æ•°å’Œä¸€ä¸ªæŒ‡é’ˆï¼Œç„¶åå°†æŒ‡é’ˆæ‰€æŒ‡å‘çš„å†…å®¹å¤åˆ¶åˆ°æ–°çš„å¯¹è±¡ã€‚æ–¹æ³•æä¾›äº†é»˜è®¤å€¼ 0 å’Œ nil ï¼Œæ‰€ä»¥ <code>init</code> å¯ä»¥åœ¨ä¸ä¼ å…¥ä»»ä½•å‚æ•°çš„æƒ…å†µä¸‹è¢«ç”¨æ¥åˆ›å»ºä¸€ä¸ªæ‹¥æœ‰ç©ºæ•°ç»„çš„å®ä¾‹ï¼š  </p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">        <span class="keyword">init</span>(<span class="built_in">count</span>: <span class="type">Int</span> = <span class="number">0</span>, ptr: <span class="type">UnsafeMutablePointer</span>&lt;<span class="type">T</span>&gt; = <span class="literal">nil</span>) &#123;</span><br><span class="line">            <span class="keyword">self</span>.<span class="built_in">count</span> = <span class="built_in">count</span></span><br><span class="line">            <span class="keyword">self</span>.space = <span class="built_in">count</span></span><br><span class="line">            </span><br><span class="line">            <span class="keyword">self</span>.ptr = <span class="type">UnsafeMutablePointer</span>&lt;<span class="type">T</span>&gt;.alloc(<span class="built_in">count</span>)</span><br><span class="line">            <span class="keyword">self</span>.ptr.initializeFrom(ptr, <span class="built_in">count</span>: <span class="built_in">count</span>)</span><br><span class="line">        &#125;</span><br><span class="line">```  </span><br><span class="line"></span><br><span class="line">`initializeFrom` æ–¹æ³•å¯ä»¥å°†æ•°æ®å¤åˆ¶åˆ°æ–°çš„æŒ‡é’ˆã€‚æ³¨æ„åŒºåˆ† `<span class="type">UnsafeMutablePointer</span>` å¤„äºä¸åŒèµ‹å€¼æ–¹å¼ä¹‹é—´çš„ä¸åŒï¼Œè¿™å¯¹äºç¡®ä¿å®ƒä»¬æ­£å¸¸å·¥ä½œä»¥åŠé¿å…å´©æºƒååˆ†é‡è¦ã€‚ä¸åŒä¹‹å¤„åœ¨äºæ•°æ®å†…å­˜æ˜¯å¦è¢«å¤„ç†ä¸ºåˆå§‹åŒ–æˆ–æœªåˆå§‹åŒ–ã€‚åœ¨è°ƒç”¨ `alloc` æ—¶ï¼Œç”Ÿæˆçš„æŒ‡é’ˆå¤„äºæœªåˆå§‹åŒ–çš„çŠ¶æ€ï¼Œå¹¶ä¸”å¯èƒ½è¢«åƒåœ¾æ•°æ®å¡«æ»¡ã€‚ä¸€ä¸ªç®€å•çš„èµ‹å€¼ï¼Œä¾‹å¦‚ `ptr.memory = ...` ï¼Œæ­¤æ—¶æ˜¯ä¸åˆæ³•çš„ï¼Œå› ä¸ºèµ‹å€¼æ“ä½œå°†ä¼šåœ¨å¤åˆ¶æ–°çš„å€¼ä¹‹å‰ææ„å·²ç»å­˜åœ¨çš„å€¼ã€‚å¦‚æœæ˜¯ç±»ä¼¼ `int` è¿™æ ·çš„åŸºç¡€æ•°æ®ç±»å‹å°†æ²¡ä»€ä¹ˆé—®é¢˜ï¼Œä½†æ˜¯å¦‚æœä½ æ“ä½œçš„æ˜¯ä¸€ä¸ªå¤æ‚æ•°æ®ç±»å‹å®ƒå°†å´©æºƒã€‚åœ¨è¿™é‡Œ `initializeFrom` å°†ç›®æ ‡æŒ‡é’ˆè§†ä¸ºæœªåˆå§‹åŒ–çš„å†…å­˜ï¼Œè€Œè¿™æ­£æ˜¯å®ƒçš„æœ¬è´¨ã€‚  </span><br><span class="line"></span><br><span class="line">æ¥ä¸‹æ¥æ˜¯ä¸€ä¸ªæ”¹å˜è¿‡çš„ `append` æ–¹æ³•ã€‚å®ƒåšçš„ç¬¬ä¸€ä»¶äº‹æ˜¯æ£€æŸ¥æŒ‡é’ˆæ˜¯å¦éœ€è¦é‡æ–°åˆ†é…ã€‚å¦‚æœæ²¡æœ‰å‰©ä½™çš„ç©ºé—´å¯ç”¨ï¼Œæˆ‘ä»¬éœ€è¦ä¸€å—æ–°çš„å†…å­˜ï¼š</span><br><span class="line"></span><br><span class="line">```swift</span><br><span class="line">        <span class="function"><span class="keyword">func</span> <span class="title">append</span><span class="params">(obj: T)</span></span> &#123;</span><br><span class="line">            <span class="keyword">if</span> space == <span class="built_in">count</span> &#123;</span><br><span class="line">                <span class="comment">// åœ¨æ–°çš„å†…å­˜åˆ†é…ä¸­ï¼Œæˆ‘ä»¬å°†ç”³è¯·ä¸¤å€çš„å®¹é‡ï¼Œå¹¶ä¸”æœ€å°å€¼ä¸º 16 :</span></span><br><span class="line">                <span class="keyword">let</span> newSpace = <span class="built_in">max</span>(space * <span class="number">2</span>, <span class="number">16</span>)</span><br><span class="line">                <span class="keyword">let</span> newPtr = <span class="type">UnsafeMutablePointer</span>&lt;<span class="type">T</span>&gt;.alloc(newSpace)</span><br><span class="line">                <span class="comment">// ä»æ—§çš„å†…å­˜ä¸­å°†æ•°æ®æ‹·è´åˆ°æ–°çš„åœ°å€</span></span><br><span class="line">                newPtr.moveInitializeFrom(ptr, <span class="built_in">count</span>: <span class="built_in">count</span>)</span><br><span class="line">                <span class="comment">/*</span></span><br><span class="line"><span class="comment">                è¿™æ˜¯å¦ä¸€ç§èµ‹å€¼ï¼Œå®ƒä¸ä»…æŠŠç›®çš„æŒ‡é’ˆçœ‹åšæ˜¯æœªåˆå§‹åŒ–çš„ï¼Œå¹¶ä¸”ä¼šæŠŠæ•°æ®æºé”€æ¯ã€‚  </span></span><br><span class="line"><span class="comment">                å®ƒèŠ‚çœäº†æˆ‘ä»¬å•ç‹¬å†™ä»£ç æ¥é”€æ¯æ—§å†…å­˜çš„æ“ä½œï¼ŒåŒæ—¶å¯èƒ½æ›´åŠ é«˜æ•ˆã€‚  </span></span><br><span class="line"><span class="comment">                éšç€æ•°æ®çš„ç§»åŠ¨å®Œæˆï¼Œæ—§æŒ‡é’ˆå°†å¯ä»¥è¢«é‡Šæ”¾ï¼Œæ–°çš„æ•°æ®å°†è¢«èµ‹å€¼ç»™ç±»çš„å±æ€§ï¼š</span></span><br><span class="line"><span class="comment">                */</span></span><br><span class="line">                ptr.dealloc(space)</span><br><span class="line">                ptr = newPtr</span><br><span class="line">                space = newSpace</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// ç°åœ¨æˆ‘ä»¬ç¡®ä¿¡æœ‰è¶³å¤Ÿçš„ç©ºé—´ï¼Œæ‰€ä»¥å¯ä»¥æŠŠæ–°çš„å€¼æ”¾åœ¨å†…å­˜çš„æœ€åé¢å¹¶ä¸”é€’å¢ count å±æ€§çš„å€¼:</span></span><br><span class="line">            (ptr + <span class="built_in">count</span>).initialize(obj)</span><br><span class="line">            <span class="built_in">count</span>++</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure><p>æ”¹å˜è¿‡çš„ <code>remove</code> æ–¹æ³•å°†æ›´ä¸ºç®€æ´ï¼Œå› ä¸ºæ²¡æœ‰å¿…è¦é‡æ–°åˆ†é…å†…å­˜ã€‚é¦–å…ˆï¼Œä»–å°†åœ¨ç§»é™¤ä¸€ä¸ªå€¼ä¹‹å‰å…ˆå°†å…¶é”€æ¯ï¼š  </p><blockquote><p>è¯‘è€…æ³¨ï¼š<br>è¿™é‡Œçš„ # å·ä¸ç”¨ç†ä¼šï¼Œåœ¨æ—©æœŸçš„ Swift ç‰ˆæœ¬ä¸­å®ƒè¡¨ç¤ºå†…å¤–å‚æ•°åŒåï¼‰**</p></blockquote><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">remove</span><span class="params">(# index: Int)</span></span> &#123;</span><br><span class="line">    (ptr + index).destroy()</span><br><span class="line">    <span class="comment">// moveInitializeFrom æ–¹æ³•è´Ÿè´£å°†æ‰€æœ‰åœ¨è¢«ç§»é™¤å…ƒç´ ä¹‹åçš„å…ƒç´ å¾€å‰æŒªä¸€ä¸ªä½ç½®</span></span><br><span class="line">    (ptr + index).moveInitializeFrom(ptr + index + <span class="number">1</span>, <span class="built_in">count</span>: <span class="built_in">count</span> - index - <span class="number">1</span>)</span><br><span class="line">    <span class="comment">// é€’å‡ count å±æ€§çš„å€¼æ¥ä½“ç°è¿™æ¬¡åˆ é™¤æ“ä½œ</span></span><br><span class="line">    <span class="built_in">count</span>--</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬åŒæ ·éœ€è¦ä¸€ä¸ª <code>copy</code> æ–¹æ³•æ¥ç¡®ä¿å½“éœ€è¦çš„æ—¶å€™å¯ä»¥ä»æ•°æ®å†…å­˜ä¸­å¤åˆ¶ä¸€ä»½ã€‚å®é™…å…³äºå¤åˆ¶çš„ä»£ç å­˜åœ¨äº <code>init</code> æ–¹æ³•ä¸­ï¼Œæ‰€ä»¥æˆ‘ä»¬åªéœ€è¦åˆ›å»ºä¸€ä¸ªå®ä¾‹ä¹Ÿå°±ç›¸å½“äºæ‰§è¡Œäº†ä¸€æ¬¡å¤åˆ¶ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">copy</span><span class="params">()</span></span> -&gt; <span class="type">ArrayImpl</span>&lt;<span class="type">T</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="type">ArrayImpl</span>&lt;<span class="type">T</span>&gt;(<span class="built_in">count</span>: <span class="built_in">count</span>, ptr: ptr)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·ï¼Œæˆ‘ä»¬å°±åŸºæœ¬ä¸Šå®Œæˆäº†æ‰€æœ‰çš„äº‹æƒ…ã€‚æˆ‘ä»¬åªéœ€è¦ç¡®ä¿åœ¨å®ƒè‡ªå·±å°†è¦è¢«é”€æ¯ï¼Œè°ƒç”¨ <code>deinit</code> æ–¹æ³•ä¹‹åé”€æ¯æ‰€æœ‰æ•°ç»„ä¸­çš„å…ƒç´ å¹¶é‡Šæ”¾æŒ‡é’ˆï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">    <span class="keyword">deinit</span> &#123;</span><br><span class="line">        ptr.destroy(<span class="built_in">count</span>)</span><br><span class="line">        ptr.dealloc(space)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è®©æˆ‘ä»¬æŠŠå®ƒç§»åˆ° <code>Array struct</code>ã€‚å®ƒå”¯ä¸€çš„å±æ€§å°±æ˜¯ä¸€ä¸ª <code>ArrayImpl</code>ã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Array</span>&lt;<span class="title">T</span>&gt;: <span class="title">SequenceType</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> impl: <span class="type">ArrayImpl</span>&lt;<span class="type">T</span>&gt; = <span class="type">ArrayImpl</span>&lt;<span class="type">T</span>&gt;()</span><br></pre></td></tr></table></figure><p>æ‰€æœ‰ <code>mutating</code> ç±»å‹çš„æ–¹æ³•éƒ½å°†ä»¥æ£€æŸ¥ <code>impl</code> æ˜¯ä¸æ˜¯ç‹¬ç«‹çš„å¼•ç”¨ä¸ºå¼€å§‹ï¼Œå¹¶åœ¨ä¸æ˜¯çš„æ—¶å€™è¿›è¡Œå¤åˆ¶æ“ä½œã€‚å°†æŠŠå®ƒå°è£…æˆä¸€ä¸ªå‡½æ•°æä¾›ç»™å…¶ä»–çš„æ–¹æ³•ä½¿ç”¨ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">mutating</span> <span class="function"><span class="keyword">func</span> <span class="title">ensureUnique</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> !<span class="built_in">isUniquelyReferencedNonObjC</span>(&amp;impl) &#123;</span><br><span class="line">        impl = impl.copy()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>append</code> æ–¹æ³•ç°åœ¨åªè°ƒç”¨äº† <code>ensureUnique</code> æ–¹æ³•ï¼Œç„¶åè°ƒç”¨ <code>ArrayImpl</code> çš„ <code>append</code> æ–¹æ³•ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">mutating</span> <span class="function"><span class="keyword">func</span> <span class="title">append</span><span class="params">(value: T)</span></span> &#123;</span><br><span class="line">    ensureUnique()</span><br><span class="line">    impl.append(value)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>remove</code> æ–¹æ³•ä¹Ÿæ˜¯ä¸€æ ·ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">mutating</span> <span class="function"><span class="keyword">func</span> <span class="title">remove</span><span class="params">(# index: Int)</span></span> &#123;</span><br><span class="line">    ensureUnique()</span><br><span class="line">    impl.remove(index: index)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>count</code> å±æ€§ç›´æ¥é€šè¿‡ <code>ArrayImpl&#39;s</code> æ¥è¿”å›ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="built_in">count</span>: <span class="type">Int</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> impl.<span class="built_in">count</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸‹æ ‡æ“ä½œç›´æ¥é€šè¿‡åº•å±‚æŒ‡é’ˆæ¥è¿›è¡Œè®¿é—®ã€‚å¦‚æœæˆ‘ä»¬æ˜¯åœ¨å†™çœŸå®çš„ä»£ç ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬ä¼šéœ€è¦è¿›è¡Œä¸€ä¸ªèŒƒå›´çš„æ£€æŸ¥ï¼ˆ<code>remove</code> æ–¹æ³•ä¸­ä¹Ÿæ˜¯ï¼‰ï¼Œä½†æ˜¯åœ¨è¿™ä¸ªä¾‹å­ä¸­æˆ‘ä»¬å°†å®ƒçœç•¥äº†ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">subscript</span>(index: <span class="type">Int</span>) -&gt; <span class="type">T</span> &#123;</span><br><span class="line">    <span class="keyword">get</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> impl.ptr[index]</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">mutating</span> <span class="keyword">set</span> &#123;</span><br><span class="line">        ensureUnique()</span><br><span class="line">        impl.ptr[index] = newValue</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ€åï¼Œ<code>Array</code> éµå¾ª <code>SequenceType</code> åè®®ä»¥æ”¯æŒ <code>for in</code> å¾ªç¯ã€‚å…¶å¿…é¡»å®ç° <code>Generator typealias</code> å’Œ <code>generate</code> æ–¹æ³•ã€‚å†…ç½®çš„ <code>GeneratorOf</code> ç±»å‹ä½¿å…¶å¾ˆå®¹æ˜“å®ç°ã€‚<code>GeneratorOf</code> ä½¿ç”¨ä¸€ä¸ªä»£ç å—ç¡®ä¿åœ¨å…¶æ¯æ¬¡è¢«è®¿é—®çš„æ—¶å€™è¿”å›é›†åˆä¸­çš„ä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œæˆ–è€…å½“åˆ°è¾¾ç»“å°¾çš„æ—¶å€™è¿”å› <code>nil</code>ï¼Œå¹¶åˆ›é€ ä¸€ä¸ª <code>GeneratorType</code> æ¥å°è£…è¯¥ä»£ç å—ï¼š  </p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">typealias</span> <span class="type">Generator</span> = <span class="type">GeneratorOf</span>&lt;<span class="type">T</span>&gt;</span><br></pre></td></tr></table></figure><p><code>generate</code> æ–¹æ³•ä» 0 å¼€å§‹é€’å¢ç›´åˆ°è¿è¡Œè‡³ç»“å°¾ï¼Œç„¶åå¼€å§‹è¿”å› <code>nil</code>ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">generate</span><span class="params">()</span></span> -&gt; <span class="type">Generator</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> index = <span class="number">0</span></span><br><span class="line">        <span class="keyword">return</span> <span class="type">GeneratorOf</span>&lt;<span class="type">T</span>&gt;(&#123;</span><br><span class="line">            <span class="keyword">if</span> index &lt; <span class="keyword">self</span>.<span class="built_in">count</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">self</span>[index++]</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™å°±æ˜¯å®ƒçš„å…¨éƒ¨ï¼</p><h2 id="Array"><a href="#Array" class="headerlink" title="Array"></a>Array</h2><p>æˆ‘ä»¬çš„ <code>Array</code> æ˜¯ä¸€ä¸ªç¬¦åˆ <code>CollectionType</code> åè®®çš„é€šç”¨ <code>struct</code>ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Array</span>&lt;<span class="title">T</span>&gt;: <span class="title">CollectionType</span> </span>&#123;</span><br></pre></td></tr></table></figure><p>å®ƒå”¯ä¸€æ‹¥æœ‰çš„å±æ€§æ˜¯ä¸€ä¸ªåº•å±‚ <code>ArrayImpl</code> çš„å¼•ç”¨ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">var</span> impl: <span class="type">ArrayImpl</span>&lt;<span class="type">T</span>&gt; = <span class="type">ArrayImpl</span>&lt;<span class="type">T</span>&gt;()</span><br></pre></td></tr></table></figure><p>ä»»ä½•ä¸€ä¸ªæ–¹æ³•å¦‚æœä¼šæ”¹å˜è¿™ä¸ªæ•°ç»„å¿…é¡»å…ˆæ£€æŸ¥è¿™ä¸ª <code>impl</code> æ˜¯å¦ä¸ºä¸€ä¸ªç‹¬ç«‹çš„å¼•ç”¨ï¼Œå¹¶åœ¨å®ƒä¸æ˜¯çš„æ—¶å€™è¿›è¡Œå¤åˆ¶ã€‚è¿™ä¸ªåŠŸèƒ½è¢«å°è£…æˆä¸€ä¸ªç§æœ‰çš„æ–¹æ³•æä¾›ç»™å…¶ä»–çš„æ–¹æ³•ä½¿ç”¨ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">mutating</span> <span class="function"><span class="keyword">func</span> <span class="title">ensureUnique</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> !<span class="built_in">isUniquelyReferencedNonObjC</span>(&amp;impl) &#123;</span><br><span class="line">        impl = impl.copy()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>append</code> æ–¹æ³•ä¼šä½¿ç”¨ <code>ensureUnique</code> ç„¶åè°ƒç”¨ <code>impl</code> ä¸­çš„ <code>append</code>ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">mutating</span> <span class="function"><span class="keyword">func</span> <span class="title">append</span><span class="params">(value: T)</span></span> &#123;</span><br><span class="line">    ensureUnique()</span><br><span class="line">    impl.append(value)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>remove</code> çš„å®ç°åŸºæœ¬æ˜¯ç›¸åŒçš„ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">mutating</span> <span class="function"><span class="keyword">func</span> <span class="title">remove</span><span class="params">(# index: Int)</span></span> &#123;</span><br><span class="line">    ensureUnique()</span><br><span class="line">    impl.remove(index: index)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>count</code> å±æ€§æ˜¯ä¸€ä¸ªè®¡ç®—æ€§å±æ€§ï¼Œå®ƒå°†ç›´æ¥é€šè¿‡ <code>impl</code> æ¥è°ƒç”¨ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="built_in">count</span>: <span class="type">Int</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> impl.<span class="built_in">count</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸‹æ ‡æ“ä½œå°†ç›´æ¥é€šè¿‡ <code>impl</code> æ¥ä¿®æ”¹åº•å±‚çš„æ•°æ®å­˜å‚¨ã€‚é€šå¸¸è¿™ç§ç›´æ¥ä»ç±»çš„å¤–éƒ¨è¿›è¡Œè®¿é—®çš„æ–¹å¼æ˜¯ä¸€ä¸ªåä¸»æ„ï¼Œä½†æ˜¯ <code>Array</code> å’Œ <code>ArrayImpl</code> è”ç³»çš„å¤ªè¿‡ç´§å¯†ï¼Œæ‰€ä»¥çœ‹èµ·æ¥å¹¶ä¸æ˜¯å¾ˆç³Ÿç³•ã€‚<code>subscript</code> ä¸­ <code>set</code> çš„éƒ¨åˆ†ä¼šæ”¹å˜æ•°ç»„ï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨ <code>ensureUnique</code> æ¥ä¿æŒå€¼è¯­ä¹‰ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">subscript</span>(index: <span class="type">Int</span>) -&gt; <span class="type">T</span> &#123;</span><br><span class="line">    <span class="keyword">get</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> impl.ptr[index]</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">mutating</span> <span class="keyword">set</span> &#123;</span><br><span class="line">        ensureUnique()</span><br><span class="line">        impl.ptr[index] = newValue</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>CollectionType</code> åè®®éœ€è¦ä¸€ä¸ª <code>Index typealias</code>ã€‚å¯¹äº <code>Array</code> æ¥è¯´ï¼Œè¿™ä¸ªç´¢å¼•ç±»å‹å°±æ˜¯ <code>Int</code>ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">typealias</span> <span class="type">Index</span> = <span class="type">Int</span></span><br></pre></td></tr></table></figure><p>å®ƒåŒæ—¶ä¹Ÿéœ€è¦ä¸€äº›å±æ€§æ¥æä¾›ä¸€ä¸ªå¼€å§‹å’Œç»“æŸçš„ç´¢å¼•ã€‚å¯¹äº <code>Array</code> ä¿©è¯´ï¼Œå¼€å§‹çš„ç´¢å¼•ä¸º 0 ï¼Œç»“æŸçš„ç´¢å¼•å°±æ˜¯æ•°ç»„ä¸­å…ƒç´ çš„ä¸ªæ•°ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> startIndex: <span class="type">Index</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">&#125;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">var</span> endIndex: <span class="type">Index</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">count</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>CollectionType</code> åè®®åŒ…å« <code>SequenceType</code> åè®®ï¼Œå®ƒä½¿å¾—å¯¹è±¡å¯ä»¥è¢«ç”¨äº <code>for/in</code> å¾ªç¯ã€‚å®ƒçš„å·¥ä½œåŸç†æ˜¯è®©åºåˆ—æä¾›ä¸€ä¸ªç”Ÿæˆå™¨ï¼Œè¯¥ç”Ÿæˆå™¨æ˜¯ä¸€ä¸ªå¯ä»¥è¿”å›åºåˆ—ä¸­è¿ç»­å…ƒç´ çš„å¯¹è±¡ã€‚ç”Ÿæˆå™¨çš„ç±»å‹ç”±é‡‡ç”¨åè®®çš„ç±»å‹æ¥å®šä¹‰ã€‚<code>Array</code> ä¸­é‡‡ç”¨çš„æ˜¯ <code>GeneratorOf</code>ï¼Œå®ƒæ˜¯ä¸€ä¸ªç®€å•çš„å°è£…ç”¨æ¥æ”¯æŒä½¿ç”¨ä¸€ä¸ªé—­åŒ…åˆ›å»ºç”Ÿæˆå™¨ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">typealias</span> <span class="type">Generator</span> = <span class="type">GeneratorOf</span>&lt;<span class="type">T</span>&gt;</span><br></pre></td></tr></table></figure><p><code>generate</code> æ–¹æ³•å°†ä¼šè¿”å›ä¸€ä¸ªç”Ÿæˆå™¨ã€‚å®ƒä½¿ç”¨ <code>GeneratorOf</code> å¹¶ä¸”æä¾›ä¸€ä¸ªé—­åŒ…æ¥é€’å¢ä¸‹æ ‡ï¼Œç›´åˆ°ä¸‹æ ‡åˆ°è¾¾æ•°ç»„çš„ç»“å°¾ã€‚é€šè¿‡åœ¨é—­åŒ…çš„å¤–é¢å£°æ˜ä¸€ä¸ª <code>index</code>ï¼Œä½¿å®ƒåœ¨è°ƒç”¨ä¸­è¢«æ•è·ï¼Œå¹¶ä¸”å®ƒçš„å€¼æŒç»­å­˜åœ¨ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">generate</span><span class="params">()</span></span> -&gt; <span class="type">Generator</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> index = <span class="number">0</span></span><br><span class="line">        <span class="keyword">return</span> <span class="type">GeneratorOf</span>&lt;<span class="type">T</span>&gt;&#123;</span><br><span class="line">            <span class="keyword">if</span> index &lt; <span class="keyword">self</span>.<span class="built_in">count</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">self</span>[index++]</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·å°±å®Œæˆäº† <code>Array</code> çš„å®ç°ã€‚</p><h2 id="å®Œæ•´çš„å®ç°å’Œæµ‹è¯•ä»£ç "><a href="#å®Œæ•´çš„å®ç°å’Œæµ‹è¯•ä»£ç " class="headerlink" title="å®Œæ•´çš„å®ç°å’Œæµ‹è¯•ä»£ç "></a>å®Œæ•´çš„å®ç°å’Œæµ‹è¯•ä»£ç </h2><p>è¿™é‡Œæä¾›äº†å®Œæ•´çš„å®ç°ï¼Œé™„åŠ ä¸€äº›æµ‹è¯•æ¥ç¡®ä¿æ‰€æœ‰çš„è¿™äº›æ­£å¸¸è¿è¡Œï¼Œæˆ‘æ”¾åœ¨äº† GitHub ä¸Šé¢ï¼š  </p><p><a href="https://gist.github.com/mikeash/63a791f2aec3318c7c5c" target="_blank" rel="noopener">https://gist.github.com/mikeash/63a791f2aec3318c7c5c</a></p><h2 id="ç»“è¯­"><a href="#ç»“è¯­" class="headerlink" title="ç»“è¯­"></a>ç»“è¯­</h2><p>åœ¨ Swift 1.2 ä¸­æ·»åŠ çš„ <code>isUniquelyReferenced</code> æ˜¯ä¸€ä¸ªå¹¿å—å¥½è¯„çš„æ”¹å˜ï¼Œå®ƒè®©æˆ‘ä»¬å¯ä»¥å®ç°å¾ˆå¤šçœŸæ­£æœ‰è¶£çš„å€¼ç±»å‹ï¼ŒåŒ…æ‹¬å¯¹æ ‡å‡†åº“ä¸­å€¼ç±»å‹é›†åˆçš„å¤åˆ¶ã€‚  </p><p>ä»Šå¤©å°±åˆ°è¿™é‡Œã€‚ä¸‹æ¬¡å†æ¥æ‰¾ä¹è¶£ï¼ŒåŠŸèƒ½ï¼Œä»¥åŠæœ‰è¶£çš„åŠŸèƒ½ã€‚å¦‚æœä½ æœ‰æ„Ÿå…´è¶£çš„ä¸»é¢˜ï¼Œè¯·å‘ç»™æˆ‘ä»¬ï¼é‚®ç®±åœ°å€ï¼š<a href="mailto:mike@mikeash.com" target="_blank" rel="noopener">mike@mikeash.com</a>ã€‚</p><blockquote><p>æœ¬æ–‡ç”± SwiftGG ç¿»è¯‘ç»„ç¿»è¯‘ï¼Œå·²ç»è·å¾—ä½œè€…ç¿»è¯‘æˆæƒï¼Œæœ€æ–°æ–‡ç« è¯·è®¿é—® <a href="http://swift.gg">http://swift.gg</a>ã€‚</p></blockquote>]]></content>
    
    <summary type="html">
    
      ç®€è¿°Swiftæ ‡å‡†åº“ä¸­Arrayçš„å®ç°é€»è¾‘
    
    </summary>
    
      <category term="Mike Ash" scheme="https://swift.gg/categories/Mike-Ash/"/>
    
    
      <category term="Swift è§£æ" scheme="https://swift.gg/tags/Swift-%E8%A7%A3%E6%9E%90/"/>
    
  </entry>
  
  <entry>
    <title>Swift ä¸­çš„é¢å‘åè®®ç¼–ç¨‹ï¼šæ˜¯å¦ä¼˜äºé¢å‘å¯¹è±¡ç¼–ç¨‹ï¼Ÿ</title>
    <link href="https://swift.gg/2018/12/03/pop-vs-oop/"/>
    <id>https://swift.gg/2018/12/03/pop-vs-oop/</id>
    <published>2018-12-03T00:00:00.000Z</published>
    <updated>2019-02-19T03:45:13.515Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ä½œè€…ï¼šAndrew Jaffeeï¼Œ<a href="https://www.appcoda.com/pop-vs-oop/" target="_blank" rel="noopener">åŸæ–‡é“¾æ¥</a>ï¼ŒåŸæ–‡æ—¥æœŸï¼š2018/03/28<br>è¯‘è€…ï¼š<a href="https://github.com/YangGao1991" target="_blank" rel="noopener">é˜³ä»”</a>ï¼›æ ¡å¯¹ï¼š<a href="http://numbbbbb.com/" target="_blank" rel="noopener">numbbbbb</a>ï¼Œ<a href="https://lision.me/" target="_blank" rel="noopener">Lision</a>ï¼›å®šç¨¿ï¼š<a href="http://forelax.space" target="_blank" rel="noopener">Forelax</a></p></blockquote> <!--æ­¤å¤„å¼€å§‹æ­£æ–‡--><p>åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†æ·±å…¥è®¨è®º Swift 4 ä¸­çš„é¢å‘åè®®ç¼–ç¨‹ã€‚è¿™æ˜¯ä¸€ä¸ªç³»åˆ—ä¸¤ç¯‡æ–‡ç« ä¸­çš„ç¬¬äºŒç¯‡ã€‚å¦‚æœä½ è¿˜æ²¡æœ‰è¯»è¿‡ <a href="https://www.appcoda.com/protocol-oriented-programming/" target="_blank" rel="noopener">å‰ä¸€ç¯‡ä»‹ç»æ–‡ç« </a>ï¼Œè¯·åœ¨ç»§ç»­é˜…è¯»æœ¬æ–‡ä¹‹å‰å…ˆé˜…è¯»å‰ä¸€ç¯‡ã€‚</p><a id="more"></a><p>åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†æ¢è®¨ä¸ºä»€ä¹ˆ Swift è¢«è®¤ä¸ºæ˜¯ä¸€é—¨â€œé¢å‘åè®®â€çš„è¯­è¨€ï¼›å¯¹æ¯”é¢å‘åè®®ç¼–ç¨‹ï¼ˆPOPï¼‰å’Œé¢å‘å¯¹è±¡ç¼–ç¨‹ï¼ˆOOPï¼‰ï¼›å¯¹æ¯”â€œå€¼è¯­ä¹‰â€å’Œâ€œå¼•ç”¨è¯­ä¹‰â€ï¼›è®¨è®º local reasoningï¼›ç”¨åè®®å®ç°ä»£ç†æ¨¡å¼ï¼›ç”¨åè®®ä»£æ›¿ç±»å‹ï¼›ä½¿ç”¨åè®®å¤šæ€æ€§ï¼›é‡å®¡æˆ‘çš„é¢å‘åè®®çš„å®é™…ä»£ç ï¼›æœ€ç»ˆè®¨è®ºä¸ºä»€ä¹ˆæˆ‘æ²¡æœ‰ 100% ä½¿ç”¨ POP ç¼–ç¨‹ã€‚</p><blockquote><p>å…³äº WWDC é“¾æ¥çš„ä¸€ç‚¹è¯´æ˜<br>åœ¨è¿™ä¸€ç³»åˆ—å…³äº POP çš„ä¸¤ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘è‡³å°‘æ·»åŠ äº†ä¸‰ä¸ª Apple Worldwide Developers Conference (WWDC) è§†é¢‘çš„é“¾æ¥ã€‚åœ¨ Safari ä¸­ç‚¹å‡»è¿™äº›é“¾æ¥å°†ç›´æ¥è·³è½¬è‡³è§†é¢‘ä¸­çš„å…·ä½“å°èŠ‚ï¼ˆå¹¶å¾€å¾€ä¼šä»è¯¥å¤„å¼€å§‹æ’­æ”¾è§†é¢‘ï¼‰ã€‚å¦‚æœä½ ä½¿ç”¨çš„ä¸æ˜¯ Safariï¼Œåˆ™éœ€è¦æµè§ˆè§†é¢‘ï¼Œæ‰‹åŠ¨è·³è½¬è‡³æŸä¸€å°èŠ‚ï¼Œæˆ–è€…æŸ¥çœ‹è¯¥è§†é¢‘çš„æ–‡å­—ç‰ˆæœ¬ã€‚</p></blockquote><h2 id="Swift-ä¸ºä»€ä¹ˆæ˜¯â€œé¢å‘åè®®â€çš„è¯­è¨€ï¼Ÿ"><a href="#Swift-ä¸ºä»€ä¹ˆæ˜¯â€œé¢å‘åè®®â€çš„è¯­è¨€ï¼Ÿ" class="headerlink" title="Swift ä¸ºä»€ä¹ˆæ˜¯â€œé¢å‘åè®®â€çš„è¯­è¨€ï¼Ÿ"></a>Swift ä¸ºä»€ä¹ˆæ˜¯â€œé¢å‘åè®®â€çš„è¯­è¨€ï¼Ÿ</h2><p>æˆ‘åœ¨ <a href="https://www.appcoda.com/protocol-oriented-programming/" target="_blank" rel="noopener">å‰ä¸€ç¯‡ POP ä»‹ç»æ–‡ç« </a> ä¸­ï¼Œæåˆ° Apple å£°ç§°â€ä»æ ¸å¿ƒä¸Šè¯´ï¼ŒSwift æ˜¯é¢å‘åè®®çš„â€ã€‚ç›¸ä¿¡æˆ‘ï¼Œç¡®å®æ˜¯è¿™æ ·çš„ã€‚ä¸ºä»€ä¹ˆå‘¢ï¼Ÿåœ¨å›ç­”è¿™ä¸ªé—®é¢˜ä¹‹å‰ï¼Œè®©æˆ‘ä»¬å…ˆæ¥æ¯”è¾ƒå‡ ç§ç¼–ç¨‹è¯­è¨€ã€‚</p><p>æˆ‘ä»¬æœ€å¥½å¯¹å…¶ä»–è¯­è¨€ä¹Ÿæœ‰æ‰€äº†è§£ï¼Œå› ä¸ºåœ¨æŸäº›æƒ…å†µä¸‹è¿™å°†ä¼šæœ‰ç”¨å¤„ï¼Œæ¯”å¦‚åœ¨éœ€è¦å°† C++ åº“é“¾æ¥åˆ° iOS åº”ç”¨ä¸­çš„æ—¶å€™ã€‚æˆ‘çš„å¾ˆå¤š iOS å’Œ OSX çš„åº”ç”¨é“¾æ¥äº† C++ çš„åº“ï¼Œå› ä¸ºè¿™äº›åº”ç”¨æœ‰ Windows å¹³å°çš„ç‰ˆæœ¬ã€‚è¿™äº›å¹´ï¼Œæˆ‘æ”¯æŒäº†è®¸å¤šâ€œå¹³å°æ— å…³â€çš„åº”ç”¨ã€‚</p><p>OOP è¯­è¨€æ—©å·²æ”¯æŒäº†æ¥å£ã€‚æ¥å£å’Œ Swift ä¸­çš„åè®®å¾ˆç›¸ä¼¼ï¼Œä½†å¹¶ä¸æ˜¯å®Œå…¨ä¸€æ ·ã€‚</p><p>è¿™äº›è¯­è¨€ä¸­çš„æ¥å£æŒ‡å®šäº†éµå¾ªè¯¥æ¥å£çš„ç±»å’Œï¼ˆæˆ–ï¼‰ç»“æ„ä½“å¿…é¡»å®ç°å“ªäº›æ–¹æ³•å’Œï¼ˆæˆ–ï¼‰å±æ€§ã€‚æˆ‘è¿™é‡Œä½¿ç”¨äº†â€œå’Œï¼ˆæˆ–ï¼‰â€ï¼Œæ˜¯å› ä¸ºæ¯”å¦‚ C++ ä¸­æ²¡æœ‰æ¥å£çš„æ¦‚å¿µï¼Œè€Œæ˜¯ä½¿ç”¨æŠ½è±¡ç±»ã€‚å¹¶ä¸”ï¼Œä¸€ä¸ª C++ <code>struct</code> å¯ä»¥ç»§æ‰¿è‡ªä¸€ä¸ªç±»ã€‚C# ä¸­çš„æ¥å£å…è®¸æŒ‡å®šå…¶ä¸­çš„å±æ€§å’Œæ–¹æ³•ï¼Œ<code>struct</code> å¯ä»¥éµå¾ªæ¥å£ã€‚Objective-C ä¸­ç§°â€œåè®®â€è€Œä¸æ˜¯â€œæ¥å£â€ï¼Œåè®®ä¹Ÿå¯ä»¥æŒ‡å®šè¦æ±‚å®ç°çš„æ–¹æ³•å’Œå±æ€§ï¼Œä½†åªæœ‰ç±»å¯ä»¥å£°æ˜éµå¾ªæ¥å£ï¼Œ<code>struct</code> ä¸å¯ä»¥ã€‚</p><p>è¿™äº›æ¥å£å’Œ Objective-C ä¸­çš„åè®®ï¼Œå¹¶æ²¡æœ‰æ–¹æ³•çš„å…·ä½“å®ç°ã€‚å®ƒä»¬åªæ˜¯æŒ‡å®šä¸€äº›è¦æ±‚ï¼Œä½œä¸ºéµå¾ªè¯¥åè®®çš„ç±»/ç»“æ„ä½“å®ç°æ—¶çš„â€œè“å›¾â€ã€‚</p><p>åè®®æ„æˆäº† <a href="http://swiftdoc.org" target="_blank" rel="noopener">Swift æ ‡å‡†åº“</a> çš„åŸºç¡€ã€‚æ­£å¦‚æˆ‘åœ¨ <a href="https://www.appcoda.com/protocol-oriented-programming/" target="_blank" rel="noopener">ç¬¬ä¸€ç¯‡æ–‡ç« </a> ä¸­æ‰€å±•ç¤ºï¼Œåè®®æ˜¯ POP æ–¹æ³•è®ºå’ŒèŒƒå¼çš„å…³é”®æ‰€åœ¨ã€‚</p><p>Swift ä¸­çš„åè®®æœ‰å…¶ä»–è¯­è¨€éƒ½ä¸æ”¯æŒçš„ç‰¹ç‚¹ï¼š<a href="https://docs.swift.org/swift-book/LanguageGuide/Protocols.html#//apple_ref/doc/uid/TP40014097-CH25-ID521" target="_blank" rel="noopener">åè®®æ‰©å±•</a>ã€‚ä»¥ä¸‹æ‘˜è‡ª Apple å®˜æ–¹æè¿°ï¼š</p><blockquote><p>åè®®å¯ä»¥è¢«æ‰©å±•ï¼Œæ¥ç»™éµå¾ªè¯¥åè®®çš„ç±»å‹æä¾›æ–¹æ³•ã€åˆå§‹åŒ–æ–¹æ³•ã€ä¸‹æ ‡ã€è®¡ç®—å±æ€§çš„å…·ä½“å®ç°ã€‚è¿™å°±å¯ä»¥å…è®¸åè®®è‡ªèº«å®šä¹‰ä¸€äº›è¡Œä¸ºï¼Œè€Œä¸æ˜¯ç”±å„ä¸ªç±»å‹è‡ªå·±å»å®ç°ï¼Œæˆ–æ˜¯ç”±ä¸€ä¸ªå…¨å±€æ–¹æ³•æ¥å®ç°ã€‚<br>é€šè¿‡æ‰©å±•ï¼Œæˆ‘ä»¬å¯ä»¥ä¸ºåè®®æ‰€è¦æ±‚çš„ä»»ä½•æ–¹æ³•å’Œè®¡ç®—å±æ€§æä¾›ä¸€ä¸ªé»˜è®¤çš„å®ç°ã€‚å¦‚æœä¸€ä¸ªéµå¾ªè¯¥åè®®çš„ç±»å‹ä¸ºæŸä¸ªæ–¹æ³•æˆ–å±æ€§æä¾›äº†å…¶è‡ªå·±çš„å®ç°ï¼Œé‚£ä¹ˆè¯¥å®ç°å°†ä¼šæ›¿ä»£åè®®æ‰©å±•ä¸­çš„å®ç°ã€‚</p></blockquote><p>åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ï¼Œä½ å·²ç»çœ‹åˆ°æˆ‘æ˜¯æ€ä¹ˆä½¿ç”¨åè®®æ‰©å±•çš„ï¼Œåœ¨æœ¬æ–‡ä¸­ä½ ä¼šå†æ¬¡çœ‹åˆ°ã€‚å®ƒä»¬æ˜¯ä½¿å¾— Swift POP å¦‚æ­¤å¼ºå¤§çš„ç§˜è¯€ã€‚</p><p>åœ¨ Swift å‡ºç°ä¹‹å‰ï¼Œåè®®åœ¨ iOS ä¸­å°±å·²ç»ååˆ†é‡è¦ã€‚è¿˜è®°å¾—æˆ‘å¯¹ iOS å¼€å‘äººå‘˜å¤šå¹´æ¥é‡‡ç”¨çš„ UITableViewDataSource å’Œ UITableViewDelegate ç­‰åè®®çš„ <a href="https://appcoda.com/protocol-oriented-programming/" target="_blank" rel="noopener">è®¨è®º</a> å—ï¼Ÿå†æƒ³ä¸€æƒ³ä½ æ¯å¤©å†™çš„ Swift ä»£ç å§ã€‚</p><p>ç”¨ Swift ç¼–ç¨‹çš„æ—¶å€™ï¼Œä¸å¯èƒ½ä¸åˆ©ç”¨ <a href="http://swiftdoc.org" target="_blank" rel="noopener">æ ‡å‡†åº“</a> ä¸­çš„åè®®ã€‚ä¾‹å¦‚ï¼Œ<code>Array</code> ï¼ˆä¸€ä¸ªç»§æ‰¿äº† <a href="http://swiftdoc.org/v3.1/type/Array/hierarchy/" target="_blank" rel="noopener">10 ä¸ªåè®®</a> çš„ <code>struct</code>ï¼‰ï¼Œ<code>Bool</code> ï¼ˆä¸€ä¸ªç»§æ‰¿äº† <a href="http://swiftdoc.org/v3.1/type/Bool/hierarchy/" target="_blank" rel="noopener">7 ä¸ªåè®®</a> çš„ <code>struct</code>ï¼‰ï¼Œ<code>Comparable</code> ï¼ˆä¸€ä¸ª <a href="http://swiftdoc.org/v3.1/protocol/Comparable/hierarchy/" target="_blank" rel="noopener">ç»§æ‰¿è‡ªå¦ä¸€ä¸ªåè®®çš„åè®®ï¼Œå¹¶ä¸”æ˜¯å¾ˆå¤šå…¶ä»– Swift ç±»å‹çš„ç»§æ‰¿å…ˆç¥–</a>ï¼‰ï¼Œä»¥åŠ <code>Equatable</code> ï¼ˆä¸€ä¸ª <a href="http://swiftdoc.org/v3.1/protocol/Equatable/hierarchy/" target="_blank" rel="noopener">å¾ˆå¤š Swift åè®®å’Œç±»å‹çš„ç»§æ‰¿å…ˆç¥–</a>ï¼‰ã€‚</p><p>èŠ±ä¸€äº›æ—¶é—´é˜…è§ˆ <a href="http://swiftdoc.org" target="_blank" rel="noopener">Swift æ ‡å‡†åº“</a>ï¼Œè·Ÿéšé“¾æ¥æŸ¥çœ‹æ‰€æœ‰ç±»å‹ã€åè®®ã€æ“ä½œç¬¦ã€å…¨å±€å˜é‡ã€å‡½æ•°ã€‚ä¸€å®šè¦çœ‹å‡ ä¹æ‰€æœ‰é¡µé¢éƒ½ä¼šæœ‰çš„ â€œInheritanceâ€ ä¸€èŠ‚ï¼Œå¹¶ç‚¹å‡» â€œVIEW PROTOCOL HIERARCHY -&gt;â€ é“¾æ¥ã€‚ä½ å°†ä¼šçœ‹åˆ°å¾ˆå¤šåè®®ï¼Œåè®®çš„å®šä¹‰ï¼Œä»¥åŠåè®®ç»§æ‰¿å…³ç³»çš„å›¾è¡¨ã€‚</p><p>è®°ä½å¾ˆé‡è¦çš„ä¸€ç‚¹ï¼šå¤§éƒ¨åˆ† iOSï¼ˆä»¥åŠ OSXï¼‰SDK ä¸­çš„ä»£ç éƒ½æ˜¯ä»¥ç±»ç»§æ‰¿çš„å±‚æ¬¡ç»“æ„å®ç°çš„ã€‚æˆ‘ç›¸ä¿¡å¾ˆå¤šæˆ‘ä»¬ä½¿ç”¨çš„æ ¸å¿ƒæ¡†æ¶ä»ç„¶æ˜¯ç”¨ <a href="https://developer.apple.com/library/archive/documentation/General/Conceptual/DevPedia-CocoaCore/Cocoa.html" target="_blank" rel="noopener">Objective-C</a>ï¼ˆä»¥åŠä¸€äº› C++ å’Œ Cï¼‰ç¼–å†™çš„ï¼Œä¾‹å¦‚ <code>Fundation</code> å’Œ <code>UIKit</code>ã€‚æ‹¿ <code>UIKit</code> ä¸­çš„ <code>UIbutton</code> ä¸¾ä¾‹ã€‚åˆ©ç”¨ Apple å®˜æ–¹æ–‡æ¡£é¡µé¢ä¸­çš„â€œç»§æ‰¿è‡ªâ€é“¾æ¥ï¼Œæˆ‘ä»¬å¯ä»¥ä»å¶èŠ‚ç‚¹ <code>UIButton</code> ä¸€ç›´æ²¿ç€ç»§æ‰¿é“¾å‘ä¸ŠæŸ¥æ‰¾åˆ°æ ¹èŠ‚ç‚¹ <code>NSObject</code>ï¼š<code>UIButton</code> åˆ° <code>UIControl</code> åˆ° <code>UIView</code> åˆ° <code>UIResponder</code> åˆ° <code>NSObject</code>ã€‚å¯ä»¥å½¢è±¡è¡¨ç¤ºä¸ºï¼š</p><p><img src="https://www.appcoda.com/wp-content/uploads/2018/03/UIButton-Inheritance.png" alt=""></p><h2 id="POP-å’Œ-OOP"><a href="#POP-å’Œ-OOP" class="headerlink" title="POP å’Œ OOP"></a>POP å’Œ OOP</h2><p>OOP çš„ä¼˜ç‚¹å·²ç»è¢«å¼€å‘è€…ä»¬è®¨è®ºå¾—å¾ˆå¤šäº†ï¼Œæ‰€ä»¥åœ¨è¿™é‡Œæˆ‘åªæƒ³ç®€å•åˆ—ä¸¾ä¸€ä¸‹ã€‚å¦‚æœæƒ³äº†è§£è¯¦å°½çš„å†…å®¹ï¼Œå¯ä»¥å‚è€ƒ <a href="http://iosbrain.com/blog/2017/02/26/intro-to-object-oriented-principles-in-swift-3-via-a-message-box-class-hierarchy/" target="_blank" rel="noopener">æˆ‘å†™çš„è¿™ç¯‡æœ‰å…³ OOP åœ¨ Swift ä¸­çš„å®ç°çš„å…·ä½“ä»‹ç»</a>ã€‚</p><blockquote><p>æ³¨æ„ï¼šå¦‚æœä½ è¯»è¿™ç¯‡æ–‡ç« çš„æ—¶å€™è¿˜ä¸äº†è§£ OOPï¼Œæˆ‘å»ºè®®ä½ åœ¨è€ƒè™‘å­¦ä¹  POP ä¹‹å‰ï¼Œå…ˆå­¦ä¹  OOPã€‚</p></blockquote><p>OOP çš„ä¼˜ç‚¹åŒ…æ‹¬å¯é‡ç”¨æ€§ï¼Œç»§æ‰¿ï¼Œå¯ç»´æŠ¤æ€§ï¼Œå¯¹å¤æ‚æ€§çš„éšè—ï¼ˆå°è£…ï¼‰ï¼ŒæŠ½è±¡æ€§ï¼Œå¤šæ€æ€§ï¼Œå¯¹ä¸€ä¸ªç±»çš„å±æ€§å’Œæ–¹æ³•çš„è®¿é—®æƒé™æ§åˆ¶ã€‚æˆ‘è¿™é‡Œå¯èƒ½è¿˜æœ‰æ‰€é—æ¼ï¼Œå› ä¸ºå¼€å‘è€…ä»¬å·²ç»æ€»ç»“å‡ºå¤ªå¤š OOP çš„ä¼˜ç‚¹äº†ã€‚</p><p>ç®€å•åœ°è¯´ï¼ŒOOP å’Œ POP éƒ½æ‹¥æœ‰å¤§éƒ¨åˆ†ä¸Šè¿°çš„ç‰¹ç‚¹ï¼Œä¸»è¦çš„ä¸€ç‚¹ä¸åŒåœ¨äºï¼šç±»åªèƒ½ç»§æ‰¿è‡ªå…¶å®ƒä¸€ä¸ªç±»ï¼Œä½†åè®®å¯ä»¥ç»§æ‰¿è‡ªå¤šä¸ªåè®®ã€‚</p><p>æ­£æ˜¯ç”±äº OOP çš„ç»§æ‰¿çš„ç‰¹ç‚¹ï¼Œæˆ‘ä»¬åœ¨å¼€å‘ä¸­æœ€å¥½æŠŠç»§æ‰¿å…³ç³»é™åˆ¶ä¸ºå•ç»§æ‰¿ã€‚å› ä¸ºå¤šç»§æ‰¿ä¼šä½¿ä»£ç å¾ˆå¿«å˜å¾—ä¸€å›¢ä¹±ã€‚</p><p>ç„¶è€Œï¼Œåè®®å´å¯ä»¥ç»§æ‰¿è‡ªä¸€ä¸ªæˆ–å¤šä¸ªä¸åŒçš„åè®®ã€‚</p><p>ä¸ºä»€ä¹ˆéœ€è¦æ¨åŠ¨é¢å‘åè®®ç¼–ç¨‹å‘¢ï¼Ÿå½“æˆ‘ä»¬å»ºç«‹èµ·ä¸€ä¸ªåºå¤§çš„ç±»å±‚æ¬¡ç»“æ„çš„æ—¶å€™ï¼Œè®¸å¤šçš„å±æ€§å’Œæ–¹æ³•ä¼šè¢«ç»§æ‰¿ã€‚å¼€å‘è€…æ›´å€¾å‘äºæŠŠä¸€äº›é€šç”¨åŠŸèƒ½å¢åŠ åˆ°é¡¶å±‚çš„â€”â€”ä¸»è¦æ˜¯é«˜å±‚çš„çˆ¶ç±»ä¸­ï¼ˆå¹¶ä¸”ä¼šä¸€ç›´åŠ ä¸‹å»ï¼‰ã€‚ä¸­å±‚å’Œåº•å±‚çš„ç±»çš„èŒè´£ä¼šæ›´åŠ æ˜ç¡®å’Œå…·ä½“ã€‚æ–°çš„åŠŸèƒ½ä¼šè¢«æ”¾åˆ°çˆ¶ç±»ä¸­ï¼Œè¿™ç»å¸¸ä¼šä½¿å¾—çˆ¶ç±»å……æ»¡äº†è®¸å¤šé¢å¤–çš„ï¼Œæ— å…³çš„èŒè´£ï¼Œå˜å¾—â€œè¢«æ±¡æŸ“â€æˆ–æ˜¯â€œè‡ƒè‚¿â€ã€‚ä¸­å±‚å’Œåº•å±‚çš„ç±»ä¹Ÿå› æ­¤ç»§æ‰¿äº†å¾ˆå¤šå®ƒä»¬å¹¶ä¸éœ€è¦çš„åŠŸèƒ½ã€‚</p><p>è¿™äº›æœ‰å…³ OOP çš„æ‹…å¿§å¹¶éæˆæ–‡çš„è§„å®šã€‚ä¸€ä¸ªä¼˜ç§€çš„å¼€å‘è€…å¯ä»¥èº²é¿å¾ˆå¤šåˆšæ‰æåˆ°çš„é™·é˜±ã€‚è¿™éœ€è¦æ—¶é—´ã€å®è·µå’Œç»éªŒã€‚ä¾‹å¦‚ï¼Œå¼€å‘è€…å¯ä»¥è¿™æ ·è§£å†³çˆ¶ç±»åŠŸèƒ½è‡ƒè‚¿çš„é—®é¢˜ï¼šå°†å…¶ä»–ç±»çš„å®ä¾‹æ·»åŠ ä¸ºå½“å‰ç±»çš„æˆå‘˜å˜é‡ï¼Œè€Œéç»§æ‰¿è¿™äº›ç±»ï¼ˆä¹Ÿå°±æ˜¯ä½¿ç”¨ç»„åˆä»£æ›¿ç»§æ‰¿ï¼‰ã€‚</p><p>åœ¨ Swift ä¸­ä½¿ç”¨ POP è¿˜æœ‰ä¸€ä¸ªå¥½å¤„ï¼šä¸ä»…ä»…æ˜¯ç±»ï¼Œå€¼ç±»å‹ä¹Ÿå¯ä»¥éµå¾ªåè®®ï¼Œæ¯”å¦‚ <code>struct</code> å’Œ <code>enum</code>ã€‚æˆ‘ä»¬åœ¨ä¸‹é¢å°†ä¼šè®¨è®ºä½¿ç”¨å€¼ç±»å‹çš„ä¸€äº›ä¼˜ç‚¹ã€‚</p><p>ä½†æˆ‘çš„ç¡®å¯¹éµå¾ªå¤šåè®®çš„åšæ³•æœ‰ä¸€äº›é¡¾è™‘ã€‚æˆ‘ä»¬æ˜¯å¦åªæ˜¯å°†ä»£ç çš„å¤æ‚æ€§å’Œéš¾åº¦è½¬ç§»æˆå¦ä¸€ç§å½¢å¼äº†å‘¢ï¼Ÿå³ï¼Œå°† OOP ç»§æ‰¿ä¸­çš„â€œå‚ç›´â€çš„å¤æ‚æ€§è½¬ç§»æˆäº† POP ç»§æ‰¿ä¸­çš„â€œæ°´å¹³â€çš„å¤æ‚æ€§äº†å‘¢ï¼Ÿ</p><p>å°†ä¹‹å‰å±•ç¤ºçš„ <code>UIButton</code> çš„ç±»ç»§æ‰¿ç»“æ„å’Œ Swift ä¸­çš„ <code>Array</code> æ‰€éµå¾ªçš„åè®®è¿›è¡Œå¯¹æ¯”ï¼š</p><p><img src="https://www.appcoda.com/wp-content/uploads/2018/03/Array-Protocol-Tangle.png" alt=""></p><blockquote><p>å›¾åƒæ¥æºï¼š<a href="http://swiftdoc.org/v3.1/type/Array/hierarchy/" target="_blank" rel="noopener">http://swiftdoc.org/v3.1/type/Array/hierarchy/</a></p></blockquote><p>Local reasoning å¯¹è¿™ä¸¤ç§æƒ…å†µéƒ½ä¸é€‚ç”¨ï¼Œå› ä¸ºä¸ªä½“å’Œå…³ç³»å¤ªå¤šäº†ã€‚</p><h2 id="å€¼è¯­ä¹‰-vs-å¼•ç”¨è¯­ä¹‰"><a href="#å€¼è¯­ä¹‰-vs-å¼•ç”¨è¯­ä¹‰" class="headerlink" title="å€¼è¯­ä¹‰ vs. å¼•ç”¨è¯­ä¹‰"></a>å€¼è¯­ä¹‰ vs. å¼•ç”¨è¯­ä¹‰</h2><p>æ­£å¦‚æˆ‘ä¸Šä¸€ç¯‡æ–‡ç« æ‰€æåˆ°çš„ï¼ŒApple æ­£åœ¨å¤§åŠ›æ¨å¹¿ POP å’Œå€¼è¯­ä¹‰çš„ç›¸å…³æ¦‚å¿µï¼ˆä»–ä»¬è¿˜æ­£åœ¨æ¨å¹¿å¦ä¸€ä¸ªä¸ POP ç›¸å…³çš„èŒƒå¼ï¼Œä¸‹æ–‡ä¼šè®²åˆ°ï¼‰ã€‚ä¸Šä¸€æ¬¡ï¼Œæˆ‘å‘ä½ ä»¬å±•ç¤ºäº†ä»£ç ï¼Œè¿™æ¬¡ä¾ç„¶ä¼šç”¨ä»£ç æ¥æ˜ç¡®å±•ç¤ºâ€œå¼•ç”¨è¯­ä¹‰â€å’Œâ€œå€¼è¯­ä¹‰â€çš„ä¸åŒæ„ä¹‰ã€‚è¯·å‚é˜…æˆ‘ <a href="https://www.appcoda.com/protocol-oriented-programming/" target="_blank" rel="noopener">ä¸Šä¸€å‘¨çš„æ–‡ç« </a> ä¸­çš„ <code>ObjectThatFlies</code> åè®®ï¼Œä»¥åŠä»Šå¤©æ–‡ç« ä¸­çš„ <code>List</code>ï¼Œ<code>FIFO</code>ï¼Œ<code>LIFO</code> ä»¥åŠç›¸å…³åè®®ã€‚</p><p>Apple å·¥ç¨‹å¸ˆ Alex è¯´æˆ‘ä»¬ <a href="https://developer.apple.com/videos/play/wwdc2016/419/?time=36" target="_blank" rel="noopener">â€œåº”å½“ä½¿ç”¨å€¼ç±»å‹å’Œåè®®æ¥è®©åº”ç”¨å˜å¾—æ›´å¥½â€</a>ã€‚Apple <a href="https://developer.apple.com/sample-code/swift/downloads/standard-library.zip" target="_blank" rel="noopener">sample playground</a> ä¸­ï¼Œä¸€èŠ‚é¢˜ä¸ºâ€œç†è§£å€¼ç±»å‹â€çš„ä»£ç æ–‡æ¡£è¿™ä¹ˆè¯´ï¼š</p><blockquote><p>æ ‡å‡†åº“ä¸­çš„åºåˆ—å’Œå®¹å™¨ä½¿ç”¨äº†å€¼ç±»å‹ï¼Œè¿™è®©å†™ä»£ç å˜å¾—æ›´åŠ å®¹æ˜“ã€‚æ¯ä¸€ä¸ªå˜é‡éƒ½æœ‰ä¸€ä¸ªç‹¬ç«‹çš„å€¼ï¼Œå¯¹è¿™ä¸ªå€¼çš„å¼•ç”¨å¹¶éå…±äº«çš„ã€‚ä¾‹å¦‚ï¼Œå½“ä½ å‘ä¸€ä¸ªå‡½æ•°ä¼ é€’ä¸€ä¸ªæ•°ç»„ï¼Œè¿™ä¸ªå‡½æ•°å¹¶ä¸ä¼šå¯¼è‡´è°ƒç”¨æ–¹å¯¹è¿™ä¸ªæ•°ç»„çš„æ‹·è´çªç„¶è¢«æ”¹å˜ã€‚</p></blockquote><p>è¿™å½“ç„¶å¯¹æ‰€æœ‰ä½¿ç”¨å€¼è¯­ä¹‰çš„æ•°æ®ç±»å‹éƒ½æ˜¯é€‚ç”¨çš„ã€‚æˆ‘å¼ºçƒˆå»ºè®®ä½ ä¸‹è½½å¹¶å®Œæ•´é˜…è§ˆæ•´ä¸ª playgroundã€‚</p><p>æˆ‘å¹¶ä¸æ˜¯è¦æŠ›å¼ƒç±»è¿™ä¸ªä½¿ç”¨å¼•ç”¨è¯­ä¹‰çš„æ¦‚å¿µã€‚æˆ‘åšä¸åˆ°ã€‚æˆ‘è‡ªå·±å·²ç»å†™äº†å¤ªå¤šçš„åŸºäºç±»çš„ä»£ç ã€‚æˆ‘å¸®åŠ©æˆ‘çš„å®¢æˆ·æ•´ç†äº†æ•°ç™¾ä¸‡è¡ŒåŸºäºç±»çš„ä»£ç ã€‚æˆ‘åŒæ„å€¼ç±»å‹ä¸€èˆ¬æ¥è¯´æ¯”å¼•ç”¨ç±»å‹å®‰å…¨ã€‚å½“æˆ‘å†™æ–°çš„ä»£ç ï¼Œæˆ–æ˜¯é‡æ„å·²æœ‰ä»£ç çš„æ—¶å€™ï¼Œæˆ‘ä¼šè€ƒè™‘åœ¨æŸäº›ä¸ªæ¡ˆä¸­ç§¯æå°è¯•ã€‚</p><p>å¼•ç”¨è¯­ä¹‰ä¸‹ï¼Œç±»å®ä¾‹ï¼ˆå¼•ç”¨ï¼‰ä¼šå¯¼è‡´ <a href="https://developer.apple.com/videos/play/wwdc2015-414/?time=112" target="_blank" rel="noopener">â€œæ„æ–™ä¹‹å¤–çš„æ•°æ®å…±äº«â€</a>ã€‚ä¹Ÿæœ‰äººç§°ä¹‹ä¸ºâ€œæ„æ–™ä¹‹å¤–çš„æ”¹å˜â€ã€‚æœ‰ä¸€äº› <a href="https://developer.apple.com/videos/play/wwdc2015-414/?time=210" target="_blank" rel="noopener">æ–¹æ³•</a> å¯ä»¥æœ€å°åŒ–å¼•ç”¨è¯­ä¹‰çš„å‰¯ä½œç”¨ï¼Œä¸è¿‡æˆ‘è¿˜æ˜¯ä¼šè¶Šæ¥è¶Šå¤šåœ°ä½¿ç”¨å€¼è¯­ä¹‰ã€‚</p><p>å€¼è¯­ä¹‰èƒ½å¤Ÿä½¿å˜é‡é¿å…å—åˆ°æ— æ³•é¢„è®¡çš„æ›´æ”¹ï¼Œè¿™å®åœ¨å¾ˆæ£’ã€‚å› ä¸ºâ€œæ¯ä¸ªå˜é‡æœ‰ä¸€ä¸ªç‹¬ç«‹çš„å€¼ï¼Œå¯¹è¿™ä¸ªå€¼çš„å¼•ç”¨æ˜¯ä¸å…±äº«çš„â€œï¼Œæˆ‘ä»¬èƒ½å¤Ÿé¿å…è¿™ç§æ— æ³•é¢„è®¡çš„æ›´æ”¹å¯¼è‡´çš„å‰¯ä½œç”¨ã€‚</p><p>å› ä¸º Swift ä¸­çš„ <code>struct</code> æ˜¯ä¸€ç§å€¼ç±»å‹ï¼Œå¹¶ä¸”èƒ½å¤Ÿéµå¾ªåè®®ï¼Œè‹¹æœä¹Ÿåœ¨å¤§åŠ›æ¨è¿› POP ä»¥å–ä»£ OOPï¼Œåœ¨ <a href="https://developer.apple.com/videos/play/wwdc2016/419/" target="_blank" rel="noopener">é¢å‘åè®®å’Œå€¼ç¼–ç¨‹</a> ä½ å¯ä»¥æ‰¾åˆ°è¿™èƒŒåçš„åŸå› ã€‚</p><h2 id="Local-reasoning"><a href="#Local-reasoning" class="headerlink" title="Local reasoning"></a>Local reasoning</h2><p>è®©æˆ‘ä»¬æ¢è®¨ä¸€ä¸ªå¾ˆæ£’çš„ä¸»é¢˜ï¼ŒApple ç§°ä¹‹ä¸º <a href="https://developer.apple.com/videos/play/wwdc2016-419/?time=41" target="_blank" rel="noopener">â€œLocal reasoningâ€</a>ã€‚è¿™æ˜¯ç”± Apple ä¸€ä½å« Alex çš„å·¥ç¨‹å¸ˆåœ¨ WWDC 2016 - Session 419ï¼Œâ€œUIKit åº”ç”¨ä¸­çš„é¢å‘åè®®å’Œå€¼ç¼–ç¨‹â€ä¸­æå‡ºçš„ã€‚è¿™ä¹Ÿæ˜¯ Apple ä¸ POP åŒæ—¶å¤§åŠ›æ¨åŠ¨çš„æ¦‚å¿µã€‚</p><p>æˆ‘è®¤ä¸ºè¿™ä¸æ˜¯ä¸ªæ–°é²œçš„æ¦‚å¿µã€‚è®¸å¤šå¹´ä»¥å‰ï¼Œæ•™æˆã€åŒäº‹ã€å¯¼å¸ˆã€å¼€å‘è€…ä»¬éƒ½åœ¨è®¨è®ºè¿™äº›ï¼šæ°¸è¿œä¸è¦å†™é«˜åº¦è¶…è¿‡ä¸€ä¸ªå±å¹•çš„å‡½æ•°ï¼ˆå³ä¸é•¿äºä¸€é¡µï¼Œæˆ–è®¸æ›´çŸ­ï¼‰ï¼›å°†å¤§çš„å‡½æ•°æ‹†è§£æˆè‹¥å¹²å°çš„å‡½æ•°ï¼›å°†å¤§çš„ä»£ç æ–‡ä»¶æ‹†è§£æˆè‹¥å¹²å°çš„ä»£ç æ–‡ä»¶ï¼›ä½¿ç”¨æœ‰æ„ä¹‰çš„å˜é‡åï¼›åœ¨å†™ä»£ç ä¹‹å‰èŠ±ç‚¹æ—¶é—´å»è®¾è®¡ä»£ç ï¼›ä¿æŒç©ºæ ¼å’Œç¼©è¿›é£æ ¼çš„ä¸€è‡´æ€§ï¼›å°†ç›¸å…³çš„å±æ€§å’Œè¡Œä¸ºæ•´åˆæˆç±»å’Œ/æˆ–ç»“æ„ä½“ï¼›å°†ç›¸å…³çš„ç±»å’Œ/æˆ–ç»“æ„ä½“æ•´åˆè¿›æ¡†æ¶æˆ–åº“ä¸­ã€‚ä½† Apple åœ¨è§£é‡Š POP<br>çš„æ—¶å€™ï¼Œæ­£å¼æå‡ºäº†è¿™ä¸ªæ¦‚å¿µã€‚Alex å‘Šè¯‰æˆ‘ä»¬ï¼š</p><blockquote><p>Local reasoning æ„å‘³ç€ï¼Œå½“ä½ çœ‹ä½ é¢å‰çš„ä»£ç çš„æ—¶å€™ï¼Œä½ ä¸éœ€è¦å»æ€è€ƒï¼Œå‰©ä¸‹çš„ä»£ç æ€æ ·å»å’Œè¿™ä¸ªå‡½æ•°è¿›è¡Œäº¤äº’ã€‚ä¹Ÿè®¸ä½ ä¹‹å‰å·²ç»æœ‰è¿‡è¿™ç§æ„Ÿè§‰ã€‚ä¾‹å¦‚ï¼Œå½“ä½ åˆšåŠ å…¥ä¸€ä¸ªæ–°çš„å›¢é˜Ÿï¼Œæœ‰å¤§é‡çš„ä»£ç è¦å»çœ‹ï¼ŒåŒæ—¶ä¸Šä¸‹æ–‡çš„ä¿¡æ¯ä¹Ÿéå¸¸åŒ®ä¹ï¼Œä½ èƒ½æ˜ç™½æŸä¸€ä¸ªå‡½æ•°çš„ä½œç”¨å—ï¼Ÿåšåˆ° Local reasoning çš„èƒ½åŠ›å¾ˆé‡è¦ï¼Œå› ä¸ºè¿™èƒ½å¤Ÿä½¿å¾—ç»´æŠ¤ä»£ç ã€ç¼–å†™ä»£ç ã€æµ‹è¯•ä»£ç å˜å¾—æ›´åŠ å®¹æ˜“ã€‚</p></blockquote><p>å“ˆå“ˆï¼Œä½ æ›¾ç»æœ‰è¿‡è¿™ç§æ„Ÿè§‰å—ï¼Ÿæˆ‘æ›¾ç»è¯»è¿‡ä¸€äº›å…¶ä»–äººå†™çš„çœŸçš„å¾ˆå¥½çš„ä»£ç ã€‚æˆ‘ä¹Ÿæ›¾ç»å†™è¿‡ä¸€äº›æ˜“è¯»æ€§éå¸¸å¥½çš„ä»£ç ã€‚è¯´å®è¯ï¼Œåœ¨ 30 å¹´çš„å·¥ä½œç»éªŒä¸­ï¼Œæˆ‘è¦å»æ”¯æŒå’Œå‡çº§çš„ç»å¤§éƒ¨åˆ†ç°å­˜çš„ä»£ç éƒ½ä¸ä¼šè®©æˆ‘æ„Ÿå—åˆ° Alex æ‰€æè¿°çš„è¿™ç§æ„Ÿè§‰ã€‚ç›¸åï¼Œæˆ‘ç»å¸¸ä¼šå˜å¾—éå¸¸å›°æƒ‘ï¼Œå› ä¸ºå½“æˆ‘çœ‹ä¸€æ®µä»£ç çš„æ—¶å€™ï¼Œæˆ‘å¾€å¾€å¯¹è¿™æ®µä»£ç çš„ä½œç”¨æ¯«æ— å¤´ç»ªã€‚</p><p>Swift è¯­è¨€çš„æºä»£ç æ˜¯å¼€æºçš„ã€‚è¯·å¿«é€Ÿæµè§ˆä¸€é <a href="https://github.com/apple/swift/blob/master/stdlib/public/SDK/Foundation/NSFastEnumeration.swift" target="_blank" rel="noopener">ä¸‹åˆ—å‡½æ•°</a>ï¼Œä¹Ÿä¸è¦èŠ±ä¸Šä¸‰ä¸ªå°æ—¶å»è¯•å›¾ç†è§£å®ƒï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">mutating</span> <span class="function"><span class="keyword">func</span> <span class="title">next</span><span class="params">()</span></span> -&gt; <span class="type">Any</span>? &#123;</span><br><span class="line">    <span class="keyword">if</span> index + <span class="number">1</span> &gt; <span class="built_in">count</span> &#123;</span><br><span class="line">        index = <span class="number">0</span></span><br><span class="line"><span class="comment">// ç¡®ä¿æ²¡æœ‰ self çš„æˆå‘˜å˜é‡è¢«æ•è·</span></span><br><span class="line">        <span class="keyword">let</span> enumeratedObject = enumerable</span><br><span class="line">        <span class="keyword">var</span> localState = state</span><br><span class="line">        <span class="keyword">var</span> localObjects = objects</span><br><span class="line">        </span><br><span class="line">        (<span class="built_in">count</span>, useObjectsBuffer) = <span class="built_in">withUnsafeMutablePointer</span>(to: &amp;localObjects) &#123;</span><br><span class="line">            <span class="keyword">let</span> buffer = <span class="type">AutoreleasingUnsafeMutablePointer</span>&lt;<span class="type">AnyObject</span>?&gt;($<span class="number">0</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">withUnsafeMutablePointer</span>(to: &amp;localState) &#123; (statePtr: <span class="type">UnsafeMutablePointer</span>&lt;<span class="type">NSFastEnumerationState</span>&gt;) -&gt; (<span class="type">Int</span>, <span class="type">Bool</span>) <span class="keyword">in</span></span><br><span class="line">                <span class="keyword">let</span> result = enumeratedObject.countByEnumerating(with: statePtr, objects: buffer, <span class="built_in">count</span>: <span class="number">16</span>)</span><br><span class="line">                <span class="keyword">if</span> statePtr.pointee.itemsPtr == buffer &#123;</span><br><span class="line">    <span class="comment">// å¤§å¤šæ•° cocoa ç±»ä¼šè¿”å›å®ƒä»¬è‡ªå·±çš„å†…éƒ¨æŒ‡é’ˆç¼“å­˜ï¼Œä¸ä½¿ç”¨é»˜è®¤çš„è·¯å¾„è·å–å€¼ã€‚ä¹Ÿæœ‰ä¾‹å¤–çš„æƒ…å†µï¼Œæ¯”å¦‚ NSDictionary å’Œ NSSetã€‚</span></span><br><span class="line">    <span class="keyword">return</span> (result, <span class="literal">true</span>)</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="comment">// è¿™é‡Œæ˜¯é€šå¸¸æƒ…å½¢ï¼Œæ¯”å¦‚ NSArrayã€‚</span></span><br><span class="line">    <span class="keyword">return</span> (result, <span class="literal">false</span>)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        state = localState <span class="comment">// é‡ç½® state çš„å€¼</span></span><br><span class="line">        objects = localObjects <span class="comment">// å°†å¯¹è±¡æŒ‡é’ˆæ‹·è´å› self </span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">count</span> == <span class="number">0</span> &#123; <span class="keyword">return</span> <span class="literal">nil</span> &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">defer</span> &#123; index += <span class="number">1</span> &#125;</span><br><span class="line">    <span class="keyword">if</span> !useObjectsBuffer &#123;</span><br><span class="line">        <span class="keyword">return</span> state.itemsPtr![index]</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">switch</span> index &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">0</span>: <span class="keyword">return</span> objects.<span class="number">0</span>!.takeUnretainedValue()</span><br><span class="line">        <span class="keyword">case</span> <span class="number">1</span>: <span class="keyword">return</span> objects.<span class="number">1</span>!.takeUnretainedValue()</span><br><span class="line">        <span class="keyword">case</span> <span class="number">2</span>: <span class="keyword">return</span> objects.<span class="number">2</span>!.takeUnretainedValue()</span><br><span class="line">        <span class="keyword">case</span> <span class="number">3</span>: <span class="keyword">return</span> objects.<span class="number">3</span>!.takeUnretainedValue()</span><br><span class="line">        <span class="keyword">case</span> <span class="number">4</span>: <span class="keyword">return</span> objects.<span class="number">4</span>!.takeUnretainedValue()</span><br><span class="line">        <span class="keyword">case</span> <span class="number">5</span>: <span class="keyword">return</span> objects.<span class="number">5</span>!.takeUnretainedValue()</span><br><span class="line">        <span class="keyword">case</span> <span class="number">6</span>: <span class="keyword">return</span> objects.<span class="number">6</span>!.takeUnretainedValue()</span><br><span class="line">        <span class="keyword">case</span> <span class="number">7</span>: <span class="keyword">return</span> objects.<span class="number">7</span>!.takeUnretainedValue()</span><br><span class="line">        <span class="keyword">case</span> <span class="number">8</span>: <span class="keyword">return</span> objects.<span class="number">8</span>!.takeUnretainedValue()</span><br><span class="line">        <span class="keyword">case</span> <span class="number">9</span>: <span class="keyword">return</span> objects.<span class="number">9</span>!.takeUnretainedValue()</span><br><span class="line">        <span class="keyword">case</span> <span class="number">10</span>: <span class="keyword">return</span> objects.<span class="number">10</span>!.takeUnretainedValue()</span><br><span class="line">        <span class="keyword">case</span> <span class="number">11</span>: <span class="keyword">return</span> objects.<span class="number">11</span>!.takeUnretainedValue()</span><br><span class="line">        <span class="keyword">case</span> <span class="number">12</span>: <span class="keyword">return</span> objects.<span class="number">12</span>!.takeUnretainedValue()</span><br><span class="line">        <span class="keyword">case</span> <span class="number">13</span>: <span class="keyword">return</span> objects.<span class="number">13</span>!.takeUnretainedValue()</span><br><span class="line">        <span class="keyword">case</span> <span class="number">14</span>: <span class="keyword">return</span> objects.<span class="number">14</span>!.takeUnretainedValue()</span><br><span class="line">        <span class="keyword">case</span> <span class="number">15</span>: <span class="keyword">return</span> objects.<span class="number">15</span>!.takeUnretainedValue()</span><br><span class="line">        <span class="keyword">default</span>: <span class="built_in">fatalError</span>(<span class="string">"Access beyond storage buffer"</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ä½ æµè§ˆè¿‡ä¸€éä¹‹åï¼Œè¯´å®è¯ï¼Œä½ èƒ½ç†è§£è¿™æ®µä»£ç å—ï¼Ÿæˆ‘å¹¶æ²¡æœ‰ã€‚æˆ‘ä¸å¾—ä¸èŠ±äº›æ—¶é—´å¤šè¯»å‡ éï¼Œå¹¶æŸ¥é˜…å‡½æ•°å®šä¹‰ä¹‹ç±»çš„ä»£ç ã€‚ä»¥æˆ‘çš„ç»éªŒï¼Œè¿™ç§ä»£ç æ˜¯æ™®éå­˜åœ¨çš„ï¼Œå¹¶ä¸”ä¸å¯é¿å…éœ€è¦ç»å¸¸ä¿®è¡¥çš„ã€‚</p><p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬è€ƒè™‘ç†è§£ä¸€ç§ Swift ç±»å‹ï¼ˆä¸æ˜¯ä¸€ä¸ªå‡½æ•°ï¼‰ã€‚æŸ¥çœ‹ Swift ä¸­çš„ <code>Array</code> çš„ <a href="http://swiftdoc.org/v3.1/type/Array/" target="_blank" rel="noopener">å®šä¹‰</a>ã€‚æˆ‘çš„å¤©ï¼Œå®ƒç»§æ‰¿äº† 10 ä¸ªåè®®ï¼š</p><ul><li><code>BidirectionalCollection</code></li><li><code>Collection</code></li><li><code>CustomDebugStringConvertible</code></li><li><code>CustomReflectable</code></li><li><code>CustomStringConvertible</code></li><li><code>ExpressibleByArrayLiteral</code></li><li><code>MutableCollection</code></li><li><code>RandomAccessCollection</code></li><li><code>RangeReplaceableCollection</code></li><li><code>Sequence</code></li></ul><p>ç‚¹å‡»ä¸‹æ–¹çš„â€œVIEW PROTOCOL HIERARCHY -&gt;â€é“¾æ¥æŒ‰é’®â€”â€”å¤©å“ªï¼Œ<a href="http://swiftdoc.org/v3.1/type/Array/hierarchy/" target="_blank" rel="noopener">çœ‹è¿™ä¸€å¨é¢æ¡ä¸€æ ·çš„çº¿æ¡</a>ï¼</p><p>å¦‚æœä½ æ˜¯åœ¨å¼€å‘ä¸€ä¸ªæ–°é¡¹ç›®ï¼Œå¹¶ä¸”æ•´ä¸ªå›¢é˜Ÿèƒ½å¤Ÿéµå¾ªä¸€å¥—æœ€ä½³å¼€å‘æŒ‡å¯¼æ–¹æ¡ˆçš„è¯ï¼Œè¦åšåˆ° Local reasoning ä¼šå®¹æ˜“å¾ˆå¤šã€‚å°‘é‡ä»£ç çš„é‡æ„ä¹Ÿæ˜¯åšåˆ° local reasoning çš„è¾ƒå¥½çš„æœºä¼šã€‚å¯¹æˆ‘æ¥è¯´ï¼Œåƒå…¶ä»–å¤§éƒ¨åˆ†äº‹æƒ…ä¸€æ ·ï¼Œä»£ç çš„é‡æ„éœ€è¦æ…é‡å’Œä»”ç»†ï¼Œè¦åšåˆ°é€‚åº¦ã€‚</p><p>ç‰¢è®°ï¼šä½ å‡ ä¹ä¸€ç›´è¦é¢å¯¹éå¸¸å¤æ‚çš„ä¸šåŠ¡é€»è¾‘ï¼Œè¿™äº›é€»è¾‘å¦‚æœå†™æˆä»£ç ï¼Œå¹¶ä¸”è¦è®©ä¸€ä¸ªå›¢é˜Ÿæ–°äººæµç•…è¯»æ‡‚ï¼Œéœ€è¦ä»–/å¥¹æ¥æ”¶ä¸€äº›ä¸šåŠ¡çŸ¥è¯†çš„è®­ç»ƒå’ŒæŒ‡å¯¼ã€‚ä»–/å¥¹å¾ˆå¯èƒ½éœ€è¦æŸ¥æ‰¾ä¸€äº›å‡½æ•°ã€ç±»ã€ç»“æ„ä½“ã€æšä¸¾å€¼ã€å˜é‡çš„å®šä¹‰ã€‚</p><h2 id="ä»£ç†å’Œåè®®"><a href="#ä»£ç†å’Œåè®®" class="headerlink" title="ä»£ç†å’Œåè®®"></a>ä»£ç†å’Œåè®®</h2><p>ä»£ç†æ¨¡å¼æ˜¯ iOS ä¸­å¹¿æ³›ä½¿ç”¨çš„æ¨¡å¼ï¼Œå…¶ä¸­ä¸€ä¸ªå¿…éœ€çš„ç»„æˆéƒ¨åˆ†å°±æ˜¯åè®®ã€‚åœ¨è¿™é‡Œæˆ‘ä»¬ä¸éœ€è¦å†å»é‡å¤ã€‚ä½ å¯ä»¥é˜…è¯»æˆ‘æœ‰å…³è¯¥ä¸»é¢˜çš„ AppCoda <a href="https://www.appcoda.com/swift-delegate/" target="_blank" rel="noopener">åšå®¢</a>ã€‚</p><h2 id="åè®®ç±»å‹ä»¥åŠåè®®å¤šæ€æ€§"><a href="#åè®®ç±»å‹ä»¥åŠåè®®å¤šæ€æ€§" class="headerlink" title="åè®®ç±»å‹ä»¥åŠåè®®å¤šæ€æ€§"></a>åè®®ç±»å‹ä»¥åŠåè®®å¤šæ€æ€§</h2><p>åœ¨è¿™äº›ä¸»é¢˜ä¸Šæˆ‘ä¸å‡†å¤‡èŠ±å¤ªå¤šæ—¶é—´ã€‚æˆ‘å·²ç»è®²è¿‡å¾ˆå¤šæœ‰å…³åè®®çš„çŸ¥è¯†ï¼Œå¹¶å‘ä½ å±•ç¤ºäº†å¤§é‡ä»£ç ã€‚ä½œä¸ºä»»åŠ¡ï¼Œæˆ‘æƒ³è®©ä½ è‡ªå·±ç ”ç©¶ä¸€ä¸‹ï¼ŒSwift åè®®ç±»å‹ï¼ˆå°±åƒåœ¨ä»£ç†ä¸­ä¸€æ ·ï¼‰çš„é‡è¦æ€§ï¼Œå®ƒä»¬èƒ½ç»™æˆ‘ä»¬å¸¦æ¥çš„çµæ´»æ€§ï¼Œä»¥åŠå®ƒä»¬æ‰€å±•ç¤ºçš„å¤šæ€æ€§ã€‚</p><p><em>åè®®ç±»å‹</em><br>åœ¨æˆ‘ <a href="https://www.appcoda.com/swift-delegate/" target="_blank" rel="noopener">å…³äºä»£ç†çš„æ–‡ç« </a> ä¸­ï¼Œæˆ‘å®šä¹‰äº†ä¸€ä¸ªå±æ€§ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> delegate: <span class="type">LogoDownloaderDelegate</span>?</span><br></pre></td></tr></table></figure><p>å…¶ä¸­ <code>LogoDownloaderDelegate</code> æ˜¯ä¸€ä¸ªåè®®ã€‚ç„¶åï¼Œæˆ‘è°ƒç”¨äº†è¿™ä¸ªåè®®çš„ä¸€ä¸ªæ–¹æ³•ã€‚</p><p><em>åè®®å¤šæ€æ€§</em><br>æ­£å¦‚åœ¨é¢å‘å¯¹è±¡ä¸­ä¸€æ ·ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡éµå¾ªçˆ¶åè®®çš„æ•°æ®ç±»å‹ï¼Œæ¥ä¸å¤šç§éµå¾ªåŒä¸€ä¸ªåè®®æ—çš„å­åè®®çš„æ•°æ®ç±»å‹è¿›è¡Œäº¤äº’ã€‚ç”¨ä»£ç ä¸¾ä¾‹æ¥è¯´æ˜ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">Top</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> protocolName: <span class="type">String</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">Middle</span>: <span class="title">Top</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">Bottom</span>: <span class="title">Middle</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">TopStruct</span> : <span class="title">Top</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> protocolName: <span class="type">String</span> = <span class="string">"TopStruct"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">MiddleStruct</span> : <span class="title">Middle</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> protocolName: <span class="type">String</span> = <span class="string">"MiddleStruct"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">BottomStruct</span> : <span class="title">Bottom</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> protocolName: <span class="type">String</span> = <span class="string">"BottomStruct"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> top = <span class="type">TopStruct</span>()</span><br><span class="line"><span class="keyword">let</span> middle = <span class="type">MiddleStruct</span>()</span><br><span class="line"><span class="keyword">let</span> bottom = <span class="type">BottomStruct</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> topStruct: <span class="type">Top</span></span><br><span class="line">topStruct = bottom</span><br><span class="line"><span class="built_in">print</span>(<span class="string">"<span class="subst">\(topStruct)</span>\n"</span>)</span><br><span class="line"><span class="comment">// è¾“å‡º "BottomStruct(protocolName: "BottomStruct")"</span></span><br><span class="line"></span><br><span class="line">topStruct = middle</span><br><span class="line"><span class="built_in">print</span>(<span class="string">"<span class="subst">\(topStruct)</span>\n"</span>)</span><br><span class="line"><span class="comment">// è¾“å‡º "MiddleStruct(protocolName: "MiddleStruct")"</span></span><br><span class="line"></span><br><span class="line">topStruct = top</span><br><span class="line"><span class="built_in">print</span>(<span class="string">"<span class="subst">\(topStruct)</span>\n"</span>)</span><br><span class="line"><span class="comment">// è¾“å‡º "TopStruct(protocolName: "TopStruct")"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> protocolStructs:[<span class="type">Top</span>] = [top,middle,bottom]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> protocolStruct <span class="keyword">in</span> protocolStructs &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"<span class="subst">\(protocolStruct)</span>\n"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœä½ è¿è¡Œä¸€ä¸‹ Playground ä¸­çš„ä»£ç ï¼Œä»¥ä¸‹æ˜¯ç»ˆç«¯çš„è¾“å‡ºç»“æœï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">BottomStruct(protocolName: &quot;BottomStruct&quot;)</span><br><span class="line"></span><br><span class="line">MiddleStruct(protocolName: &quot;MiddleStruct&quot;)</span><br><span class="line"></span><br><span class="line">TopStruct(protocolName: &quot;TopStruct&quot;)</span><br><span class="line"></span><br><span class="line">TopStruct(protocolName: &quot;TopStruct&quot;)</span><br><span class="line"></span><br><span class="line">MiddleStruct(protocolName: &quot;MiddleStruct&quot;)</span><br><span class="line"></span><br><span class="line">BottomStruct(protocolName: &quot;BottomStruct&quot;)</span><br></pre></td></tr></table></figure><h2 id="çœŸå®çš„-UIKit-åº”ç”¨ä¸­çš„åè®®"><a href="#çœŸå®çš„-UIKit-åº”ç”¨ä¸­çš„åè®®" class="headerlink" title="çœŸå®çš„ UIKit åº”ç”¨ä¸­çš„åè®®"></a>çœŸå®çš„ UIKit åº”ç”¨ä¸­çš„åè®®</h2><p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬æ¥çœ‹ä¸€äº›å®è´¨æ€§çš„ä¸œè¥¿ï¼Œå†™ä¸€äº› Swift 4 çš„ä»£ç â€”â€”è¿™äº›ä»£ç æ˜¯åœ¨æˆ‘è‡ªå·±çš„åº”ç”¨ä¸­çœŸå®ä½¿ç”¨çš„ã€‚è¿™äº›ä»£ç åº”å½“èƒ½ä½¿ä½ å¼€å§‹æ€è€ƒç”¨åè®®æ¥æ„å»ºå’Œ/æˆ–æ‹“å±•ä½ çš„ä»£ç ã€‚è¿™ä¹Ÿå°±æ˜¯æˆ‘åœ¨è¿™ä¸¤ç¯‡æ–‡ç« ä¸­ä¸€ç›´åœ¨æè¿°çš„ï¼Œâ€œé¢å‘åè®®ç¼–ç¨‹â€ï¼Œæˆ–è€… POPã€‚</p><p>æˆ‘é€‰æ‹©å‘ä½ å±•ç¤ºå¦‚ä½•å»æ‰©å±•æˆ–è€…è¯´æ˜¯å»¶ä¼¸ï¼ˆéšä¾¿å“ªç§è¯´æ³•ï¼‰<code>UIKit</code> çš„ç±»ï¼Œå› ä¸º 1) ä½ å¾ˆå¯èƒ½éå¸¸ä¹ æƒ¯ä½¿ç”¨å®ƒä»¬ 2) æ‰©å±• iOS SDK ä¸­çš„ç±»ï¼Œæ¯”å¦‚ <code>UIView</code>ï¼Œæ˜¯æ¯”ç”¨ä½ è‡ªå·±çš„ç±»æ›´åŠ å›°éš¾ä¸€äº›çš„ã€‚</p><p>æ‰€æœ‰ <code>UIView</code> çš„æ‰©å±•ä»£ç éƒ½æ˜¯ç”¨ Xcode 9 å·¥ç¨‹ä¸­çš„ <em>Single View App</em> æ¨¡æ¿å†™çš„ã€‚</p><p>æˆ‘ä½¿ç”¨é»˜è®¤åè®®æ‰©å±•æ¥å¯¹ <code>UIView</code> è¿›è¡Œæ‰©å±•â€”â€”è¿™ä¹ˆåšçš„å…³é”®æ˜¯ä¸€ç§ Apple ç§°ä¹‹ä¸º <a href="https://swift.org/blog/conditional-conformance/" target="_blank" rel="noopener">â€œæ¡ä»¶éµå¾ªâ€</a> çš„åšæ³•ï¼ˆä¹Ÿå¯ä»¥çœ‹ <a href="https://developer.apple.com/library/content/documentation/Swift/Conceptual/Swift_Programming_Language/Protocols.html#//apple_ref/doc/uid/TP40014097-CH25-ID277" target="_blank" rel="noopener">è¿™é‡Œ</a>ï¼‰ã€‚å› ä¸ºæˆ‘åªæƒ³å¯¹ <code>UIView</code> è¿™ä¸ªç±»è¿›è¡Œæ‰©å±•ï¼Œæˆ‘ä»¬å¯ä»¥è®©ç¼–è¯‘å™¨æ¥æŠŠè¿™ä¸ªå˜æˆä¸€é¡¹å¼ºåˆ¶è¦æ±‚ã€‚</p><p>æˆ‘ç»å¸¸ä½¿ç”¨ <code>UIView</code> ä½œä¸ºä¸€ä¸ªå®¹å™¨æ¥ç»„ç»‡å±å¹•ä¸Šçš„å…¶ä»– UI å…ƒç´ ã€‚ä¹Ÿæœ‰æ—¶å€™ï¼Œæˆ‘ä¼šç”¨è¿™äº›å®¹å™¨è§†å›¾æ¥æ›´å¥½åœ°æŸ¥çœ‹ã€æ„Ÿè§‰ã€æ’å¸ƒæˆ‘çš„ UI è§†å›¾ã€‚</p><p>è¿™é‡Œæ˜¯ä¸€å¼  GIF å›¾ç‰‡ï¼Œå±•ç¤ºäº†ä½¿ç”¨ä¸‹é¢åˆ›å»ºçš„ä¸‰ä¸ªåè®®æ¥è‡ªå®šä¹‰ <code>UIView</code> çš„å¤–è§‚çš„ç»“æœï¼š</p><p><img src="https://www.appcoda.com/wp-content/uploads/2018/03/Extend-UIView.gif" alt=""></p><p>æ³¨æ„ï¼Œè¿™é‡Œæˆ‘ä¹Ÿéµå®ˆäº† â€Local reasoningâ€œ çš„åŸåˆ™ã€‚æˆ‘æ¯ä¸€ä¸ªåŸºäºåè®®çš„å‡½æ•°éƒ½æ§åˆ¶åœ¨ä¸€å±å¹•ä¹‹å†…ã€‚æˆ‘å¸Œæœ›ä½ èƒ½é˜…è¯»æ¯ä¸€ä¸ªå‡½æ•°ï¼Œå› ä¸ºå®ƒä»¬å¹¶æ²¡æœ‰å¤ªå¤šä»£ç é‡ï¼Œä½†å´å¾ˆæœ‰æ•ˆã€‚</p><h2 id="ä¸º-UIView-æ·»åŠ ä¸€ä¸ªé»˜è®¤çš„è¾¹æ¡†"><a href="#ä¸º-UIView-æ·»åŠ ä¸€ä¸ªé»˜è®¤çš„è¾¹æ¡†" class="headerlink" title="ä¸º UIView æ·»åŠ ä¸€ä¸ªé»˜è®¤çš„è¾¹æ¡†"></a>ä¸º UIView æ·»åŠ ä¸€ä¸ªé»˜è®¤çš„è¾¹æ¡†</h2><p>å‡è®¾æˆ‘å¸Œæœ›è·å¾—å¾ˆå¤šæ‹¥æœ‰ç›¸åŒè¾¹æ¡†çš„ <code>UIView</code> å®ä¾‹â€”â€”ä¾‹å¦‚åœ¨ä¸€ä¸ªæ”¯æŒé¢œè‰²ä¸»é¢˜çš„åº”ç”¨ä¸­é‚£æ ·ã€‚ä¸€ä¸ªè¿™æ ·çš„ä¾‹å­å°±æ˜¯ä¸Šé¢é‚£å¼ å›¾ç‰‡ä¸­ï¼Œæœ€ä¸Šé¢é‚£ä¸ªç»¿è‰²çš„è§†å›¾ã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">SimpleViewWithBorder</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å®‰å…¨çš„ï¼š"addBorder" æ–¹æ³•åªä¼šè¢«æ·»åŠ åˆ° UIView çš„å®ä¾‹ã€‚</span></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">SimpleViewWithBorder</span> <span class="title">where</span> <span class="title">Self</span> : <span class="title">UIView</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">addBorder</span><span class="params">()</span></span> -&gt; <span class="type">Void</span> &#123;</span><br><span class="line">        layer.borderColor = <span class="type">UIColor</span>.green.cgColor</span><br><span class="line">        layer.borderWidth = <span class="number">10.0</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SimpleUIViewWithBorder</span> : <span class="title">UIView</span>, <span class="title">SimpleViewWithBorder</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¦åˆ›å»ºã€é…ç½®ã€æ˜¾ç¤ºä¸€ä¸ª <code>SimpleUIViewWithBorder</code> çš„å®ä¾‹ï¼Œæˆ‘åœ¨æˆ‘çš„ <code>ViewController</code> å­ç±»ä¸­çš„ <code>IBAction</code> ä¸­å†™äº†å¦‚ä¸‹ä»£ç ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="meta">@IBAction</span> <span class="function"><span class="keyword">func</span> <span class="title">addViewButtonTapped</span><span class="params">(<span class="number">_</span> sender: Any)</span></span> &#123;</span><br><span class="line">    <span class="keyword">let</span> customFrame0 = <span class="type">CGRect</span>(x: <span class="number">110</span>, y: <span class="number">100</span>, width: <span class="number">100</span>, height: <span class="number">100</span>)</span><br><span class="line">    <span class="keyword">let</span> customView0 = <span class="type">SimpleUIViewWithBorder</span>(frame: customFrame0)</span><br><span class="line">    customView0.addBorder()</span><br><span class="line">    <span class="keyword">self</span>.view.addSubview(customView0)</span><br></pre></td></tr></table></figure><p>æˆ‘ä¸éœ€è¦ä¸ºè¿™ä¸ª <code>UIView</code> çš„å­ç±»å»åˆ›å»ºä¸€ä¸ªç‰¹æ®Šçš„åˆå§‹åŒ–æ–¹æ³•ã€‚</p><h2 id="ä¸º-UIView-æ·»åŠ ä¸€ä¸ªé»˜è®¤çš„èƒŒæ™¯è‰²"><a href="#ä¸º-UIView-æ·»åŠ ä¸€ä¸ªé»˜è®¤çš„èƒŒæ™¯è‰²" class="headerlink" title="ä¸º UIView æ·»åŠ ä¸€ä¸ªé»˜è®¤çš„èƒŒæ™¯è‰²"></a>ä¸º UIView æ·»åŠ ä¸€ä¸ªé»˜è®¤çš„èƒŒæ™¯è‰²</h2><p>å‡è®¾æˆ‘å¸Œæœ›å¾ˆå¤š <code>UIView</code> çš„å®ä¾‹éƒ½æœ‰ç›¸åŒçš„èƒŒæ™¯è‰²ã€‚ä¸€ä¸ªè¿™æ ·çš„ä¾‹å­æ˜¯ä¸Šå›¾ä¸­ï¼Œä¸­é—´çš„è“è‰²è§†å›¾ã€‚æ³¨æ„ï¼Œæˆ‘å‘å¯é…ç½®çš„ <code>UIView</code> åˆæ›´è¿›äº†ä¸€æ­¥ã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">ViewWithBackground</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> customBackgroundColor: <span class="type">UIColor</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">ViewWithBackground</span> <span class="title">where</span> <span class="title">Self</span> : <span class="title">UIView</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">addBackgroundColor</span><span class="params">()</span></span> -&gt; <span class="type">Void</span> &#123;</span><br><span class="line">        backgroundColor = customBackgroundColor</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UIViewWithBackground</span> : <span class="title">UIView</span>, <span class="title">ViewWithBackground</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> customBackgroundColor: <span class="type">UIColor</span> = .blue</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¦åˆ›å»ºã€é…ç½®ã€å±•ç¤ºä¸€ä¸ª <code>UIViewWithBackground</code> çš„å®ä¾‹ï¼Œæˆ‘åœ¨æˆ‘çš„ <code>ViewController</code> å­ç±»ä¸­çš„ <code>IBAction</code> ä¸­å†™äº†å¦‚ä¸‹ä»£ç ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> customFrame1 = <span class="type">CGRect</span>(x: <span class="number">110</span>, y: <span class="number">210</span>, width: <span class="number">100</span>, height: <span class="number">100</span>)</span><br><span class="line"><span class="keyword">let</span> customView1 = <span class="type">UIViewWithBackground</span>(frame: customFrame1)</span><br><span class="line">customView1.addBackgroundColor()</span><br><span class="line"><span class="keyword">self</span>.view.addSubview(customView1)</span><br></pre></td></tr></table></figure><p>æˆ‘ä¸éœ€è¦ä¸ºè¿™ä¸ª <code>UIView</code> çš„å­ç±»å»åˆ›å»ºä¸€ä¸ªç‰¹æ®Šçš„åˆå§‹åŒ–æ–¹æ³•ã€‚</p><h2 id="ä¸º-UIView-æ·»åŠ ä¸€ä¸ªå¯é…ç½®çš„è¾¹æ¡†é¢œè‰²"><a href="#ä¸º-UIView-æ·»åŠ ä¸€ä¸ªå¯é…ç½®çš„è¾¹æ¡†é¢œè‰²" class="headerlink" title="ä¸º UIView æ·»åŠ ä¸€ä¸ªå¯é…ç½®çš„è¾¹æ¡†é¢œè‰²"></a>ä¸º UIView æ·»åŠ ä¸€ä¸ªå¯é…ç½®çš„è¾¹æ¡†é¢œè‰²</h2><p>ç°åœ¨ï¼Œæˆ‘å¸Œæœ›èƒ½å¤Ÿé…ç½® <code>UIView</code> è¾¹æ¡†çš„é¢œè‰²å’Œå®½åº¦ã€‚ç”¨ä¸‹åˆ—å®ç°ä»£ç ï¼Œæˆ‘å¯ä»¥éšæ„åˆ›å»ºä¸åŒè¾¹æ¡†é¢œè‰²ã€å®½åº¦çš„è§†å›¾ã€‚è¿™æ ·çš„ä¸€ä¸ªä¾‹å­æ˜¯ä¸Šå›¾ä¸­ï¼Œæœ€ä¸‹é¢çš„çº¢è‰²è§†å›¾ã€‚å‘æˆ‘çš„åè®®ä¸­å»æ·»åŠ å¯é…ç½®çš„å±æ€§æœ‰ä¸€ç‚¹ä»£ä»·ï¼Œæˆ‘éœ€è¦èƒ½å¤Ÿåˆå§‹åŒ–è¿™äº›å±æ€§ï¼Œå› æ­¤ï¼Œæˆ‘ä¸ºæˆ‘çš„åè®®æ·»åŠ äº†ä¸€ä¸ª <code>init</code> æ–¹æ³•ã€‚è¿™æ„å‘³ç€ï¼Œæˆ‘ä¹Ÿå¯ä»¥è°ƒç”¨ <code>UIView</code> çš„åˆå§‹åŒ–æ–¹æ³•ã€‚è¯»å®Œä»£ç ï¼Œä½ å°±ä¼šæ˜ç™½ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">ViewWithBorder</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> borderColor: <span class="type">UIColor</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">    <span class="keyword">var</span> borderThickness: <span class="type">CGFloat</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">    <span class="keyword">init</span>(borderColor: <span class="type">UIColor</span>, borderThickness: <span class="type">CGFloat</span>, frame: <span class="type">CGRect</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">ViewWithBorder</span> <span class="title">where</span> <span class="title">Self</span> : <span class="title">UIView</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">addBorder</span><span class="params">()</span></span> -&gt; <span class="type">Void</span> &#123;</span><br><span class="line">        layer.borderColor = borderColor.cgColor</span><br><span class="line">        layer.borderWidth = borderThickness</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UIViewWithBorder</span> : <span class="title">UIView</span>, <span class="title">ViewWithBorder</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> borderColor: <span class="type">UIColor</span></span><br><span class="line">    <span class="keyword">let</span> borderThickness: <span class="type">CGFloat</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// UIView çš„å¿…è¦åˆå§‹åŒ–æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">required</span> <span class="keyword">init</span>(borderColor: <span class="type">UIColor</span>, borderThickness: <span class="type">CGFloat</span>, frame: <span class="type">CGRect</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.borderColor = borderColor</span><br><span class="line">        <span class="keyword">self</span>.borderThickness = borderThickness</span><br><span class="line">        <span class="keyword">super</span>.<span class="keyword">init</span>(frame: frame)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// UIView çš„å¿…è¦åˆå§‹åŒ–æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">required</span> <span class="keyword">init</span>?(coder aDecoder: <span class="type">NSCoder</span>) &#123;</span><br><span class="line">        <span class="built_in">fatalError</span>(<span class="string">"init(coder:) has not been implemented"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¦åˆ›å»ºã€é…ç½®ã€æ˜¾ç¤ºä¸€ä¸ª <code>UIViewWithBorder</code> çš„å®ä¾‹ï¼Œæˆ‘åœ¨æˆ‘çš„ <code>ViewController</code> å­ç±»ä¸­çš„ <code>IBAction</code> ä¸­å†™äº†å¦‚ä¸‹ä»£ç ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> customFrame2 = <span class="type">CGRect</span>(x: <span class="number">110</span>, y: <span class="number">320</span>, width: <span class="number">100</span>, height: <span class="number">100</span>)</span><br><span class="line"><span class="keyword">let</span> customView2 = <span class="type">UIViewWithBorder</span>(borderColor: .red, borderThickness: <span class="number">10.0</span>, frame: customFrame2)</span><br><span class="line">customView2.addBorder()</span><br><span class="line"><span class="keyword">self</span>.view.addSubview(customView2)</span><br></pre></td></tr></table></figure><h2 id="æˆ‘ä¸æƒ³åšçš„äº‹"><a href="#æˆ‘ä¸æƒ³åšçš„äº‹" class="headerlink" title="æˆ‘ä¸æƒ³åšçš„äº‹"></a>æˆ‘ä¸æƒ³åšçš„äº‹</h2><p>æˆ‘ä¸æƒ³å»åˆ›å»ºåƒè¿™æ ·çš„ä»£ç ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">UIView</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">addBorder</span><span class="params">()</span></span> &#123;  ...  &#125;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">addBackgroundColor</span><span class="params">()</span></span> &#123;  ...  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·ä¹Ÿè®¸åœ¨ä¸€äº›æƒ…å†µä¸‹æ˜¯æœ‰æ•ˆçš„ï¼Œä½†æˆ‘æ„Ÿè§‰è¿™ç§å®ç°å¤ªç²—æ³›äº†ï¼Œå®¹æ˜“ä¸§å¤±å¾ˆå¤šç»†é¢—ç²’åº¦çš„æ§åˆ¶ã€‚è¿™ç§å®ç°ä¹Ÿå®¹æ˜“ä½¿å¾—è¿™ç§æ„é€ æ–¹æ³•å˜æˆ <code>UIView</code> ç›¸å…³æ‰©å±•æ–¹æ³•çš„åƒåœ¾åœºï¼Œæ¢å¥è¯è¯´ï¼Œä»£ç å®¹æ˜“å˜å¾—è‡ƒè‚¿ã€‚éšç€æ–¹æ³•è¶Šæ¥è¶Šå¤šï¼Œä»£ç ä¹Ÿå˜å¾—è¶Šæ¥è¶Šéš¾ä»¥é˜…è¯»å’Œç»´æŠ¤ã€‚</p><p>åœ¨ä¸Šè¿°æ‰€æœ‰åŸºäº <code>UIKit</code> çš„åè®®ä¸­ï¼Œæˆ‘éƒ½ä½¿ç”¨äº† <code>UIView</code> çš„å­ç±»â€”â€”å¼•ç”¨ç±»å‹ã€‚å­ç±»åŒ–èƒ½å¤Ÿè®©æˆ‘èƒ½ç›´æ¥è®¿é—®çˆ¶ç±» <code>UIView</code> ä¸­çš„ä»»ä½•å†…å®¹ï¼Œè®©æˆ‘çš„ä»£ç æ¸…æ™°ã€ç®€çŸ­ã€æ˜“è¯»ã€‚å¦‚æœæˆ‘ä½¿ç”¨çš„æ˜¯ <code>struct</code>ï¼Œæˆ‘çš„ä»£ç ä¼šå˜å¾—æ›´åŠ å†—é•¿ï¼Œè‡³äºä¸ºä»€ä¹ˆï¼Œç•™ç»™ä½ ä»¬å½“åšç»ƒä¹ ã€‚</p><h2 id="æˆ‘åšçš„äº‹æƒ…"><a href="#æˆ‘åšçš„äº‹æƒ…" class="headerlink" title="æˆ‘åšçš„äº‹æƒ…"></a>æˆ‘åšçš„äº‹æƒ…</h2><p>æ—¶åˆ»è®°ä½ï¼Œæ‰€æœ‰è¿™äº›é»˜è®¤åè®® <code>extensions</code> å¯ä»¥åœ¨ç±»æ‰©å±•ä¸­è¦†ç›–ã€‚ç”¨ä¸€ä¸ªä¾‹å­å’Œå›¾ç‰‡æ¥è§£é‡Šï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">SimpleViewWithBorder</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">SimpleViewWithBorder</span> <span class="title">where</span> <span class="title">Self</span> : <span class="title">UIView</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">addBorder</span><span class="params">()</span></span> -&gt; <span class="type">Void</span> &#123;</span><br><span class="line">        layer.borderColor = <span class="type">UIColor</span>.green.cgColor</span><br><span class="line">        layer.borderWidth = <span class="number">10.0</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SimpleUIViewWithBorder</span> : <span class="title">UIView</span>, <span class="title">SimpleViewWithBorder</span> </span>&#123;</span><br><span class="line">    <span class="comment">// è¦†ç›– extension ä¸­çš„é»˜è®¤å®ç°</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">addBorder</span><span class="params">()</span></span> -&gt; <span class="type">Void</span> &#123;</span><br><span class="line">        layer.borderColor = <span class="type">UIColor</span>.darkGray.cgColor</span><br><span class="line">        layer.borderWidth = <span class="number">20.0</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨æ„æˆ‘åœ¨ <code>SimpleUIViewWithBorder</code> ä¸­çš„æ³¨é‡Šã€‚çœ‹ä¸‹å›¾ä¸­æœ€ä¸Šé¢çš„è§†å›¾ï¼š</p><p><img src="https://www.appcoda.com/wp-content/uploads/2018/03/Override-Extended-UIView.gif" alt=""></p><h2 id="çœŸå®çš„ï¼ŒåŸºäºåè®®çš„æ³›å‹æ•°æ®ç»“æ„"><a href="#çœŸå®çš„ï¼ŒåŸºäºåè®®çš„æ³›å‹æ•°æ®ç»“æ„" class="headerlink" title="çœŸå®çš„ï¼ŒåŸºäºåè®®çš„æ³›å‹æ•°æ®ç»“æ„"></a>çœŸå®çš„ï¼ŒåŸºäºåè®®çš„æ³›å‹æ•°æ®ç»“æ„</h2><p>æˆ‘éå¸¸éª„å‚²åœ¨æˆ‘è‡ªå·±çš„åº”ç”¨ä¸­ï¼Œæˆ‘èƒ½å¤Ÿå†™å°½é‡å°‘çš„ POP ä»£ç ï¼Œæ¥åˆ›å»ºå®Œæ•´åŠŸèƒ½çš„æ³›å‹çš„æ ˆå’Œé˜Ÿåˆ—çš„æ•°æ®ç»“æ„ã€‚æƒ³äº†è§£æœ‰å…³ Swift ä¸­çš„æ³›å‹ï¼Œè¯·é˜…è¯»æˆ‘ AppCoda ä¸­çš„ <a href="https://appcoda.com/swift-generics/" target="_blank" rel="noopener">æ–‡ç« </a>ã€‚</p><p>è¯·æ³¨æ„ï¼Œæˆ‘ä½¿ç”¨åè®®ç»§æ‰¿æ¥å¸®åŠ©æˆ‘åˆ©ç”¨æŠ½è±¡çš„ <code>List</code> åè®®å»åˆ›å»ºæ›´åŠ å…·ä½“çš„ <code>FIFO</code> å’Œ <code>LIFO</code> åè®®ã€‚ç„¶åï¼Œæˆ‘åˆ©ç”¨åè®®æ‰©å±•æ¥å®ç° <code>Queue</code> å’Œ <code>Stack</code> å€¼ç±»å‹ã€‚ä½ å¯ä»¥åœ¨ä¸‹é¢çš„ Xcode 9 playground ä¸­çœ‹åˆ°è¿™äº› <code>struct</code> çš„å®ä¾‹ã€‚</p><p>æˆ‘æƒ³å‘ä½ å±•ç¤ºçš„æ˜¯å¦‚ä½•åƒ Apple å»ºè®®çš„ä¸€æ ·ï¼Œé€šè¿‡å…¶ä»–åè®®æ¥å®ç°è‡ªå·±è‡ªå®šä¹‰çš„åè®®ï¼Œå› æ­¤ï¼Œæˆ‘åˆ›å»ºäº† <code>ListSubscript</code>ï¼Œ<code>ListPrintForwards</code>ï¼Œ<code>ListPrintBackwards</code>ï¼Œ<code>ListCount</code>åè®®ã€‚å®ƒä»¬ç°åœ¨è¿˜å¾ˆç®€å•ï¼Œä½†åœ¨ä¸€ä¸ªå®é™…çš„åº”ç”¨ä¸­å°†ä¼šå±•ç°å‡ºå…¶ä½œç”¨ã€‚</p><p>è¿™ç§ç»§æ‰¿å¤šä¸ªå…¶ä»–åè®®çš„åšæ³•å¯ä»¥è®©å¼€å‘è€…ä¸ºç°æœ‰ä»£ç å¢åŠ æ–°çš„åŠŸèƒ½ï¼Œè€Œä¸”ä¸ä¼šå› ä¸ºå¤ªå¤šé¢å¤–ä¸ç›¸å…³çš„åŠŸèƒ½å¯¹ä»£ç é€ æˆâ€æ±¡æŸ“â€œæˆ–â€è‡ƒè‚¿â€œã€‚è¿™äº›åè®®ä¸­ï¼Œæ¯ä¸€ä¸ªéƒ½æ˜¯ç‹¬ç«‹çš„ã€‚å¦‚æœæ˜¯ä½œä¸ºç±»è¢«æ·»åŠ åˆ°ç»§æ‰¿å±‚çº§ä¸­å¶çº§ä»¥ä¸Šçš„è¯ï¼Œæ ¹æ®å®ƒä»¬æ‰€å¤„çš„ä½ç½®ï¼Œè¿™äº›åŠŸèƒ½å°†ä¼šè‡³å°‘è‡ªåŠ¨è¢«å…¶ä»–ä¸€äº›ç±»ç»§æ‰¿ã€‚</p><p>å…³äº POPï¼Œæˆ‘å·²ç»è®²äº†è¶³å¤Ÿå¤šæ¥å¸®åŠ©ä½ é˜…è¯»å’Œç†è§£ä»£ç ã€‚å†ç»™å‡ºä¸€ä¸ªæˆ‘æ˜¯å¦‚ä½•è®©æˆ‘çš„æ•°æ®ç»“æ„æ”¯æŒæ³›å‹çš„æç¤ºï¼š<a href="https://developer.apple.com/library/content/documentation/Swift/Conceptual/Swift_Programming_Language/Generics.html#//apple_ref/doc/uid/TP40014097-CH26-ID189" target="_blank" rel="noopener">å…³è”ç±»å‹çš„å®šä¹‰</a>ã€‚</p><blockquote><p>å½“å®šä¹‰ä¸€ä¸ªåè®®çš„æ—¶å€™ï¼Œæœ‰æ—¶å¯ä»¥å£°æ˜ä¸€ä¸ªæˆ–å¤šä¸ªå…³è”ç±»å‹ï¼Œä½œä¸ºåè®®å®šä¹‰çš„ä¸€éƒ¨åˆ†ã€‚ä¸€ä¸ªå…³è”ç±»å‹æä¾›äº†ä¸€ä¸ªå ä½åï¼Œç”¨æ¥è¡¨ç¤ºåè®®ä¸­çš„ä¸€ç§ç±»å‹ã€‚è¿™ä¸ªå…³è”ç±»å‹çœŸæ­£çš„æ•°æ®ç±»å‹ç›´åˆ°è¯¥åè®®è¢«ä½¿ç”¨çš„æ—¶å€™æ‰ç¡®å®šã€‚ä½¿ç”¨ <code>associatedtype</code> å…³é”®å­—æ¥æŒ‡æ˜ä¸€ä¸ªå…³è”ç±»å‹ã€‚</p></blockquote><p>ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">ListSubscript</span> </span>&#123;</span><br><span class="line">    associatedtype <span class="type">AnyType</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> elements : [<span class="type">AnyType</span>] &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">ListSubscript</span> </span>&#123;</span><br><span class="line">    <span class="keyword">subscript</span>(i: <span class="type">Int</span>) -&gt; <span class="type">Any</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> elements[i]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">ListPrintForwards</span> </span>&#123;</span><br><span class="line">    associatedtype <span class="type">AnyType</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> elements : [<span class="type">AnyType</span>] &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">ListPrintForwards</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">showList</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">if</span> elements.<span class="built_in">count</span> &gt; <span class="number">0</span> &#123;</span><br><span class="line">            <span class="keyword">var</span> line = <span class="string">""</span></span><br><span class="line">            <span class="keyword">var</span> index = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">                        <span class="keyword">for</span> element <span class="keyword">in</span> elements &#123;</span><br><span class="line">                line += <span class="string">"<span class="subst">\(element)</span> "</span></span><br><span class="line">                index += <span class="number">1</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"<span class="subst">\(line)</span>\n"</span>)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"EMPTY\n"</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">ListPrintBackward</span> </span>&#123;</span><br><span class="line">    associatedtype <span class="type">AnyType</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> elements : [<span class="type">AnyType</span>] &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">ListPrintBackwards</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">showList</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">if</span> elements.<span class="built_in">count</span> &gt; <span class="number">0</span> &#123;</span><br><span class="line">            <span class="keyword">var</span> line = <span class="string">""</span></span><br><span class="line">            <span class="keyword">var</span> index = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> element <span class="keyword">in</span> elements.reversed() &#123;</span><br><span class="line">                line += <span class="string">"<span class="subst">\(element)</span> "</span></span><br><span class="line">                index += <span class="number">1</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"<span class="subst">\(line)</span>\n"</span>)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"EMPTY\n"</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">ListCount</span> </span>&#123;</span><br><span class="line">    associatedtype <span class="type">AnyType</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> elements : [<span class="type">AnyType</span>] &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">ListCount</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">count</span><span class="params">()</span></span> -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> elements.<span class="built_in">count</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">List</span> </span>&#123;</span><br><span class="line">    associatedtype <span class="type">AnyType</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> elements : [<span class="type">AnyType</span>] &#123; <span class="keyword">get</span> <span class="keyword">set</span> &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">mutating</span> <span class="function"><span class="keyword">func</span> <span class="title">remove</span><span class="params">()</span></span> -&gt; <span class="type">AnyType</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">mutating</span> <span class="function"><span class="keyword">func</span> <span class="title">add</span><span class="params">(<span class="number">_</span> element: AnyType)</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">List</span> </span>&#123;</span><br><span class="line">    <span class="keyword">mutating</span> <span class="function"><span class="keyword">func</span> <span class="title">add</span><span class="params">(<span class="number">_</span> element: AnyType)</span></span> &#123;</span><br><span class="line">        elements.append(element)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">FIFO</span> : <span class="title">List</span>, <span class="title">ListCount</span>, <span class="title">ListPrintForwards</span>, <span class="title">ListSubscript</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">FIFO</span> </span>&#123;</span><br><span class="line">    <span class="keyword">mutating</span> <span class="function"><span class="keyword">func</span> <span class="title">remove</span><span class="params">()</span></span> -&gt; <span class="type">AnyType</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> elements.<span class="built_in">count</span> &gt; <span class="number">0</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> elements.removeFirst()</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"******EMPTY******"</span> <span class="keyword">as</span>! <span class="type">AnyType</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Queue</span>&lt;<span class="title">AnyType</span>&gt;: <span class="title">FIFO</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> elements: [<span class="type">AnyType</span>] = []</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> queue = <span class="type">Queue</span>&lt;<span class="type">Any</span>&gt;()</span><br><span class="line">queue.add(<span class="string">"Bob"</span>)</span><br><span class="line">queue.showList()</span><br><span class="line">queue.add(<span class="number">1</span>)</span><br><span class="line">queue.showList()</span><br><span class="line">queue.add(<span class="number">3.0</span>)</span><br><span class="line"><span class="number">_</span> = queue[<span class="number">0</span>] <span class="comment">// è¯¥ä¸‹æ ‡è¾“å‡º "Bob"</span></span><br><span class="line"><span class="number">_</span> = queue.<span class="built_in">count</span>()</span><br><span class="line">queue.showList()</span><br><span class="line">queue.remove()</span><br><span class="line">queue.showList()</span><br><span class="line">queue.remove()</span><br><span class="line">queue.showList()</span><br><span class="line">queue.remove()</span><br><span class="line">queue.showList()</span><br><span class="line"><span class="number">_</span> = queue.<span class="built_in">count</span>()</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">LIFO</span> : <span class="title">List</span>, <span class="title">ListCount</span>, <span class="title">ListPrintBackwards</span>, <span class="title">ListSubscript</span> </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">LIFO</span> </span>&#123;</span><br><span class="line">    <span class="keyword">mutating</span> <span class="function"><span class="keyword">func</span> <span class="title">remove</span><span class="params">()</span></span> -&gt; <span class="type">AnyType</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> elements.<span class="built_in">count</span> &gt; <span class="number">0</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> elements.removeLast()</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"******EMPTY******"</span> <span class="keyword">as</span>! <span class="type">AnyType</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Stack</span>&lt;<span class="title">AnyType</span>&gt;: <span class="title">LIFO</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> elements: [<span class="type">AnyType</span>] = []</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> stack = <span class="type">Stack</span>&lt;<span class="type">Any</span>&gt;()</span><br><span class="line">stack.add(<span class="string">"Bob"</span>)</span><br><span class="line">stack.showList()</span><br><span class="line">stack.add(<span class="number">1</span>)</span><br><span class="line">stack.showList()</span><br><span class="line">stack.add(<span class="number">3.0</span>)</span><br><span class="line"><span class="number">_</span> = stack[<span class="number">0</span>] <span class="comment">// è¯¥ä¸‹æ ‡è¾“å‡º 3</span></span><br><span class="line"><span class="number">_</span> = stack.<span class="built_in">count</span>()</span><br><span class="line">stack.showList()</span><br><span class="line">stack.remove()</span><br><span class="line">stack.showList()</span><br><span class="line">stack.remove()</span><br><span class="line">stack.showList()</span><br><span class="line">stack.remove()</span><br><span class="line">stack.showList()</span><br><span class="line"><span class="number">_</span> = stack.<span class="built_in">count</span>()</span><br></pre></td></tr></table></figure><p>è¿™ä¸€æ®µä»£ç ç‰‡æ®µåœ¨æ§åˆ¶å°è¾“å‡ºå¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Bob</span><br><span class="line"></span><br><span class="line">Bob 1</span><br><span class="line"></span><br><span class="line">Bob 1 3.0</span><br><span class="line"></span><br><span class="line">1 3.0</span><br><span class="line"></span><br><span class="line">3.0</span><br><span class="line"></span><br><span class="line">EMPTY</span><br><span class="line"></span><br><span class="line">Bob</span><br><span class="line"></span><br><span class="line">1 Bob</span><br><span class="line"></span><br><span class="line">3.0 1 Bob</span><br><span class="line"></span><br><span class="line">1 Bob</span><br><span class="line"></span><br><span class="line">Bob</span><br><span class="line"></span><br><span class="line">EMPTY</span><br></pre></td></tr></table></figure><h2 id="æˆ‘æ²¡æœ‰-100-ä½¿ç”¨-POP"><a href="#æˆ‘æ²¡æœ‰-100-ä½¿ç”¨-POP" class="headerlink" title="æˆ‘æ²¡æœ‰ 100% ä½¿ç”¨ POP"></a>æˆ‘æ²¡æœ‰ 100% ä½¿ç”¨ POP</h2><p>åœ¨ WWDC æœ‰å…³ POP çš„è§†é¢‘ä¹‹ä¸€ä¸­ï¼Œä¸€ä½å·¥ç¨‹å¸ˆ/è®²å¸ˆè¯´ <a href="https://developer.apple.com/videos/play/wwdc2015-408/?time=882" target="_blank" rel="noopener">â€åœ¨ Swift ä¸­æˆ‘ä»¬æœ‰ä¸€ç§è¯´æ³•ï¼Œä¸è¦ä»ä¸€ä¸ªç±»å¼€å§‹å†™ä»£ç ï¼Œä»ä¸€ä¸ªåè®®å¼€å§‹â€œ</a>ã€‚å˜›~ä¹Ÿè®¸å§ã€‚è¿™å®¶ä¼™å¼€å§‹äº†æœ‰å…³å¦‚ä½•ä½¿ç”¨åè®®æ¥å†™ä¸€ä¸ªäºŒåˆ†æŸ¥æ‰¾çš„å†—é•¿çš„è®¨è®ºã€‚æˆ‘æœ‰ç‚¹æ€€ç–‘ï¼Œè¿™æ˜¯ä¸æ˜¯æˆ‘è®¸å¤šè¯»è€…å°è±¡æœ€æ·±çš„éƒ¨åˆ†ã€‚çœ‹å®Œä½ å¤±çœ äº†å—ï¼Ÿ</p><p>è¿™æœ‰ç‚¹åƒæ˜¯ä¸ºäº†å¯»æ‰¾ä¸€ä¸ª POP è§£å†³æ–¹æ¡ˆè€Œäººä¸ºè®¾è®¡å‡ºçš„ä¸€ä¸ªé—®é¢˜ã€‚ä¹Ÿè®¸é—®é¢˜æ˜¯å®é™…çš„ï¼Œä¹Ÿè®¸è¿™ç§è§£å†³æ–¹æ¡ˆæœ‰ä¼˜ç‚¹ï¼Œæˆ‘ä¹Ÿä¸çŸ¥é“ã€‚æˆ‘çš„æ—¶é—´å¾ˆå®è´µï¼Œæ²¡æœ‰æ—¶é—´æµªè´¹åœ¨è¿™ç§è±¡ç‰™å¡”ç†è®ºä¸Šã€‚å¦‚æœè¯»æ‡‚ä¸€æ®µä»£ç éœ€è¦è¶…è¿‡ 5 åˆ†é’Ÿçš„æ—¶é—´ï¼Œæˆ‘å°±è§‰å¾—è¿™æ®µä»£ç è¿èƒŒäº† Apple çš„ â€local reasoningâ€œ åŸåˆ™ã€‚</p><p>å¦‚æœä½ å’Œæˆ‘ä¸€æ ·ä¹Ÿæ˜¯ä¸€ä¸ªè½¯ä»¶å¼€å‘è€…ï¼Œæœ€å¥½å§‹ç»ˆå¯¹æ–°çš„æ–¹æ³•è®ºä¿æŒä¸€ä¸ªå¼€æ”¾çš„å¿ƒæ€ï¼Œå¹¶ä¸”å§‹ç»ˆå°†æ§åˆ¶å¤æ‚åº¦ä½œä¸ºä½ çš„ä¸»è¦å·¥ä½œé‡å¿ƒã€‚æˆ‘ç»ä¸åå¯¹èµšé’±ï¼Œä½†çœ‹å¾—æ›´é«˜æ›´è¿œä¸€ç‚¹æ˜¯æœ‰å¥½å¤„çš„ã€‚è®°ä½ï¼ŒApple æ˜¯ä¸€å®¶å…¬å¸ï¼Œä¸€å®¶å¤§å…¬å¸ï¼Œä¸»è¦ä½¿å‘½æ˜¯èµšå¤§é’±ï¼Œä¸Šå‘¨äº”çš„å¸‚å€¼å·²ç»æ¥è¿‘ 8370 äº¿ç¾å…ƒï¼Œæ‹¥æœ‰æ•°åƒäº¿çš„ç°é‡‘å’Œç°é‡‘ç­‰ä»·ç‰©ã€‚ä»–ä»¬æƒ³è®©æ¯ä¸ªäººéƒ½ä½¿ç”¨ Swiftï¼Œè€Œè¿™äº›å…¬å¸å¸å¼•äººåˆ°è‡ªå®¶ç”Ÿæ€ç³»ç»Ÿçš„æ–¹æ³•ä¹‹ä¸€å°±æ˜¯æä¾›åˆ«äººéƒ½æä¾›ä¸äº†çš„äº§å“å’ŒæœåŠ¡ã€‚æ˜¯çš„ï¼Œ<a href="https://developer.apple.com/swift/blog/?id=34" target="_blank" rel="noopener">Swift æ˜¯å¼€æºçš„</a>ï¼Œä½† Apple ä» App Store èµšäº†å¤§é’±ï¼Œå› æ­¤åº”ç”¨æ­£æ˜¯è®©æ‰€æœ‰ Apple è®¾å¤‡å˜å¾—æœ‰ç”¨çš„å…³é”®ï¼Œè®¸è®¸å¤šå¤šçš„å¼€å‘è€…æ­£åœ¨å‘ Swift è¿ç§»ã€‚</p><p>æˆ‘è§‰å¾—æ²¡æœ‰ä»»ä½•ç†ç”±åªç”¨ POP è¿›è¡Œç¼–ç¨‹ã€‚æˆ‘è®¤ä¸º POP å’Œæˆ‘ä½¿ç”¨çš„å…¶ä»–è®¸å¤šæŠ€æœ¯ï¼Œç”šè‡³æ˜¯ OOP ä¸€æ ·ï¼Œéƒ½æœ‰ä¸€äº›é—®é¢˜ã€‚æˆ‘ä»¬æ˜¯åœ¨å¯¹ç°å®å»ºæ¨¡ï¼Œæˆ–è€…è‡³å°‘è¯´ï¼Œæˆ‘ä»¬æ˜¯åœ¨å¯¹ç°å®è¿›è¡Œæ‹Ÿåˆã€‚æ²¡æœ‰å®Œç¾çš„è§£å†³æ–¹æ¡ˆã€‚æ‰€ä»¥ï¼Œå°† POP ä½œä¸ºä½ çš„å¼€å‘å·¥å…·ç®±ä¸­çš„ä¸€ç§å§ï¼Œå°±åƒäººä»¬é•¿å¹´ä»¥æ¥æ€»ç»“å‡ºçš„å…¶ä»–ä¼˜ç§€çš„æ–¹æ¡ˆä¸€æ ·ã€‚</p><h2 id="ç»“è®º"><a href="#ç»“è®º" class="headerlink" title="ç»“è®º"></a>ç»“è®º</h2><p>30 å¹´çš„å¼€å‘ç»éªŒï¼Œè®©æˆ‘èƒ½å¤Ÿå¹³å¿ƒé™æ°”åœ°è¯´ï¼Œ<strong>ä½ åº”è¯¥äº†è§£åè®®å’Œ POPã€‚</strong>å¼€å§‹è®¾è®¡å¹¶ä¹¦å†™ä½ è‡ªå·±çš„ POP ä»£ç å§ã€‚</p><p>æˆ‘å·²ç»èŠ±è´¹äº†ä¸å°‘æ—¶é—´è¯•ç”¨ POPï¼Œå¹¶ä¸”å·²ç»å°†è¿™ç¯‡æ–‡ç« ä¸­çš„åè®®ä½¿ç”¨åœ¨äº†æˆ‘è‡ªå·±çš„åº”ç”¨ä¸­ï¼Œæ¯”å¦‚ <code>SimpleViewWithBorder</code>ï¼Œ<code>ViewWithBackground</code>ï¼Œ<code>ViewWithBorder</code>ï¼Œ<code>List</code>ï¼Œ<code>FIFO</code>ï¼Œ<code>LIFO</code>ã€‚POP å¨åŠ›æ— ç©·ã€‚</p><p>æ­£å¦‚æˆ‘åœ¨å‰ä¸€ç¯‡æ–‡ç« ä¸­æåˆ°çš„ï¼Œå­¦ä¹ å¹¶æ¥å—ä¸€ç§æ–°æ–¹æ³•ï¼Œæ¯”å¦‚ POPï¼Œå¹¶ä¸æ˜¯ä¸€ä¸ªéå¯¹å³é”™çš„äº‹æƒ…ã€‚POP å’Œ OOP ä¸ä»…èƒ½å¹¶å­˜ï¼Œè¿˜èƒ½å¤Ÿäº’ç›¸è¡¥å……ã€‚</p><p>æ‰€ä»¥ï¼Œå¼€å§‹è¯•éªŒã€ç»ƒä¹ ã€å­¦ä¹ å§ã€‚æœ€åï¼Œå°½æƒ…äº«å—ç”Ÿæ´»å’Œå·¥ä½œå§ã€‚</p><blockquote><p>æœ¬æ–‡ç”± SwiftGG ç¿»è¯‘ç»„ç¿»è¯‘ï¼Œå·²ç»è·å¾—ä½œè€…ç¿»è¯‘æˆæƒï¼Œæœ€æ–°æ–‡ç« è¯·è®¿é—® <a href="http://swift.gg">http://swift.gg</a>ã€‚</p></blockquote>]]></content>
    
    <summary type="html">
    
      æœ¬æ–‡ä»‹ç»äº†é¢å‘åè®®ç¼–ç¨‹çš„ä¼˜ç¼ºç‚¹ï¼Œä»¥åŠä¸é¢å‘å¯¹è±¡ç¼–ç¨‹çš„å¯¹æ¯”ã€‚
    
    </summary>
    
      <category term="appcoda" scheme="https://swift.gg/categories/appcoda/"/>
    
    
      <category term="Swift" scheme="https://swift.gg/tags/Swift/"/>
    
  </entry>
  
  <entry>
    <title>Swift ä¸­çš„è®¾è®¡æ¨¡å¼ #3 å¤–è§‚æ¨¡å¼ä¸é€‚é…å™¨æ¨¡å¼</title>
    <link href="https://swift.gg/2018/11/29/design-pattern-structural/"/>
    <id>https://swift.gg/2018/11/29/design-pattern-structural/</id>
    <published>2018-11-29T00:00:00.000Z</published>
    <updated>2019-02-19T03:45:13.515Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ä½œè€…ï¼šAndrew Jaffeeï¼Œ<a href="https://www.appcoda.com/design-pattern-structural/" target="_blank" rel="noopener">åŸæ–‡é“¾æ¥</a>ï¼ŒåŸæ–‡æ—¥æœŸï¼š2018-09-04<br>è¯‘è€…ï¼š<a href="https://www.jianshu.com/u/076cc5e18bb8" target="_blank" rel="noopener">éƒ‘ä¸€ä¸€</a>ï¼›æ ¡å¯¹ï¼š<a href="https://bignerdcoding.com/" target="_blank" rel="noopener">BigNerdCoding</a>ï¼Œ<a href="http://www.jianshu.com/users/596f2ba91ce9/latest_articles" target="_blank" rel="noopener">pmst</a>ï¼Œ<a href="http://forelax.space" target="_blank" rel="noopener">Forelax</a>ï¼›å®šç¨¿ï¼š<a href="http://forelax.space" target="_blank" rel="noopener">Forelax</a></p></blockquote><!--æ­¤å¤„å¼€å§‹æ­£æ–‡--><p>æœ¬æ–‡æ˜¯æˆ‘çš„è®¾è®¡æ¨¡å¼ç³»åˆ—æ•™ç¨‹çš„ç¬¬ä¸‰ç¯‡ã€‚åœ¨ç¬¬ä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»‹ç»äº† <a href="https://swift.gg/2018/09/10/design-pattern-creational/"><strong>åˆ›å»ºå‹æ¨¡å¼</strong>ä¸­çš„<em>å·¥å‚æ¨¡å¼</em>å’Œ<em>å•ä¾‹æ¨¡å¼</em></a>ã€‚åœ¨ç¬¬äºŒç¯‡æ–‡ç« ä¸­ï¼Œåˆè®¨è®ºäº†ä¸€ä¸‹ <a href="https://swift.gg/2018/11/26/design-pattern-behavorial/"><strong>è¡Œä¸ºå‹æ¨¡å¼</strong>ä¸­çš„<em>è§‚å¯Ÿè€…æ¨¡å¼</em>å’Œ<em>å¤‡å¿˜å½•æ¨¡å¼</em></a>ã€‚</p><a id="more"></a><p>åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä¼šå°±ç»“æ„å‹æ¨¡å¼ä¸­çš„<strong>å¤–è§‚æ¨¡å¼</strong>å’Œ<strong>é€‚é…å™¨æ¨¡å¼</strong>åˆ†åˆ«ä¸¾ä¸€ä¸ªä¾‹å­ã€‚é¦–å…ˆï¼Œæˆ‘å»ºè®®ä½ å…ˆå»é˜…è¯»å‰é¢æåˆ°çš„ä¸¤ç¯‡æ–‡ç« ï¼Œè¿™ä¼šæœ‰åŠ©äºä½ æ›´ç†Ÿæ‚‰è½¯ä»¶è®¾è®¡æ¨¡å¼çš„ä¸€äº›æ¦‚å¿µã€‚é™¤äº†ç®€çŸ­åœ°ä»‹ç»ä¸€ä¸‹è®¾è®¡æ¨¡å¼çš„ç»„æˆï¼Œæˆ‘ä¸ä¼šå†é‡å¤ä»‹ç»æ‰€æœ‰å…³äºè®¾è®¡æ¨¡å¼çš„æ¦‚å¿µäº†ã€‚å¦‚æœéœ€è¦äº†è§£ï¼Œéƒ½å¯ä»¥åœ¨å‰é¢å†™çš„ <a href="https://swift.gg/2018/09/10/design-pattern-creational/"><strong>ç¬¬ä¸€ç¯‡</strong></a>ã€ <a href="https://swift.gg/2018/11/26/design-pattern-behavorial/"><strong>ç¬¬äºŒç¯‡</strong></a> ä¸­æ‰¾åˆ°ã€‚</p><p>æ¥ä¸‹æ¥çš„å‡ èŠ‚ï¼Œæˆ‘ä»¬å…ˆæ¥ç®€å•å›é¡¾ä¸€ä¸‹è®¾è®¡æ¨¡å¼çš„é€šç”¨æ¦‚å¿µã€‚â€œGang of Fourâ€ (â€œGoFâ€) Erich Gammaï¼ŒRichard Helmï¼ŒRalph Johonsonï¼Œå’Œ John Vlissides åœ¨ä»–ä»¬â€œ<a href="https://smile.amazon.com/Design-Patterns-Object-Oriented-Addison-Wesley-Professional-ebook/dp/B000SEIBB8/" target="_blank" rel="noopener"><strong>è®¾è®¡æ¨¡å¼ï¼šé¢å‘å¯¹è±¡è½¯ä»¶è®¾è®¡å¤ç”¨çš„åŸºæœ¬åŸç†</strong></a>â€çš„é‡è¦è‘—ä½œé‡Œæ•´ç†äº† 23 ç§ç»å…¸çš„è®¾è®¡æ¨¡å¼ã€‚ä»Šå¤©æˆ‘ä»¬é‡ç‚¹å…³æ³¨çš„æ˜¯ä¸¤ç§ç»“æ„å‹è®¾è®¡æ¨¡å¼ï¼š<strong>å¤–è§‚æ¨¡å¼</strong>å’Œ<strong>é€‚é…å™¨æ¨¡å¼</strong>ã€‚</p><h2 id="å€¼è¯­ä¹‰çš„é¢å‘åè®®ç¼–ç¨‹"><a href="#å€¼è¯­ä¹‰çš„é¢å‘åè®®ç¼–ç¨‹" class="headerlink" title="å€¼è¯­ä¹‰çš„é¢å‘åè®®ç¼–ç¨‹"></a>å€¼è¯­ä¹‰çš„é¢å‘åè®®ç¼–ç¨‹</h2><p>ä½ å¯èƒ½ä¼šå‘ç°ä¸–é¢ä¸Šéå¸¸å¤šè®¾è®¡æ¨¡å¼æ•™ç¨‹çš„ç¤ºä¾‹ä»£ç ï¼Œä»ç„¶æ˜¯åŸºäºé¢å‘å¯¹è±¡ç¼–ç¨‹åŸåˆ™ï¼ˆOOPï¼‰ã€å¼•ç”¨è¯­ä¹‰å’Œ <a href="http://iosbrain.com/blog/2018/06/07/swift-4-memory-management-via-arc-for-reference-types-classes/" target="_blank" rel="noopener"><strong>å¼•ç”¨ç±»å‹</strong></a>ï¼ˆclassesï¼‰ç¼–å†™çš„ã€‚æ‰€ä»¥ï¼Œæˆ‘å†³å®šç¼–å†™ä¸€å¥—åŸºäº <a href="https://www.appcoda.com/pop-vs-oop/" target="_blank" rel="noopener"><strong>é¢å‘åè®®ç¼–ç¨‹åŸåˆ™</strong></a>ï¼ˆPOPï¼‰ã€å€¼è¯­ä¹‰å’Œ <a href="https://developer.apple.com/videos/play/wwdc2015/414/" target="_blank" rel="noopener"><strong>å€¼ç±»å‹</strong></a>ï¼ˆstructsï¼‰çš„è®¾è®¡æ¨¡å¼ç³»åˆ—æ•™ç¨‹ã€‚å¦‚æœä½ å·²ç»çœ‹è¿‡äº†æˆ‘ä¹‹å‰å†™çš„ä¸¤ç¯‡æ–‡ç« ï¼Œæˆ‘å¸Œæœ›ä½ è¿˜èƒ½å¤Ÿç†Ÿæ‚‰ä¸€ä¸‹ OOP å’Œ POPï¼Œå¼•ç”¨è¯­ä¹‰å’Œå€¼è¯­ä¹‰è¿™äº›æ¦‚å¿µã€‚å¦‚æœä½ è¿˜ä¸æ˜¯ç‰¹åˆ«ç†Ÿæ‚‰ï¼Œæˆ‘å¼ºçƒˆå»ºè®®èµ¶ç´§å»äº†è§£ä¸€ä¸‹è¿™äº›ä¸»é¢˜ã€‚æœ¬æ–‡æ‰€ä¸¾çš„ä¾‹å­æ˜¯å…¨éƒ¨åŸºäº POP å’Œå€¼è¯­ä¹‰çš„ã€‚</p><h2 id="è®¾è®¡æ¨¡å¼"><a href="#è®¾è®¡æ¨¡å¼" class="headerlink" title="è®¾è®¡æ¨¡å¼"></a>è®¾è®¡æ¨¡å¼</h2><p>è®¾è®¡æ¨¡å¼æ˜¯å¼€å‘è€…ç”¨äºç®¡ç†è½¯ä»¶å¤æ‚æ€§æå…¶é‡è¦çš„å·¥å…·ã€‚ä½œä¸ºå¸¸è§çš„æ¨¡æ¿æŠ€æœ¯ï¼Œå®ƒå¾ˆå¥½åœ°å¯¹è½¯ä»¶ä¸­ç±»ä¼¼çš„ã€é‡å¤å‡ºç°çš„ã€å®¹æ˜“è¯†åˆ«çš„é—®é¢˜è¿›è¡Œäº†æ¦‚å¿µåŒ–æŠ½è±¡ã€‚æˆ‘ä»¬å¯ä»¥å°†å®ƒè§†ä½œæœ€ä½³å®è·µï¼Œä»è€Œåº”ç”¨åˆ°æ—¥å¸¸ä¸­ä¼šé‡åˆ°çš„é‚£äº›ç¼–ç¨‹åœºæ™¯ä¸­ã€‚ä¸¾ä¸€ä¸ªå…·ä½“çš„ä¾‹å­ï¼Œå›æƒ³ä¸€ä¸‹ä½ åœ¨å¹³å¸¸å†™ä»£ç è¿‡ç¨‹ä¸­æœ‰å¤šå°‘æ¬¡ä¼šä½¿ç”¨æˆ–å†™äº†éµå®ˆ <a href="https://www.appcoda.com/design-pattern-behavorial/" target="_blank" rel="noopener"><strong>è§‚å¯Ÿè€…è®¾è®¡æ¨¡å¼</strong></a> çš„ä»£ç å§ã€‚</p><p>åœ¨è§‚å¯Ÿè€…æ¨¡å¼ä¸­ï¼Œè¢«è§‚å¯Ÿè€…ï¼ˆä¸€èˆ¬æ¥è¯´æ˜¯ä¸€ä¸ªå…³é”®èµ„æºï¼‰ä¼šç»™æ‰€æœ‰ä¾èµ–äºè‡ªå·±çš„è§‚å¯Ÿè€…ï¼Œå¹¿æ’­é€šçŸ¥å…¶å†…éƒ¨çŠ¶æ€çš„å˜åŒ–ã€‚è§‚å¯Ÿè€…å¿…é¡»å‘ŠçŸ¥è¢«è§‚å¯Ÿè€…è‡ªå·±æƒ³æ¥æ”¶é€šçŸ¥ï¼Œæ¢å¥è¯è¯´ï¼Œè§‚å¯Ÿè€…å¿…é¡»è®¢é˜…é€šçŸ¥ã€‚ç”¨æˆ·æˆæƒçš„ iOS å¼¹çª—æ¨é€é€šçŸ¥ï¼Œå°±æ˜¯ä¸€ä¸ªå…¸å‹çš„è§‚å¯Ÿè€…æ¨¡å¼çš„ä¾‹å­ã€‚</p><h3 id="è®¾è®¡æ¨¡å¼çš„åˆ†ç±»"><a href="#è®¾è®¡æ¨¡å¼çš„åˆ†ç±»" class="headerlink" title="è®¾è®¡æ¨¡å¼çš„åˆ†ç±»"></a>è®¾è®¡æ¨¡å¼çš„åˆ†ç±»</h3><p>GoF å°† 23 ç§è®¾è®¡æ¨¡å¼å½’çº³ä¸ºä¸‰ç§ç±»å‹ï¼Œåˆ†åˆ«æ˜¯â€œ<a href="https://www.appcoda.com/design-pattern-creational/" target="_blank" rel="noopener"><strong>åˆ›å»ºå‹</strong></a>â€ã€â€œ<a href="https://www.appcoda.com/design-pattern-behavorial/" target="_blank" rel="noopener"><strong>è¡Œä¸ºå‹</strong></a>â€ã€â€œç»“æ„å‹â€ã€‚æœ¬æ–‡ä¼šä»‹ç»ä¸¤ç§<strong>ç»“æ„å‹</strong>è®¾è®¡æ¨¡å¼ã€‚å…ˆçœ‹ä¸€ä¸‹ç»“æ„è¿™ä¸ªè¯çš„å®šä¹‰ï¼š</p><blockquote><p>â€œä»¥ä¸€ç§ç¡®å®šæ–¹å¼æ„å»ºçš„äº‹ç‰©ä»¥åŠå®ä½“ä¸­å„éƒ¨åˆ†å…ƒç´ ä¹‹é—´ä¸åŒå…³ç³»çš„æ±‡æ€»ã€‚â€<br>- <a href="https://www.merriam-webster.com/dictionary/structure" target="_blank" rel="noopener">https://www.merriam-webster.com/dictionary/structure</a></p></blockquote><p>ç»“æ„å‹è®¾è®¡æ¨¡å¼çš„ä¸»è¦ä½œç”¨æ˜¯æ˜ç¡®ä¸€æ®µä»£ç çš„åŠŸèƒ½ï¼Œå¹¶è¯´æ˜å¦‚ä½•ä½¿ç”¨ã€‚å¤§éƒ¨åˆ†çš„ç»“æ„å‹è®¾è®¡æ¨¡å¼å¯ä»¥é€šè¿‡ç¼–å†™æ˜“è¯»æ¥å£ï¼Œæ¥å®ç°å¯¹ä¸€æ®µä»£ç çš„ç®€åŒ–ä½¿ç”¨ã€‚å› ä¸ºä¸€æ®µä»£ç åŠ¿å¿…è¦ä¸å…¶å®ƒä»£ç è”ç³»ï¼Œå¦‚æœè¦ä¸ºä»£ç æ®µç¼–å†™å‡ºè‰¯å¥½çš„æ¥å£ï¼Œå¿…é¡»æ˜ç¡®æ¸…æ™°åœ°å®šä¹‰ä»£ç ä¹‹é—´çš„å„ç§å…³ç³»ã€‚</p><h2 id="å¤–è§‚è®¾è®¡æ¨¡å¼"><a href="#å¤–è§‚è®¾è®¡æ¨¡å¼" class="headerlink" title="å¤–è§‚è®¾è®¡æ¨¡å¼"></a><em>å¤–è§‚</em>è®¾è®¡æ¨¡å¼</h2><blockquote><p>â€œå¤–è§‚å¯ä»¥å®šä¹‰ä¸ºç‰¹æ®Šç»“æ„åŒ–çš„å»ºç­‘ç‰©è¡¨é¢æˆ–è€…é”™è¯¯çš„ã€è¡¨é¢ä¸Šçš„ã€äººä¸ºçš„å¤–å½¢æˆ–æ•ˆæœâ€ã€‚<br>- <a href="https://www.merriam-webster.com/dictionary/facade" target="_blank" rel="noopener">https://www.merriam-webster.com/dictionary/facade</a></p></blockquote><p>å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œå¯ä»¥ä½¿ç”¨å¤–è§‚æ¨¡å¼ï¼Œä¸ºä¸€ç»„å¤æ‚æ¥å£åˆ›å»ºä¸€ä¸ªç®€å•æ¥å£ã€‚æˆ–è®¸ä½ å·²ç»å†™è¿‡â€œå°è£…â€ä»£ç ã€‚â€œå°è£…â€çš„æ„æ€å°±æ˜¯å¯¹ä¸€æ®µå¤æ‚ä»£ç çš„ç®€åŒ–ä½¿ç”¨ã€‚</p><h3 id="å¤–è§‚è®¾è®¡æ¨¡å¼çš„ç¤ºä¾‹-app"><a href="#å¤–è§‚è®¾è®¡æ¨¡å¼çš„ç¤ºä¾‹-app" class="headerlink" title="å¤–è§‚è®¾è®¡æ¨¡å¼çš„ç¤ºä¾‹ app"></a><em>å¤–è§‚</em>è®¾è®¡æ¨¡å¼çš„ç¤ºä¾‹ app</h3><p>å¤–è§‚è®¾è®¡æ¨¡å¼ç¤ºä¾‹çš„ playground æ–‡ä»¶ï¼Œå¯ä»¥åœ¨ <a href="https://github.com/appcoda/swift-design-patterns/tree/master/Facade" target="_blank" rel="noopener"><strong>GitHub</strong></a> æ‰¾åˆ°ã€‚åœ¨è¿™ä¸ªä¾‹å­é‡Œå±•ç¤ºäº†ï¼Œå¦‚ä½•é€šè¿‡å¤–è§‚è®¾è®¡æ¨¡å¼ï¼Œæ¥ä¸ºæ²™ç›’æ–‡ä»¶ç³»ç»Ÿåˆ›å»ºä¸€ä¸ªç®€å•çš„æ¥å£ï¼Œä¾›æ‰€æœ‰çš„ iOS app ä½¿ç”¨ã€‚iOS æ–‡ä»¶ç³»ç»Ÿæ˜¯ä¸€ä¸ªåºå¤§çš„æ“ä½œç³»ç»Ÿå­ç³»ç»Ÿï¼ŒåŠŸèƒ½åŒ…æ‹¬åˆ›å»ºã€è¯»å–ã€åˆ é™¤ã€ç§»åŠ¨ã€é‡å‘½åã€æ‹·è´æ–‡ä»¶å’Œç›®å½•ã€‚å…è®¸è·å–å’Œè®¾ç½®æ–‡ä»¶å’Œç›®å½•çš„å…ƒæ•°æ®ï¼Œæ¯”å¦‚åˆ—å‡ºåœ¨æŒ‡å®šç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶ã€‚å…è®¸æŸ¥çœ‹æ–‡ä»¶å’Œç›®å½•çš„çŠ¶æ€ï¼Œæ¯”å¦‚æŸä¸ªæŒ‡å®šæ–‡ä»¶æ˜¯å¦å¯å†™ã€‚æä¾›è‹¹æœæ¨èã€é¢„å®šä¹‰çš„ç›®å½•åã€‚å®é™…ä¸Šå…¶åŒ…å«çš„åŠŸèƒ½è¿œè¿œä¸æ­¢ä¸Šé¢æåˆ°çš„è¿™äº›ã€‚</p><p>ç”±äº iOS æ–‡ä»¶ç³»ç»Ÿæ˜¯ä¸€ä¸ªæ‹¥æœ‰å¦‚æ­¤å¤šç‰¹æ€§å’ŒåŠŸèƒ½çš„å®å¤§ä¸»é¢˜ï¼Œå› æ­¤ä¹Ÿæ˜¯ä¸€ä¸ªéå¸¸å¥½çš„ä¾‹å­ï¼Œç”¨æ¥è®²è§£å¦‚ä½•é€šè¿‡å¤–è§‚è®¾è®¡æ¨¡å¼æ¥ç®€åŒ–ä»£ç çš„ä½¿ç”¨ã€‚å¤–è§‚æ¥å£ä¼šåºŸå¼ƒæ‰æ— å…³åŠŸèƒ½å’Œæ‚ä¹±ä»£ç çš„éƒ¨åˆ†ã€‚å¦ä¸€æ–¹é¢ï¼Œå¤–è§‚æ¥å£åªä¼šå®šä¹‰åœ¨æŸä¸ªå…·ä½“ app éœ€è¦ä½¿ç”¨åˆ°çš„åŠŸèƒ½ã€‚æˆ–è€…åœ¨æˆ‘çš„ä¾‹å­ä¸­ï¼Œæˆ‘å°†åŠŸèƒ½ç¼©å‡åˆ°åªæœ‰ç»å¸¸ä½¿ç”¨çš„é‚£éƒ¨åˆ†ã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯ä¿è¯ä»£ç åœ¨ä¸åŒ app ä¸­éƒ½æ˜¯å¯å¤ç”¨ã€å¯æ‰©å±•ï¼Œå¯ç»´æŠ¤çš„ã€‚</p><p>åŸºäºé¢å‘åè®®ç¼–ç¨‹å’Œå€¼è¯­ä¹‰ï¼Œæˆ‘å°† iOS æ–‡ä»¶ç³»ç»Ÿçš„ä¸»è¦ç‰¹æ€§è¿›è¡Œäº†åˆ’åˆ†ï¼Œä»è€Œå°†å…¶å˜æˆå¯å¤ç”¨ã€å¯æ‰©å±•çš„å•å…ƒï¼šåè®®å’Œåè®®æ‰©å±•ã€‚</p><p>æˆ‘<a href="http://iosbrain.com/blog/2018/04/22/ios-file-management-with-filemanager-in-protocol-oriented-swift-4/" target="_blank" rel="noopener"><strong>å°†å››ä¸ªåè®®ç»„åˆæˆä¸€ä¸ªç»“æ„ä½“ï¼Œè¿™ä¸ªç»“æ„ä½“ä»£è¡¨äº†å¯ä»¥åœ¨æ‰€æœ‰ iOS åº”ç”¨ä¸­ä½¿ç”¨çš„æ²™ç›’ iOS ç›®å½•</strong></a>ï¼ˆè¿˜å¯ä»¥çœ‹ <a href="http://iosbrain.com/blog/2018/05/29/the-ios-file-system-in-depth/" target="_blank" rel="noopener"><strong>è¿™ç¯‡æ–‡ç« </strong></a>ï¼‰ã€‚å› ä¸ºæœªæ¥ä½ è‚¯å®šä¼šæ›´å¤šæ¥è§¦åˆ°æ›´å¤šé¢å‘åè®®ç¼–ç¨‹å’Œå€¼è¯­ä¹‰ç›¸å…³çš„ä¸»é¢˜ï¼Œè¦æ³¨æ„æœ¯è¯­ <strong>composed</strong> å’Œ <strong>composition</strong> åœ¨è¿™é‡Œå±äºåŒä¹‰è¯ã€‚</p><p>é™¤æ­¤ä¹‹å¤–ï¼Œä¸ºäº†è®©ä½ æ›´ä¸“æ³¨äºç†è§£å¤–è§‚è®¾è®¡æ¨¡å¼çš„ä½¿ç”¨ï¼Œåœ¨åé¢çš„ä»£ç ä¸­ï¼Œæˆ‘çœç•¥äº† Swift é”™è¯¯å¤„ç†å’Œé€šç”¨é”™è¯¯æ£€æŸ¥çš„ä»£ç ã€‚</p><h3 id="å¤–è§‚è®¾è®¡æ¨¡å¼çš„ç¤ºä¾‹ä»£ç "><a href="#å¤–è§‚è®¾è®¡æ¨¡å¼çš„ç¤ºä¾‹ä»£ç " class="headerlink" title="å¤–è§‚è®¾è®¡æ¨¡å¼çš„ç¤ºä¾‹ä»£ç "></a>å¤–è§‚è®¾è®¡æ¨¡å¼çš„ç¤ºä¾‹ä»£ç </h3><p>æ¥ä¸‹æ¥å°±çœ‹çœ‹æˆ‘çš„ä»£ç å§ã€‚å…ˆç¡®ä¿å·²ç»ä¸‹è½½äº†æˆ‘åœ¨ <a href="https://github.com/appcoda/swift-design-patterns/tree/master/Facade" target="_blank" rel="noopener"><strong>GitHub</strong></a> ä¸Šçš„ playground æ–‡ä»¶ã€‚ä¸‹é¢æ˜¯è‹¹æœå®˜æ–¹æ¨èçš„ç”¨äºæ–‡ä»¶ç³»ç»Ÿæ“ä½œçš„é¢„å®šä¹‰ç›®å½•ã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">AppDirectories</span> : <span class="title">String</span> </span>&#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="type">Documents</span> = <span class="string">"Documents"</span></span><br><span class="line">    <span class="keyword">case</span> <span class="type">Inbox</span> = <span class="string">"Inbox"</span></span><br><span class="line">    <span class="keyword">case</span> <span class="type">Library</span> = <span class="string">"Library"</span></span><br><span class="line">    <span class="keyword">case</span> <span class="type">Temp</span> = <span class="string">"tmp"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€šè¿‡å°†æ–‡ä»¶æ“ä½œé™å®šåœ¨ä¸Šè¿°ç›®å½•ä¸­ï¼Œé¿å…äº†å¤æ‚æ€§ï¼Œå¹¶éµå¾ªäº†äººæœºç•Œé¢æŒ‡å—çš„åŸåˆ™ã€‚</p><p>åœ¨æ¢ç©¶æ–‡ä»¶æ“ä½œçš„æ ¸å¿ƒä»£ç ä¹‹å‰ï¼Œå…ˆæ¥çœ‹çœ‹ä½¿ç”¨å¤–è§‚è®¾è®¡æ¨¡å¼æ‰€è®¾è®¡å‡ºæ¥çš„æ¥å£å§ã€‚æˆ‘åˆ›å»ºäº† <code>iOSAppFileSystemDirectory</code> ç»“æ„ä½“ï¼Œä½œä¸ºæ–‡ä»¶ç³»ç»Ÿå¸¸ç”¨åŠŸèƒ½çš„ç®€å•å¯è¯»æ¥å£ã€‚è¿™ä¸ªæ¥å£é€‚ç”¨äº <code>AppDirectories</code> æšä¸¾ä¸‹çš„æ‰€æœ‰ç›®å½•ã€‚äº‹å®ä¸Šï¼Œæˆ‘åŸæœ¬è¿˜å¯ä»¥åŠ å…¥è¯¸å¦‚ <a href="https://developer.apple.com/documentation/foundation/filemanager/1414652-createsymboliclink" target="_blank" rel="noopener"><strong>ç¬¦å·åŒ–é“¾æ¥çš„åˆ›å»º</strong></a>ï¼Œæˆ–è€…ä½¿ç”¨ <code>FileHandle</code> ç±»å®ç°å¯¹æ–‡ä»¶çš„ç²¾ç»†æ§åˆ¶ã€‚ä½†æ˜¯åœ¨å®é™…æƒ…å†µä¸­ï¼Œæˆ‘å‡ ä¹ä¸å¤ªä½¿ç”¨åˆ°è¿™äº›åŠŸèƒ½ï¼Œæ›´é‡è¦çš„ä¸€ç‚¹æ˜¯ï¼Œæˆ‘æƒ³è¦ä¿æŒä»£ç çš„ç®€æ´æ€§ã€‚</p><p>æˆ‘åˆ›å»ºäº†ç”±å››ä¸ªåè®®ç»„æˆçš„å¤–è§‚ã€‚ï¼ˆæˆ‘çŸ¥é“ä½ çœ‹åˆ°ä¸‹é¢çš„ä»£ç ä¸­åªéµå¾ªäº†ä¸‰ä¸ªåè®®ï¼Œè¿™å…¶å®æ˜¯å› ä¸ºå…¶ä¸­æœ‰ä¸€ä¸ªåè®®ç»§æ‰¿è‡ªå¦ä¸€ä¸ªåè®®ï¼‰ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">iOSAppFileSystemDirectory</span> : <span class="title">AppFileManipulation</span>, <span class="title">AppFileStatusChecking</span>, <span class="title">AppFileSystemMetaData</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> workingDirectory: <span class="type">AppDirectories</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">init</span>(using directory: <span class="type">AppDirectories</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.workingDirectory = directory</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">writeFile</span><span class="params">(containing text: String, withName name: String)</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> writeFile(containing: text, to: workingDirectory, withName: name)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">readFile</span><span class="params">(withName name: String)</span></span> -&gt; <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> readFile(at: workingDirectory, withName: name)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">deleteFile</span><span class="params">(withName name: String)</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> deleteFile(at: workingDirectory, withName: name)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">showAttributes</span><span class="params">(forFile named: String)</span></span> -&gt; <span class="type">Void</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> fullPath = buildFullPath(forFileName: named, inDirectory: workingDirectory)</span><br><span class="line">        <span class="keyword">let</span> fileAttributes = attributes(ofFile: fullPath)</span><br><span class="line">        <span class="keyword">for</span> attribute <span class="keyword">in</span> fileAttributes &#123;</span><br><span class="line">            <span class="built_in">print</span>(attribute)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">list</span><span class="params">()</span></span> &#123;</span><br><span class="line">        list(directory: getURL(<span class="keyword">for</span>: workingDirectory))</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125; <span class="comment">// å®Œæˆç»“æ„ä½“ iOSAppFileSystemDirectory çš„å®šä¹‰</span></span><br></pre></td></tr></table></figure><p>ä¸‹é¢æ˜¯ä¸€äº›ç”¨äºæµ‹è¯• <code>iOSAppFileSystemDirectory</code> ç»“æ„ä½“çš„ä»£ç ï¼š </p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> iOSDocumentsDirectory = iOSAppFileSystemDirectory(using: .<span class="type">Documents</span>)</span><br><span class="line"></span><br><span class="line">iOSDocumentsDirectory.writeFile(containing: <span class="string">"New file created."</span>, withName: <span class="string">"myFile3.txt"</span>)</span><br><span class="line">iOSDocumentsDirectory.list()</span><br><span class="line">iOSDocumentsDirectory.readFile(withName: <span class="string">"myFile3.txt"</span>)</span><br><span class="line">iOSDocumentsDirectory.showAttributes(forFile: <span class="string">"myFile3.txt"</span>)</span><br><span class="line">iOSDocumentsDirectory.deleteFile(withName: <span class="string">"myFile3.txt"</span>)</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥çš„ä»£ç æ˜¯åœ¨è¿è¡Œäº† playground æ–‡ä»¶ä¸­ä»£ç ä¹‹åçš„æ§åˆ¶å°è¾“å‡ºï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">----------------------------</span><br><span class="line">LISTING: /var/folders/5_/kd8__nv1139__dq_3nfvsmhh0000gp/T/com.apple.dt.Xcode.pg/containers/com.apple.dt.playground.stub.iOS_Simulator.Swift-Facade-Design-Pattern-1C4BD3E3-E23C-4991-A344-775D5585D1D7/Documents</span><br><span class="line"></span><br><span class="line">File: &quot;myFile3.txt&quot;</span><br><span class="line">File: &quot;Shared Playground Data&quot;</span><br><span class="line"></span><br><span class="line">----------------------------</span><br><span class="line"></span><br><span class="line">File created with contents: New file created.</span><br><span class="line"></span><br><span class="line">(key: __C.FileAttributeKey(_rawValue: NSFileType), value: NSFileTypeRegular)</span><br><span class="line">(key: __C.FileAttributeKey(_rawValue: NSFilePosixPermissions), value: 420)</span><br><span class="line">(key: __C.FileAttributeKey(_rawValue: NSFileSystemNumber), value: 16777223)</span><br><span class="line">(key: __C.FileAttributeKey(_rawValue: NSFileExtendedAttributes), value: &#123;</span><br><span class="line">    &quot;com.apple.quarantine&quot; = &lt;30303836 3b356238 36656364 373b5377 69667420 46616361 64652044 65736967 6e205061 74746572 6e3b&gt;;</span><br><span class="line">&#125;)</span><br><span class="line">(key: __C.FileAttributeKey(_rawValue: NSFileReferenceCount), value: 1)</span><br><span class="line">(key: __C.FileAttributeKey(_rawValue: NSFileSystemFileNumber), value: 24946094)</span><br><span class="line">(key: __C.FileAttributeKey(_rawValue: NSFileGroupOwnerAccountID), value: 20)</span><br><span class="line">(key: __C.FileAttributeKey(_rawValue: NSFileModificationDate), value: 2018-08-29 18:58:31 +0000)</span><br><span class="line">(key: __C.FileAttributeKey(_rawValue: NSFileCreationDate), value: 2018-08-29 18:58:31 +0000)</span><br><span class="line">(key: __C.FileAttributeKey(_rawValue: NSFileSize), value: 17)</span><br><span class="line">(key: __C.FileAttributeKey(_rawValue: NSFileExtensionHidden), value: 0)</span><br><span class="line">(key: __C.FileAttributeKey(_rawValue: NSFileOwnerAccountID), value: 502)</span><br><span class="line"></span><br><span class="line">File deleted.</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬æ¥ç®€å•è®¨è®ºä¸‹ <code>iOSAppFileSystemDirectory</code> ç»“æ„ä½“æ‰€éµå¾ªçš„å‡ ä¸ªåè®®ã€‚<code>AppDirectoryNames</code> åè®®å’Œæ‰©å±•å®šä¹‰å’Œå®ç°äº†ä»¥ <code>URL</code> ç±»å‹è·å– <code>AppDirectories</code> æšä¸¾ä¸­ç›®å½•å®Œæ•´è·¯å¾„çš„æ–¹æ³•ã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">AppDirectoryNames</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">documentsDirectoryURL</span><span class="params">()</span></span> -&gt; <span class="type">URL</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">inboxDirectoryURL</span><span class="params">()</span></span> -&gt; <span class="type">URL</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">libraryDirectoryURL</span><span class="params">()</span></span> -&gt; <span class="type">URL</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">tempDirectoryURL</span><span class="params">()</span></span> -&gt; <span class="type">URL</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">getURL</span><span class="params">(<span class="keyword">for</span> directory: AppDirectories)</span></span> -&gt; <span class="type">URL</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">buildFullPath</span><span class="params">(forFileName name: String, inDirectory directory: AppDirectories)</span></span> -&gt; <span class="type">URL</span></span><br><span class="line"></span><br><span class="line">&#125; <span class="comment">// end protocol AppDirectoryNames</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">AppDirectoryNames</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">documentsDirectoryURL</span><span class="params">()</span></span> -&gt; <span class="type">URL</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="type">FileManager</span>.<span class="keyword">default</span>.urls(<span class="keyword">for</span>: .documentDirectory, <span class="keyword">in</span>: .userDomainMask).first!</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">inboxDirectoryURL</span><span class="params">()</span></span> -&gt; <span class="type">URL</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="type">FileManager</span>.<span class="keyword">default</span>.urls(<span class="keyword">for</span>: .documentDirectory, <span class="keyword">in</span>: .userDomainMask)[<span class="number">0</span>].appendingPathComponent(<span class="type">AppDirectories</span>.<span class="type">Inbox</span>.rawValue) <span class="comment">// "Inbox")</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">libraryDirectoryURL</span><span class="params">()</span></span> -&gt; <span class="type">URL</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="type">FileManager</span>.<span class="keyword">default</span>.urls(<span class="keyword">for</span>: <span class="type">FileManager</span>.<span class="type">SearchPathDirectory</span>.libraryDirectory, <span class="keyword">in</span>: .userDomainMask).first!</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">tempDirectoryURL</span><span class="params">()</span></span> -&gt; <span class="type">URL</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="type">FileManager</span>.<span class="keyword">default</span>.temporaryDirectory</span><br><span class="line">        <span class="comment">//urls(for: .documentDirectory, in: .userDomainMask)[0].appendingPathComponent(AppDirectories.Temp.rawValue) //"tmp")</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">getURL</span><span class="params">(<span class="keyword">for</span> directory: AppDirectories)</span></span> -&gt; <span class="type">URL</span> &#123;</span><br><span class="line">        <span class="keyword">switch</span> directory &#123;</span><br><span class="line">        <span class="keyword">case</span> .<span class="type">Documents</span>:</span><br><span class="line">            <span class="keyword">return</span> documentsDirectoryURL()</span><br><span class="line">        <span class="keyword">case</span> .<span class="type">Inbox</span>:</span><br><span class="line">            <span class="keyword">return</span> inboxDirectoryURL()</span><br><span class="line">        <span class="keyword">case</span> .<span class="type">Library</span>:</span><br><span class="line">            <span class="keyword">return</span> libraryDirectoryURL()</span><br><span class="line">        <span class="keyword">case</span> .<span class="type">Temp</span>:</span><br><span class="line">            <span class="keyword">return</span> tempDirectoryURL()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">buildFullPath</span><span class="params">(forFileName name: String, inDirectory directory: AppDirectories)</span></span> -&gt; <span class="type">URL</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> getURL(<span class="keyword">for</span>: directory).appendingPathComponent(name)</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="comment">// end extension AppDirectoryNames</span></span><br></pre></td></tr></table></figure><p><code>AppFileStatusChecking</code> åè®®å’Œæ‰©å±•å°è£…äº†è·å–æ–‡ä»¶çŠ¶æ€æ•°æ®çš„æ–¹æ³•ã€‚è¿™äº›æ–‡ä»¶åŒæ ·å­˜å‚¨äº <code>AppDirectories</code> æšä¸¾å®šä¹‰ä¸‹çš„ç›®å½•ã€‚é€šè¿‡â€œçŠ¶æ€â€ï¼Œå¯ä»¥ç¡®å®šæŸä¸ªæ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œæ˜¯å¦å¯è¯»ç­‰ã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">AppFileStatusChecking</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">isWritable</span><span class="params">(file at: URL)</span></span> -&gt; <span class="type">Bool</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">isReadable</span><span class="params">(file at: URL)</span></span> -&gt; <span class="type">Bool</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">exists</span><span class="params">(file at: URL)</span></span> -&gt; <span class="type">Bool</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">AppFileStatusChecking</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">isWritable</span><span class="params">(file at: URL)</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> <span class="type">FileManager</span>.<span class="keyword">default</span>.isWritableFile(atPath: at.path) &#123;</span><br><span class="line">            <span class="built_in">print</span>(at.path)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">print</span>(at.path)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">isReadable</span><span class="params">(file at: URL)</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> <span class="type">FileManager</span>.<span class="keyword">default</span>.isReadableFile(atPath: at.path) &#123;</span><br><span class="line">            <span class="built_in">print</span>(at.path)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">print</span>(at.path)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">exists</span><span class="params">(file at: URL)</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> <span class="type">FileManager</span>.<span class="keyword">default</span>.fileExists(atPath: at.path) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="comment">// end extension AppFileStatusChecking</span></span><br></pre></td></tr></table></figure><p><code>AppFileSystemMetaData</code> åè®®å’Œæ‰©å±•å®ç°äº†åˆ—å‡ºç›®å½•å†…å®¹å’Œè·å–æ‰©å±•æ–‡ä»¶çš„åŠŸèƒ½ã€‚ å…¶ç›®å½•ä¹Ÿæ˜¯å®šä¹‰åœ¨ <code>AppDirectories</code> æšä¸¾ä¸‹ã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">AppFileSystemMetaData</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">list</span><span class="params">(directory at: URL)</span></span> -&gt; <span class="type">Bool</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">attributes</span><span class="params">(ofFile atFullPath: URL)</span></span> -&gt; [<span class="type">FileAttributeKey</span> : <span class="type">Any</span>]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">AppFileSystemMetaData</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">list</span><span class="params">(directory at: URL)</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> listing = <span class="keyword">try</span>! <span class="type">FileManager</span>.<span class="keyword">default</span>.contentsOfDirectory(atPath: at.path)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> listing.<span class="built_in">count</span> &gt; <span class="number">0</span> &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"\n----------------------------"</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"LISTING: <span class="subst">\(at.path)</span>"</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">""</span>)</span><br><span class="line">            <span class="keyword">for</span> file <span class="keyword">in</span> listing &#123;</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">"File: <span class="subst">\(file.debugDescription)</span>"</span>)</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">""</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"----------------------------\n"</span>)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">attributes</span><span class="params">(ofFile atFullPath: URL)</span></span> -&gt; [<span class="type">FileAttributeKey</span> : <span class="type">Any</span>] &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">try</span>! <span class="type">FileManager</span>.<span class="keyword">default</span>.attributesOfItem(atPath: atFullPath.path)</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="comment">//  end extension AppFileSystemMetaData</span></span><br></pre></td></tr></table></figure><p>æœ€åæ˜¯ <code>AppFileManipulation</code> åè®®å’Œæ‰©å±•ï¼Œå°è£…äº† <code>AppDirectories</code> æšä¸¾ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶æ“ä½œæ–¹æ³•ï¼ŒåŒ…æ‹¬äº†è¯»ã€å†™ã€åˆ é™¤ã€é‡å‘½åã€ç§»åŠ¨ã€æ‹·è´ä¿®æ”¹æ–‡ä»¶æ‰©å±•åç­‰ã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">AppFileManipulation</span> : <span class="title">AppDirectoryNames</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">writeFile</span><span class="params">(containing: String, to path: AppDirectories, withName name: String)</span></span> -&gt; <span class="type">Bool</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">readFile</span><span class="params">(at path: AppDirectories, withName name: String)</span></span> -&gt; <span class="type">String</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">deleteFile</span><span class="params">(at path: AppDirectories, withName name: String)</span></span> -&gt; <span class="type">Bool</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">renameFile</span><span class="params">(at path: AppDirectories, with oldName: String, to newName: String)</span></span> -&gt; <span class="type">Bool</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">moveFile</span><span class="params">(withName name: String, inDirectory: AppDirectories, toDirectory directory: AppDirectories)</span></span> -&gt; <span class="type">Bool</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">copyFile</span><span class="params">(withName name: String, inDirectory: AppDirectories, toDirectory directory: AppDirectories)</span></span> -&gt; <span class="type">Bool</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">changeFileExtension</span><span class="params">(withName name: String, inDirectory: AppDirectories, toNewExtension newExtension: String)</span></span> -&gt; <span class="type">Bool</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">AppFileManipulation</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">writeFile</span><span class="params">(containing: String, to path: AppDirectories, withName name: String)</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> filePath = getURL(<span class="keyword">for</span>: path).path + <span class="string">"/"</span> + name</span><br><span class="line">        <span class="keyword">let</span> rawData: <span class="type">Data</span>? = containing.data(using: .utf8)</span><br><span class="line">        <span class="keyword">return</span> <span class="type">FileManager</span>.<span class="keyword">default</span>.createFile(atPath: filePath, contents: rawData, attributes: <span class="literal">nil</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">readFile</span><span class="params">(at path: AppDirectories, withName name: String)</span></span> -&gt; <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> filePath = getURL(<span class="keyword">for</span>: path).path + <span class="string">"/"</span> + name</span><br><span class="line">        <span class="keyword">let</span> fileContents = <span class="type">FileManager</span>.<span class="keyword">default</span>.contents(atPath: filePath)</span><br><span class="line">        <span class="keyword">let</span> fileContentsAsString = <span class="type">String</span>(bytes: fileContents!, encoding: .utf8)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"File created with contents: <span class="subst">\(fileContentsAsString!)</span>\n"</span>)</span><br><span class="line">        <span class="keyword">return</span> fileContentsAsString!</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">deleteFile</span><span class="params">(at path: AppDirectories, withName name: String)</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> filePath = buildFullPath(forFileName: name, inDirectory: path)</span><br><span class="line">        <span class="keyword">try</span>! <span class="type">FileManager</span>.<span class="keyword">default</span>.removeItem(at: filePath)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"\nFile deleted.\n"</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">renameFile</span><span class="params">(at path: AppDirectories, with oldName: String, to newName: String)</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> oldPath = getURL(<span class="keyword">for</span>: path).appendingPathComponent(oldName)</span><br><span class="line">        <span class="keyword">let</span> newPath = getURL(<span class="keyword">for</span>: path).appendingPathComponent(newName)</span><br><span class="line">        <span class="keyword">try</span>! <span class="type">FileManager</span>.<span class="keyword">default</span>.moveItem(at: oldPath, to: newPath)</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// highlights the limitations of using return values</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">moveFile</span><span class="params">(withName name: String, inDirectory: AppDirectories, toDirectory directory: AppDirectories)</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> originURL = buildFullPath(forFileName: name, inDirectory: inDirectory)</span><br><span class="line">        <span class="keyword">let</span> destinationURL = buildFullPath(forFileName: name, inDirectory: directory)</span><br><span class="line">        <span class="comment">// warning: constant 'success' inferred to have type '()', which may be unexpected</span></span><br><span class="line">        <span class="comment">// *let success =*</span></span><br><span class="line">        <span class="keyword">try</span>! <span class="type">FileManager</span>.<span class="keyword">default</span>.moveItem(at: originURL, to: destinationURL)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">copyFile</span><span class="params">(withName name: String, inDirectory: AppDirectories, toDirectory directory: AppDirectories)</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> originURL = buildFullPath(forFileName: name, inDirectory: inDirectory)</span><br><span class="line">        <span class="keyword">let</span> destinationURL = buildFullPath(forFileName: name, inDirectory: directory)</span><br><span class="line">        <span class="keyword">try</span>! <span class="type">FileManager</span>.<span class="keyword">default</span>.copyItem(at: originURL, to: destinationURL)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">changeFileExtension</span><span class="params">(withName name: String, inDirectory: AppDirectories, toNewExtension newExtension: String)</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> newFileName = <span class="type">NSString</span>(string:name)</span><br><span class="line">        newFileName = newFileName.deletingPathExtension <span class="keyword">as</span> <span class="type">NSString</span></span><br><span class="line">        newFileName = (newFileName.appendingPathExtension(newExtension) <span class="keyword">as</span> <span class="type">NSString</span>?)!</span><br><span class="line">        <span class="keyword">let</span> finalFileName:<span class="type">String</span> =  <span class="type">String</span>(newFileName)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">let</span> originURL = buildFullPath(forFileName: name, inDirectory: inDirectory)</span><br><span class="line">        <span class="keyword">let</span> destinationURL = buildFullPath(forFileName: finalFileName, inDirectory: inDirectory)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span>! <span class="type">FileManager</span>.<span class="keyword">default</span>.moveItem(at: originURL, to: destinationURL)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="comment">// end extension AppFileManipulation</span></span><br></pre></td></tr></table></figure><h2 id="é€‚é…å™¨è®¾è®¡æ¨¡å¼"><a href="#é€‚é…å™¨è®¾è®¡æ¨¡å¼" class="headerlink" title="é€‚é…å™¨è®¾è®¡æ¨¡å¼"></a><em>é€‚é…å™¨</em>è®¾è®¡æ¨¡å¼</h2><blockquote><p>â€œé€‚é…â€çš„å«ä¹‰æ˜¯â€œé€šè¿‡ä¿®æ”¹è®©ä¸€ä¸ªäº‹ç‰©æ›´é€‚åˆï¼ˆç”¨äºæ–°ç”¨é€”ï¼‰ã€‚â€<br>- <a href="https://www.merriam-webster.com/dictionary/adapts" target="_blank" rel="noopener">https://www.merriam-webster.com/dictionary/adapts</a></p></blockquote><blockquote><p>â€œé€‚é…å™¨â€çš„å«ä¹‰æ˜¯â€œç”¨äºé€‚é…ä¸åœ¨åˆå§‹ä½¿ç”¨æ„å›¾èŒƒå›´å†…è®¾å¤‡çš„ä¸€ç§é™„åŠ è£…ç½®ã€‚â€<br>- <a href="https://www.merriam-webster.com/dictionary/adapter" target="_blank" rel="noopener">https://www.merriam-webster.com/dictionary/adapter</a></p></blockquote><p>é€‚é…å™¨è®¾è®¡æ¨¡å¼çš„ä½œç”¨æ˜¯åœ¨ä¸ä¿®æ”¹å·²æœ‰ä»£ç åº“ â€œAâ€ çš„å‰æä¸‹ï¼Œä»æ—§å¯ä»¥ä½¿ç”¨ä¸ä»£ç åº“ â€œAâ€ ä¸å…¼å®¹çš„ä»£ç åº“ â€œBâ€ï¼Œå¹¶ä¿è¯ â€œAâ€ å¯ä»¥æ­£å¸¸å·¥ä½œã€‚æˆ‘ä»¬å¯ä»¥åˆ›å»ºé€‚é…å™¨æ¥ä¿è¯ â€œAâ€ å’Œ â€œBâ€ å¯ä»¥ä¸€èµ·å·¥ä½œã€‚å…¶ä¸­ä¸€å®šè¦ç‰¢è®°çš„åŸåˆ™æ˜¯ä»£ç åº“ â€œAâ€ æ˜¯ä¸èƒ½è¢«ä¿®æ”¹çš„ã€‚ï¼ˆè¿™æ˜¯å› ä¸ºä¿®æ”¹ä¼šç ´ååŸæœ‰ä»£ç æˆ–è€…æˆ‘ä»¬æ ¹æœ¬å°±æ²¡æœ‰è¿™æ®µæºä»£ç ï¼‰</p><h3 id="é€‚é…å™¨è®¾è®¡æ¨¡å¼ç¤ºä¾‹-app"><a href="#é€‚é…å™¨è®¾è®¡æ¨¡å¼ç¤ºä¾‹-app" class="headerlink" title="é€‚é…å™¨è®¾è®¡æ¨¡å¼ç¤ºä¾‹ app"></a><em>é€‚é…å™¨</em>è®¾è®¡æ¨¡å¼ç¤ºä¾‹ app</h3><p>é€‚é…å™¨çš„ playground æ–‡ä»¶ï¼Œå¯ä»¥åœ¨ <a href="https://github.com/appcoda/swift-design-patterns/tree/master/Adapter" target="_blank" rel="noopener"><strong>GitHub</strong></a> ä¸Šæ‰¾åˆ°ã€‚åœ¨è¿™éƒ¨åˆ†ä»£ç ä¸­ï¼Œæˆ‘ä»¬åŸºäº iOS æ–‡ä»¶ç³»ç»Ÿè¿›è¡Œé€‚é…å™¨æ¨¡å¼çš„è®¨è®ºï¼Œå¹¶åŸºäº iOS æ–‡ä»¶ç³»ç»Ÿè®¾è®¡äº†ä¸€ä¸ªé€‚é…å™¨æ¨¡å¼çš„ä¾‹å­ã€‚ä¹‹å‰ä¸€ç« ï¼Œæˆ‘ä»¬å·²ç»å®ç°äº†å°† iOS æ–‡ä»¶ç³»ç»Ÿä¸­æ‰€æœ‰ç›®å½•å’Œæ–‡ä»¶çš„è·¯å¾„è¡¨ç¤ºä¸º <code>URL</code> å®ä¾‹ã€‚æƒ³è±¡ä¸€ä¸‹ä¸‹é¢çš„åœºæ™¯ï¼Œåœ¨åŸæœ‰å·¥ç¨‹ä¸­å·²ç»å­˜åœ¨äº†å¤§é‡å…³äº iOS æ–‡ä»¶ç³»ç»Ÿçš„ä»£ç ï¼Œä½†æ˜¯æ‰€æœ‰ç›®å½•å’Œæ–‡ä»¶çš„è·¯å¾„éƒ½è¡¨ç¤ºæˆäº†å­—ç¬¦ä¸²å½¢å¼ã€‚é‚£æˆ‘ä»¬å°±å¿…é¡»è¦è®©åŸºäº URL å’ŒåŸºäº String çš„ä»£ç å¯ä»¥ååŒå·¥ä½œã€‚</p><h4 id="é€‚é…å™¨è®¾è®¡æ¨¡å¼çš„ç¤ºä¾‹ä»£ç "><a href="#é€‚é…å™¨è®¾è®¡æ¨¡å¼çš„ç¤ºä¾‹ä»£ç " class="headerlink" title="é€‚é…å™¨è®¾è®¡æ¨¡å¼çš„ç¤ºä¾‹ä»£ç "></a><em>é€‚é…å™¨</em>è®¾è®¡æ¨¡å¼çš„ç¤ºä¾‹ä»£ç </h4><p>æ¥ä¸‹æ¥å°±çœ‹çœ‹ä»£ç å§ã€‚å…ˆç¡®ä¿å·²ç»ä¸‹è½½äº†åœ¨ <a href="https://github.com/appcoda/swift-design-patterns/tree/master/Adapter" target="_blank" rel="noopener"><strong>GitHub</strong></a> ä¸Šçš„ playground æ–‡ä»¶ã€‚ä¸ºäº†åœ¨æ¥ä¸‹æ¥çš„åˆ†æä¸­æ›´åŠ ä¸“æ³¨äºé€‚é…å™¨æ¨¡å¼çš„è®¨è®ºï¼Œä¸‹é¢ä¼šä½¿ç”¨ç®€åŒ–ç‰ˆæœ¬çš„ <code>AppDirectories</code> æšä¸¾å’Œ <code>AppDirectoryNames</code> åè®®å’Œæ‰©å±•ã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">AppDirectories</span> : <span class="title">String</span> </span>&#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="type">Documents</span> = <span class="string">"Documents"</span></span><br><span class="line">    <span class="keyword">case</span> <span class="type">Temp</span> = <span class="string">"tmp"</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">AppDirectoryNames</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">documentsDirectoryURL</span><span class="params">()</span></span> -&gt; <span class="type">URL</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">tempDirectoryURL</span><span class="params">()</span></span> -&gt; <span class="type">URL</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">AppDirectoryNames</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">documentsDirectoryURL</span><span class="params">()</span></span> -&gt; <span class="type">URL</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="type">FileManager</span>.<span class="keyword">default</span>.urls(<span class="keyword">for</span>: .documentDirectory, <span class="keyword">in</span>: .userDomainMask).first!</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">tempDirectoryURL</span><span class="params">()</span></span> -&gt; <span class="type">URL</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="type">FileManager</span>.<span class="keyword">default</span>.temporaryDirectory</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸€ç§æ–¹æ³•æ˜¯åˆ›å»ºä¸€ä¸ªâ€œä¸“ç”¨â€é€‚é…å™¨ã€‚è¿™ä¸ªé€‚é…å™¨ä¼šè¿”å›å­—ç¬¦ä¸²è·¯å¾„ï¼Œè¿™äº›è·¯å¾„å…¨éƒ¨å½’å±äºåœ¨ <code>AppDirectories</code> ä¸‹çš„ç›®å½•å’Œæ–‡ä»¶ã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ä¸“ç”¨é€‚é…å™¨</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">iOSFile</span> : <span class="title">AppDirectoryNames</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> fileName: <span class="type">URL</span></span><br><span class="line">    <span class="keyword">var</span> fullPathInDocuments: <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> documentsDirectoryURL().appendingPathComponent(fileName.absoluteString).path</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> fullPathInTemporary: <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> tempDirectoryURL().appendingPathComponent(fileName.absoluteString).path</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> documentsStringPath: <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> documentsDirectoryURL().path</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> temporaryStringPath: <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> tempDirectoryURL().path</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">init</span>(fileName: <span class="type">String</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.fileName = <span class="type">URL</span>(string: fileName)!</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸‹ä¸€éƒ¨åˆ†æ˜¯ç”¨äºæµ‹è¯• <code>iOSFile</code> â€œä¸“ç”¨â€é€‚é…å™¨çš„ä»£ç ï¼Œè¯·æ³¨æ„ä»£ç ä¸­çš„æ³¨é‡Šã€‚ </p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> iOSfile = iOSFile(fileName: <span class="string">"myFile.txt"</span>)</span><br><span class="line">iOSfile.fullPathInDocuments</span><br><span class="line">iOSfile.documentsStringPath</span><br><span class="line"> </span><br><span class="line">iOSfile.fullPathInTemporary</span><br><span class="line">iOSfile.temporaryStringPath</span><br><span class="line"> </span><br><span class="line"><span class="comment">// é€šè¿‡ `AppDirectoryNames` åè®®ï¼Œä»ç„¶èƒ½å¤Ÿè®¿é—®åˆ° URL</span></span><br><span class="line">iOSfile.documentsDirectoryURL()</span><br><span class="line">iOSfile.tempDirectoryURL()</span><br></pre></td></tr></table></figure><p>æœ€åæ˜¯ playground æ–‡ä»¶ä¸­æ¯ä¸€è¡Œä»£ç å¯¹åº”çš„å³ä¾§è¾“å‡ºï¼Œè¿™äº›è¾“å‡ºä»£è¡¨äº†è¿è¡Œæ—¶æ¯ä¸€è¡Œä»£ç çš„å€¼ã€‚å‚ç…§ä¸Šä¸€æ®µä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥è¿›è¡Œé€è¡Œå¯¹ç…§ã€‚ </p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">iOSFile</span><br><span class="line">&quot;/var/folders/5_/kd8__nv1139__dq_3nfvsmhh0000gp/T/com.apple.dt.Xcode.pg/containers/com.apple.dt.playground.stub.iOS_Simulator.Swift-Adapter-Design-Pattern-0A71F81A-9388-41F5-ACBE-52A1A61A9B99/Documents/myFile.txt&quot;</span><br><span class="line">&quot;/var/folders/5_/kd8__nv1139__dq_3nfvsmhh0000gp/T/com.apple.dt.Xcode.pg/containers/com.apple.dt.playground.stub.iOS_Simulator.Swift-Adapter-Design-Pattern-0A71F81A-9388-41F5-ACBE-52A1A61A9B99/Documents&quot;</span><br><span class="line"> </span><br><span class="line">&quot;/Users/softwaretesting/Library/Developer/XCPGDevices/52E1A81A-98AF-42DE-ADCF-E69AC8FA2791/data/Containers/Data/Application/F08EFF4F-8C4F-4BB7-B220-980E16344F18/tmp/myFile.txt&quot;</span><br><span class="line">&quot;/Users/softwaretesting/Library/Developer/XCPGDevices/52E1A81A-98AF-42DE-ADCF-E69AC8FA2791/data/Containers/Data/Application/F08EFF4F-8C4F-4BB7-B220-980E16344F18/tmp&quot;</span><br><span class="line"> </span><br><span class="line">file:///var/folders/5_/kd8__nv1139__dq_3nfvsmhh0000gp/T/com.apple.dt.Xcode.pg/containers/com.apple.dt.playground.stub.iOS_Simulator.Swift-Adapter-Design-Pattern-0A71F81A-9388-41F5-ACBE-52A1A61A9B99/Documents/</span><br><span class="line">file:///Users/softwaretesting/Library/Developer/XCPGDevices/52E1A81A-98AF-42DE-ADCF-E69AC8FA2791/data/Containers/Data/Application/F08EFF4F-8C4F-4BB7-B220-980E16344F18/tmp/</span><br></pre></td></tr></table></figure><p>å¦å¤–ï¼Œæˆ‘è¿˜å€¾å‘ä¸ºå­—ç¬¦ä¸²ç±»å‹çš„è·¯å¾„è®¾è®¡ä¸€ä¸ªé€‚é…å™¨åè®®ã€‚è¿™æ ·å°±å¯ä»¥å¾ˆæ–¹ä¾¿åœ°ä½¿ç”¨<code>å­—ç¬¦ä¸²</code>è·¯å¾„æ¥æ›¿ä»£ <code>URL</code> è·¯å¾„ã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Protocol-oriented approach</span></span><br><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">AppDirectoryAndFileStringPathNamesAdpater</span> : <span class="title">AppDirectoryNames</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> fileName: <span class="type">String</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">    <span class="keyword">var</span> workingDirectory: <span class="type">AppDirectories</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">documentsDirectoryStringPath</span><span class="params">()</span></span> -&gt; <span class="type">String</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">tempDirectoryStringPath</span><span class="params">()</span></span> -&gt; <span class="type">String</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">fullPath</span><span class="params">()</span></span> -&gt; <span class="type">String</span></span><br><span class="line">    </span><br><span class="line">&#125; <span class="comment">// end protocol AppDirectoryAndFileStringPathAdpaterNames</span></span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">AppDirectoryAndFileStringPathNamesAdpater</span> </span>&#123;</span><br><span class="line">   </span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">documentsDirectoryStringPath</span><span class="params">()</span></span> -&gt; <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> documentsDirectoryURL().path</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">tempDirectoryStringPath</span><span class="params">()</span></span> -&gt; <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> tempDirectoryURL().path</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">fullPath</span><span class="params">()</span></span> -&gt; <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">switch</span> workingDirectory &#123;</span><br><span class="line">        <span class="keyword">case</span> .<span class="type">Documents</span>:</span><br><span class="line">            <span class="keyword">return</span> documentsDirectoryStringPath() + <span class="string">"/"</span> + fileName</span><br><span class="line">        <span class="keyword">case</span> .<span class="type">Temp</span>:</span><br><span class="line">            <span class="keyword">return</span> tempDirectoryStringPath() + <span class="string">"/"</span> + fileName</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125; <span class="comment">// end extension AppDirectoryAndFileStringPathNamesAdpater</span></span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">AppDirectoryAndFileStringPathNames</span> : <span class="title">AppDirectoryAndFileStringPathNamesAdpater</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">let</span> fileName: <span class="type">String</span></span><br><span class="line">    <span class="keyword">let</span> workingDirectory: <span class="type">AppDirectories</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">init</span>(fileName: <span class="type">String</span>, workingDirectory: <span class="type">AppDirectories</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.fileName = fileName</span><br><span class="line">        <span class="keyword">self</span>.workingDirectory = workingDirectory</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125; <span class="comment">// end struct AppDirectoryAndFileStringPathNames</span></span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥æ˜¯ç”¨äºæµ‹è¯• <code>AppDirectoryAndFileStringPathNames</code> ç»“æ„ä½“çš„ä»£ç ã€‚è¿™ä¸ªç»“æ„ä½“éµå®ˆäº† <code>AppDirectoryAndFileStringPathNamesAdpater</code> é€‚é…å™¨åè®®ã€‚åè®®ç»§æ‰¿è‡ª <code>AppDirectoryNames</code> åè®®ã€‚æ³¨æ„åœ¨ä»£ç ä¸­çš„ä¸¤æ®µæ³¨é‡Šã€‚ </p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> appFileDocumentsDirectoryPaths = <span class="type">AppDirectoryAndFileStringPathNames</span>(fileName: <span class="string">"myFile.txt"</span>, workingDirectory: .<span class="type">Documents</span>)</span><br><span class="line">appFileDocumentsDirectoryPaths.fullPath()</span><br><span class="line">appFileDocumentsDirectoryPaths.documentsDirectoryStringPath()</span><br><span class="line"> </span><br><span class="line"><span class="comment">// é€šè¿‡ `AppDirectoryNames` åè®®ä»ç„¶å¯ä»¥è®¿é—® URL</span></span><br><span class="line">appFileDocumentsDirectoryPaths.documentsDirectoryURL()</span><br><span class="line"> </span><br><span class="line"><span class="keyword">let</span> appFileTemporaryDirectoryPaths = <span class="type">AppDirectoryAndFileStringPathNames</span>(fileName: <span class="string">"tempFile.txt"</span>, workingDirectory: .<span class="type">Temp</span>)</span><br><span class="line">appFileTemporaryDirectoryPaths.fullPath()</span><br><span class="line">appFileTemporaryDirectoryPaths.tempDirectoryStringPath()</span><br><span class="line"> </span><br><span class="line"><span class="comment">// é€šè¿‡ `AppDirectoryNames` åè®®ä»ç„¶å¯ä»¥è®¿é—® URL</span></span><br><span class="line">appFileTemporaryDirectoryPaths.tempDirectoryURL()</span><br></pre></td></tr></table></figure><p>æœ€åæ˜¯åœ¨ playground æ–‡ä»¶ä¸­å³ä¾§çš„è¾“å‡ºã€‚æ¯ä¸€è¡Œä»£è¡¨äº†è¿è¡Œæ—¶çš„ä»£ç å€¼ï¼Œä¸‹é¢çš„è¾“å‡ºåŒæ ·å’Œä¸Šä¸€æ®µä»£ç æ˜¯é€è¡Œå¯¹åº”çš„ã€‚</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">AppDirectoryAndFileStringPathNames</span><br><span class="line">&quot;/var/folders/5_/kd8__nv1139__dq_3nfvsmhh0000gp/T/com.apple.dt.Xcode.pg/containers/com.apple.dt.playground.stub.iOS_Simulator.Swift-Adapter-Design-Pattern-A3DE7CC8-D60F-4448-869F-2A19556C62B2/Documents/myFile.txt&quot;</span><br><span class="line">&quot;/var/folders/5_/kd8__nv1139__dq_3nfvsmhh0000gp/T/com.apple.dt.Xcode.pg/containers/com.apple.dt.playground.stub.iOS_Simulator.Swift-Adapter-Design-Pattern-A3DE7CC8-D60F-4448-869F-2A19556C62B2/Documents&quot;</span><br><span class="line"> </span><br><span class="line">file:///var/folders/5_/kd8__nv1139__dq_3nfvsmhh0000gp/T/com.apple.dt.Xcode.pg/containers/com.apple.dt.playground.stub.iOS_Simulator.Swift-Adapter-Design-Pattern-A3DE7CC8-D60F-4448-869F-2A19556C62B2/Documents/</span><br><span class="line"> </span><br><span class="line">AppDirectoryAndFileStringPathNames</span><br><span class="line">&quot;/Users/softwaretesting/Library/Developer/XCPGDevices/52E1A81A-98AF-42DE-ADCF-E69AC8FA2791/data/Containers/Data/Application/CF3D4156-E773-4BC4-B117-E7BDEFA3F34C/tmp/tempFile.txt&quot;</span><br><span class="line">&quot;/Users/softwaretesting/Library/Developer/XCPGDevices/52E1A81A-98AF-42DE-ADCF-E69AC8FA2791/data/Containers/Data/Application/CF3D4156-E773-4BC4-B117-E7BDEFA3F34C/tmp&quot;</span><br><span class="line"> </span><br><span class="line">file:///Users/softwaretesting/Library/Developer/XCPGDevices/52E1A81A-98AF-42DE-ADCF-E69AC8FA2791/data/Containers/Data/Application/CF3D4156-E773-4BC4-B117-E7BDEFA3F34C/tmp/</span><br></pre></td></tr></table></figure><h2 id="ç»“è®º"><a href="#ç»“è®º" class="headerlink" title="ç»“è®º"></a>ç»“è®º</h2><p>è®¾è®¡æ¨¡å¼ä¸ä»…æœ‰åˆ©äºä»£ç å¤ç”¨ï¼Œè¿˜èƒ½ä¿è¯ä»£ç æ˜¯ä¸å˜ã€æ˜“è¯»ã€æ¾è€¦åˆçš„ï¼Œä»è€Œæé«˜äº†å¯ç»´æŠ¤æ€§å’Œæ‹“å±•æ€§ã€‚å½“é‡å¤å‡ºç°å¹¶ä¸”èƒ½åŠ ä»¥æŠ½è±¡çš„åŠŸèƒ½åœ¨ä½ çš„ app ä¸­å‡ºç°çš„æ—¶å€™ï¼Œæˆ‘å¸Œæœ›ä½ èƒ½åº”ç”¨ä¸€ä¸‹è®¾è®¡æ¨¡å¼ï¼Œå¹¶ <a href="http://iosbrain.com/blog/2018/01/13/building-swift-4-frameworks-and-including-them-in-your-apps-xcode-9/" target="_blank" rel="noopener"><strong>å°è£…è¿›æ¡†æ¶</strong></a> ä¸­ã€‚è¿™æ ·å­ä½ åªéœ€è¦å†™ä¸€æ¬¡ä»£ç ï¼Œå°±å¯ä»¥ä¸€ç›´å¤ç”¨å•¦ã€‚</p><p>å†æ¬¡æ„Ÿè°¢å¤§å®¶æ¥ AppCoda ç»™æˆ‘æ§åœºã€‚äº«å—å·¥ä½œï¼ŒåšæŒå­¦ä¹ ï¼Œä¸‹æ¬¡å†è§å§ï¼</p><blockquote><p>æœ¬æ–‡ç”± SwiftGG ç¿»è¯‘ç»„ç¿»è¯‘ï¼Œå·²ç»è·å¾—ä½œè€…ç¿»è¯‘æˆæƒï¼Œæœ€æ–°æ–‡ç« è¯·è®¿é—® <a href="http://swift.gg">http://swift.gg</a>ã€‚</p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;ä½œè€…ï¼šAndrew Jaffeeï¼Œ&lt;a href=&quot;https://www.appcoda.com/design-pattern-structural/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;åŸæ–‡é“¾æ¥&lt;/a&gt;ï¼ŒåŸæ–‡æ—¥æœŸï¼š2018-09-04&lt;br&gt;è¯‘è€…ï¼š&lt;a href=&quot;https://www.jianshu.com/u/076cc5e18bb8&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;éƒ‘ä¸€ä¸€&lt;/a&gt;ï¼›æ ¡å¯¹ï¼š&lt;a href=&quot;https://bignerdcoding.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;BigNerdCoding&lt;/a&gt;ï¼Œ&lt;a href=&quot;http://www.jianshu.com/users/596f2ba91ce9/latest_articles&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;pmst&lt;/a&gt;ï¼Œ&lt;a href=&quot;http://forelax.space&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Forelax&lt;/a&gt;ï¼›å®šç¨¿ï¼š&lt;a href=&quot;http://forelax.space&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Forelax&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;!--æ­¤å¤„å¼€å§‹æ­£æ–‡--&gt;
&lt;p&gt;æœ¬æ–‡æ˜¯æˆ‘çš„è®¾è®¡æ¨¡å¼ç³»åˆ—æ•™ç¨‹çš„ç¬¬ä¸‰ç¯‡ã€‚åœ¨ç¬¬ä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»‹ç»äº† &lt;a href=&quot;https://swift.gg/2018/09/10/design-pattern-creational/&quot;&gt;&lt;strong&gt;åˆ›å»ºå‹æ¨¡å¼&lt;/strong&gt;ä¸­çš„&lt;em&gt;å·¥å‚æ¨¡å¼&lt;/em&gt;å’Œ&lt;em&gt;å•ä¾‹æ¨¡å¼&lt;/em&gt;&lt;/a&gt;ã€‚åœ¨ç¬¬äºŒç¯‡æ–‡ç« ä¸­ï¼Œåˆè®¨è®ºäº†ä¸€ä¸‹ &lt;a href=&quot;https://swift.gg/2018/11/26/design-pattern-behavorial/&quot;&gt;&lt;strong&gt;è¡Œä¸ºå‹æ¨¡å¼&lt;/strong&gt;ä¸­çš„&lt;em&gt;è§‚å¯Ÿè€…æ¨¡å¼&lt;/em&gt;å’Œ&lt;em&gt;å¤‡å¿˜å½•æ¨¡å¼&lt;/em&gt;&lt;/a&gt;ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="Swift" scheme="https://swift.gg/categories/Swift/"/>
    
    
      <category term="Design Patterns" scheme="https://swift.gg/tags/Design-Patterns/"/>
    
  </entry>
  
  <entry>
    <title>Swift ä¸­çš„è®¾è®¡æ¨¡å¼ #2 è§‚å¯Ÿè€…æ¨¡å¼ä¸å¤‡å¿˜å½•æ¨¡å¼</title>
    <link href="https://swift.gg/2018/11/26/design-pattern-behavorial/"/>
    <id>https://swift.gg/2018/11/26/design-pattern-behavorial/</id>
    <published>2018-11-26T00:00:00.000Z</published>
    <updated>2019-02-19T03:45:13.515Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ä½œè€…ï¼šAndrew Jaffeeï¼Œ<a href="https://www.appcoda.com/design-pattern-behavorial/" target="_blank" rel="noopener">åŸæ–‡é“¾æ¥</a>ï¼ŒåŸæ–‡æ—¥æœŸï¼š2018-08-06<br>è¯‘è€…ï¼š<a href="https://dingtz.com/" target="_blank" rel="noopener">jojotov</a>ï¼›æ ¡å¯¹ï¼š<a href="http://forelax.space" target="_blank" rel="noopener">Forelax</a>ï¼Œ<a href="http://www.jianshu.com/users/596f2ba91ce9/latest_articles" target="_blank" rel="noopener">pmst</a>ï¼›å®šç¨¿ï¼š<a href="http://forelax.space" target="_blank" rel="noopener">Forelax</a></p></blockquote><!--æ­¤å¤„å¼€å§‹æ­£æ–‡--><p>æœ¬æ¬¡æ•™ç¨‹æ˜¯ AppCoda <a href="https://swift.gg/2018/09/10/design-pattern-creational/">ä¸Šå‘¨å¼€å¯</a> çš„è®¾è®¡æ¨¡å¼ç³»åˆ—çš„ç¬¬äºŒæœŸã€‚åœ¨è½¯ä»¶è®¾è®¡é¢†åŸŸçš„å››ä½å¤§å¸ˆçº§äººç‰©ï¼ˆGoFï¼Œåˆç§°â€œå››äººå¸®â€æˆ–â€œGang of Fourâ€ï¼‰ â€”â€” Erich Gamma, Richard Helm, Ralph Johnson å’Œ John Vlissides æ‰€è‘—çš„ ã€Šè®¾è®¡æ¨¡å¼ï¼šå¯å¤ç”¨é¢å‘å¯¹è±¡è½¯ä»¶çš„åŸºç¡€ã€‹ä¸€ä¹¦ä¸­ï¼Œé¦–æ¬¡å¯¹è½¯ä»¶è®¾è®¡ä¸­æ€»å…± 23 ç§è®¾è®¡æ¨¡å¼è¿›è¡Œäº†å®šä¹‰å’Œå½’ç±»ï¼Œå¹¶å¯¹å®ƒä»¬ä½œäº†ä¸“ä¸šé˜è¿°ã€‚ä»Šå¤©ï¼Œæˆ‘ä»¬å°†èšç„¦äºå…¶ä¸­ä¸¤ä¸ªè¡Œä¸ºå‹è®¾è®¡æ¨¡å¼ â€”â€” â€œè§‚å¯Ÿè€…æ¨¡å¼â€ å’Œ â€œå¤‡å¿˜å½•æ¨¡å¼â€ã€‚</p><a id="more"></a><p>è½¯ä»¶å¼€å‘é¢†åŸŸè‡´åŠ›äºå¯¹çœŸå®ä¸–ç•Œçš„åœºæ™¯è¿›è¡Œå»ºæ¨¡ï¼Œå¹¶æœŸæœ›èƒ½åˆ›é€ å‡ºä¸€ç³»åˆ—å·¥å…·æ¥æé«˜äººç±»å¯¹è¿™äº›åœºæ™¯çš„ç†è§£ä¸ä½“éªŒã€‚ä¸ 10 å¹´å‰ç›¸æ¯”ï¼Œä¸€äº›ç±»ä¼¼é“¶è¡Œåº”ç”¨å’Œè¾…åŠ©è´­ç‰©åº”ç”¨ï¼ˆå¦‚äºšé©¬é€Šæˆ– eBay çš„ iOS å®¢æˆ·ç«¯åº”ç”¨ï¼‰çš„è´¢åŠ¡ç±»å·¥å…·çš„å‡ºç°ï¼Œæ— ç–‘è®©é¡¾å®¢ä»¬çš„ç”Ÿæ´»å˜å¾—æ›´åŠ ç®€å•ã€‚å½“æˆ‘ä»¬å›é¡¾è½¯ä»¶å¼€å‘çš„å‘å±•å†ç¨‹ï¼Œå®šä¼šæ„Ÿå¹æˆ‘ä»¬åœ¨è½¯ä»¶å¼€å‘é¢†åŸŸä¸Šèµ°è¿‡äº†æ¼«é•¿è€ŒåˆæˆåŠŸçš„é“è·¯ã€‚å¦‚ä»Šï¼Œè½¯ä»¶åº”ç”¨çš„åŠŸèƒ½æ™®éå˜å¾—å¼ºå¤§ä¸”æ˜“ç”¨ï¼Œä½†å¯¹äºå¼€å‘è€…æ¥è¯´ï¼Œå¼€å‘è¿™äº›è½¯ä»¶å´å˜å¾— <a href="http://iosbrain.com/blog/2018/04/29/controlling-chaos-why-you-should-care-about-adding-error-checking-to-your-ios-apps/#chaos" target="_blank" rel="noopener">è¶Šæ¥è¶Šå¤æ‚</a>ã€‚</p><p>å¼€å‘è€…ä»¬ä¸ºäº†ç®¡ç†è½¯ä»¶çš„å¤æ‚æ€§ï¼Œåˆ›é€ äº†ä¸€ç³»åˆ—çš„æœ€ä½³å®è·µ â€”â€” ä¾‹å¦‚é¢å‘å¯¹è±¡ç¼–ç¨‹ã€é¢å‘åè®®ç¼–ç¨‹ã€å€¼è¯­ä¹‰ã€å±€éƒ¨æ¨ç†ï¼ˆLocal Reasoningï¼‰ã€æŠŠå¤§å—çš„ä»£ç åˆ‡åˆ†æˆä¸€ç³»åˆ—å°å—çš„ä»£ç å¹¶é™„ä¸Šå‹å¥½çš„æ¥å£ï¼ˆå¦‚ Swift ä¸­çš„æ‰©å±•ï¼‰ã€è¯­æ³•ç³–ç­‰ã€‚ä½†åœ¨ä¼—å¤šçš„æœ€ä½³å®è·µä¹‹ä¸­ï¼Œæœ‰ä¸€ä¸ªéå¸¸é‡è¦ä¸”å€¼å¾—æˆ‘ä»¬å…³æ³¨çš„æœ€ä½³å®è·µå¹¶æ²¡æœ‰åœ¨ä¸Šæ–‡ä¸­æåŠ â€”â€” é‚£å°±æ˜¯è®¾è®¡æ¨¡å¼çš„ä½¿ç”¨ã€‚</p><h2 id="è®¾è®¡æ¨¡å¼"><a href="#è®¾è®¡æ¨¡å¼" class="headerlink" title="è®¾è®¡æ¨¡å¼"></a>è®¾è®¡æ¨¡å¼</h2><p>å¯¹äºå¼€å‘è€…æ¥è¯´ï¼Œè®¾è®¡æ¨¡å¼æ˜¯ç®¡ç†ä»£ç å¤æ‚åº¦é—®é¢˜çš„ä¸€ä¸ªæå…¶é‡è¦çš„å·¥å…·ã€‚æˆ‘ä»¬ç†è§£è®¾è®¡æ¨¡å¼æœ€å¥½çš„åŠæ³•ï¼Œå°±æ˜¯æŠŠè®¾è®¡æ¨¡å¼æ¦‚å¿µåŒ–ä¸º â€”â€” æœ‰å›ºå®šæ¨¡ç‰ˆçš„é€šç”¨æŠ€æœ¯ï¼Œæ¯ä¸ªè®¾è®¡æ¨¡å¼éƒ½æ—¨åœ¨è§£å†³ç›¸åº”çš„ä¸€ä¸ªåå¤å‡ºç°ä¸”æ˜“äºè¾¨åˆ«çš„ç‰¹å®šé—®é¢˜ã€‚ä½ å¯ä»¥æŠŠè®¾è®¡æ¨¡å¼çœ‹ä½œæ˜¯ä¸€ç³»åˆ—æœ€ä½³å®è·µçš„é›†åˆï¼Œå®ƒä»¬å¯ä»¥ç”¨äºä¸€äº›ç»å¸¸å‡ºç°çš„ç¼–ç åœºæ™¯ï¼šä¾‹å¦‚å¦‚ä½•åˆ©ç”¨ä¸€ç³»åˆ—æœ‰å…³è”çš„å¯¹è±¡åˆ›å»ºå‡ºæ–°çš„å¯¹è±¡ï¼Œå¹¶ä¸”ä¸éœ€è¦å»ç†è§£åŸæœ¬é‚£ä¸€ç³»åˆ—å¯¹è±¡ä¸­â€œåˆè‡­åˆé•¿â€çš„ä»£ç å®ç°ã€‚è®¾è®¡æ¨¡å¼æœ€é‡è¦çš„æ„ä¹‰æ˜¯å…¶å¯ä»¥åº”ç”¨äºé‚£äº›å¸¸è§çš„åœºæ™¯ã€‚åŒæ—¶ï¼Œç”±äºè®¾è®¡æ¨¡å¼éƒ½æ˜¯å·²ç»åˆ›é€ å‡ºæ¥çš„å›ºå®šæ¨¡å¼ï¼Œæ‹¿æ¥å³ç”¨çš„ç‰¹è´¨ä»¤å®ƒå…·æœ‰å¾ˆé«˜çš„æ˜“ç”¨æ€§ã€‚ä¸ºäº†èƒ½æ›´å¥½çš„ç†è§£è®¾è®¡æ¨¡å¼ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªä¾‹å­ï¼š</p><p>è®¾è®¡æ¨¡å¼å¹¶ä¸èƒ½è§£å†³ä¸€äº›éå¸¸å…·ä½“çš„é—®é¢˜ã€‚ä¾‹å¦‚ â€œå¦‚ä½•åœ¨ Swift ä¸­éå†ä¸€ä¸ªåŒ…å« 11 ä¸ªæ•´å‹ï¼ˆ<code>Int</code>ï¼‰çš„ æ•°ç»„â€ä¹‹ç±»çš„çš„é—®é¢˜ã€‚æˆ‘ä»¬ä»ä¸€ä¸ªä¾‹å­æ¥æ›´å¥½åœ°ç†è§£ä¸ºä»€ä¹ˆè®¾è®¡æ¨¡å¼ä¸èƒ½è§£å†³æ­¤ç±»å…·ä½“é—®é¢˜ â€”â€” GoF å®šä¹‰äº†<em>è¿­ä»£å™¨</em>æ¨¡å¼ï¼Œä¸ºâ€œä¾¿æ·åœ°éå†é›†åˆçš„æ‰€æœ‰å…ƒç´ ï¼Œè€Œä¸éœ€è¦çŸ¥é“é›†åˆä¸­å…ƒç´ çš„ç±»å‹â€ çš„é—®é¢˜æå‡ºé€šç”¨çš„è§£å†³æ–¹æ¡ˆï¼Œã€‚å› æ­¤ï¼Œæˆ‘ä»¬ä¸èƒ½å•çº¯åœ°æŠŠè®¾è®¡æ¨¡å¼å½“ä½œæŸç§è¯­è¨€çš„ä»£ç ï¼Œå®ƒåªæ˜¯ç”¨äºè§£å†³é€šç”¨è½¯ä»¶å¼€å‘åœºæ™¯çš„è§„åˆ™å’ŒæŒ‡å¼•ã€‚</p><p>æˆ‘æ›¾ç»åœ¨ AppCoda ä¸­è®¨è®ºè¿‡ <a href="https://www.appcoda.com/mvvm-vs-mvc/" target="_blank" rel="noopener">â€œModel-View-ViewModelâ€ æˆ– â€œMVVMâ€</a>  è®¾è®¡æ¨¡å¼ â€”â€” å½“ç„¶ä¹Ÿå°‘ä¸äº†é‚£ä¸ª Apple å’Œ ä¼—å¤š iOS å¼€å‘è€…ä»¬é•¿æœŸå–œçˆ±ç€çš„ç»å…¸è®¾è®¡æ¨¡å¼ <a href="https://www.appcoda.com/mvvm-vs-mvc/" target="_blank" rel="noopener">â€œModel-View-Controllerâ€ æˆ– â€œMVCâ€</a> </p><p>è¿™ä¸¤ç§è®¾è®¡æ¨¡å¼é€šå¸¸æ¥è¯´ä¼šåº”ç”¨äº<em>æ•´ä¸ªåº”ç”¨å±‚é¢</em>ã€‚MVVM å’Œ MVC å¯ä»¥çœ‹ä½œæ˜¯<em>æ¶æ„å±‚é¢ä¸Š</em>çš„è®¾è®¡æ¨¡å¼ï¼Œå®ƒä»¬ä¸»è¦çš„ä½œç”¨å¯ä»¥ç®€å•åˆ†æˆå››ä¸ªæ–¹é¢ï¼šéš”ç¦»ç”¨æˆ·ç•Œé¢ï¼ˆUIï¼‰ä¸åº”ç”¨çš„æ•°æ®ï¼›éš”ç¦»ç”¨æˆ·ç•Œé¢ï¼ˆUIï¼‰ä¸è´Ÿè´£å±•ç¤ºé€»è¾‘çš„ä»£ç ï¼›éš”ç¦»åº”ç”¨çš„æ•°æ®ä¸æ ¸å¿ƒæ•°æ®å¤„ç†é€»è¾‘ï¼›éš”ç¦»åº”ç”¨çš„æ•°æ®ä¸ä¸šåŠ¡é€»è¾‘ã€‚GoF çš„è®¾è®¡æ¨¡å¼éƒ½å…·æœ‰ç‰¹æ®Šæ€§ï¼Œå®ƒä»¬éƒ½æ—¨åœ¨è§£å†³ä¸€äº›åœ¨åº”ç”¨çš„<em>ä»£ç åº“ä¸­</em>è¾ƒä¸ºç‰¹åˆ«çš„é—®é¢˜ã€‚ä½ å¯èƒ½ä¼šåœ¨å¼€å‘ä¸€ä¸ªåº”ç”¨çš„æ—¶å€™ç”¨åˆ°å¥½å‡ ä¸ª GoF çš„è®¾è®¡æ¨¡å¼ã€‚åŒæ—¶ä½ éœ€è¦è®°å¾—è®¾è®¡æ¨¡å¼å¹¶ä¸åªæ˜¯ä¸€äº›å…·ä½“çš„ä»£ç å®ä¾‹ï¼Œå®ƒä»¬è§£å†³çš„æ˜¯ä¸€äº›æ›´æŠ½è±¡å±‚é¢ä¸Šçš„é—®é¢˜ï¼ˆå¸Œæœ›ä½ æ²¡å¿˜è®°ä¸Šé¢çš„<em>è¿­ä»£å™¨</em>ä¾‹å­ï¼‰ã€‚é™¤æ­¤ä¹‹å¤–æˆ‘è¿˜æƒ³æåŠä¸€ä¸ªæ²¡æœ‰åœ¨ GoF åˆ—å‡ºçš„ 23 ä¸ªè®¾è®¡æ¨¡å¼ä¹‹ä¸­ï¼Œä½†å´æ˜¯è®¾è®¡æ¨¡å¼çš„ <a href="https://www.appcoda.com/swift-delegate/" target="_blank" rel="noopener">å…¸å‹ä¾‹å­</a> â€”â€” ä»£ç†æ¨¡å¼ã€‚</p><p>è™½ç„¶ GoF å…³äºè®¾è®¡æ¨¡å¼çš„ä¹¦å·²ç»è¢«ä¼—å¤šå¼€å‘è€…è§†ä¸ºåœ£ç»èˆ¬çš„å­˜åœ¨ï¼Œä½†ä»å­˜åœ¨ä¸€äº›å¯¹å…¶æ‰¹åˆ¤çš„å£°éŸ³ã€‚æˆ‘ä»¬ä¼šåœ¨æœ¬æ–‡ç»“å°¾çš„éƒ¨åˆ†è®¨è®ºè¿™ä¸ªé—®é¢˜ã€‚</p><h2 id="è®¾è®¡æ¨¡å¼ç±»åˆ«"><a href="#è®¾è®¡æ¨¡å¼ç±»åˆ«" class="headerlink" title="è®¾è®¡æ¨¡å¼ç±»åˆ«"></a>è®¾è®¡æ¨¡å¼ç±»åˆ«</h2><p>GoF æŠŠä»–ä»¬æå‡ºçš„ 23 ç§è®¾è®¡æ¨¡å¼æ•´ç†åˆ°äº† 3 ç§å¤§çš„ç±»åˆ«ä¸­ï¼šâ€œåˆ›å»ºå‹æ¨¡å¼â€ã€â€œç»“æ„å‹æ¨¡å¼â€ä»¥åŠâ€œè¡Œä¸ºå‹æ¨¡å¼â€ã€‚æœ¬æ¬¡çš„æ•™ç¨‹ä¼šè®¨è®º<em>è¡Œä¸ºå‹æ¨¡å¼</em>ç±»åˆ«ä¸­çš„ä¸¤ç§è®¾è®¡æ¨¡å¼ã€‚è¡Œä¸ºå‹æ¨¡å¼çš„ä¸»è¦ä½œç”¨æ˜¯å¯¹ç±»å’Œç»“æ„ä½“ï¼ˆå‚ä¸è€…ï¼‰çš„è¡Œä¸ºèµ‹äºˆå®‰å…¨æ€§ã€åˆç†æ€§ï¼Œä»¥åŠå®šä¹‰ä¸€äº›ç»Ÿä¸€çš„è§„åˆ™ã€ç»Ÿä¸€çš„çš„å½¢å¼å’Œæœ€ä½³å®è·µã€‚å¯¹äºæ•´ä¸ªåº”ç”¨ä¸­çš„å‚ä¸è€…ï¼Œæˆ‘ä»¬éƒ½å¸Œæœ›æœ‰ä¸€ä¸ªè‰¯å¥½çš„ã€ç»Ÿä¸€çš„ã€å¹¶ä¸”å¯é¢„æµ‹çš„è¡Œä¸ºã€‚åŒæ—¶ï¼Œæˆ‘ä»¬ä¸ä»…å¸Œæœ›å‚ä¸è€…æœ¬èº«æ‹¥æœ‰è‰¯å¥½çš„è¡Œä¸ºï¼Œä¹Ÿå¸Œæœ›ä¸åŒçš„å‚ä¸è€…ä¹‹é—´çš„äº¤äº’/é€šä¿¡å¯ä»¥æ‹¥æœ‰è‰¯å¥½çš„è¡Œä¸ºã€‚å¯¹äºå‚ä¸è€…çš„è¡Œä¸ºè¯„ä¼°ï¼Œå…¶æ—¶æœºåº”è¯¥åœ¨ç¼–è¯‘ä¹‹å‰ä»¥åŠç¼–è¯‘æ—¶ â€”â€” æˆ‘é€šå¸¸æŠŠè¿™æ®µæ—¶é—´ç§°ä¹‹ä¸ºâ€œè®¾è®¡æ—¶é—´â€ï¼Œä»¥åŠåœ¨è¿è¡Œæ—¶ â€”â€” æ­¤æ—¶æˆ‘ä»¬ä¼šæœ‰å¤§é‡çš„ç±»å’Œç»“æ„ä½“çš„å®ä¾‹åœ¨å„å¸å…¶èŒæˆ–ä¸å…¶ä»–å®ä¾‹äº¤äº’/é€šä¿¡ã€‚ç”±äºå®ä¾‹é—´çš„é€šä¿¡ä¼šå¯¼è‡´è½¯ä»¶å¤æ‚åº¦çš„å¢åŠ ï¼Œå› æ­¤åˆ¶å®šä¸€ç³»åˆ—å…³äºä¸€è‡´æ€§ã€é«˜æ•ˆç‡å’Œå®‰å…¨é€šä¿¡çš„è§„åˆ™æ˜¯æä¸ºé‡è¦çš„ï¼Œä½†ä¸æ­¤åŒæ—¶ï¼Œåœ¨æ„å»ºæ¯ä¸ªå•ç‹¬çš„å‚ä¸è€…æ—¶ï¼Œè¿™ä¸ªæ¦‚å¿µä¸åº”ä»¥ä»»ä½•æ–¹å¼é™ä½è®¾è®¡çš„è´¨é‡ã€‚ç”±äºéœ€è¦éå¸¸ç€é‡äºè¡Œä¸ºï¼Œæˆ‘ä»¬å¿…é¡»ç‰¢è®°ä¸€ç‚¹ â€”â€” åœ¨èµ‹äºˆå‚ä¸è€…èŒè´£æ—¶å¿…é¡»ä½¿ç”¨ä¸€è‡´çš„æ¨¡å¼ã€‚</p><p>åœ¨é«˜è°ˆé˜”è®ºå¤ªå¤šç†è®ºä¹‹å‰ï¼Œè®©æˆ‘å…ˆè¯´æ˜ä¸€ä¸‹æœ¬æ¬¡æ•™ç¨‹ä¸­ä½ ä¼šæœ‰å“ªäº›æ”¶è·ï¼ŒåŒæ—¶æ‰€æœ‰çš„ç›¸å…³å®è·µä»£ç æˆ‘éƒ½ä¼šç”¨ Swift æ¥å®ç°ã€‚åœ¨æœ¬æ¬¡æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä¼šäº†è§£åˆ°å¦‚ä½•èƒ½å¤Ÿé€šè¿‡ä¸€è‡´åœ°èµ‹äºˆèŒè´£æ¥ç»´æŒå‚ä¸è€…çš„çŠ¶æ€ã€‚æˆ‘ä»¬ä¼šäº†è§£åˆ°å¦‚ä½•ä¸€è‡´åœ°èµ‹äºˆèŒè´£ç»™ä¸€ä¸ªå‚ä¸è€…ï¼Œè®©ä»–èƒ½å¤Ÿå‘é€é€šçŸ¥ç»™å…¶ä»–è§‚å¯Ÿè€…ã€‚ä¸ä¹‹å¯¹åº”ï¼Œæˆ‘ä»¬ä¹Ÿä¼šäº†è§£åˆ°å¦‚ä½•ä¸€è‡´åœ°èµ‹äºˆèŒè´£ç»™è§‚å¯Ÿè€…ä»¬æ³¨å†Œé€šçŸ¥ã€‚</p><p>å½“ä½ è®¨è®ºè®¾è®¡æ¨¡å¼æ—¶ï¼Œä½ åº”è¯¥æŠŠä¸€è‡´æ€§å½“æˆæœ€æ˜¾è€Œæ˜“è§çš„åŸºæœ¬æ¦‚å¿µã€‚åœ¨ <a href="https://www.appcoda.com/design-pattern-creational/" target="_blank" rel="noopener">ä¸Šå‘¨çš„æ¨é€</a> ä¸­ï¼Œæˆ‘ä»¬ç€é‡è®¨è®ºäº†ä¸€ä¸ªæ¦‚å¿µï¼š<a href="http://iosbrain.com/blog/2017/02/26/intro-to-object-oriented-principles-in-swift-3-via-a-message-box-class-hierarchy/#advantages" target="_blank" rel="noopener">é«˜å¤æ‚åº¦ï¼ˆå°è£…ï¼‰</a>ã€‚ä½ å¿…é¡»æŠŠè¿™ä¸ªæ¦‚å¿µå½“ä½œä¸­å¿ƒæ€æƒ³ç‰¢è®°äºå¿ƒï¼Œå› ä¸ºå®ƒä¼šéšç€æˆ‘ä»¬æ›´æ·±å…¥åœ°è®¨è®ºè®¾è®¡æ¨¡å¼è€Œå‡ºç°åœ°è¶Šå‘é¢‘ç¹ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œé¢å‘å¯¹è±¡ï¼ˆOOPï¼‰ä¸­çš„ä¼—å¤šç±»ï¼Œå¯ä»¥åœ¨ä¸éœ€è¦å¼€å‘è€…çŸ¥é“ä»»ä½•å…¶å†…éƒ¨å®ç°çš„å‰æä¸‹ï¼Œæä¾›éå¸¸å¤æ‚ã€æˆç†Ÿä¸”å¼ºå¤§çš„åŠŸèƒ½ã€‚åŒæ ·ï¼Œ Swift çš„ <a href="https://www.appcoda.com/pop-vs-oop/" target="_blank" rel="noopener">é¢å‘åè®®ç¼–ç¨‹</a> ä¹Ÿæ˜¯ä¸€é¡¹å¯¹äºæ§åˆ¶å¤æ‚åº¦æ¥è¯´æä¸ºé‡è¦çš„æ–°æŠ€æœ¯ã€‚å¯¹å¼€å‘è€…æ¥è¯´ï¼Œæƒ³è¦ç®¡ç†å¥½ <a href="http://iosbrain.com/blog/2018/01/02/understanding-swift-4-generics-and-applying-them-to-your-code/#complexity" target="_blank" rel="noopener">å¤æ‚åº¦</a> æ˜¯ä¸€ä»¶å¼‚å¸¸å›°éš¾çš„äº‹æƒ…ï¼Œä½†æˆ‘ä»¬ç°åœ¨å³å°†æŠŠè¿™å¤´é‡å…½é©¯æœï¼</p><h2 id="å…³äºæ­¤æ•™ç¨‹çš„æé†’"><a href="#å…³äºæ­¤æ•™ç¨‹çš„æé†’" class="headerlink" title="å…³äºæ­¤æ•™ç¨‹çš„æé†’"></a>å…³äºæ­¤æ•™ç¨‹çš„æé†’</h2><p>åœ¨è¿™æ¬¡çš„æ•™ç¨‹ä¸­ï¼Œæˆ‘å†³å®šæŠŠæ–‡å­—èšç„¦äºå¯¹ç¤ºä¾‹ä»£ç çš„è§£é‡Šã€‚æˆ‘å°†å¯¹ä»Šå¤©æ‰€è¦ä»‹ç»çš„è®¾è®¡æ¨¡å¼æ¦‚å¿µè¿›è¡Œä¸€äº›ç®€å•æ˜äº†çš„é™ˆè¿°ï¼Œä½†åŒæ—¶ä¸ºäº†èƒ½å¤Ÿè®©ä½ æ›´å¥½åœ°ç†è§£æˆ‘æ‰€åˆ†äº«çš„æŠ€æœ¯ï¼Œå¸Œæœ›ä½ å¯ä»¥è®¤çœŸçœ‹çœ‹ä»£ç å’Œæ³¨é‡Šã€‚æ¯•ç«Ÿä½œä¸ºä¸€åç¨‹åºå‘˜ï¼Œå¦‚æœä½ åªèƒ½è°ˆè®ºä»£ç è€Œä¸èƒ½ç¼–å†™ä»£ç ï¼Œé‚£ä½ å¯èƒ½ä¼šåœ¨å¾ˆå¤šé¢è¯•ä¸­å¤±åˆ© â€”â€” å› ä¸ºä½ è¿˜ä¸å¤Ÿç¡¬æ ¸ã€‚</p><p>ä½ ä¹Ÿè®¸ä¼šç•™æ„åˆ°ï¼Œæˆ‘å¯¹ä¸è¡Œä¸ºå‹è®¾è®¡æ¨¡å¼çš„å®šä¹‰æ˜¯éµå¾ªäºè‹¹æœçš„ <a href="https://docs.swift.org/swift-book/LanguageGuide/ClassesAndStructures.html" target="_blank" rel="noopener">æ–‡æ¡£è§„èŒƒ</a>:</p><blockquote><p>ä¼ ç»Ÿæ„ä¹‰ä¸Šæ¥è¯´ï¼Œæˆ‘ä»¬è§†ä¸€ä¸ªç±»çš„å®ä¾‹ä¸ºä¸€ä¸ªå¯¹è±¡ã€‚è™½ç„¶å¦‚æ­¤ï¼Œä½†ç›¸å¯¹äºå…¶ä»–è¯­è¨€è€Œè¨€ï¼ŒSwift ä¸­çš„ç»“æ„ä½“å’Œç±»åœ¨åŠŸèƒ½ä¸Šéå¸¸ç›¸ä¼¼ï¼Œä¸”æœ¬ç« èŠ‚å¤§éƒ¨åˆ†å†…å®¹æè¿°äº†ç±»æˆ–è€…ç»“æ„ä½“å®ä¾‹çš„åŠŸèƒ½ã€‚å› æ­¤ï¼Œæˆ‘ä»¬ä½¿ç”¨æ›´ä¸ºé€šç”¨çš„æè¿°â€”â€”å®ä¾‹ã€‚</p></blockquote><p>åœ¨è®¾è®¡æ—¶ï¼Œæˆ‘æŠŠå¯¹ç±»å’Œç»“æ„ä½“çš„ä»»ä½•å¼•ç”¨éƒ½æè¿°ä¸ºâ€œå‚ä¸è€…â€ã€‚</p><h2 id="è§‚å¯Ÿè€…æ¨¡å¼"><a href="#è§‚å¯Ÿè€…æ¨¡å¼" class="headerlink" title="è§‚å¯Ÿè€…æ¨¡å¼"></a>è§‚å¯Ÿè€…æ¨¡å¼</h2><p>åœ¨ä½¿ç”¨è‹¹æœçš„ç§»åŠ¨è®¾å¤‡æ—¶ï¼Œè§‚å¯Ÿè€…æ¨¡å¼å¯èƒ½æ˜¯è´¯ç©¿æ•´ä¸ªåº”ç”¨ä½¿ç”¨è¿‡ç¨‹çš„ä¸œè¥¿ â€”â€” ä½ åº”è¯¥åœ¨ç¼–å†™ iOS åº”ç”¨æ—¶ä¹Ÿå‘ç°äº†è¿™ä¸€ç‚¹ã€‚åœ¨æˆ‘ç”Ÿæ´»çš„åœ°æ–¹ï¼Œæ¯å½“ä¸‹é›¨å¤©çš„æ—¶å€™ï¼ŒåŒ…æ‹¬æˆ‘åœ¨å†…çš„å¾ˆå¤§ä¸€éƒ¨åˆ†äººéƒ½ä¼šæ”¶åˆ° iPhone ä¸Šçš„é€šçŸ¥ã€‚ä¸ç®¡æ˜¯é”å±çš„çŠ¶æ€è¿˜æ˜¯è§£é”çš„çŠ¶æ€ï¼Œåªè¦ä¸‹èµ·é›¨æ¥ï¼Œä½ éƒ½ä¼šæ”¶åˆ°ä¸€æ¡ç±»ä¼¼ä¸‹é¢è¿™æ ·çš„é€šçŸ¥ï¼š</p><p><img src="https://www.appcoda.com/wp-content/uploads/2018/08/PushNotification.png" alt="PushNotification demo"></p><p>ä½œä¸ºæ‰€æœ‰é€šçŸ¥çš„<em>æºå¤´</em>ï¼Œè‹¹æœä¼šä»£è¡¨å›½å®¶æ°”è±¡å±€ï¼ˆNational Weather Serviceï¼‰å‘<em>æˆåƒä¸Šä¸‡</em>çš„ iPhone ç”¨æˆ·å‘é€ï¼ˆå¹¿æ’­ï¼‰é€šçŸ¥ï¼Œæé†’ä»–ä»¬åœ¨å…¶åŒºåŸŸå†…æ˜¯å¦æœ‰æ´ªæ°´ç¾å®³çš„é£é™©ã€‚æ›´å…·ä½“ä¸€ç‚¹åœ°åœ¨ iOS åº”ç”¨å±‚çº§ä¸Šè¯´ï¼Œå½“æŸä¸€ä¸ªå®ä¾‹ï¼ˆä¹Ÿå°±æ˜¯è¢«è§‚å¯Ÿè€…ï¼‰çš„çŠ¶æ€å‘ç”Ÿæ”¹å˜æ—¶ï¼Œå®ƒä¼šé€šçŸ¥å…¶ä»–ï¼ˆä¸æ­¢ä¸€ä¸ªï¼‰çš„è¢«ç§°ä¸º<em>è§‚å¯Ÿè€…</em>çš„å®ä¾‹ï¼Œå‘Šè¯‰ä»–ä»¬è‡ªå·±çš„æŸä¸ªçŠ¶æ€å‘ç”Ÿäº†å˜åŒ–ã€‚æ‰€æœ‰å‚ä¸æ­¤æ¬¡å¹¿æ’­é€šä¿¡çš„å®ä¾‹éƒ½ä¸éœ€è¦çŸ¥é“é™¤äº†è‡ªèº«ä»¥å¤–çš„ä»»ä½•å…¶ä»–å®ä¾‹ã€‚è¿™æ˜¯ä¸€ä¸ªå…³äº <a href="https://www.webopedia.com/TERM/L/loose_coupling.html" target="_blank" rel="noopener">æ¾è€¦åˆ</a> çš„ç»ä½³ç¤ºä¾‹ã€‚</p><p>è¢«è§‚å¯Ÿçš„å®ä¾‹ï¼ˆé€šå¸¸æ˜¯ä¸€ä¸ªé‡è¦çš„èµ„æºï¼‰ä¼šå¹¿æ’­å…³äºè‡ªèº«çŠ¶æ€æ”¹å˜çš„é€šçŸ¥ç»™å…¶ä»–ä¼—å¤šè§‚å¯Ÿè€…å®ä¾‹ã€‚å¯¹è¿™äº›çŠ¶æ€æ”¹å˜æœ‰å…´è¶£çš„è§‚å¯Ÿè€…å¿…é¡»é€šè¿‡è®¢é˜…æ¥è·å–å…³äºçŠ¶æ€æ”¹å˜é€šçŸ¥ã€‚</p><p>è¿™æ¬¡æˆ‘ä»¬ä¸å¾—ä¸è¯´è‹¹æœè¿˜æ˜¯å¾ˆé è°±çš„ï¼ŒiOS å·²ç»å†…ç½®äº†ä¸€ä¸ªå¹¿ä¸ºäººçŸ¥çš„ç”¨äºè§‚å¯Ÿè€…æ¨¡å¼çš„ç‰¹æ€§ï¼š<a href="https://developer.apple.com/documentation/foundation/notificationcenter" target="_blank" rel="noopener">NotificationCenter</a>ã€‚åœ¨è¿™é‡Œæˆ‘ä¸ä¼šå¯¹å…¶ä½œè¿‡å¤šä»‹ç»ï¼Œè¯»è€…å¯è‡ªè¡Œåœ¨ <a href="http://iosbrain.com/blog/2018/02/09/nsnotificationcenter-in-swift-4-intra-app-communication-sending-receiving-listening-stop-listening-for-messages/" target="_blank" rel="noopener">è¿™é‡Œ</a> å­¦ä¹ ç›¸å…³å†…å®¹ã€‚</p><h3 id="è§‚å¯Ÿè€…æ¨¡å¼ç”¨ä¾‹"><a href="#è§‚å¯Ÿè€…æ¨¡å¼ç”¨ä¾‹" class="headerlink" title="è§‚å¯Ÿè€…æ¨¡å¼ç”¨ä¾‹"></a>è§‚å¯Ÿè€…æ¨¡å¼ç”¨ä¾‹</h3><p>æˆ‘çš„è§‚å¯Ÿè€…æ¨¡å¼ç¤ºä¾‹é¡¹ç›®å±•ç¤ºäº†è¿™ç§å¹¿æ’­ç±»å‹çš„é€šä¿¡æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Œä½ å¯ä»¥åœ¨ <a href="https://github.com/appcoda/Observer-Pattern-Swift" target="_blank" rel="noopener">Github ä¸Šæ‰¾åˆ°å®ƒ</a>ã€‚</p><p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªå·¥å…·æ¥ç›‘è§†ç½‘ç»œè¿æ¥çŠ¶å†µï¼Œå¹¶å¯¹å·²è¿æ¥æˆ–æœªè¿æ¥çš„çŠ¶æ€ä½œå‡ºå“åº”ã€‚è¿™ä¸ªå·¥å…·æˆ‘ä»¬å¯ä»¥ç§°ä¹‹ä¸ºå¹¿æ’­è€…ã€‚ä¸ºäº†å®ç°æ­¤å·¥å…·ï¼Œä½ éœ€è¦ä¸€ä¸ªå‚ä¸è€…éµå¾ªæˆ‘æä¾›çš„ <code>ObservedProtocol</code> åè®®ã€‚è™½ç„¶æˆ‘çŸ¥é“è¿™ä¹ˆåšå¹¶ä¸å¤ªç¬¦åˆè‹¹æœçš„ iOS Human Interface Guideline çš„å»ºè®®ï¼Œä½†æˆ‘ä¸ºäº†æ›´å¥½åœ°æ¼”ç¤ºè§‚å¯Ÿè€…æ¨¡å¼ï¼Œæˆ‘éœ€è¦ä»¥ç½‘ç»œçŠ¶å†µä½œä¸ºä»…æœ‰çš„ä¸€ä¸ªå…³é”®èµ„æºã€‚</p><p>å‡è®¾ç°åœ¨æœ‰è®¸å¤šä¸ªä¸åŒçš„è§‚å¯Ÿè€…å®ä¾‹å…¨éƒ½å‘è¢«è§‚å¯Ÿçš„å¯¹è±¡è®¢é˜…äº†å…³äºç½‘ç»œè¿æ¥çŠ¶å†µçš„é€šçŸ¥ï¼Œä¾‹å¦‚ä¸€ä¸ªå›¾ç‰‡ä¸‹è½½ç±»ï¼Œä¸€ä¸ªé€šè¿‡ REST API éªŒè¯ç”¨æˆ·èµ„æ ¼çš„ç™»å½•ä¸šåŠ¡å®ä¾‹ï¼Œä»¥åŠä¸€ä¸ªåº”ç”¨å†…æµè§ˆå™¨ã€‚ä¸ºäº†å®ç°è¿™äº›ï¼Œä½ éœ€è¦åˆ›å»ºå¤šä¸ªç»§æ‰¿äºæˆ‘æä¾›çš„ <code>Observer</code> æŠ½è±¡ç±»ï¼ˆæ­¤åŸºç±»åŒæ—¶éµå¾ª <code>ObserverProtocol</code> åè®®ï¼‰çš„è‡ªå®šä¹‰å­ç±»ã€‚ï¼ˆæˆ‘ç¨åä¼šè§£é‡Šä¸ºä½•æˆ‘ä¼šæŠŠæˆ‘å…³äºè§‚å¯Ÿè€…çš„ç¤ºä¾‹ä»£ç æ”¾åœ¨ä¸€ä¸ªç±»ä¸­ï¼‰ã€‚</p><p>ä¸ºäº†å®ç°æˆ‘ç¤ºä¾‹åº”ç”¨ä¸­çš„è§‚å¯Ÿè€…ä»¬ï¼Œæˆ‘åˆ›å»ºäº†ä¸€ä¸ª <code>NetworkConnectionHandler</code> ç±»ã€‚å½“è¿™ä¸ªç±»çš„å…·ä½“å®ä¾‹æ¥æ”¶åˆ° <code>NetworkConnectionStatus.connected</code> é€šçŸ¥æ—¶ï¼Œè¿™äº›å®ä¾‹ä¼šæŠŠå‡ ä¸ªè§†å›¾å˜æˆç»¿è‰²ï¼›å½“æ¥æ”¶åˆ° <code>NetworkConnectionStatus.disconnected</code> é€šçŸ¥æ—¶ï¼Œä¼šæŠŠè§†å›¾å˜æˆçº¢è‰²ã€‚</p><p>ä¸‹é¢æ˜¯æˆ‘çš„ä»£ç åœ¨ iPhone 8 Plus è®¾å¤‡ä¸Šè¿è¡Œçš„æ•ˆæœï¼š</p><p><img src="https://www.appcoda.com/wp-content/uploads/2018/08/ObserverAppDemo.gif" alt="img"></p><p>ä¸Šé¢çš„è¿è¡Œè¿‡ç¨‹ä¸­ï¼ŒXcode æ§åˆ¶å°çš„è¾“å‡ºå¦‚ä¸‹ï¼š</p><p><img src="https://www.appcoda.com/wp-content/uploads/2018/08/ObserverAppConsoleOutput.gif" alt="img"></p><h3 id="è§‚å¯Ÿè€…æ¨¡å¼åº”ç”¨çš„ç¤ºä¾‹ä»£ç "><a href="#è§‚å¯Ÿè€…æ¨¡å¼åº”ç”¨çš„ç¤ºä¾‹ä»£ç " class="headerlink" title="è§‚å¯Ÿè€…æ¨¡å¼åº”ç”¨çš„ç¤ºä¾‹ä»£ç "></a>è§‚å¯Ÿè€…æ¨¡å¼åº”ç”¨çš„ç¤ºä¾‹ä»£ç </h3><p>å…³äºæˆ‘ä¸Šé¢æ‰€è¯´çš„ä»£ç ï¼Œä½ å¯ä»¥åœ¨é¡¹ç›®ä¸­çš„ <code>Observable.swift</code> æ–‡ä»¶æ‰¾åˆ°ã€‚æ¯æ®µä»£ç æˆ‘éƒ½åŠ ä¸Šäº†è¯¦ç»†çš„æ³¨é‡Šã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Foundation</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"> </span><br><span class="line"><span class="comment">// å®šä¹‰é€šçŸ¥åå¸¸é‡ã€‚</span></span><br><span class="line"><span class="comment">// ä½¿ç”¨å¸¸é‡ä½œä¸ºé€šçŸ¥åï¼Œä¸è¦ä½¿ç”¨å­—ç¬¦ä¸²æˆ–è€…æ•°å­—ã€‚</span></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Notification</span>.<span class="title">Name</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">let</span> networkConnection = <span class="type">Notification</span>.<span class="type">Name</span>(<span class="string">"networkConnection"</span>)</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">let</span> batteryStatus = <span class="type">Notification</span>.<span class="type">Name</span>(<span class="string">"batteryStatus"</span>)</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">let</span> locationChange = <span class="type">Notification</span>.<span class="type">Name</span>(<span class="string">"locationChange"</span>)</span><br><span class="line"> </span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// å®šä¹‰ç½‘ç»œçŠ¶æ€å¸¸é‡ã€‚</span></span><br><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">NetworkConnectionStatus</span>: <span class="title">String</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">case</span> connected</span><br><span class="line">    <span class="keyword">case</span> disconnected</span><br><span class="line">    <span class="keyword">case</span> connecting</span><br><span class="line">    <span class="keyword">case</span> disconnecting</span><br><span class="line">    <span class="keyword">case</span> error</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// å®šä¹‰ userInfo ä¸­çš„ key å€¼ã€‚</span></span><br><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">StatusKey</span>: <span class="title">String</span> </span>&#123;</span><br><span class="line">    <span class="keyword">case</span> networkStatusKey</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// æ­¤åè®®å®šä¹‰äº†*è§‚å¯Ÿè€…*çš„åŸºæœ¬ç»“æ„ã€‚</span></span><br><span class="line"><span class="comment">// è§‚å¯Ÿè€…å³ä¸€äº›å®ä½“çš„é›†åˆï¼Œå®ƒä»¬çš„æ“ä½œä¸¥æ ¼ä¾èµ–äºå…¶ä»–å®ä½“çš„çŠ¶æ€ã€‚</span></span><br><span class="line"><span class="comment">// éµå¾ªæ­¤åè®®çš„å®ä¾‹ä¼šå‘æŸäº›é‡è¦çš„å®ä½“/èµ„æº*è®¢é˜…*å¹¶*æ¥æ”¶*é€šçŸ¥ã€‚</span></span><br><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">ObserverProtocol</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> statusValue: <span class="type">String</span> &#123; <span class="keyword">get</span> <span class="keyword">set</span> &#125;</span><br><span class="line">    <span class="keyword">var</span> statusKey: <span class="type">String</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">    <span class="keyword">var</span> notificationOfInterest: <span class="type">Notification</span>.<span class="type">Name</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">subscribe</span><span class="params">()</span></span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">unsubscribe</span><span class="params">()</span></span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">handleNotification</span><span class="params">()</span></span></span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// æ­¤æ¨¡ç‰ˆç±»æŠ½è±¡å¦‚ä½•*è®¢é˜…*å’Œ*æ¥å—*é‡è¦å®ä½“/èµ„æºçš„é€šçŸ¥çš„æ‰€æœ‰å¿…è¦ç»†èŠ‚ã€‚</span></span><br><span class="line"><span class="comment">// æ­¤ç±»æä¾›äº†ä¸€ä¸ªé’©å­æ–¹æ³•ï¼ˆhandleNotification()ï¼‰ï¼Œ</span></span><br><span class="line"><span class="comment">// æ‰€æœ‰çš„å­ç±»å¯ä»¥é€šè¿‡æ­¤æ–¹æ³•åœ¨æ¥æ”¶åˆ°ç‰¹å®šé€šçŸ¥æ—¶è¿›è¡Œå„ç§éœ€è¦çš„æ“ä½œã€‚</span></span><br><span class="line"><span class="comment">// æ­¤ç±»åŸºä¸ºä¸€ä¸ª*æŠ½è±¡*ç±»ï¼Œå¹¶ä¸ä¼šåœ¨ç¼–è¯‘æ—¶è¢«æ£€æµ‹ï¼Œä½†è¿™ä¼¼ä¹æ˜¯ä¸€ä¸ªå¼‚å¸¸åœºæ™¯ã€‚</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Observer</span>: <span class="title">ObserverProtocol</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ­¤å˜é‡ä¸ notificationOfInterest é€šçŸ¥å…³è”ã€‚</span></span><br><span class="line">    <span class="comment">// ä½¿ç”¨å­—ç¬¦ä¸²ä»¥å°½å¯èƒ½æ»¡è¶³éœ€è¦ã€‚</span></span><br><span class="line">    <span class="keyword">var</span> statusValue: <span class="type">String</span></span><br><span class="line">    <span class="comment">// é€šçŸ¥çš„ userInfo ä¸­çš„ key å€¼ï¼Œ</span></span><br><span class="line">    <span class="comment">// é€šè¿‡æ­¤ key å€¼è¯»å–åˆ°ç‰¹å®šçš„çŠ¶æ€å€¼å¹¶å­˜å‚¨åˆ° statusValue å˜é‡ã€‚</span></span><br><span class="line">    <span class="comment">// ä½¿ç”¨å­—ç¬¦ä¸²ä»¥å°½å¯èƒ½æ»¡è¶³éœ€è¦ã€‚</span></span><br><span class="line">    <span class="keyword">let</span> statusKey: <span class="type">String</span></span><br><span class="line">    <span class="comment">// æ­¤ç±»æ‰€æ³¨å†Œçš„é€šçŸ¥åã€‚</span></span><br><span class="line">    <span class="keyword">let</span> notificationOfInterest: <span class="type">Notification</span>.<span class="type">Name</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// é€šè¿‡ä¼ å…¥çš„é€šçŸ¥åå’Œéœ€è¦è§‚å¯Ÿçš„çŠ¶æ€çš„ key å€¼è¿›è¡Œåˆå§‹åŒ–ã€‚</span></span><br><span class="line">    <span class="comment">// åˆå§‹åŒ–æ—¶ä¼šæ³¨å†Œ/è®¢é˜…/ç›‘å¬ç‰¹å®šçš„é€šçŸ¥å¹¶è§‚å¯Ÿç‰¹å®šçš„çŠ¶æ€ã€‚</span></span><br><span class="line">    <span class="keyword">init</span>(statusKey: <span class="type">StatusKey</span>, notification: <span class="type">Notification</span>.<span class="type">Name</span>) &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">self</span>.statusValue = <span class="string">"N/A"</span></span><br><span class="line">        <span class="keyword">self</span>.statusKey = statusKey.rawValue</span><br><span class="line">        <span class="keyword">self</span>.notificationOfInterest = notification</span><br><span class="line">        </span><br><span class="line">        subscribe()</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å‘ NotificationCenter æ³¨å†Œ self(this) æ¥æ¥æ”¶æ‰€æœ‰å­˜å‚¨åœ¨ notificationOfInterest ä¸­çš„é€šçŸ¥ã€‚</span></span><br><span class="line">    <span class="comment">// å½“æ¥æ”¶åˆ°ä»»æ„ä¸€ä¸ªæ³¨å†Œçš„é€šçŸ¥æ—¶ï¼Œä¼šè°ƒç”¨ receiveNotification(_:) æ–¹æ³•ã€‚</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">subscribe</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="type">NotificationCenter</span>.<span class="keyword">default</span>.addObserver(<span class="keyword">self</span>, selector: #selector(receiveNotification(<span class="number">_</span>:)), name: notificationOfInterest, object: <span class="literal">nil</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åœ¨ä¸éœ€è¦ç›‘å¬æ—¶æ³¨é”€æ‰€æœ‰å·²æ³¨å†Œçš„é€šçŸ¥æ˜¯ä¸€ä¸ªä¸é”™çš„åšæ³•ï¼Œ</span></span><br><span class="line">    <span class="comment">// ä½†è¿™ä¸»è¦æ˜¯ç”±äºå†å²åŸå› é€ æˆçš„ï¼ŒiOS 9.0 ä¹‹å OS ç³»ç»Ÿä¼šè‡ªåŠ¨åšä¸€äº›æ¸…ç†ã€‚</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">unsubscribe</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="type">NotificationCenter</span>.<span class="keyword">default</span>.removeObserver(<span class="keyword">self</span>, name: notificationOfInterest, object: <span class="literal">nil</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åœ¨ä»»æ„ä¸€ä¸ª notificationOfInterest æ‰€å®šä¹‰çš„é€šçŸ¥æ¥æ”¶åˆ°æ—¶è°ƒç”¨ã€‚</span></span><br><span class="line">    <span class="comment">// åœ¨æ­¤æ–¹æ³•ä¸­å¯ä»¥æ ¹æ®æ‰€è§‚å¯Ÿçš„é‡è¦èµ„æºçš„æ”¹å˜è¿›è¡Œä»»æ„æ“ä½œã€‚</span></span><br><span class="line">    <span class="comment">// æ­¤æ–¹æ³•**å¿…é¡»æœ‰ä¸”ä»…æœ‰ä¸€ä¸ªå‚æ•°ï¼ˆNSNotification å®ä¾‹ï¼‰ã€‚**</span></span><br><span class="line">    <span class="meta">@objc</span> <span class="function"><span class="keyword">func</span> <span class="title">receiveNotification</span><span class="params">(<span class="number">_</span> notification: Notification)</span></span> &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> userInfo = notification.userInfo, <span class="keyword">let</span> status = userInfo[statusKey] <span class="keyword">as</span>? <span class="type">String</span> &#123;</span><br><span class="line">            </span><br><span class="line">            statusValue = status</span><br><span class="line">            handleNotification()</span><br><span class="line">            </span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"Notification <span class="subst">\(notification.name)</span> received; status: <span class="subst">\(status)</span>"</span>)</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125; <span class="comment">// receiveNotification æ–¹æ³•ç»“æŸ</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// **å¿…é¡»é‡å†™æ­¤æ–¹æ³•ï¼›ä¸”å¿…é¡»ç»§æ‰¿æ­¤ç±»**</span></span><br><span class="line">    <span class="comment">// æˆ‘ä½¿ç”¨äº†äº›"æŠ€å·§"æ¥è®©æ­¤ç±»è¾¾åˆ°æŠ½è±¡ç±»çš„å½¢å¼ï¼Œå› æ­¤ä½ å¯ä»¥åœ¨å­ç±»ä¸­åšå…¶ä»–ä»»ä½•äº‹æƒ…è€Œä¸éœ€è¦å…³å¿ƒå…³äº NotificationCenter çš„ç»†èŠ‚ã€‚</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">handleNotification</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="built_in">fatalError</span>(<span class="string">"ERROR: You must override the [handleNotification] method."</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ææ„æ—¶å–æ¶ˆå¯¹ Notification çš„å…³è”ï¼Œæ­¤æ—¶å·²ç»ä¸éœ€è¦è¿›è¡Œè§‚å¯Ÿäº†ã€‚</span></span><br><span class="line">    <span class="keyword">deinit</span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"Observer unsubscribing from notifications."</span>)</span><br><span class="line">        unsubscribe()</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125; <span class="comment">// Observer ç±»ç»“æŸ</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">// ä¸€ä¸ªå…·ä½“è§‚å¯Ÿè€…çš„ä¾‹å­ã€‚</span></span><br><span class="line"><span class="comment">// é€šå¸¸æ¥è¯´ï¼Œä¼šæœ‰ä¸€ç³»åˆ—ï¼ˆè®¸å¤šï¼Ÿï¼‰çš„è§‚å¯Ÿè€…éƒ½ä¼šç›‘å¬ä¸€äº›å•ç‹¬ä¸”é‡è¦çš„èµ„æºå‘å‡ºçš„é€šçŸ¥ã€‚</span></span><br><span class="line"><span class="comment">// éœ€è¦æ³¨æ„æ­¤ç±»å·²ç»ç®€åŒ–äº†å®ç°ï¼Œå¹¶ä¸”å¯ä»¥ä½œä¸ºæ‰€æœ‰é€šçŸ¥çš„ handler çš„æ¨¡æ¿ã€‚</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">NetworkConnectionHandler</span>: <span class="title">Observer</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> view: <span class="type">UIView</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ä½ å¯ä»¥åˆ›å»ºä»»æ„ç±»å‹çš„æ„é€ å™¨ï¼Œåªéœ€è¦è°ƒç”¨ super.init å¹¶ä¼ å…¥åˆæ³•ä¸”å¯ä»¥é…åˆ NotificationCenter ä½¿ç”¨çš„é€šçŸ¥ã€‚</span></span><br><span class="line">    <span class="keyword">init</span>(view: <span class="type">UIView</span>) &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">self</span>.view = view</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">super</span>.<span class="keyword">init</span>(statusKey: .networkStatusKey, notification: .networkConnection)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// **å¿…é¡»é‡å†™æ­¤æ–¹æ³•**</span></span><br><span class="line">    <span class="comment">// æ­¤æ–¹æ³•ä¸­å¯ä»¥åŠ å…¥ä»»ä½•å¤„ç†é€šçŸ¥çš„é€»è¾‘ã€‚</span></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">handleNotification</span><span class="params">()</span></span> &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> statusValue == <span class="type">NetworkConnectionStatus</span>.connected.rawValue &#123;</span><br><span class="line">            view.backgroundColor = <span class="type">UIColor</span>.green</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            view.backgroundColor = <span class="type">UIColor</span>.red</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125; <span class="comment">// handleNotification() ç»“æŸ</span></span><br><span class="line">    </span><br><span class="line">&#125; <span class="comment">// NetworkConnectionHandler ç»“æŸ</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">// ä¸€ä¸ªè¢«è§‚å¯Ÿè€…çš„æ¨¡æ¿ã€‚</span></span><br><span class="line"><span class="comment">// é€šå¸¸è¢«è§‚å¯Ÿè€…éƒ½æ˜¯ä¸€äº›é‡è¦èµ„æºï¼Œåœ¨å…¶è‡ªèº«æŸäº›çŠ¶æ€å‘ç”Ÿæ”¹å˜æ—¶ä¼šå¹¿æ’­é€šçŸ¥ç»™æ‰€æœ‰è®¢é˜…è€…ã€‚</span></span><br><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">ObservedProtocol</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> statusKey: <span class="type">StatusKey</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">    <span class="keyword">var</span> notification: <span class="type">Notification</span>.<span class="type">Name</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">notifyObservers</span><span class="params">(about changeTo: String)</span></span> -&gt; <span class="type">Void</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// åœ¨ä»»æ„éµå¾ª ObservedProtocol ç¤ºä¾‹çš„æŸäº›çŠ¶æ€å‘ç”Ÿæ”¹å˜æ—¶ï¼Œä¼šé€šçŸ¥*æ‰€æœ‰*å·²è®¢é˜…çš„è§‚å¯Ÿè€…ã€‚</span></span><br><span class="line"><span class="comment">// **å‘æ‰€æœ‰è®¢é˜…è€…å¹¿æ’­**</span></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">ObservedProtocol</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">notifyObservers</span><span class="params">(about changeTo: String)</span></span> -&gt; <span class="type">Void</span> &#123;</span><br><span class="line">       <span class="type">NotificationCenter</span>.<span class="keyword">default</span>.post(name: notification, object: <span class="keyword">self</span>, userInfo: [statusKey.rawValue : changeTo])</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125; <span class="comment">// ObservedProtocol æ‰©å±•ç»“æŸ</span></span><br></pre></td></tr></table></figure><p>æˆ‘æŠŠå¤§éƒ¨åˆ†å…³äºè§‚å¯Ÿè€…çš„é€šçŸ¥å¤„ç†é€»è¾‘æ”¾åœ¨äº† <code>ObserverProtocol</code> çš„æ‰©å±•å½“ä¸­ï¼Œå¹¶ä¸”è¿™æ®µé€»è¾‘ä¼šåœ¨ä¸€ä¸ª <code>@objc</code> ä¿®é¥°çš„æ–¹æ³•ä¸­è¿è¡Œï¼ˆæ­¤æ–¹æ³•åŒæ—¶ä¼šè®¾ç½®ä¸ºé€šçŸ¥çš„ <code>#selector</code> çš„æ–¹æ³•ï¼‰ã€‚ä½œä¸ºæŠ½è±¡ç±»ä¸­çš„æ–¹æ³•ï¼Œç›¸è¾ƒäºä½¿ç”¨åŸºäº block çš„ <a href="https://developer.apple.com/documentation/foundation/notificationcenter/1411723-addobserver" target="_blank" rel="noopener"><code>addObserver(forName:object:queue:using:)</code></a> å¹¶æŠŠå¤„ç†é€šçŸ¥çš„é—­åŒ…ä¼ è¿›å»ï¼Œä½¿ç”¨ selector å¯ä»¥è®©è¿™æ®µé€šçŸ¥å¤„ç†ä»£ç æ˜¾å¾—æ›´åŠ å®¹æ˜“ç†è§£ä»¥åŠæ›´åŠ é€‚åˆæ•™å­¦ã€‚</p><p>åŒæ—¶ï¼Œæˆ‘æ„è¯†åˆ° Swift ä¸­å¹¶æ²¡æœ‰å…³äºæŠ½è±¡ç±»çš„å®˜æ–¹æ¦‚å¿µã€‚å› æ­¤ï¼Œä¸ºäº†å®Œæˆæˆ‘è§£é‡Šè§‚å¯Ÿè€…æ¨¡å¼çš„æ•™å­¦ç›®çš„ï¼Œæˆ‘å¼ºåˆ¶ä½¿ç”¨è€…é‡å†™ <code>Observer</code> çš„ <code>handleNotification()</code> æ–¹æ³•ï¼Œä»¥æ­¤æ¥è¾¾åˆ° â€œæŠ½è±¡ç±»â€ çš„å½¢æ€ã€‚å¦‚æ­¤ä»¥æ¥ï¼Œä½ å¯ä»¥æ³¨å…¥ä»»æ„çš„å¤„ç†é€»è¾‘ï¼Œè®©ä½ çš„å­ç±»å®ä¾‹åœ¨æ¥æ”¶åˆ°é€šçŸ¥åæœ‰ç‰¹å®šçš„è¡Œä¸ºã€‚</p><p>ä¸‹é¢æˆ‘å°†å±•ç¤ºç¤ºä¾‹é¡¹ç›®ä¸­çš„ <code>ViewController.swift</code> æ–‡ä»¶ï¼Œåœ¨è¿™é‡Œä½ å¯ä»¥çœ‹åˆ°åˆšåˆšè®¨è®ºè¿‡çš„  <code>Obesever.swift</code> ä¸­çš„æ ¸å¿ƒä»£ç æ˜¯å¦‚ä½•ä½¿ç”¨çš„ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"> </span><br><span class="line"><span class="comment">// æ­¤ view controller éµå¾ª ObservedProtocol åè®®ï¼Œå› æ­¤åœ¨*æ•´ä¸ªåº”ç”¨æœŸé—´*</span></span><br><span class="line"><span class="comment">// å…¶å¯ä»¥é€šè¿‡ NotificationCenter å‘*ä»»æ„*æœ‰æ„æ¥æ”¶çš„å®ä½“å¹¿æ’­é€šçŸ¥ã€‚</span></span><br><span class="line"><span class="comment">// å¯ä»¥çœ‹åˆ°è¿™ä¸ªç±»ä»…ä»…éœ€è¦å¾ˆå°‘é‡çš„ä»£ç ä¾¿å¯ä»¥å®ç°é€šçŸ¥çš„åŠŸèƒ½ã€‚</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewController</span>: <span class="title">UIViewController</span>, <span class="title">ObservedProtocol</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@IBOutlet</span> <span class="keyword">weak</span> <span class="keyword">var</span> topBox: <span class="type">UIView</span>!</span><br><span class="line">    <span class="meta">@IBOutlet</span> <span class="keyword">weak</span> <span class="keyword">var</span> middleBox: <span class="type">UIView</span>!</span><br><span class="line">    <span class="meta">@IBOutlet</span> <span class="keyword">weak</span> <span class="keyword">var</span> bottomBox: <span class="type">UIView</span>!</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Mock ä¸€äº›è´Ÿè´£è§‚å¯Ÿç½‘ç»œçŠ¶å†µçš„å®ä½“å¯¹è±¡ã€‚</span></span><br><span class="line">    <span class="keyword">var</span> networkConnectionHandler0: <span class="type">NetworkConnectionHandler</span>?</span><br><span class="line">    <span class="keyword">var</span> networkConnectionHandler1: <span class="type">NetworkConnectionHandler</span>?</span><br><span class="line">    <span class="keyword">var</span> networkConnectionHandler2: <span class="type">NetworkConnectionHandler</span>?</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// éµå¾ª ObservedProtocol çš„ä¸¤ä¸ªå±æ€§ã€‚</span></span><br><span class="line">    <span class="keyword">let</span> statusKey: <span class="type">StatusKey</span> = <span class="type">StatusKey</span>.networkStatusKey</span><br><span class="line">    <span class="keyword">let</span> notification: <span class="type">Notification</span>.<span class="type">Name</span> = .networkConnection</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.viewDidLoad()</span><br><span class="line">        <span class="comment">// åˆå§‹åŒ–è´Ÿè´£ç›‘å¬çš„å®ä½“å¯¹è±¡ã€‚</span></span><br><span class="line">        networkConnectionHandler0 = <span class="type">NetworkConnectionHandler</span>(view: topBox)</span><br><span class="line">        networkConnectionHandler1 = <span class="type">NetworkConnectionHandler</span>(view: middleBox)</span><br><span class="line">        networkConnectionHandler2 = <span class="type">NetworkConnectionHandler</span>(view: bottomBox)</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">didReceiveMemoryWarning</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.didReceiveMemoryWarning()</span><br><span class="line">        <span class="comment">// Dispose of any resources that can be recreated.</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Mock ä¸€ä¸ªå¯ä»¥æ”¹å˜çŠ¶æ€çš„é‡è¦èµ„æºã€‚</span></span><br><span class="line">    <span class="comment">// æ­¤å¤„æ¨¡æ‹Ÿæ­¤ ViewController å¯ä»¥æ£€æµ‹ç½‘ç»œè¿æ¥çŠ¶å†µï¼Œ</span></span><br><span class="line">    <span class="comment">// å½“ç½‘ç»œå¯ä»¥è¿æ¥æˆ–è€…ç½‘ç»œè¿æ¥ä¸¢å¤±æ—¶ï¼Œé€šçŸ¥æ‰€æœ‰æœ‰å…´è¶£çš„ç›‘å¬è€…ã€‚</span></span><br><span class="line">    <span class="meta">@IBAction</span> <span class="function"><span class="keyword">func</span> <span class="title">switchChanged</span><span class="params">(<span class="number">_</span> sender: Any)</span></span> &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">let</span> swtich:<span class="type">UISwitch</span> = sender <span class="keyword">as</span>! <span class="type">UISwitch</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> swtich.isOn &#123;</span><br><span class="line">            notifyObservers(about: <span class="type">NetworkConnectionStatus</span>.connected.rawValue)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            notifyObservers(about: <span class="type">NetworkConnectionStatus</span>.disconnected.rawValue)</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125; <span class="comment">// switchChanged å‡½æ•°ç»“æŸ</span></span><br><span class="line">    </span><br><span class="line">&#125; <span class="comment">// ViewController ç±»ç»“æŸ</span></span><br></pre></td></tr></table></figure><h2 id="å¤‡å¿˜å½•æ¨¡å¼"><a href="#å¤‡å¿˜å½•æ¨¡å¼" class="headerlink" title="å¤‡å¿˜å½•æ¨¡å¼"></a>å¤‡å¿˜å½•æ¨¡å¼</h2><p>å¤§éƒ¨åˆ† iOS å¼€å‘è€…å¯¹å¤‡å¿˜å½•æ¨¡å¼éƒ½å¾ˆç†Ÿæ‚‰ã€‚å›å¿†ä¸€ä¸‹ iOS ä¸­ååˆ†ä¾¿åˆ©çš„ <a href="https://developer.apple.com/documentation/foundation/archives_and_serialization" target="_blank" rel="noopener">å½’æ¡£å’Œåºåˆ—åŒ–åŠŸèƒ½</a>ï¼Œè®©ä½ èƒ½å¤Ÿ â€œåœ¨å¯¹è±¡å’ŒåŸºæœ¬æ•°æ®ç±»å‹åœ¨ plistã€JSON å’Œå…¶ä»–äºŒè¿›åˆ¶å½¢å¼ä¹‹é—´è‡ªç”±è½¬æ¢â€ã€‚å†å›å¿†ä¸€ä¸‹ iOS ä¸­çš„ <a href="https://developer.apple.com/documentation/uikit/view_controllers/preserving_your_app_s_ui_across_launches" target="_blank" rel="noopener">çŠ¶æ€ä¿å­˜å’Œæ¢å¤åŠŸèƒ½</a>ï¼Œå®ƒèƒ½å¤Ÿè®°ä½ä½ çš„åº”ç”¨è¢«ç³»ç»Ÿå¼ºåˆ¶æ€æ­»æ—¶çš„çŠ¶æ€ï¼Œå¹¶åœ¨ä¹‹åæ¢å¤æ­¤çŠ¶æ€ã€‚</p><p>å¤‡å¿˜å½•æ¨¡å¼å¯ä»¥ç†è§£ä¸ºåœ¨æŸä¸ªæ—¶åˆ»æ•æ‰ã€å±•ç¤ºä»¥åŠå‚¨å­˜ä»»æ„å®ä¾‹çš„å†…éƒ¨çŠ¶æ€ï¼ŒåŒæ—¶å…è®¸ä½ å¯ä»¥åœ¨éšåçš„æ—¶é—´å†…æŸ¥æ‰¾è¿™äº›ä¿å­˜ä¸‹æ¥çš„çŠ¶æ€å¹¶æ¢å¤å®ƒã€‚å½“ä½ æ¢å¤ä¸€ä¸ªå®ä¾‹çš„æŸä¸ªçŠ¶æ€æ—¶ï¼Œå®ƒåº”å½“å®Œå…¨åæ˜ å‡ºè¿™ä¸ªå®ä¾‹åœ¨è¢«æ•æ‰æ—¶çš„çŠ¶æ€ã€‚æ˜¾ç„¶ï¼Œè¦è¾¾åˆ°æ­¤æ•ˆæœï¼Œä½ å¿…é¡»ä¿è¯æ‰€æœ‰å®ä¾‹å±æ€§çš„è®¿é—®æƒé™åœ¨æ•æ‰å’Œæ¢å¤æ—¶éƒ½æ˜¯ä¸€æ ·çš„ â€”â€” ä¾‹å¦‚ï¼Œ<code>public</code> çš„æ•°æ®åº”æ¢å¤ä¸º <code>public</code> çš„å±æ€§ï¼Œ<code>private</code>  çš„æ•°æ®åº”æ¢å¤ä¸º <code>private</code> çš„å±æ€§ã€‚</p><p>ä¸ºäº†ç®€å•èµ·è§ï¼Œæˆ‘ä½¿ç”¨ iOS ç³»ç»Ÿæä¾›çš„ <code>UserDefaults</code> ä½œä¸ºæˆ‘å­˜å‚¨å’Œæ¢å¤å®ä¾‹çŠ¶æ€çš„æ ¸å¿ƒå·¥å…·ã€‚</p><h3 id="å¤‡å¿˜å½•æ¨¡å¼ç”¨ä¾‹"><a href="#å¤‡å¿˜å½•æ¨¡å¼ç”¨ä¾‹" class="headerlink" title="å¤‡å¿˜å½•æ¨¡å¼ç”¨ä¾‹"></a>å¤‡å¿˜å½•æ¨¡å¼ç”¨ä¾‹</h3><p>åœ¨æˆ‘çŸ¥é“äº† iOS æœ¬èº«å·²æä¾›äº†ä¾¿æ·çš„å½’æ¡£å’Œåºåˆ—åŒ–çš„åŠŸèƒ½åï¼Œæˆ‘éšå³ç¼–å†™äº†ä¸€äº›å¯ä»¥ä¿å­˜å’Œæ¢å¤ç±»çš„çŠ¶æ€çš„ç¤ºä¾‹ä»£ç ã€‚æˆ‘çš„ä»£ç å¾ˆå‡ºè‰²åœ°æŠ½è±¡å‡ºäº†å½’æ¡£å’Œè§£æ¡£çš„åŠŸèƒ½ï¼Œå› æ­¤ä½ å¯ä»¥åˆ©ç”¨è¿™äº›æŠ½è±¡æ–¹æ³•å­˜å‚¨å’Œæ¢å¤è®¸å¤šä¸åŒçš„å®ä¾‹å’Œå®ä¾‹çš„å±æ€§ã€‚ä¸è¿‡æˆ‘çš„ç¤ºä¾‹ä»£ç å¹¶éç”¨äºç”Ÿäº§ç¯å¢ƒä¸‹çš„ï¼Œå®ƒä»¬åªæ˜¯ä¸ºäº†è§£é‡Šå¤‡å¿˜å½•æ¨¡å¼è€Œç¼–å†™çš„æ•™å­¦æ€§ä»£ç ã€‚</p><p>ä½ å¯ä»¥åœ¨ Github ä¸Šæ‰¾åˆ°æˆ‘çš„ <a href="https://github.com/appcoda/Memento-Pattern-Swift" target="_blank" rel="noopener">ç¤ºä¾‹é¡¹ç›®</a>ã€‚è¿™ä¸ªé¡¹ç›®å±•ç¤ºäº†ä¸€ä¸ªåŒ…å«<code>firstName</code>ã€<code>lastName</code>  å’Œ <code>age</code> å±æ€§çš„ <code>User</code> ç±»å®ä¾‹ä¿å­˜åœ¨ <code>UserDefaults</code> ä¸­ï¼Œå¹¶éšåä» <code>UserDefaults</code> æ¢å¤çš„è¿‡ç¨‹ã€‚å¦‚åŒä¸‹é¢çš„æ•ˆæœä¸€æ ·ï¼Œä¸€å¼€å§‹ï¼Œå¹¶æ²¡æœ‰ä»»ä½• <code>User</code> å®ä¾‹æä¾›ç»™æˆ‘è¿›è¡Œæ¢å¤ï¼Œéšåæˆ‘è¾“å…¥äº†ä¸€ä¸ªå¹¶æŠŠå®ƒå½’æ¡£ï¼Œç„¶åå†æ¢å¤å®ƒï¼š</p><p><img src="https://www.appcoda.com/wp-content/uploads/2018/08/MementoDemoApp.gif" alt="MementoDemoApp"></p><p>ä¸Šé¢è¿‡ç¨‹ä¸­æ§åˆ¶å°è¾“å‡ºå¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Empty entity.</span><br><span class="line"> </span><br><span class="line">lastName: Adams</span><br><span class="line">age: 87</span><br><span class="line">firstName: John</span><br><span class="line"> </span><br><span class="line">lastName: Adams</span><br><span class="line">age: 87</span><br><span class="line">firstName: John</span><br></pre></td></tr></table></figure><h3 id="å¤‡å¿˜å½•æ¨¡å¼ç¤ºä¾‹ä»£ç "><a href="#å¤‡å¿˜å½•æ¨¡å¼ç¤ºä¾‹ä»£ç " class="headerlink" title="å¤‡å¿˜å½•æ¨¡å¼ç¤ºä¾‹ä»£ç "></a>å¤‡å¿˜å½•æ¨¡å¼ç¤ºä¾‹ä»£ç </h3><p>æˆ‘æ‰€å®ç°çš„å¤‡å¿˜å½•æ¨¡å¼éå¸¸ç›´ç™½ã€‚ä»£ç ä¸­åŒ…å«äº†ä¸€ä¸ª <code>Memento</code> åè®®ï¼Œä»¥åŠ <code>Memento</code> åè®®çš„æ‰©å±•ï¼Œç”¨äºåœ¨æˆå‘˜å±æ€§ä¸­å­˜åœ¨éµå¾ª <code>Memento</code> åè®®çš„å±æ€§æ—¶ï¼Œå¤„ç†å’ŒæŠ½è±¡å…³äºå½’æ¡£ä¸è§£æ¡£çš„é€»è¾‘ã€‚ä¸æ­¤åŒæ—¶ï¼Œè¿™ä¸ªåè®®æ‰©å±•å…è®¸åœ¨ä»»ä½•æ—¶å€™æ‰“å°å®ä¾‹çš„æ‰€æœ‰çŠ¶æ€ã€‚æˆ‘ä½¿ç”¨äº†ä¸€ä¸ª <code>Dictionary&lt;String, String&gt;</code> æ¥å­˜å‚¨é‚£äº›éµå¾ªåè®®çš„ç±»ä¸­çš„å±æ€§ â€”â€” å±æ€§åä½œä¸ºå­—å…¸çš„ Keyï¼Œå±æ€§å€¼ä½œä¸ºå­—å…¸çš„ Valueã€‚æˆ‘æŠŠå±æ€§çš„å€¼ä»¥å­—ç¬¦ä¸²çš„ç±»å‹å­˜å‚¨ï¼Œä»¥æ­¤è¾¾åˆ°ä»£ç è¾ƒç®€æ´ä¸”å®¹æ˜“ç†è§£çš„ç›®çš„ï¼Œä½†æˆ‘å¿…é¡»æ‰¿è®¤å®é™…æƒ…å†µä¸­æœ‰è®¸å¤šç”¨ä¾‹ä¼šè¦æ±‚ä½ å»æ“ä½œéå¸¸å¤æ‚çš„å±æ€§ç±»å‹ã€‚å½’æ ¹åˆ°åº•ï¼Œè¿™æ˜¯ä¸€ä¸ªå…³äºè®¾è®¡æ¨¡å¼çš„æ•™ç¨‹ï¼Œå› æ­¤æ²¡æœ‰ä»»ä½•ä»£ç æ˜¯åŸºäºç”Ÿäº§ç¯å¢ƒæ¥ç¼–å†™çš„ã€‚</p><p>éœ€è¦æ³¨æ„æˆ‘ä¸º <code>Memento</code> åè®®åŠ äº†ä¸€ä¸ª <code>persist()</code> æ–¹æ³•å’Œä¸€ä¸ª <code>recover()</code> æ–¹æ³•ï¼Œä»»ä½•éµå¾ªæ­¤åè®®çš„ç±»éƒ½å¿…é¡»å®ç°å®ƒä»¬ã€‚è¿™ä¸¤ä¸ªæ–¹æ³•è®©å¼€å‘è€…å¯ä»¥æ ¹æ®å®é™…éœ€è¦ï¼Œé€šè¿‡åå­—æ¥å½’æ¡£å’Œè§£æ¡£æŸä¸ªéµå¾ª <code>Memento</code> åè®®çš„ç±»ä¸­çš„ç‰¹å®šå±æ€§ã€‚æ¢å¥è¯è¯´ï¼Œ<code>Memento</code> ä¸­ç±»å‹ä¸º <code>Dictionary&lt;String, String&gt;</code> çš„ <code>state</code> å±æ€§å¯ä»¥ä¸€å¯¹ä¸€åœ°å¯¹åº”åˆ°æŸä¸ªéµå¾ªæ­¤åè®®çš„ç±»ä¸­çš„å±æ€§ï¼Œè¿™äº›å±æ€§çš„åç§°å¯¹åº”å­—å…¸ä¸­å…ƒç´ çš„ keyï¼Œå±æ€§çš„å€¼å¯¹åº”å­—å…¸ä¸­å…ƒç´ çš„ valueã€‚ç›¸ä¿¡ä½ åœ¨çœ‹å®Œå…·ä½“çš„ä»£ç åè‚¯å®šèƒ½å®Œå…¨ç†è§£ã€‚</p><p>ç”±äºéµå¾ª <code>Memento</code> åè®®çš„ç±»å¿…é¡»å®ç°  <code>persist()</code> å’Œ <code>recover()</code> æ–¹æ³•ï¼Œå› æ­¤è¿™ä¸¤ä¸ªæ–¹æ³•å¿…é¡»å¯ä»¥è®¿é—®æ‰€æœ‰å¯è§çš„å±æ€§ï¼Œæ— è®ºå®ƒå…·æœ‰ä»€ä¹ˆæ ·çš„è®¿é—®æƒé™ â€”â€”  <code>public</code> ã€<code>private</code>  è¿˜æ˜¯  <code>fileprivate</code>ã€‚</p><p>ä½ æˆ–è®¸ä¹Ÿæƒ³çŸ¥é“æˆ‘ä¸ºä»€ä¹ˆæŠŠ <code>Memento</code> åè®®è®¾ç½®ä¸ºç±»åè®®ï¼ˆclass-onlyï¼‰ã€‚åŸå› ä»…ä»…æ˜¯å› ä¸º Swift ç¼–è¯‘å™¨é‚£è¯¡å¼‚çš„æŠ¥é”™ï¼šâ€Cannot use mutating member on immutable value: â€˜selfâ€™ is immutableâ€ã€‚æˆ‘ä»¬æš‚ä¸”ä¸è®¨è®ºè¿™ä¸ªé—®é¢˜ï¼Œå› ä¸ºå®ƒè¿œè¿œè¶…å‡ºäº†æœ¬æ¬¡æ•™ç¨‹çš„èŒƒå›´ã€‚å¦‚æœä½ å¯¹è¿™ä¸ªé—®é¢˜æ„Ÿå…´è¶£ï¼Œä½ å¯ä»¥çœ‹ä¸€ä¸‹è¿™ä¸ª <a href="https://www.bignerdranch.com/blog/protocol-oriented-problems-and-the-immutable-self-error/" target="_blank" rel="noopener">ä¸é”™çš„è§£é‡Š</a>ã€‚</p><p>æ¥ä¸‹æ¥å°±åˆ°äº†ä»£ç çš„éƒ¨åˆ†ã€‚é¦–å…ˆï¼Œä½ å¯ä»¥åœ¨æˆ‘ç¤ºä¾‹é¡¹ç›®ä¸­çš„ <code>Memento.swift</code> æ–‡ä»¶æ‰¾åˆ°å…³äºå¤‡å¿˜å½•æ¨¡å¼çš„æ ¸å¿ƒå®ç°ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Foundation</span><br><span class="line"> </span><br><span class="line"><span class="comment">// ç”±äº"Cannot use mutating member on immutable value: â€˜selfâ€™ is immutable"æŠ¥é”™é—®é¢˜ï¼Œ</span></span><br><span class="line"><span class="comment">// æ­¤åè®®å®šä¹‰ä¸ºç±»åè®®ï¼Œä»…é€‚ç”¨äºå¼•ç”¨ç±»å‹ã€‚</span></span><br><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">Memento</span> : <span class="title">class</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è®¿é—® UserDefaults ä¸­ state å±æ€§çš„ key å€¼ã€‚</span></span><br><span class="line">    <span class="keyword">var</span> stateName: <span class="type">String</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å­˜å‚¨éµå¾ªæ­¤åè®®çš„ç±»å½“å‰çŠ¶æ€ä¸‹çš„æ‰€æœ‰å±æ€§åï¼ˆkeyï¼‰å’Œå±æ€§å€¼ã€‚</span></span><br><span class="line">    <span class="keyword">var</span> state: <span class="type">Dictionary</span>&lt;<span class="type">String</span>, <span class="type">String</span>&gt; &#123; <span class="keyword">get</span> <span class="keyword">set</span> &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ä»¥ç‰¹å®šçš„ stateName ä¸º key å°† state å±æ€§å­˜å…¥ UserDefaults ä¸­ã€‚</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">save</span><span class="params">()</span></span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ä»¥ç‰¹å®šçš„ stateName ä¸º key ä» UserDefaults ä¸­è¯»å– stateã€‚</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">restore</span><span class="params">()</span></span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å¯è‡ªå®šä¹‰ï¼Œä»¥ç‰¹å®šæ–¹å¼æŠŠéµå¾ªæ­¤åè®®çš„ç±»çš„å±æ€§å­˜å‚¨åˆ° state å­—å…¸ã€‚</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">persist</span><span class="params">()</span></span></span><br><span class="line">    </span><br><span class="line">   <span class="comment">// å¯è‡ªå®šä¹‰ï¼Œä»¥ç‰¹å®šæ–¹å¼ä» state å­—å…¸è¯»å–å±æ€§ã€‚</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">recover</span><span class="params">()</span></span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// éå† state å­—å…¸å¹¶æ‰“å°æ‰€æœ‰æˆå‘˜å±æ€§ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š</span></span><br><span class="line">    <span class="comment">// </span></span><br><span class="line">    <span class="comment">// å±æ€§ 1 åå­—ï¼ˆkeyï¼‰ï¼šå±æ€§ 1 çš„å€¼</span></span><br><span class="line">    <span class="comment">// å±æ€§ 2 åå­—ï¼ˆkeyï¼‰ï¼šå±æ€§ 2 çš„å€¼</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">show</span><span class="params">()</span></span></span><br><span class="line">    </span><br><span class="line">&#125; <span class="comment">// Memento åè®®ç»“æŸ</span></span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Memento</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ä¿å­˜ state åˆ°ç£ç›˜ä¸­ã€‚</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">save</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="type">UserDefaults</span>.standard.<span class="keyword">set</span>(state, forKey: stateName)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ä»ç£ç›˜ä¸­è¯»å– stateã€‚</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">restore</span><span class="params">()</span></span> &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> dictionary = <span class="type">UserDefaults</span>.standard.object(forKey: stateName) <span class="keyword">as</span>! <span class="type">Dictionary</span>&lt;<span class="type">String</span>, <span class="type">String</span>&gt;? &#123;</span><br><span class="line">            state = dictionary</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            state.removeAll()</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125; <span class="comment">// restore() å‡½æ•°ç»“æŸ</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ä»¥å­—å…¸çš„å½¢å¼ä¿å­˜å½“å‰çŠ¶æ€å¯ä»¥å¾ˆæ–¹ä¾¿åœ°è¿›è¡Œå¯è§†åŒ–è¾“å‡ºã€‚</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">show</span><span class="params">()</span></span> &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">var</span> line = <span class="string">""</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> state.<span class="built_in">count</span> &gt; <span class="number">0</span> &#123;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">for</span> (key, value) <span class="keyword">in</span> state &#123;</span><br><span class="line">                line += key + <span class="string">": "</span> + value + <span class="string">"\n"</span></span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="built_in">print</span>(line)</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"Empty entity.\n"</span>)</span><br><span class="line">        &#125;</span><br><span class="line">            </span><br><span class="line">    &#125; <span class="comment">// show() å‡½æ•°ç»“æŸ</span></span><br><span class="line">    </span><br><span class="line">&#125; <span class="comment">// Memento æ‰©å±•ç»“æŸ</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">// é€šè¿‡éµå¾ª Memento åè®®ï¼Œä»»ä½•ç±»éƒ½å¯ä»¥æ–¹ä¾¿åœ°åœ¨æ•´ä¸ªåº”æœ‰è¿è¡ŒæœŸé—´</span></span><br><span class="line"><span class="comment">// ä¿å­˜å…¶å®Œæ•´çŠ¶æ€ï¼Œå¹¶èƒ½éšåä»»æ„æ—¶é—´è¿›è¡Œè¯»å–ã€‚</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span>: <span class="title">Memento</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Memento å¿…é¡»éµå¾ªçš„å±æ€§ã€‚</span></span><br><span class="line">    <span class="keyword">let</span> stateName: <span class="type">String</span></span><br><span class="line">    <span class="keyword">var</span> state: <span class="type">Dictionary</span>&lt;<span class="type">String</span>, <span class="type">String</span>&gt;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ­¤ç±»ç‹¬æœ‰çš„å‡ ä¸ªå±æ€§ï¼Œç”¨äºä¿å­˜ç³»ç»Ÿç”¨æˆ·è´¦å·ã€‚</span></span><br><span class="line">    <span class="keyword">var</span> firstName: <span class="type">String</span></span><br><span class="line">    <span class="keyword">var</span> lastName: <span class="type">String</span></span><br><span class="line">    <span class="keyword">var</span> age: <span class="type">String</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ­¤æ„é€ å™¨å¯ç”¨äºä¿å­˜æ–°ç”¨æˆ·åˆ°ç£ç›˜ï¼Œæˆ–è€…æ›´æ–°ä¸€ä¸ªç°æœ‰çš„ç”¨æˆ·ã€‚</span></span><br><span class="line">    <span class="comment">// æŒä¹…åŒ–å‚¨å­˜æ‰€ç”¨çš„ key å€¼ä¸º stateName å±æ€§ã€‚</span></span><br><span class="line">    <span class="keyword">init</span>(firstName: <span class="type">String</span>, lastName: <span class="type">String</span>, age: <span class="type">String</span>, stateName: <span class="type">String</span>) &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">self</span>.firstName = firstName</span><br><span class="line">        <span class="keyword">self</span>.lastName = lastName</span><br><span class="line">        <span class="keyword">self</span>.age = age</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">self</span>.stateName = stateName</span><br><span class="line">        <span class="keyword">self</span>.state = <span class="type">Dictionary</span>&lt;<span class="type">String</span>, <span class="type">String</span>&gt;()</span><br><span class="line">        </span><br><span class="line">        persist()</span><br><span class="line">        </span><br><span class="line">    &#125; <span class="comment">// æ„é€ å™¨å®šä¹‰ç»“æŸ</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ­¤æ„é€ å™¨å¯ä»¥ä»ç£ç›˜ä¸­è¯»å–å‡ºä¸€ä¸ªå·²å­˜åœ¨çš„ç”¨æˆ·ä¿¡æ¯ã€‚</span></span><br><span class="line">    <span class="comment">// è¯»å–æ‰€ä½¿ç”¨çš„ key å€¼ä¸º stateName å±æ€§ã€‚</span></span><br><span class="line">    <span class="keyword">init</span>(stateName: <span class="type">String</span>) &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">self</span>.stateName = stateName</span><br><span class="line">        <span class="keyword">self</span>.state = <span class="type">Dictionary</span>&lt;<span class="type">String</span>, <span class="type">String</span>&gt;()</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">self</span>.firstName = <span class="string">""</span></span><br><span class="line">        <span class="keyword">self</span>.lastName = <span class="string">""</span></span><br><span class="line">        <span class="keyword">self</span>.age = <span class="string">""</span></span><br><span class="line">        </span><br><span class="line">        recover()</span><br><span class="line">        </span><br><span class="line">    &#125; <span class="comment">// æ„é€ å™¨å®šä¹‰ç»“æŸ</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">// æŒä¹…åŒ–å­˜å‚¨ç”¨æˆ·å±æ€§ã€‚</span></span><br><span class="line">    <span class="comment">// æ­¤å¤„å¾ˆç›´è§‚åœ°å°†æ¯ä¸ªå±æ€§ä¸€å¯¹ä¸€åœ°ä»¥"å±æ€§å-å±æ€§å€¼"çš„å½¢å¼å­˜å…¥å­—å…¸ä¸­ã€‚</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">persist</span><span class="params">()</span></span> &#123;</span><br><span class="line">        </span><br><span class="line">        state[<span class="string">"firstName"</span>] = firstName</span><br><span class="line">        state[<span class="string">"lastName"</span>] = lastName</span><br><span class="line">        state[<span class="string">"age"</span>] = age</span><br><span class="line">        </span><br><span class="line">        save() <span class="comment">// leverage protocol extension</span></span><br><span class="line">        </span><br><span class="line">    &#125; <span class="comment">// persist() å‡½æ•°ç»“æŸ</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è¯»å–å·²å­˜å‚¨çš„ç”¨æˆ·å±æ€§ã€‚</span></span><br><span class="line">    <span class="comment">// ä» UserDefaults ä¸­è¯»å–äº† state å­—å…¸å</span></span><br><span class="line">    <span class="comment">// ä¼šç®€å•åœ°ä»¥å±æ€§åä¸º key ä»å­—å…¸ä¸­è¯»å–å‡ºå±æ€§å€¼ã€‚</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">recover</span><span class="params">()</span></span> &#123;</span><br><span class="line">        </span><br><span class="line">        restore() <span class="comment">// leverage protocol extension</span></span><br><span class="line">            </span><br><span class="line">        <span class="keyword">if</span> state.<span class="built_in">count</span> &gt; <span class="number">0</span> &#123;</span><br><span class="line">            firstName = state[<span class="string">"firstName"</span>]!</span><br><span class="line">            lastName = state[<span class="string">"lastName"</span>]!</span><br><span class="line">            age = state[<span class="string">"age"</span>]!</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">self</span>.firstName = <span class="string">""</span></span><br><span class="line">            <span class="keyword">self</span>.lastName = <span class="string">""</span></span><br><span class="line">            <span class="keyword">self</span>.age = <span class="string">""</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125; <span class="comment">// recover() å‡½æ•°ç»“æŸ</span></span><br><span class="line">    </span><br><span class="line">&#125; <span class="comment">// user ç±»ç»“æŸ</span></span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥ï¼Œä½ å¯ä»¥åœ¨ç¤ºä¾‹é¡¹ç›®ä¸­çš„ <code>ViewController.swift</code>  æ–‡ä»¶ä¸­æ‰¾åˆ°æˆ‘ä¸Šé—®æ‰€è¯´çš„å…³äºå¤‡å¿˜å½•æ¨¡å¼çš„ä½¿ç”¨ç”¨ä¾‹ï¼ˆå¯¹ <code>User</code> ç±»çš„å½’æ¡£å’Œè§£æ¡£ï¼‰ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewController</span>: <span class="title">UIViewController</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@IBOutlet</span> <span class="keyword">weak</span> <span class="keyword">var</span> firstNameTextField: <span class="type">UITextField</span>!</span><br><span class="line">    <span class="meta">@IBOutlet</span> <span class="keyword">weak</span> <span class="keyword">var</span> lastNameTextField: <span class="type">UITextField</span>!</span><br><span class="line">    <span class="meta">@IBOutlet</span> <span class="keyword">weak</span> <span class="keyword">var</span> ageTextField: <span class="type">UITextField</span>!</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.viewDidLoad()</span><br><span class="line">        <span class="comment">// Do any additional setup after loading the view, typically from a nib.</span></span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">didReceiveMemoryWarning</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.didReceiveMemoryWarning()</span><br><span class="line">        <span class="comment">// Dispose of any resources that can be recreated.</span></span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// "ä¿å­˜ç”¨æˆ·" æŒ‰é’®æŒ‰ä¸‹æ—¶è°ƒç”¨æ­¤æ–¹æ³•ã€‚</span></span><br><span class="line">    <span class="comment">// ä»¥ "userKey" ä½œä¸º stateName çš„å€¼å°† User ç±»å®ä¾‹çš„å±æ€§</span></span><br><span class="line">    <span class="comment">// ä¿å­˜åˆ° UserDefaults ä¸­ã€‚</span></span><br><span class="line">    <span class="meta">@IBAction</span> <span class="function"><span class="keyword">func</span> <span class="title">saveUserTapped</span><span class="params">(<span class="number">_</span> sender: Any)</span></span> &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> firstNameTextField.text != <span class="string">""</span> &amp;&amp;</span><br><span class="line">            lastNameTextField.text != <span class="string">""</span> &amp;&amp;</span><br><span class="line">            ageTextField.text != <span class="string">""</span> &#123;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">let</span> user = <span class="type">User</span>(firstName: firstNameTextField.text!,</span><br><span class="line">                            lastName: lastNameTextField.text!,</span><br><span class="line">                            age: ageTextField.text!,</span><br><span class="line">                            stateName: <span class="string">"userKey"</span>)</span><br><span class="line">            user.show()</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125; <span class="comment">// saveUserTapped å‡½æ•°ç»“æŸ</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åœ¨"æ¢å¤ç”¨æˆ·"æŒ‰é’®æŒ‰ä¸‹æ—¶è°ƒç”¨æ­¤æ–¹æ³•ã€‚</span></span><br><span class="line">    <span class="comment">// ä»¥ "userKey" ä½œä¸º stateName çš„å€¼å°† User ç±»å®ä¾‹çš„å±æ€§</span></span><br><span class="line">    <span class="comment">// ä» UserDefaults ä¸­è¯»å–å‡ºæ¥ã€‚</span></span><br><span class="line">    <span class="meta">@IBAction</span> <span class="function"><span class="keyword">func</span> <span class="title">restoreUserTapped</span><span class="params">(<span class="number">_</span> sender: Any)</span></span> &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">let</span> user = <span class="type">User</span>(stateName: <span class="string">"userKey"</span>)</span><br><span class="line">        firstNameTextField.text = user.firstName</span><br><span class="line">        lastNameTextField.text = user.lastName</span><br><span class="line">        ageTextField.text = user.age</span><br><span class="line">        user.show()</span><br><span class="line"> </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125; <span class="comment">// ViewController ç±»ç»“æŸ</span></span><br></pre></td></tr></table></figure><h2 id="ç»“è®º"><a href="#ç»“è®º" class="headerlink" title="ç»“è®º"></a>ç»“è®º</h2><p>å³ä¾¿ GoF çš„è®¾è®¡æ¨¡å¼å·²ç»åœ¨å¤šæ•°å¼€å‘è€…å¿ƒä¸­è¢«è§†ä¸ºåœ£ç»èˆ¬çš„å­˜åœ¨ï¼ˆæˆ‘åœ¨æ–‡ç« å¼€å¤´æåˆ°çš„ï¼‰ï¼Œä½†ä»æœ‰æŸäº›å¯¹è®¾è®¡æ¨¡å¼æŒæœ‰æ‰¹è¯„æ„è§çš„äººè®¤ä¸ºï¼Œè®¾è®¡æ¨¡å¼çš„ä½¿ç”¨æ°æ°æ˜¯æˆ‘ä»¬å¯¹ç¼–ç¨‹è¯­è¨€ä¸å¤Ÿäº†è§£æˆ–ä½¿ç”¨ä¸å¤Ÿå·§å¦™çš„è¯æ˜ï¼Œè€Œä¸”åœ¨ä»£ç ä¸­é¢‘ç¹ä½¿ç”¨è®¾è®¡æ¨¡å¼å¹¶ä¸æ˜¯ä¸€ä»¶å¥½äº‹ã€‚æˆ‘ä¸ªäººå¹¶ä¸è®¤åŒæ­¤çœ‹æ³•ã€‚å¯¹äºä¸€äº›æ‹¥æœ‰å‡ ä¹æ‰€æœ‰èƒ½æƒ³è±¡å¾—åˆ°çš„ç‰¹æ€§çš„è¯­è¨€ï¼Œä¾‹å¦‚ C++ è¿™ç§éå¸¸åºå¤§çš„ç¼–ç¨‹è¯­è¨€æ¥è¯´ï¼Œè¿™ç§æ„è§æˆ–è®¸ä¼šé€‚ç”¨ï¼Œä½†è¯¸å¦‚æ­¤ç±»çš„è¯­è¨€é€šå¸¸æå…¶å¤æ‚ä»¥è‡´äºæˆ‘ä»¬å¾ˆéš¾å»å­¦ä¹ ã€ä½¿ç”¨å¹¶æŒæ¡å®ƒã€‚èƒ½å¤Ÿè¯†åˆ«å‡ºå¹¶è§£å†³ä¸€äº›é‡å¤å‡ºç°çš„é—®é¢˜æ˜¯æˆ‘ä»¬ä½œä¸ºäººç±»çš„ä¼˜ç‚¹ä¹‹ä¸€ï¼Œæˆ‘ä»¬å¹¶ä¸åº”è¯¥æŠ—æ‹’å®ƒã€‚è€Œè®¾è®¡æ¨¡å¼æ°å·§æ˜¯äººç±»ä»å†å²é”™è¯¯ä¸­å¸å–æ•™è®­ï¼Œå¹¶åŠ ä»¥æ”¹è¿›çš„ç»ä½³ä¾‹å­ã€‚åŒæ—¶ï¼Œè®¾è®¡æ¨¡å¼å¯¹ä¸€äº›é€šç”¨çš„é—®é¢˜ç»™å‡ºäº†æŠ½è±¡åŒ–ä¸”æ ‡å‡†åŒ–çš„è§£å†³æ–¹æ¡ˆï¼Œæé«˜äº†è§£å†³è¿™äº›é—®é¢˜çš„å¯èƒ½æ€§å’Œå¯éƒ¨ç½²æ€§ã€‚</p><p>æŠŠä¸€é—¨ç®€æ´çš„ç¼–ç¨‹è¯­è¨€å’Œä¸€ç³»åˆ—æœ€ä½³å®è·µç»“åˆèµ·æ¥æ˜¯ä¸€ä»¶ç¾å¦™çš„äº‹æƒ…ï¼Œä¾‹å¦‚ Swift å’Œè®¾è®¡æ¨¡å¼çš„ç»“åˆã€‚é«˜ä¸€è‡´æ€§çš„ä»£ç é€šå¸¸ä¹Ÿæœ‰é«˜å¯è¯»æ€§å’Œé«˜å¯ç»´æŠ¤æ€§ã€‚åŒæ—¶ä½ è¦è®°å¾—ä¸€ä»¶äº‹ï¼Œè®¾è®¡æ¨¡å¼æ˜¯é€šè¿‡æˆåƒä¸Šä¸‡çš„å¼€å‘è€…ä»¬ä¸æ–­åœ°è®¨è®ºå’Œäº¤æµæƒ³æ³•è€ŒæŒç»­å®Œå–„çš„ã€‚é€šè¿‡ä¸‡ç»´ç½‘å¸¦æ¥çš„ä¾¿æ·æ€§ï¼Œå¼€å‘è€…ä»¬åœ¨è™šæ‹Ÿä¸–ç•Œç›¸äº’è¿æ¥ï¼Œä»–ä»¬çš„è®¨è®ºä¸æ–­ç¢°æ’å‡ºå¤©æ‰çš„ç«èŠ±ã€‚</p><blockquote><p>æœ¬æ–‡ç”± SwiftGG ç¿»è¯‘ç»„ç¿»è¯‘ï¼Œå·²ç»è·å¾—ä½œè€…ç¿»è¯‘æˆæƒï¼Œæœ€æ–°æ–‡ç« è¯·è®¿é—® <a href="http://swift.gg">http://swift.gg</a>ã€‚</p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;ä½œè€…ï¼šAndrew Jaffeeï¼Œ&lt;a href=&quot;https://www.appcoda.com/design-pattern-behavorial/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;åŸæ–‡é“¾æ¥&lt;/a&gt;ï¼ŒåŸæ–‡æ—¥æœŸï¼š2018-08-06&lt;br&gt;è¯‘è€…ï¼š&lt;a href=&quot;https://dingtz.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;jojotov&lt;/a&gt;ï¼›æ ¡å¯¹ï¼š&lt;a href=&quot;http://forelax.space&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Forelax&lt;/a&gt;ï¼Œ&lt;a href=&quot;http://www.jianshu.com/users/596f2ba91ce9/latest_articles&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;pmst&lt;/a&gt;ï¼›å®šç¨¿ï¼š&lt;a href=&quot;http://forelax.space&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Forelax&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;!--æ­¤å¤„å¼€å§‹æ­£æ–‡--&gt;
&lt;p&gt;æœ¬æ¬¡æ•™ç¨‹æ˜¯ AppCoda &lt;a href=&quot;https://swift.gg/2018/09/10/design-pattern-creational/&quot;&gt;ä¸Šå‘¨å¼€å¯&lt;/a&gt; çš„è®¾è®¡æ¨¡å¼ç³»åˆ—çš„ç¬¬äºŒæœŸã€‚åœ¨è½¯ä»¶è®¾è®¡é¢†åŸŸçš„å››ä½å¤§å¸ˆçº§äººç‰©ï¼ˆGoFï¼Œåˆç§°â€œå››äººå¸®â€æˆ–â€œGang of Fourâ€ï¼‰ â€”â€” Erich Gamma, Richard Helm, Ralph Johnson å’Œ John Vlissides æ‰€è‘—çš„ ã€Šè®¾è®¡æ¨¡å¼ï¼šå¯å¤ç”¨é¢å‘å¯¹è±¡è½¯ä»¶çš„åŸºç¡€ã€‹ä¸€ä¹¦ä¸­ï¼Œé¦–æ¬¡å¯¹è½¯ä»¶è®¾è®¡ä¸­æ€»å…± 23 ç§è®¾è®¡æ¨¡å¼è¿›è¡Œäº†å®šä¹‰å’Œå½’ç±»ï¼Œå¹¶å¯¹å®ƒä»¬ä½œäº†ä¸“ä¸šé˜è¿°ã€‚ä»Šå¤©ï¼Œæˆ‘ä»¬å°†èšç„¦äºå…¶ä¸­ä¸¤ä¸ªè¡Œä¸ºå‹è®¾è®¡æ¨¡å¼ â€”â€” â€œè§‚å¯Ÿè€…æ¨¡å¼â€ å’Œ â€œå¤‡å¿˜å½•æ¨¡å¼â€ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="Swift" scheme="https://swift.gg/categories/Swift/"/>
    
    
      <category term="Design Patterns" scheme="https://swift.gg/tags/Design-Patterns/"/>
    
  </entry>
  
  <entry>
    <title>å®ç”¨çš„å¯é€‰é¡¹ï¼ˆOptionalï¼‰æ‰©å±•</title>
    <link href="https://swift.gg/2018/11/19/useful-optional-extensions/"/>
    <id>https://swift.gg/2018/11/19/useful-optional-extensions/</id>
    <published>2018-11-19T00:00:00.000Z</published>
    <updated>2019-02-19T03:45:13.515Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ä½œè€…ï¼šterhechteï¼Œ<a href="https://appventure.me/2018/01/10/optional-extensions/" target="_blank" rel="noopener">åŸæ–‡é“¾æ¥</a>ï¼ŒåŸæ–‡æ—¥æœŸï¼š2018-01-10<br>è¯‘è€…ï¼š<a href="https://github.com/rsenjoyer" target="_blank" rel="noopener">rsenjoyer</a>ï¼›æ ¡å¯¹ï¼š<a href="http://numbbbbb.com/" target="_blank" rel="noopener">numbbbbb</a>ï¼Œ<a href="http://blog.yousanflics.com.cn" target="_blank" rel="noopener">Yousanflics</a>ï¼›å®šç¨¿ï¼š<a href="http://forelax.space" target="_blank" rel="noopener">Forelax</a></p></blockquote><!--æ­¤å¤„å¼€å§‹æ­£æ–‡--><p>å¯é€‰å€¼ï¼ˆOptionalï¼‰æ˜¯ Swift è¯­è¨€æœ€åŸºç¡€çš„å†…å®¹ã€‚æˆ‘æƒ³æ¯ä¸ªäººéƒ½åŒæ„å®ƒå¸¦æ¥äº†å·¨å¤§çš„ç¦éŸ³ï¼Œå› ä¸ºå®ƒè¿«ä½¿å¼€å‘è€…å¦¥å–„å¤„ç†è¾¹ç¼˜æƒ…å†µã€‚å¯é€‰å€¼çš„è¯­è¨€ç‰¹æ€§èƒ½è®©å‘è€…åœ¨å¼€å‘é˜¶æ®µå‘ç°å¹¶å¤„ç†æ•´ä¸ªç±»åˆ«çš„ bugã€‚</p><p>ç„¶è€Œï¼ŒSwift æ ‡å‡†åº“ä¸­å¯é€‰å€¼çš„ API ç›¸å½“çš„æœ‰é™ã€‚å¦‚æœå¿½ç•¥ <code>customMirror</code> å’Œ <code>debugDescription</code> å±æ€§ï¼Œ<a href="https://developer.apple.com/documentation/swift/optional#topics" target="_blank" rel="noopener">Swift æ–‡æ¡£</a> ä»…ä»…åˆ—å‡ºäº†å‡ ä¸ªæ–¹æ³•/å±æ€§ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> unsafelyUnwrapped: <span class="type">Wrapped</span> &#123; <span class="keyword">get</span> &#125; </span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">map</span>&lt;U&gt;<span class="params">(<span class="number">_</span> transform: <span class="params">(Wrapped)</span></span></span> <span class="keyword">throws</span> -&gt; <span class="type">U</span>) <span class="keyword">rethrows</span> -&gt; <span class="type">U</span>? </span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">flatMap</span>&lt;U&gt;<span class="params">(<span class="number">_</span> transform: <span class="params">(Wrapped)</span></span></span> <span class="keyword">throws</span> -&gt; <span class="type">U</span>?) <span class="keyword">rethrows</span> -&gt; <span class="type">U</span>?</span><br></pre></td></tr></table></figure><a id="more"></a><p>å³ä½¿æ–¹æ³•å¦‚æ­¤å°‘ï¼Œå¯é€‰å€¼ä»ç„¶éå¸¸æœ‰ç”¨ï¼Œè¿™æ˜¯å› ä¸º Swift åœ¨è¯­æ³•ä¸Šé€šè¿‡ <a href="https://appventure.me/2014/06/13/swift-optionals-made-simple/" target="_blank" rel="noopener">å¯é€‰é“¾</a>ã€<a href="https://appventure.me/2015/08/20/swift-pattern-matching-in-detail/" target="_blank" rel="noopener">æ¨¡å¼åŒ¹é…</a>ã€<code>if let</code> æˆ– <code>guard let</code> ç­‰åŠŸèƒ½æ¥å¼¥è¡¥å®ƒã€‚ä½†åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå¯é€‰å€¼å®¹æ˜“é€ æˆå¤šåˆ†æ”¯æ¡ä»¶ã€‚æœ‰æ—¶ï¼Œä¸€ä¸ªéå¸¸ç®€æ´çš„æ–¹æ³•é€šå¸¸å…è®¸ä½ ç”¨ä¸€è¡Œä»£ç è¡¨è¾¾æŸä¸ªæ¦‚å¿µï¼Œè€Œä¸æ˜¯ç”¨å¤šè¡Œç»„åˆçš„ <code>if let</code> è¯­å¥ã€‚</p><p>æˆ‘ç­›é€‰äº† Github ä¸Šçš„ Swift é¡¹ç›®ä»¥åŠ Rustã€Scala æˆ– Cï¼ƒ ç­‰å…¶ä»–è¯­è¨€çš„å¯é€‰å®ç°ï¼Œç›®çš„æ˜¯ä¸º Optional æ‰¾ä¸€äº›æœ‰ç”¨çš„è¡¥å……ã€‚ä»¥ä¸‹ 14 ä¸ªå¯é€‰æ‰©å±•ï¼Œæˆ‘å°†åˆ†ç±»é€ä¸€è§£é‡Šï¼ŒåŒæ—¶ç»™æ¯ä¸ªç±»åˆ«ä¸¾å‡ ä¸ªä¾‹å­ã€‚æœ€åï¼Œæˆ‘å°†ç¼–å†™ä¸€ä¸ªæ›´å¤æ‚çš„ç¤ºä¾‹ï¼Œå®ƒåŒæ—¶ä½¿ç”¨å¤šä¸ªå¯é€‰æ‰©å±•ã€‚</p><h2 id="åˆ¤ç©ºï¼ˆEmptinessï¼‰"><a href="#åˆ¤ç©ºï¼ˆEmptinessï¼‰" class="headerlink" title="åˆ¤ç©ºï¼ˆEmptinessï¼‰"></a>åˆ¤ç©ºï¼ˆEmptinessï¼‰</h2><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Optional</span> </span>&#123;</span><br><span class="line">    <span class="comment">/// å¯é€‰å€¼ä¸ºç©ºçš„æ—¶å€™è¿”å› true</span></span><br><span class="line">    <span class="keyword">var</span> isNone: <span class="type">Bool</span> &#123;</span><br><span class="line">        <span class="keyword">switch</span> <span class="keyword">self</span> &#123;</span><br><span class="line">        <span class="keyword">case</span> .<span class="keyword">none</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">        <span class="keyword">case</span> .some:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// å¯é€‰å€¼éç©ºè¿”å› true</span></span><br><span class="line">    <span class="keyword">var</span> isSome: <span class="type">Bool</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> !isNone</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ˜¯å¯¹å¯é€‰ç±»å‹æœ€åŸºç¡€çš„è¡¥å……ã€‚æˆ‘å¾ˆå–œæ¬¢è¿™äº›è¡¥å……ï¼Œå› ä¸ºå®ƒä»¬å°†å¯é€‰é¡¹ä¸ºç©ºçš„æ¦‚å¿µä»ä»£ç ä¸­ç§»é™¤äº†ã€‚åœ¨ä½¿ç”¨çš„ç»†èŠ‚ä¸Šï¼Œ ä½¿ç”¨ <code>optional.isSome</code> æ¯” <code>if optional == nil</code> æ›´ç®€æ´æ˜äº†ã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ä½¿ç”¨å‰</span></span><br><span class="line"><span class="keyword">guard</span> leftButton != <span class="literal">nil</span>, rightButton != <span class="literal">nil</span> <span class="keyword">else</span> &#123; <span class="built_in">fatalError</span>(<span class="string">"Missing Interface Builder connections"</span>) &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨å</span></span><br><span class="line"><span class="keyword">guard</span> leftButton.isSome, rightButton.isSome <span class="keyword">else</span> &#123; <span class="built_in">fatalError</span>(<span class="string">"Missing Interface Builder connections"</span>) &#125;</span><br></pre></td></tr></table></figure><h2 id="æˆ–ï¼ˆOrï¼‰"><a href="#æˆ–ï¼ˆOrï¼‰" class="headerlink" title="æˆ–ï¼ˆOrï¼‰"></a>æˆ–ï¼ˆOrï¼‰</h2><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Optional</span> </span>&#123;</span><br><span class="line">    <span class="comment">/// è¿”å›å¯é€‰å€¼æˆ–é»˜è®¤å€¼</span></span><br><span class="line">    <span class="comment">/// - å‚æ•°: å¦‚æœå¯é€‰å€¼ä¸ºç©ºï¼Œå°†ä¼šé»˜è®¤å€¼</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">or</span><span class="params">(<span class="number">_</span> <span class="keyword">default</span>: Wrapped)</span></span> -&gt; <span class="type">Wrapped</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span> ?? `<span class="keyword">default</span>`</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// è¿”å›å¯é€‰å€¼æˆ– `else` è¡¨è¾¾å¼è¿”å›çš„å€¼</span></span><br><span class="line">    <span class="comment">/// ä¾‹å¦‚. optional.or(else: print("Arrr"))</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">or</span><span class="params">(<span class="keyword">else</span>: @autoclosure <span class="params">()</span></span></span> -&gt; <span class="type">Wrapped</span>) -&gt; <span class="type">Wrapped</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span> ?? `<span class="keyword">else</span>`()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// è¿”å›å¯é€‰å€¼æˆ–è€… `else` é—­åŒ…è¿”å›çš„å€¼</span></span><br><span class="line">    <span class="comment">// ä¾‹å¦‚. optional.or(else: &#123; </span></span><br><span class="line">    <span class="comment">/// ... do a lot of stuff</span></span><br><span class="line">    <span class="comment">/// &#125;)</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">or</span><span class="params">(<span class="keyword">else</span>: <span class="params">()</span></span></span> -&gt; <span class="type">Wrapped</span>) -&gt; <span class="type">Wrapped</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span> ?? `<span class="keyword">else</span>`()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// å½“å¯é€‰å€¼ä¸ä¸ºç©ºæ—¶ï¼Œè¿”å›å¯é€‰å€¼</span></span><br><span class="line">    <span class="comment">/// å¦‚æœä¸ºç©ºï¼ŒæŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">or</span><span class="params">(<span class="keyword">throw</span> exception: Error)</span></span> <span class="keyword">throws</span> -&gt; <span class="type">Wrapped</span> &#123;</span><br><span class="line">        <span class="keyword">guard</span> <span class="keyword">let</span> unwrapped = <span class="keyword">self</span> <span class="keyword">else</span> &#123; <span class="keyword">throw</span> exception &#125;</span><br><span class="line">        <span class="keyword">return</span> unwrapped</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Optional</span> <span class="title">where</span> <span class="title">Wrapped</span> == <span class="title">Error</span> </span>&#123;</span><br><span class="line">    <span class="comment">/// å½“å¯é€‰å€¼ä¸ä¸ºç©ºæ—¶ï¼Œæ‰§è¡Œ `else`</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">or</span><span class="params">(<span class="number">_</span> <span class="keyword">else</span>: <span class="params">(Error)</span></span></span> -&gt; <span class="type">Void</span>) &#123;</span><br><span class="line"><span class="keyword">guard</span> <span class="keyword">let</span> error = <span class="keyword">self</span> <span class="keyword">else</span> &#123; <span class="keyword">return</span> &#125;</span><br><span class="line">`<span class="keyword">else</span>`(error)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>isNone / isSome</code> çš„å¦ä¸€ä¸ªæŠ½è±¡æ¦‚å¿µæ˜¯èƒ½å¤ŸæŒ‡å®šå½“å˜é‡ä¸æˆç«‹çš„æ—¶éœ€è¦æ‰§è¡Œçš„æŒ‡ä»¤ã€‚è¿™èƒ½è®©æˆ‘ä»¬é¿å…ç¼–å†™ <code>if</code> æˆ– <code>guard</code> åˆ†æ”¯ï¼Œè€Œæ˜¯å°†é€»è¾‘å°è£…ä¸ºä¸€ä¸ªæ˜“äºç†è§£çš„æ–¹æ³•ã€‚</p><p>è¿™ä¸ªæ¦‚å¿µéå¸¸çš„æœ‰ç”¨ï¼Œå®ƒå¯åœ¨å››ä¸ªä¸åŒåŠŸèƒ½ä¸­è¢«å®šä¹‰ã€‚</p><h2 id="é»˜è®¤å€¼ï¼ˆDefault-Valueï¼‰"><a href="#é»˜è®¤å€¼ï¼ˆDefault-Valueï¼‰" class="headerlink" title="é»˜è®¤å€¼ï¼ˆDefault Valueï¼‰"></a>é»˜è®¤å€¼ï¼ˆDefault Valueï¼‰</h2><p>ç¬¬ä¸€ä¸ªæ‰©å±•æ–¹æ³•æ˜¯è¿”å›å¯é€‰å€¼æˆ–è€…é»˜è®¤å€¼ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="keyword">optional</span>: <span class="type">Int</span>? = <span class="literal">nil</span></span><br><span class="line"><span class="built_in">print</span>(<span class="keyword">optional</span>.or(<span class="number">10</span>)) <span class="comment">// æ‰“å° 10</span></span><br></pre></td></tr></table></figure><h2 id="é»˜è®¤é—­åŒ…ï¼ˆDefault-Closureï¼‰"><a href="#é»˜è®¤é—­åŒ…ï¼ˆDefault-Closureï¼‰" class="headerlink" title="é»˜è®¤é—­åŒ…ï¼ˆDefault Closureï¼‰"></a>é»˜è®¤é—­åŒ…ï¼ˆDefault Closureï¼‰</h2><p>é»˜è®¤é—­åŒ…å’Œé»˜è®¤å€¼éå¸¸çš„ç›¸ä¼¼ï¼Œä½†å®ƒå…è®¸ä»é—­åŒ…ä¸­è¿”å›é»˜è®¤å€¼ã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="keyword">optional</span>: <span class="type">Int</span>? = <span class="literal">nil</span></span><br><span class="line"><span class="keyword">optional</span>.or(<span class="keyword">else</span>: secretValue * <span class="number">32</span>)</span><br></pre></td></tr></table></figure><p>ç”±äºä½¿ç”¨äº† <code>@autoclosure</code> å‚æ•°, æˆ‘ä»¬å®é™…ä¸Šä½¿ç”¨çš„æ˜¯é»˜è®¤é—­åŒ…ã€‚ä½¿ç”¨é»˜è®¤å€¼å°†ä¼šè‡ªåŠ¨è½¬æ¢ä¸ºè¿”å›å€¼çš„é—­åŒ…ã€‚ç„¶è€Œï¼Œæˆ‘å€¾å‘äºå°†ä¸¤ä¸ªå®ç°å•ç‹¬åˆ†å¼€ï¼Œå› ä¸ºå®ƒå¯ä»¥è®©ç”¨æˆ·ç”¨æ›´åŠ å¤æ‚çš„é€»è¾‘ç¼–å†™é—­åŒ…ã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> cachedUserCount: <span class="type">Int</span>? = <span class="literal">nil</span></span><br><span class="line">...</span><br><span class="line"><span class="keyword">return</span> cachedUserCount.or(<span class="keyword">else</span>: &#123;</span><br><span class="line">   <span class="keyword">let</span> db = database()</span><br><span class="line">   db.prefetch()</span><br><span class="line">   <span class="keyword">guard</span> db.failures.isEmpty <span class="keyword">else</span> &#123; <span class="keyword">return</span> <span class="number">0</span> &#125;</span><br><span class="line">   <span class="keyword">return</span> db.amountOfUsers</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>å½“ä½ å¯¹ä¸€ä¸ªä¸ºç©ºçš„å¯é€‰å€¼èµ‹å€¼çš„æ—¶å€™ï¼Œä½¿ç”¨ <code>or</code> å°±æ˜¯ä¸€ä¸ªä¸é”™çš„é€‰æ‹©ã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> databaseController == <span class="literal">nil</span> &#123;</span><br><span class="line">  databaseController = <span class="type">DatabaseController</span>(config: config)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„ä»£ç å¯ä»¥å†™çš„æ›´åŠ ä¼˜é›…: </p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">databaseController = databaseController.or(<span class="type">DatabaseController</span>(config: config)</span><br></pre></td></tr></table></figure><h2 id="æŠ›å‡ºå¼‚å¸¸ï¼ˆThrow-an-errorï¼‰"><a href="#æŠ›å‡ºå¼‚å¸¸ï¼ˆThrow-an-errorï¼‰" class="headerlink" title="æŠ›å‡ºå¼‚å¸¸ï¼ˆThrow an errorï¼‰"></a>æŠ›å‡ºå¼‚å¸¸ï¼ˆThrow an errorï¼‰</h2><p>è¿™ä¹Ÿæ˜¯ä¸€ä¸ªéå¸¸æœ‰ç”¨çš„è¡¥å……ï¼Œå› ä¸ºå®ƒå°† Swift ä¸­å¯é€‰å€¼ä¸é”™è¯¯å¤„ç†è¿æ¥èµ·æ¥ã€‚æ ¹æ®é¡¹ç›®ä¸­çš„ä»£ç ï¼Œæ–¹æ³•æˆ–å‡½æ•°é€šè¿‡è¿”å›ä¸€ä¸ªä¸ºç©ºçš„å¯é€‰å€¼ï¼ˆä¾‹å¦‚è®¿é—®å­—å…¸ä¸­ä¸å­˜åœ¨çš„é”®ï¼‰æ—¶ï¼ŒæŠ›å‡ºé”™è¯¯æ¥è¡¨è¿°è¿™ä¸€æ— æ•ˆçš„è¡Œä¸ºã€‚å°†ä¸¤è€…è¿æ¥èµ·æ¥èƒ½å¤Ÿä½¿ä»£ç æ›´åŠ æ¸…æ™°ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">buildCar</span><span class="params">()</span></span> <span class="keyword">throws</span> -&gt; <span class="type">Car</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> tires = <span class="keyword">try</span> machine1.createTires()</span><br><span class="line">  <span class="keyword">let</span> windows = <span class="keyword">try</span> machine2.createWindows()</span><br><span class="line">  <span class="keyword">guard</span> <span class="keyword">let</span> motor = externalMachine.deliverMotor() <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="type">MachineError</span>.motor</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">let</span> trunk = <span class="keyword">try</span> machine3.createTrunk()</span><br><span class="line">  <span class="keyword">if</span> <span class="keyword">let</span> car = manufacturer.buildCar(tires, windows,  motor, trunk) &#123;</span><br><span class="line">    <span class="keyword">return</span> car</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="type">MachineError</span>.manufacturer</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡è°ƒç”¨å†…éƒ¨åŠå¤–éƒ¨ä»£ç å…±åŒæ„å»ºæ±½è½¦å¯¹è±¡ï¼Œå¤–éƒ¨ä»£ç ï¼ˆ<code>external_machine</code> å’Œ <code>manufacturer</code>ï¼‰é€‰æ‹©ä½¿ç”¨å¯é€‰å€¼è€Œä¸æ˜¯é”™è¯¯å¤„ç†ã€‚è¿™ä½¿å¾—ä»£ç å˜å¾—å¾ˆå¤æ‚ï¼Œæˆ‘ä»¬å¯ä½¿ç”¨ <code>or(throw:)</code> ä½¿å‡½æ•°å¯è¯»æ€§æ›´é«˜ã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">build_car</span><span class="params">()</span></span> <span class="keyword">throws</span> -&gt; <span class="type">Car</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> tires = <span class="keyword">try</span> machine1.createTires()</span><br><span class="line">  <span class="keyword">let</span> windows = <span class="keyword">try</span> machine2.createWindows()</span><br><span class="line">  <span class="keyword">let</span> motor = <span class="keyword">try</span> externalMachine.deliverMotor().or(<span class="keyword">throw</span>: <span class="type">MachineError</span>.motor)</span><br><span class="line">  <span class="keyword">let</span> trunk = <span class="keyword">try</span> machine3.createTrunk()</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">try</span> manufacturer.buildCar(tires, windows,  motor, trunk).or(<span class="keyword">throw</span>: <span class="type">MachineError</span>.manufacturer)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="é”™è¯¯å¤„ç†ï¼ˆHandling-Errorsï¼‰"><a href="#é”™è¯¯å¤„ç†ï¼ˆHandling-Errorsï¼‰" class="headerlink" title="é”™è¯¯å¤„ç†ï¼ˆHandling Errorsï¼‰"></a>é”™è¯¯å¤„ç†ï¼ˆHandling Errorsï¼‰</h2><p>å½“ä»£ç ä¸­åŒ…å« <a href="https://github.com/doozMen" target="_blank" rel="noopener">Stijn Willems åœ¨ Github</a> è‡ªç”±å‡½æ•°ï¼Œä¸Šé¢æŠ›å‡ºå¼‚å¸¸éƒ¨åˆ†çš„ä»£ç å˜æ›´åŠ æœ‰ç”¨ã€‚æ„Ÿè°¢ Stijn Willems çš„å»ºè®®ã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">should</span><span class="params">(<span class="number">_</span> <span class="keyword">do</span>: <span class="params">()</span></span></span> <span class="keyword">throws</span> -&gt; <span class="type">Void</span>) -&gt; <span class="type">Error</span>? &#123;</span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line"><span class="keyword">try</span> `<span class="keyword">do</span>`()</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">    &#125; <span class="keyword">catch</span> <span class="keyword">let</span> error &#123;</span><br><span class="line"><span class="keyword">return</span> error</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªè‡ªç”±å‡½æ•°ï¼ˆå¯é€‰çš„ï¼Œå¯å°†å®ƒå½“åšä¸€ä¸ªå¯é€‰é¡¹çš„ç±»æ–¹æ³•ï¼‰ä½¿ç”¨ <code>do {} catch {}</code> å—å¹¶è¿”å›ä¸€ä¸ªé”™è¯¯ã€‚å½“ä¸”ä»…å½“ <code>do</code> ä»£ç å—æ•æ‰åˆ°å¼‚å¸¸ã€‚ä»¥ä¸‹é¢ Swift ä»£ç ä¸ºä¾‹ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line">  <span class="keyword">try</span> throwingFunction()</span><br><span class="line">&#125; <span class="keyword">catch</span> <span class="keyword">let</span> error &#123;</span><br><span class="line">  <span class="built_in">print</span>(error)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ˜¯ Swift ä¸­é”™è¯¯å¤„ç†çš„åŸºæœ¬åŸåˆ™ä¹‹ä¸€ï¼Œä½†å®ƒä¸å¤Ÿç®€å•æ˜äº†ã€‚ä½¿ç”¨ä¸Šé¢çš„æä¾›çš„å‡½æ•°ï¼Œä½ å¯ä»¥ä½¿ä»£ç å˜å¾—è¶³å¤Ÿç®€å•ã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">should &#123; <span class="keyword">try</span> throwingFunction) &#125;.or(<span class="built_in">print</span>($<span class="number">0</span>))</span><br></pre></td></tr></table></figure><p>æˆ‘è§‰å¾—åœ¨å¾ˆå¤šæƒ…å†µä¸‹ï¼Œè¿™æ ·è¿›è¡Œé”™è¯¯å¤„ç†æ•ˆæœæ›´å¥½ã€‚</p><h2 id="å˜æ¢ï¼ˆMapï¼‰"><a href="#å˜æ¢ï¼ˆMapï¼‰" class="headerlink" title="å˜æ¢ï¼ˆMapï¼‰"></a>å˜æ¢ï¼ˆMapï¼‰</h2><p>æ­£å¦‚ä¸Šé¢æ‰€è§ï¼Œ<code>map</code> å’Œ <code>flatMap</code> æ˜¯ Swift æ ‡å‡†åº“åœ¨å¯é€‰é¡¹ä¸Šé¢æä¾›çš„çš„å…¨éƒ¨æ–¹æ³•ã€‚ç„¶è€Œï¼Œåœ¨å¤šæ•°æƒ…å†µä¸‹ï¼Œä¹Ÿå¯ä»¥å¯¹å®ƒä»¬ç¨å¾®æ”¹è¿›ä½¿å¾—æ›´åŠ é€šç”¨ã€‚è¿™æœ‰ä¸¤ä¸ªæ‰©å±• <code>map</code> å…è®¸å®šä¹‰ä¸€ä¸ªé»˜è®¤å€¼ï¼Œç±»ä¼¼äºä¸Šé¢ <code>or</code> çš„å®ç°æ–¹å¼ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Optional</span> </span>&#123;</span><br><span class="line">    <span class="comment">/// å¯é€‰å€¼å˜æ¢è¿”å›ï¼Œå¦‚æœå¯é€‰å€¼ä¸ºç©ºï¼Œåˆ™è¿”å›é»˜è®¤å€¼</span></span><br><span class="line">    <span class="comment">/// - å‚æ•° fn: æ˜ å°„å€¼çš„é—­åŒ…</span></span><br><span class="line">    <span class="comment">/// - å‚æ•° default: å¯é€‰å€¼ä¸ºç©ºæ—¶ï¼Œå°†ä½œä¸ºè¿”å›å€¼</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">map</span>&lt;T&gt;<span class="params">(<span class="number">_</span> fn: <span class="params">(Wrapped)</span></span></span> <span class="keyword">throws</span> -&gt; <span class="type">T</span>, <span class="keyword">default</span>: <span class="type">T</span>) <span class="keyword">rethrows</span> -&gt; <span class="type">T</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">try</span> <span class="built_in">map</span>(fn) ?? `<span class="keyword">default</span>`</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// å¯é€‰å€¼å˜æ¢è¿”å›ï¼Œå¦‚æœå¯é€‰å€¼ä¸ºç©ºï¼Œåˆ™è°ƒç”¨ `else` é—­åŒ…</span></span><br><span class="line">    <span class="comment">/// - å‚æ•° fn: æ˜ å°„å€¼çš„é—­åŒ…</span></span><br><span class="line">    <span class="comment">/// - å‚æ•° else: The function to call if the optional is empty</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">map</span>&lt;T&gt;<span class="params">(<span class="number">_</span> fn: <span class="params">(Wrapped)</span></span></span> <span class="keyword">throws</span> -&gt; <span class="type">T</span>, <span class="keyword">else</span>: () <span class="keyword">throws</span> -&gt; <span class="type">T</span>) <span class="keyword">rethrows</span> -&gt; <span class="type">T</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">try</span> <span class="built_in">map</span>(fn) ?? `<span class="keyword">else</span>`()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¬¬ä¸€ä¸ªæ–¹æ³•å…è®¸ä½ å°†å¯é€‰å€¼ <code>map</code> æˆä¸€ä¸ªæ–°çš„ç±»å‹ <code>T</code>. å¦‚æœå¯é€‰å€¼ä¸ºç©ºï¼Œä½ å¯ä»¥æä¾›ä¸€ä¸ª <code>T</code> ç±»å‹çš„é»˜è®¤å€¼ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> optional1: <span class="type">String</span>? = <span class="string">"appventure"</span></span><br><span class="line"><span class="keyword">let</span> optional2: <span class="type">String</span>? = <span class="literal">nil</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨å‰</span></span><br><span class="line"><span class="built_in">print</span>(optional1.<span class="built_in">map</span>(&#123; $<span class="number">0</span>.<span class="built_in">count</span> &#125;) ?? <span class="number">0</span>)</span><br><span class="line"><span class="built_in">print</span>(optional2.<span class="built_in">map</span>(&#123; $<span class="number">0</span>.<span class="built_in">count</span> &#125;) ?? <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨å </span></span><br><span class="line"><span class="built_in">print</span>(optional1.<span class="built_in">map</span>(&#123; $<span class="number">0</span>.<span class="built_in">count</span> &#125;, <span class="keyword">default</span>: <span class="number">0</span>)) <span class="comment">// prints 10</span></span><br><span class="line"><span class="built_in">print</span>(optional2.<span class="built_in">map</span>(&#123; $<span class="number">0</span>.<span class="built_in">count</span> &#125;, <span class="keyword">default</span>: <span class="number">0</span>)) <span class="comment">// prints 0</span></span><br></pre></td></tr></table></figure><p>è¿™é‡Œæ”¹åŠ¨å¾ˆå°ï¼Œæˆ‘ä»¬å†ä¹Ÿä¸éœ€è¦ä½¿ç”¨ <code>??</code> æ“ä½œç¬¦ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯æ›´èƒ½è¡¨è¾¾æ„å›¾çš„ <code>default</code> å€¼ã€‚</p><p>ç¬¬äºŒä¸ªæ–¹æ³•ä¹Ÿä¸ç¬¬ä¸€ä¸ªå¾ˆç›¸ä¼¼ï¼Œä¸»è¦åŒºåˆ«åœ¨äºå®ƒæ¥å—ï¼ˆå†æ¬¡ï¼‰è¿”å› <code>T</code> ç±»å‹çš„é—­åŒ…ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ä¸€ä¸ªé»˜è®¤å€¼ã€‚è¿™é‡Œæœ‰ä¸ªç®€å•çš„ä¾‹å­ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="keyword">optional</span>: <span class="type">String</span>? = <span class="literal">nil</span></span><br><span class="line"><span class="built_in">print</span>(<span class="keyword">optional</span>.<span class="built_in">map</span>(&#123; $<span class="number">0</span>.<span class="built_in">count</span> &#125;, <span class="keyword">else</span>: &#123; <span class="string">"default"</span>.<span class="built_in">count</span> &#125;)</span><br></pre></td></tr></table></figure><h2 id="ç»„åˆå¯é€‰é¡¹ï¼ˆCombining-Optionalsï¼‰"><a href="#ç»„åˆå¯é€‰é¡¹ï¼ˆCombining-Optionalsï¼‰" class="headerlink" title="ç»„åˆå¯é€‰é¡¹ï¼ˆCombining Optionalsï¼‰"></a>ç»„åˆå¯é€‰é¡¹ï¼ˆCombining Optionalsï¼‰</h2><p>è¿™ä¸ªç±»åˆ«åŒ…å«äº†å››ä¸ªå‡½æ•°ï¼Œå…è®¸ä½ å®šä¹‰å¤šä¸ªå¯é€‰é¡¹ä¹‹é—´çš„å…³ç³»ã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Optional</span> </span>&#123;</span><br><span class="line">    <span class="comment">///  å½“å¯é€‰å€¼ä¸ä¸ºç©ºæ—¶ï¼Œè§£åŒ…å¹¶è¿”å›å‚æ•° `optional`</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">and</span>&lt;B&gt;<span class="params">(<span class="number">_</span> <span class="keyword">optional</span>: B?)</span></span> -&gt; <span class="type">B</span>? &#123;</span><br><span class="line"><span class="keyword">guard</span> <span class="keyword">self</span> != <span class="literal">nil</span> <span class="keyword">else</span> &#123; <span class="keyword">return</span> <span class="literal">nil</span> &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">optional</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// è§£åŒ…å¯é€‰å€¼ï¼Œå½“å¯é€‰å€¼ä¸ä¸ºç©ºæ—¶ï¼Œæ‰§è¡Œ `then` é—­åŒ…ï¼Œå¹¶è¿”å›æ‰§è¡Œç»“æœ</span></span><br><span class="line">    <span class="comment">/// å…è®¸ä½ å°†å¤šä¸ªå¯é€‰é¡¹è¿æ¥åœ¨ä¸€èµ·</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">and</span>&lt;T&gt;<span class="params">(then: <span class="params">(Wrapped)</span></span></span> <span class="keyword">throws</span> -&gt; <span class="type">T</span>?) <span class="keyword">rethrows</span> -&gt; <span class="type">T</span>? &#123;</span><br><span class="line"><span class="keyword">guard</span> <span class="keyword">let</span> unwrapped = <span class="keyword">self</span> <span class="keyword">else</span> &#123; <span class="keyword">return</span> <span class="literal">nil</span> &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">try</span> then(unwrapped)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// å°†å½“å‰å¯é€‰å€¼ä¸å…¶ä»–å¯é€‰å€¼ç»„åˆåœ¨ä¸€èµ·</span></span><br><span class="line">    <span class="comment">/// å½“ä¸”ä»…å½“ä¸¤ä¸ªå¯é€‰å€¼éƒ½ä¸ä¸ºç©ºæ—¶ç»„åˆæˆåŠŸï¼Œå¦åˆ™è¿”å›ç©º</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">zip2</span>&lt;A&gt;<span class="params">(with other: Optional&lt;A&gt;)</span></span> -&gt; (<span class="type">Wrapped</span>, <span class="type">A</span>)? &#123;</span><br><span class="line"><span class="keyword">guard</span> <span class="keyword">let</span> first = <span class="keyword">self</span>, <span class="keyword">let</span> second = other <span class="keyword">else</span> &#123; <span class="keyword">return</span> <span class="literal">nil</span> &#125;</span><br><span class="line">    <span class="keyword">return</span> (first, second)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// å°†å½“å‰å¯é€‰å€¼ä¸å…¶ä»–å¯é€‰å€¼ç»„åˆåœ¨ä¸€èµ·</span></span><br><span class="line">    <span class="comment">/// å½“ä¸”ä»…å½“ä¸‰ä¸ªå¯é€‰å€¼éƒ½ä¸ä¸ºç©ºæ—¶ç»„åˆæˆåŠŸï¼Œå¦åˆ™è¿”å›ç©º</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">zip3</span>&lt;A, B&gt;<span class="params">(with other: Optional&lt;A&gt;, another: Optional&lt;B&gt;)</span></span> -&gt; (<span class="type">Wrapped</span>, <span class="type">A</span>, <span class="type">B</span>)? &#123;</span><br><span class="line"><span class="keyword">guard</span> <span class="keyword">let</span> first = <span class="keyword">self</span>,</span><br><span class="line">      <span class="keyword">let</span> second = other,</span><br><span class="line">      <span class="keyword">let</span> third = another <span class="keyword">else</span> &#123; <span class="keyword">return</span> <span class="literal">nil</span> &#125;</span><br><span class="line"><span class="keyword">return</span> (first, second, third)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„å››ä¸ªå‡½æ•°éƒ½ä»¥ä¼ å…¥å¯é€‰å€¼å½“åšå‚æ•°ï¼Œæœ€ç»ˆéƒ½è¿”å›ä¸€ä¸ªå¯é€‰å€¼ï¼Œç„¶è€Œï¼Œä»–ä»¬çš„å®ç°æ–¹å¼å®Œå…¨ä¸åŒã€‚</p><h2 id="ä¾èµ–ï¼ˆDependenciesï¼‰"><a href="#ä¾èµ–ï¼ˆDependenciesï¼‰" class="headerlink" title="ä¾èµ–ï¼ˆDependenciesï¼‰"></a>ä¾èµ–ï¼ˆDependenciesï¼‰</h2><p>è‹¥ä¸€ä¸ªå¯é€‰å€¼çš„è§£åŒ…ä»…ä½œä¸ºå¦ä¸€å¯é€‰å€¼è§£åŒ…çš„å‰æï¼Œ<code>and&lt;B&gt;(_ optional)</code> å°±æ˜¾å¾—éå¸¸ä½¿ç”¨ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ä½¿ç”¨å‰</span></span><br><span class="line"><span class="keyword">if</span> user != <span class="literal">nil</span>, <span class="keyword">let</span> account = userAccount() ...</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨å</span></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">let</span> account = user.and(userAccount()) ...</span><br></pre></td></tr></table></figure><p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å¯¹ <code>user</code> çš„å…·ä½“å†…å®¹ä¸æ„Ÿå…´è¶£ï¼Œä½†æ˜¯è¦æ±‚åœ¨è°ƒç”¨ <code>userAccount</code> å‡½æ•°å‰ä¿è¯å®ƒéç©ºã€‚è™½ç„¶è¿™ç§å…³ç³»ä¹Ÿå¯ä»¥ä½¿ç”¨ <code>user != nil</code>ï¼Œä½†æˆ‘è§‰å¾— <code>and</code> ä½¿å®ƒä»¬çš„æ„å›¾æ›´åŠ æ¸…æ™°ã€‚</p><h2 id="é“¾å¼è°ƒç”¨ï¼ˆChainingï¼‰"><a href="#é“¾å¼è°ƒç”¨ï¼ˆChainingï¼‰" class="headerlink" title="é“¾å¼è°ƒç”¨ï¼ˆChainingï¼‰"></a>é“¾å¼è°ƒç”¨ï¼ˆChainingï¼‰</h2><p><code>and&lt;T&gt;(then:)</code> æ˜¯å¦ä¸€ä¸ªéå¸¸æœ‰ç”¨çš„å‡½æ•°, å®ƒå°†å¤šä¸ªå¯é€‰é¡¹é“¾æ¥èµ·æ¥ï¼Œä»¥ä¾¿å°†å¯é€‰é¡¹ <code>A</code> çš„è§£åŒ…å€¼å½“åšå¯é€‰é¡¹ <code>B</code> çš„è¾“å…¥ã€‚æˆ‘ä»¬ä»ä¸€ä¸ªç®€å•çš„ä¾‹å­å¼€å§‹ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">UserDatabase</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">current</span><span class="params">()</span></span> -&gt; <span class="type">User</span>?</span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">spouse</span><span class="params">(of user: User)</span></span> -&gt; <span class="type">User</span>?</span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">father</span><span class="params">(of user: User)</span></span> -&gt; <span class="type">User</span>?</span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">childrenCount</span><span class="params">(of user: User)</span></span> -&gt; <span class="type">Int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> database: <span class="type">UserDatabase</span> = ...</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ€è€ƒå¦‚ä¸‹å…³ç³»è¯¥å¦‚ä½•è¡¨è¾¾ï¼š</span></span><br><span class="line"><span class="comment">// Man -&gt; Spouse -&gt; Father -&gt; Father -&gt; Spouse -&gt; children</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨å‰</span></span><br><span class="line"><span class="keyword">let</span> childrenCount: <span class="type">Int</span></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">let</span> user = database.current(), </span><br><span class="line">   <span class="keyword">let</span> father1 = database.father(user),</span><br><span class="line">   <span class="keyword">let</span> father2 = database.father(father1),</span><br><span class="line">   <span class="keyword">let</span> spouse = database.spouse(father2),</span><br><span class="line">   <span class="keyword">let</span> children = database.childrenCount(father2) &#123;</span><br><span class="line">  childrenCount = children</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  childrenCount = <span class="number">0</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨å</span></span><br><span class="line"><span class="keyword">let</span> children = database.current().and(then: &#123; database.spouse($<span class="number">0</span>) &#125;)</span><br><span class="line">     .and(then: &#123; database.father($<span class="number">0</span>) &#125;)</span><br><span class="line">     .and(then: &#123; database.spouse($<span class="number">0</span>) &#125;)</span><br><span class="line">     .and(then: &#123; database.childrenCount($<span class="number">0</span>) &#125;)</span><br><span class="line">     .or(<span class="number">0</span>)</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ <code>and(then)</code> å‡½æ•°å¯¹ä»£ç æœ‰å¾ˆå¤§çš„æå‡ã€‚é¦–å…ˆï¼Œä½ æ²¡å¿…è¦å£°æ˜ä¸´æ—¶å˜é‡åï¼ˆuser, father1, father2, spouse, childrenï¼‰ï¼Œå…¶æ¬¡ï¼Œä»£ç æ›´åŠ çš„ç®€æ´ã€‚è€Œä¸”ï¼Œä½¿ç”¨ <code>or(0)</code> æ¯” <code>let childrenCount</code> å¯è¯»æ€§æ›´å¥½ã€‚</p><p>æœ€åï¼ŒåŸæ¥çš„ Swift ä»£ç å¾ˆå®¹æ˜“å¯¼è‡´é€»è¾‘é”™è¯¯ã€‚ä¹Ÿè®¸ä½ è¿˜æ²¡æœ‰æ³¨æ„åˆ°ï¼Œä½†ç¤ºä¾‹ä¸­å­˜åœ¨ä¸€ä¸ª bugã€‚åœ¨å†™é‚£æ ·çš„ä»£ç æ—¶ï¼Œå°±å¾ˆå®¹æ˜“åœ°å¼•å…¥å¤åˆ¶ç²˜è´´é”™è¯¯ã€‚ä½ è§‚å¯Ÿåˆ°äº†ä¹ˆï¼Ÿ</p><p>æ˜¯çš„ï¼Œ<code>children</code> å±æ€§åº”è¯¥ç”±è°ƒç”¨ <code>database.childrenCount(spouse)</code> åˆ›å»ºï¼Œä½†æˆ‘å†™æˆäº† <code>database.childrenCount(father2)</code>ã€‚å¾ˆéš¾å‘ç°è¿™æ ·çš„é”™è¯¯ã€‚ä½¿ç”¨ <code>and(then:)</code> å°±å®¹æ˜“å‘ç°è¿™ä¸ªé”™è¯¯ï¼Œå› ä¸ºå®ƒä½¿ç”¨çš„æ˜¯å˜é‡ <code>$0</code>ã€‚</p><h2 id="ç»„åˆï¼ˆZippingï¼‰"><a href="#ç»„åˆï¼ˆZippingï¼‰" class="headerlink" title="ç»„åˆï¼ˆZippingï¼‰"></a>ç»„åˆï¼ˆZippingï¼‰</h2><p>è¿™æ˜¯ç°æœ‰ Swift æ¦‚å¿µçš„å¦ä¸€ä¸ªæ‰©å±•ï¼Œ<code>zip</code> å¯ä»¥ç»„åˆå¤šä¸ªå¯é€‰å€¼ï¼Œå®ƒä»¬ä¸€èµ·è§£åŒ…æˆåŠŸæˆ–è§£åŒ…å¤±è´¥ã€‚åœ¨ä¸Šé¢çš„ä»£ç ç‰‡æ®µä¸­ï¼Œæˆ‘æä¾›äº† <code>zip2</code> ä¸ <code>zip3</code> å‡½æ•°ï¼Œä½†ä½ ä¹Ÿå¯ä»¥å‘½åä¸º <code>zip22</code>ï¼ˆå¥½å§ï¼Œä¹Ÿè®¸å¯¹åˆç†æ€§å’Œç¼–è¯‘é€Ÿåº¦æœ‰ä¸€ç‚¹ç‚¹å½±å“ï¼‰ã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æ­£å¸¸ç¤ºä¾‹</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">buildProduct</span><span class="params">()</span></span> -&gt; <span class="type">Product</span>? &#123;</span><br><span class="line">  <span class="keyword">if</span> <span class="keyword">let</span> var1 = machine1.makeSomething(),</span><br><span class="line">    <span class="keyword">let</span> var2 = machine2.makeAnotherThing(),</span><br><span class="line">    <span class="keyword">let</span> var3 = machine3.createThing() &#123;</span><br><span class="line">    <span class="keyword">return</span> finalMachine.produce(var1, var2, var3)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨æ‰©å±•</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">buildProduct</span><span class="params">()</span></span> -&gt; <span class="type">Product</span>? &#123;</span><br><span class="line">  <span class="keyword">return</span> machine1.makeSomething()</span><br><span class="line">     .zip3(machine2.makeAnotherThing(), machine3.createThing())</span><br><span class="line">     .<span class="built_in">map</span> &#123; finalMachine.produce($<span class="number">0.1</span>, $<span class="number">0.2</span>, $<span class="number">0.3</span>) &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»£ç é‡æ›´å°‘ï¼Œä»£ç æ›´æ¸…æ™°ï¼Œæ›´ä¼˜é›…ã€‚ç„¶è€Œï¼Œä¹Ÿå­˜ä¸€ä¸ªç¼ºç‚¹ï¼Œå°±æ˜¯æ›´å¤æ‚äº†ã€‚è¯»è€…å¿…é¡»äº†è§£å¹¶ç†è§£ <code>zip</code> æ‰èƒ½å®Œå…¨æŒæ¡å®ƒã€‚</p><h2 id="On"><a href="#On" class="headerlink" title="On"></a>On</h2><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Optional</span> </span>&#123;</span><br><span class="line">    <span class="comment">/// å½“å¯é€‰å€¼ä¸ä¸ºç©ºæ—¶ï¼Œæ‰§è¡Œ `some` é—­åŒ…</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">on</span><span class="params">(some: <span class="params">()</span></span></span> <span class="keyword">throws</span> -&gt; <span class="type">Void</span>) <span class="keyword">rethrows</span> &#123;</span><br><span class="line"><span class="keyword">if</span> <span class="keyword">self</span> != <span class="literal">nil</span> &#123; <span class="keyword">try</span> some() &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// å½“å¯é€‰å€¼ä¸ºç©ºæ—¶ï¼Œæ‰§è¡Œ `none` é—­åŒ…</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">on</span><span class="params">(<span class="keyword">none</span>: <span class="params">()</span></span></span> <span class="keyword">throws</span> -&gt; <span class="type">Void</span>) <span class="keyword">rethrows</span> &#123;</span><br><span class="line"><span class="keyword">if</span> <span class="keyword">self</span> == <span class="literal">nil</span> &#123; <span class="keyword">try</span> <span class="keyword">none</span>() &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸è®ºå¯é€‰å€¼æ˜¯å¦ä¸ºç©ºï¼Œä¸Šé¢ä¸¤ä¸ªæ‰©å±•éƒ½å…è®¸ä½ æ‰§è¡Œä¸€äº›é¢å¤–çš„æ“ä½œã€‚ä¸ä¸Šé¢è®¨è®ºè¿‡çš„æ–¹æ³•ç›¸åï¼Œè¿™ä¸¤ä¸ªæ–¹æ³•å¿½ç•¥å¯é€‰å€¼ã€‚<code>on(some:)</code> ä¼šåœ¨å¯é€‰å€¼ä¸ä¸ºç©ºçš„æ—¶å€™æ‰§è¡Œé—­åŒ… <code>some</code>ï¼Œä½†æ˜¯é—­åŒ… <code>some</code> ä¸ä¼šè·å–å¯é€‰é¡¹çš„å€¼ã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">/// å¦‚æœç”¨æˆ·ä¸å­˜åœ¨å°†ç™»å‡º</span></span><br><span class="line"><span class="keyword">self</span>.user.on(<span class="keyword">none</span>: &#123; <span class="type">AppCoordinator</span>.shared.logout() &#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">/// å½“ç”¨æˆ·ä¸ä¸ºç©ºæ—¶ï¼Œè¿æ¥ç½‘ç»œ</span></span><br><span class="line"><span class="keyword">self</span>.user.on(some: &#123; <span class="type">AppCoordinator</span>.shared.unlock() &#125;)</span><br></pre></td></tr></table></figure><h2 id="Various"><a href="#Various" class="headerlink" title="Various"></a>Various</h2><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Optional</span> </span>&#123;</span><br><span class="line">    <span class="comment">/// å¯é€‰å€¼ä¸ä¸ºç©ºä¸”å¯é€‰å€¼æ»¡è¶³ `predicate` æ¡ä»¶æ‰è¿”å›ï¼Œå¦åˆ™è¿”å› `nil`</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">filter</span><span class="params">(<span class="number">_</span> predicate: <span class="params">(Wrapped)</span></span></span> -&gt; <span class="type">Bool</span>) -&gt; <span class="type">Wrapped</span>? &#123;</span><br><span class="line"><span class="keyword">guard</span> <span class="keyword">let</span> unwrapped = <span class="keyword">self</span>,</span><br><span class="line">    predicate(unwrapped) <span class="keyword">else</span> &#123; <span class="keyword">return</span> <span class="literal">nil</span> &#125;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">self</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// å¯é€‰å€¼ä¸ä¸ºç©ºæ—¶è¿”å›ï¼Œå¦åˆ™ crash</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">expect</span><span class="params">(<span class="number">_</span> message: String)</span></span> -&gt; <span class="type">Wrapped</span> &#123;</span><br><span class="line">        <span class="keyword">guard</span> <span class="keyword">let</span> value = <span class="keyword">self</span> <span class="keyword">else</span> &#123; <span class="built_in">fatalError</span>(message) &#125;</span><br><span class="line">        <span class="keyword">return</span> value</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="è¿‡æ»¤ï¼ˆFilterï¼‰"><a href="#è¿‡æ»¤ï¼ˆFilterï¼‰" class="headerlink" title="è¿‡æ»¤ï¼ˆFilterï¼‰"></a>è¿‡æ»¤ï¼ˆFilterï¼‰</h3><p>è¿™ä¸ªæ–¹æ³•ç±»ä¼¼äºä¸€ä¸ªå®ˆæŠ¤è€…ä¸€æ ·ï¼Œåªæœ‰å¯é€‰å€¼æ»¡è¶³ <code>predicate</code> æ¡ä»¶æ—¶æ‰è¿›è¡Œè§£åŒ…ã€‚æ¯”å¦‚è¯´ï¼Œæˆ‘ä»¬å¸Œæœ›æ‰€æœ‰çš„è€ç”¨æˆ·éƒ½å‡çº§ä¸ºé«˜çº§è´¦æˆ·ï¼Œä»¥ä¾¿ä¸æˆ‘ä»¬ä¿æŒæ›´é•¿ä¹…çš„è”ç³»ã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ä»…ä¼šå½±å“ id &lt; 1000 çš„ç”¨æˆ·</span></span><br><span class="line"><span class="comment">// æ­£å¸¸å†™æ³•</span></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">let</span> aUser = user, user.id &lt; <span class="number">1000</span> &#123; aUser.upgradeToPremium() &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨ `filter`</span></span><br><span class="line">user.<span class="built_in">filter</span>(&#123; $<span class="number">0</span>.id &lt; <span class="number">1000</span> &#125;)?.upgradeToPremium()</span><br></pre></td></tr></table></figure><p>åœ¨è¿™é‡Œï¼Œ<code>user.filter</code> ä½¿ç”¨èµ·æ¥æ›´åŠ è‡ªç„¶ã€‚æ­¤å¤–ï¼Œå®ƒçš„å®ç°ç±»ä¼¼äº Swift é›†åˆä¸­çš„åŠŸèƒ½ã€‚</p><h3 id="æœŸæœ›ï¼ˆExpectï¼‰"><a href="#æœŸæœ›ï¼ˆExpectï¼‰" class="headerlink" title="æœŸæœ›ï¼ˆExpectï¼‰"></a>æœŸæœ›ï¼ˆExpectï¼‰</h3><p>è¿™æ˜¯æˆ‘æœ€å–œæ¬¢çš„åŠŸèƒ½ä¹‹ä¸€ã€‚è¿™æ˜¯æˆ‘ä» <code>Rush</code> è¯­è¨€ä¸­å€Ÿé‰´è€Œæ¥çš„ã€‚æˆ‘è¯•å›¾é¿å…å¼ºè¡Œè§£åŒ…ä»£ç åº“ä¸­çš„ä»»ä½•ä¸œè¥¿ã€‚ç±»ä¼¼äºéšå¼è§£åŒ…å¯é€‰é¡¹ã€‚</p><p>ç„¶è€Œï¼Œå½“åœ¨é¡¹ç›®ä¸­ä½¿ç”¨å¯è§†åŒ–ç•Œé¢æ„å»º UI æ—¶ï¼Œä¸‹é¢çš„è¿™ç§æ–¹å¼å¾ˆå¸¸è§ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">updateLabel</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="keyword">guard</span> <span class="keyword">let</span> label = valueLabel <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">fatalError</span>(<span class="string">"valueLabel not connected in IB"</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  label.text = state.title</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ˜¾ç„¶ï¼Œå¦ä¸€ç§æ–¹å¼æ˜¯å¼ºåˆ¶è§£åŒ… <code>label</code>, è¿™ä¹ˆåšå¯èƒ½ä¼šé€ æˆåº”ç”¨ç¨‹åºå´©æºƒç±»ä¼¼äº <code>fatalError</code>ã€‚ ç„¶è€Œï¼Œæˆ‘å¿…é¡»æ’å…¥ <code>!</code>, å½“é€ æˆç¨‹åºå´©æºƒåï¼Œ<code>!</code> å¹¶ä¸èƒ½ç»™æ˜ç¡®çš„é”™è¯¯ä¿¡æ¯ã€‚åœ¨è¿™é‡Œï¼Œä½¿ç”¨ä¸Šé¢å®ç°çš„ <code>expect</code> å‡½æ•°å°±æ˜¯ä¸€ä¸ªæ›´å¥½çš„é€‰æ‹©ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">updateLabel</span><span class="params">()</span></span> &#123;</span><br><span class="line">  valueLabel.expect(<span class="string">"valueLabel not connected in IB"</span>).text = state.title</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ç¤ºä¾‹ï¼ˆExampleï¼‰"><a href="#ç¤ºä¾‹ï¼ˆExampleï¼‰" class="headerlink" title="ç¤ºä¾‹ï¼ˆExampleï¼‰"></a>ç¤ºä¾‹ï¼ˆExampleï¼‰</h2><p>è‡³æ­¤æˆ‘ä»¬å·²ç»å®ç°äº†ä¸€ç³»åˆ—éå¸¸æœ‰ç”¨çš„å¯é€‰é¡¹æ‰©å±•ã€‚æˆ‘å°†ä¼šç»™å‡ºä¸ªç»¼åˆç¤ºä¾‹ï¼Œä»¥ä¾¿æ›´å¥½çš„äº†è§£å¦‚ä½•ç»„åˆä½¿ç”¨è¿™äº›æ‰©å±•ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦å…ˆè¯´æ˜ä¸€ä¸‹è¿™ä¸ªç¤ºä¾‹ï¼ŒåŸè°…æˆ‘ä½¿ç”¨è¿™ä¸ªä¸å¤ªæ°å½“çš„ä¾‹å­ï¼š</p><p>å‡å¦‚ä½ æ˜¯ä¸º 80 å¹´ä»£çš„è½¯ä»¶å•†å·¥ä½œã€‚æ¯ä¸ªæœˆéƒ½æœ‰å¾ˆå¤šçš„äººä¸ºä½ ç¼–å†™åº”ç”¨è½¯ä»¶å’Œæ¸¸æˆã€‚ä½ éœ€è¦è¿½è¸ªé”€å”®é‡ï¼Œä½ ä»ä¼šè®¡é‚£é‡Œæ”¶åˆ°ä¸€ä¸ª XML æ–‡ä»¶ï¼Œä½ éœ€è¦è¿›è¡Œè§£æå¹¶å°†ç»“æœå­˜å…¥åˆ°æ•°æ®åº“ä¸­ï¼ˆå¦‚æœåœ¨ 80 å¹´ä»£å°±æœ‰ Swift è¯­è¨€ ä»¥åŠ XMLï¼Œè¿™å°†æ˜¯å¤šä¹ˆå¥‡å¦™ï¼‰ã€‚ä½ çš„è½¯ä»¶ç³»ç»Ÿæœ‰ä¸€ä¸ªXMLè§£æå™¨å’Œä¸€ä¸ªæ•°æ®åº“ï¼ˆå½“ç„¶éƒ½æ˜¯ç”¨6502 ASMç¼–å†™çš„ï¼‰ï¼Œå®ƒä»¬å®ç°äº†ä»¥ä¸‹åè®®ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">XMLImportNode</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">firstChild</span><span class="params">(with tag: String)</span></span> -&gt; <span class="type">XMLImportNode</span>?</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">children</span><span class="params">(with tag: String)</span></span> -&gt; [<span class="type">XMLImportNode</span>]</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">attribute</span><span class="params">(with name: String)</span></span> -&gt; <span class="type">String</span>?</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typealias</span> <span class="type">DatabaseUser</span> = <span class="type">String</span></span><br><span class="line"><span class="keyword">typealias</span> <span class="type">DatabaseSoftware</span> = <span class="type">String</span></span><br><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">Database</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">user</span><span class="params">(<span class="keyword">for</span> id: String)</span></span> <span class="keyword">throws</span> -&gt; <span class="type">DatabaseUser</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">software</span><span class="params">(<span class="keyword">for</span> id: String)</span></span> <span class="keyword">throws</span> -&gt; <span class="type">DatabaseSoftware</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">insertSoftware</span><span class="params">(user: DatabaseUser, name: String, id: String, type: String, amount: Int)</span></span> <span class="keyword">throws</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">updateSoftware</span><span class="params">(software: DatabaseSoftware, amount: Int)</span></span> <span class="keyword">throws</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>XML æ–‡ä»¶å¯èƒ½çœ‹èµ·æ¥åƒè¿™æ ·ï¼š</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">users</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">user</span> <span class="attr">name</span>=<span class="string">""</span> <span class="attr">id</span>=<span class="string">"158"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">software</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">package</span> <span class="attr">type</span>=<span class="string">"game"</span> <span class="attr">name</span>=<span class="string">"Maniac Mansion"</span> <span class="attr">id</span>=<span class="string">"4332"</span> <span class="attr">amount</span>=<span class="string">"30"</span> /&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">package</span> <span class="attr">type</span>=<span class="string">"game"</span> <span class="attr">name</span>=<span class="string">"Doom"</span> <span class="attr">id</span>=<span class="string">"1337"</span> <span class="attr">amount</span>=<span class="string">"50"</span> /&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">package</span> <span class="attr">type</span>=<span class="string">"game"</span> <span class="attr">name</span>=<span class="string">"Warcraft 2"</span> <span class="attr">id</span>=<span class="string">"1000"</span> <span class="attr">amount</span>=<span class="string">"10"</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">software</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">user</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">users</span>&gt;</span></span><br></pre></td></tr></table></figure><p>è§£æ XML çš„ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">ParseError</span>: <span class="title">Error</span> </span>&#123;</span><br><span class="line">    <span class="keyword">case</span> msg(<span class="type">String</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">parseGamesFromXML</span><span class="params">(from root: XMLImportNode, into database: Database)</span></span> <span class="keyword">throws</span> &#123;</span><br><span class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> users = root.firstChild(with: <span class="string">"users"</span>)?.children(with: <span class="string">"user"</span>) <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">throw</span> <span class="type">ParseError</span>.msg(<span class="string">"No Users"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> user <span class="keyword">in</span> users &#123;</span><br><span class="line"><span class="keyword">guard</span> <span class="keyword">let</span> software = user.firstChild(with: <span class="string">"software"</span>)?</span><br><span class="line">.children(with: <span class="string">"package"</span>),</span><br><span class="line">    <span class="keyword">let</span> userId = user.attribute(with: <span class="string">"id"</span>),</span><br><span class="line">    <span class="keyword">let</span> dbUser = <span class="keyword">try</span>? database.user(<span class="keyword">for</span>: userId)</span><br><span class="line">    <span class="keyword">else</span> &#123; <span class="keyword">throw</span> <span class="type">ParseError</span>.msg(<span class="string">"Invalid User"</span>) &#125;</span><br><span class="line"><span class="keyword">for</span> package <span class="keyword">in</span> software &#123;</span><br><span class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> type = package.attribute(with: <span class="string">"type"</span>),</span><br><span class="line">    type == <span class="string">"game"</span>,</span><br><span class="line">    <span class="keyword">let</span> name = package.attribute(with: <span class="string">"name"</span>),</span><br><span class="line">    <span class="keyword">let</span> softwareId = package.attribute(with: <span class="string">"id"</span>),</span><br><span class="line">    <span class="keyword">let</span> amountString = package.attribute(with: <span class="string">"amount"</span>)</span><br><span class="line">    <span class="keyword">else</span> &#123; <span class="keyword">throw</span> <span class="type">ParseError</span>.msg(<span class="string">"Invalid Package"</span>) &#125;</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> existing = <span class="keyword">try</span>? database.software(<span class="keyword">for</span>: softwareId) &#123;</span><br><span class="line"><span class="keyword">try</span> database.updateSoftware(software: existing, </span><br><span class="line">      amount: <span class="type">Int</span>(amountString) ?? <span class="number">0</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">try</span> database.insertSoftware(user: dbUser, name: name, </span><br><span class="line">      id: softwareId, </span><br><span class="line">    type: type, </span><br><span class="line">  amount: <span class="type">Int</span>(amountString) ?? <span class="number">0</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è®©æˆ‘ä»¬è¿ç”¨ä¸‹ä¸Šé¢å­¦åˆ°çš„å†…å®¹ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">parseGamesFromXML</span><span class="params">(from root: XMLImportNode, into database: Database)</span></span> <span class="keyword">throws</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> user <span class="keyword">in</span> <span class="keyword">try</span> root.firstChild(with: <span class="string">"users"</span>)</span><br><span class="line">    .or(<span class="keyword">throw</span>: <span class="type">ParseError</span>.msg(<span class="string">"No Users"</span>)).children(with: <span class="string">"user"</span>) &#123;</span><br><span class="line"><span class="keyword">let</span> dbUser = <span class="keyword">try</span> user.attribute(with: <span class="string">"id"</span>)</span><br><span class="line">    .and(then: &#123; <span class="keyword">try</span>? database.user(<span class="keyword">for</span>: $<span class="number">0</span>) &#125;)</span><br><span class="line">    .or(<span class="keyword">throw</span>: <span class="type">ParseError</span>.msg(<span class="string">"Invalid User"</span>))</span><br><span class="line"><span class="keyword">for</span> package <span class="keyword">in</span> (user.firstChild(with: <span class="string">"software"</span>)?</span><br><span class="line">    .children(with: <span class="string">"package"</span>)).or([]) &#123;</span><br><span class="line">    <span class="keyword">guard</span> (package.attribute(with: <span class="string">"type"</span>)).<span class="built_in">filter</span>(&#123; $<span class="number">0</span> == <span class="string">"game"</span> &#125;).isSome</span><br><span class="line"><span class="keyword">else</span> &#123; <span class="keyword">continue</span> &#125;</span><br><span class="line">    <span class="keyword">try</span> package.attribute(with: <span class="string">"name"</span>)</span><br><span class="line">.zip3(with: package.attribute(with: <span class="string">"id"</span>), </span><br><span class="line">   another: package.attribute(with: <span class="string">"amount"</span>))</span><br><span class="line">.<span class="built_in">map</span>(&#123; (tuple) -&gt; <span class="type">Void</span> <span class="keyword">in</span></span><br><span class="line">    <span class="keyword">switch</span> <span class="keyword">try</span>? database.software(<span class="keyword">for</span>: tuple.<span class="number">1</span>) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="keyword">let</span> e?: <span class="keyword">try</span> database.updateSoftware(software: e, </span><br><span class="line">       amount: <span class="type">Int</span>(tuple.<span class="number">2</span>).or(<span class="number">0</span>))</span><br><span class="line">    <span class="keyword">default</span>: <span class="keyword">try</span> database.insertSoftware(user: dbUser, name: tuple.<span class="number">0</span>, </span><br><span class="line">   id: tuple.<span class="number">1</span>, type: <span class="string">"game"</span>, </span><br><span class="line">       amount: <span class="type">Int</span>(tuple.<span class="number">2</span>).or(<span class="number">0</span>))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;, or: &#123; <span class="keyword">throw</span> <span class="type">ParseError</span>.msg(<span class="string">"Invalid Package"</span>) &#125;)</span><br><span class="line">&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœæˆ‘ä»¬å¯¹æ¯”ä¸‹ï¼Œè‡³å°‘ä¼šæœ‰ä¸¤ç‚¹æ˜ å…¥çœ¼å¸˜ï¼š</p><ol><li>ä»£ç é‡æ›´å°‘</li><li>ä»£ç çœ‹èµ·æ¥æ›´å¤æ‚äº†</li></ol><p>åœ¨ç»„åˆä½¿ç”¨å¯é€‰æ‰©å±•æ—¶ï¼Œæˆ‘æ•…æ„é€ æˆä¸€ç§è¿‡è½½çŠ¶æ€ã€‚å…¶ä¸­çš„ä¸€éƒ¨åˆ†ä½¿ç”¨å¾ˆæ°å½“ï¼Œä½†æ˜¯å¦ä¸€éƒ¨åˆ†å´ä¸é‚£ä¹ˆåˆé€‚ã€‚ç„¶è€Œï¼Œä½¿ç”¨æ‰©å±•çš„å…³é”®ä¸åœ¨äºè¿‡åº¦ä¾èµ–ï¼ˆæ­£å¦‚æˆ‘ä¸Šé¢åšçš„é‚£æ ·ï¼‰ï¼Œè€Œåœ¨äºè¿™äº›æ‰©å±•æ˜¯å¦ä½¿è¯­ä¹‰æ›´åŠ æ¸…æ™°æ˜äº†ã€‚æ¯”è¾ƒä¸Šé¢çš„ä¸¤ä¸ªå®ç°æ–¹å¼ï¼Œ<br>åœ¨ç¬¬äºŒä¸ªå®ç°ä¸­ï¼Œè€ƒè™‘ä¸‹æ˜¯ä½¿ç”¨ Swift æœ¬èº«æä¾›çš„åŠŸèƒ½å¥½è¿˜æ˜¯ä½¿ç”¨å¯é€‰æ‰©å±•æ›´ä½³ã€‚</p><p>è¿™å°±æ˜¯æœ¬æ–‡çš„å…¨éƒ¨å†…å®¹ï¼Œæ„Ÿè°¢é˜…è¯»ï¼</p><blockquote><p>æœ¬æ–‡ç”± SwiftGG ç¿»è¯‘ç»„ç¿»è¯‘ï¼Œå·²ç»è·å¾—ä½œè€…ç¿»è¯‘æˆæƒï¼Œæœ€æ–°æ–‡ç« è¯·è®¿é—® <a href="http://swift.gg">http://swift.gg</a>ã€‚</p></blockquote>]]></content>
    
    <summary type="html">
    
      å…³äº Swift å¯é€‰é¡¹ï¼ˆOptionalï¼‰æ‰©å±•
    
    </summary>
    
      <category term="APPVENTURE" scheme="https://swift.gg/categories/APPVENTURE/"/>
    
    
      <category term="Swiftï¼ŒiOSå¼€å‘ï¼ŒSwiftè¿›é˜¶" scheme="https://swift.gg/tags/Swift%EF%BC%8CiOS%E5%BC%80%E5%8F%91%EF%BC%8CSwift%E8%BF%9B%E9%98%B6/"/>
    
  </entry>
  
  <entry>
    <title>Mirror çš„å·¥ä½œåŸç†</title>
    <link href="https://swift.gg/2018/11/15/how-mirror-works/"/>
    <id>https://swift.gg/2018/11/15/how-mirror-works/</id>
    <published>2018-11-15T00:00:00.000Z</published>
    <updated>2019-02-19T03:45:13.515Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ä½œè€…ï¼šMike Ashï¼Œ<a href="https://swift.org/blog/how-mirror-works/" target="_blank" rel="noopener">åŸæ–‡é“¾æ¥</a>ï¼ŒåŸæ–‡æ—¥æœŸï¼š2018-09-26<br>è¯‘è€…ï¼š<a href="https://nemocdz.github.io/" target="_blank" rel="noopener">Nemocdz</a>ï¼›æ ¡å¯¹ï¼š<a href="http://numbbbbb.com/" target="_blank" rel="noopener">numbbbbb</a>ï¼Œ<a href="http://linusling.com" target="_blank" rel="noopener">å°é“åŒ Linus</a>ï¼›å®šç¨¿ï¼š<a href="http://forelax.space" target="_blank" rel="noopener">Forelax</a></p></blockquote><!--æ­¤å¤„å¼€å§‹æ­£æ–‡--><p>å°½ç®¡ Swift é‡å¿ƒåœ¨å¼ºè°ƒé™æ€ç±»å‹ä¸Šï¼Œä½†å®ƒåŒæ—¶æ”¯æŒä¸°å¯Œçš„å…ƒæ•°æ®ç±»å‹ã€‚å…ƒæ•°æ®ç±»å‹å…è®¸ä»£ç åœ¨è¿è¡Œæ—¶æ£€æŸ¥å’Œæ“ä½œä»»æ„å€¼ã€‚è¿™ä¸ªåŠŸèƒ½é€šè¿‡ <code>Mirror</code> API æš´éœ²ç»™ Swift å¼€å‘è€…ã€‚å¤§å®¶å¯èƒ½ä¼šæ„Ÿåˆ°å›°æƒ‘ï¼Œåœ¨ Swift è¿™ç§å¦‚æ­¤å¼ºè°ƒé™æ€ç±»å‹çš„è¯­è¨€é‡Œï¼Œ<code>Mirror</code> è¿™æ ·çš„ç‰¹æ€§æ˜¯æ€ä¹ˆå·¥ä½œçš„ï¼Ÿè®©æˆ‘ä»¬ä¸€èµ·æ¥é€šè¿‡è¿™ç¯‡æ–‡ç« äº†è§£ä¸€ä¸‹ã€‚</p><a id="more"></a><h2 id="äº‹å…ˆå£°æ˜"><a href="#äº‹å…ˆå£°æ˜" class="headerlink" title="äº‹å…ˆå£°æ˜"></a>äº‹å…ˆå£°æ˜</h2><p>è¿™é‡Œä»‹ç»çš„ä¸œè¥¿éƒ½æ˜¯å†…éƒ¨å®ç°çš„ç»†èŠ‚ã€‚è¿™äº›ä»£ç çš„ç‰ˆæœ¬æ˜¯å†™ä¸‹æ–‡ç« æ—¶çš„ç‰ˆæœ¬ï¼Œä»£ç å¯èƒ½ä¼šéšç€ç‰ˆæœ¬æ”¹å˜ã€‚å…ƒæ•°æ®ä¼šéšç€ ABI ç¨³å®šçš„åˆ°æ¥è€Œå˜å¾—ç¨³å®šå’Œå¯é ï¼Œä½†åœ¨åˆ°æ¥é‚£æ—¶ä¹Ÿä¼šå®¹æ˜“å‘ç”Ÿå˜åŒ–ã€‚å¤§å®¶åœ¨å†™æ—¥å¸¸çš„ Swift ä»£ç æ—¶ï¼Œä¸è¦ä¾èµ–è¿™é‡Œè®²çš„ä¸€åˆ‡ã€‚å¦‚æœä½ æƒ³åšæ¯” <code>Mirror</code> æ‰€æä¾›çš„æ–¹å¼æ›´å¤æ‚çš„åå°„ï¼Œè¿™é‡Œä¼šç»™ä½ ä¸€äº›æ€è·¯ã€‚ä½†åœ¨ ABI çš„ç¨³å®šå‰ï¼Œè¿˜éœ€è¦ä¿æŒç›¸å…³å˜åŒ–çš„å…³æ³¨ã€‚å¦‚æœä½ æƒ³ä½¿ç”¨ <code>Mirror</code> æœ¬èº«ï¼Œè¿™ç¯‡æ–‡ç« ä¼šæä¾›ä¸€äº›å¥½çš„æ€è·¯å»åšæ¥å…¥å’Œé€‚é…ã€‚ä¸è¿‡å†æ¬¡æé†’ï¼Œè¿™äº›ä¸œè¥¿å¯èƒ½ä¼šéšç€ç‰ˆæœ¬è€Œæ”¹å˜ã€‚</p><h2 id="æ¥å£"><a href="#æ¥å£" class="headerlink" title="æ¥å£"></a>æ¥å£</h2><p><code>Mirror(reflecting:)</code> åˆå§‹åŒ–æ–¹æ³•å¯ä»¥æ¥å—ä»»æ„å€¼ï¼Œè¿”å›ç»“æœæ˜¯ä¸€ä¸ªæä¾›è¯¥å€¼å­å…ƒç´ é›†åˆ <code>Children</code> çš„ç›¸å…³ä¿¡æ¯çš„å®ä¾‹ã€‚ä¸€ä¸ª <code>Child</code> ç”±å¯é€‰çš„æ ‡ç­¾å’Œå€¼æ„æˆã€‚å¯ä»¥åœ¨ç¼–è¯‘æœŸä¸”ä¸ç”¨çŸ¥é“ä»»ä½•ç±»å‹ä¿¡æ¯æƒ…å†µä¸‹ï¼Œåœ¨ <code>Child</code> çš„å€¼ä¸Šç”¨ <code>Mirror</code> å»éå†æ•´ä¸ªå¯¹è±¡çš„å±‚çº§è§†å›¾ã€‚</p><p><code>Mirror</code> å…è®¸ç±»å‹ç”¨éµå¾ª <code>CustomReflectable</code> åè®®çš„æ–¹å¼æä¾›ä¸€ä¸ªè‡ªå®šä¹‰çš„è¡¨ç¤ºæ–¹å¼ã€‚è¿™ç»™é‚£äº›æƒ³è¡¨ç¤ºå¾—æ¯”å†…å»ºå½¢å¼æ›´å‹å¥½çš„ç±»å‹æä¾›ä¸€ç§æœ‰æ•ˆçš„æ–¹æ³•ã€‚ æ¯”å¦‚ <code>Array</code> ç±»å‹éµå®ˆ <code>CustomReflectable</code> åè®®å¹¶ä¸”æš´éœ²å…¶ä¸­çš„å…ƒç´ ä¸ºæ— æ ‡ç­¾çš„ <code>Children</code>ã€‚<code>Dictionary</code> ä½¿ç”¨è¿™ç§æ–¹æ³•æš´éœ²å…¶ä¸­çš„é”®å€¼å¯¹ä¸ºå¸¦æ ‡ç­¾çš„ <code>Children</code>ã€‚</p><p>å¯¹äºå…¶ä»–ç±»å‹ï¼Œ<code>Mirror</code> ç”¨é­”æ³•å»è¿”å›ä¸€ä¸ªåŸºäºå…¶ä¸­çš„å®é™…å­å…ƒç´ çš„ <code>Children</code> é›†åˆã€‚å¯¹äºç»“æ„ä½“å’Œç±»ï¼Œ<code>Children</code> ä¸ºå…¶ä¸­å‚¨å­˜çš„å±æ€§å€¼ã€‚å¯¹äºå…ƒç»„ï¼Œ<code>Children</code> ä¸ºå…ƒç»„çš„å­å…ƒç´ ã€‚æšä¸¾åˆ™æ˜¯æšä¸¾çš„ case å’Œå…¶å…³è”çš„å€¼ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰ã€‚</p><p>è¿™äº›ç¥å¥‡çš„é­”æ³•æ˜¯æ€ä¹ˆå·¥ä½œçš„å‘¢ï¼Ÿè®©æˆ‘ä»¬ä¸€èµ·æ¥äº†è§£ä¸€ä¸‹ã€‚</p><h2 id="ä»£ç ç»“æ„"><a href="#ä»£ç ç»“æ„" class="headerlink" title="ä»£ç ç»“æ„"></a>ä»£ç ç»“æ„</h2><p>åå°„çš„ API æœ‰ä¸€éƒ¨åˆ†æ˜¯ç”¨ Swift å®ç°çš„ï¼Œå¦ä¸€éƒ¨åˆ†æ˜¯ç”¨ C++ å®ç°çš„ã€‚Swift æ›´é€‚åˆç”¨åœ¨å®ç°æ›´ Swift çš„æ¥å£ï¼Œå¹¶è®©å¾ˆå¤šä»»åŠ¡å˜å¾—æ›´ç®€å•ã€‚Swift çš„è¿è¡Œæ—¶çš„åº•å±‚æ˜¯ä½¿ç”¨ C++ å®ç°çš„ï¼Œä½†æ˜¯åœ¨ Swift ä¸­ä¸èƒ½ç›´æ¥è®¿é—® C++ çš„ç±»ï¼Œæ‰€ä»¥æœ‰ä¸€ä¸ª C çš„è¿æ¥å±‚ã€‚åå°„çš„ Swift å®ç°åœ¨ <a href="https://github.com/apple/swift/blob/master/stdlib/public/core/ReflectionMirror.swift" target="_blank" rel="noopener">ReflectionMirror.swift</a>ï¼ŒC++ å®ç°åœ¨ <a href="https://github.com/apple/swift/blob/master/stdlib/public/runtime/ReflectionMirror.mm" target="_blank" rel="noopener">ReflectionMirror.mm</a>ã€‚</p><p>è¿™ä¸¤è€…é€šè¿‡ä¸€å°ç»„æš´éœ²ç»™ Swift çš„ C++ å‡½æ•°è¿›è¡Œé€šä¿¡çš„ã€‚ä¸å…¶ä½¿ç”¨ Swift ç”Ÿæˆçš„ C æ¡¥æ¥å±‚ï¼Œä¸å¦‚å°†è¿™äº›å‡½æ•°åœ¨ Swift ä¸­ç›´æ¥å£°æ˜æˆæŒ‡å®šçš„è‡ªå®šä¹‰ç¬¦å·ï¼Œè€Œè¿™äº›åå­—çš„ C++ å‡½æ•°åˆ™ä¸“é—¨å®ç°ä¸ºå¯ä»¥è¢« Swift ç›´æ¥è°ƒç”¨çš„æ–¹å¼ã€‚è¿™ä¸¤éƒ¨åˆ†çš„ä»£ç å¯ä»¥åœ¨ä¸å…³å¿ƒæ¡¥æ¥æœºåˆ¶ä¼šåœ¨å¹•åå¦‚ä½•å¤„ç†ä¼ é€’å€¼çš„æƒ…å†µä¸‹äº¤äº’ï¼Œä½†ä»éœ€è¦å‡†ç¡®çš„çŸ¥é“ Swift åº”è¯¥å¦‚ä½•ä¼ é€’å‚æ•°å’Œè¿”å›å€¼ã€‚é™¤éä½ åœ¨ä½¿ç”¨éœ€è¦å®ƒçš„è¿è¡Œæ—¶ä»£ç ï¼Œå¦åˆ™åˆ«è½»æ˜“å°è¯•è¿™äº›ã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼Œè®©æˆ‘ä»¬çœ‹ä¸‹åœ¨ <code>ReflectionMirror.swift</code> ä¸­çš„ <code>_getChildCount</code> å‡½æ•°ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">@_silgen_name(<span class="string">"swift_reflectionMirror_count"</span>)</span><br><span class="line"><span class="keyword">internal</span> <span class="function"><span class="keyword">func</span> <span class="title">_getChildCount</span>&lt;T&gt;<span class="params">(<span class="number">_</span>: T, type: Any.<span class="keyword">Type</span>)</span></span> -&gt; <span class="type">Int</span></span><br></pre></td></tr></table></figure><p><code>@_silgen_name</code> ä¿®é¥°ç¬¦ä¼šé€šçŸ¥ Swift ç¼–è¯‘å™¨å°†è¿™ä¸ªå‡½æ•°æ˜ å°„æˆ <code>swift_reflectionMirror_count</code> ç¬¦å·ï¼Œè€Œä¸æ˜¯ Swift é€šå¸¸å¯¹åº”åˆ°çš„ <code>_getChildCount</code> æ–¹æ³•åä¿®é¥°ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæœ€å‰é¢çš„ä¸‹åˆ’çº¿è¡¨ç¤ºè¿™ä¸ªä¿®é¥°ç¬¦æ˜¯è¢«ä¿ç•™åœ¨æ ‡å‡†åº“ä¸­çš„ã€‚åœ¨ C++ è¿™è¾¹ï¼Œè¿™ä¸ªå‡½æ•°æ˜¯è¿™æ ·çš„ï¼š</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">SWIFT_CC(swift) SWIFT_RUNTIME_STDLIB_INTERFACE</span><br><span class="line"><span class="keyword">intptr_t</span> swift_reflectionMirror_count(OpaqueValue *value,</span><br><span class="line">                                      <span class="keyword">const</span> Metadata *type,</span><br><span class="line">                                      <span class="keyword">const</span> Metadata *T) &#123;</span><br></pre></td></tr></table></figure><p><code>SWIFT_CC(swift)</code> ä¼šå‘Šè¯‰ç¼–è¯‘å™¨è¿™ä¸ªå‡½æ•°ä½¿ç”¨çš„æ˜¯ Swift çš„è°ƒç”¨çº¦å®šï¼Œè€Œä¸æ˜¯ C/C++ çš„ã€‚<code>SWIFT_RUNTIME_STDLIB_INTERFACE</code> æ ‡è®°è¿™æ˜¯ä¸ªå‡½æ•°ï¼Œåœ¨ Swift ä¾§çš„ä¸€éƒ¨åˆ†æ¥å£ä¸­ï¼Œè€Œä¸”å®ƒè¿˜æœ‰æ ‡è®°ä¸º <code>extern &quot;C&quot;</code> çš„ä½œç”¨ä»è€Œé¿å… C++ çš„æ–¹æ³•åä¿®é¥°ï¼Œå¹¶ç¡®ä¿å®ƒåœ¨ Swift ä¾§ä¼šæœ‰é¢„æœŸçš„ç¬¦å·ã€‚åŒæ—¶ï¼ŒC++ çš„å‚æ•°ä¼šå»ç‰¹æ„åŒ¹é…åœ¨ Swift ä¸­å£°æ˜çš„å‡½æ•°è°ƒç”¨ã€‚å½“ Swift è°ƒç”¨ <code>_getChildCount</code> æ—¶ï¼ŒC++ ä¼šç”¨åŒ…å«çš„ Swift å€¼æŒ‡é’ˆçš„ <code>value</code>ï¼ŒåŒ…å«ç±»å‹å‚æ•°çš„ <code>type</code>ï¼ŒåŒ…å«ç±»å‹ç›¸åº”çš„èŒƒå‹ <code>&lt;T&gt;</code> çš„ <code>T</code> çš„å‡½æ•°å‚æ•°æ¥è°ƒç”¨æ­¤å‡½æ•°ã€‚</p><p><code>Mirror</code> çš„åœ¨ Swift å’Œ C++ ä¹‹é—´çš„å…¨éƒ¨æ¥å£ç”±ä»¥ä¸‹å‡½æ•°ç»„æˆï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">@_silgen_name(<span class="string">"swift_reflectionMirror_normalizedType"</span>)</span><br><span class="line"><span class="keyword">internal</span> <span class="function"><span class="keyword">func</span> <span class="title">_getNormalizedType</span>&lt;T&gt;<span class="params">(<span class="number">_</span>: T, type: Any.<span class="keyword">Type</span>)</span></span> -&gt; <span class="type">Any</span>.<span class="type">Type</span></span><br><span class="line"></span><br><span class="line">@_silgen_name(<span class="string">"swift_reflectionMirror_count"</span>)</span><br><span class="line"><span class="keyword">internal</span> <span class="function"><span class="keyword">func</span> <span class="title">_getChildCount</span>&lt;T&gt;<span class="params">(<span class="number">_</span>: T, type: Any.<span class="keyword">Type</span>)</span></span> -&gt; <span class="type">Int</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">internal</span> <span class="keyword">typealias</span> <span class="type">NameFreeFunc</span> = <span class="meta">@convention</span>(<span class="built_in">c</span>) (<span class="type">UnsafePointer</span>&lt;<span class="type">CChar</span>&gt;?) -&gt; <span class="type">Void</span></span><br><span class="line"></span><br><span class="line">@_silgen_name(<span class="string">"swift_reflectionMirror_subscript"</span>)</span><br><span class="line"><span class="keyword">internal</span> <span class="function"><span class="keyword">func</span> <span class="title">_getChild</span>&lt;T&gt;<span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">  of: T,</span></span></span><br><span class="line"><span class="function"><span class="params">  type: Any.<span class="keyword">Type</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">  index: Int,</span></span></span><br><span class="line"><span class="function"><span class="params">  outName: UnsafeMutablePointer&lt;UnsafePointer&lt;CChar&gt;?&gt;,</span></span></span><br><span class="line"><span class="function"><span class="params">  outFreeFunc: UnsafeMutablePointer&lt;NameFreeFunc?&gt;</span></span></span><br><span class="line"><span class="function"><span class="params">)</span></span> -&gt; <span class="type">Any</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Returns 'c' (class), 'e' (enum), 's' (struct), 't' (tuple), or '\0' (none)</span></span><br><span class="line">@_silgen_name(<span class="string">"swift_reflectionMirror_displayStyle"</span>)</span><br><span class="line"><span class="keyword">internal</span> <span class="function"><span class="keyword">func</span> <span class="title">_getDisplayStyle</span>&lt;T&gt;<span class="params">(<span class="number">_</span>: T)</span></span> -&gt; <span class="type">CChar</span></span><br><span class="line"></span><br><span class="line">@_silgen_name(<span class="string">"swift_reflectionMirror_quickLookObject"</span>)</span><br><span class="line"><span class="keyword">internal</span> <span class="function"><span class="keyword">func</span> <span class="title">_getQuickLookObject</span>&lt;T&gt;<span class="params">(<span class="number">_</span>: T)</span></span> -&gt; <span class="type">AnyObject</span>?</span><br><span class="line"></span><br><span class="line">@_silgen_name(<span class="string">"_swift_stdlib_NSObject_isKindOfClass"</span>)</span><br><span class="line"><span class="keyword">internal</span> <span class="function"><span class="keyword">func</span> <span class="title">_isImpl</span><span class="params">(<span class="number">_</span> object: AnyObject, kindOf: AnyObject)</span></span> -&gt; <span class="type">Bool</span></span><br></pre></td></tr></table></figure><h2 id="ç¥å¥‡çš„åŠ¨æ€æ´¾å‘"><a href="#ç¥å¥‡çš„åŠ¨æ€æ´¾å‘" class="headerlink" title="ç¥å¥‡çš„åŠ¨æ€æ´¾å‘"></a>ç¥å¥‡çš„åŠ¨æ€æ´¾å‘</h2><p>æ²¡æœ‰ä¸€ç§å•ä¸€ã€é€šç”¨çš„æ–¹å¼å»è·å–ä»»æ„ç±»å‹ä¸­æˆ‘ä»¬æƒ³è¦çš„ä¿¡æ¯ã€‚å…ƒç»„ã€ç»“æ„ã€ç±»å’Œæšä¸¾éƒ½éœ€è¦ä¸åŒçš„ä»£ç å»å®Œæˆè¿™äº›ç¹å¤šçš„ä»»åŠ¡ï¼Œæ¯”å¦‚è¯´æŸ¥æ‰¾å­å…ƒç´ çš„æ•°é‡ã€‚å…¶ä¸­è¿˜æœ‰ä¸€äº›æ›´æ·±ã€å¾®å¦™çš„ä¸åŒä¹‹å¤„ï¼Œæ¯”å¦‚å¯¹ Swift å’Œ Objective-C çš„ç±»çš„ä¸åŒå¤„ç†ã€‚</p><p>æ‰€æœ‰çš„è¿™äº›å‡½æ•°å› ä¸ºéœ€è¦ä¸åŒç±»å‹çš„æ£€æŸ¥è€Œéœ€è¦æ´¾å‘ä¸åŒçš„å®ç°ä»£ç ã€‚è¿™å¬èµ·æ¥æœ‰ç‚¹åƒåŠ¨æ€æ–¹æ³•æ´¾å‘ï¼Œé™¤äº†é€‰æ‹©å“ªç§å®ç°å»è°ƒç”¨æ¯”æ£€æŸ¥å¯¹è±¡ç±»å‹æ‰€ä½¿ç”¨çš„æ–¹æ³•æ›´å¤æ‚ä¹‹å¤–ã€‚è¿™äº›åå°„ä»£ç å°è¯•å»ç®€åŒ–ä½¿ç”¨åŒ…å« C++ ç‰ˆæœ¬ä¿¡æ¯çš„æ¥å£çš„æŠ½è±¡åŸºç±»ï¼Œè¿˜æœ‰ä¸€å¤§å †åŒ…å«å„ç§å„æ ·æƒ…å†µçš„å­ç±»è¿›è¡Œ C++ çš„åŠ¨æ€æ´¾å‘ã€‚ä¸€ä¸ªå•ç‹¬çš„å‡½æ•°ä¼šå°†ä¸€ä¸ª Swift ç±»å‹æ˜ å°„æˆä¸€ä¸ªå…¶ä¸­çš„ C++ ç±»çš„å®ä¾‹ã€‚åœ¨ä¸€ä¸ªå®ä¾‹ä¸Šè°ƒç”¨ä¸€ä¸ªæ–¹æ³•ç„¶åæ´¾å‘åˆé€‚çš„å®ç°ã€‚</p><p>æ˜ å°„çš„å‡½æ•°å«åš <code>call</code>ï¼Œå£°æ˜æ˜¯è¿™æ ·çš„ï¼š</p><figure class="highlight"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> F&gt;</span><br><span class="line"><span class="function"><span class="keyword">auto</span> <span class="title">call</span><span class="params">(OpaqueValue *passedValue, <span class="keyword">const</span> Metadata *T, <span class="keyword">const</span> Metadata *passedType,</span></span></span><br><span class="line">          const F &amp;f) -&gt; decltype(f(nullptr))</span><br></pre></td></tr></table></figure><p><code>passedValue</code> æ˜¯å®é™…éœ€è¦ä¼ å…¥çš„Swiftçš„å€¼çš„æŒ‡é’ˆã€‚<code>T</code> æ˜¯è¯¥å€¼å¾—é™æ€ç±»å‹ï¼Œå¯¹åº” Swift ä¸­çš„èŒƒå‹å‚æ•° <code>&lt;T&gt;</code>ã€‚<code>passedType</code> æ˜¯è¢«æ˜¾å¼ä¼ é€’è¿› Swift ä¾§å¹¶ä¸”ä¼šå®é™…åº”ç”¨åœ¨åå°„è¿‡ç¨‹ä¸­çš„ç±»å‹ï¼ˆè¿™ä¸ªç±»å‹å’Œåœ¨ä½¿ç”¨ <code>Mirror</code> ä½œä¸ºçˆ¶ç±»çš„å®ä¾‹åœ¨å®é™…è¿è¡Œæ—¶çš„å¯¹è±¡ç±»å‹ä¸ä¸€æ ·ï¼‰ã€‚æœ€åï¼Œ<code>f</code> å‚æ•°ä¼šä¼ é€’è¿™ä¸ªå‡½æ•°æŸ¥æ‰¾åˆ°çš„ä¼šè¢«è°ƒç”¨çš„å®ç°çš„å¯¹è±¡å¼•ç”¨ã€‚ç„¶åè¿™ä¸ªå‡½æ•°ä¼šè¿”å›å½“è¿™ä¸ª <code>f</code> å‚æ•°è°ƒç”¨æ—¶çš„è¿”å›å€¼ï¼Œå¯ä»¥è®©ä½¿ç”¨è€…æ›´æ–¹ä¾¿çš„è·å¾—è¿”å›å€¼ã€‚</p><p><code>call</code> çš„å®ç°å¹¶æ²¡æœ‰æƒ³è±¡ä¸­é‚£ä¹ˆä»¤äººæ¿€åŠ¨ã€‚ä¸»è¦æ˜¯ä¸€ä¸ªå¤§å‹çš„ <code>switch</code> å£°æ˜å’Œä¸€äº›é¢å¤–çš„ä»£ç å»å¤„ç†ç‰¹æ®Šçš„æƒ…å†µã€‚é‡è¦çš„æ˜¯å®ƒä¼šç”¨ä¸€ä¸ª <code>ReflectionMirrorImpl</code> çš„å­ç±»å®ä¾‹å»ç»“æŸè°ƒç”¨ <code>f</code>ï¼Œç„¶åä¼šè°ƒç”¨è¿™ä¸ªå®ä¾‹ä¸Šçš„æ–¹æ³•å»è®©çœŸæ­£çš„å·¥ä½œå®Œæˆã€‚</p><p>è¿™æ˜¯ <code>ReflectionMirrorImpl</code>ï¼Œæ¥å£çš„æ‰€æœ‰ä¸œè¥¿éƒ½è¦ä¼ å…¥ï¼š</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">ReflectionMirrorImpl</span> &#123;</span></span><br><span class="line">  <span class="keyword">const</span> Metadata *type;</span><br><span class="line">  OpaqueValue *value;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">virtual</span> <span class="keyword">char</span> <span class="title">displayStyle</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line">  <span class="function"><span class="keyword">virtual</span> intptr_t <span class="title">count</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line">  <span class="function"><span class="keyword">virtual</span> AnyReturn <span class="title">subscript</span><span class="params">(<span class="keyword">intptr_t</span> index, <span class="keyword">const</span> <span class="keyword">char</span> **outName,</span></span></span><br><span class="line">                              void (**outFreeFunc)(const char *)) = 0;</span><br><span class="line">  <span class="function"><span class="keyword">virtual</span> <span class="keyword">const</span> <span class="keyword">char</span> *<span class="title">enumCaseName</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> <span class="literal">nullptr</span>; &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> SWIFT_OBJC_INTEROP</span></span><br><span class="line">  <span class="function"><span class="keyword">virtual</span> id <span class="title">quickLookObject</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> nil; &#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">virtual</span> ~ReflectionMirrorImpl() &#123;&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>ä½œç”¨åœ¨ Swift å’Œ C++ ç»„ä»¶ä¹‹é—´çš„æ¥å£å‡½æ•°å°±ä¼šç”¨ <code>call</code> å»è°ƒç”¨ç›¸åº”çš„æ–¹æ³•ã€‚æ¯”å¦‚ï¼Œ<code>swift_reflectionMirror_count</code> æ˜¯è¿™æ ·çš„ï¼š</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">SWIFT_CC(swift) SWIFT_RUNTIME_STDLIB_INTERFACE</span><br><span class="line"><span class="keyword">intptr_t</span> swift_reflectionMirror_count(OpaqueValue *value,</span><br><span class="line">                                      <span class="keyword">const</span> Metadata *type,</span><br><span class="line">                                      <span class="keyword">const</span> Metadata *T) &#123;</span><br><span class="line">  <span class="keyword">return</span> call(value, T, type, [](ReflectionMirrorImpl *impl) &#123;</span><br><span class="line">    <span class="keyword">return</span> impl-&gt;count();</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å…ƒç»„çš„åå°„"><a href="#å…ƒç»„çš„åå°„" class="headerlink" title="å…ƒç»„çš„åå°„"></a>å…ƒç»„çš„åå°„</h2><p>å…ˆçœ‹çœ‹å…ƒç»„çš„åå°„ï¼Œåº”è¯¥æ˜¯æœ€ç®€å•çš„ä¸€ç§äº†ï¼Œä½†è¿˜æ˜¯åšäº†ä¸å°‘å·¥ä½œã€‚å®ƒä¸€å¼€å§‹ä¼šè¿”å› <code>&#39;t&#39;</code> çš„æ˜¾ç¤ºæ ·å¼æ¥è¡¨æ˜è¿™æ˜¯ä¸€ä¸ªå…ƒç»„ï¼š</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">TupleImpl</span> :</span> ReflectionMirrorImpl &#123;</span><br><span class="line">  <span class="function"><span class="keyword">char</span> <span class="title">displayStyle</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'t'</span>;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>è™½ç„¶ç”¨ç¡¬ç¼–ç çš„å¸¸é‡çœ‹èµ·æ¥ä¸æ˜¯å¾ˆå¸¸è§ï¼Œä¸è¿‡è¿™æ ·åšå¯ä»¥å®Œå…¨åœ¨åŒä¸€ä¸ªåœ°æ–¹ç»™ C++ å’Œ Swift è¿™ä¸ªå€¼çš„å¼•ç”¨ï¼Œå¹¶ä¸”ä»–ä»¬ä¸éœ€è¦ä½¿ç”¨æ¡¥æ¥å±‚è¿›è¡Œäº¤äº’ï¼Œè¿™è¿˜ç®—æ˜¯ä¸€ä¸ªåˆç†çš„é€‰æ‹©ã€‚</p><p>æ¥ä¸‹æ¥æ˜¯ <code>count</code> æ–¹æ³•ã€‚æ­¤æ—¶æˆ‘ä»¬çŸ¥é“ <code>type</code> å®é™…ä¸Šæ˜¯ä¸€ä¸ª <code>TupleTypeMetadata</code> ç±»å‹çš„æŒ‡é’ˆè€Œä¸ä»…ä»…æ˜¯ä¸€ä¸ª <code>Metadata</code> ç±»å‹çš„æŒ‡é’ˆã€‚<code>TupleTypeMetadata</code> æœ‰ä¸€ä¸ªè®°å½•å…ƒç»„çš„å…ƒç´ æ•°é‡çš„ <code>NumElements</code> å­—æ®µï¼Œç„¶åè¿™ä¸ªæ–¹æ³•å°±å®Œæˆäº†ï¼š</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">intptr_t</span> count() &#123;</span><br><span class="line">    <span class="keyword">auto</span> *Tuple = <span class="keyword">static_cast</span>&lt;<span class="keyword">const</span> TupleTypeMetadata *&gt;(type);</span><br><span class="line">    <span class="keyword">return</span> Tuple-&gt;NumElements;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p><code>subscript</code> æ–¹æ³•ä¼šåšæ›´å¤šä¸€ç‚¹çš„å·¥ä½œã€‚å®ƒä¹Ÿä»ä¸€æ ·çš„çš„ <code>static_cast</code> å‡½æ•°å¼€å§‹ï¼š</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function">AnyReturn <span class="title">subscript</span><span class="params">(<span class="keyword">intptr_t</span> i, <span class="keyword">const</span> <span class="keyword">char</span> **outName,</span></span></span><br><span class="line">                      void (**outFreeFunc)(const char *)) &#123;</span><br><span class="line">    <span class="keyword">auto</span> *Tuple = <span class="keyword">static_cast</span>&lt;<span class="keyword">const</span> TupleTypeMetadata *&gt;(type);</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥ï¼Œä¼šæœ‰ä¸€ä¸ªè¾¹ç•Œæ£€æŸ¥é¿å…è°ƒç”¨è€…è¯·æ±‚äº†è¿™ä¸ªå…ƒç»„ä¸å­˜åœ¨çš„ç´¢å¼•ï¼š</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (i &lt; <span class="number">0</span> || (<span class="keyword">size_t</span>)i &gt; Tuple-&gt;NumElements)</span><br><span class="line">      swift::crash(<span class="string">"Swift mirror subscript bounds check failure"</span>);</span><br></pre></td></tr></table></figure><p>ä¸‹æ ‡æœ‰ä¸¤ä¸ªä½œç”¨ï¼šå¯ä»¥æ£€ç´¢å…ƒç´ å’Œå¯¹åº”çš„åå­—ã€‚å¯¹äºä¸€ä¸ªç»“æ„ä½“æˆ–è€…ç±»æ¥è¯´ï¼Œè¿™ä¸ªåå­—å°±æ˜¯æ‰€å‚¨å­˜çš„å±æ€§åã€‚è€Œå¯¹äºå…ƒç»„æ¥è¯´ï¼Œè¿™ä¸ªåå­—è¦ä¹ˆæ˜¯è¯¥å…ƒç´ çš„å…ƒç»„æ ‡ç­¾ï¼Œè¦ä¹ˆåœ¨æ²¡æœ‰æ ‡ç­¾çš„æƒ…å†µä¸‹å°±æ˜¯ä¸€ä¸ªç±»ä¼¼ <code>.0</code> çš„æ•°å€¼æŒ‡ç¤ºå™¨ã€‚</p><p>æ ‡ç­¾ä»¥ä¸€ä¸ªç”¨ç©ºæ ¼åšé—´éš”çš„åˆ—è¡¨å­˜å‚¨ï¼Œæ”¾åœ¨å…ƒæ•°æ®çš„ <code>Labels</code> å­—æ®µä¸­ã€‚è¿™æ®µä»£ç æŸ¥æ‰¾åˆ—è¡¨ä¸­çš„ç¬¬ i ä¸ªå­—ç¬¦ä¸²ï¼š</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ç¡®å®šæ˜¯å¦æœ‰ä¸€ä¸ªæ ‡ç­¾</span></span><br><span class="line"><span class="keyword">bool</span> hasLabel = <span class="literal">false</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">const</span> <span class="keyword">char</span> *labels = Tuple-&gt;Labels) &#123;</span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">char</span> *space = <span class="built_in">strchr</span>(labels, <span class="string">' '</span>);</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">intptr_t</span> j = <span class="number">0</span>; j != i &amp;&amp; space; ++j) &#123;</span><br><span class="line">    labels = space + <span class="number">1</span>;</span><br><span class="line">    space = <span class="built_in">strchr</span>(labels, <span class="string">' '</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// If we have a label, create it.</span></span><br><span class="line">  <span class="keyword">if</span> (labels &amp;&amp; space &amp;&amp; labels != space) &#123;</span><br><span class="line">    *outName = strndup(labels, space - labels);</span><br><span class="line">    hasLabel = <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœåœ¨æ²¡æœ‰æ ‡ç­¾çš„æƒ…å†µä¸‹ï¼Œåˆ›å»ºä¸€ä¸ªåˆé€‚çš„æ•°å€¼æŒ‡ç¤ºå™¨ä½œä¸ºåå­—ï¼š</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (!hasLabel) &#123;</span><br><span class="line">  <span class="comment">// The name is the stringized element number '.0'.</span></span><br><span class="line">  <span class="keyword">char</span> *str;</span><br><span class="line">  asprintf(&amp;str, <span class="string">".%"</span> PRIdPTR, i);</span><br><span class="line">  *outName = str;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å› ä¸ºè¦å°† Swift å’Œ C++ äº¤å‰ä½¿ç”¨ï¼Œæ‰€ä»¥ä¸èƒ½äº«å—ä¸€äº›æ–¹ä¾¿çš„ç‰¹æ€§æ¯”å¦‚è‡ªåŠ¨å†…å­˜ç®¡ç†ã€‚Swift æœ‰ ARCï¼ŒC++ æœ‰ RALLï¼Œ ä½†æ˜¯è¿™ä¸¤ç§æŠ€æœ¯æ²¡åŠæ³•å…¼å®¹ã€‚<code>outFreeFunc</code> å…è®¸ C++ çš„ä»£ç æä¾›ä¸€ä¸ªå‡½æ•°ç»™è°ƒç”¨è€…ç”¨æ¥é‡Šæ”¾è¿”å›çš„åå­—ã€‚æ ‡ç­¾éœ€è¦ä½¿ç”¨ <code>free</code> è¿›è¡Œé‡Šæ”¾ï¼Œæ‰€ä»¥è®¾ç½®ç»™ <code>*outFreeFunc</code> ç›¸åº”çš„å€¼å¦‚ä¸‹ï¼š</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">*outFreeFunc = [](<span class="keyword">const</span> <span class="keyword">char</span> *str) &#123; <span class="built_in">free</span>(<span class="keyword">const_cast</span>&lt;<span class="keyword">char</span> *&gt;(str)); &#125;;</span><br></pre></td></tr></table></figure><p>å€¼å¾—æ³¨æ„çš„æ˜¯åå­—ï¼Œä½†ä»¤äººæƒŠè®¶çš„æ˜¯ï¼Œè¿™ä¸ªå€¼æ£€ç´¢èµ·æ¥å¾ˆç®€å•ã€‚<code>Tuple</code> å…ƒæ•°æ®åŒ…å«äº†ä¸€ä¸ªå¯ä»¥ç”¨ç´¢å¼•å»è·å–å…ƒç´ çš„ç›¸å…³ä¿¡æ¯çš„è¿”å›çš„å‡½æ•°ï¼š</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">auto</span> &amp;elt = Tuple-&gt;getElement(i);</span><br></pre></td></tr></table></figure><p><code>elt</code> åŒ…å«äº†ä¸€ä¸ªåç§»å€¼ï¼Œå¯ä»¥åº”ç”¨åœ¨å…ƒç»„å€¼ä¸Šï¼Œå»è·å¾—å…ƒç´ çš„å€¼æŒ‡é’ˆï¼š</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">auto</span> *bytes = <span class="keyword">reinterpret_cast</span>&lt;<span class="keyword">const</span> <span class="keyword">char</span> *&gt;(value);</span><br><span class="line"><span class="keyword">auto</span> *eltData = <span class="keyword">reinterpret_cast</span>&lt;<span class="keyword">const</span> OpaqueValue *&gt;(bytes + elt.Offset);</span><br></pre></td></tr></table></figure><p><code>elt</code> è¿˜åŒ…å«äº†å…ƒç´ çš„ç±»å‹ã€‚å¯ä»¥é€šè¿‡ç±»å‹å’Œå€¼çš„æŒ‡é’ˆï¼Œå»æ„é€ ä¸€ä¸ªåŒ…æ‹¬è¿™ä¸ªå€¼æ–°çš„ <code>Any</code> å¯¹è±¡ã€‚è¿™ä¸ªç±»å‹æœ‰å¯ä»¥åˆ†é…å†…å­˜å¹¶åˆå§‹åŒ–åŒ…å«ç»™å®šç±»å‹çš„å€¼çš„å‚¨å­˜å­—æ®µçš„å‡½æ•°æŒ‡é’ˆã€‚ç”¨è¿™äº›å‡½æ•°æ‹·è´å€¼ä¸º <code>Any</code> ç±»å‹çš„å¯¹è±¡ï¼Œç„¶åè¿”å› <code>Any</code> ç»™è°ƒç”¨è€…ã€‚ä»£ç æ˜¯è¿™æ ·çš„ï¼š</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">    Any result;</span><br><span class="line"></span><br><span class="line">    result.Type = elt.Type;</span><br><span class="line">    <span class="keyword">auto</span> *opaqueValueAddr = result.Type-&gt;allocateBoxForExistentialIn(&amp;result.Buffer);</span><br><span class="line">    result.Type-&gt;vw_initializeWithCopy(opaqueValueAddr,</span><br><span class="line">                                       <span class="keyword">const_cast</span>&lt;OpaqueValue *&gt;(eltData));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> AnyReturn(result);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>è¿™å°±æ˜¯å…ƒç»„çš„åšæ³•ã€‚</p><h2 id="swift-getFieldAt"><a href="#swift-getFieldAt" class="headerlink" title="swift_getFieldAt"></a>swift_getFieldAt</h2><p>åœ¨ç»“æ„ã€ç±»å’Œæšä¸¾ä¸­æŸ¥æ‰¾å…ƒç´ ç›®å‰æ¥è¯´ç›¸å½“å¤æ‚ã€‚é€ æˆè¿™ä¹ˆå¤æ‚çš„ä¸»è¦åŸå› æ˜¯ï¼Œè¿™äº›ç±»å‹å’ŒåŒ…å«è¿™äº›ç±»å‹ç›¸å…³ä¿¡æ¯çš„å­—æ®µçš„å­—æ®µæè¿°ç¬¦ä¹‹é—´ç¼ºå°‘ç›´æ¥çš„å¼•ç”¨å…³ç³»ã€‚æœ‰ä¸€ä¸ªå« <code>swift_getField</code> çš„å¸®åŠ©å‡½æ•°å¯ä»¥æŸ¥æ‰¾ç»™å®šç±»å‹ç›¸åº”çš„å­—æ®µæè¿°ç¬¦ã€‚ä¸€ä½†æˆ‘ä»¬æ·»åŠ äº†é‚£ä¸ªç›´æ¥çš„å¼•ç”¨ï¼Œè¿™æ•´ä¸ªå‡½æ•°åº”è¯¥å°±æ²¡å•¥ä½œç”¨äº†ï¼Œä½†åœ¨åŒä¸€æ—¶åˆ»ï¼Œå®ƒæä¾›äº†è¿è¡Œæ—¶ä»£ç æ€ä¹ˆèƒ½åšåˆ°ç”¨è¯­è¨€çš„å…ƒæ•°æ®å»æŸ¥æ‰¾ç±»å‹ä¿¡æ¯çš„ä¸€ä¸ªæœ‰è¶£æ€è·¯ã€‚</p><p>è¿™ä¸ªå‡½æ•°åŸå‹æ˜¯è¿™æ ·çš„ï¼š</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">void</span> swift::_swift_getFieldAt(</span><br><span class="line">    <span class="keyword">const</span> Metadata *base, <span class="keyword">unsigned</span> index,</span><br><span class="line">    <span class="built_in">std</span>::function&lt;<span class="keyword">void</span>(llvm::StringRef name, FieldType fieldInfo)&gt;</span><br><span class="line">        callback) &#123;</span><br></pre></td></tr></table></figure><p>å®ƒä¼šç”¨ç±»å‹å»æ£€æŸ¥ï¼Œç”¨å­—æ®µçš„ç´¢å¼•å»æŸ¥æ‰¾ï¼Œè¿˜æœ‰ä¸€ä¸ªä¼šè¢«åœ¨ä¿¡æ¯æ‰¾åˆ°æ—¶å›è°ƒã€‚</p><p>é¦–å…ˆå°±æ˜¯è·å–ç±»å‹çš„ç±»å‹ä¸Šä¸‹æ–‡æè¿°ï¼ŒåŒ…å«ç€æ›´è¿›ä¸€æ­¥å°†ä¼šè¢«ä½¿ç”¨çš„ç±»å‹çš„ä¿¡æ¯ï¼š</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">auto</span> *baseDesc = base-&gt;getTypeContextDescriptor();</span><br><span class="line"><span class="keyword">if</span> (!baseDesc)</span><br><span class="line">  <span class="keyword">return</span>;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªå·¥ä½œä¼šåˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†ã€‚ç¬¬ä¸€æ­¥æŸ¥æ‰¾ç±»å‹çš„å­—æ®µæè¿°ç¬¦ã€‚å­—æ®µæè¿°ç¬¦åŒ…æ‹¬æ‰€æœ‰æœ‰å…³è¿™ä¸ªç±»å‹çš„å­—æ®µä¿¡æ¯ã€‚ä¸€æ—¦å­—æ®µæè¿°ç¬¦å¯ç”¨ï¼Œè¿™ä¸ªå‡½æ•°å¯ä»¥ä»æè¿°ç¬¦ä¸­æŸ¥æ‰¾æ‰€éœ€è¦çš„ä¿¡æ¯ã€‚</p><p>ä»æè¿°ç¬¦ä¸­æŸ¥æ‰¾ä¿¡æ¯è¢«å°è£…æˆä¸€ä¸ªå« <code>getFieldAt</code> çš„å¸®åŠ©æ–¹æ³•ï¼Œ å¯ä»¥è®©å„ç§å„æ ·åœ°æ–¹çš„å…¶å®ƒä»£ç æŸ¥æ‰¾åˆ°åˆé€‚çš„å­—æ®µæè¿°ç¬¦ã€‚è®©æˆ‘ä»¬çœ‹ä¸‹è¿™ä¸ªæŸ¥è¯¢è¿‡ç¨‹ã€‚å®ƒä»è·å–ä¸€ä¸ªç”¨æ¥å°†ç¬¦å·è¿˜åŸå™¨å¼€å§‹ï¼Œå°†ç¬¦å·ä¿®é¥°è¿‡çš„ç±»åè¿˜åŸä¸ºå®é™…çš„ç±»å‹å¼•ç”¨ï¼š</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">auto</span> dem = getDemanglerForRuntimeTypeResolution();</span><br></pre></td></tr></table></figure><p>ä¼šç”¨ç¼“å­˜æ¥åŠ å¿«å¤šæ¬¡çš„æŸ¥æ‰¾ï¼š</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">auto</span> &amp;cache = FieldCache.get();</span><br></pre></td></tr></table></figure><p>å¦‚æœç¼“å­˜ä¸­å·²ç»æœ‰å­—æ®µæè¿°ç¬¦ï¼Œè°ƒç”¨ <code>getFieldAt</code> æ¥è·å¾—ï¼š</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="keyword">auto</span> Value = cache.FieldCache.find(base)) &#123;</span><br><span class="line">  getFieldAt(*Value-&gt;getDescription());</span><br><span class="line">  <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸ºäº†è®©æŸ¥æ‰¾çš„ä»£ç æ›´ç®€å•ï¼Œæœ‰ä¸€ä¸ªå¯ä»¥æ£€æŸ¥ <code>FieldDescriptor</code> æ˜¯å¦æ˜¯è¢«æŸ¥æ‰¾çš„é‚£ä¸€ä¸ªçš„å¸®åŠ©æ–¹æ³•ã€‚å¦‚æœæè¿°ç¬¦åŒ¹é…ï¼Œé‚£ä¹ˆæè¿°ç¬¦æ”¾å…¥ç¼“å­˜ä¸­ï¼Œè°ƒç”¨ <code>getFieldAt</code> ï¼Œç„¶åè¿”å›æˆåŠŸç»™è°ƒç”¨è€…ã€‚åŒ¹é…çš„è¿‡ç¨‹æ˜¯å¤æ‚çš„ï¼Œä¸è¿‡æœ¬è´¨ä¸Šå½’çº³èµ·æ¥å°±æ˜¯å»åŒ¹é…ç¬¦å·ä¿®é¥°çš„åå­—ï¼š</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">auto</span> isRequestedDescriptor = [&amp;](<span class="keyword">const</span> FieldDescriptor &amp;descriptor) &#123;</span><br><span class="line">  assert(descriptor.hasMangledTypeName());</span><br><span class="line">  <span class="keyword">auto</span> mangledName = descriptor.getMangledTypeName(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!_contextDescriptorMatchesMangling(baseDesc,</span><br><span class="line">                                         dem.demangleType(mangledName)))</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">  cache.FieldCache.getOrInsert(base, &amp;descriptor);</span><br><span class="line">  getFieldAt(descriptor);</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>å­—æ®µæè¿°ç¬¦å¯ç”¨åœ¨è¿è¡Œæ—¶æ³¨å†Œæˆ–åœ¨ç¼–è¯‘æ—¶æ”¾è¿›äºŒè¿›åˆ¶ã€‚è¿™ä¸¤ä¸ªå¾ªç¯æŸ¥æ‰¾åœ¨åŒ¹é…ä¸­æ‰€æœ‰å·²çŸ¥çš„çš„å­—æ®µæè¿°ç¬¦ï¼š</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">auto</span> &amp;section : cache.DynamicSections.snapshot()) &#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> *descriptor : section) &#123;</span><br><span class="line">    <span class="keyword">if</span> (isRequestedDescriptor(*descriptor))</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;section : cache.StaticSections.snapshot()) &#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">auto</span> &amp;descriptor : section) &#123;</span><br><span class="line">    <span class="keyword">if</span> (isRequestedDescriptor(descriptor))</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“å‘ç°æ²¡æœ‰åŒ¹é…æ—¶ï¼Œè®°å½•ä¸€ä¸ªè­¦å‘Šä¿¡æ¯å¹¶ä¸”åœ¨å›è°ƒè¿”å›ä¸€ä¸ªç©ºå…ƒç»„ï¼ˆä»…ä»…ä¸ºäº†ç»™ä¸€ä¸ªå›è°ƒï¼‰ï¼š</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">  <span class="keyword">auto</span> typeName = swift_getTypeName(base, <span class="comment">/*qualified*/</span> <span class="literal">true</span>);</span><br><span class="line">  warning(<span class="number">0</span>, <span class="string">"SWIFT RUNTIME BUG: unable to find field metadata for type '%*s'\n"</span>,</span><br><span class="line">             (<span class="keyword">int</span>)typeName.length, typeName.data);</span><br><span class="line">  callback(<span class="string">"unknown"</span>,</span><br><span class="line">           FieldType()</span><br><span class="line">             .withType(TypeInfo(&amp;METADATA_SYM(EMPTY_TUPLE_MANGLING), &#123;&#125;))</span><br><span class="line">             .withIndirect(<span class="literal">false</span>)</span><br><span class="line">             .withWeak(<span class="literal">false</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å€¼å¾—æ³¨æ„çš„æ˜¯å­—æ®µæè¿°ç¬¦çš„æŸ¥æ‰¾è¿‡ç¨‹ã€‚<code>getFieldAt</code> å¸®åŠ©æ–¹æ³•å°†å­—æ®µæè¿°ç¬¦è½¬åŒ–ä¸ºåå­—å’Œå›è°ƒä¸­è¿”å›çš„å­—æ®µç±»å‹ã€‚å¼€å§‹å®ƒä¼šä»å­—æ®µæè¿°ç¬¦ä¸­è¯·æ±‚å­—æ®µçš„å¼•ç”¨ï¼š</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">auto</span> getFieldAt = [&amp;](<span class="keyword">const</span> FieldDescriptor &amp;descriptor) &#123;</span><br><span class="line">  <span class="keyword">auto</span> &amp;field = descriptor.getFields()[index];</span><br></pre></td></tr></table></figure><p>åå­—å¯ä»¥ç›´æ¥è·å¾—åœ¨è¿™ä¸ªå¼•ç”¨ä¸­è®¿é—®åˆ°ï¼š</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">auto</span> name = field.getFieldName(<span class="number">0</span>);</span><br></pre></td></tr></table></figure><p>å¦‚æœè¿™ä¸ªå­—æ®µå®é™…ä¸Šæ˜¯ä¸€ä¸ªæšä¸¾ï¼Œé‚£ä¹ˆå°±å¯èƒ½æ²¡æœ‰ç±»å‹ã€‚å…ˆåšè¿™ç§æ£€æŸ¥ï¼Œå¹¶æ‰§è¡Œå›è°ƒï¼š</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (!field.hasMangledTypeName()) &#123;</span><br><span class="line">  callback(name, FieldType().withIndirect(field.isIndirectCase()));</span><br><span class="line">  <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å­—æ®µçš„å¼•ç”¨å°†å­—æ®µç±»å‹å‚¨å­˜ä¸ºä¸€ä¸ªç¬¦å·ä¿®é¥°çš„åå­—ã€‚å› ä¸ºå›è°ƒé¢„æœŸçš„æ˜¯å…ƒæ•°æ®çš„æŒ‡é’ˆï¼Œæ‰€ä»¥ç¬¦å·ä¿®é¥°çš„åå­—å¿…é¡»è¢«è½¬åŒ–ä¸ºä¸€ä¸ªçœŸå®çš„ç±»å‹ã€‚<code>_getTypeByMangledName</code> å‡½æ•°å¤„ç†äº†å¤§éƒ¨åˆ†å·¥ä½œï¼Œä¸è¿‡éœ€è¦è°ƒç”¨è€…è§£å†³è¿™ä¸ªç±»å‹ç”¨çš„æ‰€æœ‰èŒƒå‹å‚æ•°ã€‚è¿™ä¸ªå·¥ä½œéœ€è¦å°†è¿™ä¸ªç±»å‹çš„æ‰€æœ‰èŒƒå‹çš„ä¸Šä¸‹æ–‡æŠ½ç¦»å‡ºæ¥ï¼š</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">const</span> ContextDescriptor *&gt; descriptorPath;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">auto</span> *parent = <span class="keyword">reinterpret_cast</span>&lt;</span><br><span class="line">                          <span class="keyword">const</span> ContextDescriptor *&gt;(baseDesc);</span><br><span class="line">  <span class="keyword">while</span> (parent) &#123;</span><br><span class="line">    <span class="keyword">if</span> (parent-&gt;isGeneric())</span><br><span class="line">      descriptorPath.push_back(parent);</span><br><span class="line"></span><br><span class="line">    parent = parent-&gt;Parent.get();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç°åœ¨è·å¾—äº†ç¬¦å·ä¿®é¥°çš„åå­—å’Œç±»å‹ï¼Œå°†å®ƒä»¬ä¼ å…¥ä¸€ä¸ª Lambda è¡¨è¾¾å¼æ¥è§£å†³èŒƒå‹å‚æ•°ï¼š</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">auto</span> typeName = field.getMangledTypeName(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">auto</span> typeInfo = _getTypeByMangledName(</span><br><span class="line">    typeName,</span><br><span class="line">    [&amp;](<span class="keyword">unsigned</span> depth, <span class="keyword">unsigned</span> index) -&gt; <span class="keyword">const</span> Metadata * &#123;</span><br></pre></td></tr></table></figure><p>å¦‚æœè¯·æ±‚çš„æ·±åº¦æ¯”æè¿°ç¬¦çš„è·¯å¾„å¤§å°è¿˜å¤§ï¼Œé‚£ä¹ˆå°±ä¼šå¤±è´¥ï¼š</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (depth &gt;= descriptorPath.size())</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">nullptr</span>;</span><br></pre></td></tr></table></figure><p>é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰ä»å­—æ®µçš„ç±»å‹ä¸­è·å–èŒƒå‹å‚æ•°ã€‚è¿™éœ€è¦å°†ç´¢å¼•å’Œæ·±åº¦è½¬åŒ–ä¸ºå•ç‹¬çš„æ‰å¹³åŒ–çš„ç´¢å¼•ï¼Œé€šè¿‡éå†æè¿°ç¬¦çš„è·¯å¾„ï¼Œåœ¨æ¯ä¸ªé˜¶æ®µæ·»åŠ èŒƒå‹å‚æ•°çš„æ•°é‡ç›´åˆ°è¾¾åˆ°æ·±åº¦ä¸ºæ­¢ï¼š</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">unsigned</span> currentDepth = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">unsigned</span> flatIndex = index;</span><br><span class="line"><span class="keyword">const</span> ContextDescriptor *currentContext = descriptorPath.back();</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> *context : llvm::reverse(descriptorPath)) &#123;</span><br><span class="line">  <span class="keyword">if</span> (currentDepth &gt;= depth)</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">  flatIndex += context-&gt;getNumGenericParams();</span><br><span class="line">  currentContext = context;</span><br><span class="line">  ++currentDepth;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœç´¢å¼•æ¯”èŒƒå‹å‚æ•°å¯è¾¾åˆ°çš„æ·±åº¦å¤§ï¼Œé‚£ä¹ˆå¤±è´¥ï¼š</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (index &gt;= currentContext-&gt;getNumGenericParams())</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">nullptr</span>;</span><br></pre></td></tr></table></figure><p>é™¤æ­¤ä¹‹å¤–ï¼Œä»åŸºæœ¬ç±»å‹ä¸­è·å¾—åˆé€‚çš„èŒƒå‹å‚æ•°ï¼š</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">  <span class="keyword">return</span> base-&gt;getGenericArgs()[flatIndex];</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>åƒä¹‹å‰é‚£æ ·ï¼Œå¦‚æœä¸èƒ½æ‰¾åˆ°ç±»å‹ï¼Œå°±ç”¨ç©ºå…ƒç»„ï¼š</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (typeInfo == <span class="literal">nullptr</span>) &#123;</span><br><span class="line">  typeInfo = TypeInfo(&amp;METADATA_SYM(EMPTY_TUPLE_MANGLING), &#123;&#125;);</span><br><span class="line">  warning(<span class="number">0</span>, <span class="string">"SWIFT RUNTIME BUG: unable to demangle type of field '%*s'. "</span></span><br><span class="line">             <span class="string">"mangled type name is '%*s'\n"</span>,</span><br><span class="line">             (<span class="keyword">int</span>)name.size(), name.data(),</span><br><span class="line">             (<span class="keyword">int</span>)typeName.size(), typeName.data());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åæ‰§è¡Œå›è°ƒï¼Œæ— è®ºæ‰¾åˆ°äº†ä»€ä¹ˆï¼š</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">  callback(name, FieldType()</span><br><span class="line">                     .withType(typeInfo)</span><br><span class="line">                     .withIndirect(field.isIndirectCase())</span><br><span class="line">                     .withWeak(typeInfo.isWeak()));</span><br><span class="line"></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>è¿™å°±æ˜¯ <code>swift_getFieldAt</code>ã€‚æˆ‘ä»¬å¸¦ç€è¿™ä¸ªå¸®åŠ©æ–¹æ³•çœ‹çœ‹å…¶ä»–åå°„çš„å®ç°ã€‚</p><h2 id="ç»“æ„ä½“çš„åå°„"><a href="#ç»“æ„ä½“çš„åå°„" class="headerlink" title="ç»“æ„ä½“çš„åå°„"></a>ç»“æ„ä½“çš„åå°„</h2><p>ç»“æ„ä½“çš„å®ç°ä¹Ÿæ˜¯ç±»ä¼¼çš„ï¼Œä½†ç¨å¾®æœ‰ç‚¹å¤æ‚ã€‚è¿™æ˜¯å› ä¸ºæœ‰äº›ç»“æ„ä½“ç±»å‹ä¸å®Œå…¨æ”¯æŒåå°„ï¼ŒæŸ¥æ‰¾åå­—å’Œåç§»å€¼è¦èŠ±è´¹æ›´å¤šåŠ›æ°”ï¼Œè€Œä¸”ç»“æ„ä½“å¯èƒ½åŒ…å«éœ€è¦åå°„ä»£ç å»æå–çš„å¼±å¼•ç”¨ã€‚</p><p>é¦–å…ˆæ˜¯ä¸€ä¸ªå¸®åŠ©æ–¹æ³•å»æ£€æŸ¥ç»“æ„ä½“æ˜¯å¦å®Œå…¨æ”¯æŒåå°„ã€‚ç»“æ„ä½“å…ƒæ•°æ®é‡Œå‚¨å­˜è¿™æ ·ä¸€ä¸ªå¯è¢«è®¿é—®çš„æ ‡å¿—ä½ã€‚è·Ÿä¸Šé¢å…ƒç»„çš„ä»£ç ç±»ä¼¼ï¼Œå¯ä»¥çŸ¥é“ <code>type</code> å®é™…ä¸Šæ˜¯ä¸€ä¸ª <code>StructMetadata</code> æŒ‡é’ˆï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥è‡ªç”±çš„ä¼ å…¥ï¼š</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">StructImpl</span> :</span> ReflectionMirrorImpl &#123;</span><br><span class="line">  <span class="function"><span class="keyword">bool</span> <span class="title">isReflectable</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">auto</span> *Struct = <span class="keyword">static_cast</span>&lt;<span class="keyword">const</span> StructMetadata *&gt;(type);</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">auto</span> &amp;Description = Struct-&gt;getDescription();</span><br><span class="line">    <span class="keyword">return</span> Description-&gt;getTypeContextDescriptorFlags().isReflectable();</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>ç»“æ„ä½“çš„æ˜¾ç¤ºæ ·å¼æ˜¯ s :</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">char</span> <span class="title">displayStyle</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">'s'</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å­å…ƒç´ çš„æ•°é‡æ˜¯å…ƒæ•°æ®ç»™å‡ºçš„å­—æ®µçš„æ•°é‡ï¼Œä¹Ÿå¯èƒ½æ˜¯ 0ï¼ˆå¦‚æœè¿™ä¸ªç±»å‹å®é™…ä¸Šä¸èƒ½æ”¯æŒåå°„çš„è¯ï¼‰ï¼š</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">intptr_t</span> count() &#123;</span><br><span class="line">  <span class="keyword">if</span> (!isReflectable()) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">auto</span> *Struct = <span class="keyword">static_cast</span>&lt;<span class="keyword">const</span> StructMetadata *&gt;(type);</span><br><span class="line">  <span class="keyword">return</span> Struct-&gt;getDescription()-&gt;NumFields;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åƒä¹‹å‰é‚£æ ·ï¼Œ<code>subscript</code> æ–¹æ³•æ˜¯æ¯”è¾ƒå¤æ‚çš„éƒ¨åˆ†ã€‚å®ƒå¼€å§‹ä¹Ÿæ˜¯ç±»ä¼¼çš„ï¼Œåšè¾¹ç•Œæ£€æŸ¥å’ŒæŸ¥æ‰¾åç§»å€¼ï¼š</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function">AnyReturn <span class="title">subscript</span><span class="params">(<span class="keyword">intptr_t</span> i, <span class="keyword">const</span> <span class="keyword">char</span> **outName,</span></span></span><br><span class="line">                    void (**outFreeFunc)(const char *)) &#123;</span><br><span class="line">  <span class="keyword">auto</span> *Struct = <span class="keyword">static_cast</span>&lt;<span class="keyword">const</span> StructMetadata *&gt;(type);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (i &lt; <span class="number">0</span> || (<span class="keyword">size_t</span>)i &gt; Struct-&gt;getDescription()-&gt;NumFields)</span><br><span class="line">    swift::crash(<span class="string">"Swift mirror subscript bounds check failure"</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Load the offset from its respective vector.</span></span><br><span class="line">  <span class="keyword">auto</span> fieldOffset = Struct-&gt;getFieldOffsets()[i];</span><br></pre></td></tr></table></figure><p>ä»ç»“æ„ä½“å­—æ®µä¸­è·å–ç±»å‹ä¿¡æ¯ä¼šæ›´å¤æ‚ä¸€ç‚¹ã€‚è¿™é¡¹å·¥ä½œé€šè¿‡ <code>_swift_getFieldAt</code> å¸®åŠ©æ–¹æ³•è¿›è¡Œï¼š</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">Any result;</span><br><span class="line"></span><br><span class="line">_swift_getFieldAt(type, i, [&amp;](llvm::StringRef name, FieldType fieldInfo) &#123;</span><br></pre></td></tr></table></figure><p>ä¸€ä½†å®ƒæœ‰å­—æ®µä¿¡æ¯ï¼Œä¸€åˆ‡å°±ä¼šè¿›è¡Œå¾—å’Œå…ƒç»„å¯¹åº”éƒ¨åˆ†çš„ä»£ç ç±»ä¼¼ã€‚å¡«å†™åå­—å’Œè®¡ç®—å­—æ®µå‚¨å­˜çš„æŒ‡é’ˆï¼š</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">*outName = name.data();</span><br><span class="line">*outFreeFunc = <span class="literal">nullptr</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">auto</span> *bytes = <span class="keyword">reinterpret_cast</span>&lt;<span class="keyword">char</span>*&gt;(value);</span><br><span class="line"><span class="keyword">auto</span> *fieldData = <span class="keyword">reinterpret_cast</span>&lt;OpaqueValue *&gt;(bytes + fieldOffset);</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæœ‰ä¸€ä¸ªé¢å¤–çš„æ­¥éª¤å»æ‹·è´å­—æ®µçš„å€¼åˆ° <code>Any</code> ç±»å‹çš„è¿”å›å€¼æ¥å¤„ç†å¼±å¼•ç”¨ã€‚<code>loadSpecialReferenceStorage</code> æ–¹æ³•å¤„ç†è¿™ç§æƒ…å†µã€‚å¦‚æœå€¼æ²¡æœ‰è¢«è½½å…¥çš„è¯é‚£ä¹ˆé‚£ä¸ªå€¼ç”¨æ™®é€šçš„å‚¨å­˜ï¼Œå¹¶ä¸”ä»¥æ™®é€šçš„æ–¹å¼æ‹·è´åˆ°è¿”å›å€¼ï¼š</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">      <span class="keyword">bool</span> didLoad = loadSpecialReferenceStorage(fieldData, fieldInfo, &amp;result);</span><br><span class="line">      <span class="keyword">if</span> (!didLoad) &#123;</span><br><span class="line">        result.Type = fieldInfo.getType();</span><br><span class="line">        <span class="keyword">auto</span> *opaqueValueAddr = result.Type-&gt;allocateBoxForExistentialIn(&amp;result.Buffer);</span><br><span class="line">        result.Type-&gt;vw_initializeWithCopy(opaqueValueAddr,</span><br><span class="line">                                           <span class="keyword">const_cast</span>&lt;OpaqueValue *&gt;(fieldData));</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> AnyReturn(result);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>è¿™äº›å°±æ˜¯ç»“æ„ä½“å€¼å¾—æ³¨æ„çš„äº†ã€‚</p><h2 id="ç±»çš„åå°„"><a href="#ç±»çš„åå°„" class="headerlink" title="ç±»çš„åå°„"></a>ç±»çš„åå°„</h2><p>ç±»å’Œç»“æ„ä½“å¾ˆç±»ä¼¼ï¼Œåœ¨ <code>ClassImpl</code> é‡Œçš„ä»£ç å‡ ä¹æ˜¯ç›¸åŒçš„ã€‚åœ¨æ“ä½œ Objective-C ä¸Šæœ‰ä¸¤ç‚¹å€¼å¾—æ³¨æ„çš„ä¸åŒä¹‹å¤„ã€‚ä¸€ä¸ªæ˜¯ <code>quickLookObject</code> çš„å®ç°ï¼Œä¼šè°ƒèµ· Objective-C çš„  <code>debugQuickLookObject</code>  æ–¹æ³•çš„ï¼š</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">if</span> SWIFT_OBJC_INTEROP</span></span><br><span class="line"><span class="function">id <span class="title">quickLookObject</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  id object = [*<span class="keyword">reinterpret_cast</span>&lt;<span class="keyword">const</span> id *&gt;(value) retain];</span><br><span class="line">  <span class="keyword">if</span> ([object respondsToSelector:@selector(debugQuickLookObject)]) &#123;</span><br><span class="line">    id quickLookObject = [object debugQuickLookObject];</span><br><span class="line">    [quickLookObject retain];</span><br><span class="line">    [object release];</span><br><span class="line">    <span class="keyword">return</span> quickLookObject;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> object;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br></pre></td></tr></table></figure><p>å¦ä¸€ä¸ªæ˜¯å¦‚æœè¯¥ç±»çš„çˆ¶ç±»æ˜¯ Objective-C çš„ç±»ï¼Œå­—æ®µçš„åç§»å€¼éœ€è¦åœ¨ Objective-C è¿è¡Œæ—¶è·å¾—ï¼š</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">  <span class="keyword">uintptr_t</span> fieldOffset;</span><br><span class="line">  <span class="keyword">if</span> (usesNativeSwiftReferenceCounting(Clas)) &#123;</span><br><span class="line">    fieldOffset = Clas-&gt;getFieldOffsets()[i];</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">#<span class="keyword">if</span> SWIFT_OBJC_INTEROP</span><br><span class="line">    Ivar *ivars = class_copyIvarList((Class)Clas, <span class="literal">nullptr</span>);</span><br><span class="line">    fieldOffset = ivar_getOffset(ivars[i]);</span><br><span class="line">    <span class="built_in">free</span>(ivars);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">else</span></span></span><br><span class="line">    swift::crash(<span class="string">"Object appears to be Objective-C, but no runtime."</span>);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><h2 id="æšä¸¾çš„åå°„"><a href="#æšä¸¾çš„åå°„" class="headerlink" title="æšä¸¾çš„åå°„"></a>æšä¸¾çš„åå°„</h2><p>æšä¸¾æœ‰ä¸€äº›ä¸åŒä¹‹å¤„ã€‚<code>Mirror</code> ä¼šè€ƒè™‘ä¸€ä¸ªæšä¸¾å®ä¾‹æœ€å¤šåªåŒ…å«ä¸€ä¸ªå…ƒç´ ï¼Œæšä¸¾ case åå­—ä½œä¸ºæ ‡ç­¾ï¼Œå®ƒçš„å…³è”å€¼ä½œä¸ºå€¼ã€‚æ²¡æœ‰å…³è”å€¼çš„ case æ²¡æœ‰åŒ…å«çš„å…ƒç´ ã€‚ ä¸¾ä¸ªä¾‹å­ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">Foo</span> </span>&#123;</span><br><span class="line">  <span class="keyword">case</span> bar</span><br><span class="line">  <span class="keyword">case</span> baz(<span class="type">Int</span>)</span><br><span class="line">  <span class="keyword">case</span> quux(<span class="type">String</span>, <span class="type">String</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“ <code>Foo</code> ç±»å‹çš„å€¼ä½¿ç”¨ mirror æ—¶ï¼Œmirror ä¼šæ˜¾ç¤º <code>Foo.bar</code> æ²¡æœ‰å­å…ƒç´ ï¼Œ<code>Foo.baz</code> æœ‰ä¸€ä¸ª <code>Int</code> ç±»å‹çš„å…ƒç´ ï¼Œ<code>Foo.quux</code> æœ‰ä¸€ä¸ª <code>(String, String)</code> ç±»å‹çš„å…ƒç´ ã€‚ç›¸åŒçš„å­æ ‡ç­¾å’Œç±»å‹çš„ç±»å’Œç»“æ„ä½“çš„å€¼æœ‰ç€ç›¸åŒå­—æ®µï¼Œä½†åŒä¸€ä¸ªç±»å‹çš„ä¸åŒçš„æšä¸¾ case ä¸æ˜¯è¿™æ ·çš„ã€‚å…³è”çš„å€¼ä¹Ÿå¯èƒ½æ˜¯é—´æ¥çš„ï¼Œæ‰€ä»¥éœ€è¦ä¸€äº›ç‰¹æ®Šå¤„ç†ã€‚</p><p><code>enum</code> çš„åå°„éœ€è¦å››éƒ¨åˆ†æ ¸å¿ƒçš„ä¿¡æ¯ï¼šcase çš„åå­—ï¼Œtagï¼ˆè¡¨ç¤ºè¯¥å€¼å‚¨å­˜çš„æšä¸¾ case çš„æ•°å­—ï¼‰ï¼Œpayload çš„ç±»å‹ï¼Œæ˜¯å¦æ˜¯é—´æ¥çš„ payloadã€‚<code>getInfo</code> æ–¹æ³•è·å–è¿™äº›å€¼ï¼š</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">const</span> <span class="keyword">char</span> *<span class="title">getInfo</span><span class="params">(<span class="keyword">unsigned</span> *tagPtr = <span class="literal">nullptr</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">                    <span class="keyword">const</span> Metadata **payloadTypePtr = <span class="literal">nullptr</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">                    <span class="keyword">bool</span> *indirectPtr = <span class="literal">nullptr</span>)</span> </span>&#123;</span><br></pre></td></tr></table></figure><p>tag ä»è¯·æ±‚å…ƒæ•°æ®ç›´æ¥æ£€ç´¢è€Œæ¥ï¼š</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">unsigned</span> tag = type-&gt;vw_getEnumTag(value);</span><br></pre></td></tr></table></figure><p>å…¶å®ƒä¿¡æ¯ç”¨ <code>_swift_getFieldAt</code> æ£€ç´¢è€Œæ¥ã€‚å°† tag ä½œä¸ºå­—æ®µç´¢å¼•æ¥è°ƒç”¨ï¼Œå°±ä¼šæä¾›åˆé€‚çš„ä¿¡æ¯ï¼š</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> Metadata *payloadType = <span class="literal">nullptr</span>;</span><br><span class="line"><span class="keyword">bool</span> indirect = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">char</span> *caseName = <span class="literal">nullptr</span>;</span><br><span class="line">_swift_getFieldAt(type, tag, [&amp;](llvm::StringRef name, FieldType info) &#123;</span><br><span class="line">  caseName = name.data();</span><br><span class="line">  payloadType = info.getType();</span><br><span class="line">  indirect = info.isIndirect();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>æ‰€æœ‰çš„å€¼ä¼šè¿”å›ç»™è°ƒç”¨è€…ï¼š</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">  <span class="keyword">if</span> (tagPtr)</span><br><span class="line">    *tagPtr = tag;</span><br><span class="line">  <span class="keyword">if</span> (payloadTypePtr)</span><br><span class="line">    *payloadTypePtr = payloadType;</span><br><span class="line">  <span class="keyword">if</span> (indirectPtr)</span><br><span class="line">    *indirectPtr = indirect;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> caseName;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ï¼ˆä½ å¯èƒ½ä¼šå¥½å¥‡ï¼šä¸ºä»€ä¹ˆåªæœ‰ case çš„åå­—æ˜¯ç›´æ¥è¿”å›çš„ï¼Œè€Œå…¶å®ƒçš„ä¸‰ä¸ªä¿¡æ¯ç”¨æŒ‡é’ˆè¿”å›ï¼Ÿä¸ºä»€ä¹ˆä¸è¿”å› tag æˆ–è€… payload çš„ç±»å‹ï¼Ÿç­”æ¡ˆæ˜¯ï¼šæˆ‘çœŸçš„ä¸çŸ¥é“ï¼Œå¯èƒ½åœ¨é‚£ä¸ªæ—¶æœºçœ‹èµ·æ¥æ˜¯ä¸ªå¥½ä¸»æ„ï¼‰</p><p><code>count</code> æ–¹æ³•å¯ä»¥ç”¨ <code>getInfo</code> æ–¹æ³•å»æ£€ç´¢ payload çš„ç±»å‹ï¼Œå¹¶è¿”å› 0 æˆ– 1 è¡¨ç¤º payload ç±»å‹æ˜¯å¦ä¸º nullï¼š</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">intptr_t</span> count() &#123;</span><br><span class="line">  <span class="keyword">if</span> (!isReflectable()) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> Metadata *payloadType;</span><br><span class="line">  getInfo(<span class="literal">nullptr</span>, &amp;payloadType, <span class="literal">nullptr</span>);</span><br><span class="line">  <span class="keyword">return</span> (payloadType != <span class="literal">nullptr</span>) ? <span class="number">1</span> : <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>subscript</code>æ–¹æ³•å¼€å§‹ä¼šè·å–æ‰€æœ‰æœ‰å…³è¿™ä¸ªå€¼çš„ä¿¡æ¯ï¼š</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function">AnyReturn <span class="title">subscript</span><span class="params">(<span class="keyword">intptr_t</span> i, <span class="keyword">const</span> <span class="keyword">char</span> **outName,</span></span></span><br><span class="line">                    void (**outFreeFunc)(const char *)) &#123;</span><br><span class="line">  <span class="keyword">unsigned</span> tag;</span><br><span class="line">  <span class="keyword">const</span> Metadata *payloadType;</span><br><span class="line">  <span class="keyword">bool</span> indirect;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">auto</span> *caseName = getInfo(&amp;tag, &amp;payloadType, &amp;indirect);</span><br></pre></td></tr></table></figure><p>å®é™…çš„å¤åˆ¶å€¼éœ€è¦æ›´å¤šçš„å·¥ä½œã€‚ä¸ºäº†å¤„ç†é—´æ¥çš„å€¼ï¼Œæ•´ä¸ªè¿‡ç¨‹åœ¨ä¸€ä¸ªé¢å¤–çš„ box ä¸­è¿›è¡Œï¼š</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> Metadata *boxType = (indirect ? &amp;METADATA_SYM(Bo).base : payloadType);</span><br><span class="line">BoxPair pair = swift_allocBox(boxType);</span><br></pre></td></tr></table></figure><p>é—´æ¥çš„æƒ…å†µä¸‹ï¼ŒçœŸå®å€¼è¦åœ¨ box ä¸­å–å‡ºï¼š</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (indirect) &#123;</span><br><span class="line">  <span class="keyword">const</span> HeapObject *owner = *<span class="keyword">reinterpret_cast</span>&lt;HeapObject * <span class="keyword">const</span> *&gt;(value);</span><br><span class="line">  value = swift_projectBox(<span class="keyword">const_cast</span>&lt;HeapObject *&gt;(owner));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç°åœ¨ä¸€åˆ‡éƒ½å‡†å¤‡å¥½äº†ã€‚ç»™ case åå­—è®¾ç½®å­æ ‡ç­¾ï¼š</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">*outName = caseName;</span><br><span class="line">*outFreeFunc = <span class="literal">nullptr</span>;</span><br></pre></td></tr></table></figure><p>ä¼¼æ›¾ç›¸è¯†çš„æ–¹å¼è¢«ç”¨åœ¨å°† payload è¿”å›ä¸º <code>Any</code> ç±»å‹çš„å¯¹è±¡ï¼š</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">  Any result;</span><br><span class="line"></span><br><span class="line">  result.Type = payloadType;</span><br><span class="line">  <span class="keyword">auto</span> *opaqueValueAddr = result.Type-&gt;allocateBoxForExistentialIn(&amp;result.Buffer);</span><br><span class="line">  result.Type-&gt;vw_initializeWithCopy(opaqueValueAddr,</span><br><span class="line">                                     <span class="keyword">const_cast</span>&lt;OpaqueValue *&gt;(value));</span><br><span class="line"></span><br><span class="line">  swift_release(pair.object);</span><br><span class="line">  <span class="keyword">return</span> AnyReturn(result);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å…¶ä½™ç§ç±»"><a href="#å…¶ä½™ç§ç±»" class="headerlink" title="å…¶ä½™ç§ç±»"></a>å…¶ä½™ç§ç±»</h2><p>æ–‡ä»¶ä¸­è¿˜æœ‰ä¸‰ç§å…¶ä»–çš„å®ç°ï¼Œæ¯ç§å‡ ä¹éƒ½æ²¡åšä»€ä¹ˆäº‹æƒ…ã€‚<code>ObjCClassImpl</code> å¤„ç† Objective-C çš„ç±»ã€‚å®ƒç”šè‡³ä¸å»å°è¯•è¿”å›ä»»ä½•å­å…ƒç´ ï¼Œå› ä¸º Objective-C åœ¨ ivars çš„å†…å®¹ä¸Šå…è®¸å¤ªå¤šç§è¡¥æ•‘æ–¹æ¡ˆäº†ã€‚Objective-C çš„ç±»å…è®¸ä¿æŒé‡æŒ‡é’ˆä¸€ç›´å­˜åœ¨ï¼Œå¹¶éœ€è¦å•ç‹¬çš„é€»è¾‘è®©å®ç°ä¸è¦å»ç¢°é‚£ä¸ªå€¼ã€‚å› ä¸ºè¿™æ ·çš„å€¼å°è¯•ä½œä¸º <code>Mirror</code> å­å…ƒç´ è¿”å›ï¼Œä¼šè¿å Swift çš„å®‰å…¨æ€§ä¿è¯ã€‚å› ä¸ºæ²¡æœ‰åŠæ³•å¯é åœ°å»å‘ŠçŸ¥åº”è¯¥å¦‚ä½•å¤„ç†å¦‚æœå€¼å‡ºäº†é—®é¢˜ï¼Œæ‰€ä»¥ä»£ç é¿å¼€å¤„ç†æ•´ä¸ªè¿™ç§æƒ…å†µã€‚</p><p><code>MetatypeImpl</code> å¤„ç†å…ƒç±»å‹ã€‚å¦‚æœå°† <code>Mirror</code> ç”¨åœ¨å®é™…çš„ç±»å‹ï¼Œæ¯”å¦‚è¿™æ ·ç”¨ <code>Mirror(reflecting:String.self)</code>ï¼Œè¿™æ—¶å°±ä¼šç”¨åˆ°å®ƒã€‚ç¬¬ä¸€ååº”æ˜¯ï¼Œå®ƒä¼šåœ¨è¿™æ—¶æä¾›ä¸€äº›æœ‰ç”¨çš„ä¿¡æ¯ã€‚ä½†å®é™…ä¸Šå®ƒä»…ä»…è¿”å›ç©ºï¼Œç”šè‡³æ²¡æœ‰å»å°è¯•è·å–ä»»ä½•ä¸œè¥¿ã€‚åŒæ ·çš„ï¼Œ<code>OpaqueImpl</code> å¤„ç†ä¸é€æ˜çš„ç±»å‹å¹¶è¿”å›ç©ºã€‚</p><h2 id="Swift-ä¾§æ¥å£"><a href="#Swift-ä¾§æ¥å£" class="headerlink" title="Swift ä¾§æ¥å£"></a>Swift ä¾§æ¥å£</h2><p>åœ¨ Swift ä¾§ï¼Œ<code>Mirror</code> è°ƒç”¨åœ¨ C++ ä¾§å®ç°çš„æ¥å£å‡½æ•°ï¼Œå»æ£€ç´¢éœ€è¦çš„ä¿¡æ¯ï¼Œç„¶åä»¥æ›´å‹å¥½çš„æ–¹å¼å»å±•ç°ã€‚è¿™äº›ä¼šåœ¨ <code>Mirror</code> çš„åˆå§‹åŒ–å™¨ä¸­å®Œæˆï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">internal</span> <span class="keyword">init</span>(internalReflecting subject: <span class="type">Any</span>,</span><br><span class="line">            subjectType: <span class="type">Any</span>.<span class="type">Type</span>? = <span class="literal">nil</span>,</span><br><span class="line">            customAncestor: <span class="type">Mirror</span>? = <span class="literal">nil</span>)</span><br><span class="line">&#123;</span><br></pre></td></tr></table></figure><p><code>subjectType</code> æ˜¯å°†è¦è¢«åå°„ <code>subject</code> çš„å€¼çš„ç±»å‹ã€‚è¿™é€šå¸¸æ˜¯å€¼çš„è¿è¡Œæ—¶ç±»å‹ï¼Œä½†å¦‚æœè°ƒç”¨è€…ç”¨ <code>superclassMirror</code> å»æ‰¾åˆ°ä¸Šé¢çš„ç±»çš„å±‚çº§ï¼Œå®ƒå¯ä»¥æ˜¯çˆ¶ç±»ã€‚å¦‚æœè°ƒç”¨è€…ä¸ä¼  å…¥<code>subjectType</code>ï¼Œä»£ç ä¼šé—® C++ ä¾§çš„ä»£ç è¦ <code>subject</code> çš„ç±»å‹ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> subjectType = subjectType ?? _getNormalizedType(subject, type: type(of: subject))</span><br></pre></td></tr></table></figure><p>ç„¶åå®ƒå°±ä¼šè·å–å­å…ƒç´ çš„æ•°é‡ï¼Œåˆ›å»ºä¸€ä¸ªç¨åè·å–æ¯ä¸ªå­å…ƒç´ ä¸ªä½“çš„é›†åˆæ¥æ„å»ºæ„å»º <code>children</code> å¯¹è±¡ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> childCount = _getChildCount(subject, type: subjectType)</span><br><span class="line"><span class="keyword">let</span> children = (<span class="number">0</span> ..&lt; childCount).<span class="built_in">lazy</span>.<span class="built_in">map</span>(&#123;</span><br><span class="line">  getChild(of: subject, type: subjectType, index: $<span class="number">0</span>)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">self</span>.children = <span class="type">Children</span>(children)</span><br></pre></td></tr></table></figure><p><code>getChild</code> å‡½æ•°æ˜¯ C++ çš„ <code>_getChild</code> å‡½æ•°çš„ç®€å•å°è£…ï¼Œå°†æ ‡ç­¾åå­—ä¸­åŒ…å«çš„ C å­—ç¬¦ä¸²è½¬æ¢æˆ Swift å­—ç¬¦ä¸²ã€‚</p><p><code>Mirror</code> æœ‰ä¸€ä¸ª <code>superclassMirror</code> å±æ€§ï¼Œä¼šè¿”å›æ£€æŸ¥è¿‡ç±»çš„å±‚çº§ç»“æ„é‡Œä¸Šä¸€å±‚çš„ç±»çš„å±æ€§çš„ <code>Mirror</code> å¯¹è±¡ã€‚åœ¨å†…éƒ¨ï¼Œå®ƒæœ‰ä¸€ä¸ª <code>_makeSuperclassMirror</code> å±æ€§ä¿å­˜ç€ä¸€ä¸ªæŒ‰éœ€æ±‚æ„å»ºçˆ¶ç±»çš„ <code>Mirror</code> çš„é—­åŒ…ã€‚é—­åŒ…ä¸€å¼€å§‹ä¼šè·å– <code>subjectType</code> çš„çˆ¶ç±»ã€‚éç±»çš„ç±»å‹å’Œæ²¡æœ‰çˆ¶ç±»çš„ç±»æ²¡æœ‰çˆ¶ç±»çš„ Mirrorï¼Œæ‰€ä»¥ä»–ä»¬ä¼šè·å–åˆ° <code>nil</code>:</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">self</span>._makeSuperclassMirror = &#123;</span><br><span class="line">  <span class="keyword">guard</span> <span class="keyword">let</span> subjectClass = subjectType <span class="keyword">as</span>? <span class="type">AnyClass</span>,</span><br><span class="line">        <span class="keyword">let</span> superclass = _getSuperclass(subjectClass) <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>è°ƒç”¨è€…å¯ä»¥ç”¨ä¸€ä¸ªå¯ä½œä¸ºçˆ¶ç±» Mirror ç›´æ¥è¿”å›çš„ <code>Mirror</code> å®ä¾‹æ¥æŒ‡å®šè‡ªå®šä¹‰çš„ç¥–å…ˆçš„è¡¨ç°ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> <span class="keyword">let</span> customAncestor = customAncestor &#123;</span><br><span class="line">  <span class="keyword">if</span> superclass == customAncestor.subjectType &#123;</span><br><span class="line">    <span class="keyword">return</span> customAncestor</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> customAncestor._defaultDescendantRepresentation == .suppressed &#123;</span><br><span class="line">    <span class="keyword">return</span> customAncestor</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é™¤æ­¤ä¹‹å¤–ï¼Œç»™ç›¸åŒå€¼è¿”å›ä¸€ä¸ªå°† <code>superclass</code> ä½œä¸º <code>subjectType</code> çš„æ–° <code>Mirror</code>ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">  <span class="keyword">return</span> <span class="type">Mirror</span>(internalReflecting: subject,</span><br><span class="line">                subjectType: superclass,</span><br><span class="line">                customAncestor: customAncestor)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ€åï¼Œå®ƒè·å–å¹¶è§£ææ˜¾ç¤ºçš„æ ·å¼ï¼Œå¹¶è®¾ç½® <code>Mirror</code> çš„å‰©ä¸‹çš„å±æ€§ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">  <span class="keyword">let</span> rawDisplayStyle = _getDisplayStyle(subject)</span><br><span class="line">  <span class="keyword">switch</span> <span class="type">UnicodeScalar</span>(<span class="type">Int</span>(rawDisplayStyle)) &#123;</span><br><span class="line">  <span class="keyword">case</span> <span class="string">"c"</span>: <span class="keyword">self</span>.displayStyle = .<span class="keyword">class</span></span><br><span class="line">  <span class="keyword">case</span> <span class="string">"e"</span>: <span class="keyword">self</span>.displayStyle = .<span class="keyword">enum</span></span><br><span class="line">  <span class="keyword">case</span> <span class="string">"s"</span>: <span class="keyword">self</span>.displayStyle = .<span class="keyword">struct</span></span><br><span class="line">  <span class="keyword">case</span> <span class="string">"t"</span>: <span class="keyword">self</span>.displayStyle = .tuple</span><br><span class="line">  <span class="keyword">case</span> <span class="string">"\0"</span>: <span class="keyword">self</span>.displayStyle = <span class="literal">nil</span></span><br><span class="line">  <span class="keyword">default</span>: <span class="built_in">preconditionFailure</span>(<span class="string">"Unknown raw display style '<span class="subst">\(rawDisplayStyle)</span>'"</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">self</span>.subjectType = subjectType</span><br><span class="line">  <span class="keyword">self</span>._defaultDescendantRepresentation = .generated</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ç»“è®º"><a href="#ç»“è®º" class="headerlink" title="ç»“è®º"></a>ç»“è®º</h2><p>Swift ä¸°å¯Œçš„å…ƒæ•°æ®ç±»å‹å¤§å¤šæ•°åœ¨å¹•åå­˜åœ¨ï¼Œä¸ºåƒåè®®ä¸€è‡´æ€§æ£€æŸ¥å’Œæ³›å‹ç±»å‹è§£å†³è¿™æ ·çš„äº‹æä¾›æ”¯æŒã€‚å…¶ä¸­æŸäº›é€šè¿‡ <code>Mirror</code> ç±» å‹æš´éœ²ç»™ç”¨æˆ·ï¼Œä»è€Œå…è®¸åœ¨è¿è¡Œæ—¶æ£€æŸ¥ä»»æ„å€¼ã€‚å¯¹äºé™æ€ç±»å‹çš„ Swift ç”Ÿæ€æ¥è¯´ï¼Œè¿™ç§æ–¹å¼ä¸€å¼€å§‹çœ‹èµ·æ¥æœ‰ç‚¹å¥‡æ€ªå’Œç¥ç§˜ï¼Œä½†æ ¹æ®å·²ç»å­˜åœ¨çš„ä¿¡æ¯æ¥çœ‹ï¼Œå®ƒå…¶å®æ˜¯ä¸ªç®€å•ç›´æ¥çš„åº”ç”¨ã€‚è¿™ä¸ªå®ç°çš„æ¢ç´¢æ—…ç¨‹åº”è¯¥ä¼šå¸®åŠ©å¤§å®¶äº†è§£ç¥ç§˜ä¹‹å¤„ï¼Œå¹¶åœ¨ä½¿ç”¨ <code>Mirror</code> æ—¶å¯ä»¥æ„è¯†åˆ°èƒŒåæ­£åœ¨è¿›è¡Œç€ä»€ä¹ˆã€‚</p><blockquote><p>æœ¬æ–‡ç”± SwiftGG ç¿»è¯‘ç»„ç¿»è¯‘ï¼Œå·²ç»è·å¾—ä½œè€…ç¿»è¯‘æˆæƒï¼Œæœ€æ–°æ–‡ç« è¯·è®¿é—® <a href="http://swift.gg">http://swift.gg</a>ã€‚</p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;ä½œè€…ï¼šMike Ashï¼Œ&lt;a href=&quot;https://swift.org/blog/how-mirror-works/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;åŸæ–‡é“¾æ¥&lt;/a&gt;ï¼ŒåŸæ–‡æ—¥æœŸï¼š2018-09-26&lt;br&gt;è¯‘è€…ï¼š&lt;a href=&quot;https://nemocdz.github.io/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Nemocdz&lt;/a&gt;ï¼›æ ¡å¯¹ï¼š&lt;a href=&quot;http://numbbbbb.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;numbbbbb&lt;/a&gt;ï¼Œ&lt;a href=&quot;http://linusling.com&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;å°é“åŒ Linus&lt;/a&gt;ï¼›å®šç¨¿ï¼š&lt;a href=&quot;http://forelax.space&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Forelax&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;!--æ­¤å¤„å¼€å§‹æ­£æ–‡--&gt;
&lt;p&gt;å°½ç®¡ Swift é‡å¿ƒåœ¨å¼ºè°ƒé™æ€ç±»å‹ä¸Šï¼Œä½†å®ƒåŒæ—¶æ”¯æŒä¸°å¯Œçš„å…ƒæ•°æ®ç±»å‹ã€‚å…ƒæ•°æ®ç±»å‹å…è®¸ä»£ç åœ¨è¿è¡Œæ—¶æ£€æŸ¥å’Œæ“ä½œä»»æ„å€¼ã€‚è¿™ä¸ªåŠŸèƒ½é€šè¿‡ &lt;code&gt;Mirror&lt;/code&gt; API æš´éœ²ç»™ Swift å¼€å‘è€…ã€‚å¤§å®¶å¯èƒ½ä¼šæ„Ÿåˆ°å›°æƒ‘ï¼Œåœ¨ Swift è¿™ç§å¦‚æ­¤å¼ºè°ƒé™æ€ç±»å‹çš„è¯­è¨€é‡Œï¼Œ&lt;code&gt;Mirror&lt;/code&gt; è¿™æ ·çš„ç‰¹æ€§æ˜¯æ€ä¹ˆå·¥ä½œçš„ï¼Ÿè®©æˆ‘ä»¬ä¸€èµ·æ¥é€šè¿‡è¿™ç¯‡æ–‡ç« äº†è§£ä¸€ä¸‹ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="Mike Ash" scheme="https://swift.gg/categories/Mike-Ash/"/>
    
      <category term="Swift" scheme="https://swift.gg/categories/Mike-Ash/Swift/"/>
    
    
      <category term="Swift" scheme="https://swift.gg/tags/Swift/"/>
    
  </entry>
  
  <entry>
    <title>NSDataAsset</title>
    <link href="https://swift.gg/2018/11/12/nshipster-nsdataasset/"/>
    <id>https://swift.gg/2018/11/12/nshipster-nsdataasset/</id>
    <published>2018-11-12T00:00:00.000Z</published>
    <updated>2019-02-19T03:45:13.515Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ä½œè€…ï¼šMatttï¼Œ<a href="https://nshipster.com/nsdataasset/" target="_blank" rel="noopener">åŸæ–‡é“¾æ¥</a>ï¼ŒåŸæ–‡æ—¥æœŸï¼š2018-08-26<br>è¯‘è€…ï¼š<a href="https://github.com/mobilefellow" target="_blank" rel="noopener">é›¨è°¨</a>ï¼›æ ¡å¯¹ï¼š<a href="https://github.com/wongzigii" target="_blank" rel="noopener">wongzigii</a>ï¼Œ<a href="http://numbbbbb.com/" target="_blank" rel="noopener">numbbbbb</a>ï¼›å®šç¨¿ï¼š<a href="http://forelax.space" target="_blank" rel="noopener">Forelax</a></p></blockquote><!--æ­¤å¤„å¼€å§‹æ­£æ–‡--><p>åœ¨ Web çš„ä¸–ç•Œé‡Œï¼Œé€Ÿåº¦ä¸æ˜¯ä¸€ç§å¥¢æ±‚ï¼›å®ƒäº‹å…³ç”Ÿæ­»ã€‚</p><p>è¿‘å¹´æ¥çš„ç”¨æˆ·ç ”ç©¶è¡¨æ˜ï¼Œé¡µé¢åŠ è½½ä¸­ _ä»»ä½•_ å¯ä»¥å¯Ÿè§‰åˆ°çš„å»¶è¿Ÿ â€”â€” å³å¤§äº 400 æ¯«ç§’ï¼ˆå­—é¢æ„ä¹‰ä¸Šçš„â€œä¸€çœ¨çœ¼çš„åŠŸå¤«â€ï¼‰ â€”â€” éƒ½ä¼šå¯¹è½¬åŒ–ç‡å’Œå‚ä¸ç‡äº§ç”Ÿè´Ÿé¢å½±å“ã€‚ç½‘é¡µåŠ è½½æ—¶æ¯å¤šèŠ±ä¸€ç§’ï¼Œå°±ä¼šå¤š 10% çš„ç”¨æˆ·è¿”å›æˆ–è€…å…³é—­è¿™ä¸ªé¡µé¢ã€‚</p><p>å¯¹äºè°·æ­Œã€äºšé©¬é€Šå’Œ Netflix è¿™æ ·çš„å¤§å‹çš„äº’è”ç½‘å…¬å¸è€Œè¨€ï¼Œè¿™é‡Œå’Œé‚£é‡Œé¢å¤–çš„ä¸€ç§’é’Ÿå¯èƒ½æ„å‘³ç€å¹´æ”¶å…¥é‡Œçš„ <em>æ•°åäº¿</em> ç¾é‡‘ã€‚æ‰€ä»¥é‚£äº›å…¬å¸æŠ•å…¥å¦‚æ­¤å¤šçš„å·¥ç¨‹åŠªåŠ›æ¥è®©ç½‘é¡µæ›´å¿«ï¼Œä¹Ÿæ²¡æœ‰ä»€ä¹ˆå¥‡æ€ªçš„äº†ã€‚</p><p>æœ‰å¾ˆå¤šåŠ é€Ÿç½‘ç»œè¯·æ±‚çš„æŠ€æœ¯ï¼šå‹ç¼©å’ŒæµæŠ€æœ¯ã€ç¼“å­˜å’Œé¢„åŠ è½½ã€è¿æ¥æ± å’Œå¤šè·¯å¤ç”¨ã€å»¶è¿Ÿå’Œåå°è¿è¡Œã€‚ç„¶è€Œï¼Œè¿˜æœ‰ä¸€ç§æ¯”å®ƒä»¬ä¼˜å…ˆçº§æ›´é«˜ï¼Œæ•ˆæœæ›´å¥½çš„ä¼˜åŒ–ç­–ç•¥ï¼š<em>ä¸è¦åœ¨åˆšå¼€å§‹çš„åœ°æ–¹å‘é€è¯·æ±‚</em>ã€‚</p><p>åœ¨è¿™ä¸ªæ–¹é¢ï¼ŒApp å‡­å€Ÿå…ˆä¸‹è½½åä½¿ç”¨çš„ç‰¹ç‚¹ï¼Œæ‹¥æœ‰ä¼ ç»Ÿç½‘é¡µæ‰€ä¸å…·å¤‡çš„ç‹¬ç‰¹ä¼˜åŠ¿ã€‚åœ¨è¿™ä¸€å‘¨çš„ NSHipster é‡Œï¼Œæˆ‘ä»¬å°†å±•ç¤ºå¦‚ä½•ä»¥ä¸€ç§éä¼ ç»Ÿçš„æ–¹å¼ä½¿ç”¨ Asset Catalog æ¥æ”¹å–„ä½ çš„ App çš„é¦–æ¬¡å¯åŠ¨ä½“éªŒã€‚</p><a id="more"></a><p>Asset Catalog å…è®¸ä½ æ ¹æ®å½“å‰è®¾å¤‡çš„ç‰¹ç‚¹æ¥ç»„ç»‡èµ„æºæ–‡ä»¶ã€‚å¯¹äºä¸€ä¸ªç»™å®šçš„å›¾ç‰‡ï¼Œä½ å¯ä»¥æ ¹æ®è®¾å¤‡ï¼ˆiPhoneã€iPadã€Apple Watchã€Apple TVã€Macï¼‰ã€å±å¹•åˆ†è¾¨ç‡ï¼ˆ<code>@2x</code> / <code>@3x</code>ï¼‰æˆ–è€…è‰²åŸŸï¼ˆsRGB / P3ï¼‰ï¼Œæä¾›ä¸åŒçš„æ–‡ä»¶ã€‚å¯¹äºå…¶ä»–ç±»å‹çš„ assetï¼Œä½ å¯èƒ½æ ¹æ®å¯ç”¨å†…å­˜æˆ–è€… Metal ç‰ˆæœ¬çš„ä¸åŒè€Œæä¾›ä¸åŒçš„æ–‡ä»¶ã€‚è¯·æ±‚ asset æ—¶ä»…éœ€æä¾›åå­—ï¼Œæœ€åˆé€‚çš„é‚£ä¸ªèµ„æºå°±ä¼šè‡ªåŠ¨è¿”å›ã€‚</p><p>é™¤äº†æä¾›æ›´ç®€ä¾¿çš„ APIï¼ŒAsset Catalog è¿˜å…è®¸ App ä½¿ç”¨ <a href="https://help.apple.com/xcode/mac/current/#/devbbdc5ce4f" target="_blank" rel="noopener">App ç˜¦èº«</a> ä¸ºæ¯ä¸ªç”¨æˆ·è®¾å¤‡æä¾›ä¸€ä¸ªç»è¿‡ä¼˜åŒ–çš„æ›´å°çš„å®‰è£…åŒ…ã€‚</p><p>å›¾ç‰‡æ˜¯æœ€å¸¸è§çš„ Asset ç±»å‹ï¼Œä½†æ˜¯ä» iOS 9 å’Œ macOS El Capitan å¼€å§‹ï¼ŒJSONã€XML å’Œå…¶ä»–æ•°æ®æ–‡ä»¶ä¹‹ç±»çš„èµ„æºä¹Ÿå¯ä»¥é€šè¿‡ <a href="https://developer.apple.com/documentation/uikit/nsdataasset" target="_blank" rel="noopener"><code>NSDataAsset</code></a> åŠ å…¥åˆ°è¿™ç§ä¹è¶£ä¸­ã€‚</p><h2 id="å¦‚ä½•ä½¿ç”¨-Asset-Catalog-å­˜å‚¨å’Œè·å–æ•°æ®"><a href="#å¦‚ä½•ä½¿ç”¨-Asset-Catalog-å­˜å‚¨å’Œè·å–æ•°æ®" class="headerlink" title="å¦‚ä½•ä½¿ç”¨ Asset Catalog å­˜å‚¨å’Œè·å–æ•°æ®"></a>å¦‚ä½•ä½¿ç”¨ Asset Catalog å­˜å‚¨å’Œè·å–æ•°æ®</h2><p>ä¸¾ä¸ªä¾‹å­ï¼Œè®©æˆ‘ä»¬æƒ³è±¡ä¸€ä¸ªç”¨äºåˆ›å»ºæ•°å­—è°ƒè‰²æ¿çš„ iOS Appã€‚</p><p>ä¸ºäº†åŒºåˆ†ä¸åŒæ·±æµ…çš„ç°è‰²ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šåŠ è½½ä¸€ä¸ªé¢œè‰²å’Œå¯¹åº”åå­—çš„åˆ—è¡¨ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šåœ¨ç¬¬ä¸€æ¬¡å¯åŠ¨æ—¶ä»æœåŠ¡å™¨ä¸‹è½½è¿™ä¸ªåˆ—è¡¨ï¼Œä½†æ˜¯å¦‚æœæ¶åŠ£çš„ç½‘ç»œç¯å¢ƒé™åˆ¶äº† App çš„åŠŸèƒ½ï¼Œå°±ä¼šå¯¼è‡´å¾ˆå·®çš„ç”¨æˆ·ä½“éªŒã€‚æ—¢ç„¶å®ƒæ˜¯ä¸€ä¸ªç›¸å¯¹é™æ€çš„æ•°æ®é›†ï¼Œä¸ºä»€ä¹ˆä¸ä»¥ä¸€ç§ Asset Catalog å½¢å¼å°†å®ƒæ·»åŠ åˆ° app bundle ä¸­ï¼Ÿ</p><h3 id="æ­¥éª¤-1ï¼šå‘-Asset-Catalog-ä¸­æ·»åŠ -New-Data-Set"><a href="#æ­¥éª¤-1ï¼šå‘-Asset-Catalog-ä¸­æ·»åŠ -New-Data-Set" class="headerlink" title="æ­¥éª¤ 1ï¼šå‘ Asset Catalog ä¸­æ·»åŠ  New Data Set"></a>æ­¥éª¤ 1ï¼šå‘ Asset Catalog ä¸­æ·»åŠ  New Data Set</h3><p>å½“ä½ åœ¨ Xcode ä¸­æ–°å»ºä¸€ä¸ª app é¡¹ç›®æ—¶ï¼Œå®ƒä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ª Asset Catalogã€‚åœ¨é¡¹ç›®å¯¼èˆªï¼ˆProject navigatorï¼‰ä¸­é€‰ä¸­ <code>Assets.xcassets</code>ï¼Œæ‰“å¼€ Asset Catalog ç¼–è¾‘å™¨ã€‚ç‚¹å‡»å·¦ä¸‹æ–¹çš„ <kbd>+</kbd> å›¾æ ‡ï¼Œç„¶åé€‰æ‹© â€œNew Data Setâ€ã€‚</p><p><img src="/img/articles/nshipster-nsdataasset/add-new-data-set-b6d8b1604dd12f49f1e034c0a36a42aa9fc6efc3f42d7320d9b489b6cec5fde0.png1542253210.0550492" alt=""></p><p>è¿™æ ·ä¼šåœ¨ <code>Assets.xcassets</code> ä¸‹æ–°å»ºä¸€ä¸ªåç¼€åä¸º <code>.dataset</code> çš„å­ç›®å½•ã€‚</p><blockquote><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒFinder ï¼ˆè®¿è¾¾ï¼‰æŠŠè¿™ä¸¤ç§ bundle éƒ½å½“åšç›®å½•ï¼Œä»¥ä¾¿åœ¨éœ€è¦æ—¶æŸ¥çœ‹å’Œä¿®æ”¹å®ƒä»¬çš„å†…å®¹ã€‚</p></blockquote><h3 id="æ­¥éª¤2ï¼šæ·»åŠ æ•°æ®æ–‡ä»¶"><a href="#æ­¥éª¤2ï¼šæ·»åŠ æ•°æ®æ–‡ä»¶" class="headerlink" title="æ­¥éª¤2ï¼šæ·»åŠ æ•°æ®æ–‡ä»¶"></a>æ­¥éª¤2ï¼šæ·»åŠ æ•°æ®æ–‡ä»¶</h3><p>æ‰“å¼€ Finderï¼Œæ‰¾åˆ°æ•°æ®æ–‡ä»¶ï¼ŒæŠŠå®ƒæ‹–æ‹½åˆ° Xcode ä¸­ data set asset çš„ç©ºç™½å¤„ã€‚</p><p><img src="/img/articles/nshipster-nsdataasset/asset-catalog-any-any-universal-f634190ce57540a9fa1406ded75e13936c390fb0552b374d584510896db186bc.png1542253210.4507105" alt=""></p><p>å½“ä½ è¿™ä¹ˆåšæ—¶ï¼ŒXcode ä¼šæŠŠé‚£ä¸ªæ–‡ä»¶å¤åˆ¶åˆ° <code>.dataset</code> å­ç›®å½•ï¼Œå¹¶å°†å®ƒçš„æ–‡ä»¶åå’Œ <a href="https://en.wikipedia.org/wiki/Uniform_Type_Identifier" target="_blank" rel="noopener">é€šç”¨ç±»å‹æ ‡è¯†ç¬¦ï¼ˆUniversal Type Identifierï¼‰</a> æ›´æ–°åˆ° <code>contents.json</code> å…ƒæ•°æ®æ–‡ä»¶ã€‚</p><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"info"</span>: &#123;</span><br><span class="line">    <span class="attr">"version"</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="attr">"author"</span>: <span class="string">"xcode"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"data"</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"idiom"</span>: <span class="string">"universal"</span>,</span><br><span class="line">      <span class="attr">"filename"</span>: <span class="string">"colors.json"</span>,</span><br><span class="line">      <span class="attr">"universal-type-identifier"</span>: <span class="string">"public.json"</span></span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ­¥éª¤3ï¼šä½¿ç”¨-NSDataAsset-è®¿é—®æ•°æ®"><a href="#æ­¥éª¤3ï¼šä½¿ç”¨-NSDataAsset-è®¿é—®æ•°æ®" class="headerlink" title="æ­¥éª¤3ï¼šä½¿ç”¨ NSDataAsset è®¿é—®æ•°æ®"></a>æ­¥éª¤3ï¼šä½¿ç”¨ NSDataAsset è®¿é—®æ•°æ®</h3><p>ç°åœ¨ä½ å¯ä»¥ä½¿ç”¨å¦‚ä¸‹ä»£ç è®¿é—®æ–‡ä»¶çš„æ•°æ®ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">guard</span> <span class="keyword">let</span> asset = <span class="type">NSDataAsset</span>(name: <span class="string">"NamedColors"</span>) <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">fatalError</span>(<span class="string">"Missing data asset: NamedColors"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> data = asset.data</span><br></pre></td></tr></table></figure><p>å¯¹äºæˆ‘ä»¬é¢œè‰² Appï¼Œæˆ‘ä»¬å¯èƒ½åœ¨ä¸€ä¸ª view controller çš„ <code>viewDidLoad()</code> æ–¹æ³•ä¸­è°ƒç”¨ä¸Šé¢çš„ä»£ç ï¼Œç„¶åè§£ç è¿”å›çš„æ•°æ®ï¼Œè·å– model å¯¹è±¡çš„æ•°ç»„ï¼Œå¹¶å±•ç¤ºåœ¨ä¸€ä¸ª table view ä¸Šã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> decoder = <span class="type">JSONDecoder</span>()</span><br><span class="line"><span class="keyword">self</span>.colors = <span class="keyword">try</span>! decoder.decode([<span class="type">NamedColor</span>].<span class="keyword">self</span>, from: asset.data)</span><br></pre></td></tr></table></figure><h2 id="æ··åˆä¸€ä¸‹"><a href="#æ··åˆä¸€ä¸‹" class="headerlink" title="æ··åˆä¸€ä¸‹"></a>æ··åˆä¸€ä¸‹</h2><p>Data set é€šå¸¸æ— æ³•ä» Asset Catalog çš„ App ç˜¦èº«ç‰¹æ€§ä¸­è·ç›Šï¼ˆä¾‹å¦‚ï¼Œå¤§éƒ¨åˆ†çš„ JSON æ–‡ä»¶éƒ½ä¸å¤ªå…³å¿ƒè®¾å¤‡æ‰€æ”¯æŒçš„ Metal ç‰ˆæœ¬ï¼‰ã€‚</p><p>ä½†æ˜¯å¯¹äºæˆ‘ä»¬çš„è°ƒè‰²æ¿ Appï¼Œæˆ‘ä»¬å¯èƒ½ä¸ºæ”¯æŒå¹¿è‰²åŸŸæ˜¾ç¤ºçš„è®¾å¤‡æä¾›ä¸åŒçš„é¢œè‰²åˆ—è¡¨ã€‚</p><p>ä¸ºäº†åšåˆ°è¿™ä¸€ç‚¹ï¼Œåœ¨ Asset Catalog ç¼–è¾‘å™¨çš„ä¾§è¾¹æ é€‰ä¸­åˆšæ‰çš„ assetï¼Œç„¶åç‚¹å‡» Attributes Inspector ä¸‹åä¸º Gamut çš„ä¸‹æ‹‰æ§ä»¶ã€‚</p><p><img src="/img/articles/nshipster-nsdataasset/select-color-gamut-02114afe2b744c228c2b29b7277abb9ec7e2bcb9afa683cc80115792849988c4.png1542253210.733386" alt=""></p><p>ä¸ºæ¯ä¸ªè‰²åŸŸæä¾›å®šåˆ¶çš„æ•°æ®æ–‡ä»¶åï¼Œ<code>contents.json</code> å…ƒæ•°æ®æ–‡ä»¶åº”è¯¥çœ‹èµ·æ¥åƒè¿™æ ·ï¼š</p><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"info"</span>: &#123;</span><br><span class="line">    <span class="attr">"version"</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="attr">"author"</span>: <span class="string">"xcode"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"data"</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"idiom"</span>: <span class="string">"universal"</span>,</span><br><span class="line">      <span class="attr">"filename"</span>: <span class="string">"colors-srgb.json"</span>,</span><br><span class="line">      <span class="attr">"universal-type-identifier"</span>: <span class="string">"public.json"</span>,</span><br><span class="line">      <span class="attr">"display-gamut"</span>: <span class="string">"sRGB"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"idiom"</span>: <span class="string">"universal"</span>,</span><br><span class="line">      <span class="attr">"filename"</span>: <span class="string">"colors-p3.json"</span>,</span><br><span class="line">      <span class="attr">"universal-type-identifier"</span>: <span class="string">"public.json"</span>,</span><br><span class="line">      <span class="attr">"display-gamut"</span>: <span class="string">"display-P3"</span></span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ä¿é²œä¸€ä¸‹"><a href="#ä¿é²œä¸€ä¸‹" class="headerlink" title="ä¿é²œä¸€ä¸‹"></a>ä¿é²œä¸€ä¸‹</h2><p>ä½¿ç”¨ Asset Catalog å­˜å‚¨å’Œè·å–æ•°æ®æ˜¯éå¸¸ç®€å•çš„ã€‚çœŸæ­£å›°éš¾ â€”â€” å¹¶æœ€ç»ˆæ›´é‡è¦ â€”â€” çš„æ˜¯ä¿æŒæ•°æ®çš„æ›´æ–°ã€‚</p><p>ä½¿ç”¨ <code>curl</code>ã€<code>rsync</code>ã€<code>sftp</code>ã€Dropboxã€BitTorrent æˆ– Filecoin åˆ·æ–°æ•°æ®ã€‚ä»ä¸€ä¸ª shell è„šæœ¬å¼€å§‹ï¼ˆå¦‚æœä½ å–œæ¬¢ï¼Œå¯ä»¥åœ¨ Xcode Build Phase ä¸­è°ƒç”¨å®ƒï¼‰ã€‚å°†å®ƒæ·»åŠ åˆ°ä½ çš„ <code>Makefile</code>ã€<code>Rakefile</code>ã€<code>Fastfile</code>ï¼Œæˆ–è€…ä½ çš„ç¼–è¯‘ç³»ç»Ÿæ‰€è¦æ±‚çš„ä»»ä½•åœ°æ–¹ã€‚å°†è¿™ä¸ªä»»åŠ¡åˆ†é…ç»™ Jenkinsã€Travis æˆ–è€…æŸä¸ªçƒ¦äººçš„å®ä¹ ç”Ÿã€‚ä½¿ç”¨å®šåˆ¶çš„ Slack integration æˆ–è€… Siri Shortcuts è§¦å‘å®ƒï¼Œè¿™æ ·ä½ å°±å¯ä»¥ç”¨éšæ„çš„ä¸€å¥ <em>â€œHey Siriï¼Œåœ¨æ•°æ®å˜å¾—å¤ªæ—§ä¹‹å‰æ›´æ–°ä¸€ä¸‹â€</em>ï¼Œè®©ä½ çš„åŒäº‹å¤§åƒä¸€æƒŠã€‚</p><p><strong>æ³¨æ„ï¼Œå½“ä½ å†³å®šåŒæ­¥ä½ çš„æ•°æ®æ—¶ï¼Œä¸€å®šè¦ç¡®ä¿å®ƒæ˜¯è‡ªåŠ¨åŒ–çš„ï¼Œè€Œä¸”æ˜¯ä½ å‘å¸ƒè¿‡ç¨‹çš„ä¸€éƒ¨åˆ†ã€‚</strong></p><p>ä¸‹é¢æ˜¯ä¸€ä¸ª shell è„šæœ¬ç¤ºä¾‹ï¼Œä½ å¯ä»¥è¿è¡Œå®ƒæ¥ä½¿ç”¨ <code>curl</code> ä¸‹è½½æœ€æ–°çš„æ•°æ®æ–‡ä»¶ï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/sh</span></span><br><span class="line">CURL='/usr/bin/curl'</span><br><span class="line">URL='https://example.com/path/to/data.json'</span><br><span class="line">OUTPUT='./Assets.xcassets/Colors.dataset/data.json'</span><br><span class="line"></span><br><span class="line"><span class="meta">$</span><span class="bash">CURL -fsSL -o <span class="variable">$OUTPUT</span> <span class="variable">$URL</span></span></span><br></pre></td></tr></table></figure><h2 id="å°è£…ä¸€ä¸‹"><a href="#å°è£…ä¸€ä¸‹" class="headerlink" title="å°è£…ä¸€ä¸‹"></a>å°è£…ä¸€ä¸‹</h2><p>è™½ç„¶ Assets Catalog ä¼šå¯¹ image asset æ‰§è¡Œçš„æ— æŸå‹ç¼©ï¼Œä½†æ²¡æœ‰ä»»ä½•æ–‡æ¡£ã€Xcode å¸®åŠ©æˆ– WWDC ä¼šè®®æŒ‡å‡º data asset ä¸Šä¹Ÿå­˜åœ¨è¿™ç§ä¼˜åŒ–ï¼ˆè‡³å°‘ç›®å‰æ²¡æœ‰ï¼‰ã€‚</p><p>å½“ data asset çš„æ–‡ä»¶å¤§å°å¤§äºï¼Œæ¯”å¦‚è¯´å‡ ç™¾ KB æ—¶ï¼Œä½ å°±è¦è€ƒè™‘ä½¿ç”¨å‹ç¼©äº†ã€‚JSONã€CSV å’Œ XML ä¹‹ç±»çš„æ–‡æœ¬æ–‡ä»¶å°¤å…¶å¦‚æ­¤ï¼Œå®ƒä»¬é€šå¸¸å¯ä»¥è¢«å‹ç¼©åˆ°åŸå§‹å¤§å°çš„ 60% - 80%ã€‚</p><p>æˆ‘ä»¬å¯ä»¥å°† <code>curl</code> çš„è¾“å‡ºå‘é€ç»™ <code>gzip</code>ï¼Œç„¶åå†å†™åˆ°æˆ‘ä»¬çš„æ–‡ä»¶ï¼Œä»è€Œä¸ºæˆ‘ä»¬ä¹‹å‰çš„ shell è„šæœ¬æ·»åŠ å‹ç¼©åŠŸèƒ½ã€‚</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/sh</span></span><br><span class="line">CURL='/usr/bin/curl'</span><br><span class="line">GZIP='/usr/bin/gzip'</span><br><span class="line">URL='https://example.com/path/to/data.json'</span><br><span class="line">OUTPUT='./Assets.xcassets/Colors.dataset/data.json.gz'</span><br><span class="line"></span><br><span class="line"><span class="meta">$</span><span class="bash">CURL -fsSL <span class="variable">$URL</span> | <span class="variable">$GZIP</span> -c &gt; <span class="variable">$OUTPUT</span></span></span><br></pre></td></tr></table></figure><p>å¦‚æœä½ ä½¿ç”¨äº†å‹ç¼©ï¼Œè¯·ç¡®ä¿ <code>&quot;universal-type-identifier&quot;</code> å­—æ®µä½“ç°äº†è¿™ä¸€ç‚¹ï¼š</p><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"info"</span>: &#123;</span><br><span class="line">    <span class="attr">"version"</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="attr">"author"</span>: <span class="string">"xcode"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"data"</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"idiom"</span>: <span class="string">"universal"</span>,</span><br><span class="line">      <span class="attr">"filename"</span>: <span class="string">"colors.json.gz"</span>,</span><br><span class="line">      <span class="attr">"universal-type-identifier"</span>: <span class="string">"org.gnu.gnu-zip-archive"</span></span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨å®¢æˆ·ç«¯ä¸Šï¼Œä½ ä½¿ç”¨ asset catalog ä¹‹å‰éœ€è¦å…ˆè§£å‹æ•°æ®ã€‚å¦‚æœæœ‰ <code>Gzip</code> æ¨¡å—ï¼Œä½ å¯èƒ½ä¼šåšä»¥ä¸‹äº‹æƒ…ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> data = <span class="keyword">try</span> <span class="type">Gzip</span>.decompress(data: asset.data)</span><br><span class="line">&#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">    <span class="built_in">fatalError</span>(error.localizedDescription)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ–è€…ï¼Œå¦‚æœä½ ä¼šåœ¨ App ä¸­åå¤åœ°è¿™ä¹ˆåšï¼Œé‚£ä¹ˆå¯ä»¥åœ¨ <code>NSDataAsset</code> çš„æ‰©å±•ä¸­åˆ›å»ºä¸€ä¸ªä¾¿åˆ©æ–¹æ³•ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">NSDataAsset</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">decompressedData</span><span class="params">()</span></span> <span class="keyword">throws</span> -&gt; <span class="type">Data</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">try</span> <span class="type">Gzip</span>.decompress(data: <span class="keyword">self</span>.data)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ä½ è¿˜å¯ä»¥è€ƒè™‘ä½¿ç”¨ <a href="https://git-lfs.github.com" target="_blank" rel="noopener">Git Large File Storage (LFS)</a> å®ç°å¤§å‹ data asset æ–‡ä»¶çš„ç‰ˆæœ¬æ§åˆ¶ã€‚</p></blockquote><p>å°½ç®¡ä½ å€¾å‘äºè®¤ä¸ºä½ çš„æ‰€æœ‰ç”¨æˆ·éƒ½äº«å—ç€å¿«é€Ÿçš„ã€æ— å¤„ä¸åœ¨çš„ WiFi å’Œ LTE ç½‘ç»œï¼Œä½†è¿™å¹¶ä¸é€‚ç”¨äºæ‰€æœ‰äººï¼Œä¹Ÿä¸é€‚ç”¨äºæ‰€æœ‰æ—¶æ®µã€‚</p><p>èŠ±ç‚¹æ—¶é—´çœ‹çœ‹ä½ çš„ App åœ¨å¯åŠ¨æ—¶å‘å‡ºçš„ç½‘ç»œè¯·æ±‚ï¼Œç„¶åè€ƒè™‘å“ªäº›å¯èƒ½ä»é¢„åŠ è½½ä¸­å—ç›Šã€‚ç»™äººç•™ä¸‹å¥½çš„ç¬¬ä¸€å°è±¡å¯èƒ½æ„å‘³ç€ä½ çš„ App æ˜¯è¢«é•¿æœŸåœ°ç§¯æåœ°ä½¿ç”¨ç€ï¼Œè€Œä¸æ˜¯å‡ ç§’é’Ÿä¹‹åå°±è¢«åˆ é™¤ã€‚</p><blockquote><p>æœ¬æ–‡ç”± SwiftGG ç¿»è¯‘ç»„ç¿»è¯‘ï¼Œå·²ç»è·å¾—ä½œè€…ç¿»è¯‘æˆæƒï¼Œæœ€æ–°æ–‡ç« è¯·è®¿é—® <a href="http://swift.gg">http://swift.gg</a>ã€‚</p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;ä½œè€…ï¼šMatttï¼Œ&lt;a href=&quot;https://nshipster.com/nsdataasset/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;åŸæ–‡é“¾æ¥&lt;/a&gt;ï¼ŒåŸæ–‡æ—¥æœŸï¼š2018-08-26&lt;br&gt;è¯‘è€…ï¼š&lt;a href=&quot;https://github.com/mobilefellow&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;é›¨è°¨&lt;/a&gt;ï¼›æ ¡å¯¹ï¼š&lt;a href=&quot;https://github.com/wongzigii&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;wongzigii&lt;/a&gt;ï¼Œ&lt;a href=&quot;http://numbbbbb.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;numbbbbb&lt;/a&gt;ï¼›å®šç¨¿ï¼š&lt;a href=&quot;http://forelax.space&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Forelax&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;!--æ­¤å¤„å¼€å§‹æ­£æ–‡--&gt;
&lt;p&gt;åœ¨ Web çš„ä¸–ç•Œé‡Œï¼Œé€Ÿåº¦ä¸æ˜¯ä¸€ç§å¥¢æ±‚ï¼›å®ƒäº‹å…³ç”Ÿæ­»ã€‚&lt;/p&gt;
&lt;p&gt;è¿‘å¹´æ¥çš„ç”¨æˆ·ç ”ç©¶è¡¨æ˜ï¼Œé¡µé¢åŠ è½½ä¸­ _ä»»ä½•_ å¯ä»¥å¯Ÿè§‰åˆ°çš„å»¶è¿Ÿ â€”â€” å³å¤§äº 400 æ¯«ç§’ï¼ˆå­—é¢æ„ä¹‰ä¸Šçš„â€œä¸€çœ¨çœ¼çš„åŠŸå¤«â€ï¼‰ â€”â€” éƒ½ä¼šå¯¹è½¬åŒ–ç‡å’Œå‚ä¸ç‡äº§ç”Ÿè´Ÿé¢å½±å“ã€‚ç½‘é¡µåŠ è½½æ—¶æ¯å¤šèŠ±ä¸€ç§’ï¼Œå°±ä¼šå¤š 10% çš„ç”¨æˆ·è¿”å›æˆ–è€…å…³é—­è¿™ä¸ªé¡µé¢ã€‚&lt;/p&gt;
&lt;p&gt;å¯¹äºè°·æ­Œã€äºšé©¬é€Šå’Œ Netflix è¿™æ ·çš„å¤§å‹çš„äº’è”ç½‘å…¬å¸è€Œè¨€ï¼Œè¿™é‡Œå’Œé‚£é‡Œé¢å¤–çš„ä¸€ç§’é’Ÿå¯èƒ½æ„å‘³ç€å¹´æ”¶å…¥é‡Œçš„ &lt;em&gt;æ•°åäº¿&lt;/em&gt; ç¾é‡‘ã€‚æ‰€ä»¥é‚£äº›å…¬å¸æŠ•å…¥å¦‚æ­¤å¤šçš„å·¥ç¨‹åŠªåŠ›æ¥è®©ç½‘é¡µæ›´å¿«ï¼Œä¹Ÿæ²¡æœ‰ä»€ä¹ˆå¥‡æ€ªçš„äº†ã€‚&lt;/p&gt;
&lt;p&gt;æœ‰å¾ˆå¤šåŠ é€Ÿç½‘ç»œè¯·æ±‚çš„æŠ€æœ¯ï¼šå‹ç¼©å’ŒæµæŠ€æœ¯ã€ç¼“å­˜å’Œé¢„åŠ è½½ã€è¿æ¥æ± å’Œå¤šè·¯å¤ç”¨ã€å»¶è¿Ÿå’Œåå°è¿è¡Œã€‚ç„¶è€Œï¼Œè¿˜æœ‰ä¸€ç§æ¯”å®ƒä»¬ä¼˜å…ˆçº§æ›´é«˜ï¼Œæ•ˆæœæ›´å¥½çš„ä¼˜åŒ–ç­–ç•¥ï¼š&lt;em&gt;ä¸è¦åœ¨åˆšå¼€å§‹çš„åœ°æ–¹å‘é€è¯·æ±‚&lt;/em&gt;ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨è¿™ä¸ªæ–¹é¢ï¼ŒApp å‡­å€Ÿå…ˆä¸‹è½½åä½¿ç”¨çš„ç‰¹ç‚¹ï¼Œæ‹¥æœ‰ä¼ ç»Ÿç½‘é¡µæ‰€ä¸å…·å¤‡çš„ç‹¬ç‰¹ä¼˜åŠ¿ã€‚åœ¨è¿™ä¸€å‘¨çš„ NSHipster é‡Œï¼Œæˆ‘ä»¬å°†å±•ç¤ºå¦‚ä½•ä»¥ä¸€ç§éä¼ ç»Ÿçš„æ–¹å¼ä½¿ç”¨ Asset Catalog æ¥æ”¹å–„ä½ çš„ App çš„é¦–æ¬¡å¯åŠ¨ä½“éªŒã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="Swift" scheme="https://swift.gg/categories/Swift/"/>
    
      <category term="NSHipster" scheme="https://swift.gg/categories/Swift/NSHipster/"/>
    
    
      <category term="Swift" scheme="https://swift.gg/tags/Swift/"/>
    
      <category term="NSHipster" scheme="https://swift.gg/tags/NSHipster/"/>
    
  </entry>
  
  <entry>
    <title>ä½¿ç”¨ YOLO è¿›è¡Œå®æ—¶ç›®æ ‡æ£€æµ‹</title>
    <link href="https://swift.gg/2018/10/29/object-detection-with-yolo/"/>
    <id>https://swift.gg/2018/10/29/object-detection-with-yolo/</id>
    <published>2018-10-29T00:00:00.000Z</published>
    <updated>2019-02-19T03:45:13.515Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ä½œè€…ï¼šMatthijs Hollemansï¼Œ<a href="http://machinethink.net/blog/object-detection-with-yolo/" target="_blank" rel="noopener">åŸæ–‡é“¾æ¥</a>ï¼ŒåŸæ–‡æ—¥æœŸï¼š2018/03/28<br>è¯‘è€…ï¼š<a href="https://github.com/YangGao1991" target="_blank" rel="noopener">é˜³ä»”</a>ï¼›æ ¡å¯¹ï¼š<a href="http://numbbbbb.com/" target="_blank" rel="noopener">numbbbbb</a>ï¼Œ<a href="http://linusling.com" target="_blank" rel="noopener">å°é“åŒ Linus</a>ï¼›å®šç¨¿ï¼š<a href="http://forelax.space" target="_blank" rel="noopener">Forelax</a></p></blockquote> <!--æ­¤å¤„å¼€å§‹æ­£æ–‡--><p>ç›®æ ‡æ£€æµ‹æ˜¯è®¡ç®—æœºè§†è§‰ä¸­çš„ç»å…¸é—®é¢˜ä¹‹ä¸€ï¼š</p><p>è¯†åˆ«ä¸€å¹…å›¾åƒä¸­æœ‰å“ªäº›ç›®æ ‡ï¼Œä»¥åŠå®ƒä»¬åœ¨å›¾åƒä¸­çš„ä½ç½®ã€‚</p><p>æ£€æµ‹æ˜¯ä¸€ä¸ªæ¯”åˆ†ç±»æ›´å¤æ‚çš„é—®é¢˜ï¼Œå› ä¸ºåˆ†ç±»ä¹Ÿå¯ä»¥è¯†åˆ«ç›®æ ‡ï¼Œä½†ä¸èƒ½å‡†ç¡®åˆ¤æ–­ç›®æ ‡åœ¨å›¾åƒä¸­çš„ä½ç½®â€”â€”å¹¶ä¸”åˆ†ç±»ä¸èƒ½é€‚ç”¨äºåŒ…å«å¤šä¸ªç›®æ ‡çš„å›¾åƒã€‚</p><p><img src="http://machinethink.net/images/yolo/ClassificationVsDetection.png" alt=""></p><p><a href="https://pjreddie.com/darknet/yolo/" target="_blank" rel="noopener">YOLO</a> æ˜¯ä¸€ä¸ªå®æ—¶æœ‰æ•ˆçš„ç›®æ ‡æ£€æµ‹ç¥ç»ç½‘ç»œã€‚</p><p>åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å°†é˜è¿°å¦‚ä½•ä½¿ç”¨ Metal Performance Shaders æ¥å°†â€œç®€åŒ–ç‰ˆâ€ YOLOv2 è¿è¡Œåœ¨ iOS è®¾å¤‡ä¸Šã€‚</p><a id="more"></a><p>åœ¨ç»§ç»­é˜…è¯»ä¹‹å‰ï¼Œè¯·å…ˆ <a href="https://www.youtube.com/watch?v=VOC3huqHrss" target="_blank" rel="noopener">è§‚çœ‹è¿™ä¸ªä»¤äººæƒŠå¹çš„ YOLOv2 ä»‹ç»è§†é¢‘</a>ã€‚</p><h2 id="YOLO-çš„å·¥ä½œåŸç†"><a href="#YOLO-çš„å·¥ä½œåŸç†" class="headerlink" title="YOLO çš„å·¥ä½œåŸç†"></a>YOLO çš„å·¥ä½œåŸç†</h2><p>ä½ å¯ä»¥ä½¿ç”¨ <a href="http://machinethink.net/blog/convolutional-neural-networks-on-the-iphone-with-vggnet/" target="_blank" rel="noopener">VGGNet</a> æˆ– <a href="https://github.com/hollance/Forge/tree/master/Examples/Inception" target="_blank" rel="noopener">Inception</a> è¿™æ ·çš„åˆ†ç±»å™¨ï¼Œé€šè¿‡ä¸€ä¸ªå°çš„æ»‘åŠ¨çª—å£å¯¹å›¾åƒè¿›è¡Œéå†ï¼Œä»è€Œå½¢æˆä¸€ä¸ªç›®æ ‡æ£€æµ‹å™¨ã€‚æ¯ä¸€æ­¥éå†è¿è¡Œä¸€æ¬¡åˆ†ç±»å™¨ï¼Œæ¥å¯¹å½“å‰çª—å£ä¸­çš„ç›®æ ‡è¿›è¡Œåˆ†ç±»ã€‚ä½¿ç”¨è¿™æ ·çš„æ»‘åŠ¨çª—å£ï¼Œä¼šå¯¹ä¸€å¹…å›¾åƒè¾“å‡ºæˆç™¾ä¸Šåƒçš„æ£€æµ‹ç»“æœï¼Œä½†ä½ åªéœ€è¦ä¿ç•™åˆ†ç±»å™¨æœ€ç¡®å®šçš„é‚£äº›ç»“æœã€‚</p><p>è¿™ç§æ–¹æ³•æ˜¯å¯è¡Œçš„ï¼Œä½†å¾ˆæ˜¾ç„¶ä¼šå¾ˆæ…¢ï¼Œå› ä¸ºéœ€è¦è¿è¡Œå¾ˆå¤šéåˆ†ç±»å™¨ã€‚ä¸€ç§æ•ˆç‡ç¨å¾®é«˜ä¸€ç‚¹çš„æ–¹æ³•æ˜¯ï¼Œé¦–å…ˆåˆ¤æ–­å›¾åƒçš„å“ªä¸€éƒ¨åˆ†åŒ…å«äº†æœ‰æ•ˆçš„ä¿¡æ¯â€”â€”ä¹Ÿå°±æ˜¯å€™é€‰åŒºåŸŸ (region proposals)â€”â€”ç„¶åä»…ä»…åœ¨è¿™äº›åŒºåŸŸä¸­è¿è¡Œåˆ†ç±»å™¨ã€‚è¿™ç§æ–¹æ³•æ¯”æ»‘åŠ¨çª—å£çš„æ–¹æ³•èƒ½å‡å°‘åˆ†ç±»å™¨çš„è¿è¡Œæ¬¡æ•°ï¼Œä½†ä»ç„¶å¾ˆå¤šã€‚</p><p>YOLO é‡‡ç”¨äº†ä¸€ç§å®Œå…¨ä¸åŒçš„æ–¹æ³•ã€‚å®ƒå¹¶ä¸æ˜¯å°†ä¼ ç»Ÿçš„åˆ†ç±»å™¨æ”¹é€ æˆæ£€æµ‹å™¨ã€‚YOLO å®é™…ä¸Šåªå¯¹å›¾åƒè¿›è¡Œä¸€æ¬¡æ“ä½œï¼ˆä¹Ÿå°±æ˜¯å®ƒåå­—çš„ç”±æ¥ï¼šYou Only Look Onceï¼‰ï¼Œä½†æ˜¯æ˜¯ä»¥ä¸€ç§èªæ˜çš„æ–¹å¼ã€‚</p><p>YOLO å°†å›¾åƒåˆ†æˆ 13Ã—13 çš„ç½‘æ ¼å•å…ƒï¼š</p><p><img src="http://machinethink.net/images/yolo/Grid.png" alt=""></p><p>æ¯ä¸€ä¸ªç½‘æ ¼å•å…ƒè´Ÿè´£é¢„æµ‹ 5 ä¸ªæ£€æµ‹æ¡†ã€‚ä¸€ä¸ªæ£€æµ‹æ¡†æ˜¯åŒ…å«ä¸€ä¸ªç›®æ ‡çš„çŸ©å½¢åŒºåŸŸã€‚</p><p>YOLO åŒæ—¶ä¼šç»™å‡ºä¸€ä¸ªç½®ä¿¡åº¦ï¼Œæè¿°äº†æŸä¸ªæ£€æµ‹æ¡†ç¡®å®åŒ…å«äº†æŸç›®æ ‡çš„ç¡®å®šç¨‹åº¦ã€‚è¿™ä¸ªå€¼å’Œæ£€æµ‹æ¡†ä¸­æ˜¯ä»€ä¹ˆç›®æ ‡æ¯«æ— å…³ç³»ï¼Œåªå’Œæ£€æµ‹æ¡†çš„å½¢çŠ¶å¤§å°åŒ¹é…ç¨‹åº¦æœ‰å…³ã€‚</p><p>é¢„æµ‹å‡ºçš„æ£€æµ‹æ¡†çœ‹èµ·æ¥å’Œä¸‹å›¾ç±»ä¼¼ï¼ˆç½®ä¿¡åº¦è¶Šé«˜ï¼Œæ¡†è¶Šç²—ï¼‰ï¼š</p><p><img src="http://machinethink.net/images/yolo/Boxes.png" alt=""></p><p>å¯¹æ¯ä¸ªæ£€æµ‹æ¡†ï¼Œå¯¹åº”çš„ç½‘æ ¼å•å…ƒè¿˜ç»™å‡ºäº†ä¸€ä¸ªåˆ†ç±»çš„é¢„æµ‹ã€‚è¿™å’Œåˆ†ç±»å™¨çš„å·¥ä½œç›¸ä¼¼ï¼šå®ƒç»™å‡ºä¸€ä¸ªå…¨éƒ¨å¯èƒ½çš„ç±»åˆ«çš„æ¦‚ç‡åˆ†å¸ƒã€‚æˆ‘ä»¬ä½¿ç”¨çš„è¿™ä¸ªç‰ˆæœ¬çš„ YOLO æ˜¯ç”¨ <a href="http://host.robots.ox.ac.uk/pascal/VOC/" target="_blank" rel="noopener">PASCAL VOC dataset</a> è®­ç»ƒçš„ï¼Œå¯ä»¥æ£€æµ‹ 20 ç§ä¸åŒçš„ç±»åˆ«ï¼Œæ¯”å¦‚ï¼š</p><ul><li>è‡ªè¡Œè½¦</li><li>èˆ¹</li><li>æ±½è½¦</li><li>çŒ«</li><li>ç‹—</li><li>äºº</li><li>ç­‰ç­‰</li></ul><p>æ£€æµ‹æ¡†çš„ç½®ä¿¡åº¦å’Œåˆ†ç±»é¢„æµ‹æœ€ç»ˆè¢«æ•´åˆæˆä¸€ä¸ªæœ€ç»ˆå¾—åˆ†ï¼Œæ¥å‘Šè¯‰æˆ‘ä»¬è¯¥æ£€æµ‹æ¡†å†…åŒ…å«ä¸€ä¸ªç‰¹å®šç±»å‹çš„ç›®æ ‡çš„æ¦‚ç‡ã€‚ä¾‹å¦‚ï¼Œå·¦è¾¹è¿™ä¸ªåˆå¤§åˆç²—çš„é»„è‰²æ¡†å‘Šè¯‰æˆ‘ä»¬ï¼Œ85% çš„æ¦‚ç‡è¿™é‡Œé¢åŒ…å«ä¸€åªç‹—ï¼š</p><p><img src="http://machinethink.net/images/yolo/Scores.png" alt=""></p><p>å› ä¸ºæ•´å¹…å›¾åƒåŒ…å« 13Ã—13 = 169 ä¸ªç½‘æ ¼å•å…ƒï¼Œä¸”æ¯ä¸ªç½‘æ ¼å•å…ƒé¢„æµ‹ 5 ä¸ªæ£€æµ‹æ¡†ï¼Œæˆ‘ä»¬æœ€åæ€»è®¡èƒ½å¾—åˆ° 845 ä¸ªæ£€æµ‹æ¡†ã€‚å®é™…ä¸Šï¼Œè¿™å…¶ä¸­å¤§å¤šæ•°çš„æ£€æµ‹æ¡†çš„ç½®ä¿¡åº¦éƒ½å¾ˆä½ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬åªéœ€è¦ä¿ç•™æœ€ç»ˆå¾—åˆ†å¤§äºç­‰äº 30% çš„æ£€æµ‹æ¡†å°±è¡Œäº†ï¼ˆä½ ä¹Ÿå¯ä»¥æ ¹æ®éœ€è¦çš„æ£€æµ‹å‡†ç¡®åº¦æ”¹å˜è¿™ä¸ªé˜ˆå€¼ï¼‰ã€‚</p><p>æœ€ç»ˆçš„æ£€æµ‹ç»“æœï¼š</p><p><img src="http://machinethink.net/images/yolo/Prediction.png" alt=""></p><p>ä» 845 ä¸ªæ£€æµ‹æ¡†ä¸­ï¼Œæˆ‘ä»¬åªä¿ç•™äº†è¿™ä¸‰ä¸ªï¼Œå› ä¸ºå®ƒä»¬ç»™å‡ºçš„ç»“æœæœ€å¥½ã€‚å°½ç®¡æˆ‘ä»¬æœ‰ 845 ä¸ªæ£€æµ‹æ¡†ï¼Œä½†å®ƒä»¬éƒ½æ˜¯åŒæ—¶å¾—åˆ°çš„â€”â€”ç¥ç»ç½‘ç»œåªéœ€è¦è¿è¡Œä¸€æ¬¡ã€‚è¿™ä¹Ÿæ˜¯ YOLO å¼ºå¤§è€Œå¿«é€Ÿçš„åŸå› ã€‚</p><p>ï¼ˆä»¥ä¸Šå›¾ç‰‡æ¥è‡ª <a href="https://pjreddie.com/" target="_blank" rel="noopener">pjreddie.com</a>ï¼‰</p><h2 id="ç¥ç»ç½‘ç»œ"><a href="#ç¥ç»ç½‘ç»œ" class="headerlink" title="ç¥ç»ç½‘ç»œ"></a>ç¥ç»ç½‘ç»œ</h2><p>YOLO çš„ç»“æ„åªæ˜¯ä¸€ä¸ªç®€å•çš„å·ç§¯ç¥ç»ç½‘ç»œï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Layer         kernel  stride  output shape</span><br><span class="line">---------------------------------------------</span><br><span class="line">Input                          (416, 416, 3)</span><br><span class="line">Convolution    3Ã—3      1      (416, 416, 16)</span><br><span class="line">MaxPooling     2Ã—2      2      (208, 208, 16)</span><br><span class="line">Convolution    3Ã—3      1      (208, 208, 32)</span><br><span class="line">MaxPooling     2Ã—2      2      (104, 104, 32)</span><br><span class="line">Convolution    3Ã—3      1      (104, 104, 64)</span><br><span class="line">MaxPooling     2Ã—2      2      (52, 52, 64)</span><br><span class="line">Convolution    3Ã—3      1      (52, 52, 128)</span><br><span class="line">MaxPooling     2Ã—2      2      (26, 26, 128)</span><br><span class="line">Convolution    3Ã—3      1      (26, 26, 256)</span><br><span class="line">MaxPooling     2Ã—2      2      (13, 13, 256)</span><br><span class="line">Convolution    3Ã—3      1      (13, 13, 512)</span><br><span class="line">MaxPooling     2Ã—2      1      (13, 13, 512)</span><br><span class="line">Convolution    3Ã—3      1      (13, 13, 1024)</span><br><span class="line">Convolution    3Ã—3      1      (13, 13, 1024)</span><br><span class="line">Convolution    1Ã—1      1      (13, 13, 125)</span><br><span class="line">---------------------------------------------</span><br></pre></td></tr></table></figure><p>è¯¥ç¥ç»ç½‘ç»œå…·æœ‰å…¸å‹çš„ç»“æ„ï¼šä¸€ä¸ª 3Ã—3 å·ç§¯æ ¸çš„å·ç§¯å±‚ï¼Œé‡‡æ ·çª—å£ 2Ã—2 çš„æ± åŒ–å±‚ã€‚æ²¡æœ‰èŠ±å“¨çš„ä¸œè¥¿ã€‚YOLO ä¸­æ²¡æœ‰å…¨è¿æ¥å±‚ã€‚</p><blockquote><p>æ³¨æ„ï¼šæˆ‘ä»¬ä½¿ç”¨çš„â€œç®€åŒ–ç‰ˆâ€ YOLO åªæœ‰ 9 ä¸ªå·ç§¯å±‚å’Œ 6 ä¸ªæ± åŒ–å±‚ã€‚å®Œå…¨ç‰ˆ YOLOv2 æ¨¡å‹åˆ†å±‚æ•°æ˜¯è¿™ä¸ªçš„ä¸‰å€ï¼Œå¹¶ä¸”ä¼šæ›´å¤æ‚ä¸€äº›ï¼Œä½†ä»ç„¶æ˜¯ä¸€ä¸ªå¸¸è§„çš„å·ç§¯ç¥ç»ç½‘ç»œã€‚</p></blockquote><p>æœ€åä¸€ä¸ªå·ç§¯å±‚çš„å·ç§¯æ ¸ä¸º 1Ã—1ï¼Œæ˜¯ä¸ºäº†å°†å‚æ•°é™ç»´è‡³ 13Ã—13Ã—125ã€‚å…¶ä¸­çš„ 13Ã—13 çœ‹èµ·æ¥å¾ˆç†Ÿæ‚‰ï¼šè¿™å°±æ˜¯å›¾åƒè¢«åˆ’åˆ†æˆçš„ç½‘æ ¼å•å…ƒçš„æ•°é‡ã€‚</p><p>å› æ­¤ï¼Œæ¯ä¸ªç½‘æ ¼å•å…ƒæœ‰ 125 ä¸ªé€šé“ã€‚è¿™ 125 ä¸ªé€šé“åŒ…å«äº†æ£€æµ‹æ¡†çš„æ•°æ®ï¼Œä»¥åŠåˆ†ç±»é¢„æµ‹çš„æ•°æ®ã€‚ä¸ºä»€ä¹ˆæ˜¯ 125 å‘¢ï¼Ÿå› ä¸ºæ¯ä¸ªç½‘æ ¼å•å…ƒé¢„æµ‹ 5 ä¸ªæ£€æµ‹æ¡†çš„ç»“æœï¼Œæ¯ä¸ªæ£€æµ‹æ¡†ç”± 25 ä¸ªæ•°æ®å…ƒç´ æ¥æè¿°ï¼š</p><ul><li>æ£€æµ‹æ¡†çŸ©å½¢çš„ xï¼Œyï¼Œå®½ï¼Œé«˜</li><li>ç½®ä¿¡åº¦</li><li>åœ¨ 20 ä¸ªåˆ†ç±»ä¸Šçš„æ¦‚ç‡åˆ†å¸ƒ</li></ul><p>YOLO çš„ä½¿ç”¨å¾ˆç®€å•ï¼šè¾“å…¥ä¸€å¹…å›¾åƒï¼ˆå¤§å°ä¸º 416Ã—416 åƒç´ ï¼‰ï¼Œå®ƒè¿è¡Œä¸€æ¬¡å·ç§¯ç½‘ç»œï¼Œè¾“å‡ºä¸€ä¸ª 13Ã—13Ã—125 çš„å¼ é‡ï¼Œæè¿°ç½‘æ ¼å•å…ƒä»¥åŠæ£€æµ‹æ¡†ã€‚ä½ éœ€è¦åšçš„åªæ˜¯è®¡ç®—æ¯ä¸ªæ£€æµ‹æ¡†çš„æœ€ç»ˆå¾—åˆ†ï¼Œå¹¶æŠ›å¼ƒä½äº 30% çš„é‚£äº›ã€‚</p><blockquote><p>å°æç¤ºï¼šè¦äº†è§£æ›´å¤šæœ‰å…³ YOLO çš„å·¥ä½œåŸç†ï¼Œä»¥åŠ YOLO æ˜¯å¦‚ä½•è®­ç»ƒçš„ï¼Œè¯· <a href="https://www.youtube.com/watch?v=NM6lrxy0bxs" target="_blank" rel="noopener">è§‚çœ‹å¯¹å®ƒçš„å‘æ˜è€…ä¹‹ä¸€çš„è®¿è°ˆ</a>ã€‚è¿™ä¸ªè§†é¢‘ä»‹ç»çš„æ˜¯ YOLOv1ï¼Œç”±äºæ˜¯è€ç‰ˆæœ¬ï¼Œç»“æ„ç¨æœ‰ä¸åŒï¼Œä½†ä¸»ä½“æ€æƒ³æ˜¯ç›¸åŒçš„ã€‚å¾ˆå€¼å¾—è§‚çœ‹ï¼</p></blockquote><h2 id="è½¬æ¢æˆ-Metal"><a href="#è½¬æ¢æˆ-Metal" class="headerlink" title="è½¬æ¢æˆ Metal"></a>è½¬æ¢æˆ Metal</h2><p>ä¸Šæ–‡æè¿°çš„æ˜¯ç®€åŒ–ç‰ˆçš„ YOLOï¼Œä¹Ÿæ˜¯æˆ‘ä»¬å°†åœ¨ iOS åº”ç”¨ä¸­ä½¿ç”¨çš„ç‰ˆæœ¬ã€‚å®Œå…¨ç‰ˆ YOLOv2 çš„ç¥ç»ç½‘ç»œæœ‰ä¸‰å€çš„åˆ†å±‚æ•°ï¼Œå› ä¸ºå¤ªå¤§ï¼Œæ‰€ä»¥åœ¨å½“å‰çš„ iPhone è®¾å¤‡ä¸Šä¸èƒ½å¿«é€Ÿè¿è¡Œã€‚ç®€åŒ–ç‰ˆçš„ YOLO ä½¿ç”¨æ›´å°‘çš„åˆ†å±‚æ•°ï¼Œå› æ­¤è¿è¡Œä¼šæ›´å¿«ï¼Œä½†å‡†ç¡®åº¦ä¹Ÿç¨å·®ã€‚</p><p><img src="http://machinethink.net/images/yolo/CatOrDog.png" alt=""></p><p>YOLO ä½¿ç”¨ Darknet ç¼–å†™ï¼Œè¿™æ˜¯ YOLO ä½œè€…è‡ªå·±ç¼–å†™çš„æ·±åº¦å­¦ä¹ æ¡†æ¶ã€‚èƒ½ä¸‹è½½åˆ°çš„éƒ½æ˜¯ Darknet æ ¼å¼ã€‚å°½ç®¡ <a href="https://github.com/pjreddie/darknet" target="_blank" rel="noopener">Darknet æ˜¯å¼€æºçš„</a>ï¼Œæˆ‘ä¹Ÿä¸æƒ³èŠ±å¾ˆå¤šæ—¶é—´å»å¼„æ¸…å®ƒçš„å·¥ä½œåŸç†ã€‚</p><p>å¹¸è¿çš„æ˜¯ï¼Œ<a href="https://github.com/allanzelener/YAD2K/" target="_blank" rel="noopener">æœ‰äºº</a> å·²ç»åšäº†è¿™ä»¶äº‹ï¼Œå°† Darknet æ¨¡å‹è½¬æ¢æˆäº†æˆ‘æ‰€ä½¿ç”¨çš„æ·±åº¦å­¦ä¹ å·¥å…· Kerasã€‚æˆ‘æ‰€è¦åšçš„ï¼Œå°±æ˜¯è¿è¡Œè¿™ä¸ªâ€œYAD2Kâ€è„šæœ¬ï¼Œå°† Darknet è½¬æ¢æˆ Keras æ ¼å¼ï¼Œç„¶åç”¨æˆ‘è‡ªå·±å†™çš„è„šæœ¬å°† Keras è½¬æ¢æˆ Metalã€‚</p><p>ä½†æ˜¯ï¼Œæœ‰ä¸€ç‚¹å°éº»çƒ¦ã€‚YOLO åœ¨å®ƒçš„å·ç§¯å±‚åï¼Œä½¿ç”¨äº†ä¸€ç§å«åšâ€æ‰¹æ ‡å‡†åŒ–â€œçš„è§„æ•´åŒ–æ–¹æ³•ã€‚</p><p>â€œæ‰¹æ ‡å‡†åŒ–â€çš„æ€æƒ³æ˜¯ï¼Œå½“æ•°æ®æ˜¯å¹²å‡€çš„æ—¶å€™ï¼Œç¥ç»ç½‘ç»œèƒ½å¤Ÿè¾¾åˆ°æœ€å¥½çš„å·¥ä½œæ•ˆæœã€‚ç†æƒ³æƒ…å†µä¸‹ï¼Œä¸€ä¸ªå±‚çº§çš„è¾“å…¥æ•°æ®çš„å¹³å‡å€¼ä¸º 0ï¼Œä¸”æ–¹å·®è¾ƒå°ã€‚æ¯ä¸ªåšè¿‡æœºå™¨å­¦ä¹ çš„äººéƒ½åº”æ¯”è¾ƒç†Ÿæ‚‰è¿™ä¸€æ€æƒ³ï¼Œå› ä¸ºæˆ‘ä»¬ç»å¸¸ä½¿ç”¨ä¸€ç§ç§°ä¸ºâ€œç‰¹å¾ç¼©æ”¾â€æˆ–â€œç™½åŒ–â€çš„æŠ€æœ¯æ¥å¤„ç†æˆ‘ä»¬çš„è¾“å…¥æ•°æ®ï¼Œä»¥è¾¾åˆ°è¿™ä¸€ç›®çš„ã€‚</p><p>æ‰¹æ ‡å‡†åŒ–å¯¹å±‚é—´æ•°æ®åšäº†ç±»ä¼¼ç‰¹å¾ç¼©æ”¾çš„å¤„ç†ã€‚è¿™ç§å¤„ç†èƒ½é˜²æ­¢æ•°æ®åœ¨ç¥ç»ç½‘ç»œä¸­ä¼ é€’æ—¶é€€åŒ–ï¼Œä»è€Œæœ‰æ•ˆæå‡ç¥ç»ç½‘ç»œçš„æ€§èƒ½ã€‚</p><p>ä¸ºäº†è®©ä½ ç›´è§‚æ„Ÿå—åˆ°æ‰¹æ ‡å‡†åŒ–çš„ä½œç”¨ï¼Œä»¥ä¸‹æ˜¯ç¬¬ä¸€ä¸ªå·ç§¯å±‚åˆ†åˆ«åœ¨åº”ç”¨å’Œæœªåº”ç”¨æ‰¹æ ‡å‡†åŒ–çš„æƒ…å†µä¸‹çš„è¾“å‡ºç›´æ–¹å›¾ï¼š</p><p><img src="http://machinethink.net/images/yolo/BatchNorm.png" alt=""></p><p>æ‰¹æ ‡å‡†åŒ–åœ¨è®­ç»ƒä¸€ä¸ªæ·±åº¦ç½‘ç»œæ—¶å¾ˆé‡è¦ï¼Œä½†äº‹å®ä¸Šï¼Œæˆ‘ä»¬åœ¨è¿›è¡Œæ¨æ–­çš„æ—¶å€™å¯ä»¥ä¸éœ€è¦è¿™ä¸€å¤„ç†ã€‚ä¸éœ€è¦è¿›è¡Œæ‰¹æ ‡å‡†åŒ–çš„è®¡ç®—ï¼Œæœ‰åŠ©äºä½¿æˆ‘ä»¬çš„åº”ç”¨è¿è¡Œæ›´å¿«ã€‚åœ¨ä»»ä½•æ—¶å€™ï¼ŒMetal éƒ½æ²¡æœ‰ä¸€ä¸ª <code>MPSCNNBatchNormalization</code> å±‚ã€‚</p><p>æ‰¹æ ‡å‡†åŒ–é€šå¸¸å‘ç”Ÿåœ¨å·ç§¯å±‚ä¹‹åï¼Œæ¿€æ´»å‡½æ•°ï¼ˆYOLO ä¸­çš„ ReLU å‡½æ•°ï¼‰ä¹‹å‰ã€‚å·ç§¯æ“ä½œå’Œæ‰¹æ ‡å‡†åŒ–æ“ä½œéƒ½æ˜¯å¯¹æ•°æ®è¿›è¡Œçº¿æ€§å˜æ¢ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å°†æ‰¹æ ‡å‡†åŒ–å±‚çš„å‚æ•°å’Œå·ç§¯æƒé‡ç›¸ç»“åˆã€‚è¿™ç§°ä¸ºå°†æ‰¹æ ‡å‡†åŒ–å±‚â€œæŠ˜å â€åˆ°å·ç§¯å±‚ã€‚</p><p>é•¿è¯çŸ­è¯´ï¼Œä½¿ç”¨ä¸€äº›æ•°å­¦æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥çœç•¥æ‰¹æ ‡å‡†åŒ–å±‚ï¼Œä½†éœ€è¦æ”¹å˜å‰åºå·ç§¯å±‚çš„æƒé‡ã€‚</p><p>å¿«é€Ÿé˜è¿°ä¸€ä¸‹å·ç§¯å±‚çš„è®¡ç®—è¿‡ç¨‹ï¼šè®¾ <code>x</code> æ˜¯è¾“å…¥å›¾åƒä¸­çš„åƒç´ ï¼Œ<code>w</code> æ˜¯å·ç§¯å±‚æƒé‡ï¼Œé‚£ä¹ˆï¼Œç»è¿‡å·ç§¯å±‚è®¡ç®—ï¼Œè¾“å‡ºçš„æ¯ä¸ªåƒç´ çš„å€¼ä¸ºï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">out[j] = x[i]*w[0] + x[i+1]*w[1] + x[i+2]*w[2] + ... + x[i+k]*w[k] + b</span><br></pre></td></tr></table></figure><p>å³è¾“å…¥åƒç´ çŸ©é˜µå’Œå·ç§¯æ ¸æƒé‡çš„ç‚¹ç§¯ï¼Œå†åŠ ä¸Šåå·®é¡¹ <code>b</code>ã€‚</p><p>ä»¥ä¸‹æ˜¯å¯¹å·ç§¯å±‚è¾“å‡ºè¿›è¡Œæ‰¹æ ‡å‡†åŒ–å¤„ç†çš„è®¡ç®—è¿‡ç¨‹ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">        gamma * (out[j] - mean)</span><br><span class="line">bn[j] = ---------------------- + beta</span><br><span class="line">            sqrt(variance)</span><br></pre></td></tr></table></figure><p>æ‰¹æ ‡å‡†åŒ–é¦–å…ˆå¯¹æ¯ä¸ªåƒç´ çš„è¾“å‡ºå€¼å‡å»å¹³å‡å€¼ <code>mean</code>ï¼Œå†é™¤ä»¥æ ‡å‡†å·®ï¼Œä¹˜ä»¥ä¸€ä¸ªç¼©æ”¾ç³»æ•° <code>gamma</code>ï¼Œå†åŠ ä¸Šä¸€ä¸ªåç§»å€¼ <code>beta</code>ã€‚è¿™å››ä¸ªå‚æ•° â€”â€” <code>mean</code>ï¼Œ<code>variance</code>ï¼Œ<code>gamma</code>ï¼Œ<code>beta</code> â€”â€” æ˜¯åœ¨ç½‘ç»œè®­ç»ƒè¿‡ç¨‹ä¸­ï¼Œæ‰¹æ ‡å‡†åŒ–å±‚å­¦ä¹ å¾—åˆ°çš„ã€‚</p><p>ä¸ºäº†çœç•¥æ‰¹æ ‡å‡†åŒ–ï¼Œæˆ‘ä»¬å¯ä»¥å°†è¿™ä¸¤ä¸ªå…¬å¼è¿›è¡Œç¨å¾®çš„æ•´åˆï¼Œæ¥ä¸ºå·ç§¯å±‚è®¡ç®—æ–°çš„æƒé‡å’Œåå·®é¡¹ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">           gamma * w</span><br><span class="line">w_new = --------------</span><br><span class="line">        sqrt(variance)</span><br><span class="line"></span><br><span class="line">        gamma*(b - mean)</span><br><span class="line">b_new = ---------------- + beta</span><br><span class="line">         sqrt(variance)</span><br></pre></td></tr></table></figure><p>åˆ©ç”¨è¿™äº›æ–°çš„æƒé‡å’Œåå·®é¡¹å¯¹è¾“å…¥ <code>x</code> è¿›è¡Œå·ç§¯æ“ä½œï¼Œèƒ½å¤Ÿå¾—åˆ°ä¸åŸæ¥å·ç§¯å±‚åŠ ä¸Šæ‰¹æ ‡å‡†åŒ–å¤„ç†ååŒæ ·çš„ç»“æœã€‚</p><p>ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥å»æ‰æ‰¹æ ‡å‡†åŒ–å±‚ï¼Œåªä½¿ç”¨å·ç§¯å±‚ï¼Œä½†å‚æ•°æ˜¯ç»è¿‡è°ƒèŠ‚çš„æƒé‡å’Œåå·®é¡¹ <code>w_new</code> å’Œ <code>b_new</code>ã€‚æˆ‘ä»¬å¯¹ç½‘ç»œä¸­æ‰€æœ‰çš„å·ç§¯å±‚éƒ½é‡å¤è¿™ä¸€è¿‡ç¨‹ã€‚</p><blockquote><p>æ³¨æ„ï¼šäº‹å®ä¸Šï¼ŒYOLO ä¸­çš„å·ç§¯å±‚æ²¡æœ‰ä½¿ç”¨åå·®é¡¹ï¼Œå› æ­¤ä¸Šè¿°å…¬å¼ä¸­ b ä¸º 0ã€‚ä½†è¯·æ³¨æ„ï¼Œç»è¿‡æ•´åˆæ‰¹æ ‡å‡†åŒ–çš„å‚æ•°åï¼Œå·ç§¯å±‚å°±æœ‰äº†åå·®é¡¹ã€‚</p></blockquote><p>ä¸€æ—¦æˆ‘ä»¬å°†æ‰€æœ‰çš„æ‰¹æ ‡å‡†åŒ–å±‚æ•´åˆåˆ°äº†å®ƒä»¬çš„å‰åºå·ç§¯å±‚ï¼Œæˆ‘ä»¬å°±å¯ä»¥å°†æƒé‡è½¬æ¢åˆ° Metal äº†ã€‚ç®€å•åœ°å°†è¯¥æ•°ç»„ï¼ˆKeras ä¸­å­˜å‚¨çš„é¡ºåºå’Œ Metal ä¸åŒï¼‰è¿›è¡Œè½¬ç½®ï¼Œå†å°†å…¶å†™è¿› 32 ä½æµ®ç‚¹æ•°çš„äºŒè¿›åˆ¶æ–‡ä»¶ã€‚</p><p>å¦‚æœä½ å¯¹è¿™äº›æ“ä½œæ„Ÿåˆ°å¥½å¥‡ï¼Œä½ å¯ä»¥æŸ¥çœ‹è½¬æ¢è„šæœ¬ <a href="https://github.com/hollance/Forge/blob/master/Examples/YOLO/yolo2metal.py" target="_blank" rel="noopener">yolo2metal.py</a> æ¥è·å¾—è¯¦ç»†ä¿¡æ¯ã€‚ä¸ºäº†éªŒè¯æ•´åˆæ‰¹æ ‡å‡†åŒ–çš„æ•ˆæœï¼Œè„šæœ¬åˆ›å»ºäº†ä¸€ä¸ªä¸åŒ…å«æ‰¹æ ‡å‡†åŒ–å±‚ï¼Œä½†ä½¿ç”¨äº†è°ƒèŠ‚åçš„æƒé‡çš„æ¨¡å‹ï¼Œå¹¶å°†å…¶ä¸åŸå§‹æ¨¡å‹çš„é¢„æµ‹ç»“æœè¿›è¡Œæ¯”å¯¹ã€‚</p><h2 id="iOS-åº”ç”¨"><a href="#iOS-åº”ç”¨" class="headerlink" title="iOS åº”ç”¨"></a>iOS åº”ç”¨</h2><p>æˆ‘ç†æ‰€å½“ç„¶åœ°ä½¿ç”¨ <a href="https://github.com/hollance/Forge" target="_blank" rel="noopener">Forge</a> æ¥ç¼–å†™æˆ‘çš„ iOS åº”ç”¨ã€‚ğŸ˜‚ä½ å¯ä»¥åœ¨ <a href="https://github.com/hollance/Forge/tree/master/Examples/YOLO" target="_blank" rel="noopener">YOLO</a> æ–‡ä»¶å¤¹ä¸­æ‰¾åˆ°æºä»£ç ã€‚å¦‚æœæƒ³å°è¯•ä¸€ä¸‹çš„è¯ï¼Œå¯ä»¥ä¸‹è½½æˆ–è€… clone Forgeï¼Œåœ¨ Xcode 8.3 ä»¥ä¸Šç‰ˆæœ¬ä¸­æ‰“å¼€ <strong>Forge.xcworkspace</strong>ï¼Œåœ¨ iPhone 6 ä»¥ä¸Šè®¾å¤‡ä¸Šè¿è¡Œ <strong>YOLO</strong>ã€‚</p><p>æœ€ç®€å•çš„æµ‹è¯•æ–¹æ³•æ˜¯å°†ä½ çš„ iPhone å¯¹å‡†æŸä¸ª <a href="https://www.youtube.com/watch?v=e_WBuBqS9h8" target="_blank" rel="noopener">YouTube è§†é¢‘</a>ï¼š</p><p><img src="http://machinethink.net/images/yolo/App.png" alt=""></p><p><strong>YOLO.swift</strong> ä¸­æœ‰ä¸€äº›æœ‰è¶£çš„ä»£ç ã€‚é¦–å…ˆï¼Œè¿™é‡Œåˆ›å»ºäº†å·ç§¯ç½‘ç»œï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">let leaky = MPSCNNNeuronReLU(device: device, a: 0.1)</span><br><span class="line"></span><br><span class="line">let input = Input()</span><br><span class="line"></span><br><span class="line">let output = input</span><br><span class="line">         --&gt; Resize(width: 416, height: 416)</span><br><span class="line">         --&gt; Convolution(kernel: (3, 3), channels: 16, padding: true, activation: leaky, name: &quot;conv1&quot;)</span><br><span class="line">         --&gt; MaxPooling(kernel: (2, 2), stride: (2, 2))</span><br><span class="line">         --&gt; Convolution(kernel: (3, 3), channels: 32, padding: true, activation: leaky, name: &quot;conv2&quot;)</span><br><span class="line">         --&gt; MaxPooling(kernel: (2, 2), stride: (2, 2))</span><br><span class="line">         --&gt; ...and so on...</span><br></pre></td></tr></table></figure><p>æ‘„åƒå¤´çš„è¾“å…¥å›¾åƒè¢«è°ƒæ•´ä¸º 416Ã—416 åƒç´ å¤§å°ï¼Œæ¥ç€è¢«è¾“å…¥åˆ°å·ç§¯å±‚å’Œæ± åŒ–å±‚ã€‚è¿™å’Œå…¶ä»–å·ç§¯ç¥ç»ç½‘ç»œçš„æ“ä½œæ˜¯éå¸¸ç±»ä¼¼çš„ã€‚</p><p>çœŸæ­£æœ‰æ„æ€çš„æ˜¯å¯¹è¾“å‡ºçš„æ“ä½œã€‚å›æƒ³ä¸€ä¸‹ï¼Œæˆ‘ä»¬çš„è¾“å‡ºæ˜¯ä¸€ä¸ª 13Ã—13Ã—125 çš„å¼ é‡ï¼šå›¾åƒä¸­æ¯ä¸ªç½‘æ ¼å•å…ƒæœ‰ 125 ä¸ªé€šé“ã€‚è¿™ 125 ä¸ªæ•°å­—åŒ…å«äº†æ£€æµ‹æ¡†çš„æ•°æ®ï¼Œä»¥åŠåˆ†ç±»é¢„æµ‹çš„æ•°æ®ã€‚æˆ‘ä»¬éœ€è¦å°†è¿™äº›æ•°æ®é€šè¿‡æŸäº›æ–¹æ³•è¿›è¡Œæ•´ç†ã€‚è¿™äº›æ˜¯é€šè¿‡ <code>fetchResult()</code> å®ç°çš„ã€‚</p><blockquote><p>æ³¨æ„ï¼šfetchResult() å‡½æ•°åœ¨ CPU ä¸­è¿è¡Œï¼Œè€Œé GPUã€‚è¿™ç§å®ç°æ–¹å¼æ¯”è¾ƒç®€å•ã€‚æœ‰äººè¯´ GPU çš„å¹¶è¡Œæ€§ä¼šå¯¹åµŒå¥—å¾ªç¯çš„è¿è¡Œæ¯”è¾ƒæœ‰åˆ©ã€‚ä¹Ÿè®¸æˆ‘åœ¨å°†æ¥ä¼šé‡æ–°å†™ä¸€ä¸ª GPU çš„ç‰ˆæœ¬ã€‚</p></blockquote><p>ä»¥ä¸‹æ˜¯ <code>fetchResult()</code> çš„å·¥ä½œåŸç†ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">public func fetchResult(inflightIndex: Int) -&gt; NeuralNetworkResult&lt;Prediction&gt; &#123;</span><br><span class="line">  let featuresImage = model.outputImage(inflightIndex: inflightIndex)</span><br><span class="line">  let features = featuresImage.toFloatArray()</span><br></pre></td></tr></table></figure><p>å·ç§¯ç½‘ç»œçš„è¾“å‡ºæ˜¯ä¸€ä¸ª <code>MPSImage</code> æ ¼å¼çš„æ•°æ®ã€‚æˆ‘ä»¬é¦–å…ˆå°†å…¶è½¬æ¢æˆä¸€ä¸ª <code>Float</code> çš„æ•°ç»„ï¼Œå³ <code>features</code>ï¼Œä»¥ä¾¿å¤„ç†ã€‚</p><p><code>fetchResult()</code> çš„ä¸»ä½“éƒ¨åˆ†æ˜¯ä¸€ä¸ªå¤§çš„åµŒå¥—å¾ªç¯ã€‚å®ƒå¯¹æ‰€æœ‰çš„ç½‘æ ¼å•å…ƒä»¥åŠæ¯ä¸ªç½‘æ ¼å•å…ƒçš„ 5 ä¸ªé¢„æµ‹ç»“æœè¿›è¡Œéå†ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">for cy in 0..&lt;13 &#123;</span><br><span class="line">  for cx in 0..&lt;13 &#123;</span><br><span class="line">    for b in 0..&lt;5 &#123;</span><br><span class="line">       . . .</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨æ¯ä¸ªå¾ªç¯ä¸­æˆ‘ä»¬å¯¹ç½‘æ ¼å•å…ƒ <code>(cy, cx)</code> è®¡ç®—å‡ºå…¶æ£€æµ‹æ¡† <code>b</code>ã€‚</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬ä» <code>features</code> æ•°ç»„ä¸­è¯»å–å‡ºæ£€æµ‹æ¡†çš„ xï¼Œyï¼Œå®½ï¼Œé«˜ï¼Œä»¥åŠç½®ä¿¡åº¦ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">let channel = b*(numClasses + 5)</span><br><span class="line">let tx = features[offset(channel, cx, cy)]</span><br><span class="line">let ty = features[offset(channel + 1, cx, cy)]</span><br><span class="line">let tw = features[offset(channel + 2, cx, cy)]</span><br><span class="line">let th = features[offset(channel + 3, cx, cy)]</span><br><span class="line">let tc = features[offset(channel + 4, cx, cy)]</span><br></pre></td></tr></table></figure><p><code>offset()</code> å‡½æ•°çš„ä½œç”¨æ˜¯å¸®åŠ©åœ¨æ•°ç»„ä¸­å¯»æ‰¾è¯»å–æ•°æ®çš„åˆé€‚ä½ç½®ã€‚Metal å°†å…¶æ•°æ®ä»¥æ¯ 4 ä¸ªé€šé“ä¸ºä¸€ç»„è¿›è¡Œå­˜å‚¨ï¼Œè¿™æ„å‘³ç€è¿™ 125 ä¸ªé€šé“çš„æ•°æ®å¹¶ä¸æ˜¯è¿ç»­å­˜å‚¨çš„ï¼Œè€Œæ˜¯åˆ†æ•£çš„ã€‚ï¼ˆè¯·æŸ¥é˜…ä»£ç ä»¥è·å¾—æ›´è¯¦å°½çš„è§£é‡Šï¼‰</p><p>æˆ‘ä»¬ä»ç„¶éœ€è¦å¯¹è¿™ 5 ä¸ªæ•°æ® <code>tx</code>ï¼Œ<code>ty</code>ï¼Œ<code>tw</code>ï¼Œ<code>th</code>ï¼Œ<code>tc</code> è¿›è¡Œå¤„ç†ï¼Œå› ä¸ºå®ƒä»¬çš„æ ¼å¼æœ‰ä¸€ç‚¹å¥‡æ€ªã€‚å¦‚æœä½ å¥½å¥‡è¿™äº›å…¬å¼æ˜¯ä»å“ªé‡Œæ¥çš„ï¼Œå®ƒä»¬æ˜¯åœ¨ <a href="https://arxiv.org/abs/1612.08242" target="_blank" rel="noopener">è¿™ç¯‡æ–‡ç« </a> ä¸­æå‡ºçš„ï¼ˆè¿™æ˜¯ç½‘ç»œè®­ç»ƒçš„å‰¯äº§ç‰©ï¼‰ã€‚</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">let x = (Float(cx) + Math.sigmoid(tx)) * 32</span><br><span class="line">let y = (Float(cy) + Math.sigmoid(ty)) * 32</span><br><span class="line"></span><br><span class="line">let w = exp(tw) * anchors[2*b    ] * 32</span><br><span class="line">let h = exp(th) * anchors[2*b + 1] * 32</span><br><span class="line"></span><br><span class="line">let confidence = Math.sigmoid(tc)</span><br></pre></td></tr></table></figure><p>ç°åœ¨ï¼Œ<code>x</code> å’Œ <code>y</code> ä»£è¡¨åœ¨ 416Ã—416 å¤§å°çš„è¾“å…¥å›¾åƒä¸­ï¼Œæ£€æµ‹æ¡†çš„ä¸­å¿ƒç‚¹çš„åæ ‡ã€‚<code>w</code> å’Œ <code>h</code> æ˜¯æ£€æµ‹æ¡†çš„å®½å’Œé«˜ã€‚<code>tc</code> æ˜¯æ£€æµ‹æ¡†çš„ç½®ä¿¡åº¦ï¼Œæˆ‘ä»¬ç”¨ logistic sigmoid å‡½æ•°å°†å…¶è½¬æ¢æˆç™¾åˆ†åˆ¶çš„å½¢å¼ã€‚</p><p>æˆ‘ä»¬ç°åœ¨æœ‰äº†æ£€æµ‹æ¡†ï¼Œå¹¶ä¸”æˆ‘ä»¬çŸ¥é“ YOLO æœ‰å¤šç¡®ä¿¡å…¶ä¸­åŒ…å«äº†æŸä¸ªç›®æ ‡ã€‚ä¸‹ä¸€æ­¥ï¼Œè®©æˆ‘ä»¬çœ‹ä¸€ä¸‹åˆ†ç±»é¢„æµ‹çš„ç»“æœï¼Œçœ‹çœ‹ YOLO è®¤ä¸ºæ£€æµ‹æ¡†ä¸­çš„ç›®æ ‡æ˜¯ä»€ä¹ˆç‰©ä½“ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">var classes = [Float](repeating: 0, count: numClasses)</span><br><span class="line">for c in 0..&lt;numClasses &#123;</span><br><span class="line">  classes[c] = features[offset(channel + 5 + c, cx, cy)]</span><br><span class="line">&#125;</span><br><span class="line">classes = Math.softmax(classes)</span><br><span class="line"></span><br><span class="line">let (detectedClass, bestClassScore) = classes.argmax()</span><br></pre></td></tr></table></figure><p>å›æƒ³ä¸€ä¸‹ï¼Œ<code>features</code> æ•°ç»„ä¸­çš„ 20 ä¸ªé€šé“çš„æ•°æ®åŒ…å«äº†è¯¥æ£€æµ‹æ¡†çš„åˆ†ç±»æ£€æµ‹ç»“æœã€‚æˆ‘ä»¬å°†è¿™äº›è¯»å–åˆ°ä¸€ä¸ªæ–°çš„ <code>classes</code> æ•°ç»„ä¸­ã€‚åƒåˆ†ç±»å™¨çš„ä¸€èˆ¬åšæ³•ä¸€æ ·ï¼Œæˆ‘ä»¬é‡‡ç”¨ softmax å‡½æ•°æ¥å°†æ•°ç»„è½¬æ¢æˆä¸€ä¸ªæ¦‚ç‡åˆ†å¸ƒã€‚ç„¶åï¼Œæˆ‘ä»¬æŒ‘é€‰åˆ†æ•°æœ€é«˜çš„åˆ†ç±»ä½œä¸ºç»“æœã€‚</p><p>ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹æ£€æµ‹æ¡†è®¡ç®—æœ€ç»ˆå¾—åˆ†äº† â€”â€” ä¾‹å¦‚ï¼Œâ€œæˆ‘æœ‰ 85% çš„ç¡®ä¿¡åº¦ç›¸ä¿¡è¿™ä¸ªæ£€æµ‹æ¡†åŒ…å«äº†ä¸€åªç‹—â€ã€‚ä¸€å…±ä¼šæœ‰ 845 ä¸ªæ£€æµ‹æ¡†ï¼Œè€Œæˆ‘ä»¬åªæƒ³ä¿ç•™æœ€ç»ˆå¾—åˆ†è¶…è¿‡æŸä¸€é˜ˆå€¼çš„é‚£äº›ã€‚</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">let confidenceInClass = bestClassScore * confidence</span><br><span class="line">if confidenceInClass &gt; 0.3 &#123;</span><br><span class="line">  let rect = CGRect(x: CGFloat(x - w/2), y: CGFloat(y - h/2),</span><br><span class="line">                    width: CGFloat(w), height: CGFloat(h))</span><br><span class="line"></span><br><span class="line">  let prediction = Prediction(classIndex: detectedClass,</span><br><span class="line">                              score: confidenceInClass,</span><br><span class="line">                              rect: rect)</span><br><span class="line">  predictions.append(prediction)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯¹æ‰€æœ‰ç½‘æ ¼å•å…ƒé‡å¤ä¸Šè¿°ä»£ç ã€‚å½“å¾ªç¯ç»“æŸåï¼Œæˆ‘ä»¬å°±æœ‰äº†ä¸€ä¸ª <code>predictions</code> æ•°ç»„ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œå…¶ä¸­ä¼šåŒ…å« 10 åˆ° 20 ä¸ªé¢„æµ‹ç»“æœã€‚</p><p>æˆ‘ä»¬å·²ç»è¿‡æ»¤æ‰äº†é‚£äº›æœ€ç»ˆå¾—åˆ†éå¸¸ä½çš„æ£€æµ‹æ¡†ï¼Œä½†å‰©ä¸‹çš„æ£€æµ‹æ¡†ä¸­ï¼Œä»ç„¶å¯èƒ½ä¼šå­˜åœ¨ç›¸äº’é‡å ç‰¹åˆ«ä¸¥é‡çš„æƒ…å†µã€‚å› æ­¤ï¼Œæˆ‘ä»¬åœ¨ <code>fetchResult()</code> ä¸­åšçš„æœ€åä¸€ä»¶äº‹å°±æ˜¯ç”¨ä¸€ç§ç§°ä¸º<em>éæå¤§å€¼æŠ‘åˆ¶</em>çš„æ–¹æ³•æ¥å‡å°‘è¿™ç§é‡å¤çš„æ£€æµ‹æ¡†ã€‚</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">  var result = NeuralNetworkResult&lt;Prediction&gt;()</span><br><span class="line">  result.predictions = nonMaxSuppression(boxes: predictions,</span><br><span class="line">                                         limit: 10, threshold: 0.5)</span><br><span class="line">  return result</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>nonMaxSuppression()</code> å‡½æ•°æ‰€ä½¿ç”¨çš„ç®—æ³•å¾ˆç®€å•ï¼š</p><ol><li>ä»æœ€ç»ˆå¾—åˆ†æœ€é«˜çš„é‚£ä¸ªæ£€æµ‹æ¡†å¼€å§‹ã€‚</li><li>å°†å…¶ä»–ä¸è¯¥æ£€æµ‹æ¡†é‡å ç‡è¶…è¿‡ä¸€å®šé˜ˆå€¼ï¼ˆæ¯”å¦‚è¶…è¿‡ 50%ï¼‰çš„æ£€æµ‹æ¡†ç§»é™¤ã€‚</li><li>è¿”å›ç¬¬ä¸€æ­¥ï¼Œé‡å¤ç›´åˆ°éå†å®Œæ‰€æœ‰çš„æ£€æµ‹æ¡†ã€‚</li></ol><p>è¯¥ç®—æ³•ç§»é™¤äº†ä¸æ›´é«˜å¾—åˆ†çš„æ£€æµ‹æ¡†æœ‰å¤ªå¤šé‡å çš„å…¶ä»–æ£€æµ‹æ¡†ï¼Œåªä¿ç•™äº†æœ€å¥½çš„é‚£äº›ã€‚</p><p>ä»¥ä¸Šå°±æ˜¯æ‰€æœ‰çš„è¿‡ç¨‹äº†ï¼šä¸€ä¸ªå¸¸è§„çš„å·ç§¯ç½‘ç»œï¼Œä»¥åŠåç»­å¯¹ç»“æœçš„ä¸€äº›å¤„ç†ã€‚</p><h2 id="è¿è¡Œæ•ˆæœå¦‚ä½•ï¼Ÿ"><a href="#è¿è¡Œæ•ˆæœå¦‚ä½•ï¼Ÿ" class="headerlink" title="è¿è¡Œæ•ˆæœå¦‚ä½•ï¼Ÿ"></a>è¿è¡Œæ•ˆæœå¦‚ä½•ï¼Ÿ</h2><p><a href="https://pjreddie.com/darknet/yolo/" target="_blank" rel="noopener">YOLO å®˜æ–¹ç½‘ç«™</a> å®£ç§°ç²¾ç®€ç‰ˆ YOLO æœ€å¿«æ¯ç§’å¯å¤„ç† 200 å¸§å›¾åƒã€‚ä½†é‚£æ˜¯åœ¨æ€§èƒ½ä¼˜ç§€çš„ç¬”è®°æœ¬ä¸Šçš„è¿è¡Œç»“æœï¼Œè€Œä¸æ˜¯åœ¨ç§»åŠ¨è®¾å¤‡ä¸Šã€‚é‚£ä¹ˆï¼Œå®ƒåœ¨ iPhone ä¸Šèƒ½å¤Ÿè¿è¡Œå¤šå¿«å‘¢ï¼Ÿ</p><p>åœ¨æˆ‘çš„ iPhone 6s ä¸Šï¼Œå®ƒå¤„ç†ä¸€å¹…å›¾åƒå¤§çº¦éœ€è¦ 0.15 ç§’ã€‚é‚£ä¹Ÿåªæœ‰ 6 FPSï¼Œå‡ ä¹ä¸èƒ½ç§°ä¹‹ä¸ºå®æ—¶ã€‚å¦‚æœä½ å°†æ‰‹æœºå¯¹å‡†ä¸€è¾†å¼€è¿‡çš„æ±½è½¦ï¼Œä½ ä¼šçœ‹åˆ°ä¸€ä¸ªæ£€æµ‹æ¡†æ‹–åœ¨æ±½è½¦åé¢ä¸€äº›ã€‚å°½ç®¡å¦‚æ­¤ï¼Œå®ƒèƒ½å¤Ÿç”Ÿæ•ˆå·²ç»ä½¿æˆ‘å°è±¡æ·±åˆ»äº†ã€‚ğŸ˜</p><blockquote><p>æ³¨æ„ï¼šæ­£å¦‚ä¸Šæ–‡è§£é‡Šï¼Œæ£€æµ‹æ¡†çš„å¤„ç†æ˜¯åœ¨ CPU ä¸Šè¿›è¡Œï¼Œè€Œä¸æ˜¯ GPUã€‚å¦‚æœ YOLO å®Œå…¨è¿è¡Œåœ¨ GPU ä¸Šï¼Œä¼šå˜å¾—æ›´å¿«å—ï¼Ÿä¹Ÿè®¸ä¼šï¼Œä½† CPU ä»£ç è¿è¡Œæ—¶é—´åªæœ‰ 0.03 ç§’ï¼Œå  20% çš„è¿è¡Œæ—¶é—´ã€‚å°†å…¶ä¸­ä¸€éƒ¨åˆ†å·¥ä½œäº¤ç»™ GPU åšå½“ç„¶æ˜¯å¯è¡Œçš„ï¼Œä½†è€ƒè™‘åˆ°å·ç§¯å±‚çš„è®¡ç®—ä»ç„¶å æ®äº† 80% çš„æ—¶é—´ï¼Œæˆ‘ä¸ç¡®å®šæ˜¯å¦å€¼å¾—è¿™æ ·åšã€‚</p></blockquote><p>æˆ‘è®¤ä¸ºå¯¼è‡´å˜æ…¢çš„ä¸»è¦åŸå› åœ¨äºè¾“å‡ºé€šé“ä¸º 512 å’Œ 1024 å·ç§¯å±‚ã€‚ç»è¿‡å®éªŒï¼Œ<code>MPSCNNConvolution</code> åœ¨é€šé“è¾ƒå¤šçš„å°å›¾ç‰‡ä¸Šçš„è¡¨ç°æ¯”åœ¨é€šé“è¾ƒå°‘çš„å¤§å›¾ç‰‡ä¸Šä¼šæ›´å·®ã€‚</p><p>å¦ä¸€ä»¶æˆ‘æ¯”è¾ƒæ„Ÿå…´è¶£çš„äº‹æƒ…æ˜¯é‡‡ç”¨å¦ä¸€ç§ä¸åŒçš„ç½‘ç»œç»“æ„ï¼Œä¾‹å¦‚ SqueezeNetï¼Œå¯¹å…¶é‡æ–°è¿›è¡Œè®­ç»ƒï¼Œä»¥åœ¨æœ€åä¸€å±‚è¿›è¡Œæ£€æµ‹æ¡†çš„é¢„æµ‹ã€‚æ¢å¥è¯è¯´ï¼Œé‡‡ç”¨ YOLO çš„æ€æƒ³ï¼Œå¹¶å°†å…¶åº”ç”¨åœ¨ä¸€ä¸ªæ›´å°æ›´å¿«çš„ç½‘ç»œä¸Šã€‚è¿™æ ·ä»¥ç²¾ç¡®åº¦çš„æŸå¤±æ¢æ¥é€Ÿåº¦ä¸Šçš„æå‡æ˜¯å¦å€¼å¾—å‘¢ï¼Ÿ</p><blockquote><p>æ³¨æ„ï¼šé¡ºä¾¿è¯´ä¸€å¥ï¼Œæœ€è¿‘çš„ <a href="http://caffe2.ai/" target="_blank" rel="noopener">Caffe2</a> æ¡†æ¶ä¹Ÿæ˜¯é€šè¿‡ Metal çš„æ”¯æŒï¼Œè¿è¡Œåœ¨ iOS è®¾å¤‡ä¸Šã€‚<a href="https://github.com/KleinYuan/Caffe2-iOS" target="_blank" rel="noopener">Caffe2-iOS project</a> æ˜¯ä¸€ä¸ªé’ˆå¯¹ YOLO çš„ç²¾ç®€ç‰ˆæœ¬ã€‚çœ‹èµ·æ¥å®ƒè¿è¡Œå¾—ä¼šæ¯”çº¯ Metal ç‰ˆç¨æ…¢ï¼Œå¤§çº¦ 0.17 ç§’/å¸§ã€‚</p></blockquote><h2 id="åè®°"><a href="#åè®°" class="headerlink" title="åè®°"></a>åè®°</h2><p>æƒ³è¦äº†è§£æ›´å¤š YOLO ç›¸å…³çš„çŸ¥è¯†ï¼Œå¯ä»¥æŸ¥çœ‹ YOLO ä½œè€…çš„ä»¥ä¸‹è®ºæ–‡ï¼š</p><ul><li><a href="https://arxiv.org/abs/1506.02640" target="_blank" rel="noopener">You Only Look Once: Unified, Real-Time Object Detection</a> by Joseph Redmon, Santosh Divvala, Ross Girshick, Ali Farhadi (2015)</li><li><a href="https://arxiv.org/abs/1612.08242" target="_blank" rel="noopener">YOLO9000: Better, Faster, Stronger</a> by Joseph Redmon and Ali Farhadi (2016)</li></ul><p>æˆ‘çš„å®ç°ä¸€éƒ¨åˆ†åŸºäº TensorFlow Android demo <a href="https://github.com/tensorflow/tensorflow/tree/master/tensorflow/examples/android" target="_blank" rel="noopener">TF Detect</a>ï¼ŒAllan Zelener çš„ <a href="https://github.com/allanzelener/YAD2K/" target="_blank" rel="noopener">YAD2K</a>ï¼Œä»¥åŠ <a href="https://github.com/pjreddie/darknet" target="_blank" rel="noopener">Darknet æºä»£ç </a>ã€‚</p><blockquote><p>æœ¬æ–‡ç”± SwiftGG ç¿»è¯‘ç»„ç¿»è¯‘ï¼Œå·²ç»è·å¾—ä½œè€…ç¿»è¯‘æˆæƒï¼Œæœ€æ–°æ–‡ç« è¯·è®¿é—® <a href="http://swift.gg">http://swift.gg</a>ã€‚</p></blockquote>]]></content>
    
    <summary type="html">
    
      æœ¬æ–‡è¯¦ç»†ä»‹ç»äº†ä½¿ç”¨ YOLO è¿›è¡Œå®æ—¶ç›®æ ‡æ£€æµ‹çš„åŸç†ï¼Œä»¥åŠåœ¨ iOS ä¸Šçš„åº”ç”¨ã€‚
    
    </summary>
    
      <category term="machinethink" scheme="https://swift.gg/categories/machinethink/"/>
    
    
      <category term="æœºå™¨å­¦ä¹ " scheme="https://swift.gg/tags/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/"/>
    
  </entry>
  
  <entry>
    <title>macOS Dynamic Desktop</title>
    <link href="https://swift.gg/2018/10/25/macos-dynamic-desktop/"/>
    <id>https://swift.gg/2018/10/25/macos-dynamic-desktop/</id>
    <published>2018-10-25T00:00:00.000Z</published>
    <updated>2019-02-19T03:45:13.515Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ä½œè€…ï¼šMatttï¼Œ<a href="https://nshipster.com/macos-dynamic-desktop/" target="_blank" rel="noopener">åŸæ–‡é“¾æ¥</a>ï¼ŒåŸæ–‡æ—¥æœŸï¼š2018-10-01<br>è¯‘è€…ï¼š<a href="http://www.saitjr.com" target="_blank" rel="noopener">saitjr</a>ï¼›æ ¡å¯¹ï¼š<a href="http://www.desgard.com/" target="_blank" rel="noopener">å†¬ç“œ</a>ï¼Œ<a href="http://blog.yousanflics.com.cn" target="_blank" rel="noopener">Yousanflics</a>ï¼›å®šç¨¿ï¼š<a href="http://forelax.space" target="_blank" rel="noopener">Forelax</a></p></blockquote><!--æ­¤å¤„å¼€å§‹æ­£æ–‡--><p>Dark Modeï¼ˆæ·±è‰²æ¨¡å¼ï¼‰å¯è°“æ˜¯ macOS æœ€å—æ¬¢è¿çš„ç‰¹æ€§ä¹‹ä¸€äº† â€”â€” å°¤å…¶æ˜¯å¯¹äºä½ æˆ‘è¿™æ ·çš„å¼€å‘è€…æ¥è¯´ã€‚æˆ‘ä»¬ä¸ä»…å–œæ¬¢æ–‡æœ¬ç¼–è¾‘å™¨æ˜¯æš—è‰²çš„ä¸»é¢˜ï¼Œè¿˜å¾ˆçœ‹ä¸­æ•´ä¸ªç³»ç»Ÿè‰²è°ƒçš„ä¸€è‡´æ€§ã€‚</p><p>è¿‡å»å‡ å¹´ï¼Œå’Œè¿™ä¸ªç‰¹æ€§æ——é¼“ç›¸å½“çš„è¦æ•° Night Shiftï¼ˆå¤œè§ˆï¼‰ï¼Œå®ƒä¸»è¦æ˜¯åœ¨æ—¥å¤œæ›´æ›¿çš„æ—¶å€™å‡å°‘å¯¹çœ¼ç›çš„åŠ³æŸã€‚</p><p>çºµè§‚è¿™ä¸¤ä¸ªåŠŸèƒ½ï¼ŒDynamic Desktopï¼ˆåŠ¨æ€æ¡Œé¢ï¼‰ä¹Ÿå°±å‘¼ä¹‹æ¬²å‡ºäº†ï¼Œå½“ç„¶è¿™ä¹Ÿæ˜¯ Mojave çš„æ–°ç‰¹æ€§ä¹‹ä¸€ã€‚è¿›å…¥â€œç³»ç»Ÿåå¥½è®¾ç½® &gt; æ¡Œé¢ä¸å±å¹•ä¿æŠ¤ç¨‹åºâ€ å¹¶ä¸”é€‰æ‹©â€œåŠ¨æ€â€ï¼Œå°±èƒ½å¾—åˆ°ä¸€ä¸ªåŸºäºåœ°ç†ä½ç½®ä¸”å…¨å¤©å€™åŠ¨æ€å˜åŒ–çš„å£çº¸ã€‚</p><a id="more"></a><p><img src="/img/articles/macos-dynamic-desktop/desktop-and-screen-saver-preference-pane-b457c3a4bc26017c8d555506333d5b73244adaf8b7060f0cadd450f39b279c88.png1540446627.765852" alt=""></p><p>æ•ˆæœä¸ä»…å¾®å¦™ï¼Œè€Œä¸”è®©äººæ„‰æ‚¦ã€‚æ¡Œé¢ä»¿ä½›è¢«èµ‹äºˆäº†ç”Ÿå‘½ï¼Œèƒ½éšç€æ—¶é—´çš„æ¨ç§»è€Œå˜åŒ–ï¼›ç¬¦åˆè‡ªç„¶è§„å¾‹ã€‚ï¼ˆä¸å‡ºæ„å¤–çš„è¯ï¼Œç»“åˆ dark mode çš„åˆ‡æ¢ï¼Œè¿˜ä¼šæœ‰è®¨å–œçš„ç‰¹æ•ˆï¼‰</p><p><em>è¿™åˆ°åº•æ˜¯å¦‚ä½•å®ç°çš„å‘¢ï¼Ÿ</em><br><br>è¿™ä¾¿æ˜¯æœ¬å‘¨ NSHipster è®¨è®ºçš„é—®é¢˜ã€‚</p><p>ç­”æ¡ˆä¼šæ·±å…¥æ¢ç©¶å›¾ç‰‡æ ¼å¼ï¼ŒåŒæ—¶æ¶‰åŠä¸€äº›é€†å‘å·¥ç¨‹ä»¥åŠçƒé¢ä¸‰è§’å­¦ç›¸å…³çš„å†…å®¹ã€‚</p><p><br></p><hr><p><br></p><p>ç†è§£ Dynamic Desktop ç¬¬ä¸€æ­¥ï¼Œå°±æ˜¯è¦æ‰¾åˆ°è¿™äº›åŠ¨æ€å›¾ç‰‡ã€‚</p><p>åœ¨ macOS Mojave ç³»ç»Ÿä¸‹ï¼Œæ‰“å¼€è®¿è¾¾ï¼Œé€‰æ‹©â€œå‰å¾€ &gt; å‰å¾€æ–‡ä»¶å¤¹â€¦â€ ï¼ˆâ‡§âŒ˜Gï¼‰ï¼Œè¾“å…¥â€œ/Library/Desktop Pictures/â€ã€‚</p><p><img src="/img/articles/macos-dynamic-desktop/go-to-library-desktop-pictures-3992f8efa1d14dd3bf092ec7eb298c6c1855dcc8e0cf57c0e494a840a8cb4713.png1540446628.0454302" alt=""></p><p>åœ¨è¿™ä¸ªç›®å½•ä¸‹ï¼Œå¯ä»¥æ‰¾åˆ°åä¸ºâ€œMojave.heicâ€çš„æ–‡ä»¶ã€‚åŒå‡»é€šè¿‡é¢„è§ˆæ‰“å¼€ã€‚</p><p><img src="/img/articles/macos-dynamic-desktop/mojave-heic-abd6b67d8941ad50a9bcd7dd6657994174d4be713bb3c2cfbc9e24ffff7ad129.png1540446628.1945882" alt=""></p><p>åœ¨é¢„è§ˆä¸­ï¼Œå·¦è¾¹æ ä¼šæ˜¾ç¤ºä» 1~16 çš„ç¼©ç•¥å›¾ï¼Œæ¯å¼ éƒ½æ˜¯ä¸åŒçŠ¶æ€çš„æ²™æ¼ å›¾ã€‚</p><p><img src="/img/articles/macos-dynamic-desktop/mojave-dynamic-desktop-images-c8bc3aab78c049d74abd46240445f82c3d0cf0ad043bcc9da6f3fda066776034.png1540446628.454165" alt=""></p><p>å¦‚æœé€‰æ‹©â€œå·¥å…· &gt; æ˜¾ç¤ºæ£€æŸ¥å™¨â€ï¼ˆâŒ˜Iï¼‰ï¼Œå¯ä»¥çœ‹åˆ°æ›´ä¸ºè¯¦ç»†çš„ä¿¡æ¯ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="/img/articles/macos-dynamic-desktop/mojave-heic-preview-info-b71c5e4084bd43f1e6b34852c4c757493627eb8b66ee44b282e2f53d274dda02.png1540446628.7528405" alt=""></p><p>ä¸å¹¸çš„æ˜¯ï¼Œè¿™äº›å°±æ˜¯é¢„è§ˆæ‰€å±•ç¤ºçš„å…¨éƒ¨ä¿¡æ¯äº†ï¼ˆæˆªè‡³å‘ç¨¿å‰ï¼‰ã€‚å³ä½¿ç‚¹å‡»æ—è¾¹çš„â€œæ›´å¤šä¿¡æ¯æ£€æŸ¥å™¨â€ï¼Œæˆ‘ä»¬ä¹Ÿåªæ˜¯èƒ½å¾—åˆ°ä¸‹é¢è¿™ä¸ªè¡¨æ ¼ï¼Œå…¶ä½™çš„æ— ä»å¾—çŸ¥ï¼š</p><table><thead><tr><th>Color Model</th><th>RGB</th></tr></thead><tbody><tr><td>Depth:</td><td>8</td></tr><tr><td>Pixel Height</td><td>2,880</td></tr><tr><td>Pixel Width</td><td>5,120</td></tr><tr><td>Profile Name</td><td>Display P3</td></tr></tbody></table><blockquote><p>åç¼€ <code>.heic</code> è¡¨ç¤ºå›¾ç‰‡å®¹å™¨é‡‡ç”¨ HFIFï¼ˆHigh-Efficiency Image File Formatï¼‰ç¼–ç ï¼Œå³é«˜æ•ˆç‡å›¾æ¡£æ ¼å¼ï¼ˆè¿™ç§æ ¼å¼åŸºäº <strong>HEVC</strong>ï¼ˆHigh-Efficiency Video Compressionï¼‰ï¼Œå³é«˜æ•ˆç‡è§†é¢‘å‹ç¼©ï¼Œä¹Ÿå°±æ˜¯ H.265ï¼‰ã€‚æ›´å¤šä¿¡æ¯ï¼Œå¯ä»¥å‚è€ƒ <a href="https://developer.apple.com/videos/play/wwdc2017/503/" target="_blank" rel="noopener">WWDC 2017 Session 503 â€œIntroducing HEIF and HEVCâ€</a></p></blockquote><p>æƒ³è¦è·å¾—æ›´å¤šçš„æ•°æ®ï¼Œæˆ‘ä»¬è¿˜éœ€è¦è„šè¸å®åœ°ï¼ŒçœŸçœŸåˆ‡åˆ‡çš„æ·±å…¥åº•å±‚ APIã€‚</p><h2 id="åˆ©ç”¨-CoreGraphics-ä¸€æ¢ç©¶ç«Ÿ"><a href="#åˆ©ç”¨-CoreGraphics-ä¸€æ¢ç©¶ç«Ÿ" class="headerlink" title="åˆ©ç”¨ CoreGraphics ä¸€æ¢ç©¶ç«Ÿ"></a>åˆ©ç”¨ CoreGraphics ä¸€æ¢ç©¶ç«Ÿ</h2><p>ç¬¬ä¸€æ­¥å…ˆåˆ›å»º Xcode Playgroundã€‚ç®€å•èµ·è§ï¼Œæˆ‘ä»¬å°†â€œMojave.heicâ€æ–‡ä»¶è·¯å¾„ç¡¬ç¼–ç åˆ°ä»£ç ä¸­ã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Foundation</span><br><span class="line"><span class="keyword">import</span> CoreGraphics</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç³»ç»Ÿç‰ˆæœ¬è¦æ±‚ macOS 10.14 Mojave</span></span><br><span class="line"><span class="keyword">let</span> url = <span class="type">URL</span>(fileURLWithPath: <span class="string">"/Library/Desktop Pictures/Mojave.heic"</span>)</span><br></pre></td></tr></table></figure><p>ç„¶åï¼Œåˆ›å»º <code>CGImageSource</code>ï¼Œæ‹·è´å…ƒæ•°æ®å¹¶éå†å…¨éƒ¨æ ‡ç­¾ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> source = <span class="type">CGImageSourceCreateWithURL</span>(url <span class="keyword">as</span> <span class="type">CFURL</span>, <span class="literal">nil</span>)!</span><br><span class="line"><span class="keyword">let</span> metadata = <span class="type">CGImageSourceCopyMetadataAtIndex</span>(source, <span class="number">0</span>, <span class="literal">nil</span>)!</span><br><span class="line"><span class="keyword">let</span> tags = <span class="type">CGImageMetadataCopyTags</span>(metadata) <span class="keyword">as</span>! [<span class="type">CGImageMetadataTag</span>]</span><br><span class="line"><span class="keyword">for</span> tag <span class="keyword">in</span> tags &#123;</span><br><span class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> name = <span class="type">CGImageMetadataTagCopyName</span>(tag),</span><br><span class="line">        <span class="keyword">let</span> value = <span class="type">CGImageMetadataTagCopyValue</span>(tag)</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(name, value)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿è¡Œè¿™æ®µä»£ç ï¼Œä¼šå¾—åˆ°ä¸¤ä¸ªå€¼ï¼šä¸€ä¸ªæ˜¯ <code>hasXMP</code>ï¼Œå€¼ä¸º <code>&quot;True&quot;</code>ï¼Œå¦ä¸€ä¸ªæ˜¯ <code>solar</code>ï¼Œå®ƒçš„å€¼æ˜¯ä¸€ä¸²çœ‹ä¸å¤§æ‡‚çš„æ•°æ®ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">YnBsaXN0MDDRAQJSc2mvEBADDBAUGBwgJCgsMDQ4PEFF1AQFBgcICQoLUWlRelFh</span><br><span class="line">UW8QACNAcO7vOubr3yO/1e+pmkOtXBAB1AQFBgcNDg8LEAEjQFRxqCKOFiAjwCR6</span><br><span class="line">waUkDgHUBAUGBxESEwsQAiNAVZV4BI4c+CPAEP2uFrMcrdQEBQYHFRYXCxADI0BW</span><br><span class="line">tALKmrjwIz/2ObLnx6l21AQFBgcZGhsLEAQjQFfTrJlEjnwjQByrLle1Q0rUBAUG</span><br><span class="line">Bx0eHwsQBSNAWPrrmI0ISCNAKiwhpSRpc9QEBQYHISIjCxAGI0BgJff9KDpyI0BE</span><br><span class="line">NTOsilht1AQFBgclJicLEAcjQGbHdYIVQKojQEq3fAg86lXUBAUGBykqKwsQCCNA</span><br><span class="line">bTGmpC2YRiNAQ2WFOZGjntQEBQYHLS4vCxAJI0BwXfII2B+SI0AmLcjfuC7g1AQF</span><br><span class="line">BgcxMjMLEAojQHCnF6YrsxcjQBS9AVBLTq3UBAUGBzU2NwsQCyNAcTcSnimmjCPA</span><br><span class="line">GP5E0ASXJtQEBQYHOTo7CxAMI0BxgSADjxK2I8AoalieOTyE1AQFBgc9Pj9AEA0j</span><br><span class="line">QHNWsnnMcWIjwEO+oq1pXr8QANQEBQYHQkNEQBAOI0ABZpkFpAcAI8BKYGg/VvMf</span><br><span class="line">1AQFBgdGR0hAEA8jQErBKblRzPgjwEMGElBIUO0ACAALAA4AIQAqACwALgAwADIA</span><br><span class="line">NAA9AEYASABRAFMAXABlAG4AcAB5AIIAiwCNAJYAnwCoAKoAswC8AMUAxwDQANkA</span><br><span class="line">4gDkAO0A9gD/AQEBCgETARwBHgEnATABOQE7AUQBTQFWAVgBYQFqAXMBdQF+AYcB</span><br><span class="line">kAGSAZsBpAGtAa8BuAHBAcMBzAHOAdcB4AHpAesB9AAAAAAAAAIBAAAAAAAAAEkA</span><br><span class="line">AAAAAAAAAAAAAAAAAAH9</span><br></pre></td></tr></table></figure><h3 id="å¤ªé˜³ä¹‹å…‰"><a href="#å¤ªé˜³ä¹‹å…‰" class="headerlink" title="å¤ªé˜³ä¹‹å…‰"></a>å¤ªé˜³ä¹‹å…‰</h3><p>å¤§å¤šæ•°äººçœ‹åˆ°è¿™ä¸²æ–‡å­—ï¼Œå°±ä¼šé»˜é»˜åˆä¸Š MacBook Proï¼Œå¤§å‘¼å‘Šè¾ã€‚ä½†ä¸€å®šæœ‰äººå‘ç°ï¼Œè¿™ä¸²æ–‡å­—éå¸¸åƒ <a href="https://en.wikipedia.org/wiki/Base64" target="_blank" rel="noopener">Base64 ç¼–ç </a> çš„æ°ä½œã€‚</p><p>è®©æˆ‘ä»¬æ¥éªŒè¯ä¸€ä¸‹è¿™ä¸ªå‡è®¾ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> name == <span class="string">"solar"</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> data = <span class="type">Data</span>(base64Encoded: value)!</span><br><span class="line">    <span class="built_in">print</span>(<span class="type">String</span>(data: data, encoding: .ascii))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br><br><samp>              bplist00Ã’\u{01}\u{02}\u{03}â€¦</samp><br><br><br>è¿™åˆæ˜¯ä»€ä¹ˆï¼Ÿ<code>bplist</code> åé¢æ¥äº†ä¸€ä¸²ä¹±ç ï¼Ÿ</p><p>å¤©å“ªï¼ŒåŸæ¥è¿™æ˜¯ <a href="https://en.wikipedia.org/wiki/Property_list" target="_blank" rel="noopener">äºŒè¿›åˆ¶å±æ€§åˆ—è¡¨</a> çš„ <a href="https://en.wikipedia.org/wiki/File_format#Magic_number" target="_blank" rel="noopener">æ–‡ä»¶ç­¾å</a>ã€‚</p><p>åˆ©ç”¨ <code>PropertyListSerialization</code> æ¥çœ‹çœ‹å‘¢â€¦</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> name == <span class="string">"solar"</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> data = <span class="type">Data</span>(base64Encoded: value)!</span><br><span class="line">    <span class="keyword">let</span> propertyList = <span class="keyword">try</span> <span class="type">PropertyListSerialization</span></span><br><span class="line">                            .propertyList(from: data,</span><br><span class="line">                                          options: [],</span><br><span class="line">                                          format: <span class="literal">nil</span>)</span><br><span class="line">    <span class="built_in">print</span>(propertyList)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">(</span><br><span class="line">    ap = &#123;</span><br><span class="line">        d = <span class="number">15</span>;</span><br><span class="line">        l = <span class="number">0</span>;</span><br><span class="line">    &#125;;</span><br><span class="line">    si = (</span><br><span class="line">        &#123;</span><br><span class="line">            a = <span class="string">"-0.3427528387535028"</span>;</span><br><span class="line">            i = <span class="number">0</span>;</span><br><span class="line">            z = <span class="string">"270.9334057827345"</span>;</span><br><span class="line">        &#125;,</span><br><span class="line">        ...</span><br><span class="line">        &#123;</span><br><span class="line">            a = <span class="string">"-38.04743388682423"</span>;</span><br><span class="line">            i = <span class="number">15</span>;</span><br><span class="line">            z = <span class="string">"53.50908581251309"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    )</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p><em>æ¸…æ™°å¤šäº†ï¼</em></p><p>é¦–å…ˆæœ‰ä¸¤ä¸ªä¸€çº§é”®ï¼š</p><p><code>ap</code> é”®å¯¹åº”çš„å€¼æ˜¯åŒ…å« <code>d</code> å’Œ <code>l</code> ä¸¤ä¸ªé”®çš„å­—å…¸ï¼Œå®ƒä»¬çš„å€¼éƒ½æ˜¯æ•´å‹ã€‚</p><p><code>si</code> é”®å¯¹åº”çš„å€¼æ˜¯åŒ…å«å¤šä¸ªå­—å…¸çš„æ•°ç»„ï¼Œå­—å…¸ä¸­æœ‰æ•´å‹ï¼Œä¹Ÿæœ‰æµ®ç‚¹å‹çš„å€¼ã€‚åœ¨åµŒå¥—çš„å­—å…¸ä¸­ï¼Œ<code>i</code> æœ€å®¹æ˜“ç†è§£ï¼šå®ƒä» 0 ä¸€ç›´é€’å¢åˆ° 15ï¼Œè¿™è¡¨ç¤ºçš„æ˜¯å›¾ç‰‡åºåˆ—çš„ä¸‹æ ‡ã€‚åœ¨æ²¡æœ‰æ›´å¤šä¿¡æ¯çš„æƒ…å†µä¸‹ï¼Œå¾ˆéš¾çŒœæµ‹ <code>a</code> ä¸ <code>z</code> çš„å«ä¹‰ï¼Œå…¶å®å®ƒä»¬è¡¨ç¤ºç›¸åº”å›¾ç‰‡ä¸­å¤ªé˜³çš„é«˜åº¦ï¼ˆ<code>a</code>ï¼‰å’Œæ–¹ä½è§’ï¼ˆ<code>z</code>ï¼‰ã€‚</p><h3 id="è®¡ç®—å¤ªé˜³çš„ä½ç½®"><a href="#è®¡ç®—å¤ªé˜³çš„ä½ç½®" class="headerlink" title="è®¡ç®—å¤ªé˜³çš„ä½ç½®"></a>è®¡ç®—å¤ªé˜³çš„ä½ç½®</h3><p>å°±åœ¨æˆ‘è½ç¬”ä¹‹æ—¶ï¼Œèº«å¤„åŒ—åŠçƒçš„äººæ­£åœ¨è¿›å…¥ç§‹å­£ï¼Œç™½æ˜¼å˜çŸ­ï¼Œæ°”æ¸©å˜ä½ï¼Œè€Œå—åŠçƒçš„äººå´ç»å†ç€ç™½æ˜¼å˜é•¿ï¼Œæ°”æ¸©å˜é«˜ã€‚å­£èŠ‚çš„å˜åŒ–å‘Šè¯‰æˆ‘ä»¬ï¼Œæ—¥ç…§çš„æ—¶é•¿å–å†³äºä½ åœ¨æ˜Ÿçƒä¸Šçš„ä½ç½®ï¼Œä»¥åŠæ˜Ÿçƒç»•å¤ªé˜³çš„è½¨é“ã€‚</p><p>å¯å–œçš„æ˜¯ï¼Œå¤©æ–‡å­¦å®¶èƒ½å‘Šè¯‰ä½  â€”â€” è€Œä¸”ç›¸å½“å‡†ç¡® â€”â€” å¤ªé˜³åœ¨å¤©ç©ºä¸­çš„ä½ç½®æˆ–æ—¶é—´ã€‚ä¸å¯è´ºçš„æ˜¯ï¼Œè¿™å…¶ä¸­çš„è®¡ç®—ååˆ† <a href="https://en.wikipedia.org/wiki/Position_of_the_Sun" target="_blank" rel="noopener">å¤æ‚</a>ã€‚</p><p>ä½†è€å®è®²ï¼Œæˆ‘ä»¬å¹¶ä¸ç”¨è¿‡åˆ†æ·±ç©¶å®ƒï¼Œåœ¨ç½‘ä¸Šèƒ½æ‰¾åˆ°ç›¸å…³çš„ä»£ç ã€‚ç»è¿‡ä¸æ–­çš„è¯•é”™ï¼Œ<a href="https://github.com/NSHipster/DynamicDesktop/blob/master/SolarPosition.playground" target="_blank" rel="noopener">å®ƒä»¬å°±èƒ½ä¸ºæˆ‘æ‰€ç”¨</a>ï¼ˆæ¬¢è¿ PRï¼ï¼‰ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Foundation</span><br><span class="line"><span class="keyword">import</span> CoreLocation</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½äºåŠ å·åº“æ¯”è’‚è¯ºçš„ Apple Park</span></span><br><span class="line"><span class="keyword">let</span> location = <span class="type">CLLocation</span>(latitude: <span class="number">37.3327</span>, longitude: -<span class="number">122.0053</span>)</span><br><span class="line"><span class="keyword">let</span> time = <span class="type">Date</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> position = solarPosition(<span class="keyword">for</span>: location, at: time)</span><br><span class="line"><span class="keyword">let</span> formattedDate = <span class="type">DateFormatter</span>.localizedString(from: time,</span><br><span class="line">                                                    dateStyle: .medium,</span><br><span class="line">                                                    timeStyle: .short)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">"Solar Position on <span class="subst">\(formattedDate)</span>"</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">"<span class="subst">\(position.azimuth)</span>Â° Az / <span class="subst">\(position.elevation)</span>Â° El"</span>)</span><br></pre></td></tr></table></figure><p><samp>Solar Position on Oct 1, 2018 at 12:00 180.73470025840783Â° Az / 49.27482549913847Â° El</samp></p><p>2018 å¹´ 10 æœˆ 1 æ—¥ä¸­åˆï¼Œå¤ªé˜³ä»å—é¢ç…§å°„åœ¨ Apple Parkï¼Œå¤§çº¦å¤„äºåœ°å¹³çº¿ä¸­é—´ï¼Œç›´å°„å¤´é¡¶ã€‚</p><p>å¦‚æœç»˜åˆ¶å‡ºå¤ªé˜³ä¸€å¤©çš„ä½ç½®ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°ä¸€ä¸ªæ­£å¼¦æ›²çº¿ï¼Œè¿™ä¸ç¦è®©äººè”æƒ³åˆ° Apple Watch çš„â€œå¤ªé˜³è¡¨ç›˜â€ã€‚</p><p><img src="/img/articles/macos-dynamic-desktop/solar-position-watch-faces-1815d6d3c84f42ff4588fa47cd59841f4de15be2b219f6f4ec9a83e13ea0f08b.jpg1540446628.9008124" alt=""></p><h3 id="æ‰©å±•å¯¹-XMP-çš„ç†è§£"><a href="#æ‰©å±•å¯¹-XMP-çš„ç†è§£" class="headerlink" title="æ‰©å±•å¯¹ XMP çš„ç†è§£"></a>æ‰©å±•å¯¹ XMP çš„ç†è§£</h3><p>å¥½å§ï¼Œå¤©æ–‡å­¦åˆ°æ­¤ç»“æŸã€‚æ¥ä¸‹æ¥æ˜¯ä¸€ä¸ªä¹å‘³çš„è¿‡ç¨‹ï¼š<em>æ‘†åœ¨çœ¼å‰</em>çš„ XML å…ƒæ•°æ®ã€‚</p><p>è¿˜è®°å¾—ä¹‹å‰çš„å…ƒæ•°æ®é”® <code>hasXMP</code> å—ï¼Ÿå¯¹ï¼Œå°±æ˜¯å®ƒæ²¡é”™ã€‚</p><p>XMPï¼ˆExtensible Metadata Platformï¼‰ï¼Œå³å¯æ‰©å±•å…ƒæ•°æ®å¹³å°ï¼Œæ˜¯ä¸€ç§ä½¿ç”¨å…ƒæ•°æ®æ ‡è®°æ–‡ä»¶çš„æ ‡å‡†æ ¼å¼ã€‚XMP é•¿ä»€ä¹ˆæ ·å‘¢ï¼Ÿè¯·æ‰“èµ·ç²¾ç¥æ¥ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> xmpData = <span class="type">CGImageMetadataCreateXMPData</span>(metadata, <span class="literal">nil</span>)</span><br><span class="line"><span class="keyword">let</span> xmp = <span class="type">String</span>(data: xmpData <span class="keyword">as</span>! <span class="type">Data</span>, encoding: .utf8)!</span><br><span class="line"><span class="built_in">print</span>(xmp)</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">x:xmpmeta</span> <span class="attr">xmlns:x</span>=<span class="string">"adobe:ns:meta/"</span> <span class="attr">x:xmptk</span>=<span class="string">"XMP Core 5.4.0"</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">rdf:RDF</span> <span class="attr">xmlns:rdf</span>=<span class="string">"http://www.w3.org/1999/02/22-rdf-syntax-ns#"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">rdf:Description</span> <span class="attr">rdf:about</span>=<span class="string">""</span></span></span><br><span class="line"><span class="tag">            <span class="attr">xmlns:apple_desktop</span>=<span class="string">"http://ns.apple.com/namespace/1.0/"</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">apple_desktop:solar</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- (Base64-Encoded Metadata) --&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">apple_desktop:solar</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">rdf:Description</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">rdf:RDF</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">x:xmpmeta</span>&gt;</span></span><br></pre></td></tr></table></figure><p><em>å‘•ã€‚</em></p><p>ä¸è¿‡ä¹Ÿå¹¸å¥½æˆ‘ä»¬æ£€æŸ¥äº†ä¸€ä¸‹ã€‚ä¹‹åæƒ³è¦æˆåŠŸè‡ªå®šä¹‰ Dynamic Desktopï¼Œè¿˜å¾—ä»°ä»— <code>apple_desktop</code> å‘½åç©ºé—´ã€‚</p><p>æ—¢ç„¶å¦‚æ­¤ï¼Œå°±å¼€å§‹å§ã€‚</p><h2 id="åˆ›å»ºè‡ªå®šä¹‰-Dynamic-Desktop"><a href="#åˆ›å»ºè‡ªå®šä¹‰-Dynamic-Desktop" class="headerlink" title="åˆ›å»ºè‡ªå®šä¹‰ Dynamic Desktop"></a>åˆ›å»ºè‡ªå®šä¹‰ Dynamic Desktop</h2><p>é¦–å…ˆï¼Œåˆ›å»ºä¸€ä¸ªæ•°æ®æ¨¡å‹æ¥è¡¨ç¤º Dynamic Desktopï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">DynamicDesktop</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> images: [<span class="type">Image</span>]</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Image</span> </span>&#123;</span><br><span class="line">        <span class="keyword">let</span> cgImage: <span class="type">CGImage</span></span><br><span class="line">        <span class="keyword">let</span> metadata: <span class="type">Metadata</span></span><br><span class="line"></span><br><span class="line">        <span class="class"><span class="keyword">struct</span> <span class="title">Metadata</span>: <span class="title">Codable</span> </span>&#123;</span><br><span class="line">            <span class="keyword">let</span> index: <span class="type">Int</span></span><br><span class="line">            <span class="keyword">let</span> altitude: <span class="type">Double</span></span><br><span class="line">            <span class="keyword">let</span> azimuth: <span class="type">Double</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">private</span> <span class="class"><span class="keyword">enum</span> <span class="title">CodingKeys</span>: <span class="title">String</span>, <span class="title">CodingKey</span> </span>&#123;</span><br><span class="line">                <span class="keyword">case</span> index = <span class="string">"i"</span></span><br><span class="line">                <span class="keyword">case</span> altitude = <span class="string">"a"</span></span><br><span class="line">                <span class="keyword">case</span> azimuth = <span class="string">"z"</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚å‰æ–‡æ‰€è¿°ï¼Œæ¯ä¸ª Dynamic Desktop éƒ½ç”±ä¸€ä¸ªæœ‰åºçš„å›¾ç‰‡åºåˆ—æ„æˆï¼Œæ¯ä¸ªå›¾ç‰‡åˆåŒ…å«å­˜å‚¨åœ¨ <code>CGImage</code> å¯¹è±¡ä¸­çš„å›¾ç‰‡æ•°æ®å’Œå…ƒæ•°æ®ã€‚<code>Metadata</code> é‡‡ç”¨ <code>Codable</code> ç±»å‹ï¼Œæ˜¯ä¸ºäº†ç¼–è¯‘å™¨è‡ªåŠ¨åˆæˆç›¸å…³å‡½æ•°ã€‚æˆ‘ä»¬èƒ½åœ¨ç”Ÿæˆ Base64 ç¼–ç çš„äºŒè¿›åˆ¶å±æ€§åˆ—è¡¨æ—¶æ„Ÿå—åˆ°å®ƒçš„ä¼˜åŠ¿ã€‚</p><h3 id="å†™å…¥å›¾ç‰‡ç›®æ ‡"><a href="#å†™å…¥å›¾ç‰‡ç›®æ ‡" class="headerlink" title="å†™å…¥å›¾ç‰‡ç›®æ ‡"></a>å†™å…¥å›¾ç‰‡ç›®æ ‡</h3><p>é¦–å…ˆï¼Œåˆ›å»ºä¸€ä¸ªæŒ‡å®šè¾“å‡º URL çš„ <code>CGImageDestination</code>ã€‚æ–‡ä»¶ç±»å‹ä¸º <code>heic</code>ï¼Œèµ„æºæ•°é‡å³éœ€è¦åŒ…å«çš„å›¾ç‰‡å¼ æ•°ã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">guard</span> <span class="keyword">let</span> imageDestination = <span class="type">CGImageDestinationCreateWithURL</span>(</span><br><span class="line">                                outputURL <span class="keyword">as</span> <span class="type">CFURL</span>,</span><br><span class="line">                                <span class="type">AVFileType</span>.heic <span class="keyword">as</span> <span class="type">CFString</span>,</span><br><span class="line">                                dynamicDesktop.images.<span class="built_in">count</span>,</span><br><span class="line">                                <span class="literal">nil</span></span><br><span class="line">                             )</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">fatalError</span>(<span class="string">"Error creating image destination"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥ç€ï¼Œéå†åŠ¨æ€æ¡Œé¢å¯¹è±¡ä¸­çš„å…¨éƒ¨å›¾ç‰‡ã€‚é€šè¿‡ <code>enumerated()</code> æ–¹æ³•ï¼Œæˆ‘ä»¬è¿˜èƒ½è·å–åˆ°å½“å‰ <code>index</code>ï¼Œè¿™æ ·å°±å¯ä»¥åœ¨ç¬¬ä¸€å¼ å›¾ç‰‡ä¸Šè®¾ç½®å›¾ç‰‡å…ƒæ•°æ®ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> (index, image) <span class="keyword">in</span> dynamicDesktop.images.enumerated() &#123;</span><br><span class="line">    <span class="keyword">if</span> index == <span class="number">0</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> imageMetadata = <span class="type">CGImageMetadataCreateMutable</span>()</span><br><span class="line">        <span class="keyword">guard</span> <span class="keyword">let</span> tag = <span class="type">CGImageMetadataTagCreate</span>(</span><br><span class="line">                            <span class="string">"http://ns.apple.com/namespace/1.0/"</span> <span class="keyword">as</span> <span class="type">CFString</span>,</span><br><span class="line">                            <span class="string">"apple_desktop"</span> <span class="keyword">as</span> <span class="type">CFString</span>,</span><br><span class="line">                            <span class="string">"solar"</span> <span class="keyword">as</span> <span class="type">CFString</span>,</span><br><span class="line">                            .string,</span><br><span class="line">                            <span class="keyword">try</span>! dynamicDesktop.base64EncodedMetadata() <span class="keyword">as</span> <span class="type">CFString</span></span><br><span class="line">                        ),</span><br><span class="line">            <span class="type">CGImageMetadataSetTagWithPath</span>(</span><br><span class="line">                imageMetadata, <span class="literal">nil</span>, <span class="string">"xmp:solar"</span> <span class="keyword">as</span> <span class="type">CFString</span>, tag</span><br><span class="line">            )</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">fatalError</span>(<span class="string">"Error creating image metadata"</span>)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">CGImageDestinationAddImageAndMetadata</span>(imageDestination,</span><br><span class="line">                                              image.cgImage,</span><br><span class="line">                                              imageMetadata,</span><br><span class="line">                                              <span class="literal">nil</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="type">CGImageDestinationAddImage</span>(imageDestination,</span><br><span class="line">                                   image.cgImage,</span><br><span class="line">                                   <span class="literal">nil</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é™¤äº†è¾ƒä¸ºç¹æ‚çš„ Core Graphics API ä»¥å¤–ï¼Œä»£ç å¯ä»¥è¯´éå¸¸ç›´è§‚äº†ã€‚å”¯ä¸€éœ€è¦è¿›ä¸€æ­¥è§£é‡Šçš„åªæœ‰ <code>CGImageMetadataTagCreate(_:_:_:_:_:)</code>ã€‚</p><p>ç”±äºå›¾ç‰‡ä¸å…ƒæ•°æ®å®¹å™¨çš„ç»“æ„ã€ä»£ç çš„è¡¨ç°å½¢å¼å‡ä¸åŒï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸å¾—ä¸ä¸º <code>DynamicDesktop</code> å®ç° <code>Encodable</code> åè®®ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">DynamicDesktop</span>: <span class="title">Encodable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="class"><span class="keyword">enum</span> <span class="title">CodingKeys</span>: <span class="title">String</span>, <span class="title">CodingKey</span> </span>&#123;</span><br><span class="line">        <span class="keyword">case</span> ap, si</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="class"><span class="keyword">enum</span> <span class="title">NestedCodingKeys</span>: <span class="title">String</span>, <span class="title">CodingKey</span> </span>&#123;</span><br><span class="line">        <span class="keyword">case</span> d, l</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">encode</span><span class="params">(to encoder: Encoder)</span></span> <span class="keyword">throws</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> keyedContainer =</span><br><span class="line">            encoder.container(keyedBy: <span class="type">CodingKeys</span>.<span class="keyword">self</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> nestedKeyedContainer =</span><br><span class="line">            keyedContainer.nestedContainer(keyedBy: <span class="type">NestedCodingKeys</span>.<span class="keyword">self</span>,</span><br><span class="line">                                           forKey: .ap)</span><br><span class="line"></span><br><span class="line">        <span class="comment">// FIXMEï¼šä¸ç¡®å®šæ­¤å¤„ `l` ä¸ `d` çš„å«ä¹‰</span></span><br><span class="line">        <span class="keyword">try</span> nestedKeyedContainer.encode(<span class="number">0</span>, forKey: .l)</span><br><span class="line">        <span class="keyword">try</span> nestedKeyedContainer.encode(<span class="keyword">self</span>.images.<span class="built_in">count</span>, forKey: .d)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> unkeyedContainer =</span><br><span class="line">            keyedContainer.nestedUnkeyedContainer(forKey: .si)</span><br><span class="line">        <span class="keyword">for</span> image <span class="keyword">in</span> <span class="keyword">self</span>.images &#123;</span><br><span class="line">            <span class="keyword">try</span> unkeyedContainer.encode(image.metadata)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ‰äº†è¿™ä¸ªï¼Œå°±å¯ä»¥å®ç°ä¹‹å‰ä»£ç ä¸­æåˆ°çš„ <code>base64EncodedMetadata()</code> æ–¹æ³•äº†ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">DynamicDesktop</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">base64EncodedMetadata</span><span class="params">()</span></span> <span class="keyword">throws</span> -&gt; <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> encoder = <span class="type">PropertyListEncoder</span>()</span><br><span class="line">        encoder.outputFormat = .binary</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> binaryPropertyListData = <span class="keyword">try</span> encoder.encode(<span class="keyword">self</span>)</span><br><span class="line">        <span class="keyword">return</span> binaryPropertyListData.base64EncodedString()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“ for-in å¾ªç¯æ‰§è¡Œå®Œï¼Œä¹Ÿå°±è¡¨æ˜æ‰€æœ‰å›¾ç‰‡å’Œå…ƒæ•°æ®å‡è¢«å†™å…¥ï¼Œæˆ‘ä»¬å¯ä»¥è°ƒç”¨ <code>CGImageDestinationFinalize(_:)</code> æ–¹æ³•ç»ˆæ­¢å›¾ç‰‡æºï¼Œå¹¶å°†å›¾ç‰‡å†™å…¥ç£ç›˜ã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">guard</span> <span class="type">CGImageDestinationFinalize</span>(imageDestination) <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">fatalError</span>(<span class="string">"Error finalizing image"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœä¸€åˆ‡é¡ºåˆ©ï¼Œå°±å¯ä»¥ä¸ºé‡æ–°å®šä¹‰ Dynamic Desktop çš„è‡ªå·±è€Œæ„Ÿåˆ°éª„å‚²äº†ã€‚æ£’ï¼</p><p><br></p><hr><p><br></p><p>æˆ‘ä»¬éå¸¸å–œæ¬¢ Mojave çš„ Dynamic Desktop ç‰¹æ€§ï¼Œå¹¶ä¸”ä¹Ÿå¾ˆæ¬£æ…°çœ‹åˆ°å®ƒä»¿ä½›é‡ç°äº† Windows 95 å£çº¸è¿›å…¥ä¸»æµå¸‚åœºæ—¶çš„è¾‰ç…Œã€‚</p><p>å¦‚æœä½ ä¹Ÿè¿™æ ·æƒ³ï¼Œä¸‹é¢è¿˜æœ‰äº›æƒ³æ³•å¯ä¾›å‚è€ƒï¼š</p><h3 id="ç…§ç‰‡è‡ªåŠ¨ç”Ÿæˆ-Dynamic-Desktop"><a href="#ç…§ç‰‡è‡ªåŠ¨ç”Ÿæˆ-Dynamic-Desktop" class="headerlink" title="ç…§ç‰‡è‡ªåŠ¨ç”Ÿæˆ Dynamic Desktop"></a>ç…§ç‰‡è‡ªåŠ¨ç”Ÿæˆ Dynamic Desktop</h3><p>è®©äººæŒ¯å¥‹çš„æ˜¯ï¼Œå¤©ä½“è¿åŠ¨è¿™æ ·é«˜ä¸å¯æ”€çš„ç ”ç©¶ï¼Œç«Ÿç„¶å¯ä»¥ç®€åŒ–ç”¨äºŒå…ƒæ–¹ç¨‹æ¥è¡¨è¾¾ï¼šæ—¶é—´ä¸ä½ç½®ã€‚</p><p>åœ¨ä¹‹å‰çš„ä¾‹å­ä¸­ï¼Œè¿™éƒ¨åˆ†ä¿¡æ¯éƒ½æ˜¯ç¡¬ç¼–ç çš„ï¼Œä½†å…¶å®å®ƒä»¬å¯ä»¥é€šè¿‡è¯»å–å›¾ç‰‡æ•°æ®æ¥è‡ªåŠ¨è·å–ã€‚</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œç»å¤§éƒ¨åˆ†æ‰‹æœºçš„ç›¸æœºéƒ½ä¼šæ•è·æ‹æ‘„æ—¶çš„ <a href="https://en.wikipedia.org/wiki/Exif" target="_blank" rel="noopener">Exif å…ƒæ•°æ®</a>ã€‚å…ƒæ•°æ®åŒ…å«äº†ç…§ç‰‡æ‹æ‘„çš„æ—¶é—´ï¼Œä»¥åŠå½“æ—¶è®¾å¤‡çš„ GPS åæ ‡ã€‚</p><p>é€šè¿‡è¯»å–å…ƒæ•°æ®ä¸­çš„æ—¶é—´ä¸ä½ç½®ä¿¡æ¯ï¼Œèƒ½è‡ªåŠ¨è·å–å¤ªé˜³çš„ä½ç½®ï¼Œé‚£ä¹ˆä»ä¸€ç³»åˆ—å›¾ç‰‡ä¸­ç”Ÿæˆ Dynamic Desktop ä¹Ÿå°±é¡ºç†æˆç« äº†ã€‚</p><h3 id="iPhone-ä¸Šçš„å»¶æ—¶æ‘„å½±"><a href="#iPhone-ä¸Šçš„å»¶æ—¶æ‘„å½±" class="headerlink" title="iPhone ä¸Šçš„å»¶æ—¶æ‘„å½±"></a>iPhone ä¸Šçš„å»¶æ—¶æ‘„å½±</h3><p>æƒ³è¦å¥½å¥½åˆ©ç”¨æ‰‹ä¸Šå…¨æ–°çš„ iPhone Xs å—ï¼Ÿï¼ˆæ›´ç¡®åˆ‡çš„è¯´ï¼Œâ€œåœ¨çº ç»“å–ä¸å–æ—§ iPhone çš„æ—¶å€™ï¼Œå¯ä»¥å…ˆç”¨å®ƒæ¥åšäº›æœ‰åˆ›æ„çš„äº‹ï¼Ÿâ€ï¼‰</p><p>å°†æ‰‹æœºå……ä¸Šç”µï¼Œæ‘†åœ¨çª—å‰ï¼Œæ‰“å¼€ç›¸æœºçš„å»¶æ—¶æ‘„å½±æ¨¡å¼ï¼Œç‚¹å‡»â€œæ‹æ‘„â€æŒ‰é’®ã€‚ä»æœ€åçš„è§†é¢‘ä¸­é€‰å‡ºä¸€äº›å…³é”®å¸§ï¼Œå°±å¯ä»¥åˆ¶ä½œä¸“å± Dynamic Desktop äº†ã€‚</p><p>å½“ç„¶ï¼Œä½ å¯ä»¥çœ‹çœ‹ <a href="https://itunes.apple.com/us/app/skyflow-time-lapse-shooting/id937208291?mt=8" target="_blank" rel="noopener">Skyflow</a> è¿™ç±»åº”ç”¨ï¼Œå®ƒèƒ½è®¾ç½®æ—¶é—´é—´éš”æ¥æ‹æ‘„é™æ€å›¾ç‰‡ã€‚</p><h3 id="é€šè¿‡-GIS-æ•°æ®æ‰“é€ é£æ™¯"><a href="#é€šè¿‡-GIS-æ•°æ®æ‰“é€ é£æ™¯" class="headerlink" title="é€šè¿‡ GIS æ•°æ®æ‰“é€ é£æ™¯"></a>é€šè¿‡ GIS æ•°æ®æ‰“é€ é£æ™¯</h3><p>å¦‚æœä½ æ— æ³•å¿å—æ‰‹æœºä¸€æ•´å¤©ä¸åœ¨èº«è¾¹ï¼ˆä¼¤å¿ƒï¼‰ï¼Œåˆæˆ–è€…æ²¡ä»€ä¹ˆæ ‡å¿—æ€§æ™¯è±¡å€¼å¾—æ‹æ‘„ï¼ˆä¾ç„¶ä¼¤å¿ƒï¼‰ï¼Œä½ è¿˜å¯ä»¥åˆ›é€ ä¸€ä¸ªå±äºè‡ªå·±çš„ä¸–ç•Œï¼ˆè¿™æ¯”ç°å®æœ¬èº«è¿˜è¦ä»¤äººä¼¤å¿ƒï¼‰ã€‚</p><p>å¯ä»¥é€‰æ‹©ç”¨ <a href="https://planetside.co.uk/" target="_blank" rel="noopener">Terragen</a> è¿™ç±»åº”ç”¨ï¼Œå®ƒæ‰“é€ äº†ä¸€ä¸ªé€¼çœŸçš„ 3D ä¸–ç•Œï¼Œè¿˜èƒ½å¯¹å¤ªé˜³ã€åœ°çƒã€å¤©ç©ºè¿›è¡Œå¾®è°ƒã€‚</p><p>æƒ³è¦æ›´åŠ ç®€åŒ–ï¼Œè¿˜å¯ä»¥ä»ç¾å›½åœ°è´¨è°ƒæŸ¥å±€çš„ <a href="https://viewer.nationalmap.gov/basic/" target="_blank" rel="noopener">å›½å®¶åœ°å›¾ç½‘ç«™</a> ä¸Šä¸‹è½½é«˜ç¨‹åœ°å›¾ï¼Œä»¥ç”¨äº 3D æ¸²æŸ“çš„æ¨¡æ¿ã€‚</p><h3 id="ä¸‹è½½é¢„åˆ¶çš„-Dynamic-Desktops"><a href="#ä¸‹è½½é¢„åˆ¶çš„-Dynamic-Desktops" class="headerlink" title="ä¸‹è½½é¢„åˆ¶çš„ Dynamic Desktops"></a>ä¸‹è½½é¢„åˆ¶çš„ Dynamic Desktops</h3><p>å†æˆ–è€…ï¼Œä½ æ¯å¤©éƒ½éå¸¸å¤šçš„å·¥ä½œè¦åšï¼ŒæŠ½ä¸å‡ºæ—¶é—´æ£è…¾å¥½çœ‹çš„å›¾ç‰‡ï¼Œä¹Ÿå¯ä»¥é€‰æ‹©ä»˜è´¹ä»åˆ«äººé‚£é‡Œè´­ä¹°ã€‚</p><p>æˆ‘ä¸ªäººæ˜¯ <a href="https://www.jetsoncreative.com/24hourwallpaper" target="_blank" rel="noopener">24 Hour Wallpaper</a> è¿™æ¬¾åº”ç”¨çš„ç²‰ä¸ã€‚å¦‚æœä½ æœ‰åˆ«çš„æ¨èï¼Œæ¬¢è¿ <a href="https://twitter.com/NSHipster/" target="_blank" rel="noopener">è”ç³»æˆ‘ä»¬</a>ã€‚</p><p><br></p><hr><h3 id="NSMUTABLEHIPSTER"><a href="#NSMUTABLEHIPSTER" class="headerlink" title="NSMUTABLEHIPSTER"></a>NSMUTABLEHIPSTER</h3><p>ç–‘é—®ï¼Ÿçº é”™ï¼Ÿæ¬¢è¿æ <a href="https://github.com/NSHipster/articles/issues" target="_blank" rel="noopener">issues</a> å’Œ <a href="https://github.com/NSHipster/articles/blob/master/2018-10-01-macos-dynamic-desktop.md" target="_blank" rel="noopener">pull requests</a> â€”â€” NSHipster å› ä½ è€Œå˜å¾—æ›´å¥½ã€‚</p><p><em>æœ¬æ–‡ç”¨çš„æ˜¯ Swift 4.2</em>ã€‚å…³äºç«™å†…æ–‡ç« çš„çŠ¶æ€ä¿¡æ¯ï¼Œå¯ä»¥æŸ¥çœ‹ <a href="https://nshipster.com/status/" target="_blank" rel="noopener">çŠ¶æ€æ±‡æ€»é¡µé¢</a>ã€‚</p><blockquote><p>æœ¬æ–‡ç”± SwiftGG ç¿»è¯‘ç»„ç¿»è¯‘ï¼Œå·²ç»è·å¾—ä½œè€…ç¿»è¯‘æˆæƒï¼Œæœ€æ–°æ–‡ç« è¯·è®¿é—® <a href="http://swift.gg">http://swift.gg</a>ã€‚</p></blockquote>]]></content>
    
    <summary type="html">
    
      Mojave ä¸­ Dynamic Desktop çš„å¥¥ä¹‰
    
    </summary>
    
      <category term="Swift" scheme="https://swift.gg/categories/Swift/"/>
    
      <category term="NSHipster" scheme="https://swift.gg/categories/Swift/NSHipster/"/>
    
    
      <category term="Swift" scheme="https://swift.gg/tags/Swift/"/>
    
      <category term="NSHipster" scheme="https://swift.gg/tags/NSHipster/"/>
    
  </entry>
  
  <entry>
    <title>ç¼–è¯‘å¼€æº Swift Foundation åº“</title>
    <link href="https://swift.gg/2018/10/22/compiling-open-source-swift-foundation/"/>
    <id>https://swift.gg/2018/10/22/compiling-open-source-swift-foundation/</id>
    <published>2018-10-22T00:00:00.000Z</published>
    <updated>2019-02-19T03:45:13.515Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ä½œè€…ï¼šiAchieved.itï¼Œ<a href="http://dev.iachieved.it/iachievedit/compiling-open-source-swift-foundation/" target="_blank" rel="noopener">åŸæ–‡é“¾æ¥</a>ï¼ŒåŸæ–‡æ—¥æœŸï¼š2016-06-30<br>è¯‘è€…ï¼š<a href="https://github.com/rsenjoyer" target="_blank" rel="noopener">rsenjoyer</a>ï¼›æ ¡å¯¹ï¼š<a href="http://numbbbbb.com/" target="_blank" rel="noopener">numbbbbb</a>ï¼Œ<a href="http://hulizhen.me" target="_blank" rel="noopener">æ™ºå¤šèŠ¯</a>ï¼›å®šç¨¿ï¼š<a href="http://forelax.space" target="_blank" rel="noopener">Forelax</a></p></blockquote><!--æ­¤å¤„å¼€å§‹æ­£æ–‡--><p><img src="/img/articles/compiling-open-source-swift-foundation/006tNbRwgy1fuksdkfewij306o06omx6.jpg1540189674.5814507" alt=""></p><p>æˆ‘æœ€è¿‘åœ¨å¼€æºçš„ <a href="https://github.com/apple/swift-corelibs-foundation" target="_blank" rel="noopener">Swift Foundation</a> ä¸­é‡åˆ°äº† <code>NSThread</code> å®ç°çš„é—®é¢˜ã€‚å¦‚æœä¸æ˜¯å°è¯•åœ¨æ ‘è“æ´¾ 3 ä¸Šè¿è¡Œä»£ç ï¼Œæˆ‘ä¹Ÿè®¸å°±å‘ç°ä¸äº†è¿™ä¸ªé—®é¢˜ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Foundation</span><br><span class="line"><span class="keyword">import</span> Glibc</span><br><span class="line"> </span><br><span class="line"><span class="keyword">var</span> counter = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">true</span> &#123;</span><br><span class="line">  sleep(<span class="number">2</span>)</span><br><span class="line">  counter = counter + <span class="number">1</span></span><br><span class="line">  <span class="keyword">let</span> t = <span class="type">Thread</span>()&#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"STARTED:<span class="subst">\(counter)</span>"</span>)</span><br><span class="line">    sleep(<span class="number">1</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"EXIT:<span class="subst">\(counter)</span>"</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">print</span>(<span class="string">"START:<span class="subst">\(counter)</span>"</span>)</span><br><span class="line">  t.start()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘æ‰€æœŸæœ›çš„æ˜¯æ¯ 2 ç§’éƒ½ä¼šåˆ›å»ºå¹¶é”€æ¯ä¸€ä¸ªçº¿ç¨‹ã€‚ä¸å¹¸çš„æ˜¯åœ¨å¤§çº¦å¯åŠ¨ 230 ä¸ªçº¿ç¨‹ä¹‹åï¼Œç³»ç»Ÿèµ„æºå·²ç»è€—å°½ï¼Œä¸å†æœ‰æ–°çš„çº¿ç¨‹è¢«åˆ›å»ºã€‚è§£å†³çš„æ–¹å¼æ­£å¦‚ <a href="https://bugs.swift.org/browse/SR-1908" target="_blank" rel="noopener">SR-1908</a> æ‰€æåˆ°çš„ï¼Œåˆå§‹åŒ–å…·æœ‰ç³»ç»ŸèŒƒå›´çš„åˆ†ç¦»çŠ¶æ€çš„çº¿ç¨‹</p><a id="more"></a><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">init</span>(<span class="number">_</span> main: (<span class="type">Void</span>) -&gt; <span class="type">Void</span>) &#123;</span><br><span class="line">  _main = main</span><br><span class="line">  <span class="keyword">let</span> <span class="number">_</span> = <span class="built_in">withUnsafeMutablePointer</span>(&amp;_attr) &#123; attr <span class="keyword">in</span></span><br><span class="line">    pthread_attr_init(attr)</span><br><span class="line">    pthread_attr_setscope(attrï¼Œ<span class="type">Int32</span>(<span class="type">PTHREAD_SCOPE_SYSTEM</span>))</span><br><span class="line">    pthread_attr_setdetachstate(attrï¼Œ<span class="type">Int32</span>(<span class="type">PTHREAD_CREATE_DETACHED</span>))</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a href="https://github.com/phausler" target="_blank" rel="noopener">Philippe Hausler</a> åœ¨ SR-1908 ä¸­æå‡ºäº†è§£å†³æ–¹æ¡ˆã€‚æ­£å·§æˆ‘æœ‰ä¸ªæ ‘è“æ´¾ 3 å¯ä»¥å®ç°å’Œæµ‹è¯•è¯¥æ–¹æ¡ˆã€‚</p><h2 id="é’ˆå¯¹-Foundation-çš„æ„å»º"><a href="#é’ˆå¯¹-Foundation-çš„æ„å»º" class="headerlink" title="é’ˆå¯¹ Foundation çš„æ„å»º"></a>é’ˆå¯¹ Foundation çš„æ„å»º</h2><p>å¦‚æœä½ é˜…è¯»äº† <a href="https://github.com/apple/swift-corelibs-foundation" target="_blank" rel="noopener">å¼€æºåº“ Foundation</a> çš„ <a href="https://github.com/apple/swift-corelibs-foundation/blob/master/Docs/GettingStarted.md" target="_blank" rel="noopener">æ–°æ‰‹å…¥é—¨æ–‡æ¡£</a>ï¼Œä½ å°±ä¼šçŸ¥é“ï¼Œå®ƒå»ºè®®åœ¨æ„å»º Foundation ä¹‹å‰ï¼Œé¦–å…ˆéœ€è¦æ„å»º Swiftï¼Œclang å’Œ llvmã€‚å¦‚æœå¯ä»¥åœ¨ä¸€ä¸ªæœ‰å¤§é‡çš„ CPU å’Œå¿«é€Ÿç£ç›˜çš„æœåŠ¡å™¨ä¸Šå·¥ä½œï¼Œæˆ‘ä¸æ¯«ä¸ä»‹æ„æŒ‰ç…§æ–‡æ¡£ä¸€æ­¥æ­¥æ„å»ºã€‚ç„¶è€Œæ ‘è“æ´¾ 3 ä¸å…¶ä»–è€å¼çš„è®¾å¤‡ä¸€æ ·ï¼Œæ€§èƒ½æå‡æœ‰ç‚¹æ…¢ã€‚æˆ‘ä¹Ÿå¯ä»¥è€ƒè™‘äº¤å‰ç¼–è¯‘ Swiftï¼Œä½†æˆ‘è¿˜æ²¡æœ‰è¶³å¤Ÿæ—¶é—´æ¥è§£å†³äº¤å‰ç¼–è¯‘å¸¦æ¥çš„é—®é¢˜ï¼ˆå¦‚æœä½ æ›¾ç»ä½¿ç”¨è¿‡äº¤å‰ç¼–è¯‘ç¯å¢ƒï¼Œä½ ä¸€å®šçŸ¥é“å®ƒéœ€è¦å¾ˆé•¿æ—¶é—´æ¥åšç›¸å…³çš„é…ç½®ï¼‰ã€‚</p><p>æˆ‘ä»¬æ‰€éœ€è¦çš„æ˜¯å……åˆ†åˆ©ç”¨å·²æœ‰çš„æ„å»ºç¯å¢ƒå¹¶è‡ªè¡Œç¼–è¯‘ Foundationã€‚äº‹å®è¯æ˜æ˜¯å¯ä»¥åšåˆ°çš„ï¼Œä¸ç„¶çš„è¯ï¼Œæˆ‘ä»¬ä¹Ÿä¸ä¼šæœ‰è¿™ç¯‡åšå®¢äº†ã€‚</p><p>ä¸‹é¢æ˜¯ä½ æ‰€éœ€è¦çš„å‡†å¤‡æ“ä½œï¼ˆæ— è®ºä½ æ˜¯åœ¨ x86 æœåŠ¡å™¨ä¸Šè¿˜æ˜¯åœ¨åƒ BeagleBone æˆ–æ ‘è“æ´¾çš„ ARM çš„è®¡ç®—æœºä¸Šï¼‰ï¼š</p><ul><li>å…¨é‡æ„å»º <code>swiftc</code>ï¼Œé€šå¸¸ä½äº <code>build/buildbot_linux/swift-linux-armv7/bin</code> ç›®å½•</li><li>å…¨é‡æ„å»º <code>swift</code>ï¼ŒåŒæ ·ä½äº <code>build/buildbot_linux/swift-linux-armv7/bin</code> ç›®å½•</li><li>å…¨é‡æ„å»º <code>clang</code>(ä»å¼€æºåº“ä¸­æ„å»º)ï¼Œä½äº <code>build/buildbot_linux/llvm-linux-armv7/bin</code> ç›®å½•ä¸­</li></ul><p>æˆ‘å¸Œæœ›æä¾›å„ç§å·²ç»ç¼–è¯‘è¿‡çš„â€œå·¥å…·é“¾â€ï¼Œä½†æ˜¯ç°åœ¨ä½ å¿…é¡»é¦–å…ˆæ„å»ºè‡ªå·±çš„å·¥å…·é“¾ã€‚ç„¶åä½ å°±å¯ä»¥è‡ªå·±æ„å»º Foundation äº†ã€‚</p><p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬æ¥çœ‹çœ‹å¦‚ä½•ä½¿ç”¨å®ƒæ¥æµ‹è¯• Foundation ä¸Šçš„å†…å®¹ã€‚è¯·æ³¨æ„ï¼Œæˆ‘ä»¬å…‹éš†çš„æ˜¯æˆ‘ä»¬è‡ªå·± fork çš„ swift-corelibs-foundation çš„åˆ†æ”¯ã€‚å¦‚æœä½ æ‰“ç®—ç»™ä¸Šæ¸¸å¼€æºåº“ï¼ˆå³ Apple å¼€æºåº“ï¼‰æäº¤ PRï¼Œè¿™ä¸€ç‚¹éå¸¸çš„é‡è¦ã€‚</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> git <span class="built_in">clone</span> https://github.com/iachievedit/swift-corelibs-foundation</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">export</span> PREBUILT_ROOT=/root/workspace/Swift-3.0-Pi3-ARM-Incremental/build/buildbot_linux/</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> SWIFTC=<span class="variable">$PREBUILT_ROOT</span>/swift-linux-armv7/bin/swiftc \</span></span><br><span class="line">CLANG=$PREBUILT_ROOT/llvm-linux-armv7/bin/clang      \</span><br><span class="line">SWIFT=$PREBUILT_ROOT/swift-linux-armv7/bin/swift     \</span><br><span class="line">SDKROOT=$PREBUILT_ROOT/swift-linux-armv7             \</span><br><span class="line">BUILD_DIR=build ./configure Debug</span><br><span class="line"><span class="meta">#</span><span class="bash"> /usr/bin/ninja</span></span><br><span class="line">...</span><br><span class="line">[290/290] Link: build/Foundation/libFoundation.so</span><br></pre></td></tr></table></figure><p>é¦–å…ˆï¼Œæˆ‘ä»¬å°†ç¯å¢ƒå˜é‡ <code>PREBUILT_ROOT</code> è®¾ç½®åˆ°é¢„æ„å»º Swift åŠç›¸å…³å·¥å…·æ‰€åœ¨çš„ä½ç½®ï¼Œè¿˜å¯ä»¥åœ¨ä¸‹ä¸€æ­¥æ“ä½œå‰é…ç½® <code>./configure</code> ä¸º <code>Debug</code> æ¨¡å¼ï¼ˆä½ ä¹Ÿå¯ä»¥é…ç½®ä¸º <code>Release</code>ï¼‰ã€‚æˆ‘ä»¬è¿˜éœ€è¦å°†ç¯å¢ƒå˜é‡ <code>SWIFTC</code>ï¼Œ<code>CLANG</code>ï¼Œ<code>SWIFT</code> å’Œ <code>SDKROOT</code> é…ç½®è„šæœ¬æŒ‡å‘æˆ‘ä»¬çš„â€œå·¥å…·é“¾â€ã€‚æœ€åï¼Œç¯å¢ƒå˜é‡ <code>BUILD_DIR</code> è®¾ç½®ä¸ºæ‰€æœ‰ä¸­é—´ä»¶å’Œæœ€ç»ˆè¾“å‡ºï¼ˆlibFoundation.soï¼‰çš„æ”¾ç½®ä½ç½®ã€‚</p><p>æ³¨æ„ï¼šä¹Ÿè®¸æœ‰æ—¶ä½ ä¼šæƒŠè®¶äºè¯„è®ºä¸­çš„æŸäº›å†…å®¹ã€‚ä½ çš„ <code>PREBUILT_ROOT</code> æ˜¯ä½ å·¥å…·é“¾çš„ä½ç½®ã€‚ä¸è¦æœŸæœ›åœ¨ <code>/root/workspace/Swift-3.0-Pi3-ARM-Incremental</code> ä¸Šæ‰¾åˆ°ä½ ç³»ç»Ÿä¸Šçš„ä»»ä½•å†…å®¹ï¼</p><p>æœ€åï¼Œæ‰§è¡Œ <code>/usr/bin/ninja</code> æ¥è¿è¡Œæˆ‘ä»¬çš„æ„å»ºã€‚ä¸€æ—¦æ„å»ºç»“æŸåï¼Œåœ¨ <code>build/Foundation/</code> ç›®å½•ä¸­ä¼šæœ‰ä¸€ä¸ª <code>libFoundation.so</code> å…±äº«åº“ã€‚<br>è¦ä½¿ç”¨å·²å®‰è£…çš„ Swift æ¥æµ‹è¯•å®ƒï¼Œåªéœ€å°† <code>libFoundation.so</code> å¤åˆ¶åˆ° <code>$YOUR_SWIFT_ROOT/usr/lib/swift/linux/ libFoundation.so</code>ã€‚</p><h2 id="è¿è¡Œæµ‹è¯•ç”¨ä¾‹"><a href="#è¿è¡Œæµ‹è¯•ç”¨ä¾‹" class="headerlink" title="è¿è¡Œæµ‹è¯•ç”¨ä¾‹"></a>è¿è¡Œæµ‹è¯•ç”¨ä¾‹</h2><p>ä½ å¯ä»¥é€šè¿‡å‘ <code>./configure</code> æ·»åŠ  <code>-DXCTEST_BUILD_DIR</code> å‚æ•°æ¥è¿è¡Œ Foundation æµ‹è¯•å¥—ä»¶ã€‚</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">export</span> PREBUILT_ROOT=/root/workspace/Swift-3.0-Pi3-ARM-Incremental/build/buildbot_linux/</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> SWIFTC=<span class="variable">$PREBUILT_ROOT</span>/swift-linux-armv7/bin/swiftc \</span></span><br><span class="line">CLANG=$PREBUILT_ROOT/llvm-linux-armv7/bin/clang      \</span><br><span class="line">SWIFT=$PREBUILT_ROOT/swift-linux-armv7/bin/swift     \</span><br><span class="line">SDKROOT=$PREBUILT_ROOT/swift-linux-armv7             \</span><br><span class="line">BUILD_DIR=build ./configure Debug                    \</span><br><span class="line">-DXCTEST_BUILD_DIR=$PREBUILT_ROOT/xctest-linux-armv7</span><br><span class="line"><span class="meta">#</span><span class="bash"> /usr/bin/ninja <span class="built_in">test</span></span></span><br><span class="line">[4/4] Building Tests</span><br><span class="line">**** RUNNING TESTS ****</span><br><span class="line">execute:</span><br><span class="line">LD_LIBRARY_PATH= build/TestFoundation/TestFoundation</span><br><span class="line">**** DEBUGGING TESTS ****</span><br><span class="line">execute:</span><br><span class="line">LD_LIBRARY_PATH= lldb build/TestFoundation/TestFoundation</span><br></pre></td></tr></table></figure><p>è¿è¡Œæµ‹è¯•éœ€è¦ä¸º <code>LD_LIBRARY_PATH</code> æä¾›ä¸¤ä¸ªè·¯å¾„ï¼š<code>libXCTest.so</code> å…±äº«åº“å’Œâ€œlibrary under testâ€çš„è·¯å¾„ã€‚<br>å¦‚æœæˆ‘ä»¬æŒ‰ç…§ä¸Šè¿°æ­¥éª¤æ“ä½œï¼Œ<code>libFoundation.so</code> å°±ä¸€å®šä½äº <code>./build/Foundation</code> ç›®å½•ä¸­ã€‚</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> LD_LIBRARY_PATH=./build/Foundation:<span class="variable">$PREBUILT_ROOT</span>/xctest-linux-armv7 ./build/TestFoundation/TestFoundation</span></span><br><span class="line">...</span><br><span class="line">Test Suite 'All tests' passed at 03:16:45.315</span><br><span class="line">     Executed 483 tests, with 0 failures (0 unexpected) in 37.621 (37.621) seconds</span><br></pre></td></tr></table></figure><h3 id="ç»“æŸè¯­"><a href="#ç»“æŸè¯­" class="headerlink" title="ç»“æŸè¯­"></a>ç»“æŸè¯­</h3><p>éœ€è¦å¼ºè°ƒçš„æ˜¯ä½¿ç”¨è¿™ç§æŠ€æœ¯ï¼Œä½ éœ€è¦ä¸€ä¸ªâ€œæ„å»ºå·¥å…·é“¾â€ï¼Œå®ƒåŒ…å« Swiftï¼Œclang å’Œ llvmã€‚æ­¤å¤–ï¼Œæ‚¨çš„å·¥å…·é“¾æœ€åä¸€æ¬¡æ„å»ºåˆ°æ‚¨å°è¯•è‡ªè¡Œæ„å»º Foundation çš„æ—¶é—´é—´éš”è¶Šé•¿ï¼ŒFoundation æ‰€ä¾èµ–çš„è¯­è¨€ç‰¹æ€§åœ¨æ„å»ºå·¥å…·é“¾æ—¶ä¸å­˜åœ¨çš„é£é™©å°±è¶Šé«˜ã€‚ä½†å¦‚æœæ‚¨å†³å®šå¼€å§‹ä½¿ç”¨ Foundationï¼Œè¯·é¦–å…ˆæ„å»ºå®Œæ•´çš„ Swift å·¥å…·é“¾å¹¶ä¿å­˜æ„å»ºç›®å½•ä»¥ä½¿ç”¨ä¸Šè¿°æŠ€æœ¯ã€‚</p><p>ç¥ä½ å¥½è¿ï¼</p><blockquote><p>æœ¬æ–‡ç”± SwiftGG ç¿»è¯‘ç»„ç¿»è¯‘ï¼Œå·²ç»è·å¾—ä½œè€…ç¿»è¯‘æˆæƒï¼Œæœ€æ–°æ–‡ç« è¯·è®¿é—® <a href="http://swift.gg">http://swift.gg</a>ã€‚</p></blockquote>]]></content>
    
    <summary type="html">
    
      è¿™æ˜¯ä¸€ç¯‡å…³äºç¼–è¯‘ Swift å¼€æºçš„ Foundation åº“çš„æ–‡ç« 
    
    </summary>
    
      <category term="iAchieved.it" scheme="https://swift.gg/categories/iAchieved-it/"/>
    
    
      <category term="Swift" scheme="https://swift.gg/tags/Swift/"/>
    
      <category term="iOS" scheme="https://swift.gg/tags/iOS/"/>
    
  </entry>
  
  <entry>
    <title>åœ¨ä½ çš„ Swift åº”ç”¨ä¸­åˆ›å»ºæˆ–ä¿®æ”¹ URL</title>
    <link href="https://swift.gg/2018/10/15/creating-and-modifying-nsurl-in-swift-4/"/>
    <id>https://swift.gg/2018/10/15/creating-and-modifying-nsurl-in-swift-4/</id>
    <published>2018-10-15T00:00:00.000Z</published>
    <updated>2019-02-19T03:45:13.515Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ä½œè€…ï¼šcodingexplorerï¼Œ<a href="http://www.codingexplorer.com/creating-and-modifying-nsurl-in-swift/" target="_blank" rel="noopener">åŸæ–‡é“¾æ¥</a>ï¼ŒåŸæ–‡æ—¥æœŸï¼š2018-07-18<br>è¯‘è€…ï¼š<a href="https://github.com/Damonvvong" target="_blank" rel="noopener">Damonwong</a>ï¼›æ ¡å¯¹ï¼š<a href="http://numbbbbb.com/" target="_blank" rel="noopener">numbbbbb</a>ï¼Œ<a href="https://bignerdcoding.com/" target="_blank" rel="noopener">BigNerdCoding</a>ï¼›å®šç¨¿ï¼š<a href="http://forelax.space" target="_blank" rel="noopener">Forelax</a></p></blockquote><!--æ­¤å¤„å¼€å§‹æ­£æ–‡--><blockquote><p>è¯‘è€…æ³¨ï¼š<br>æ­¤ç¯‡æ–‡ç« ä»¥å‰æˆ‘ä»¬æ›¾ç»<a href="https://swift.gg/2017/02/22/creating-and-modifying-nsurl-in-swift/">ç¿»è¯‘è¿‡</a>ï¼ŒåŸæ–‡ä½œè€…åœ¨ä»Šå¹´å¯¹è¿™ç¯‡æ–‡ç« è¿›è¡Œäº†æ›´æ–°ï¼Œæˆ‘ä»¬ä¹Ÿå¯¹æ›´æ–°åçš„æ–‡ç« è¿›è¡Œäº†ç¿»è¯‘å¹¶å†æ¬¡å‘å¸ƒã€‚</p></blockquote><p>å¯¹äºå¤§éƒ¨åˆ†åº”ç”¨æ¥è¯´ï¼Œéƒ½éœ€è¦è®¿é—®ä¸€äº›æ–‡ä»¶èµ„æºã€‚è¿™äº›æ–‡ä»¶èµ„æºå¯èƒ½åœ¨ä½ çš„åº”ç”¨å®‰è£…åŒ…ä¸­ï¼Œæˆ–è€…åœ¨æ–‡ä»¶ç³»ç»Ÿå†…ï¼Œäº¦æˆ–è€…åœ¨æŸä¸ªç½‘ç«™æœåŠ¡å™¨ä¸Šã€‚ä½ éœ€è¦ç”¨æŸç§æ–¹æ³•å°†å®ƒä»¬ä½“ç°åœ¨ä»£ç ä¸­ã€‚å¯¹äºè‹¹æœå¹³å°è€Œè¨€ï¼Œä½ ä¸»è¦æœ‰ä¸¤ç§é€‰æ‹©ï¼Œç”¨å­—ç¬¦ä¸²æˆ–è€… <code>URL</code>ã€‚</p><a id="more"></a><p>å¦‚æœä½ ä½¿ç”¨è¿‡æµè§ˆå™¨çš„åœ°å€æ æˆ–è€…åœ¨ç»ˆç«¯ä¸­è¾“å…¥è¿‡åœ°å€ï¼Œä½ å¯èƒ½ä¼šé€‰æ‹©ä½¿ç”¨å­—ç¬¦ä¸²ï¼Œæ¯•ç«Ÿï¼Œåœ¨è¿™äº›åœ°æ–¹ä½ åªèƒ½è¾“å…¥å­—ç¬¦ä¸²ã€‚è™½ç„¶åœ¨ <code>Cocoa</code> å’Œ <code>Cocoa Touch</code> SDKs ä¸­è®¸å¤šæ—§çš„ API åŒæ—¶é‡‡ç”¨ <code>URL</code> å’Œå­—ç¬¦ä¸² (å¯¹äºè¿™äº› API æ¥è¯´ï¼Œè¿™äº›å­—ç¬¦ä¸²é€šå¸¸è¢«ç§°ä¸º â€œpathâ€) ä½œä¸ºå‚æ•°ï¼Œä½†æ˜¯è¶Šæ¥è¶Šå¤šçš„ API å€¾å‘äºåªèƒ½ç”¨ <code>URL</code> å¯¹è±¡ã€‚ç›¸æ¯”è¾ƒäºå­—ç¬¦ä¸²è·¯å¾„æ¥è¯´ï¼Œ<code>URL</code> å¯¹è±¡æœ‰æ›´å¤šçš„ä¼˜åŠ¿ï¼Œæœ€æ˜æ˜¾çš„ä¼˜åŠ¿å°±æ˜¯ä½ å¯ä»¥ç›´æ¥é€šè¿‡å±æ€§è®¿é—® <code>URL</code> çš„ä¸åŒçš„éƒ¨åˆ†ï¼Œè€Œä¸éœ€è¦è‡ªå·±ç¼–å†™ä¸€ä¸ªè§£æç»„ä»¶æ¥è§£æè·¯å¾„å­—ç¬¦ä¸²çš„ä¸åŒéƒ¨åˆ†ã€‚</p><p>ç´§è·Ÿæˆ‘çš„æ­¥ä¼ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å­¦ä¹ å¦‚ä½•åœ¨ Swift åº”ç”¨ä¸­åˆ›å»ºå’Œä½¿ç”¨ <code>URL</code> å¯¹è±¡ã€‚</p><h2 id="åœ¨-Swift-ä¸­åˆ›å»ºä¸€ä¸ª-URL-å¯¹è±¡"><a href="#åœ¨-Swift-ä¸­åˆ›å»ºä¸€ä¸ª-URL-å¯¹è±¡" class="headerlink" title="åœ¨ Swift ä¸­åˆ›å»ºä¸€ä¸ª URL å¯¹è±¡"></a>åœ¨ Swift ä¸­åˆ›å»ºä¸€ä¸ª <code>URL</code> å¯¹è±¡</h2><p>åœ¨ Swift ä¸­æœ‰å¥½å‡ ä¸ªæ„é€ å™¨å’Œå·¥å‚æ–¹æ³•å¯ç”¨äºåˆ›å»º <code>URL</code> å¯¹è±¡ï¼Œä¸‹é¢æˆ‘è¦è®²ä¸€äº›æ›´æœ‰ç”¨çš„åˆå§‹åŒ–æ–¹æ³•ã€‚</p><h3 id="init-string-URLString-String"><a href="#init-string-URLString-String" class="headerlink" title="init?(string URLString: String)"></a>init?(string URLString: String)</h3><p>è¿™ä¸ªæ˜¯æ™®é€šçš„ï¼Œä¹Ÿæ˜¯æœ€å¸¸ç”¨çš„åˆå§‹åŒ–æ–¹æ³•ã€‚å°†ä¸€ä¸ªç”¨äºè¡¨ç¤º <code>URL</code> çš„ Swift å­—ç¬¦ä¸²è½¬å˜æˆä¸€ä¸ª <code>URL</code> å¯¹è±¡ã€‚ä½†å¹¶ä¸æ˜¯æ‰€æœ‰çš„å­—ç¬¦ä¸²éƒ½å¯ä»¥æœ‰æ•ˆçš„è¡¨ç¤ºä¸€ä¸ª <code>URL</code>ï¼Œæ‰€ä»¥è¿™æ˜¯ä¸€ä¸ªå¯å¤±è´¥æ„é€ å™¨ã€‚ç”±äºæœ‰äº›å­—ç¬¦ä¸èƒ½åœ¨ <code>URL</code> ä¸­ä½¿ç”¨ï¼Œå› æ­¤éœ€è¦è¿›è¡Œ URL ç¼–ç ï¼Œå°†è¿™äº›ä¸èƒ½ä½¿ç”¨çš„å­—ç¬¦è½¬åŒ–ä¸ºå¯ä»¥åœ¨ <code>URL</code> ä¸­å‘é€çš„ç¼–ç ã€‚æˆ‘ä¸ªäººè§è¿‡æœ€å¤šçš„æ˜¯ <code>%20</code>ï¼Œä¹Ÿå°±æ˜¯â€œç©ºæ ¼â€å­—ç¬¦ã€‚è¿™ä¸ªæ„é€ å™¨éœ€è¦æœ‰æ•ˆçš„å­—ç¬¦ï¼Œå®ƒä¸ä¼šä¸ºä½ è¿›è¡Œ URL ç¼–ç è½¬åŒ–ã€‚å¦‚æœå­—ç¬¦ä¸²ä¸­åŒ…å«æ— æ³•è½¬æ¢ä¸ºæœ‰æ•ˆ <code>URL</code> çš„å­—ç¬¦æˆ–è€…å†…å®¹ï¼Œæ„é€ å™¨å°†ä¼šè¿”å› <code>nil</code>ã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="type">NSHipster</span> = <span class="type">URL</span>(string: <span class="string">"http://nshipster.com/"</span>) <span class="comment">//è¿”å›ä¸€ä¸ªæœ‰æ•ˆçš„ URL</span></span><br><span class="line"><span class="keyword">let</span> invalidURL = <span class="type">URL</span>(string: <span class="string">"www.example.com/This is a sentence"</span>) <span class="comment">//è¿”å› nil</span></span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ„é€ å™¨å…¶å®æ˜¯ä¸‹é¢è¿™ä¸ªæ„é€ å™¨çš„ä¸€ä¸ªä¾¿åˆ©æ„é€ å™¨ã€‚</p><h3 id="init-string-String-relativeTo-URL"><a href="#init-string-String-relativeTo-URL" class="headerlink" title="init?(string: String, relativeTo: URL?)"></a>init?(string: String, relativeTo: URL?)</h3><p>è¿™æ˜¯ä¸€ä¸ªæŒ‡å®šæ„é€ å™¨ã€‚å’Œä¸Šé¢çš„æ„é€ å™¨ä¸€æ ·ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªå¯å¤±è´¥çš„æ„é€ å™¨ï¼Œè€Œä¸”éœ€è¦ä¸€ä¸ªç±»ä¼¼ <code>URL</code> çš„ Swift å­—ç¬¦ä¸²å’Œä¸€ä¸ªå¯é€‰çš„ <code>baseURL</code> å¯¹è±¡ï¼Œè¿™ä¸ª <code>baseURL</code> æœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ª <code>URL</code> å¯¹è±¡ã€‚å¦‚æœ <code>baseURL</code> ä¸º <code>nil</code>ï¼Œé‚£ä¹ˆå†…éƒ¨ä¼šåƒç¬¬ä¸€ä¸ªæ„é€ å™¨ä¸€æ ·ï¼Œæ ¹æ®æä¾›çš„ <code>URL</code> å­—ç¬¦ä¸²ç”Ÿæˆä¸€ä¸ª <code>URL</code> å¯¹è±¡ã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="type">NSHipsterTwo</span> = <span class="type">URL</span>(string: <span class="string">"http://nshipster.com/"</span>, relativeTo: <span class="literal">nil</span>) <span class="comment">//è¿”å›ä¸€ä¸ªæœ‰æ•ˆçš„ NSHipster URL</span></span><br><span class="line"><span class="keyword">let</span> article = <span class="type">URL</span>(string: <span class="string">"ios9/"</span>, relativeTo: <span class="type">NSHipster</span>) <span class="comment">//è¿”å› "http://nshipster.com/ios9/" URL</span></span><br></pre></td></tr></table></figure><h3 id="init-fileURLWithPath-String-isDirectory-Bool"><a href="#init-fileURLWithPath-String-isDirectory-Bool" class="headerlink" title="init(fileURLWithPath: String, isDirectory: Bool)"></a>init(fileURLWithPath: String, isDirectory: Bool)</h3><p>è¯¥æ„é€ æ–¹æ³•ä¸ä¸Šä¸€ä¸ªæ„é€ æ–¹æ³•ç±»ä¼¼ï¼Œä½†æ˜¯ä»–çš„å­—ç¬¦ä¸²å‚æ•°æŒ‡å‘çš„æ˜¯æœ¬åœ°æ–‡ä»¶æˆ–è€…ç›®å½•ã€‚æˆ‘ä¸å¤ªç¡®å®šä¸ºä»€ä¹ˆä¼šæœ‰ä¸€ä¸ªæœ¬åœ°æ–‡ä»¶çš„ç‰¹æ®Šç‰ˆæœ¬ï¼Œæˆ‘çŒœæœ‰å¯èƒ½æ˜¯åšäº†ä¸€äº›ä¼˜åŒ–ï¼ˆè‡³å°‘éœ€è¦æ˜¯æ–‡ä»¶ <code>scheme</code> å¼€å¤´ï¼Œè€Œä¸åº”è¯¥æ˜¯ <code>http</code> ä¹‹ç±»çš„ï¼‰ã€‚è™½ç„¶æœ‰ä¸€ä¸ªä¸éœ€è¦ä¼  <code>isDirectory</code> å‚æ•°çš„æ„é€ å™¨ï¼Œä½†å¦‚æœä½ çŸ¥é“å®ƒæ˜¯å¦æ˜¯ä¸€ä¸ªç›®å½•æ—¶ï¼Œè‹¹æœå»ºè®®ä½ ä½¿ç”¨è¿™ä¸ªè¿™ä¸ªæ–¹æ³•ã€‚åœ¨æˆ‘çœ‹æ¥ï¼Œæœ‰å¯èƒ½å¦å¤–ä¸€ä¸ªæ„é€ å™¨åœ¨å†…éƒ¨è‡ªå·±åˆ¤æ–­äº†è¾“å…¥å‚æ•°æ˜¯å¦æ˜¯ä¸€ä¸ªç›®å½•ï¼Œè€Œè¿™ä¸ªæ–¹æ³•é€šè¿‡ä¼ å…¥å‚æ•°é¿å…äº†æ£€æŸ¥ã€‚</p><h3 id="init-fileURLWithPath-String-isDirectory-Bool-relativeTo-URL"><a href="#init-fileURLWithPath-String-isDirectory-Bool-relativeTo-URL" class="headerlink" title="init(fileURLWithPath: String, isDirectory: Bool, relativeTo: URL?)"></a>init(fileURLWithPath: String, isDirectory: Bool, relativeTo: URL?)</h3><p>è¿™æ˜¯åœ¨ iOS 9 ä¸­æ–°åŠ å…¥çš„æ–¹æ³•ï¼Œè¿™ä¸å‰ä¸€ä¸ªç±»ä¼¼ï¼Œä½†æ–°å¢äº† <code>relativeToURL</code> å‚æ•°ã€‚å’Œä¹‹å‰çš„æ„é€ å™¨ä¸€æ ·ï¼Œå®ƒå°†è¿”å›ä¸€ä¸ªå°†è·¯å¾„é™„åŠ åˆ° <code>baseURL</code> çš„ <code>URL</code> å¯¹è±¡ã€‚å½“ä½ éœ€è¦ä¸ºäº†æŸä¸ªäº‹æƒ…é‡å¤è®¿é—®æŸä¸ªç›®å½•ä¸‹çš„ä¸åŒæ–‡ä»¶æ—¶ï¼Œå¯ä»¥ä½¿ç”¨è¿™ä¸ªåˆå§‹åŒ–æ–¹æ³•ã€‚ä½ å¯ä»¥å°†æ–‡ä»¶æ‰€åœ¨çš„ç›®å½•ä½œä¸º <code>baseURL</code>ï¼Œç„¶ååªéœ€è¦ä¸€ä¸ªæ–‡ä»¶åä½œä¸º Swift å­—ç¬¦ä¸²è·¯å¾„æ¥åˆ›å»º <code>URL</code> å¯¹è±¡ã€‚</p><h2 id="å°†-URL-è½¬å›-Swift-å­—ç¬¦ä¸²"><a href="#å°†-URL-è½¬å›-Swift-å­—ç¬¦ä¸²" class="headerlink" title="å°† URL è½¬å› Swift å­—ç¬¦ä¸²"></a>å°† URL è½¬å› Swift å­—ç¬¦ä¸²</h2><p>æœ‰æ—¶ä½ éœ€è¦å°† <code>URL</code> å¯¹è±¡è½¬å› Swift å­—ç¬¦ä¸²ï¼Œç‰¹åˆ«æ˜¯åœ¨å¤„ç†æ—§çš„ API æˆ–è€…å‘ç”¨æˆ·å±•ç¤ºæƒ…å½¢ä¸‹ã€‚å€¼å¾—åº†å¹¸çš„æ˜¯ï¼Œ<code>URL</code> æä¾›äº†ä¸€ä¸ªç®€å•çš„åªè¯»å±æ€§æ¥è§£å†³è¿™ä¸ªé—®é¢˜: <code>absoluteString</code>ã€‚åªéœ€è¦åœ¨ä½ çš„ <code>URL</code> å¯¹è±¡è°ƒç”¨è¯¥å±æ€§å³å¯ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> articleString = article?.absoluteString</span><br><span class="line"><span class="comment">// articleString ç°åœ¨åŒ…å« = çš„å€¼æ˜¯ "http://nshipster.com/ios9/"</span></span><br></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† <code>relativeToURL</code> ç‰ˆæœ¬çš„æ„é€ å™¨å®šä¹‰äº†ä¸€ä¸ª <code>article</code> å¸¸é‡ï¼Œå°†å…¶è§£æä¸ºä» <code>scheme</code> å¼€å§‹çš„å®Œæ•´ <code>URL</code> (åœ¨è¿™ç§æƒ…å†µä¸‹æ˜¯ä¸€ä¸ªè·¯å¾„)ã€‚å¦‚æœè¿™ä¸ª <code>URL</code> ä¸Šæœ‰æ–‡ä»¶æ‹“å±•åï¼Œquery æˆ–è€… fragmentï¼Œå®ƒä¾æ—§å¯ä»¥è¢«è§£æã€‚åŸæ¥çš„ <code>article</code> å¯¹è±¡æ˜¯ç”±ä¸€ä¸ªå¯å¤±è´¥æ„é€ å™¨è¿”å›çš„ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆé‚£å„¿æœ‰ä¸€ä¸ª Swift å¯é€‰è®¿é—®ã€‚</p><h2 id="ä¿®æ”¹ä¸€ä¸ª-URL-å¯¹è±¡"><a href="#ä¿®æ”¹ä¸€ä¸ª-URL-å¯¹è±¡" class="headerlink" title="ä¿®æ”¹ä¸€ä¸ª URL å¯¹è±¡"></a>ä¿®æ”¹ä¸€ä¸ª URL å¯¹è±¡</h2><p>æˆ‘ä»¬æ¥ä¸‹æ¥æ‰€è¯´çš„è¿™äº›æ–¹æ³•ï¼Œæ¯ä¸€ä¸ªéƒ½ä¼šåœ¨è¯·æ±‚ä¿®æ”¹å®Œæˆæ—¶æ ¹æ®è°ƒç”¨çš„ <code>URL</code> å¯¹è±¡è¿”å›ä¸€ä¸ªæ–°çš„ <code>URL</code> å¯¹è±¡ã€‚å®ƒä»¬ä¸ä¼šæ›´æ”¹è°ƒç”¨å®ƒä»¬çš„ <code>URL</code> å¯¹è±¡ã€‚</p><h3 id="func-appendingPathComponent-String-isDirectory-Bool-gt-URL"><a href="#func-appendingPathComponent-String-isDirectory-Bool-gt-URL" class="headerlink" title="func appendingPathComponent(String, isDirectory: Bool) -&gt; URL"></a>func appendingPathComponent(String, isDirectory: Bool) -&gt; URL</h3><p>è¿™ä¸ªæ–¹æ³•å¯ä»¥ä¸ºä½ çš„ <code>URL</code> æ·»åŠ æ›´å¤šçš„è·¯å¾„ç»„ä»¶ï¼Œæ¯”å¦‚å½“ä½ è¦æ·»åŠ ä¸€ä¸ªæ–‡ä»¶åˆ°ä½ æ‰€åœ¨çš„ç›®å½•(å­˜å‚¨åœ¨è¿™ä¸ªæ–¹æ³•è°ƒç”¨è¿”å›çš„ <code>URL</code>)æ—¶ï¼Œè¿™ä¸ªæ–¹æ³•å°±å¯ä»¥æ´¾ä¸Šç”¨å¤„ã€‚åƒæˆ‘ä»¬å‰é¢æåˆ°çš„é‚£ä¸ªåˆå§‹åŒ–æ–¹æ³•ä¸€æ ·ï¼Œè¿™ä¸ªæ–¹æ³•ä¹Ÿæœ‰ä¸€ä¸ªæ²¡æœ‰ <code>isDirectory</code> å‚æ•°çš„ç‰ˆæœ¬ï¼Œä½†æ˜¯æ— è®ºä½ æ˜¯å¦çŸ¥é“å®ƒæ˜¯ä¸æ˜¯ä¸€ä¸ªç›®å½•ï¼Œéƒ½æ›´æ¨èä½ ä½¿ç”¨è¿™ä¸ªæ–¹æ³•æ¥ç¡®ä¿å…ƒæ•°æ®å¯ä»¥å­˜å‚¨åœ¨æ­£ç¡®çš„ç›®å½•ä¸‹ã€‚</p><h3 id="func-deletingLastPathComponent-gt-URL"><a href="#func-deletingLastPathComponent-gt-URL" class="headerlink" title="func deletingLastPathComponent() -&gt; URL"></a>func deletingLastPathComponent() -&gt; URL</h3><p>è¿™ä¸ªæ–¹æ³•å°†ä¼šè¿”å›åˆ é™¤äº†æœ€åä¸€ä¸ªè·¯å¾„ç»„ä»¶çš„æ–° <code>URL</code> å¯¹è±¡ã€‚è¿™æ–¹æ³•é€‚ç”¨äº <code>URL</code> çš„è·¯å¾„éƒ¨åˆ†ï¼Œ<code>URL</code> çš„å…¶ä»–éƒ¨åˆ†ä¸å—å½±å“ï¼Œæ¯”å¦‚åŸŸåã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥è¿™æ ·å­åš:</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> articleTwo = <span class="type">NSHipster</span>?.appendingPathComponent(<span class="string">"ios9"</span>, isDirectory: <span class="literal">true</span>)</span><br><span class="line"><span class="comment">//articleTwo ç°åœ¨åŒ…å«çš„ URL å­—ç¬¦æ˜¯ "http://nshipster.com/ios9/"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> deletePathComp = articleTwo?.deletingLastPathComponent</span><br><span class="line"><span class="comment">//deletePathComp ç°åœ¨åŒ…å«çš„ URL å­—ç¬¦æ˜¯ "http://nshipster.com/"</span></span><br></pre></td></tr></table></figure><blockquote><p>è¯‘è€…æ³¨ï¼š<br>åœ¨ Swift 4.2 ä¹‹å‰ï¼ŒdeletingLastPathComponent æ˜¯ä¸€ä¸ªå±æ€§ï¼Œå› æ­¤åœ¨è°ƒç”¨æ—¶ä¸ç”¨åŠ æ‹¬å·ã€‚åœ¨ 4.2 ç‰ˆæœ¬ä¸­ï¼ŒdeletingLastPathComponent å˜æˆäº†æ–¹æ³•<br>å› æ­¤å¦‚æœä½ åœ¨ 4.2 ä¸Šè¿è¡Œä¸Šé¢ä¸€æ®µä»£ç ï¼Œéœ€è¦åœ¨ articleTwo?.deletingLastPathComponent æœ€ååŠ ä¸€ä¸ªæ‹¬å·æ‰èƒ½æ­£ç¡®è¿è¡Œ</p></blockquote><p>å¦‚æœæ²¡æœ‰è·¯å¾„ä¿¡æ¯ï¼Œå¯èƒ½æœ‰ç‚¹å„¿å¥‡æ€ªã€‚ä¸ºäº†å¥½ç©ï¼Œæˆ‘é“¾å¼è°ƒç”¨äº†å‡ æ¬¡ <code>URLByDeletingLastPathComponent</code>ï¼Œæœ€ååªæ˜¯æ·»åŠ äº† â€œ../â€ï¼Œç±»ä¼¼äºåœ¨å‘½ä»¤è¡Œï¼ˆcd ..ï¼‰ä¸­ä¸Šä¸€ä¸ªç›®å½•ã€‚</p><p>å½“ç„¶è¿˜æœ‰å‡ ç§ä¿®æ”¹æ–¹æ³•å’Œå±æ€§ï¼Œä½†è¿™äº›å¯èƒ½æ˜¯æœ€å¸¸ç”¨çš„ã€‚</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>å¦‚æœä½ å¯¹ URL æ ¼å¼è§„èŒƒæ„Ÿå…´è¶£çš„è¯ï¼Œå¯ä»¥å»æŸ¥çœ‹è‹¹æœçš„ URL å‚è€ƒæ–‡æ¡£ä¸­ï¼Œå…³äºå¦‚ä½•å¤„ç† <code>URL</code> è¿™éƒ¨åˆ†æåŠåˆ°çš„ <code>RFC</code> æ–‡æ¡£ã€‚ç”¨äºåˆå§‹åŒ–çš„å­—ç¬¦ä¸²å¿…é¡»ç¬¦åˆ <a href="https://tools.ietf.org/html/rfc2396" target="_blank" rel="noopener">RFC 2396</a>ï¼Œå¹¶ä¸” <code>URL</code> å°†ä¼šæ ¹æ® <a href="https://tools.ietf.org/html/rfc1738" target="_blank" rel="noopener">RFC 1738</a> å’Œ <a href="https://tools.ietf.org/html/rfc1808" target="_blank" rel="noopener">RFC 1808</a> è¢«è§£æã€‚è¿™äº›è§„èŒƒå†…å®¹å¾ˆå¤šï¼Œä½†ä½ èƒ½æ‰¾åˆ°æ‰€æœ‰å¯èƒ½å…³äº URLï¼ŒURI ç­‰çš„ä¿¡æ¯ã€‚</p><p>å¦‚æœä½ å®Œæ•´æŸ¥é˜… <code>URL</code> çš„æ–‡æ¡£çš„è¯ï¼Œè¿˜å¯ä»¥çœ‹åˆ°å®ƒæ‹¥æœ‰ <code>baseURL</code>ï¼Œ<code>host</code>ï¼Œ<code>query</code>ï¼Œ<code>fragment</code> ç­‰ç­‰éå¸¸å¤šçš„å±æ€§ï¼Œæ‰€æœ‰è¿™äº›å±æ€§éƒ½èƒ½åœ¨ Apple æ–‡æ¡£ä¸­æŸ¥è¯¢åˆ°ã€‚ä¸è¿‡å¯¹æˆ‘æ¥è¯´ï¼Œæ—¥å¸¸ä½¿ç”¨æœ€å¤šçš„è¿˜æ˜¯ <code>absoluteString</code>ï¼Œå¶å°”ä¹Ÿä¼šç”¨åˆ° <code>pathExtension</code></p><p>æˆ‘å¸Œæœ›ä½ èƒ½è§‰å¾—è¿™ç¯‡æ–‡ç« å¯¹ä½ æœ‰æ‰€å¸®åŠ©ã€‚å¦‚æœä½ è§‰å¾—æœ‰ç”¨ï¼Œè¯·ä¸è¦çŠ¹è±«ï¼Œåœ¨ Twitter æˆ–è€…å…¶ä»–ç¤¾äº¤åª’ä½“ä¸Šåˆ†äº«è¿™ç¯‡æ–‡ç« ã€‚å½“ç„¶ï¼Œå¦‚æœä½ æœ‰ä»»ä½•ç–‘é—®ï¼Œè¯·éšæ—¶é€šè¿‡ <a href="http://www.codingexplorer.com/contact/" target="_blank" rel="noopener">è”ç³»é¡µé¢</a> æˆ–è€… <a href="https://twitter.com/CodingExplorer" target="_blank" rel="noopener">Twitter@CodingExplorer</a> ä¸æˆ‘è”ç³»ã€‚æˆ‘ä¼šå°½å¯èƒ½çš„å¸®åŠ©ä½ ã€‚è°¢è°¢ã€‚</p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="https://developer.apple.com/documentation/foundation/url" target="_blank" rel="noopener">URL Class Reference â€“ Apple Inc.</a></p><blockquote><p>æœ¬æ–‡ç”± SwiftGG ç¿»è¯‘ç»„ç¿»è¯‘ï¼Œå·²ç»è·å¾—ä½œè€…ç¿»è¯‘æˆæƒï¼Œæœ€æ–°æ–‡ç« è¯·è®¿é—® <a href="http://swift.gg">http://swift.gg</a>ã€‚</p></blockquote>]]></content>
    
    <summary type="html">
    
      æœ¬æ–‡ä»‹ç»äº†åŸºäº Swift 4.1.2 å’Œ Xcode 9.2 å¦‚ä½•åˆ›å»ºæˆ–è€…ä¿®æ”¹ä¸€ä¸ª URL çš„å¸¸ç”¨ API çš„æè¿°ã€‚
    
    </summary>
    
      <category term="codingexplorer" scheme="https://swift.gg/categories/codingexplorer/"/>
    
    
      <category term="Swift" scheme="https://swift.gg/tags/Swift/"/>
    
  </entry>
  
</feed>
