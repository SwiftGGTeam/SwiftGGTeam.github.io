<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>SwiftGG</title>
  
  <subtitle>èµ°å¿ƒçš„ Swift ç¿»è¯‘ç»„</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://swift.gg/"/>
  <updated>2018-09-10T03:53:25.085Z</updated>
  <id>https://swift.gg/</id>
  
  <author>
    <name>SwiftGG</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Never</title>
    <link href="https://swift.gg/2018/08/30/never/"/>
    <id>https://swift.gg/2018/08/30/never/</id>
    <published>2018-08-30T00:00:00.000Z</published>
    <updated>2018-09-10T03:53:25.085Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ä½œè€…ï¼šMattï¼Œ<a href="https://nshipster.com/never/" target="_blank" rel="noopener">åŸæ–‡é“¾æ¥</a>ï¼ŒåŸæ–‡æ—¥æœŸï¼š2018-07-30<br>è¯‘è€…ï¼š<a href="https://github.com/mobilefellow" target="_blank" rel="noopener">é›¨è°¨</a>ï¼›æ ¡å¯¹ï¼š<a href="http://numbbbbb.com/" target="_blank" rel="noopener">numbbbbb</a>ï¼Œ<a href="undefined">wongzigii</a>ï¼Œ<a href="undefined">Firecrest</a>ï¼›å®šç¨¿ï¼š<a href="https://github.com/chenmingbiao" target="_blank" rel="noopener">CMB</a></p></blockquote><!--æ­¤å¤„å¼€å§‹æ­£æ–‡--><p><code>Never</code> æ˜¯ä¸€ä¸ªçº¦å®šï¼Œè¡¨ç¤ºä¸€ä»¶äº‹åœ¨è¿‡å»æˆ–æœªæ¥çš„ä»»ä½•æ—¶æ®µéƒ½ä¸ä¼šå‘ç”Ÿã€‚å®ƒæ˜¯æ—¶é—´è½´ä¸Šçš„ä¸€ç§é€»è¾‘ä¸Šçš„ä¸å¯èƒ½ï¼Œåœ¨ä»»ä½•æ–¹å‘å»¶å±•å¼€å»éƒ½æ²¡æœ‰å¯èƒ½ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆåœ¨ä»£ç ä¸­çœ‹åˆ° <a href="https://github.com/search?q=%22this+will+never+happen%22&amp;type=Code" target="_blank" rel="noopener">è¿™æ ·çš„æ³¨é‡Š</a> ä¼šç‰¹åˆ«è®©äººä¸å®‰ã€‚</p><a id="more"></a><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// è¿™ä¸ªä¸ä¼šå‘ç”Ÿ</span></span><br></pre></td></tr></table></figure><p>æ‰€æœ‰ç¼–è¯‘å™¨çš„æ•™ç§‘ä¹¦éƒ½ä¼šå‘Šè¯‰ä½ ï¼Œè¿™æ ·ä¸€å¥æ³¨é‡Šä¸èƒ½ä¹Ÿä¸ä¼šå¯¹ç¼–è¯‘å‡ºçš„ä»£ç äº§ç”Ÿä»»ä½•å½±å“ã€‚<a href="https://en.wikipedia.org/wiki/Murphy%27s_law" target="_blank" rel="noopener">å¢¨è²å®šç†</a> å‘Šè¯‰ä½ å¹¶éå¦‚æ­¤ï¼Œæ³¨é‡Šä»¥ä¸‹çš„ä»£ç ä¸€å®šä¼šè¢«è§¦å‘ã€‚</p><p>é‚£ Swift æ˜¯å¦‚ä½•åœ¨è¿™ç§æ— æ³•é¢„æµ‹çš„ã€æ··ä¹±çš„å¼€å‘è¿‡ç¨‹ä¸­ä¿è¯å®‰å…¨å‘¢ï¼Ÿç­”æ¡ˆéš¾ä»¥ç½®ä¿¡ï¼šâ€œ<strong>ä»€ä¹ˆéƒ½ä¸åš</strong>â€ï¼Œä»¥åŠâ€œ<strong>å´©æºƒ</strong>â€ã€‚</p><hr><p>ä½¿ç”¨ <code>Never</code> æ›¿æ¢ <code>@noreturn</code> ä¿®é¥°ç¬¦ï¼Œæ˜¯ç”± <a href="https://github.com/jckarter" target="_blank" rel="noopener">Joe Groff</a> åœ¨ <a href="https://github.com/apple/swift-evolution/blob/master/proposals/0102-noreturn-bottom-type.md" target="_blank" rel="noopener">SE-0102: â€œRemove @noreturn attribute and introduce an empty Never typeâ€</a> ä¸­æå‡ºçš„ã€‚</p><p>åœ¨ Swift 3 ä¹‹å‰ï¼Œé‚£äº›è¦ä¸­æ–­æ‰§è¡Œçš„å‡½æ•°ï¼Œæ¯”å¦‚ <code>fatalError(_:file:line:)</code>ï¼Œ<code>abort()</code> å’Œ <code>exit(_:)</code>ï¼Œéœ€è¦ä½¿ç”¨ <code>@noreturn</code> ä¿®é¥°ç¬¦æ¥å£°æ˜ï¼Œè¿™ä¼šå‘Šè¯‰ç¼–è¯‘å™¨ï¼Œæ‰§è¡Œå®Œæˆåä¸ç”¨è¿”å›è°ƒç”¨è¿™ä¸ªå‡½æ•°çš„ä½ç½®ã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Swift &lt; 3.0</span></span><br><span class="line"><span class="meta">@noreturn</span> <span class="function"><span class="keyword">func</span> <span class="title">fatalError</span><span class="params">(<span class="number">_</span> message: <span class="params">()</span></span></span> -&gt; <span class="type">String</span> = <span class="type">String</span>(),</span><br><span class="line">                               file: <span class="type">StaticString</span> = #file,</span><br><span class="line">                               line: <span class="type">UInt</span> = #line)</span><br></pre></td></tr></table></figure><p>ä» Swift 3 å¼€å§‹ï¼Œ<code>fatalError</code> å’Œå®ƒçš„ç›¸å…³å‡½æ•°éƒ½è¢«å£°æ˜ä¸ºè¿”å› <code>Never</code> ç±»å‹ã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Swift &gt;= 3.0</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">fatalError</span><span class="params">(<span class="number">_</span> message: @autoclosure <span class="params">()</span></span></span> -&gt; <span class="type">String</span> = <span class="type">String</span>(),</span><br><span class="line">                     file: <span class="type">StaticString</span> = #file,</span><br><span class="line">                     line: <span class="type">UInt</span> = #line) -&gt; <span class="type">Never</span></span><br></pre></td></tr></table></figure><p>ä½œä¸ºä¸€ä¸ªæ³¨é‡Šçš„æ›¿ä»£å“ï¼Œå®ƒè‚¯å®šæ˜¯å¾ˆå¤æ‚çš„ï¼Œå¯¹å—ï¼ŸNOï¼äº‹å®ä¸Šï¼Œæ°æ°ç›¸åï¼Œ<code>Never</code> å¯ä»¥è¯´æ˜¯æ•´ä¸ª Swift æ ‡å‡†åº“ä¸­æœ€ç®€å•çš„ä¸€ä¸ªç±»å‹ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">Never</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure><h2 id="æ— å®ä¾‹ç±»å‹ï¼ˆUninhabited-Typesï¼‰"><a href="#æ— å®ä¾‹ç±»å‹ï¼ˆUninhabited-Typesï¼‰" class="headerlink" title="æ— å®ä¾‹ç±»å‹ï¼ˆUninhabited Typesï¼‰"></a>æ— å®ä¾‹ç±»å‹ï¼ˆ<code>Uninhabited Types</code>ï¼‰</h2><p><code>Never</code> æ˜¯ä¸€ä¸ª<em>æ— å®ä¾‹</em>ï¼ˆ<em>Uninhabited</em>ï¼‰ç±»å‹ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒæ²¡æœ‰ä»»ä½•å€¼ã€‚æˆ–è€…æ¢å¥è¯è¯´ï¼Œæ— å®ä¾‹ç±»å‹æ˜¯æ— æ³•è¢«æ„å»ºçš„ã€‚</p><p>åœ¨ Swift ä¸­ï¼Œæ²¡æœ‰å®šä¹‰ä»»ä½• <code>case</code> çš„æšä¸¾æ˜¯æœ€å¸¸è§çš„ä¸€ç§æ— å®ä¾‹ç±»å‹ã€‚è·Ÿç»“æ„ä½“å’Œç±»ä¸åŒï¼Œæšä¸¾æ²¡æœ‰åˆå§‹åŒ–æ–¹æ³•ã€‚è·Ÿåè®®ä¹Ÿä¸åŒï¼Œæšä¸¾æ˜¯ä¸€ä¸ªå…·ä½“çš„ç±»å‹ï¼Œå¯ä»¥åŒ…å«å±æ€§ã€æ–¹æ³•ã€æ³›å‹çº¦æŸå’ŒåµŒå¥—ç±»å‹ã€‚æ­£å› å¦‚æ­¤ï¼ŒSwift æ ‡å‡†åº“å¹¿æ³›ä½¿ç”¨æ— å®ä¾‹çš„æšä¸¾ç±»å‹æ¥åšè¯¸å¦‚ <a href="https://github.com/apple/swift/blob/a4230ab2ad37e37edc9ed86cd1510b7c016a769d/stdlib/public/core/Unicode.swift#L918" target="_blank" rel="noopener">å®šä¹‰å‘½åç©ºé—´</a> ä»¥åŠ <a href="https://github.com/apple/swift/blob/a6952decab6f918a9df3c6fa342153a9f9204f8e/stdlib/public/core/MemoryLayout.swift#L43" target="_blank" rel="noopener">æ ‡è¯†ç±»å‹çš„å«ä¹‰</a> ä¹‹ç±»çš„äº‹æƒ…ã€‚</p><p>ä½† <code>Never</code> å¹¶ä¸è¿™æ ·ã€‚å®ƒæ²¡æœ‰ä»€ä¹ˆèŠ±å“¨çš„ä¸œè¥¿ï¼Œå®ƒçš„ç‰¹åˆ«ä¹‹å¤„å°±åœ¨äºï¼Œå®ƒå°±æ˜¯å®ƒè‡ªå·±ï¼ˆæˆ–è€…è¯´ï¼Œå®ƒä»€ä¹ˆéƒ½ä¸æ˜¯ï¼‰ã€‚</p><p>è¯•æƒ³ä¸€ä¸ªè¿”å›å€¼ä¸ºæ— å®ä¾‹ç±»å‹çš„å‡½æ•°ï¼šå› ä¸ºæ— å®ä¾‹ç±»å‹æ²¡æœ‰ä»»ä½•å€¼ï¼Œæ‰€ä»¥è¿™ä¸ªå‡½æ•°æ— æ³•æ­£å¸¸çš„è¿”å›ã€‚ï¼ˆå®ƒè¦å¦‚ä½•ç”Ÿæˆè¿™ä¸ªè¿”å›å€¼å‘¢ï¼Ÿï¼‰æ‰€ä»¥ï¼Œè¿™ä¸ªå‡½æ•°è¦ä¹ˆåœæ­¢è¿è¡Œï¼Œè¦ä¹ˆæ— ä¼‘æ­¢çš„ä¸€ç›´è¿è¡Œä¸‹å»ã€‚</p><h2 id="æ¶ˆé™¤æ³›å‹ä¸­çš„ä¸å¯èƒ½çŠ¶æ€"><a href="#æ¶ˆé™¤æ³›å‹ä¸­çš„ä¸å¯èƒ½çŠ¶æ€" class="headerlink" title="æ¶ˆé™¤æ³›å‹ä¸­çš„ä¸å¯èƒ½çŠ¶æ€"></a>æ¶ˆé™¤æ³›å‹ä¸­çš„ä¸å¯èƒ½çŠ¶æ€</h2><p>ä»ç†è®ºè§’åº¦ä¸Šè¯´ï¼Œ<code>Never</code> ç¡®å®å¾ˆæœ‰æ„æ€ï¼Œä½†å®ƒåœ¨å®é™…åº”ç”¨ä¸­åˆèƒ½å¸®æˆ‘ä»¬åšä»€ä¹ˆå‘¢ï¼Ÿ</p><p>åšä¸äº†ä»€ä¹ˆï¼Œæˆ–è€…è¯´åœ¨ <a href="https://github.com/apple/swift-evolution/blob/master/proposals/0215-conform-never-to-hashable-and-equatable.md#conform-never-to-equatable-and-hashable" target="_blank" rel="noopener">SE-0215: Conform Never to Equatable and Hashable</a> æ¨å‡ºä»¥å‰ï¼Œåšä¸äº†ä»€ä¹ˆã€‚</p><p><a href="https://github.com/mdiep" target="_blank" rel="noopener">Matt Diephouse</a> åœ¨ææ¡ˆä¸­è§£é‡Šäº†ä¸ºä»€ä¹ˆè®©è¿™ä¸ªä»¤äººè´¹è§£çš„ç±»å‹å»éµå®ˆ <code>Equatable</code> å’Œå…¶ä»–åè®®ï¼š</p><blockquote><p><code>Never</code> åœ¨è¡¨ç¤ºä¸å¯èƒ½æ‰§è¡Œçš„ä»£ç æ–¹é¢éå¸¸æœ‰ç”¨ã€‚å¤§éƒ¨åˆ†äººç†Ÿæ‚‰å®ƒï¼Œæ˜¯å› ä¸ºå®ƒæ˜¯ <code>fatalError</code> ç­‰æ–¹æ³•çš„è¿”å›å€¼ï¼Œä½† <code>Never</code> åœ¨æ³›å‹æ–¹é¢ä¹Ÿéå¸¸æœ‰ç”¨ã€‚æ¯”å¦‚è¯´ï¼Œä¸€ä¸ª <code>Result</code> ç±»å‹å¯èƒ½ä½¿ç”¨ <code>Never</code> ä½œä¸ºå®ƒçš„ <code>Value</code>ï¼Œè¡¨ç¤ºæŸç§ä¸œè¥¿ä¸€ç›´æ˜¯é”™è¯¯çš„ï¼Œæˆ–è€…ä½¿ç”¨ <code>Never</code> ä½œä¸ºå®ƒçš„ <code>Error</code>ï¼Œè¡¨ç¤ºæŸç§ä¸œè¥¿ä¸€ç›´ä¸æ˜¯é”™è¯¯çš„ã€‚</p></blockquote><p>Swift æ²¡æœ‰æ ‡å‡†çš„ <code>Result</code> ç±»å‹ï¼Œå¤§éƒ¨åˆ†æƒ…å†µä¸‹å®ƒä»¬æ˜¯è¿™ä¸ªæ ·å­çš„ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">Result</span>&lt;<span class="title">Value</span>, <span class="title">Error</span>: <span class="title">Swift</span>.<span class="title">Error</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">case</span> success(<span class="type">Value</span>)</span><br><span class="line">    <span class="keyword">case</span> failure(<span class="type">Error</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>Result</code> ç±»å‹è¢«ç”¨æ¥å°è£…å¼‚æ­¥æ“ä½œç”Ÿæˆçš„è¿”å›å€¼å’Œå¼‚å¸¸ï¼ˆåŒæ­¥æ“ä½œå¯ä»¥ä½¿ç”¨ <code>throw</code> æ¥è¿”å›å¼‚å¸¸ï¼‰ã€‚</p><p>æ¯”å¦‚è¯´ï¼Œä¸€ä¸ªå‘é€å¼‚æ­¥ HTTP è¯·æ±‚çš„å‡½æ•°å¯èƒ½ä½¿ç”¨ <code>Result</code> ç±»å‹æ¥å­˜å‚¨å“åº”æˆ–é”™è¯¯ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">fetch</span><span class="params">(<span class="number">_</span> request: Request, completion: <span class="params">(Result&lt;Response, Error&gt;)</span></span></span> -&gt; <span class="type">Void</span>) &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è°ƒç”¨è¿™ä¸ªæ–¹æ³•åï¼Œä½ å¯ä»¥ä½¿ç”¨ <code>switch</code> æ¥åˆ†åˆ«å¤„ç†å®ƒçš„ <code>.success</code> å’Œ <code>.failure</code>ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">fetch(request) &#123; result <span class="keyword">in</span></span><br><span class="line">    <span class="keyword">switch</span> result &#123;</span><br><span class="line">    <span class="keyword">case</span> .success(<span class="keyword">let</span> value):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"Success: <span class="subst">\(value)</span>"</span>)</span><br><span class="line">    <span class="keyword">case</span> .failure(<span class="keyword">let</span> error):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"Failure: <span class="subst">\(error)</span>"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç°åœ¨å‡è®¾æœ‰ä¸€ä¸ªå‡½æ•°ä¼šåœ¨å®ƒçš„ <code>completion</code> ä¸­æ°¸è¿œè¿”å›æˆåŠŸç»“æœï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">alwaysSucceeds</span><span class="params">(<span class="number">_</span> completion: <span class="params">(Result&lt;String, Never&gt;)</span></span></span> -&gt; <span class="type">Void</span>) &#123;</span><br><span class="line">    completion(.success(<span class="string">"yes!"</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å°† <code>Result</code> çš„ <code>Error</code> ç±»å‹æŒ‡å®šä¸º <code>Never</code> åï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç±»å‹æ£€æµ‹ä½“ç³»æ¥è¡¨æ˜å¤±è´¥æ˜¯æ°¸è¿œä¸å¯èƒ½å‘ç”Ÿçš„ã€‚è¿™æ ·åšçš„å¥½å¤„åœ¨äºï¼Œä½ ä¸éœ€è¦å¤„ç† <code>.failure</code>ï¼ŒSwift å¯ä»¥æ¨æ–­å‡ºè¿™ä¸ª <code>switch</code> è¯­å¥å·²ç»å¤„ç†äº†æ‰€æœ‰æƒ…å†µã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">alwaysSucceeds &#123; (result) <span class="keyword">in</span></span><br><span class="line">    <span class="keyword">switch</span> result &#123;</span><br><span class="line">    <span class="keyword">case</span> .success(<span class="keyword">let</span> string):</span><br><span class="line">        <span class="built_in">print</span>(string)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸‹é¢è¿™ä¸ªä¾‹å­æ˜¯è®© <code>Never</code> éµå¾ª <code>Comparable</code> åè®®ï¼Œè¿™æ®µä»£ç æŠŠ <code>Never</code> ç”¨åˆ°äº†æè‡´ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Never</span>: <span class="title">Comparable</span> </span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> &lt; (lhs: Never, rhs: Never) -&gt; <span class="title">Bool</span> </span>&#123;</span><br><span class="line">    <span class="keyword">switch</span> (lhs, rhs) &#123;&#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å› ä¸º <code>Never</code> æ˜¯ä¸€ä¸ªæ— å®ä¾‹ç±»å‹ï¼Œæ‰€ä»¥å®ƒæ²¡æœ‰ä»»ä½•å¯èƒ½çš„å€¼ã€‚æ‰€ä»¥å½“æˆ‘ä»¬ä½¿ç”¨ <code>switch</code> éå†å®ƒçš„ <code>lhs</code> å’Œ <code>rhs</code> æ—¶ï¼ŒSwift å¯ä»¥ç¡®å®šæ‰€æœ‰çš„å¯èƒ½æ€§éƒ½éå†äº†ã€‚æ—¢ç„¶æ‰€æœ‰çš„å¯èƒ½æ€§ â€” å®é™…ä¸Šè¿™é‡Œä¸å­˜åœ¨ä»»ä½•å€¼ â€” éƒ½è¿”å›äº† <code>Bool</code>ï¼Œé‚£ä¹ˆè¿™ä¸ªæ–¹æ³•å°±å¯ä»¥æ­£å¸¸ç¼–è¯‘ã€‚</p><p><em>å·¥æ•´ï¼</em></p><h2 id="ä½¿ç”¨-Never-ä½œä¸ºå…œåº•ç±»å‹"><a href="#ä½¿ç”¨-Never-ä½œä¸ºå…œåº•ç±»å‹" class="headerlink" title="ä½¿ç”¨ Never ä½œä¸ºå…œåº•ç±»å‹"></a>ä½¿ç”¨ <code>Never</code> ä½œä¸ºå…œåº•ç±»å‹</h2><p><strong>å®é™…ä¸Šï¼Œå…³äº <code>Never</code> çš„ Swift Evolution ææ¡ˆä¸­å·²ç»æš—ç¤ºäº†è¿™ä¸ªç±»å‹åœ¨æœªæ¥å¯èƒ½æœ‰æ›´å¤šç”¨å¤„ï¼š</strong></p><blockquote><p>ä¸€ä¸ªæ— å®ä¾‹ç±»å‹å¯ä»¥ä½œä¸ºå…¶ä»–ä»»æ„ç±»å‹çš„å­ç±»å‹ â€” å¦‚æœæŸä¸ªè¡¨è¾¾å¼æ ¹æœ¬ä¸å¯èƒ½äº§ç”Ÿä»»ä½•ç»“æœï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±ä¸éœ€è¦å…³å¿ƒè¿™ä¸ªè¡¨è¾¾å¼çš„ç±»å‹åˆ°åº•æ˜¯ä»€ä¹ˆã€‚å¦‚æœç¼–è¯‘å™¨æ”¯æŒè¿™ä¸€ç‰¹æ€§ï¼Œå°±å¯ä»¥å®ç°å¾ˆå¤šæœ‰ç”¨çš„åŠŸèƒ½â€¦â€¦</p></blockquote><h3 id="è§£åŒ…æˆ–è€…æ­»äº¡"><a href="#è§£åŒ…æˆ–è€…æ­»äº¡" class="headerlink" title="è§£åŒ…æˆ–è€…æ­»äº¡"></a>è§£åŒ…æˆ–è€…æ­»äº¡</h3><p>å¼ºåˆ¶è§£åŒ…æ“ä½œï¼ˆ<code>!</code>ï¼‰æ˜¯ Swift ä¸­æœ€å…·äº‰è®®çš„éƒ¨åˆ†ä¹‹ä¸€ã€‚ï¼ˆåœ¨ä»£ç ä¸­ä½¿ç”¨è¿™ä¸ªæ“ä½œç¬¦ï¼‰å¾€å¥½äº†è¯´ï¼Œæ˜¯æœ‰æ„ä¸ºä¹‹ï¼ˆåœ¨å¼‚å¸¸æ—¶æ•…æ„è®©ç¨‹åºå´©æºƒï¼‰ï¼›å¾€åäº†è¯´ï¼Œå¯èƒ½è¡¨ç¤ºä½¿ç”¨è€…æ²¡æœ‰è®¤çœŸæ€è€ƒã€‚åœ¨ç¼ºä¹å…¶ä»–ä¿¡æ¯çš„æƒ…å†µä¸‹ï¼Œå¾ˆéš¾çœ‹å‡ºè¿™ä¸¤è€…çš„åŒºåˆ«ã€‚</p><p>æ¯”å¦‚ï¼Œä¸‹é¢çš„ä»£ç å‡å®šæ•°ç»„ä¸€å®šä¸ä¸ºç©ºï¼Œ</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> array: [<span class="type">Int</span>]</span><br><span class="line"><span class="keyword">let</span> firstIem = array.first!</span><br></pre></td></tr></table></figure><p>ä¸ºäº†é¿å…å¼ºåˆ¶è§£åŒ…ï¼Œä½ å¯ä»¥ä½¿ç”¨å¸¦æ¡ä»¶èµ‹å€¼çš„ <code>guard</code> è¯­å¥ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> array: [<span class="type">Int</span>]</span><br><span class="line"><span class="keyword">guard</span> <span class="keyword">let</span> firstItem = array.first <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">fatalError</span>(<span class="string">"array cannot be empty"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœªæ¥ï¼Œå¦‚æœ <code>Never</code> æˆä¸ºå…œåº•ç±»å‹ï¼Œå®ƒå°±å¯ä»¥ç”¨åœ¨ <code>nil-coalescing operator</code> è¡¨è¾¾å¼çš„å³è¾¹ã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æœªæ¥çš„ Swift å†™æ³•? ğŸ”®</span></span><br><span class="line"><span class="keyword">let</span> firstItem = array.first ?? <span class="built_in">fatalError</span>(<span class="string">"array cannot be empty"</span>)</span><br></pre></td></tr></table></figure><p>å¦‚æœä½ æƒ³ç°åœ¨å°±ä½¿ç”¨è¿™ç§æ¨¡å¼ï¼Œå¯ä»¥æ‰‹åŠ¨é‡è½½ <code>??</code> è¿ç®—ç¬¦ï¼ˆä½†æ˜¯â€¦â€¦ï¼‰ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> ?? &lt;T&gt;<span class="params">(lhs: T?, rhs: @autoclosure <span class="params">()</span></span></span> -&gt; <span class="type">Never</span>) -&gt; <span class="type">T</span> &#123;</span><br><span class="line">    <span class="keyword">switch</span> lhs &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="keyword">let</span> value?:</span><br><span class="line">        <span class="keyword">return</span> value</span><br><span class="line">    <span class="keyword">case</span> <span class="literal">nil</span>:</span><br><span class="line">        rhs()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>åœ¨æ‹’ç» <a href="https://github.com/apple/swift-evolution/blob/master/proposals/0217-bangbang.md#on-forced-unwraps" target="_blank" rel="noopener">SE-0217: Introducing the !! â€œUnwrap or Dieâ€ operator to the Swift Standard Library</a> çš„<a href="https://forums.swift.org/t/se-0217-the-unwrap-or-die-operator/14107/222" target="_blank" rel="noopener">åŸå› è¯´æ˜</a>ä¸­, <a href="https://github.com/jckarter" target="_blank" rel="noopener">Joe Groff</a> æåˆ°ï¼Œâ€œæˆ‘ä»¬å‘ç°é‡è½½ [?? for Never] ä¼šå¯¹ç±»å‹æ£€æµ‹çš„æ€§èƒ½äº§ç”Ÿéš¾ä»¥æ¥å—çš„å½±å“â€ã€‚æ‰€ä»¥ï¼Œä¸å»ºè®®ä½ åœ¨è‡ªå·±çš„ä»£ç ä¸­æ·»åŠ ä¸Šé¢çš„ä»£ç ã€‚</p></blockquote><h3 id="è¡¨è¾¾å¼é£æ ¼çš„-Throw"><a href="#è¡¨è¾¾å¼é£æ ¼çš„-Throw" class="headerlink" title="è¡¨è¾¾å¼é£æ ¼çš„ Throw"></a>è¡¨è¾¾å¼é£æ ¼çš„ Throw</h3><p>ç±»ä¼¼çš„ï¼Œå¦‚æœ <code>throw</code> å¯ä»¥ä»è¯­å¥å˜æˆä¸€ä¸ªè¿”å› <code>Never</code>çš„è¡¨è¾¾å¼ï¼Œä½ å°±å¯ä»¥åœ¨ <code>??</code> å³è¾¹ä½¿ç”¨ <code>throw</code>ã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æœªæ¥çš„ Swift å†™æ³•? ğŸ”®</span></span><br><span class="line"><span class="keyword">let</span> firstItem = array.first ?? <span class="keyword">throw</span> <span class="type">Error</span>.empty</span><br></pre></td></tr></table></figure><h3 id="å¸¦ç±»å‹çš„-Throw"><a href="#å¸¦ç±»å‹çš„-Throw" class="headerlink" title="å¸¦ç±»å‹çš„ Throw"></a>å¸¦ç±»å‹çš„ <code>Throw</code></h3><p>ç»§ç»­ç ”ç©¶ä¸‹å»ï¼šå¦‚æœå‡½æ•°å£°æ˜çš„ <code>throw</code> å…³é”®å­—æ”¯æŒç±»å‹çº¦æŸï¼Œé‚£ä¹ˆ <code>Never</code> å¯ä»¥ç”¨æ¥è¡¨æ˜æŸä¸ªå‡½æ•°ç»å¯¹ä¸ä¼šæŠ›å‡ºå¼‚å¸¸ï¼ˆç±»ä¼¼äºåœ¨ä¸Šé¢çš„ <code>Result</code> ä¾‹å­ï¼‰ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æœªæ¥çš„ Swift å†™æ³•? ğŸ”®</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">neverThrows</span><span class="params">()</span></span> <span class="keyword">throws</span>&lt;<span class="type">Never</span>&gt; &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">neverThrows() <span class="comment">// æ— éœ€ä½¿ç”¨ `try` ï¼Œå› ä¸ºç¼–è¯‘å™¨ä¿è¯å®ƒä¸€å®šæˆåŠŸï¼ˆå¯èƒ½ï¼‰</span></span><br></pre></td></tr></table></figure><hr><p>å£°ç§°æŸä¸ªäº‹æƒ…æ°¸è¿œä¸å¯èƒ½å‘ç”Ÿï¼Œå°±åƒæ˜¯å‘æ•´ä¸ªå®‡å®™å‘å‡ºé‚€è¯·ï¼Œæ¥è¯æ˜å®ƒæ˜¯é”™çš„ä¸€æ ·ã€‚æƒ…æ€é€»è¾‘ï¼ˆmodal logicï¼‰æˆ–è€…ä¿¡å¿µé€»è¾‘ï¼ˆdoxastic logicï¼‰å…è®¸ä¿é¢å­å¼çš„å¦¥åï¼ˆâ€œ<em>å®ƒå½“æ—¶æ˜¯å¯¹çš„ï¼Œæˆ–è€…æˆ‘æ˜¯è¿™ä¹ˆè®¤ä¸ºçš„ï¼</em>â€ï¼‰ï¼Œä½†æ—¶æ€é€»è¾‘ï¼ˆtemporal logicï¼‰ä¼¼ä¹å°†è¿™ä¸ªçº¦å®šæåˆ°äº†æ›´é«˜çš„ä¸€ä¸ªæ ‡å‡†ã€‚</p><p>å¹¸è¿çš„æ˜¯ï¼Œå¾—ç›Šäºæœ€ä¸åƒç±»å‹çš„ <code>Never</code>ï¼ŒSwift åˆ°è¾¾äº†è¿™ä¸ªé«˜æ ‡å‡†ã€‚</p><blockquote><p>æœ¬æ–‡ç”± SwiftGG ç¿»è¯‘ç»„ç¿»è¯‘ï¼Œå·²ç»è·å¾—ä½œè€…ç¿»è¯‘æˆæƒï¼Œæœ€æ–°æ–‡ç« è¯·è®¿é—® <a href="http://swift.gg">http://swift.gg</a>ã€‚</p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;ä½œè€…ï¼šMattï¼Œ&lt;a href=&quot;https://nshipster.com/never/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;åŸæ–‡é“¾æ¥&lt;/a&gt;ï¼ŒåŸæ–‡æ—¥æœŸï¼š2018-07-30&lt;br&gt;è¯‘è€…ï¼š&lt;a href=&quot;https://github.com/mobilefellow&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;é›¨è°¨&lt;/a&gt;ï¼›æ ¡å¯¹ï¼š&lt;a href=&quot;http://numbbbbb.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;numbbbbb&lt;/a&gt;ï¼Œ&lt;a href=&quot;undefined&quot;&gt;wongzigii&lt;/a&gt;ï¼Œ&lt;a href=&quot;undefined&quot;&gt;Firecrest&lt;/a&gt;ï¼›å®šç¨¿ï¼š&lt;a href=&quot;https://github.com/chenmingbiao&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;CMB&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;!--æ­¤å¤„å¼€å§‹æ­£æ–‡--&gt;
&lt;p&gt;&lt;code&gt;Never&lt;/code&gt; æ˜¯ä¸€ä¸ªçº¦å®šï¼Œè¡¨ç¤ºä¸€ä»¶äº‹åœ¨è¿‡å»æˆ–æœªæ¥çš„ä»»ä½•æ—¶æ®µéƒ½ä¸ä¼šå‘ç”Ÿã€‚å®ƒæ˜¯æ—¶é—´è½´ä¸Šçš„ä¸€ç§é€»è¾‘ä¸Šçš„ä¸å¯èƒ½ï¼Œåœ¨ä»»ä½•æ–¹å‘å»¶å±•å¼€å»éƒ½æ²¡æœ‰å¯èƒ½ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆåœ¨ä»£ç ä¸­çœ‹åˆ° &lt;a href=&quot;https://github.com/search?q=%22this+will+never+happen%22&amp;amp;type=Code&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;è¿™æ ·çš„æ³¨é‡Š&lt;/a&gt; ä¼šç‰¹åˆ«è®©äººä¸å®‰ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="NSHipster" scheme="https://swift.gg/categories/NSHipster/"/>
    
    
      <category term="Swift" scheme="https://swift.gg/tags/Swift/"/>
    
  </entry>
  
  <entry>
    <title>Swift 4 æ³›å‹ï¼šå¦‚ä½•åœ¨ä½ çš„ä»£ç æˆ–Appé‡Œåº”ç”¨æ³›å‹</title>
    <link href="https://swift.gg/2018/08/28/swift-generics/"/>
    <id>https://swift.gg/2018/08/28/swift-generics/</id>
    <published>2018-08-28T00:00:00.000Z</published>
    <updated>2018-09-10T03:53:25.085Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ä½œè€…ï¼šAndrew Jaffeeï¼Œ<a href="https://appcoda.com/swift-generics" target="_blank" rel="noopener">åŸæ–‡é“¾æ¥</a>ï¼ŒåŸæ–‡æ—¥æœŸï¼š2018-02-14<br>è¯‘è€…ï¼š<a href="https://github.com/Adolf-L" target="_blank" rel="noopener">BigLuo</a>ï¼›æ ¡å¯¹ï¼š<a href="http://numbbbbb.com/" target="_blank" rel="noopener">numbbbbb</a>ï¼Œ<a href="http://muhlenxi.com/" target="_blank" rel="noopener">muhlenXi</a>ï¼›å®šç¨¿ï¼š<a href="https://github.com/chenmingbiao" target="_blank" rel="noopener">CMB</a></p></blockquote><!--æ­¤å¤„å¼€å§‹æ­£æ–‡--><p>é—®é¢˜ 1ï¼šæˆ‘èƒ½å¦å†™ä¸€ä¸ª Swift å‡½æ•°ç”¨äºæŸ¥æ‰¾åœ¨<strong>ä»»æ„æ•°ç»„</strong>ä¸­å­˜å‚¨çš„<strong>ä»»æ„ç±»å‹</strong>çš„<strong>ä»»ä½•å®ä¾‹å¯¹è±¡</strong>çš„ä½ç½®\ç´¢å¼•ã€‚</p><p>é—®é¢˜ 2ï¼šæˆ‘èƒ½å¦å†™ä¸€ä¸ª Swift å‡½æ•°ç”¨äºç¡®å®šåœ¨<strong>ä»»æ„æ•°ç»„</strong>ä¸­å­˜å‚¨çš„<strong>ä»»æ„ç±»å‹</strong>çš„<strong>ä»»ä½•å®ä¾‹å¯¹è±¡</strong>çš„ç±»å‹ã€‚</p><p>æˆ‘æ‰€è¯´çš„ â€œä»»ä½•ç±»å‹â€ï¼ŒåŒ…æ‹¬è‡ªå®šä¹‰ç±»å‹ï¼Œæ¯”å¦‚æˆ‘ä»¬è‡ªå·±å®šä¹‰çš„ Class ç±»å‹ã€‚æç¤ºï¼šæˆ‘çŸ¥é“æˆ‘èƒ½å¤Ÿç”¨ Swift <code>Array</code> ç±»å‹çš„å†…ç½®æ–¹æ³•ï¼Œå¦‚ <code>index</code> å’Œ <code>contains</code>ï¼Œä½†ä»Šå¤©æˆ‘å°†ä¼šç”¨ç®€å•ä»£ç å®ä¾‹æ¥è¯´æ˜ Swift æ³›å‹ä¸­çš„ä¸€äº›ç‰¹æ€§ã€‚</p><a id="more"></a><p>ä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘å°†<strong>æ³›å‹ç¼–ç¨‹</strong>ä½œå¦‚ä¸‹å®šä¹‰ï¼š</p><blockquote><p>â€¦ a style of computer programming in which algorithms are written in terms of types to-be-specified-later that are then instantiated when needed for specific types provided as parameters. This approach, pioneered by ML in 1973, permits writing common functions or types that differ only in the set of types on which they operate when used, thus reducing duplication.</p></blockquote><blockquote><p>æ˜¯ä¸€ç§ç®—æ³•æœºåˆ¶ä¸º types to-be-specified-later (ç±»å‹ç¡®å®šæ»å)çš„è®¡ç®—æœºç¼–ç¨‹é£æ ¼ï¼Œå½“å…·ä½“çš„ç±»å‹ä½œä¸ºå‚æ•°ä¼ å…¥åï¼Œè¯¥ç®—æ³•æœºåˆ¶ä¼šå¯¹ç±»å‹è¿›è¡Œå®ä¾‹åŒ–ã€‚è¿™ä¸ªæ–¹æ³•ç”± â€œMLâ€ åœ¨ 1973 å¹´å¼€åˆ›ã€‚å¯ä»¥ç”¨å…±æœ‰çš„å‡½æ•°å’Œç±»å‹æ¥è¡¨ç¤ºä¸€ä¸ªç±»å‹é›†åˆä»è€Œæ¥å‡å°‘å‡½æ•°æ“ä½œçš„é‡å¤ã€‚</p></blockquote><p>ç‰¹åˆ«çš„æŒ‡å‡ºï¼Œæ¥è‡ª<a href="https://developer.apple.com/library/content/documentation/Swift/Conceptual/SwiftProgrammingLanguage/Generics.html" target="_blank" rel="noopener">è‹¹æœSwiftæ–‡æ¡£</a> å…³äºâ€æ³›å‹â€è¯é¢˜çš„è¯´æ˜ï¼š</p><blockquote><p>Generic code enables you to write flexible, reusable functions and types that can work with any type, subject to requirements that you define. You can write code that avoids duplication and expresses its intent in a clear, abstracted manner.</p><p>Generics are one of the most powerful features of  Swift , and much of the Swift standard library is built with generic code. â€¦ For example,  Swift â€™s Array and Dictionary types are both generic collections. You can create an array that holds Int values, or an array that holds String values, or indeed an array for any other type that can be created in  Swift . Similarly, you can create a dictionary to store values of any specified type, and there are no limitations on what that type can be. â€¦</p></blockquote><blockquote><p>æ³›å‹ç¼–ç èƒ½è®©ä½ å†™å‡ºç¬¦åˆéœ€æ±‚ã€æ”¯æŒä»»æ„ç±»å‹ï¼Œçµæ´»ã€å¯é‡ç”¨çš„å‡½æ•°ã€‚ä½ èƒ½å¤Ÿç¼–å†™é¿å…é‡å¤å’Œç¼–ç¨‹é£æ ¼æŠ½è±¡ã€æ¸…æ™°ã€ä¼˜é›…çš„ä»£ç ã€‚</p><p>æ³›å‹æ˜¯ Swift ä¸­æœ€å¼ºå¤§çš„ç‰¹æ€§ä¹‹ä¸€ï¼Œå¤§é‡çš„ Swift æ ‡å‡†åº“ä½¿ç”¨äº†æ³›å‹ç¼–ç ã€‚ä¾‹å¦‚ï¼Œ Swift çš„æ•°ç»„å’Œå­—å…¸éƒ½æ˜¯æ³›å‹é›†åˆã€‚ä½ å¯ä»¥åˆ›å»ºä¸€ä¸ªå­˜æœ‰æ•´å‹å€¼æˆ–è€…å­—ç¬¦ä¸²å€¼çš„æ•°ç»„ï¼Œæœ‰å¿…è¦çš„è¯ï¼Œè¿˜å¯ä»¥åˆ›å»ºä¸€ä¸ªä»»ä½• Swift æ”¯æŒç±»å‹çš„æ•°ç»„ã€‚ç±»ä¼¼çš„ï¼Œä½ ä¹Ÿå¯ä»¥åˆ›å»ºä¸€ä¸ªå­—å…¸ç”¨äºå­˜å‚¨ä»»æ„æŒ‡å®šç±»å‹çš„å€¼ã€‚</p></blockquote><p>æˆ‘ä¸€ç›´æå€¡æ„å»ºå¯å¤ç”¨ï¼Œç®€æ´ï¼Œå¯ç»´æŠ¤çš„ä»£ç ï¼Œå¯¹äº Swift ä¸­çš„æ³›å‹ï¼Œå¦‚æœè¿ç”¨æ°å½“ï¼Œèƒ½æŸç§ç¨‹åº¦ä¸Šå¸®åŠ©æˆ‘å®ç°ä¸Šé¢æåˆ°çš„æ•ˆæœã€‚æ‰€ä»¥å¯¹äºä¸Šé¢ä¸¤ä¸ªé—®é¢˜ï¼Œæˆ‘çš„ç­”æ¡ˆæ˜¯ â€œYESâ€ã€‚</p><h2 id="ç”Ÿæ´»åœ¨ä¸€ä¸ªç‰¹å®šç±»å‹ç¼–ç çš„ä¸–ç•Œ"><a href="#ç”Ÿæ´»åœ¨ä¸€ä¸ªç‰¹å®šç±»å‹ç¼–ç çš„ä¸–ç•Œ" class="headerlink" title="ç”Ÿæ´»åœ¨ä¸€ä¸ªç‰¹å®šç±»å‹ç¼–ç çš„ä¸–ç•Œ"></a>ç”Ÿæ´»åœ¨ä¸€ä¸ªç‰¹å®šç±»å‹ç¼–ç çš„ä¸–ç•Œ</h2><p>è®©æˆ‘ä»¬å†™ä¸€ä¸ª Swift çš„æ–¹æ³•æ¥è¯´æ˜åœ¨ä¸€ä¸ªå­—ç¬¦ä¸²æ•°ç»„ä¸­æ˜¯å¦å­˜åœ¨ç‰¹å®šçš„ä¸€ä¸ªå­—ç¬¦ä¸²ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">existsManual</span><span class="params">(item:String, inArray:[String])</span></span> -&gt; <span class="type">Bool</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">var</span> index:<span class="type">Int</span> = <span class="number">0</span></span><br><span class="line">    <span class="keyword">var</span> found = <span class="literal">false</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">while</span> (index &lt; inArray.<span class="built_in">count</span> &amp;&amp; found == <span class="literal">false</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> item == inArray[index]</span><br><span class="line">        &#123;</span><br><span class="line">            found = <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            index = index + <span class="number">1</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> found</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è®©æˆ‘ä»¬æµ‹è¯•è¿™ä¸ªæ–¹æ³•ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> strings = [<span class="string">"Ishmael"</span>, <span class="string">"Jacob"</span>, <span class="string">"Ezekiel"</span>]</span><br><span class="line"> </span><br><span class="line"><span class="keyword">let</span> nameExistsInArray = existsManual(item: <span class="string">"Ishmael"</span>, inArray: strings)</span><br><span class="line"><span class="comment">// returns true</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">let</span> nameExistsInArray1 = existsManual(item: <span class="string">"Bubba"</span>, inArray: strings)</span><br><span class="line"><span class="comment">// returns false</span></span><br></pre></td></tr></table></figure><p>åœ¨åˆ›å»ºäº†ç”¨äºæŸ¥æ‰¾ <code>String</code> æ•°ç»„çš„ <code>existsManual</code> å‡½æ•°åã€‚å‡å¦‚æˆ‘å†³å®šæƒ³è¦ä¸€äº›ç±»ä¼¼çš„å‡½æ•°ç”¨äºæœç´¢ <code>Integer</code>ï¼Œ<code>Float</code>ï¼Œå’Œ  <code>Double</code> æ•°ç»„ â€” ç”šè‡³ç”¨äºæŸ¥æ‰¾æ•°ç»„ä¸­è‡ªå®šä¹‰ç±»å‘¢ï¼Ÿæˆ‘æœ€ç»ˆèŠ±è´¹äº†å®è´µçš„æ—¶é—´å†™äº†å¾ˆå¤šåšåŒæ ·äº‹æƒ…çš„å‡½æ•°ã€‚æˆ‘éœ€è¦å†™å¾ˆå¤šä»£ç æ¥å®ç°ã€‚å¦‚æœæˆ‘å‘ç°äº†ä¸€ä¸ªæ–°çš„/æ›´å¿«çš„æœç´¢ç®—æ³•å‘¢ï¼Ÿåˆå¦‚æœåœ¨æˆ‘çš„æœç´¢ç®—æ³•æœ‰ä¸€ä¸ª bug å‘¢ï¼Ÿæˆ‘ä¸å¾—ä¸æ”¹å˜æˆ‘æ‰€æœ‰çš„æŸ¥æ‰¾æ–¹æ³•çš„ç‰ˆæœ¬ã€‚æˆ‘å‘ç°è¿™ç®€ç›´æ˜¯ä¸ªå¤ç”¨åœ°ç‹±ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">existsManual</span><span class="params">(item:String, inArray:[String])</span></span> -&gt; <span class="type">Bool</span></span><br><span class="line">...</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">existsManual</span><span class="params">(item:Int, inArray:[Int])</span></span> -&gt; <span class="type">Bool</span></span><br><span class="line">...</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">existsManual</span><span class="params">(item:Float, inArray:[Float])</span></span> -&gt; <span class="type">Bool</span></span><br><span class="line">...</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">existsManual</span><span class="params">(item:Double, inArray:[Double])</span></span> -&gt; <span class="type">Bool</span></span><br><span class="line">...</span><br><span class="line"><span class="comment">//  "Person"  is a custom class we'll create</span></span><br><span class="line"><span class="comment">//  "Person" æ˜¯æˆ‘ä»¬å°†è¦åˆ›å»ºçš„è‡ªå®šä¹‰çš„ç±»</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">existsManual</span><span class="params">(item:Person, inArray:[Person])</span></span> -&gt; <span class="type">Bool</span></span><br></pre></td></tr></table></figure><h2 id="é—®é¢˜"><a href="#é—®é¢˜" class="headerlink" title="é—®é¢˜"></a>é—®é¢˜</h2><p>æˆ‘ä»¬å·²ç»åŒçƒ¦äº†æ´»åœ¨ä¸€ä¸ªå¤„ç†ç±»å‹çš„ä¸–ç•Œé‡Œï¼Œä¸å¾—ä¸ä¸ºæ¯ä¸ªæˆ‘ä»¬æƒ³è¦æŸ¥æ‰¾çš„æ•°ç»„ç±»å‹åˆ›å»ºæ–°çš„æ–¹æ³•ã€‚ç»ˆç©¶è¿™ç»™æˆ‘ä»¬å¸¦æ¥äº†å¤§é‡çš„æŠ€æœ¯è´Ÿå€ºã€‚ç”±äºç°ä»£è½¯ä»¶éš¾ä»¥ç½®ä¿¡çš„å¤æ‚æ€§ï¼Œåƒä½ æˆ‘è¿™æ ·çš„å¼€å‘è€…éœ€è¦ä½¿ç”¨æ›´å¥½åœ°å®è·µï¼Œæ›´å¥½çš„æŠ€æœ¯ï¼Œæ›´å¥½çš„æ–¹æ³•ï¼Œç”¨æˆ‘ä»¬çš„ç¥ç»å…ƒæœ€å¤§ç¨‹åº¦çš„æ§åˆ¶è¿™ç§æ··ä¹±ã€‚æ®ä¼°è®¡ Window 7 åŒ…å«å¤§çº¦ 4 åƒä¸‡è¡Œä»£ç è€Œ macOS 10.4 (Tiger) åŒ…å«å¤§çº¦ 8.5 åƒä¸‡è¡Œä»£ç ï¼Œé¢„ä¼°åƒè¿™æ ·çš„ç³»ç»Ÿæ½œåœ¨è¡Œä¸ºæ¬¡æ•°éƒ½æ˜¯ä¸å¯èƒ½çš„ã€‚</p><h2 id="æ³›å‹çš„è§£å†³ä¹‹é“"><a href="#æ³›å‹çš„è§£å†³ä¹‹é“" class="headerlink" title="æ³›å‹çš„è§£å†³ä¹‹é“"></a>æ³›å‹çš„è§£å†³ä¹‹é“</h2><p>ï¼ˆå†æ¬¡ç´§è®°å­¦ä¹ æ³›å‹çš„ç›®çš„ï¼Œæˆ‘ä»¬ä¾æ—§å‡è®¾ Swift çš„æ•°ç»„ç±»å‹çš„å†…ç½®çš„å‡½æ•°ï¼Œ<code>index</code> å’Œ  <code>contains</code> ï¼Œä¸å­˜åœ¨ã€‚ï¼‰</p><p>è®©æˆ‘ä»¬å…ˆå°è¯•å†™è¿™æ ·ä¸€ä¸ª Swift å‡½æ•°ï¼Œåˆ¤æ–­ Swift çš„æ ‡å‡†ç±»å‹ï¼ˆä¾‹å¦‚ <code>String</code>ï¼Œ<code>Integer</code>ï¼Œ<code>Float</code> æˆ– <code>Double</code>ï¼‰çš„ä¸€ä¸ªç‰¹å®šå®ä¾‹æ˜¯å¦å­˜åœ¨äºè¿™ä¸ª Swift æ ‡å‡†ç±»å‹çš„æ•°ç»„ä¸­ã€‚æ€ä¹ˆåšå‘¢ï¼Ÿ</p><p>è®©æˆ‘ä»¬åˆ‡æ¢åˆ° Swift æ³›å‹ï¼Œç‰¹åˆ«æ˜¯æ³›å‹å‡½æ•°ï¼Œç±»å‹å‚æ•°ï¼Œç±»å‹çº¦æŸä»¥åŠ <code>Equatable</code> åè®®ã€‚åœ¨æ²¡æœ‰å®šä¹‰ä»»ä½•æœ¯è¯­å‰ï¼Œæˆ‘å†™äº†ä¸€äº›ä»£ç ï¼Œæ€è€ƒä¸€ä¸‹ä½ çœ‹åˆ°çš„ã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">exists</span>&lt;T: Equatable&gt;<span class="params">(item: T, inArray: [T])</span></span> -&gt; <span class="type">Bool</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">var</span> index:<span class="type">Int</span> = <span class="number">0</span></span><br><span class="line">    <span class="keyword">var</span> found = <span class="literal">false</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">while</span> (index &lt; inArray.<span class="built_in">count</span> &amp;&amp; found == <span class="literal">false</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> item == inArray[index]</span><br><span class="line">        &#123;</span><br><span class="line">            found = <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            index = index + <span class="number">1</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> found</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è®©æˆ‘ä»¬æµ‹è¯•ä¸‹æˆ‘æ–°å†™çš„æ³›å‹æ–¹æ³•</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> myFriends:[<span class="type">String</span>] = [<span class="string">"John"</span>, <span class="string">"Dave"</span>, <span class="string">"Jim"</span>]</span><br><span class="line"> </span><br><span class="line"><span class="keyword">let</span> isOneOfMyFriends = exists(item: <span class="string">"Dave"</span>, inArray: myFriends)</span><br><span class="line"><span class="comment">// returns true</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">let</span> isOneOfMyFriends1 = exists(item: <span class="string">"Laura"</span>, inArray: myFriends)</span><br><span class="line"><span class="comment">// returns false</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">let</span> myNumbers:[<span class="type">Int</span>] = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>]</span><br><span class="line"> </span><br><span class="line"><span class="keyword">let</span> isOneOfMyNumbers = exists(item: <span class="number">3</span>, inArray: myNumbers)</span><br><span class="line"><span class="comment">// returns true</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">let</span> isOneOfMyNumbers1 = exists(item: <span class="number">0</span>, inArray: myNumbers)</span><br><span class="line"><span class="comment">// returns false</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">let</span> myNumbersFloat:[<span class="type">Float</span>] = [<span class="number">1.0</span>,<span class="number">2.0</span>,<span class="number">3.0</span>,<span class="number">4.0</span>,<span class="number">5.0</span>,<span class="number">6.0</span>,]</span><br><span class="line"> </span><br><span class="line"><span class="keyword">let</span> isOneOfMyFloatNumbers = exists(item: <span class="number">3.0000</span>, inArray: myNumbersFloat)</span><br><span class="line"><span class="comment">// returns true</span></span><br></pre></td></tr></table></figure><p>æˆ‘æ–°å†™ exists æ–¹æ³•æ˜¯ä¸€ä¸ªæ³›å‹å‡½æ•°ï¼Œè¿™ä¸ªæ–¹æ³•â€œèƒ½æ­£å¸¸å·¥ä½œåœ¨ä»»ä½•å‚æ•°ç±»å‹ä¸Šâ€ï¼Œæ­¤å¤–ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹å®ƒçš„å‡½æ•°ç­¾åã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">exists</span>&lt;T: Equatable &gt;<span class="params">(item: T, inArray: [T])</span></span> -&gt; <span class="type">Bool</span></span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬çœ‹åˆ° <strong><a href="https://docs.Swift.org/Swift-book/LanguageGuide/Generics.html" target="_blank" rel="noopener">é‚£ä¸ª</a></strong> å‡½æ•°ä½¿ç”¨ä¸€ä¸ªå ä½ç¬¦ç±»å‹åå­—(åå« <code>T</code>, åœ¨è¿™ä¸ªæ¡ˆä¾‹)è€Œä¸æ˜¯çœŸæ­£çš„ç±»å‹åï¼ˆæ¯”å¦‚ï¼š<code>Int</code>ï¼Œ<code>Stirng</code>ï¼Œæˆ– <code>Double</code>ï¼‰å ä½ç¬¦ç±»å‹åæ²¡æœ‰æŒ‡å®š <code>T</code> å¿…é¡»æ˜¯ä»€ä¹ˆï¼Œä½†ä»–è¯´æ˜äº† <code>[item]</code> å’Œ <code>[inArray]</code> å¿…é¡»æ˜¯ç›¸åŒçš„ç±»å‹ <code>T</code> æ— è®º <code>T</code> ä»£è¡¨ä»€ä¹ˆï¼Œæ¯å½“ [<code>exists(_:_:)</code>] å‡½æ•°è¢«è°ƒç”¨æ—¶ï¼ŒçœŸå®çš„ç±»å‹ç”¨äºæ›¿ä»£ <code>T</code> è¢«ç¡®å®šä¸‹æ¥ã€‚</p><p><strong>è¿™ä¸ª exists å‡½æ•°ä¸­çš„å ä½ç¬¦ç±»å‹ <code>T</code> è¢«ç§°ä¸ºç±»å‹å‚æ•°</strong>ï¼š</p><blockquote><p><a href="https://developer.apple.com/library/content/documentation/Swift/Conceptual/SwiftProgrammingLanguage/Generics.html" target="_blank" rel="noopener">å®ƒ</a>æŒ‡å®šå’Œå‘½åäº†å ä½ç¬¦çš„ç±»å‹ï¼Œç›´æ¥å†™åœ¨å‡½æ•°åç§°çš„åé¢ï¼Œåœ¨ä¸€å¯¹å°–æ‹¬å·ä¹‹é—´(æ¯”å¦‚ <t>)ã€‚</t></p><p>ä¸€æ—¦ä½ æŒ‡å®šä¸€ä¸ªç±»å‹å‚æ•°ä½ å¯ä»¥ç”¨å®ƒæ¥å®šä¹‰å‡½æ•°å‚æ•°çš„ç±»å‹(æ¯”å¦‚ï¼š[<code>item</code>] and [<code>inArray</code>] [<code>exists(_:_:)</code> å‡½æ•°)æˆ–è€…ä½œä¸ºå‡½æ•°è¿”å›å€¼çš„ç±»å‹ï¼Œåœ¨ä»»ä½•æ¡ä»¶ä¸‹ï¼Œå½“å‡½æ•°è¢«è°ƒç”¨çš„æ—¶å€™ç±»å‹å‚æ•°ä¼šè¢«çœŸå®ç±»å‹æ›¿ä»£ã€‚</p></blockquote><p>ä¸ºäº†å¼ºåŒ–æˆ‘ä»¬ç›®å‰å·²ç»å­¦åˆ°çš„ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ª Swift å‡½æ•°ï¼Œè¯¥å‡½æ•°èƒ½å¤Ÿæ‰¾åˆ°å­˜å‚¨åœ¨æ•°ç»„ä¸­ä»»ä½•ç±»å‹å®ä¾‹çš„ç´¢å¼•ã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">find</span>&lt;T: Equatable&gt;<span class="params">(item: T, inArray: [T])</span></span> -&gt; <span class="type">Int</span>?</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">var</span> index:<span class="type">Int</span> = <span class="number">0</span></span><br><span class="line">    <span class="keyword">var</span> found = <span class="literal">false</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">while</span> (index &lt; inArray.<span class="built_in">count</span> &amp;&amp; found == <span class="literal">false</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> item == inArray[index]</span><br><span class="line">        &#123;</span><br><span class="line">            found = <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            index = index + <span class="number">1</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> found</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> index</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è®©æˆ‘ä»¬æµ‹è¯•ä¸‹å®ƒ</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> myFriends:[<span class="type">String</span>] = [<span class="string">"John"</span>, <span class="string">"Dave"</span>, <span class="string">"Jim"</span>, <span class="string">"Arthur"</span>, <span class="string">"Lancelot"</span>]</span><br><span class="line"> </span><br><span class="line"><span class="keyword">let</span> findIndexOfFriend = <span class="built_in">find</span>(item: <span class="string">"John"</span>, inArray: myFriends)</span><br><span class="line"><span class="comment">// returns 0</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">let</span> findIndexOfFriend1 = <span class="built_in">find</span>(item: <span class="string">"Arthur"</span>, inArray: myFriends)</span><br><span class="line"><span class="comment">// returns 3</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">let</span> findIndexOfFriend2 = <span class="built_in">find</span>(item: <span class="string">"Guinevere"</span>, inArray: myFriends)</span><br><span class="line"><span class="comment">// returns nil</span></span><br></pre></td></tr></table></figure><h2 id="å…³äº-Equatable-åè®®"><a href="#å…³äº-Equatable-åè®®" class="headerlink" title="å…³äº Equatable åè®®"></a>å…³äº <code>Equatable</code> åè®®</h2><p>exists å‡½æ•°ä¸­ <code>&lt;T: Equatable &gt;</code> æ ‡æ³¨æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿå®ƒå«åšç±»å‹çº¦æŸï¼Œå®ƒè§„å®šäº†â€é‚£ä¸ªç±»å‹å‚æ•°å¿…é¡»ç»§æ‰¿è‡ªä¸€ä¸ªå…·ä½“çš„ç±»ï¼Œæˆ–è€…éµå®ˆä¸€ä¸ªç‰¹å®šçš„åè®®æˆ–æ˜¯åè®®ç»„åˆã€‚æˆ‘æŒ‡å®šäº† exists å‡½æ•°å‚æ•°ï¼Œ<code>item: T</code> å’Œ <code>inArray: [T]</code>, å¿…é¡»æ˜¯ç±»å‹ <code>T</code>, è€Œç±»å‹ <code>T</code> å¿…é¡»éµå®ˆåè®® <code>Equatable</code> åè®®ï¼Œä¸ºä»€ä¹ˆæ˜¯è¿™æ ·çš„å‘¢?</p><p>æ‰€æœ‰çš„ Swift å†…ç½®ç±»å‹å·²ç»è¢«æ„å»ºæ”¯æŒ <code>Equatable</code> åè®®ã€‚æ¥è‡ª <a href="https://developer.apple.com/documentation/ Swift / Equatable" target="_blank" rel="noopener">Apple docs</a>:  â€œéµå®ˆ <code>Equatable</code> åè®®çš„ç±»å‹è¿›è¡Œç›¸ç­‰æ¯”è¾ƒï¼Œä½¿ç”¨ç­‰äºè¿ç®—ç¬¦(<code>==</code>)åˆ¤æ–­ç›¸ç­‰ï¼Œæˆ–è€…ä½¿ç”¨ä¸ç­‰è¿ç®—ç¬¦(<code>!=</code>)åˆ¤æ–­ä¸ç­‰â€ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘çš„æ³›å‹å‡½æ•° â€œexistsâ€ èƒ½å¤Ÿåœ¨ Swift çš„ç±»å‹ï¼ˆå¦‚ <code>String</code>ï¼Œ<code>Integer</code>ï¼Œ<code>Float</code> å’Œ <code>Double</code>ï¼‰ä¸Šæ­£å¸¸å·¥ä½œã€‚æ‰€æœ‰è¿™äº›ç±»å‹éƒ½å®šä¹‰äº† <code>==</code> å’Œ <code>!=</code> è¿ç®—ç¬¦ã€‚ </p><h2 id="è‡ªå®šä¹‰ç±»å‹å’Œæ³›å‹"><a href="#è‡ªå®šä¹‰ç±»å‹å’Œæ³›å‹" class="headerlink" title="è‡ªå®šä¹‰ç±»å‹å’Œæ³›å‹"></a>è‡ªå®šä¹‰ç±»å‹å’Œæ³›å‹</h2><p>å‡å¦‚æˆ‘å£°æ˜äº†ä¸€ä¸ªæ–°çš„ç±»å«åš â€œBasicPersonâ€ å¦‚ä¸‹æ‰€ç¤ºã€‚æˆ‘èƒ½ç”¨æˆ‘çš„ existsâ€ å‡½æ•°æ¥æ‰¾å‡ºåœ¨æ•°ç»„ä¸­æ˜¯å¦æœ‰ â€œBasicPersonâ€ ç±»çš„ä¸€ä¸ªå®ä¾‹çš„ç±»å‹ä¹ˆï¼Ÿä¸è¡Œï¼ä¸ºä»€ä¹ˆä¸è¡Œï¼Ÿçœ‹çœ‹ä¸‹é¢è¿™ä¸ªä»£ç ï¼Œæˆ‘ä»¬æ¥ä¸‹æ¥è®¨è®ºå®ƒï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BasicPerson</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">var</span> name: <span class="type">String</span></span><br><span class="line">    <span class="keyword">var</span> weight: <span class="type">Int</span></span><br><span class="line">    <span class="keyword">var</span> sex: <span class="type">String</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">init</span>(weight: <span class="type">Int</span>, name: <span class="type">String</span>, sex: <span class="type">String</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">self</span>.name = name</span><br><span class="line">        <span class="keyword">self</span>.weight = weight</span><br><span class="line">        <span class="keyword">self</span>.sex = sex</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">let</span> <span class="type">Jim</span> = <span class="type">BasicPerson</span>(weight: <span class="number">180</span>, name: <span class="string">"Jim Patterson"</span>, sex: <span class="string">"M"</span>)</span><br><span class="line"><span class="keyword">let</span> <span class="type">Sam</span> = <span class="type">BasicPerson</span>(weight: <span class="number">120</span>, name: <span class="string">"Sam Patterson"</span>, sex: <span class="string">"F"</span>)</span><br><span class="line"><span class="keyword">let</span> <span class="type">Sara</span> = <span class="type">BasicPerson</span>(weight: <span class="number">115</span>, name: <span class="string">"Sara Lewis"</span>, sex: <span class="string">"F"</span>)</span><br><span class="line"> </span><br><span class="line"><span class="keyword">let</span> basicPersons = [<span class="type">Jim</span>, <span class="type">Sam</span>, <span class="type">Sara</span>]</span><br><span class="line"> </span><br><span class="line"><span class="keyword">let</span> isSamABasicPerson = exists(item: <span class="type">Sam</span>, inArray: basicPersons)</span><br></pre></td></tr></table></figure><p>çœ‹åˆ°æœ€åä¸€è¡Œï¼Œå› ä¸ºå®ƒæœ‰ä¸€ä¸ªç¼–è¯‘é”™è¯¯ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">error: <span class="keyword">in</span> argument type '[<span class="type">BasicPerson</span>]', '<span class="type">BasicPerson'</span> does not conform to expected type '<span class="type">Equatable'</span></span><br><span class="line"><span class="keyword">let</span> isSamABasicPerson = exists(item: <span class="type">Sam</span>, inArray: basicPersons)</span><br></pre></td></tr></table></figure><p><img src="https://camo.githubusercontent.com/f36f760385795cb9e802f886cda24bbf8bb720ab/68747470733a2f2f617070636f64612e636f6d2f77702d636f6e74656e742f75706c6f6164732f323031382f30322f73776966742d342d67656e65726963732d312e706e67" alt=""></p><p>è¿™å¾ˆç³Ÿç³•äº†ï¼Œ åœ¨ â€œBasicPersonâ€ ç±»å‹çš„æ•°ç»„é‡Œé¢ï¼Œä½ ä¸èƒ½ä½¿ç”¨ Swift æ•°ç»„çš„å†…å»ºå‡½æ•° <code>index</code> å’Œ <code>contains</code>ã€‚(ä½ å¿…é¡»å®šä¹‰ä¸€ä¸ªé—­åŒ…ï¼Œæ¯å½“ä½ æƒ³ä½¿ç”¨é‚£ä¸¤ä¸ªæ–¹æ³• blah,blah,blahâ€¦ è¿™ä¸ªæˆ‘å°±ä¸æäº†ã€‚)</p><p>å†æ¬¡å›åˆ°é—®é¢˜ï¼Œä¸ºä»€ä¹ˆæŠ¥é”™ï¼Ÿ</p><p>å› ä¸º â€œBasicPersonâ€ ç±»æ²¡æœ‰éµå®ˆ <code>Equeatable</code> åè®®(è¿™æ˜¯ä¸€ä¸ªæç¤ºï¼Œè¯·çœ‹ä¸‹æ–‡å’¯)</p><h2 id="éµå®ˆ-Equatable-åè®®"><a href="#éµå®ˆ-Equatable-åè®®" class="headerlink" title="éµå®ˆ Equatable åè®®"></a>éµå®ˆ <code>Equatable</code> åè®®</h2><p>ä¸ºäº†å…è®¸æˆ‘çš„ â€œBasicPersonâ€ ç±»æ˜¯å¯ä»¥ä½¿ç”¨æˆ‘çš„ â€œexistsâ€ å’Œ â€œfindâ€ æ³›å‹æ–¹æ³•ï¼Œæ‰€æœ‰æˆ‘éœ€è¦åšçš„æ˜¯ï¼š</p><ul><li>è®©ç±»éµå®ˆ <code>Equatable</code> åè®®</li><li>é‡è½½ç±»å®ä¾‹çš„ <code>==</code> æ“ä½œç¬¦</li></ul><p>æ³¨æ„<a href="https://developer.apple.com/documentation/ Swift / Equatable" target="_blank" rel="noopener">è¿™ä¸ª</a>â€œSwift æ ‡å‡†åº“ä¸ºæ‰€æœ‰éµå¾ª <code>Euqatable</code> åè®®çš„ç±»å‹æä¾›äº†ä¸ç­‰äº(!=) æ“ä½œç¬¦çš„å®ç°ã€‚é€šè¿‡è°ƒç”¨è‡ªå®šä¹‰çš„ <code>==</code> å‡½æ•°è·å–å®ƒçš„å–åç»“æœã€‚</p><p>å¦‚æœä½ å¯¹æ“ä½œç¬¦é‡è½½ä¸ç†Ÿæ‚‰ï¼Œæˆ‘å»ºè®®ä½ é˜…è¯»è¿™äº›ä¸»é¢˜ï¼Œé“¾æ¥åœ¨<a href="https://developer.apple.com/library/content/documentation/Swift/Conceptual/SwiftProgrammingLanguage/AdvancedOperators.html" target="_blank" rel="noopener">è¿™é‡Œ</a>å’Œ<a href="https://www.appcoda.com/operator-overloading-Swift" target="_blank" rel="noopener">è¿™é‡Œçš„</a>.ç›¸ä¿¡æˆ‘ï¼Œä½ ä¼šæƒ³çŸ¥é“æ“ä½œç¬¦é‡è½½çš„ã€‚</p><blockquote><p>æç¤ºï¼šæˆ‘é‡å‘½å â€œBasicPersonâ€ ç±»ä¸º â€œPersonâ€ è®©ä»–ä»¬åœ¨ç›¸åŒçš„ Swift Playground æ–‡ä»¶èƒ½å…±å­˜ï¼Œæ¥ç€æˆ‘ä»¬æ¥åˆ° â€œPersonâ€ ç±»ã€‚</p></blockquote><p>æˆ‘å°†å®ç° <code>==</code> æ“ä½œç¬¦ï¼Œæ‰€ä»¥å®ƒèƒ½æ¯”è¾ƒ â€œPersonâ€ ç±»ä¸åŒå®ä¾‹é—´çš„ â€œnameâ€, â€œweightâ€, å’Œ â€œsexâ€ å±æ€§ã€‚å¦‚æœä¸¤ä¸ª â€œPersonâ€ ç±»çš„å®ä¾‹æœ‰ç›¸åŒçš„çš„ä¸‰ä¸ªå±æ€§ã€‚åˆ™ä»–ä»¬æ˜¯ç›¸ç­‰çš„ã€‚å¦‚æœæœ‰ä¸€ä¸ªå±æ€§ä¸åŒï¼Œåˆ™ä»–ä»¬æ˜¯ä¸ç›¸ç­‰çš„(!=)ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘çš„ â€œPersonâ€ ç±»éµå®ˆäº† <code>Equatable</code> åè®®ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">lass <span class="type">Person</span>: <span class="type">Equatable</span> </span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">var</span> name:<span class="type">String</span></span><br><span class="line">    <span class="keyword">var</span> weight:<span class="type">Int</span></span><br><span class="line">    <span class="keyword">var</span> sex:<span class="type">String</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">init</span>(weight: <span class="type">Int</span>, name: <span class="type">String</span>, sex: <span class="type">String</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">self</span>.name = name</span><br><span class="line">        <span class="keyword">self</span>.weight = weight</span><br><span class="line">        <span class="keyword">self</span>.sex = sex</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> == <span class="params">(lhs: Person, rhs: Person)</span></span> -&gt; <span class="type">Bool</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> lhs.weight == rhs.weight &amp;&amp;</span><br><span class="line">            lhs.name == rhs.name &amp;&amp;</span><br><span class="line">            lhs.sex == rhs.sex</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨æ„ä¸Šé¢çš„ <code>==</code> é‡è½½æ–¹æ³•ï¼Œè¿™éœ€è¦è®© â€œPersonâ€ éµå®ˆ <code>Equatable</code> åè®®ã€‚æ³¨æ„ <code>==</code> é‡è½½æ–¹æ³•ä¸­çš„ <code>lhs</code> å’Œ <code>rhs</code> å‚æ•°ã€‚è¿™æ˜¯é€šç”¨çš„ï¼Œå½“é‡è½½æ“ä½œç¬¦æ—¶ï¼Œä»£ç ä¸­ç­‰å·ä¸¤è¾¹çš„å¯¹è±¡åº”è¯¥ä¸å‚æ•°ä¸­çš„ç‰©ç†ä½ç½®ä¸€è‡´ï¼Œå¦‚ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">lhs == rhs</span><br><span class="line"><span class="keyword">left</span>-hand side == <span class="keyword">right</span>-hand side</span><br></pre></td></tr></table></figure><h2 id="å®ƒå®ç”¨å—ï¼Ÿ"><a href="#å®ƒå®ç”¨å—ï¼Ÿ" class="headerlink" title="å®ƒå®ç”¨å—ï¼Ÿ"></a>å®ƒå®ç”¨å—ï¼Ÿ</h2><p>å¦‚æœä½ è·Ÿéšç€æˆ‘çš„æŒ‡å—ï¼Œä½ èƒ½åˆ›å»ºåƒæˆ‘å†™çš„ â€œexistsâ€ å’Œ â€œfindâ€ æ³›å‹å‡½æ•°ç”¨äºä»»ä½•ä½ åˆ›å»ºçš„æ–°ç±»å‹ï¼Œå¦‚ç±»æˆ–è€…ç»“æ„ä½“ã€‚è®©ä½ è‡ªå®šä¹‰çš„ç±»å’Œç»“æ„ä½“é›†åˆç±»å‹éµå®ˆ <code>Equatable</code> åè®®ï¼Œåƒ Swift é‡Œé¢ <code>Array</code> ä¸­çš„å†…ç½®å‡½æ•° <code>index</code> å’Œ <code>contains</code>ã€‚ä»–ä»¬ç¡®å®æœ‰ç”¨ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="type">Joe</span> = <span class="type">Person</span>(weight: <span class="number">180</span>, name: <span class="string">"Joe Patterson"</span>, sex: <span class="string">"M"</span>)</span><br><span class="line"><span class="keyword">let</span> <span class="type">Pam</span> = <span class="type">Person</span>(weight: <span class="number">120</span>, name: <span class="string">"Pam Patterson"</span>, sex: <span class="string">"F"</span>)</span><br><span class="line"><span class="keyword">let</span> <span class="type">Sue</span> = <span class="type">Person</span>(weight: <span class="number">115</span>, name: <span class="string">"Sue Lewis"</span>, sex: <span class="string">"F"</span>)</span><br><span class="line"><span class="keyword">let</span> <span class="type">Jeb</span> = <span class="type">Person</span>(weight: <span class="number">180</span>, name: <span class="string">"Jeb Patterson"</span>, sex: <span class="string">"M"</span>)</span><br><span class="line"><span class="keyword">let</span> <span class="type">Bob</span> = <span class="type">Person</span>(weight: <span class="number">200</span>, name: <span class="string">"Bob Smith"</span>, sex: <span class="string">"M"</span>)</span><br><span class="line"> </span><br><span class="line"><span class="keyword">let</span> myPeople:<span class="type">Array</span> = [<span class="type">Joe</span>, <span class="type">Pam</span>, <span class="type">Sue</span>, <span class="type">Jeb</span>]</span><br><span class="line"> </span><br><span class="line"><span class="keyword">let</span> indexOfOneOfMyPeople = <span class="built_in">find</span>(item: <span class="type">Jeb</span>, inArray: myPeople)</span><br><span class="line"><span class="comment">// returns 3 from custom generic function</span></span><br><span class="line"><span class="comment">// è¿”å› 3 æºè‡ªè‡ªå®šä¹‰æ³›å‹å‡½æ•°</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">let</span> indexOfOneOfMyPeople1 = myPeople.index(of: <span class="type">Jeb</span>)</span><br><span class="line"><span class="comment">// returns 3 from built-in Swift member function</span></span><br><span class="line"><span class="comment">// è¿”å› 3 æºè‡ª Swift å†…å»ºæˆå‘˜å‡½æ•°</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">let</span> isSueOneOfMyPeople = exists(item: <span class="type">Sue</span>, inArray: myPeople)</span><br><span class="line"><span class="comment">// returns true from custom generic function</span></span><br><span class="line"><span class="comment">// è¿”å› true æºè‡ªè‡ªå®šä¹‰æ³›å‹å‡½æ•°</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">let</span> isSueOneOfMyPeople1 = myPeople.<span class="built_in">contains</span>(<span class="type">Sue</span>)</span><br><span class="line"><span class="comment">// returns true from built-in Swift member function</span></span><br><span class="line"><span class="comment">// è¿”å› true æºè‡ª Swift å†…å»ºæˆå‘˜å‡½æ•°</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">let</span> indexOfBob = <span class="built_in">find</span>(item: <span class="type">Bob</span>, inArray: myPeople)</span><br><span class="line"><span class="comment">// returns nil from custom generic function</span></span><br><span class="line"><span class="comment">// è¿”å› nil æºè‡ªè‡ªå®šä¹‰æ³›å‹å‡½æ•°</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">let</span> indexOfBob1 = myPeople.index(of: <span class="type">Bob</span>)</span><br><span class="line"><span class="comment">// returns nil from built-in Swift member function</span></span><br><span class="line"><span class="comment">// è¿”å› nil æºè‡ª Swift å†…å»ºæˆå‘˜å‡½æ•°</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">let</span> isBobOneOfMyPeople1 = exists(item: <span class="type">Bob</span>, inArray: myPeople)</span><br><span class="line"><span class="comment">// returns false from custom generic function</span></span><br><span class="line"><span class="comment">// è¿”å› false æºè‡ªè‡ªå®šä¹‰æ³›å‹å‡½æ•°</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">let</span> isBobOneOfMyPeople2 = myPeople.<span class="built_in">contains</span>(<span class="type">Bob</span>)</span><br><span class="line"><span class="comment">// returns false from built-in Swift member function</span></span><br><span class="line"><span class="comment">// è¿”å› false æºè‡ª Swift å†…å»ºæˆå‘˜å‡½æ•°</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> <span class="type">Joe</span> == <span class="type">Pam</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"they're equal"</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"they're not equal"</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// returns "they're not equal"</span></span><br></pre></td></tr></table></figure><h2 id="æ‰©å±•é˜…è¯»"><a href="#æ‰©å±•é˜…è¯»" class="headerlink" title="æ‰©å±•é˜…è¯»"></a>æ‰©å±•é˜…è¯»</h2><p>è‹¹æœæç¤ºå…³äº <code>Equatable</code> åè®®çš„æ›´å¤šå¥½å¤„ï¼š</p><blockquote><p>Adding  Equatable  conformance to your custom types means that you can use more convenient APIs when searching for particular instances in a collection.  Equatable  is also the base protocol for the Hashable and Comparable protocols, which allow more uses of your custom type, such as constructing sets or sorting the elements of a collection.</p></blockquote><blockquote><p>è®©ä½ çš„è‡ªå®šä¹‰ç±»å‹éµå¾ª Equatable åè®®æ„å‘³ç€ä½ å¯ä»¥ä½¿ç”¨è®¸å¤šç³»ç»Ÿæä¾›çš„ API æ¥è®©ä½ åœ¨ä¸€ä¸ªé›†åˆé‡Œé¢æŸ¥æ‰¾ç‰¹å®šä¸€ä¸ªå®ä¾‹å˜å¾—æ›´åŠ æ–¹ä¾¿ã€‚</p><p>Equatable åè®®ä¹Ÿæ˜¯ Hashable åè®®å’Œ Comparable åè®®çš„åŸºç¡€åè®®ã€‚è¿™å…è®¸ä½ ä½¿ç”¨æ›´å¤šçš„è‡ªå®šä¹‰ç±»å‹ï¼Œæ¯”å¦‚æ„å»ºé›†åˆæˆ–è€…æ’åºé›†åˆä¸­çš„å…ƒç´ ã€‚</p></blockquote><p>æ¯”å¦‚ï¼Œå¦‚æœä½ éµå®ˆäº† <code>comparable</code> åè®®ï¼Œä½ èƒ½é‡è½½å’Œä½¿ç”¨ <code>&lt;</code>ï¼Œ<code>&gt;</code>ï¼Œ<code>&lt;=</code> å’Œ <code>&gt;=</code> æ“ä½œç¬¦ï¼Œè¿™çœŸçš„å¾ˆ Coolã€‚</p><h2 id="é¡»çŸ¥"><a href="#é¡»çŸ¥" class="headerlink" title="é¡»çŸ¥"></a>é¡»çŸ¥</h2><p>æƒ³ä¸€ä¸‹æˆ‘ä»¬çš„ â€œPersonâ€ ç±»ï¼Œå‡å¦‚æˆ‘ä»¬æœ‰ä¸€äº›ç±»ä¼¼ä¸‹æ–‡æ‰€ç¤ºçš„å®ä¾‹ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="type">Joe</span> = <span class="type">Person</span>(weight: <span class="number">180</span>, name: <span class="string">"Joe Patterson"</span>, sex: <span class="string">"M"</span>)</span><br><span class="line"><span class="keyword">let</span> <span class="type">Pam</span> = <span class="type">Person</span>(weight: <span class="number">120</span>, name: <span class="string">"Pam Patterson"</span>, sex: <span class="string">"F"</span>)</span><br><span class="line"><span class="keyword">let</span> <span class="type">Sue</span> = <span class="type">Person</span>(weight: <span class="number">115</span>, name: <span class="string">"Sue Lewis"</span>, sex: <span class="string">"F"</span>)</span><br><span class="line"><span class="keyword">let</span> <span class="type">Jeb</span> = <span class="type">Person</span>(weight: <span class="number">180</span>, name: <span class="string">"Jeb Patterson"</span>, sex: <span class="string">"M"</span>)</span><br><span class="line"><span class="keyword">let</span> <span class="type">Bob</span> = <span class="type">Person</span>(weight: <span class="number">200</span>, name: <span class="string">"Bob Smith"</span>, sex: <span class="string">"M"</span>)</span><br><span class="line"><span class="keyword">let</span> <span class="type">Jan</span> = <span class="type">Person</span>(weight: <span class="number">115</span>, name: <span class="string">"Sue Lewis"</span>, sex: <span class="string">"F"</span>)</span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> <span class="type">Jan</span> == <span class="type">Sue</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"they're equal"</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"they're not equal"</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// returns "they're equal" for 2 different objects</span></span><br><span class="line"><span class="comment">// è¿”å› "they're equal" å¯¹äºä¸¤ä¸ªä¸åŒçš„å¯¹è±¡</span></span><br></pre></td></tr></table></figure><p>çœ‹æœ€åä¸€è¡Œï¼Œå› ä¸ºè¿™äº› â€œPersonâ€ å¯¹è±¡ä¸­ â€œJanâ€ å’Œ â€œSueâ€ å¯¹è±¡æ˜¯ç»å¯¹ç›¸ç­‰çš„ã€‚å³ä½¿ä»–ä»¬æ˜¯ä¸¤ä¸ªä¸åŒçš„å®ä¾‹å¯¹è±¡ã€‚ä½ çš„è½¯ä»¶å¥½åä»…ä»…å–å†³äºä½ çš„è®¾è®¡ã€‚åœ¨æ•°æ®åº“çš„æœ¯è¯­ä½“ç³»é‡Œï¼Œ â€œPersonâ€ ç±»é›†åˆä¸­ï¼Œä½ ä¼šéœ€è¦ä¸€ä¸ªâ€ä¸»é”®â€ â€” æˆ–è®¸åœ¨ç±»çš„è®¾è®¡ä¸­ï¼Œå¯ä»¥æ·»åŠ ä¸€ä¸ªç´¢å¼•å˜é‡ã€‚æ¯”å¦‚ä¸€ä¸ªç¤¾ä¼šå®‰å…¨ç ã€æˆ–è€…ä½ ç†ŸçŸ¥çš„å…¶ä»–çš„å”¯ä¸€å€¼æ¥ä¿è¯ â€œPersonâ€ ç±»å®ä¾‹åœ¨é›†åˆ (<code>Array</code>) ä¸­çš„å”¯ä¸€æ€§ï¼Œå½“ç„¶å•¦ï¼Œä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ <code>===</code> æ“ä½œç¬¦ã€‚</p><p>äº«ç”¨å§ï¼</p><blockquote><p>æœ¬æ–‡ç”± SwiftGG ç¿»è¯‘ç»„ç¿»è¯‘ï¼Œå·²ç»è·å¾—ä½œè€…ç¿»è¯‘æˆæƒï¼Œæœ€æ–°æ–‡ç« è¯·è®¿é—® <a href="http://swift.gg">http://swift.gg</a>ã€‚</p></blockquote>]]></content>
    
    <summary type="html">
    
      æœ¬æ–‡è¯¦ç»†è®²è§£äº† Swift ä¸­çš„æ³›å‹æ˜¯ä»€ä¹ˆï¼Ÿ å¦‚ä½•ä½¿ç”¨æ³›å‹ï¼Ÿ
    
    </summary>
    
      <category term="AppCoda" scheme="https://swift.gg/categories/AppCoda/"/>
    
    
      <category term="Swift" scheme="https://swift.gg/tags/Swift/"/>
    
  </entry>
  
  <entry>
    <title>æ„å»ºç¬¬ä¸€ä¸ª Swift åŒºå—é“¾åº”ç”¨</title>
    <link href="https://swift.gg/2018/08/21/blockchain-introduction/"/>
    <id>https://swift.gg/2018/08/21/blockchain-introduction/</id>
    <published>2018-08-21T00:00:00.000Z</published>
    <updated>2018-09-10T03:53:25.085Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ä½œè€…ï¼šSai Kambampatiï¼Œ<a href="https://appcoda.com/blockchain-introduction/" target="_blank" rel="noopener">åŸæ–‡é“¾æ¥</a>ï¼ŒåŸæ–‡æ—¥æœŸï¼š2018-05-31<br>è¯‘è€…ï¼š<a href="http://daizi.me" target="_blank" rel="noopener">å°è¢‹å­</a>ï¼›æ ¡å¯¹ï¼š<a href="https://weibo.com/1743643682/profile?topnav=1&amp;wvr=6" target="_blank" rel="noopener">liberalism</a>ï¼Œ<a href="http://numbbbbb.com/" target="_blank" rel="noopener">numbbbbb</a>ï¼›å®šç¨¿ï¼š<a href="https://github.com/chenmingbiao" target="_blank" rel="noopener">CMB</a></p></blockquote><!--æ­¤å¤„å¼€å§‹æ­£æ–‡--><p>åŒºå—é“¾ä½œä¸ºä¸€é¡¹é©å‘½æ€§çš„æŠ€æœ¯ï¼Œå¼€å§‹å—åˆ°è¶Šæ¥è¶Šå¤šè¿½æ§ã€‚ä¸ºä»€ä¹ˆå‘¢ï¼Ÿå› ä¸ºåŒºå—é“¾æ˜¯è®¸å¤šåŠ å¯†æ•°å­—è´§å¸çš„åº•å±‚æŠ€æœ¯ï¼Œæ¯”å¦‚ï¼šæ¯”ç‰¹å¸ï¼ˆBTCï¼‰ï¼Œä»¥å¤ªåŠï¼ˆETHï¼‰ä»¥åŠè±ç‰¹å¸ï¼ˆLTCï¼‰ã€‚åŒºå—é“¾å…·ä½“æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿæœ¬ç¯‡æ•™ç¨‹ä¼šæ¶µç›–æ‰€æœ‰åŒºå—é“¾ç›¸å…³çš„çŸ¥è¯†ï¼Œè¿˜ä¼šæ•™ä½ å¦‚ä½•æ„å»º Swift åŒºå—é“¾ã€‚ä¸‹é¢è®©æˆ‘ä»¬å¼€å§‹å§ï¼</p><a id="more"></a><h3 id="åŒºå—é“¾çš„å·¥ä½œåŸç†"><a href="#åŒºå—é“¾çš„å·¥ä½œåŸç†" class="headerlink" title="åŒºå—é“¾çš„å·¥ä½œåŸç†"></a>åŒºå—é“¾çš„å·¥ä½œåŸç†</h3><p>é¡¾åæ€ä¹‰ï¼ŒåŒºå—é“¾æ˜¯ä¸€æ¡ç”±ä¸åŒåŒºå—è¿æ¥ç»„æˆçš„é“¾ã€‚æ¯ä¸€ä¸ªå—åŒ…å«ä¸‰ä¸ªä¿¡æ¯ï¼šæ•°æ®ã€å“ˆå¸Œï¼ˆhashï¼‰ã€ä»¥åŠå‰ç½®åŒºå—çš„å“ˆå¸Œã€‚</p><p><strong>1ã€æ•°æ®</strong> â€“ ç”±äºåº”ç”¨åœºæ™¯ä¸åŒï¼Œå­˜å‚¨åœ¨åŒºå—ä¸­çš„æ•°æ®ç”±åŒºå—é“¾çš„ç±»å‹å†³å®šã€‚ä¾‹å¦‚ï¼Œåœ¨æ¯”ç‰¹å¸åŒºå—é“¾ä¸­ï¼Œå­˜å‚¨çš„æ•°æ®æ˜¯äº¤æ˜“ä¿¡æ¯ï¼šè½¬è´¦é‡‘é¢å’Œäº¤æ˜“åŒæ–¹çš„ä¿¡æ¯ã€‚</p><p><strong>2ã€å“ˆå¸Œ</strong> â€“ ä½ å¯ä»¥å°†å“ˆå¸Œçœ‹åšæ•°å­—æŒ‡çº¹ï¼Œç”¨æ¥å”¯ä¸€æ ‡è¯†ä¸€ä¸ªåŒºå—åŠå…¶æ•°æ®ã€‚å“ˆå¸Œçš„é‡è¦ä¹‹å¤„åœ¨äºå®ƒæ˜¯ä¸€ä¸ªç‹¬ç‰¹çš„å­—æ¯æ•°å­—ä»£ç ï¼Œé€šå¸¸æ˜¯ 64 ä¸ªå­—ç¬¦ã€‚å½“ä¸€ä¸ªåŒºå—è¢«åˆ›å»ºæ—¶ï¼Œå“ˆå¸Œä¹Ÿéšä¹‹åˆ›å»ºã€‚å½“ä¸€ä¸ªåŒºå—è¢«ä¿®æ”¹ï¼Œå“ˆå¸Œä¹Ÿéšä¹‹ä¿®æ”¹ã€‚å› æ­¤ï¼Œå½“ä½ æƒ³è¦æŸ¥çœ‹åœ¨åŒºå—ä¸Šæ‰€åšçš„ä»»ä½•å˜æ›´æ—¶ï¼Œå“ˆå¸Œå°±æ˜¾å¾—éå¸¸é‡è¦ã€‚</p><p><strong>3ã€å‰ç½®åŒºå—çš„å“ˆå¸Œ</strong> â€“ é€šè¿‡å­˜å‚¨å‰ç½®åŒºå—çš„å“ˆå¸Œï¼Œä½ å¯ä»¥è¿˜åŸæ¯ä¸ªåŒºå—è¿æ¥æˆåŒºå—é“¾çš„è¿‡ç¨‹ï¼è¿™ä½¿å¾—åŒºå—é“¾å®‰å…¨æ€§ç‰¹åˆ«é«˜ã€‚</p><p>æˆ‘ä»¬æ¥çœ‹ä¸‹è¿™å¼ å›¾ç‰‡ï¼š</p><p><img src="https://appcoda.com/wp-content/uploads/2018/05/blockchain-explained.png" alt="åŒºå—é“¾"></p><p>ä½ å¯ä»¥çœ‹åˆ°ï¼Œæ¯ä¸€ä¸ªåŒºå—åŒ…å«æ•°æ®ï¼ˆå›¾ç‰‡ä¸­æ²¡æœ‰æŒ‡æ˜ï¼‰ã€å“ˆå¸Œä»¥åŠå‰ç½®åŒºå—çš„å“ˆå¸Œã€‚ä¾‹å¦‚ï¼Œé»„è‰²åŒºå—åŒ…å«è‡ªèº«çš„å“ˆå¸Œï¼šH7s6ï¼Œä»¥åŠçº¢è‰²åŒºå—çš„å“ˆå¸Œï¼š8SD9ã€‚è¿™æ ·å®ƒä»¬å°±æ„æˆäº†ä¸€æ¡ç›¸äº’è¿æ¥çš„é“¾ã€‚ç°åœ¨ï¼Œå‡å¦‚æœ‰ä¸€ä¸ªé»‘å®¢å‡†å¤‡æ¶æ„ç¯¡æ”¹çº¢è‰²çš„åŒºå—ã€‚è¯·è®°ä½ï¼Œæ¯å½“å—ä»¥ä»»ä½•æ–¹å¼è¢«ç¯¡æ”¹æ—¶ï¼Œè¯¥åŒºå—çš„å“ˆå¸Œéƒ½ä¼šæ”¹å˜ï¼å½“ä¸‹ä¸€ä¸ªåŒºå—æ£€æŸ¥å¹¶å‘ç°å‰ç½®å“ˆå¸Œä¸ä¸€è‡´æ—¶ï¼Œé»‘å®¢å°†æ— æ³•è®¿é—®å®ƒï¼Œå› ä¸ºä»–ä¸å‰ç½®åŒºå—çš„è”ç³»è¢«åˆ‡æ–­äº†ï¼ˆè¯‘è€…æ³¨ï¼šå³å¦‚æœé»‘å®¢æƒ³è¦è¦ç¯¡æ”¹ä¸€ä¸ªåŒºå—çš„è¯ï¼Œå°±éœ€è¦æŠŠè¿™ä¸ªåŒºå—åé¢çš„æ‰€æœ‰åŒºå—éƒ½è¦æ”¹æ‰ï¼Œè€Œè¿™ä¸ªå·¥ä½œé‡æ˜¯å¾ˆéš¾å®ç°çš„ï¼‰ã€‚</p><p>è¿™ä½¿å¾—åŒºå—é“¾ç‰¹åˆ«å®‰å…¨ï¼Œå‡ ä¹ä¸å¯èƒ½å›æ»šæˆ–è€…ç¯¡æ”¹ä»»ä½•æ•°æ®ã€‚è™½ç„¶å“ˆå¸Œä¸ºä¿å¯†å’Œéšç§æä¾›äº†å·¨å¤§çš„ä¿éšœï¼Œä½†æ˜¯è¿˜æœ‰ä¸¤ä¸ªæ›´åŠ å®‰å…¨å¦¥å½“çš„æªæ–½è®©åŒºå—é“¾æ›´åŠ å®‰å…¨ï¼šå·¥ä½œé‡è¯æ˜ï¼ˆProof-of-Workï¼‰ä»¥åŠæ™ºèƒ½åˆçº¦ï¼ˆSmart Contractsï¼‰ã€‚æœ¬æ–‡æˆ‘ä¸ä¼šæ·±å…¥è®²è§£ï¼Œä½ å¯ä»¥<a href="https://hackernoon.com/what-on-earth-is-a-smart-contract-2c82e5d89d26" target="_blank" rel="noopener">åœ¨è¿™é‡Œ</a>äº†è§£æ›´å¤šç›¸å…³çŸ¥è¯†ã€‚</p><p>åŒºå—é“¾æœ€åä¸€ä¸ªä¿è¯è‡ªèº«å®‰å…¨æ€§çš„æ–¹å¼æ˜¯åŸºäºå…¶å®šä½ã€‚å’Œå¤§å¤šæ•°å­˜å‚¨åœ¨æœåŠ¡å™¨å’Œæ•°æ®åº“çš„æ•°æ®ä¸åŒï¼ŒåŒºå—é“¾ä½¿ç”¨çš„æ˜¯ç‚¹å¯¹ç‚¹ï¼ˆP2Pï¼‰ç½‘ç»œã€‚P2P æ˜¯ä¸€ç§å…è®¸ä»»ä½•äººåŠ å…¥çš„ç½‘ç»œï¼Œå¹¶ä¸”è¯¥ç½‘ç»œä¸Šçš„æ•°æ®ä¼šåˆ†å‘ç»™æ¯ä¸€ä¸ªæ¥æ”¶è€…ã€‚</p><p>æ¯å½“æœ‰äººåŠ å…¥è¿™ä¸ªç½‘ç»œï¼Œä»–ä»¬å°±ä¼šè·å¾—ä¸€ä»½åŒºå—é“¾çš„å®Œæ•´æ‹·è´ã€‚æ¯å½“æœ‰äººæ–°å»ºä¸€ä¸ªåŒºå—ï¼Œå°±ä¼šå¹¿æ’­ç»™å…¨ç½‘ã€‚åœ¨å°†è¯¥å—æ·»åŠ åˆ°é“¾ä¹‹å‰ï¼ŒèŠ‚ç‚¹ä¼šé€šè¿‡å‡ ä¸ªå¤æ‚çš„ç¨‹åºç¡®å®šè¯¥å—æ˜¯å¦è¢«ç¯¡æ”¹ã€‚è¿™æ ·ï¼Œæ‰€æœ‰äººã€æ‰€æœ‰åœ°æ–¹éƒ½å¯ä»¥ä½¿ç”¨è¿™ä¸ªä¿¡æ¯ã€‚å¦‚æœä½ æ˜¯ <em>HBO ç¾å‰§ç¡…è°·</em> çš„ç²‰ä¸ï¼Œå¯¹æ­¤åº”è¯¥ä¸ä¼šæ„Ÿåˆ°é™Œç”Ÿã€‚åœ¨è¯¥å‰§ä¸­ï¼Œä¸»æ¼”ï¼ˆRichardï¼‰ä½¿ç”¨ä¸€ç§ç›¸ä¼¼çš„æŠ€æœ¯åˆ›é€ äº†æ–°å‹äº’è”ç½‘ï¼ˆè¯‘è€…æ³¨ï¼šæœ‰è¶£çš„æ˜¯å‰§ä¸­è¿˜å‘è¡Œäº†åŒºå—é“¾æ•°å­—è´§å¸ PiedPaperCoinï¼Œæ„Ÿå…´è¶£çš„ç«¥é‹å¯ä»¥åˆ·ä¸€ä¸‹è¿™éƒ¨å‰§ï¼‰ã€‚</p><p>å› ä¸ºæ¯ä¸ªäººéƒ½æœ‰åŒºå—é“¾æˆ–è€…èŠ‚ç‚¹çš„ä¸€ä»½æ‹·è´ï¼Œä»–ä»¬å¯ä»¥è¾¾æˆä¸€ç§å…±è¯†å¹¶å†³å®šå“ªéƒ¨åˆ†åŒºå—æ˜¯æœ‰æ•ˆçš„ã€‚å› æ­¤ï¼Œå¦‚æœä½ æƒ³è¦æ”»å‡»æŸä¸ªåŒºå—ï¼Œä½ å¿…é¡»åŒæ—¶æ”»å‡»ç½‘ç»œä¸Š 50% ä»¥ä¸Šçš„åŒºå—ï¼ˆè¯‘è€…ï¼š51% æ”»å‡»ï¼‰ï¼Œä½¿å¾—ä½ çš„åŒºå—å¯ä»¥è¿½ä¸Šå¹¶æ›¿æ¢åŸåŒºå—é“¾ã€‚æ‰€ä»¥åŒºå—é“¾æˆ–è®¸æ˜¯è¿‡å»åå¹´æ‰€åˆ›é€ çš„æœ€å®‰å…¨çš„æŠ€æœ¯ä¹‹ä¸€ã€‚</p><h3 id="å…³äºç¤ºä¾‹ç¨‹åº"><a href="#å…³äºç¤ºä¾‹ç¨‹åº" class="headerlink" title="å…³äºç¤ºä¾‹ç¨‹åº"></a>å…³äºç¤ºä¾‹ç¨‹åº</h3><p>ç°åœ¨ä½ å·²ç»å¯¹åŒºå—é“¾çš„åŸç†æœ‰äº†åˆæ­¥çš„è®¤è¯†ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¼€å§‹å†™ç¤ºä¾‹ç¨‹åºå§ï¼ä½ å¯ä»¥åœ¨è¿™é‡Œä¸‹è½½<a href="https://github.com/appcoda/BlockchainDemo/raw/master/BlockchainStarter.zip" target="_blank" rel="noopener">åŸå§‹é¡¹ç›®</a>ã€‚</p><p>å¦‚ä½ æ‰€è§ï¼Œæˆ‘ä»¬æœ‰ä¸¤ä¸ªæ¯”ç‰¹å¸é’±åŒ…ã€‚ç¬¬ä¸€ä¸ªè´¦æˆ· 1065 æœ‰ 500 BTCï¼Œè€Œç¬¬äºŒä¸ªè´¦æˆ· 0217 æ²¡æœ‰ BTCã€‚æˆ‘ä»¬é€šè¿‡ send æŒ‰é’®å¯ä»¥å‘é€æ¯”ç‰¹å¸åˆ°å¦å¤–çš„è´¦æˆ·ã€‚ä¸ºäº†èµšå– BTCï¼Œæˆ‘ä»¬å¯ä»¥ç‚¹å‡» Mine æŒ‰é’®ï¼Œå¯ä»¥è·å¾— 50 BTC çš„å¥–åŠ±ã€‚æˆ‘ä»¬ä¸»è¦å·¥ä½œæ˜¯æŸ¥çœ‹æ§åˆ¶å°è¾“å‡ºï¼Œè§‚å¯Ÿä¸¤ä¸ªè´¦æˆ·é—´çš„äº¤æ˜“è¿‡ç¨‹ã€‚</p><p><img src="https://appcoda.com/wp-content/uploads/2018/05/blockchain-2.png" alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°"></p><p>åœ¨å·¦ä¾§å¯¼èˆªæ å¯ä»¥çœ‹åˆ°ä¸¤ä¸ªå¾ˆé‡è¦çš„ç±»ï¼š<code>Block</code> å’Œ <code>Blockchain</code>ã€‚ç›®å‰è¿™ä¸¤ä¸ªç±»éƒ½æ˜¯ç©ºå®ç°ï¼Œæˆ‘ä¼šå¸¦ç€ä½ ä»¬åœ¨è¿™ä¸¤ä¸ªç±»ä¸­å†™å…¥ç›¸å…³é€»è¾‘ã€‚ä¸‹é¢è®©æˆ‘ä»¬å¼€å§‹å§ï¼</p><p><img src="https://appcoda.com/wp-content/uploads/2018/05/blockchain-3.png" alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°"></p><h3 id="åœ¨-Swift-ä¸­å®šä¹‰åŒºå—"><a href="#åœ¨-Swift-ä¸­å®šä¹‰åŒºå—" class="headerlink" title="åœ¨ Swift ä¸­å®šä¹‰åŒºå—"></a>åœ¨ Swift ä¸­å®šä¹‰åŒºå—</h3><p>é¦–å…ˆæ‰“å¼€ <code>Block.swift</code> å¹¶æ·»åŠ å®šä¹‰åŒºå—çš„ä»£ç ã€‚åœ¨æ­¤ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å®šä¹‰åŒºå—æ˜¯ä»€ä¹ˆã€‚å‰é¢æˆ‘ä»¬æ›¾å®šä¹‰è¿‡ï¼ŒåŒºå—æ˜¯ç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼šå“ˆå¸Œã€å®é™…è®°å½•çš„æ•°æ®ä»¥åŠå‰ç½®åŒºå—çš„å“ˆå¸Œã€‚å½“æˆ‘ä»¬æƒ³è¦æ„å»ºæˆ‘ä»¬çš„åŒºå—é“¾æ—¶ï¼Œæˆ‘ä»¬å¿…é¡»çŸ¥é“è¯¥åŒºå—æ˜¯ç¬¬ä¸€ä¸ªè¿˜æ˜¯ç¬¬äºŒä¸ªã€‚æˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“åœ°åœ¨ Swift çš„ç±»ä¸­åšå¦‚ä¸‹å®šä¹‰ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> hash: <span class="type">String</span>!</span><br><span class="line"><span class="keyword">var</span> data: <span class="type">String</span>!</span><br><span class="line"><span class="keyword">var</span> previousHash: <span class="type">String</span>!</span><br><span class="line"><span class="keyword">var</span> index: <span class="type">Int</span>!</span><br></pre></td></tr></table></figure><p>ç°åœ¨éœ€è¦æ·»åŠ æœ€é‡è¦çš„ä»£ç ã€‚æˆ‘æ›¾æè¿‡åŒºå—åœ¨è¢«ä¿®æ”¹çš„æƒ…å†µä¸‹ï¼Œå“ˆå¸Œä¹Ÿä¼šéšä¹‹å˜åŒ–ï¼Œè¿™æ˜¯åŒºå—é“¾å¦‚æ­¤å®‰å…¨çš„ç‰¹æ€§ä¹‹ä¸€ã€‚å› æ­¤æˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªå‡½æ•°å»ç”Ÿæˆå“ˆå¸Œï¼Œè¯¥å“ˆå¸Œç”±éšæœºå­—æ¯å’Œæ•°å­—ç»„æˆã€‚è¿™ä¸ªå‡½æ•°åªéœ€è¦å‡ è¡Œä»£ç ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">generateHash</span><span class="params">()</span></span> -&gt; <span class="type">String</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="type">NSUUID</span>().uuidString.replacingOccurrences(of: <span class="string">"-"</span>, with: <span class="string">""</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>NSUUID</code> æ˜¯ä¸€ä¸ªä»£è¡¨é€šç”¨å”¯ä¸€å€¼çš„å¯¹è±¡ï¼Œå¹¶ä¸”å¯ä»¥æ¡¥æ¥æˆ UUIDã€‚å®ƒå¯ä»¥å¿«é€Ÿåœ°ç”Ÿæˆ 32 ä¸ªå­—ç¬¦ä¸²ã€‚æœ¬å‡½æ•°ç”Ÿæˆä¸€ä¸ª UUIDï¼Œåˆ é™¤å…¶ä¸­çš„è¿æ¥ç¬¦ï¼Œç„¶åè¿”å›ä¸€ä¸ª <code>String</code>ï¼Œæœ€åå°†ç»“æœä½œä¸ºåŒºå—çš„å“ˆå¸Œã€‚<code>Block.swift</code> ç°åœ¨å°±åƒä¸‹é¢ï¼š</p><p><img src="https://appcoda.com/wp-content/uploads/2018/05/blockchain-4.png" alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°"></p><p>ç°åœ¨æˆ‘ä»¬å·²ç»å®šä¹‰å¥½äº† <code>Block</code> ç±»ï¼Œä¸‹é¢æ¥å®šä¹‰ Blockchain ç±»ï¼Œé¦–å…ˆåˆ‡æ¢åˆ° <code>Blockchain.swift</code> ã€‚</p><h3 id="åœ¨-Swift-ä¸­å®šä¹‰åŒºå—é“¾"><a href="#åœ¨-Swift-ä¸­å®šä¹‰åŒºå—é“¾" class="headerlink" title="åœ¨ Swift ä¸­å®šä¹‰åŒºå—é“¾"></a>åœ¨ Swift ä¸­å®šä¹‰åŒºå—é“¾</h3><p>å’Œä¹‹å‰ä¸€æ ·ï¼Œé¦–å…ˆåˆ†æåŒºå—é“¾çš„åŸºæœ¬åŸç†ã€‚ç”¨éå¸¸åŸºç¡€çš„æœ¯è¯­æ¥è¯´ï¼ŒåŒºå—é“¾åªæ˜¯ç”±ä¸€è¿ä¸²çš„åŒºå—è¿æ¥è€Œæˆï¼Œä¹Ÿå¯ä»¥è¯´æ˜¯ä¸€ä¸ªç”±å¤šä¸ªæ¡ç›®ç»„æˆçš„åˆ—è¡¨ã€‚è¿™æ˜¯ä¸æ˜¯å¬èµ·æ¥å¾ˆç†Ÿæ‚‰å‘¢ï¼Ÿå…¶å®è¿™å°±æ˜¯æ•°ç»„çš„å®šä¹‰ï¼è€Œä¸”è¿™ä¸ªæ•°ç»„æ˜¯ç”±åŒºå—ç»„æˆçš„ï¼æ¥ä¸‹æ¥æ·»åŠ ä»¥ä¸‹ä»£ç ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> chain = [<span class="type">Block</span>]()</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">å¿«é€Ÿæç¤ºï¼š è¿™ä¸ªæ–¹æ³•å¯ä»¥åº”ç”¨äºè®¡ç®—æœºç§‘å­¦ä¸–ç•Œé‡Œçš„ä»»ä½•äº‹ç‰©ã€‚å¦‚æœä½ é‡åˆ°å¤§éš¾é¢˜ï¼Œå¯ä»¥å°è¯•æŠŠå®ƒåˆ†è§£æˆè‹¥å¹²ä¸ªå°é—®é¢˜ï¼Œä»¥æ­¤æ¥å»ºç«‹èµ·è§£å†³é—®é¢˜çš„æ–¹æ³•ï¼Œæ­£å¦‚æˆ‘ä»¬è§£å†³åœ¨ Swift ä¸­å¦‚ä½•æ·»åŠ åŒºå—å’ŒåŒºå—é“¾çš„é—®é¢˜ã€‚</span><br></pre></td></tr></table></figure><p>ä½ ä¼šæ³¨æ„åˆ°æ•°ç»„é‡Œé¢æ˜¯æˆ‘ä»¬å‰é¢å®šä¹‰çš„ <code>Block</code> ç±»ï¼Œè¿™å°±æ˜¯åŒºå—é“¾æ‰€éœ€è¦çš„æ‰€æœ‰å˜é‡ã€‚ä¸ºäº†å®ŒæˆåŠŸèƒ½ï¼Œæˆ‘ä»¬è¿˜éœ€è¦åœ¨ç±»ä¸­æ·»åŠ ä¸¤ä¸ªå‡½æ•°ã€‚è¯·å°è¯•ç€æ ¹æ®æˆ‘ä¹‹å‰æ•™è¿‡çš„æ–¹æ³•è§£ç­”è¿™ä¸ªé—®é¢˜ã€‚</p><blockquote><p>åŒºå—é“¾ä¸­çš„ä¸¤ä¸ªä¸»è¦å‡½æ•°æ˜¯ä»€ä¹ˆï¼Ÿ</p></blockquote><p>æˆ‘å¸Œæœ›ä½ èƒ½è®¤çœŸæ€è€ƒå¹¶å›ç­”è¿™ä¸ªé—®é¢˜ï¼å®é™…ä¸Šï¼ŒåŒºå—é“¾çš„ä¸¤ä¸ªä¸»è¦åŠŸèƒ½æ˜¯åˆ›å»ºåˆ›ä¸–åŒºå—ï¼ˆæœ€åˆçš„å§‹å—ï¼‰ï¼Œä»¥åŠåœ¨å…¶ç»“å°¾æ·»åŠ æ–°çš„åŒºå—ã€‚å½“ç„¶ç°åœ¨æˆ‘ä¸æ‰“ç®—å®ç°åˆ†å‰åŒºå—é“¾å’Œæ·»åŠ æ™ºèƒ½åˆçº¦çš„åŠŸèƒ½ï¼Œä½†ä½ å¿…é¡»äº†è§£è¿™ä¸¤ä¸ªæ˜¯åŸºæœ¬åŠŸèƒ½ï¼å°†ä»¥ä¸‹ä»£ç æ·»åŠ åˆ° <code>Blockchain.swift</code>ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">createGenesisBlock</span><span class="params">(data:String)</span></span> &#123;</span><br><span class="line">    <span class="keyword">let</span> genesisBlock = <span class="type">Block</span>()</span><br><span class="line">    genesisBlock.hash = genesisBlock.generateHash()</span><br><span class="line">    genesisBlock.data = data</span><br><span class="line">    genesisBlock.previousHash = <span class="string">"0000"</span></span><br><span class="line">    genesisBlock.index = <span class="number">0</span></span><br><span class="line">    chain.append(genesisBlock)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">createBlock</span><span class="params">(data:String)</span></span> &#123;</span><br><span class="line">    <span class="keyword">let</span> newBlock = <span class="type">Block</span>()</span><br><span class="line">    newBlock.hash = newBlock.generateHash()</span><br><span class="line">    newBlock.data = data</span><br><span class="line">    newBlock.previousHash = chain[chain.<span class="built_in">count</span>-<span class="number">1</span>].hash</span><br><span class="line">    newBlock.index = chain.<span class="built_in">count</span></span><br><span class="line">    chain.append(newBlock)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>1ã€æˆ‘ä»¬æ·»åŠ çš„ç¬¬ä¸€ä¸ªå‡½æ•°çš„ä½œç”¨æ˜¯åˆ›å»ºåˆ›ä¸–åŒºå—ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªä»¥åŒºå—æ•°æ®ä¸ºå…¥å‚çš„å‡½æ•°ã€‚ç„¶åå®šä¹‰äº†ä¸€ä¸ªç±»å‹ä¸º <code>Block</code> çš„å˜é‡ <code>genesisBlock</code>ï¼Œå®ƒæ‹¥æœ‰æ­¤å‰åœ¨ <code>Block.swift</code> ä¸­å®šä¹‰çš„æ‰€æœ‰å˜é‡å’Œå‡½æ•°ã€‚æˆ‘ä»¬å°† <code>generateHash()</code> èµ‹å€¼ç»™å“ˆå¸Œï¼Œå°†è¾“å…¥çš„ <code>data</code> å‚æ•°èµ‹å€¼ç»™æ•°æ®ã€‚ç”±äºè¿™æ˜¯ç¬¬ä¸€ä¸ªåŒºå—ï¼Œæˆ‘ä»¬å°†å‰ç½®åŒºå—çš„å“ˆå¸Œè®¾ä¸º 0000ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥çŸ¥é“è¿™æ˜¯èµ·å§‹åŒºå—ã€‚æœ€åæˆ‘ä»¬å°† <code>index</code> è®¾ä¸º 0ï¼Œå¹¶å°†è¿™ä¸ªåŒºå—åŠ å…¥åˆ°åŒºå—é“¾ä¸­ã€‚</p><p>2ã€æˆ‘ä»¬åˆ›å»ºçš„ç¬¬äºŒä¸ªå‡½æ•°é€‚ç”¨äº <code>genesisBlock</code> ä¹‹åçš„æ‰€æœ‰åŒºå—ï¼Œå¹¶ä¸”èƒ½åˆ›å»ºå‰©ä½™çš„åŒºå—ã€‚ä½ ä¼šæ³¨æ„åˆ°å®ƒä¸ç¬¬ä¸€ä¸ªå‡½æ•°éå¸¸ç›¸ä¼¼ã€‚å”¯ä¸€çš„åŒºåˆ«æ˜¯ï¼Œæˆ‘ä»¬å°† <code>previousHash</code> çš„å€¼è®¾ç½®ä¸ºå‰ä¸€ä¸ªåŒºå—çš„å“ˆå¸Œå€¼ï¼Œå¹¶å°† <code>index</code> è®¾ç½®ä¸ºå®ƒåœ¨åŒºå—é“¾ä¸­çš„ä½ç½®ã€‚å°±è¿™æ ·ï¼ŒåŒºå—é“¾å·²ç»å®šä¹‰å¥½äº†ï¼ä½ çš„ä»£ç åº”è¯¥çœ‹èµ·æ¥è·Ÿä¸‹å›¾ä¸€æ ·ï¼</p><p><img src="https://appcoda.com/wp-content/uploads/2018/05/blockchain-5.png" alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°"></p><h3 id="é’±åŒ…åç«¯"><a href="#é’±åŒ…åç«¯" class="headerlink" title="é’±åŒ…åç«¯"></a>é’±åŒ…åç«¯</h3><p>ç°åœ¨åˆ‡æ¢åˆ° <code>ViewController.swift</code>ï¼Œæˆ‘ä»¬ä¼šå‘ç°æ‰€æœ‰çš„ outlet éƒ½å·²ç»è¿æ¥å¥½äº†ã€‚æˆ‘ä»¬åªéœ€è¦å¤„ç†äº¤æ˜“ï¼Œå¹¶å°†å…¶è¾“å‡ºåˆ°æ§åˆ¶å°ã€‚</p><p>ç„¶è€Œåœ¨æ­¤ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦ç¨å¾®ç ”ç©¶ä¸€ä¸‹æ¯”ç‰¹å¸çš„åŒºå—é“¾ã€‚æ¯”ç‰¹å¸æ˜¯ç”±ä¸€ä¸ªæ€»è´¦æˆ·äº§ç”Ÿçš„ï¼Œæˆ‘ä»¬å°†è¿™ä¸ªè´¦å·çš„ç¼–å·ç§°ä¸º 0000ã€‚å½“ä½ æŒ–åˆ°ä¸€ä¸ª BTCï¼Œæ„å‘³ç€ä½ è§£å†³äº†æ•°å­¦é—®é¢˜ï¼Œå› æ­¤ä¼šå‘è¡Œä¸€å®šæ•°é‡çš„æ¯”ç‰¹å¸ä½œä¸ºå¥–åŠ±ã€‚è¿™æä¾›äº†ä¸€ä¸ªå‘å¸çš„é«˜æ˜æ–¹æ³•ï¼Œå¹¶ä¸”å¯ä»¥æ¿€åŠ±æ›´å¤šäººå»æŒ–çŸ¿ã€‚åœ¨æˆ‘ä»¬çš„åº”ç”¨ï¼Œè®©æˆ‘ä»¬æŠŠæŒ–çŸ¿å¥–åŠ±è®¾ä¸º 100 BTCã€‚é¦–å…ˆï¼Œåœ¨è§†å›¾æ§åˆ¶å™¨ä¸­æ·»åŠ æ‰€éœ€çš„å˜é‡ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> firstAccount = <span class="number">1065</span></span><br><span class="line"><span class="keyword">let</span> secondAccount = <span class="number">0217</span></span><br><span class="line"><span class="keyword">let</span> bitcoinChain = <span class="type">Blockchain</span>()</span><br><span class="line"><span class="keyword">let</span> reward = <span class="number">100</span></span><br><span class="line"><span class="keyword">var</span> accounts: [<span class="type">String</span>: <span class="type">Int</span>] = [<span class="string">"0000"</span>: <span class="number">10000000</span>]</span><br><span class="line"><span class="keyword">let</span> invalidAlert = <span class="type">UIAlertController</span>(title: <span class="string">"Invalid Transaction"</span>, message: <span class="string">"Please check the details of your transaction as we were unable to process this."</span>, preferredStyle: .alert)</span><br></pre></td></tr></table></figure><p>é¦–å…ˆå®šä¹‰å·ç ä¸º 1065 å’Œ 0217 çš„ä¸¤ä¸ªè´¦å·ã€‚ç„¶åæ·»åŠ ä¸€ä¸ªåä¸º <code>bitcoinChain</code> çš„å˜é‡ä½œä¸ºæˆ‘ä»¬çš„åŒºå—é“¾ï¼Œå¹¶å°† <code>reward</code> è®¾ä¸º 100ã€‚æˆ‘ä»¬éœ€è¦ä¸€ä¸ªä¸»å¸æˆ·ä½œä¸ºæ‰€æœ‰æ¯”ç‰¹å¸çš„æ¥æºï¼šå³åˆ›ä¸–å¸æˆ· 0000ã€‚é‡Œé¢æœ‰ 1000 ä¸‡ä¸ªæ¯”ç‰¹å¸ã€‚ä½ å¯ä»¥æŠŠè¿™ä¸ªè´¦æˆ·æƒ³è±¡æˆä¸€ä¸ªé“¶è¡Œï¼Œæ‰€æœ‰å› å¥–åŠ±äº§ç”Ÿçš„ 100 ä¸ªæ¯”ç‰¹å¸éƒ½ç»æ­¤å‘æ”¾åˆ°åˆæ³•è´¦æˆ·ä¸­ã€‚æˆ‘ä»¬è¿˜å®šä¹‰äº†ä¸€ä¸ªæé†’å¼¹çª—ï¼Œæ¯å½“äº¤æ˜“æ— æ³•å®Œæˆæ—¶å°±ä¼šå¼¹å‡ºã€‚</p><p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬æ¥ç¼–å†™å‡ ä¸ªè¿è¡Œæ—¶éœ€è¦çš„é€šç”¨å‡½æ•°ã€‚ä½ èƒ½çŒœå‡ºæ˜¯ä»€ä¹ˆå‡½æ•°å—ï¼Ÿ</p><p>1ã€ç¬¬ä¸€ä¸ªå‡½æ•°æ˜¯ç”¨æ¥å¤„ç†äº¤æ˜“çš„ã€‚æˆ‘ä»¬éœ€è¦ç¡®ä¿äº¤æ˜“åŒæ–¹çš„è´¦æˆ·ï¼Œèƒ½å¤Ÿæ¥æ”¶æˆ–æ‰£é™¤æ­£ç¡®çš„é‡‘é¢ï¼Œå¹¶å°†è¿™äº›ä¿¡æ¯è®°å½•åˆ°æˆ‘ä»¬çš„åŒºå—é“¾ä¸­ã€‚</p><p>2ã€ä¸‹ä¸€ä¸ªå‡½æ•°æ˜¯åœ¨æ§åˆ¶å°ä¸­æ‰“å°æ•´ä¸ªè®°å½• â€”â€” å®ƒå°†æ˜¾ç¤ºæ¯ä¸ªåŒºå—åŠå…¶ä¸­çš„æ•°æ®ã€‚</p><p>3ã€æœ€åä¸€ä¸ªæ˜¯ç”¨äºéªŒè¯åŒºå—é“¾æ˜¯å¦æœ‰æ•ˆçš„å‡½æ•°ï¼Œé€šè¿‡æ ¡éªŒä¸‹ä¸€ä¸ªåŒºå—çš„ <code>previousHash</code> å’Œä¸Šä¸€ä¸ªåŒºå— <code>hash</code> æ˜¯å¦åŒ¹é…ã€‚ç”±äºæˆ‘ä»¬ä¸ä¼šæ¼”ç¤ºä»»ä½•é»‘å®¢æ–¹æ³•ï¼Œå› æ­¤åœ¨æˆ‘ä»¬çš„ç¤ºä¾‹ç¨‹åºä¸­ï¼ŒåŒºå—é“¾æ˜¯æ°¸è¿œæœ‰æ•ˆçš„ã€‚</p><h3 id="äº¤æ˜“å‡½æ•°"><a href="#äº¤æ˜“å‡½æ•°" class="headerlink" title="äº¤æ˜“å‡½æ•°"></a>äº¤æ˜“å‡½æ•°</h3><p>ä¸‹é¢æ˜¯ä¸€ä¸ªé€šç”¨çš„äº¤æ˜“å‡½æ•°ï¼Œè¯·åœ¨æˆ‘ä»¬å®šä¹‰çš„å˜é‡ä¸‹æ–¹è¾“å…¥ä»¥ä¸‹ä»£ç ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">transaction</span><span class="params">(from: String, to: String, amount: Int, type: String)</span></span> &#123;</span><br><span class="line">    <span class="comment">// 1</span></span><br><span class="line">    <span class="keyword">if</span> accounts[from] == <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.present(invalidAlert, animated: <span class="literal">true</span>, completion: <span class="literal">nil</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> accounts[from]!-amount &lt; <span class="number">0</span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.present(invalidAlert, animated: <span class="literal">true</span>, completion: <span class="literal">nil</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        accounts.updateValue(accounts[from]!-amount, forKey: from)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2</span></span><br><span class="line">    <span class="keyword">if</span> accounts[to] == <span class="literal">nil</span> &#123;</span><br><span class="line">        accounts.updateValue(amount, forKey: to)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        accounts.updateValue(accounts[to]!+amount, forKey: to)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 3</span></span><br><span class="line">    <span class="keyword">if</span> type == <span class="string">"genesis"</span> &#123;</span><br><span class="line">        bitcoinChain.createGenesisBlock(data: <span class="string">"From: <span class="subst">\(from)</span>; To: <span class="subst">\(to)</span>; Amount: <span class="subst">\(amount)</span>BTC"</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> type == <span class="string">"normal"</span> &#123;</span><br><span class="line">        bitcoinChain.createBlock(data: <span class="string">"From: <span class="subst">\(from)</span>; To: <span class="subst">\(to)</span>; Amount: <span class="subst">\(amount)</span>BTC"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»£ç é‡çœ‹èµ·æ¥å¥½åƒå¾ˆå¤§ï¼Œä½†ä¸»è¦æ˜¯å®šä¹‰äº†æ¯ä¸ªäº¤æ˜“éœ€è¦éµå¾ªçš„ä¸€äº›è§„åˆ™ã€‚ä¸€å¼€å§‹æ˜¯å‡½æ•°çš„å››ä¸ªå‚æ•°ï¼š<br><code>to</code>ï¼Œ<code>from</code>ï¼Œ<code>amount</code>ï¼Œ<code>type</code>ã€‚å‰ä¸‰ä¸ªå‚æ•°ä¸éœ€è¦å†è§£é‡Šäº†ï¼Œè€Œ <code>Type</code> ä¸»è¦ç”¨äºå®šä¹‰äº¤æ˜“çš„ç±»å‹ã€‚æ€»å…±æœ‰ä¸¤ä¸ªç±»å‹ï¼šæ­£å¸¸ç±»å‹ï¼ˆnormalï¼‰ å’Œåˆ›ä¸–ç±»å‹ï¼ˆgenesisï¼‰ã€‚æ­£å¸¸ç±»å‹çš„äº¤æ˜“ä¼šå‘ç”Ÿåœ¨è´¦æˆ· 1065 å’Œ 2017 ä¹‹é—´ï¼Œè€Œåˆ›ä¸–ç±»å‹å°†ä¼šæ¶‰åŠåˆ°è´¦æˆ· 0000ã€‚</p><p>1ã€ç¬¬ä¸€ä¸ª <code>if-else</code> æ¡ä»¶è¯­å¥å¤„ç†è½¬å‡ºè´¦æˆ·çš„ä¿¡æ¯ã€‚å¦‚æœè´¦æˆ·ä¸å­˜åœ¨æˆ–è€…ä½™é¢ä¸è¶³ï¼Œå°†ä¼šæç¤ºäº¤æ˜“ä¸åˆæ³•å¹¶è¿”å›ã€‚</p><p>2ã€ç¬¬äºŒä¸ª <code>if-else</code> æ¡ä»¶è¯­å¥å¤„ç†è½¬å…¥è´¦æˆ·çš„ä¿¡æ¯ã€‚å¦‚æœè´¦æˆ·ä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºæ–°è´¦æˆ·å¹¶è½¬å…¥ç›¸åº”çš„æ¯”ç‰¹å¸ã€‚åä¹‹ï¼Œåˆ™å‘è¯¥è´¦æˆ·è½¬å…¥æ­£ç¡®æ•°é‡çš„æ¯”ç‰¹å¸ã€‚</p><p>3ã€æœ€åä¸€ä¸ª <code>if-else</code> æ¡ä»¶è¯­å¥å¤„ç†äº¤æ˜“ç±»å‹ã€‚å¦‚æœç±»å‹æ˜¯åˆ›ä¸–ç±»å‹ï¼Œåˆ™æ·»åŠ ä¸€ä¸ªåˆ›ä¸–åŒºå—ï¼Œå¦åˆ™åˆ›å»ºä¸€ä¸ªæ–°çš„åŒºå—å­˜å‚¨æ•°æ®ã€‚</p><h3 id="æ‰“å°å‡½æ•°"><a href="#æ‰“å°å‡½æ•°" class="headerlink" title="æ‰“å°å‡½æ•°"></a>æ‰“å°å‡½æ•°</h3><p>ä¸ºäº†ç¡®ä¿äº¤æ˜“æ­£ç¡®æ‰§è¡Œï¼Œåœ¨æ¯ä¸ªäº¤æ˜“ç»“æŸåï¼Œæˆ‘ä»¬å¸Œæœ›æ‹¿åˆ°æ‰€æœ‰äº¤æ˜“çš„æ¸…å•ã€‚ä»¥ä¸‹æ˜¯æˆ‘ä»¬åœ¨äº¤æ˜“å‡½æ•°ä¸‹æ–¹çš„ä»£ç ï¼Œç”¨æ¥æ‰“å°ç›¸å…³ä¿¡æ¯ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">chainState</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="number">0</span>...bitcoinChain.chain.<span class="built_in">count</span>-<span class="number">1</span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"\tBlock: <span class="subst">\(bitcoinChain.chain[i].index!)</span>\n\tHash: <span class="subst">\(bitcoinChain.chain[i].hash!)</span>\n\tPreviousHash: <span class="subst">\(bitcoinChain.chain[i].previousHash!)</span>\n\tData: <span class="subst">\(bitcoinChain.chain[i].data!)</span>"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    redLabel.text = <span class="string">"Balance: <span class="subst">\(accounts[String(describing: firstAccount)</span>]!) BTC"</span></span><br><span class="line">    blueLabel.text = <span class="string">"Balance: <span class="subst">\(accounts[String(describing: secondAccount)</span>]!) BTC"</span></span><br><span class="line">    <span class="built_in">print</span>(accounts)</span><br><span class="line">    <span class="built_in">print</span>(chainValidity())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ˜¯ä¸€ä¸ªç®€å•çš„å¾ªç¯è¯­å¥ï¼Œéå† <code>bitcoinChain</code> ä¸­çš„æ‰€æœ‰åŒºå—ï¼Œå¹¶æ‰“å°åŒºå—å·ç ï¼Œå“ˆå¸Œï¼Œå‰ç½®å“ˆå¸Œï¼Œä»¥åŠå­˜å‚¨çš„æ•°æ®ã€‚åŒæ—¶æˆ‘ä»¬æ›´æ–°äº†ç•Œé¢ä¸­çš„æ ‡ç­¾ï¼ˆlabelï¼‰ï¼Œè¿™æ ·å°±å¯ä»¥æ˜¾ç¤ºè´¦æˆ·ä¸­æ­£ç¡®çš„ BTC æ•°é‡ã€‚æœ€åï¼Œæ‰“å°æ‰€æœ‰çš„è´¦æˆ·ï¼ˆåº”è¯¥æ˜¯ 3 ä¸ªï¼‰ï¼Œå¹¶æ ¡éªŒåŒºå—é“¾çš„æœ‰æ•ˆæ€§ã€‚</p><p>ç°åœ¨ä½ åº”è¯¥ä¼šåœ¨å‡½æ•°çš„æœ€åä¸€è¡Œå‘ç°ä¸€ä¸ªé”™è¯¯ã€‚è¿™æ˜¯ç”±äºæˆ‘ä»¬è¿˜æ²¡æœ‰å®ç° <code>chainValidity()</code> å‡½æ•°ï¼Œè®©æˆ‘ä»¬é©¬ä¸Šå¼€å§‹å§ã€‚</p><h3 id="æœ‰æ•ˆæ€§å‡½æ•°"><a href="#æœ‰æ•ˆæ€§å‡½æ•°" class="headerlink" title="æœ‰æ•ˆæ€§å‡½æ•°"></a>æœ‰æ•ˆæ€§å‡½æ•°</h3><p>åˆ¤æ–­ä¸€ä¸ªé“¾æ˜¯å¦æœ‰æ•ˆçš„æ ‡å‡†æ˜¯ï¼šå‰ç½®åŒºå—çš„å“ˆå¸Œä¸å½“å‰åŒºå—æ‰€è¡¨ç¤ºçš„æ˜¯å¦åŒ¹é…ã€‚æˆ‘ä»¬å¯ä»¥å†æ¬¡ç”¨å¾ªç¯è¯­å¥æ¥éå†æ‰€æœ‰çš„åŒºå—ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">chainValidity</span><span class="params">()</span></span> -&gt; <span class="type">String</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> isChainValid = <span class="literal">true</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="number">1</span>...bitcoinChain.chain.<span class="built_in">count</span>-<span class="number">1</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> bitcoinChain.chain[i].previousHash != bitcoinChain.chain[i-<span class="number">1</span>].hash &#123;</span><br><span class="line">            isChainValid = <span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"Chain is valid: <span class="subst">\(isChainValid)</span>\n"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å’Œä¹‹å‰ä¸€æ ·ï¼Œæˆ‘ä»¬éå†äº† <code>bitcoinChain</code> ä¸­çš„æ‰€æœ‰åŒºå—ï¼Œå¹¶æ£€æŸ¥äº†å‰ç½®åŒºå—çš„ <code>hash</code> æ˜¯å¦ä¸å½“å‰åŒºå—çš„ <code>previousHash</code> ä¸€è‡´ã€‚</p><p>å°±é…±ï¼æˆ‘ä»¬å·²ç»å°†å®šä¹‰äº†æ‰€æœ‰éœ€è¦çš„å‡½æ•°ï¼ä½ çš„ <code>ViewController.swift</code> åº”è¯¥å¦‚ä¸‹å›¾ä¸€æ ·ï¼š</p><p><img src="https://appcoda.com/wp-content/uploads/2018/05/blockchain-6.png" alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°"></p><p>æ”¶å°¾å·¥ä½œå°±æ˜¯è¿æ¥æŒ‰é’®å’Œå‡½æ•°å•¦ã€‚è®©æˆ‘ä»¬é©¬ä¸Šå¼€å§‹æœ€åçš„éƒ¨åˆ†å§ï¼</p><h3 id="è®©ä¸€åˆ‡å…³è”èµ·æ¥"><a href="#è®©ä¸€åˆ‡å…³è”èµ·æ¥" class="headerlink" title="è®©ä¸€åˆ‡å…³è”èµ·æ¥"></a>è®©ä¸€åˆ‡å…³è”èµ·æ¥</h3><p>å½“æˆ‘ä»¬çš„åº”ç”¨ç¬¬ä¸€æ¬¡å¯åŠ¨æ—¶ï¼Œéœ€è¦åˆ›ä¸–è´¦æˆ· 0000 å‘é€ 50 BTC åˆ°æˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªè´¦æˆ·ã€‚å†ä»ç¬¬ä¸€ä¸ªè´¦æˆ·è½¬è´¦ 10 BTC åˆ°ç¬¬äºŒä¸ªè´¦æˆ·ï¼Œè¿™åªéœ€è¦å¯¥å¯¥ä¸‰è¡Œä»£ç ã€‚æœ€å <code>viewDidLoad</code> ä¸­çš„ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">super</span>.viewDidLoad()</span><br><span class="line">    transaction(from: <span class="string">"0000"</span>, to: <span class="string">"<span class="subst">\(firstAccount)</span>"</span>, amount: <span class="number">50</span>, type: <span class="string">"genesis"</span>)</span><br><span class="line">    transaction(from: <span class="string">"<span class="subst">\(firstAccount)</span>"</span>, to: <span class="string">"<span class="subst">\(secondAccount)</span>"</span>, amount: <span class="number">10</span>, type: <span class="string">"normal"</span>)</span><br><span class="line">    chainState()</span><br><span class="line">    <span class="keyword">self</span>.invalidAlert.addAction(<span class="type">UIAlertAction</span>(title: <span class="string">"OK"</span>, style: .<span class="keyword">default</span>, handler: <span class="literal">nil</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬ä½¿ç”¨å·²å®šä¹‰å¥½çš„å‡½æ•°è½¬è´¦ï¼Œå¹¶è°ƒç”¨ <code>chainState()</code> å‡½æ•°ã€‚æœ€åï¼Œæˆ‘ä»¬è¿˜åœ¨ <code>invalidAlert</code> ä¸­æ·»åŠ äº†ä¸€ä¸ªæ ‡é¢˜ä¸º OK çš„ <code>UIAlertAction</code>ã€‚</p><p>ç°åœ¨è®©æˆ‘ä»¬æ¥å®ç°å‰©ä¸‹çš„å››ä¸ªå‡½æ•°ï¼š<code>ReMeNe()</code>ã€<code>BrimeMeNe()</code>ã€<code>ReSdEnter()</code>å’Œ<code>BuLeScript()</code>ã€‚</p><h3 id="æŒ–çŸ¿å‡½æ•°"><a href="#æŒ–çŸ¿å‡½æ•°" class="headerlink" title="æŒ–çŸ¿å‡½æ•°"></a>æŒ–çŸ¿å‡½æ•°</h3><p>æŒ–çŸ¿å‡½æ•°ç‰¹åˆ«ç®€å•ï¼Œåªéœ€è¦ä¸‰è¡Œä»£ç ã€‚æ·»åŠ ä»¥ä¸‹ä»£ç ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="meta">@IBAction</span> <span class="function"><span class="keyword">func</span> <span class="title">redMine</span><span class="params">(<span class="number">_</span> sender: Any)</span></span> &#123;</span><br><span class="line">    transaction(from: <span class="string">"0000"</span>, to: <span class="string">"<span class="subst">\(firstAccount)</span>"</span>, amount: <span class="number">100</span>, type: <span class="string">"normal"</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"New block mined by: <span class="subst">\(firstAccount)</span>"</span>)</span><br><span class="line">    chainState()</span><br><span class="line">&#125;</span><br><span class="line">    </span><br><span class="line"><span class="meta">@IBAction</span> <span class="function"><span class="keyword">func</span> <span class="title">blueMine</span><span class="params">(<span class="number">_</span> sender: Any)</span></span> &#123;</span><br><span class="line">    transaction(from: <span class="string">"0000"</span>, to: <span class="string">"<span class="subst">\(secondAccount)</span>"</span>, amount: <span class="number">100</span>, type: <span class="string">"normal"</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"New block mined by: <span class="subst">\(secondAccount)</span>"</span>)</span><br><span class="line">    chainState()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ç¬¬ä¸€ä¸ªæŒ–çŸ¿å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº¤æ˜“å‡½æ•°ä»åˆ›ä¸–è´¦æˆ·å‘é€äº† 100 BTC åˆ°ç¬¬ä¸€ä¸ªè´¦æˆ·ã€‚æˆ‘ä»¬æ‰“å°äº†æŒ–çŸ¿çš„åŒºå—ï¼Œç„¶åæ‰“å°äº†åŒºå—é“¾çš„çŠ¶æ€ã€‚åŒæ ·åœ°ï¼Œåœ¨ <code>blueMine</code> å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬è½¬ç»™äº†ç¬¬äºŒä¸ªè´¦æˆ· 100 BTCã€‚</p><h3 id="å‘é€å‡½æ•°"><a href="#å‘é€å‡½æ•°" class="headerlink" title="å‘é€å‡½æ•°"></a>å‘é€å‡½æ•°</h3><p>å‘é€å‡½æ•°å’ŒæŒ–çŸ¿å‡½æ•°ç•¥å¾®ç›¸ä¼¼ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="meta">@IBAction</span> <span class="function"><span class="keyword">func</span> <span class="title">redSend</span><span class="params">(<span class="number">_</span> sender: Any)</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> redAmount.text == <span class="string">""</span> &#123;</span><br><span class="line">        present(invalidAlert, animated: <span class="literal">true</span>, completion: <span class="literal">nil</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        transaction(from: <span class="string">"<span class="subst">\(firstAccount)</span>"</span>, to: <span class="string">"<span class="subst">\(secondAccount)</span>"</span>, amount: <span class="type">Int</span>(redAmount.text!)!, type: <span class="string">"normal"</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"<span class="subst">\(redAmount.text!)</span> BTC sent from <span class="subst">\(firstAccount)</span> to <span class="subst">\(secondAccount)</span>"</span>)</span><br><span class="line">        chainState()</span><br><span class="line">        redAmount.text = <span class="string">""</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">    </span><br><span class="line"><span class="meta">@IBAction</span> <span class="function"><span class="keyword">func</span> <span class="title">blueSend</span><span class="params">(<span class="number">_</span> sender: Any)</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> blueAmount.text == <span class="string">""</span> &#123;</span><br><span class="line">        present(invalidAlert, animated: <span class="literal">true</span>, completion: <span class="literal">nil</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        transaction(from: <span class="string">"<span class="subst">\(secondAccount)</span>"</span>, to: <span class="string">"<span class="subst">\(firstAccount)</span>"</span>, amount: <span class="type">Int</span>(blueAmount.text!)!, type: <span class="string">"normal"</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"<span class="subst">\(blueAmount.text!)</span> BTC sent from <span class="subst">\(secondAccount)</span> to <span class="subst">\(firstAccount)</span>"</span>)</span><br><span class="line">        chainState()</span><br><span class="line">        blueAmount.text = <span class="string">""</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é¦–å…ˆï¼Œæˆ‘ä»¬æ£€æŸ¥ <code>redAmount</code> æˆ–è€… <code>blueAmount</code> çš„æ–‡æœ¬å€¼æ˜¯å¦ä¸ºç©ºã€‚å¦‚æœä¸ºç©ºï¼Œåˆ™å¼¹å‡ºæ— æ•ˆäº¤æ˜“çš„æç¤ºæ¡†ã€‚å¦‚æœä¸ä¸ºç©ºï¼Œåˆ™ç»§ç»­ä¸‹ä¸€æ­¥ã€‚æˆ‘ä»¬ä½¿ç”¨äº¤æ˜“å‡½æ•°ä»ç¬¬ä¸€ä¸ªè´¦æˆ·è½¬è´¦åˆ°ç¬¬äºŒä¸ªè´¦æˆ·ï¼ˆæˆ–è€…åå‘è½¬è´¦ï¼‰ï¼Œé‡‘é¢ä¸ºè¾“å…¥çš„æ•°é‡ã€‚æˆ‘ä»¬æ‰“å°è½¬è´¦é‡‘é¢ï¼Œå¹¶è°ƒç”¨ <code>chainState()</code> æ–¹æ³•ã€‚æœ€åï¼Œæ¸…ç©ºæ–‡æœ¬æ¡†ã€‚</p><p>å°±é…±ï¼Œå·¥ä½œå®Œæˆï¼è¯·æ£€æŸ¥ä½ çš„ä»£ç æ˜¯å¦å’Œå›¾ä¸­ä¸€è‡´ï¼š</p><p><img src="https://appcoda.com/wp-content/uploads/2018/05/blockchain-7.png" alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°"></p><p>ç°åœ¨è¿è¡Œåº”ç”¨å¹¶æµ‹è¯•ä¸€ä¸‹ã€‚ä»å‰ç«¯çœ‹ï¼Œè¿™å°±åƒä¸€ä¸ªæ­£å¸¸çš„äº¤æ˜“åº”ç”¨ï¼Œä½†æ˜¯è¿è¡Œåœ¨å±å¹•èƒŒåçš„å¯æ˜¯åŒºå—é“¾å•Šï¼è¯·å°è¯•ä½¿ç”¨åº”ç”¨å°† BTC ä»ä¸€ä¸ªå¸æˆ·è½¬ç§»åˆ°å¦ä¸€ä¸ªå¸æˆ·ï¼Œéšæ„æµ‹è¯•ï¼Œå°½æƒ…æŠŠç©å§ï¼</p><h3 id="ç»“è®º"><a href="#ç»“è®º" class="headerlink" title="ç»“è®º"></a>ç»“è®º</h3><p>åœ¨è¿™ä¸ªæ•™ç¨‹ä¸­ï¼Œä½ å·²ç»å­¦ä¼šäº†å¦‚ä½•ä½¿ç”¨ Swift åˆ›å»ºåŒºå—é“¾ï¼Œå¹¶ä¸”åˆ›å»ºäº†ä½ è‡ªå·±çš„æ¯”ç‰¹å¸äº¤æ˜“ç³»ç»Ÿã€‚è¯·æ³¨æ„ï¼ŒçœŸæ­£åŠ å¯†è´§å¸çš„åç«¯ï¼Œå’Œæˆ‘ä»¬ä¸Šé¢çš„å®ç°å®Œå…¨ä¸ä¸€æ ·ï¼Œå› ä¸ºå®ƒéœ€è¦ç”¨æ™ºèƒ½åˆçº¦å®ç°åˆ†å¸ƒå¼ï¼Œè€Œæœ¬ä¾‹ä»…ç”¨äºå­¦ä¹ ã€‚</p><p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å°†åŒºå—é“¾æŠ€æœ¯åº”ç”¨äºåŠ å¯†è´§å¸ï¼Œç„¶è€Œä½ èƒ½æƒ³åˆ°åŒºå—é“¾çš„å…¶ä»–åº”ç”¨åœºæ™¯å—ï¼Ÿè¯·ç•™è¨€åˆ†äº«ç»™å¤§å®¶ï¼å¸Œæœ›ä½ èƒ½å­¦åˆ°æ›´å¤šæ–°ä¸œè¥¿ï¼</p><p>ä¸ºäº†å‚è€ƒï¼Œä½ å¯ä»¥ä» GitHub ä¸‹è½½<a href="https://github.com/appcoda/BlockchainDemo" target="_blank" rel="noopener">å®Œæ•´çš„ç¤ºä¾‹</a>ã€‚</p><blockquote><p>æœ¬æ–‡ç”± SwiftGG ç¿»è¯‘ç»„ç¿»è¯‘ï¼Œå·²ç»è·å¾—ä½œè€…ç¿»è¯‘æˆæƒï¼Œæœ€æ–°æ–‡ç« è¯·è®¿é—® <a href="http://swift.gg">http://swift.gg</a>ã€‚</p></blockquote>]]></content>
    
    <summary type="html">
    
      æ„å»ºç¬¬ä¸€ä¸ª Swift åŒºå—é“¾åº”ç”¨
    
    </summary>
    
      <category term="AppCoda" scheme="https://swift.gg/categories/AppCoda/"/>
    
    
      <category term="Swift" scheme="https://swift.gg/tags/Swift/"/>
    
      <category term="åŒºå—é“¾" scheme="https://swift.gg/tags/%E5%8C%BA%E5%9D%97%E9%93%BE/"/>
    
  </entry>
  
  <entry>
    <title>åœ¨ Swift ä¸­ä½¿ç”¨ Watch Connectivity â€” Application Context</title>
    <link href="https://swift.gg/2018/08/15/watch-connectivity-swift-application-context/"/>
    <id>https://swift.gg/2018/08/15/watch-connectivity-swift-application-context/</id>
    <published>2018-08-15T00:00:00.000Z</published>
    <updated>2018-09-10T03:53:25.085Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ä½œè€…ï¼šcodingexplorerï¼Œ<a href="http://www.codingexplorer.com/watch-connectivity-swift-application-context/" target="_blank" rel="noopener">åŸæ–‡é“¾æ¥</a>ï¼ŒåŸæ–‡æ—¥æœŸï¼š2018-07-18<br>è¯‘è€…ï¼š<a href="http://khala-wan.com" target="_blank" rel="noopener">Khala-wan</a>ï¼›æ ¡å¯¹ï¼š<a href="http://blog.yousanflics.com.cn" target="_blank" rel="noopener">Yousanflics</a>ï¼Œ<a href="undefined">wongzigii</a>ï¼›å®šç¨¿ï¼š<a href="https://github.com/chenmingbiao" target="_blank" rel="noopener">CMB</a></p></blockquote><!--æ­¤å¤„å¼€å§‹æ­£æ–‡--><p><img src="http://www.codingexplorer.com/wp-content/uploads/2016/02/Watch-Connectivity-Application-Context.png" alt=""></p><p>åœ¨ watchOS 1 æ—¶ä»£ï¼Œ<code>WatchKit Extension</code> ä½äºå·²é…å¯¹çš„ iOS è®¾å¤‡ä¸Šï¼Œè¿™ä½¿å¾—å®¿ä¸» APP å’Œ watch ä¹‹é—´çš„æ•°æ®å…±äº«å˜å¾—ç®€å•ã€‚ç±»ä¼¼åå¥½è®¾ç½®è¿™ç§æœ€ç®€å•çš„æ•°æ®ï¼Œåªéœ€è¦é€šè¿‡ App Groups åŠŸèƒ½æ¥å­˜å– <code>NSUserDefaults</code>ã€‚ç›®å‰åœ¨æ‰‹æœºä¸Šç•™å­˜çš„å…¶ä»–æ‰©å±•ç¨‹åºå’Œä¸» app ä¹‹é—´å…±äº«æ•°æ®ä»ç„¶åº”è¯¥ä½¿ç”¨è¿™ç§æ–¹å¼ï¼Œä¾‹å¦‚ <code>Today View Extension</code>ï¼Œä½†å®ƒå·²ä¸å†é€‚ç”¨äº watchOS çš„ appã€‚<br>å¹¸è¿çš„æ˜¯ï¼Œè‹¹æœä¸ºæˆ‘ä»¬æä¾›äº†æ–°çš„ API æ¥åšè¿™ä»¶äº‹ã€‚ç›¸æ¯” App Groupsï¼ŒWatch Connectivity æ‹¥æœ‰æ›´å¼ºå¤§çš„åŠŸèƒ½ã€‚å®ƒä¸ä»…æä¾›äº†ä½ çš„ Apple Watch å’Œä¸å…¶é…å¯¹ iPhone ä¹‹é—´è¿æ¥çŠ¶æ€çš„æ›´å¤šä¿¡æ¯ï¼Œè¿˜å…è®¸å®ƒä»¬ä¹‹é—´è¿›è¡Œäº¤äº’æ¶ˆæ¯å’Œ 3 ç§æ–¹å¼çš„åå°ä¼ è¾“ï¼Œè¿™äº›æ–¹å¼åˆ†åˆ«æ˜¯ï¼š</p><ol><li>Application Context</li><li>User Info Transfer</li><li>File Transfer</li></ol><p>æˆ‘ä»¬ä»Šå¤©å…ˆè®¨è®ºç¬¬ä¸€ç§æ–¹å¼ï¼šApplication Contextã€‚</p><a id="more"></a><h2 id="ä»€ä¹ˆæ˜¯-Application-Context"><a href="#ä»€ä¹ˆæ˜¯-Application-Context" class="headerlink" title="ä»€ä¹ˆæ˜¯ Application Context"></a>ä»€ä¹ˆæ˜¯ Application Context</h2><p>å‡è®¾ä½ æœ‰ä¸ª watch appï¼Œå®ƒæœ‰ä¸€äº›å¯ä»¥åœ¨ iOS app ç«¯è®¾ç½®çš„è®¾ç½®é¡¹ï¼Œæ¯”å¦‚æ¸©åº¦çš„æ˜¾ç¤ºå•ä½æ˜¯æ‘„æ°åº¦è¿˜æ˜¯åæ°åº¦ã€‚å¯¹äºè¿™æ ·çš„è®¾ç½®é¡¹ï¼Œé™¤éä½ å¸Œæœ›åœ¨ç”¨æˆ·åœ¨è®¾ç½®å®Œæˆä¹‹åç«‹å³ä½¿ç”¨ watch ä¸Šçš„ appï¼Œå¦åˆ™å°†è®¾ç½®é¡¹çš„ä¿¡æ¯é€šè¿‡åå°ä¼ è¾“å‘é€åˆ° watch æ‰ä¼šæ˜¯æ¯”è¾ƒåˆç†çš„ã€‚</p><p>å› ä¸ºå®ƒå¯èƒ½ä¸æ˜¯ç«‹å³éœ€è¦çš„ï¼Œæ‰€ä»¥ç³»ç»Ÿå¯èƒ½ä¼šåœ¨èŠ‚çœç”µé‡æœ€å¤šçš„æƒ…å†µä¸‹å°†å…¶å‘é€å‡ºå»ã€‚ä½ ä¹Ÿä¸éœ€è¦ä»»ä½•å†å²è®°å½•ï¼Œå› ä¸ºç”¨æˆ·å¯èƒ½å¹¶ä¸å…³å¿ƒä¸€å°æ—¶ä¹‹å‰çš„è®¾ç½®æ˜¯æ‘„æ°åº¦ã€‚</p><p>è¿™å°±æ˜¯ Application Context çš„ç”¨æ­¦ä¹‹åœ°ã€‚å®ƒä»…ç”¨äºå‘é€æœ€æ–°çš„æ•°æ®ã€‚å¦‚æœä½ å°†æ¸©åº¦è®¾ç½®é¡¹ä»æ‘„æ°åº¦æ”¹ä¸ºåæ°åº¦ï¼Œç„¶ååœ¨ Application Context å‘é€åˆ° watch ä¹‹å‰å†å°†å®ƒï¼ˆæˆ–è€…å…¶ä»–è®¾ç½®é¡¹ï¼‰è®¾ç½®ä¸ºä¸åŒçš„å€¼ï¼Œé‚£ä¹ˆæœ€æ–°çš„å€¼ä¼šè¦†ç›–ä¹‹å‰ç­‰å¾…å‘é€çš„ä¿¡æ¯ã€‚</p><p>å¦‚æœä½ ç¡®å®å¸Œæœ›å®ƒèƒ½ä¿å­˜å…ˆå‰ä¿¡æ¯çš„å†å²è®°å½•ï¼Œè€Œä¸”æ˜¯ä»¥æœ€çœç”µçš„æ–¹å¼ä¼ è¾“ã€‚é‚£ä¹ˆå¯ä»¥ä½¿ç”¨ <code>User Info</code> æ–¹å¼è¿›è¡Œä¼ è¾“ã€‚å®ƒçš„ä½¿ç”¨æ–¹å¼å’Œ Application Context å¾ˆç›¸ä¼¼ï¼Œä½†å®ƒä¼šå°†æ›´æ–°æ“ä½œåŠ å…¥åˆ°ä¸€ä¸ªé˜Ÿåˆ—ä¸­å¹¶é€ä¸€å‘é€ï¼ˆè€Œä¸æ˜¯ä»…ä»…è¦†ç›–æŸäº›å†…å®¹åªå‘é€æœ€æ–°çš„ä¿¡æ¯ï¼‰ã€‚å…·ä½“ <code>User Info</code> çš„ä½¿ç”¨å°†ä½œä¸ºä»¥åå¦ä¸€ç¯‡æ–‡ç« çš„ä¸»é¢˜æ¥è®²ã€‚</p><h2 id="è®¾ç½®-iOS-åº”ç”¨ç¨‹åº"><a href="#è®¾ç½®-iOS-åº”ç”¨ç¨‹åº" class="headerlink" title="è®¾ç½® iOS åº”ç”¨ç¨‹åº"></a>è®¾ç½® iOS åº”ç”¨ç¨‹åº</h2><p>æˆ‘ä»¬å°†ä»ä¸€ä¸ªç±»ä¼¼äºä¸Šä¸€ç¯‡æ–‡ç«  <a href="http://www.codingexplorer.com/watchos-2-hello-world-app-in-swift/" target="_blank" rel="noopener">watchOS Hello World App in Swift</a> ä¸­çš„ app è¯´èµ·ã€‚ä¸è¿‡åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†åœ¨è¿™ä¸ª iPhone app ä¸ŠåŠ å…¥ä¸€ä¸ª <code>UISwitch</code> æ§ä»¶ï¼Œå¹¶é€šè¿‡æ›´æ–° watchOS app ä¸Šçš„ WKInterfaceLabel æ¥è¯´æ˜ <code>UISwitch</code> çš„çŠ¶æ€ã€‚</p><p>é¦–å…ˆï¼Œåœ¨ iOS app çš„ <code>viewController</code> ä¸­ï¼Œæˆ‘ä»¬éœ€è¦è®¾ç½®ä¸€äº›ä¸œè¥¿ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> WatchConnectivity</span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewController</span>: <span class="title">UIViewController</span>, <span class="title">WCSessionDelegate</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">session</span><span class="params">(<span class="number">_</span> session: WCSession, activationDidCompleteWith activationState: WCSessionActivationState, error: Error?)</span></span> &#123; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">sessionDidBecomeInactive</span><span class="params">(<span class="number">_</span> session: WCSession)</span></span> &#123; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">sessionDidDeactivate</span><span class="params">(<span class="number">_</span> session: WCSession)</span></span> &#123; &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> session: <span class="type">WCSession</span>?</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.viewDidLoad()</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> <span class="type">WCSession</span>.isSupported() &#123;</span><br><span class="line">            session = <span class="type">WCSession</span>.<span class="keyword">default</span></span><br><span class="line">            session?.delegate = <span class="keyword">self</span></span><br><span class="line">            session?.activate()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸‹é¢ï¼Œæˆ‘ä»¬æœ€å…ˆéœ€è¦å¯¼å…¥ <code>WatchConnectivity</code> æ¡†æ¶ã€‚æ²¡æœ‰å®ƒï¼Œæˆ‘ä»¬æ‰€åšçš„éƒ½æ˜¯æ— ç”¨åŠŸã€‚æ¥ä¸‹æ¥ï¼Œä¸ºäº†å“åº”æ¥è‡ª WCSession çš„å›è°ƒï¼Œæˆ‘ä»¬éœ€è¦å°†å½“å‰è¿™ä¸ª <code>ViewController</code> è®¾ç½®ä¸º <code>WCSession</code> çš„ä»£ç†ï¼Œä¸ºæ­¤æˆ‘ä»¬éœ€è¦è®©å®ƒéµå®ˆè¿™ä¸ªåè®®ï¼Œæ‰€ä»¥åœ¨ <code>ViewController</code> çš„çˆ¶ç±»å£°æ˜åé¢æ·»åŠ  <code>WCSessionDelegate</code> åè®®ã€‚</p><p>ä¸‹ä¸€æ­¥ï¼Œæˆ‘ä»¬éœ€è¦å®ç° <code>WCSessionDelegate</code> ä¸­çš„ä¸€äº›æ–¹æ³•ã€‚å¯¹äºå½“å‰è¿™ä¸ª appï¼Œå®ƒä»¬ä¸æ˜¯ç‰¹åˆ«å¿…è¦ï¼Œä½†æ˜¯å¦‚æœæƒ³è¦å¿«é€Ÿåœ¨ watch app ä¸­åˆ‡æ¢ï¼Œä½ å°±éœ€è¦è¿›ä¸€æ­¥å®ç°å®ƒä»¬ã€‚</p><p>ä¹‹åï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªå˜é‡ç”¨äºå­˜å‚¨ <code>WCSession</code>ã€‚å› ä¸º <code>WCSession</code> å®é™…ä¸Šæ˜¯ä¸€ä¸ªå•ä¾‹ï¼ŒæŠ€æœ¯ä¸Šæˆ‘ä»¬å¯ä»¥è·³è¿‡è¿™ä¸€æ­¥ï¼Œä½†æ¯æ¬¡è¾“å…¥ <code>session?</code> è‚¯å®šè¦æ¯” <code>WCSession.default</code> æ›´ç®€çŸ­ã€‚</p><p>ä½ åº”è¯¥åœ¨ä»£ç è¿è¡ŒåˆæœŸå¯¹ session è¿›è¡Œè®¾ç½®ã€‚åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œè¿™å°†åœ¨ç¨‹åºåˆå§‹åŒ–çš„æ—¶å€™æ¥åšã€‚ä½†ç”±äºæˆ‘ä»¬æ˜¯åœ¨ <code>ViewController</code> ä¸­æ‰§è¡Œæ­¤æ“ä½œï¼Œæ‰€ä»¥æœ€æ—©èƒ½æ‰§è¡Œçš„åœ°æ–¹å¤§æ¦‚å°±åªæœ‰ <code>viewDidLoad</code> æ–¹æ³•ä¸­äº†ã€‚ä¸€èˆ¬æƒ…å†µä¸‹æ¥è¯´ï¼Œä½ ä¸åº”è¯¥åœ¨ <code>viewController</code> ä¸­æ‰§è¡Œè¿™ä¸ªæ“ä½œï¼Œå› ä¸ºä½ çš„ app å¸Œæœ›åœ¨å±å¹•ä¸ŠæœªåŠ è½½ç‰¹å®š <code>viewController</code> æ—¶å°±å¯ä»¥æ›´æ–°å®ƒçš„æ•°æ®æ¨¡å‹ã€‚ä¸ºäº†ç®€å•èµ·è§ï¼Œæˆ‘åœ¨ <code>viewController</code> ä¸­åšäº†è¿™ä¸ªæ“ä½œï¼Œè¿™ä»…ä»…æ˜¯ä¸ºäº†å±•ç¤ºå¦‚ä½•ä½¿ç”¨è¿™äº› APIã€‚å¦‚æœè¿™ä¸ª <code>ViewController</code> æ˜¯å”¯ä¸€å…³å¿ƒä½¿ç”¨ <code>WCSession</code> çš„ä¸œè¥¿ï¼Œé‚£å°±æ²¡å…³ç³»ã€‚ä½†é€šå¸¸æƒ…å†µå¹¶éå¦‚æ­¤ã€‚</p><p>è¦è®¾ç½® sessionï¼Œæˆ‘ä»¬éœ€è¦å…ˆæ ¹æ® <code>WCSession</code> çš„ <code>isSupport</code> æ–¹æ³•çš„è¿”å›å€¼æ¥æ£€æŸ¥æ˜¯å¦æ”¯æŒã€‚å¦‚æœç¨‹åºåœ¨ iPad ä¸Šè¿è¡Œçš„è¯ï¼Œè¿™ä¸€ç‚¹å°¤ä¸ºé‡è¦ã€‚ç›®å‰ï¼Œä½ æ— æ³•å°† iPad ä¸ Apple Watch é…å¯¹ï¼Œå› æ­¤å®ƒä¼šè¿”å› <code>false</code> è¡¨ç¤ºä¸æ”¯æŒåœ¨ iPad ä¸Šä½¿ç”¨ <code>WCSession</code>ã€‚åœ¨ iPhone ä¸Šå®ƒä¼šè¿”å› <code>true</code>ã€‚</p><p>ä¸€æ—¦æˆ‘ä»¬å®Œæˆæ£€æŸ¥ï¼Œå°±å¯ä»¥å°† WCSession çš„ defaultSession å­˜å‚¨åœ¨é‚£é‡Œï¼Œæ¥ç€å°†è¿™ä¸ª <code>ViewController</code> è®¾ç½®ä¸ºå®ƒçš„ä»£ç†å¹¶æ¿€æ´» sessionã€‚å¦‚æœæˆ‘ä»¬å¯ä»¥åœ¨åˆå§‹åŒ–ç¨‹åºä¸­æ‰§è¡Œ <code>isSupported</code> æ¥æµ‹è¯•æ˜¯å¦æ”¯æŒï¼Œå°±å¯ä»¥æŠŠ session ç”¨ä½œä¸€ä¸ªå¸¸é‡ã€‚è€Œè¿™é‡Œçš„ session æ˜¯ä¸€ä¸ªå¯é€‰å€¼æ˜¯å› ä¸ºæˆ‘ä»¬ä¸çŸ¥é“ç¨‹åºæ˜¯å¦ä¼šè¿è¡Œåœ¨ <code>iPad</code> ä¸Šï¼Œæ‰€ä»¥å½“æ”¯æŒ <code>WCSession</code> æ—¶ï¼Œsession çš„å€¼ä¸º <code>WCSession.defualt</code>ï¼Œåä¹‹åˆ™ä¸º <code>nil</code>ã€‚è¿™æ ·ï¼Œå½“æˆ‘ä»¬åœ¨ <code>iPad</code> ä¸Šå°è¯•è®¿é—® session ä¸­çš„å±æ€§æˆ–æ–¹æ³•æ—¶ï¼Œå®ƒä»¬ç”šè‡³ä¸ä¼šæ‰§è¡Œï¼Œå› ä¸º session ä¸º <code>nil</code>ã€‚</p><p>å°†ä¸€ä¸ª <code>UISwitch</code> æ”¾åœ¨ Storyboard ä¸Šï¼Œå¹¶å°†å…¶ <code>ValueChanged</code> æ–¹æ³•å…³è”åˆ° <code>ViewController</code> ä¸­ã€‚<br>åœ¨æ–¹æ³•ä¸­åŠ å…¥å¦‚ä¸‹ä»£ç ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="meta">@IBAction</span> <span class="function"><span class="keyword">func</span> <span class="title">switchValueChanged</span><span class="params">(<span class="number">_</span> sender: UISwitch)</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> validSession = session &#123;</span><br><span class="line">        <span class="keyword">let</span> iPhoneAppContext = [<span class="string">"switchStatus"</span>: sender.isOn]</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            <span class="keyword">try</span> validSession.updateApplicationContext(iPhoneAppContext)</span><br><span class="line">        &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"Something went wrong"</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é¦–å…ˆæ£€æŸ¥æˆ‘ä»¬æ˜¯å¦æœ‰ä¸€ä¸ªæœ‰æ•ˆçš„ sessionï¼Œå¦‚æœæ˜¯è¿è¡Œåœ¨ iPad ä¸Šï¼Œé‚£ä¹ˆå°†è·³è¿‡æ•´ä¸ªä»£ç å—ã€‚ <code>Application Context</code> æ˜¯ä¸€ä¸ª Swift å­—å…¸ï¼Œå®ƒä»¥ <code>String</code> ä½œä¸º <code>key</code>ï¼Œ<code>AnyObject</code> ä½œä¸º <code>value</code> (<code>Dictionary&lt;String, AnyObject&gt;</code>)ã€‚ value å¿…é¡»éµå¾ªå±æ€§åˆ—è¡¨çš„è§„åˆ™ï¼Œå¹¶ä¸”åªåŒ…å«æŸäº›ç±»å‹ã€‚å®ƒå’Œ <code>NSUserDefaults</code> å…·æœ‰ç›¸åŒçš„é™åˆ¶ï¼Œæ‰€ä»¥åœ¨ä¸Šä¸€ç¯‡æ–‡ç«  <a href="http://www.codingexplorer.com/nsuserdefaults-a-swift-introduction/" target="_blank" rel="noopener">NSUserDefaults â€” A Swift Introduction</a> ä¸­å·²ç»ä»‹ç»è¿‡äº†å…·ä½“å¯ä»¥ä½¿ç”¨å“ªäº›ç±»å‹ã€‚å°½ç®¡å¦‚æ­¤ï¼Œå½“æˆ‘ä»¬å‘é€ä¸€ä¸ª Swift <code>Bool</code> ç±»å‹æ—¶ï¼Œå…¶å°†ä¼šè¢«è½¬æ¢ä¸º <code>NSNumber boolean value</code>ï¼Œæ‰€ä»¥æ²¡å…³ç³»ã€‚</p><p>è°ƒç”¨ <code>updateApplicationContext</code> å¯èƒ½ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å°†å®ƒåŒ…è£…åœ¨ <code>do-block</code> ä¸­å¹¶é€šè¿‡ <code>try</code> æ¥è°ƒç”¨ã€‚å¦‚æœå‡ºç°å¼‚å¸¸ï¼Œæˆ‘ä»¬åªæ˜¯åœ¨æ§åˆ¶å°ä¸Šæ‰“å°äº†ä¸€äº›ä¿¡æ¯ï¼Œä½ è¿˜å¯ä»¥è®¾ç½®ä»»ä½•ä½ éœ€è¦çš„ä¸œè¥¿ï¼Œæ¯”å¦‚ä½ å¯èƒ½éœ€è¦è®©ç”¨æˆ·çŸ¥é“å‘ç”Ÿäº†é”™è¯¯ï¼Œé‚£å°±å¯ä»¥æ˜¾ç¤ºä¸€ä¸ª UIAlerControllerï¼ŒåŒæ ·ï¼Œå¦‚æœæœ‰å¿…è¦å¯ä»¥åŠ å…¥å¼‚å¸¸çš„æ¸…ç†æˆ–æ¢å¤ä»£ç ã€‚è¿™å°±æ˜¯ä¸ºäº†å‘é€ <code>Application Context</code>ï¼Œæˆ‘ä»¬æ‰€éœ€è¦çš„å…¨éƒ¨å‡†å¤‡ã€‚</p><h2 id="è®¾ç½®-watchOS-åº”ç”¨ç¨‹åº"><a href="#è®¾ç½®-watchOS-åº”ç”¨ç¨‹åº" class="headerlink" title="è®¾ç½® watchOS åº”ç”¨ç¨‹åº"></a>è®¾ç½® watchOS åº”ç”¨ç¨‹åº</h2><p>å› ä¸ºæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ä¹‹å‰ <a href="http://www.codingexplorer.com/watchos-2-hello-world-app-in-swift/" target="_blank" rel="noopener">watchOS Hello World App in Swift</a> æ–‡ä¸­çš„ Hello World Appï¼Œæ‰€ä»¥éƒ¨åˆ†ç›¸åŒçš„è®¾ç½®å·²ç»æ›¿æˆ‘ä»¬å®Œæˆäº†ã€‚è·Ÿ iPhone ç±»ä¼¼ï¼Œæˆ‘ä»¬è¿˜éœ€è¦åšä¸€äº›è®¾ç½®æ‰èƒ½ä½¿ç”¨ <code>WatchConnectivity</code>ã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> WatchConnectivity</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">InterfaceController</span>: <span class="title">WKInterfaceController</span>, <span class="title">WCSessionDelegate</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">session</span><span class="params">(<span class="number">_</span> session: WCSession, activationDidCompleteWith activationState: WCSessionActivationState, error: Error?)</span></span> &#123; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> session = <span class="type">WCSession</span>.<span class="keyword">default</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">awake</span><span class="params">(withContext context: Any?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.awake(withContext: context)</span><br><span class="line">        </span><br><span class="line">        session.delegate = <span class="keyword">self</span></span><br><span class="line">        session.activate()</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œçœç•¥æ‰äº†ä¹‹å‰ App ä¸­çš„ä¸€äº›æ— å…³ä»£ç ï¼Œåªå±•ç¤ºä¸ <code>WatchConnectivity</code> è®¾ç½®ç›¸å…³çš„éƒ¨åˆ†ã€‚åŒæ ·ï¼Œæˆ‘ä»¬éœ€è¦å¯¼å…¥ <code>WatchConnectivity</code> æ¡†æ¶ï¼Œå¹¶è®©æˆ‘ä»¬çš„ InterfaceController éµå®ˆ WCSessionDelegate åè®®ï¼Œç´§æ¥ç€ï¼Œæˆ‘ä»¬å°† session å¸¸é‡åˆå§‹åŒ–ä¸º <code>WCSession</code> çš„å•ä¾‹ <code>defaultSession</code>ã€‚</p><p>ä¸ iOS ç«¯ä¸åŒçš„æ˜¯ï¼Œè¿™é‡Œæˆ‘ä»¬å°† session å£°æ˜ä¸ºä¸€ä¸ªéå¯é€‰å€¼çš„å¸¸é‡ã€‚å¾ˆæ˜¾ç„¶ï¼Œè¿è¡Œåœ¨ä¸ä½äº <code>watchOS 2</code> ç³»ç»Ÿä¸Šçš„ Apple Watch æ˜¯æ”¯æŒ <code>Watch Connectivity</code> çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸éœ€è¦åœ¨ <code>watchOS</code> ç«¯è¿›è¡Œç›¸åŒçš„æµ‹è¯•ã€‚ å¹¶ä¸”æˆ‘ä»¬åœ¨å£°æ˜æ—¶å°±åˆå§‹åŒ–äº†å®ƒï¼Œåˆæ²¡æœ‰å…¶ä»–å¹³å°ï¼ˆå¦‚iPadï¼‰éœ€è¦æ‹…å¿ƒï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸éœ€è¦å®ƒæ˜¯å¯é€‰çš„ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œåœ¨ä»£ç çš„åˆæœŸï¼Œæˆ‘ä»¬éœ€è¦è®¾ç½® sessionã€‚åœ¨ InterfaceController ä¸­ awakeWithContext æ–¹æ³•æ˜¯ä¸ªå¾ˆå¥½çš„åœ°æ–¹ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨è¿™é‡Œåšç›¸å…³è®¾ç½®ã€‚å’Œ iOS App ä¸€æ ·ï¼Œæˆ‘ä»¬è®¾ç½®å½“å‰ç±»ä½œä¸º session çš„ä»£ç†ï¼Œç„¶åæ¿€æ´» sessionã€‚</p><p>è®©æˆ‘ä»¬å†™ä¸€ä¸ªè¾…åŠ©æ–¹æ³•æ¥å¤„ç† Application Context çš„å›è°ƒï¼Œå› ä¸ºæˆ‘ä»¬å¯èƒ½ä¼šå¤šæ¬¡è°ƒç”¨å®ƒï¼Œè€Œä¸æ˜¯ä»…ä»…å½“æˆ‘ä»¬æ”¶åˆ°ä¸€ä¸ªæ–° <code>context</code> æ—¶ï¼ˆä½ å¾ˆå¿«ä¼šçœ‹åˆ°ï¼‰ã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">processApplicationContext</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> iPhoneContext = session.receivedApplicationContext <span class="keyword">as</span>? [<span class="type">String</span> : <span class="type">Bool</span>] &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> iPhoneContext[<span class="string">"switchStatus"</span>] == <span class="literal">true</span> &#123;</span><br><span class="line">            displayLabel.setText(<span class="string">"Switch On"</span>)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            displayLabel.setText(<span class="string">"Switch Off"</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>WCSession</code> æœ‰ 2 ä¸ªä¸ <code>Application Context</code> ç›¸å…³çš„å±æ€§ï¼Œ<code>applicationContext</code> å’Œ <code>receivedApplicationContext</code>ã€‚å®ƒä»¬çš„ä¸åŒä¹‹å¤„æ˜¯ï¼š</p><ul><li>applicationContext - æ­¤è®¾å¤‡æœ€è¿‘ä¸€æ¬¡<strong>å‘é€</strong>çš„ <code>Application Context</code>ã€‚</li><li>receivedApplicationContext - æ­¤è®¾å¤‡æœ€è¿‘ä¸€æ¬¡<strong>æ¥æ”¶</strong>çš„ <code>Application Context</code>ã€‚</li></ul><p>ç°åœ¨ï¼ŒæŠŠå®ƒä¿©æ”¾åˆ°ä¸€èµ·æ¥çœ‹ï¼Œè‡³å°‘æ¥æ”¶åˆ°çš„çœ‹èµ·æ¥å¾ˆæ˜æ˜¾ã€‚ä½†åœ¨æˆ‘ç¬¬ä¸€æ¬¡æ¶‰åŠè¿™ä¸ªæ—¶ï¼ˆä¸è®°å¾— WWDC ä¸­ Watch Connectivityçš„ä»‹ç»è§†é¢‘çš„å…¨éƒ¨å†…å®¹ï¼Ÿï¼‰ï¼Œæˆ‘è®¤ä¸º applicationContext æ˜¯ä»æœ€è¿‘çš„å‘é€æˆ–æ¥æ”¶æ¥æ›´æ–°çš„ï¼Œå› ä¸ºæˆ‘è®¤ä¸ºå®ƒä»¬æ˜¯ä¸€è‡´çš„ <code>context</code>ã€‚ç„¶è€Œæˆ‘å¤§é”™ç‰¹é”™ï¼Œæˆ‘èŠ±äº†ä¸€æ®µæ—¶é—´æ‰æ„è¯†åˆ°å®ƒä»¬æ˜¯åˆ†å¼€çš„ã€‚æˆ‘å½“ç„¶èƒ½çœ‹å‡ºæ¥åŸå› ï¼Œå› ä¸ºæˆ‘ä»¬å¯èƒ½æ¯æ¬¡éƒ½ä¼šå‘é€ä¸ä¸€æ ·çš„æ•°æ®ï¼Œå°±åƒä» Watch çš„è§’åº¦æ¥çœ‹ï¼ŒapplicationContext å°±æ˜¯ iPhone ç«¯éœ€è¦çš„ Watch ç›¸å…³ <code>context</code>ï¼Œè€Œ receivedApplicationContext åˆ™æ˜¯ Watch ç«¯éœ€è¦çš„ iPhone ç›¸å…³ <code>context</code>ã€‚æ— è®ºå“ªç§æ–¹å¼ï¼Œè¯·è®°ä½å®ƒä»¬æ˜¯ä¸åŒçš„ä¸¤ä¸ªä¸œè¥¿ï¼Œå¹¶æ ¹æ®å®é™…æƒ…å†µé€‰æ‹©ä½ æ‰€éœ€è¦çš„é‚£ä¸ªã€‚</p><p>æ‰€ä»¥åœ¨è¿™ä¸ªæ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆå°è¯•å°† <code>receivedApplicationContext</code> ç”± <code>[String: AnyObject]</code> ç±»å‹çš„å­—å…¸è½¬æ¢ä¸ºæˆ‘ä»¬éœ€è¦çš„ <code>[String: Bool]</code> ç±»å‹ã€‚å¦‚æœè½¬æ¢æˆåŠŸï¼Œåˆ™å†æ ¹æ®å­—å…¸ä¸­å¸ƒå°”å€¼çš„çŠ¶æ€å°† displayLabel çš„ text å€¼è®¾ç½®ä¸º â€œSwitch Onâ€ æˆ– â€œSwitch Offâ€ã€‚</p><p>å½“æˆ‘ä»¬å®é™…æ¥æ”¶åˆ°ä¸€ä¸ªæ–°çš„  Application context æ—¶ï¼Œè¯¥ InterfaceController å°†ä¼šæ”¶åˆ°æˆ‘ä»¬ WCSession å¯¹è±¡çš„ä»£ç†å›è°ƒæ¥é€šçŸ¥æˆ‘ä»¬è¿™ä¸ªä¿¡æ¯ï¼Œæˆ‘ä»¬å°†åœ¨é‚£é‡Œè°ƒç”¨è¿™ä¸ªè¾…åŠ©æ–¹æ³•ã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">session</span><span class="params">(<span class="number">_</span> session: WCSession, didReceiveApplicationContext applicationContext: [String : Any])</span></span> &#123;</span><br><span class="line">    <span class="type">DispatchQueue</span>.main.async() &#123;</span><br><span class="line">        <span class="keyword">self</span>.processApplicationContext()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç°åœ¨ï¼Œä½ å¤§æ¦‚çœ‹åˆ°äº† <code>didReceiveApplicationContext</code> æ–¹æ³•çš„å…¥å‚å¸¦æœ‰å®ƒæ¥æ”¶åˆ°çš„ <code>Application Context</code> å‰¯æœ¬ã€‚å®ƒå­˜å‚¨åœ¨ä¸Šé¢æåˆ°çš„ <code>receivedApplicationContext</code> å±æ€§ä¸­ã€‚æ‰€ä»¥æˆ‘ä»¬å¹¶ä¸éœ€è¦å®ƒæ¥è°ƒç”¨è¾…åŠ©æ–¹æ³•, å› æ­¤è¿™ä¸ªæ–¹æ³•ä¸éœ€è¦ä¼ å…¥ä»»ä½•è¡Œå‚ã€‚</p><blockquote><p>è¯‘è€…æ³¨ï¼š<br>å…¶å®å¯¹äºè¾…åŠ©æ–¹æ³• <code>processApplicationContext</code> æ¥è¯´ï¼Œå¢åŠ è¡Œå‚ context åè€Œæ›´ <strong>å‡½æ•°å¼</strong>ï¼Œä¹Ÿæ›´ <strong>Swift</strong>ã€‚ é€šè¿‡å¢åŠ ä¸€ä¸ª context çš„å…¥å‚ï¼Œå¯ä»¥è®©æ–¹æ³•å†…éƒ¨å®ç°å’Œå¤–éƒ¨ä¾èµ–è§£è€¦ï¼Œæ›´åŠ æ–¹ä¾¿æˆ‘ä»¬å¯¹å®ƒè¿›è¡Œå•å…ƒæµ‹è¯•ã€‚</p></blockquote><p>é‚£ä¹ˆï¼Œè°ƒç”¨ <code>dispatch_async</code> æ˜¯ä¸ºäº†åšä»€ä¹ˆå‘¢ï¼Ÿå¥½å§ï¼Œè¿™äº›ä»£ç†å›è°ƒä¸åœ¨ä¸»çº¿ç¨‹ä¸Šã€‚ä½ æ°¸è¿œä¸åº”è¯¥åœ¨é™¤ä¸»çº¿ç¨‹ä»¥å¤–çš„ä»»ä½•çº¿ç¨‹æ›´æ–° iOS æˆ– watchOS ä¸­çš„ UIã€‚è€Œæˆ‘ä»¬çš„è¾…åŠ©æ–¹æ³•é™¤äº†ä» <code>receivedApplicationContext</code> ä¸­è¯»å–ä¿¡æ¯ä¹‹å¤–ï¼Œä¸»è¦ç›®çš„æ˜¯ç”¨æ¥æ›´æ–° UI å…ƒç´ ã€‚å› æ­¤ï¼Œæˆ‘ä»¬è¦é€šè¿‡ <code>dispatch_async</code> æ–¹æ³•è¿”å›ä¸»çº¿ç¨‹æ¥è°ƒç”¨è¯¥æ–¹æ³•ã€‚è°ƒç”¨ <code>dispatch_async</code> éœ€è¦ 2 ä¸ªå‚æ•°ï¼Œé¦–å…ˆæ˜¯æ´¾å‘é˜Ÿåˆ—ï¼ˆå¯¹äºä¸»çº¿ç¨‹ï¼Œæˆ‘ä»¬é€šè¿‡ <code>dispatch_get_main_queue</code> æ–¹æ³•è·å–ï¼‰ï¼Œå…¶æ¬¡æ˜¯ä¸€ä¸ªé—­åŒ…æ¥å‘Šè¯‰å®ƒéœ€è¦åšä»€ä¹ˆæ“ä½œï¼Œè¿™é‡Œæˆ‘ä»¬åªæ˜¯å‘Šè¯‰å®ƒå»è°ƒç”¨è¾…åŠ©æ–¹æ³•ã€‚</p><p>æ‰€ä»¥ï¼Œä¸ºä»€ä¹ˆæˆ‘ä»¬è¦åœ¨è¾…åŠ©æ–¹æ³•é‡Œè¿™æ ·åšï¼Œè€Œä¸æ˜¯ç›´æ¥åœ¨å›è°ƒæ–¹æ³•é‡Œé¢ç›´æ¥å¤„ç†å‘¢ï¼Ÿå¥½å§ï¼Œå½“ä½ å®é™…æ¥æ”¶åˆ°ä¸€ä¸ªæ–°çš„ <code>Application Context</code> æ—¶ï¼Œä¼šå›è°ƒ <code>didReceiveApplicationContext</code> ä»£ç†æ–¹æ³•ã€‚å½“ <code>WCSession</code> åœ¨å…³é—­æ—¶æ¥æ”¶åˆ°æ–°çš„ <code>ApplicationContext</code> ä¼šè°ƒç”¨ activateSession æ–¹æ³•ï¼Œåœ¨é‚£ä¸ä¹…ä¹‹åä¹Ÿä¼šå›è°ƒåˆ° <code>didReceiveApplicationContext</code> æ–¹æ³•ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä½¿ç”¨æ­¤ ApplicationContext ä½œä¸ºè¯¥ä¿¡æ¯çš„åå¤‡å­˜å‚¨ã€‚æˆ‘ä¸ç¡®å®šè¿™æ˜¯ä¸æ˜¯ä¸€ä¸ªå¥½çš„ä¸»æ„ï¼Œä½†æ˜¯å¯¹äºä¸€ä¸ªç®€å•çš„ app æ¥è¯´ï¼Œè¿™æ˜¯åˆç†çš„ï¼Œ å› ä¸º <code>label</code> çš„é‡ç‚¹æ˜¯æ˜¾ç¤º iPhone ä¸Šçš„ <code>UISwitch</code> æ˜¯å¼€å¯è¿˜æ˜¯å…³é—­ã€‚</p><p>é‚£ä¹ˆï¼Œå½“æˆ‘ä»¬çš„ app å®ŒæˆåŠ è½½ä¹‹åæƒ³ä½¿ç”¨æœ€åä¸€æ¬¡æ¥æ”¶åˆ°çš„å€¼ï¼Œä½†æ˜¯ app åœ¨å…³é—­æœŸé—´åˆæ²¡æœ‰æ”¶åˆ°æ–°çš„ <code>context</code>ï¼Œè¿™ç§æƒ…å†µè¯¥æ€ä¹ˆåŠï¼Ÿæˆ‘ä»¬åœ¨è§†å›¾ç”Ÿå‘½å‘¨æœŸçš„æ—©æœŸè®¾ç½® labelï¼Œæ‰€ä»¥ç°åœ¨ <code>awakeWithContext</code> çœ‹èµ·æ¥åº”è¯¥æ˜¯è¿™æ ·ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">awake</span><span class="params">(withContext context: Any?)</span></span> &#123;</span><br><span class="line">    <span class="keyword">super</span>.awake(withContext: context)</span><br><span class="line"> </span><br><span class="line">    processApplicationContext()</span><br><span class="line"> </span><br><span class="line">    session.delegate = <span class="keyword">self</span></span><br><span class="line">    session.activate()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç”±äº awakeWithContext è‚¯å®šåœ¨ä¸»çº¿ç¨‹ä¸Šï¼Œæˆ‘ä»¬ä¸éœ€è¦ <code>dispatch_async</code>ã€‚ å› æ­¤è¿™å°±æ˜¯å®ƒä»…ç”¨äºåœ¨ didReceiveApplicationContext å›è°ƒä¸­æ¥è°ƒç”¨è¾…åŠ©æ–¹æ³•è€Œä¸æ˜¯åœ¨è¾…åŠ©æ–¹æ³•å†…éƒ¨ä½¿ç”¨çš„åŸå› ã€‚</p><p>æ­¤æ—¶ iOS App å¹¶æ²¡æœ‰ä¿ç•™è¯¥ <code>UISwitch</code> çš„çŠ¶æ€ï¼Œæ‰€ä»¥åœ¨å¯åŠ¨æ—¶ä¿æŒå®ƒä»¬çš„åŒæ­¥å¹¶ä¸é‚£ä¹ˆé‡è¦ï¼Œå¯¹äºä¸€ä¸ªæœ‰ä»·å€¼çš„ app æ¥è¯´ï¼Œæˆ‘ä»¬åº”è¯¥å°† UISwitch çš„çŠ¶æ€å­˜å‚¨åœ¨æŸä¸ªåœ°æ–¹ã€‚æ¯”å¦‚å¯ä»¥åœ¨ iPhone ç«¯ä½¿ç”¨ WCSession çš„ ApplicationContext å±æ€§ã€‚ï¼ˆè¯·è®°ä½ï¼ŒapplicationContext æ˜¯ä»è®¾å¤‡<strong>å‘é€</strong>è¿‡æ¥çš„æœ€åä¸€ä¸ª <code>context</code>ï¼‰ï¼Œä½†å¦‚æœæ˜¯åœ¨iPadä¸Šè¿è¡Œå‘¢ï¼Ÿä½ å¯ä»¥å°†å®ƒå­˜å‚¨åœ¨ <code>NSUserDefaults</code>ï¼Œæˆ–è€…å…¶ä»–è®¸å¤šåœ°æ–¹ï¼Œä½†è¿™äº›ä¸åœ¨å¦‚ä½•ä½¿ç”¨ WatchConnectivity çš„è®¨è®ºèŒƒç•´å†…ã€‚å…·ä½“ä½ å¯ä»¥åœ¨æ—©æœŸçš„ <a href="http://www.codingexplorer.com/nsuserdefaults-a-swift-introduction/" target="_blank" rel="noopener">NSUserDefaults â€” A Swift Introduction</a> æ–‡ç« ä¸­äº†è§£åˆ°ã€‚</p><h2 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h2><p>ä»¥ä¸‹æ˜¯è¯¥é¡¹ç›®çš„å®Œæ•´ä»£ç ï¼š</p><h3 id="ViewController-swift"><a href="#ViewController-swift" class="headerlink" title="ViewController.swift"></a>ViewController.swift</h3><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"><span class="keyword">import</span> WatchConnectivity</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewController</span>: <span class="title">UIViewController</span>, <span class="title">WCSessionDelegate</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">session</span><span class="params">(<span class="number">_</span> session: WCSession, activationDidCompleteWith activationState: WCSessionActivationState, error: Error?)</span></span> &#123; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">sessionDidBecomeInactive</span><span class="params">(<span class="number">_</span> session: WCSession)</span></span> &#123; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">sessionDidDeactivate</span><span class="params">(<span class="number">_</span> session: WCSession)</span></span> &#123; &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@IBOutlet</span> <span class="keyword">var</span> theSwitch: <span class="type">UISwitch</span>!</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> session: <span class="type">WCSession</span>?</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.viewDidLoad()</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> <span class="type">WCSession</span>.isSupported() &#123;</span><br><span class="line">            session = <span class="type">WCSession</span>.<span class="keyword">default</span></span><br><span class="line">            session?.delegate = <span class="keyword">self</span></span><br><span class="line">            session?.activate()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">processApplicationContext</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> iPhoneContext = session?.applicationContext <span class="keyword">as</span>? [<span class="type">String</span> : <span class="type">Bool</span>] &#123;</span><br><span class="line">            <span class="keyword">if</span> iPhoneContext[<span class="string">"switchStatus"</span>] == <span class="literal">true</span> &#123;</span><br><span class="line">                theSwitch.isOn = <span class="literal">true</span></span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                theSwitch.isOn = <span class="literal">false</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@IBAction</span> <span class="function"><span class="keyword">func</span> <span class="title">switchValueChanged</span><span class="params">(<span class="number">_</span> sender: UISwitch)</span></span> &#123;</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> validSession = session &#123;</span><br><span class="line">            <span class="keyword">let</span> iPhoneAppContext = [<span class="string">"switchStatus"</span>: sender.isOn]</span><br><span class="line"></span><br><span class="line">            <span class="keyword">do</span> &#123;</span><br><span class="line">                <span class="keyword">try</span> validSession.updateApplicationContext(iPhoneAppContext)</span><br><span class="line">            &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">"Something went wrong"</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="InterfaceController-swift"><a href="#InterfaceController-swift" class="headerlink" title="InterfaceController.swift"></a>InterfaceController.swift</h3><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> WatchKit</span><br><span class="line"><span class="keyword">import</span> WatchConnectivity</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">InterfaceController</span>: <span class="title">WKInterfaceController</span>, <span class="title">WCSessionDelegate</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">session</span><span class="params">(<span class="number">_</span> session: WCSession, activationDidCompleteWith activationState: WCSessionActivationState, error: Error?)</span></span> &#123; &#125;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="meta">@IBOutlet</span> <span class="keyword">var</span> displayLabel: <span class="type">WKInterfaceLabel</span>!</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">let</span> session = <span class="type">WCSession</span>.<span class="keyword">default</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">awake</span><span class="params">(withContext context: Any?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.awake(withContext: context)</span><br><span class="line">        </span><br><span class="line">        processApplicationContext()</span><br><span class="line">        </span><br><span class="line">        session.delegate = <span class="keyword">self</span></span><br><span class="line">        session.activate()</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@IBAction</span> <span class="function"><span class="keyword">func</span> <span class="title">buttonTapped</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="comment">//displayLabel.setText("Hello World!")</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">session</span><span class="params">(<span class="number">_</span> session: WCSession, didReceiveApplicationContext applicationContext: [String : Any])</span></span> &#123;</span><br><span class="line">        <span class="type">DispatchQueue</span>.main.async() &#123;</span><br><span class="line">            <span class="keyword">self</span>.processApplicationContext()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">processApplicationContext</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> iPhoneContext = session.receivedApplicationContext <span class="keyword">as</span>? [<span class="type">String</span> : <span class="type">Bool</span>] &#123;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> iPhoneContext[<span class="string">"switchStatus"</span>] == <span class="literal">true</span> &#123;</span><br><span class="line">                displayLabel.setText(<span class="string">"Switch On"</span>)</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                displayLabel.setText(<span class="string">"Switch Off"</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¯·è®°ä½ï¼Œè¿™äº›ä»£ç æ¥è‡ª Hello World Appï¼Œä½†æ˜¯æˆ‘ä»¬æ²¡æœ‰ç”¨åˆ° watchOS App ä¸Šçš„ buttonã€‚æ‰€ä»¥æˆ‘åªæ˜¯æ³¨é‡Šäº†åŸå§‹åŠŸèƒ½çš„ä»£ç ã€‚</p><h2 id="ç»“è®º"><a href="#ç»“è®º" class="headerlink" title="ç»“è®º"></a>ç»“è®º</h2><p>ä»¥ä¸Šå°±æ˜¯å¦‚ä½•ä½¿ç”¨ Watch Connectivity çš„ Application Context æ–¹å¼è¿›è¡Œåå°ä¼ è¾“çš„æ•™ç¨‹ã€‚å‘æ‰‹æœºç«¯å›ä¼ æ•°æ®ä¹Ÿæ˜¯å®Œå…¨ç›¸åŒçš„ï¼Œå› ä¸ºå®ƒä»¬å…·æœ‰åŒæ ·çš„ä»£ç†å›è°ƒå’Œå±æ€§ã€‚è™½ç„¶åœ¨é‚£ç§æƒ…å†µä¸‹ï¼Œä½ å¯èƒ½è¿˜éœ€è¦æ ¹æ®å®é™…æƒ…å†µæ£€æŸ¥æ˜¯å¦å­˜åœ¨ä¸è¯¥è®¾å¤‡é…å¯¹çš„ Apple Watch æˆ–è€… Watch ä¸Šæ˜¯å¦å®‰è£…äº†å¯¹åº”çš„ appã€‚</p><p>æ­£å¦‚æˆ‘ä¹‹å‰æåˆ°çš„ï¼Œåœ¨ <code>ViewController / InterfaceController</code> ä¸­æ‰§è¡Œæ‰€æœ‰ä»£ç å¯èƒ½ä¸æ˜¯æœ€å¥½çš„ä¸»æ„ï¼Œä½†è¿™åªæ˜¯ä¸ºäº†ç®€å•åœ°å±•ç¤ºå¦‚ä½•ä½¿ç”¨ APIâ€‹â€‹ã€‚æˆ‘ä¸ªäººéå¸¸å–œæ¬¢åœ¨è‡ªå·±çš„ <code>Watch Connectivity manager</code> å®ä¾‹ä¸­æ‰§è¡Œè¿™äº›æ“ä½œã€‚æ‰€ä»¥æˆ‘å¼ºçƒˆå»ºè®®ä½ é˜…è¯» Natasha The Robot çš„æ–‡ç«  <a href="https://www.natashatherobot.com/watchconnectivity-say-hello-to-wcsession/" target="_blank" rel="noopener">WatchConnectivity: Say Hello to WCSession</a>ï¼Œå¹¶å…³è”ä»–çš„ <a href="https://gist.github.com/NatashaTheRobot/6bcbe79afd7e9572edf6" target="_blank" rel="noopener">GitHub Gist</a>ã€‚è¿™å°†å¯¹ä½ ä½¿ç”¨ WatchConnectivity å¾ˆæœ‰å¸®åŠ©ã€‚</p><p>æˆ‘å¸Œæœ›æœ¬æ–‡èƒ½å¯¹ä½ æœ‰æ‰€å¸®åŠ©ã€‚å¦‚æœæœ‰å¸®åˆ°ä½ ï¼Œè¯·ä¸è¦çŠ¹è±«ï¼Œåœ¨ Twitter æˆ–è€…ä½ é€‰æ‹©çš„ç¤¾äº¤åª’ä½“ä¸Šåˆ†äº«è¿™ç¯‡æ–‡ç« ï¼Œæ¯ä¸ªåˆ†äº«å¯¹æˆ‘éƒ½æ˜¯å¸®åŠ©ã€‚å½“ç„¶ï¼Œå¦‚æœä½ æœ‰ä»»ä½•ç–‘é—®ï¼Œè¯·éšæ—¶é€šè¿‡<a href="http://www.codingexplorer.com/contact/" target="_blank" rel="noopener">è”ç³»é¡µé¢</a>æˆ– Twitter <a href="https://twitter.com/CodingExplorer" target="_blank" rel="noopener">@CodingExplorer</a> ä¸æˆ‘è”ç³»ï¼Œæˆ‘ä¼šçœ‹çœ‹æˆ‘èƒ½åšäº›ä»€ä¹ˆã€‚è°¢è°¢ï¼</p><h2 id="æ¥æº"><a href="#æ¥æº" class="headerlink" title="æ¥æº"></a>æ¥æº</h2><ul><li><a href="https://itunes.apple.com/us/book/swift-programming-language/id881256329?mt=11&amp;uo=4&amp;at=10lJ3x&amp;ct=blog-SwiftOperatorOverloading" target="_blank" rel="noopener">The Swift Programming Language â€“ Apple Inc.</a></li><li><a href="https://medium.com/swift-programming/facets-of-swift-part-5-custom-operators-1080bc78ccc" target="_blank" rel="noopener">Facets of Swift, Part 5: Custom Operators â€” Swift Programming â€” Medium</a></li><li><a href="http://www.kristinathai.com/watchos-2-tutorial-using-application-context-to-transfer-data-watch-connectivity-2/" target="_blank" rel="noopener">watchOS 2 Tutorial: Using application context to transfer data (Watch    Connectivity #2)</a> by <a href="https://twitter.com/kristinathai" target="_blank" rel="noopener">Kristina Thai</a></li><li><a href="https://www.natashatherobot.com/watchconnectivity-application-context/" target="_blank" rel="noopener">WatchConnectivity: Sharing The Latest Data via Application Context</a> by   <a href="https://twitter.com/natashatherobot" target="_blank" rel="noopener">Natasha The Robot</a></li></ul><blockquote><p>æœ¬æ–‡ç”± SwiftGG ç¿»è¯‘ç»„ç¿»è¯‘ï¼Œå·²ç»è·å¾—ä½œè€…ç¿»è¯‘æˆæƒï¼Œæœ€æ–°æ–‡ç« è¯·è®¿é—® <a href="http://swift.gg">http://swift.gg</a>ã€‚</p></blockquote>]]></content>
    
    <summary type="html">
    
      æœ¬æ–‡è¯¦ç»†è®²è§£äº†å¦‚ä½•é€šè¿‡ Watch Connectivity çš„ Application Context æ–¹å¼è¿›è¡Œ watch å’Œ é…å¯¹ iPhone ä¹‹é—´å…±äº«æ•°æ®ã€‚
    
    </summary>
    
      <category term="codingexplorer" scheme="https://swift.gg/categories/codingexplorer/"/>
    
    
      <category term="æ•™ç¨‹" scheme="https://swift.gg/tags/%E6%95%99%E7%A8%8B/"/>
    
  </entry>
  
  <entry>
    <title>Swift 4 ä¸­çš„å­—ç¬¦ä¸²</title>
    <link href="https://swift.gg/2018/08/09/swift-4-strings/"/>
    <id>https://swift.gg/2018/08/09/swift-4-strings/</id>
    <published>2018-08-09T00:00:00.000Z</published>
    <updated>2018-09-10T03:53:25.085Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ä½œè€…ï¼šOle Begemannï¼Œ<a href="https://oleb.net/blog/2017/11/swift-4-strings" target="_blank" rel="noopener">åŸæ–‡é“¾æ¥</a>ï¼ŒåŸæ–‡æ—¥æœŸï¼š2017-11-27<br>è¯‘è€…ï¼š<a href="https://weibo.com/u/5029986118" target="_blank" rel="noopener">ä¸œèå¤§å”å’Œå°š</a>ï¼›æ ¡å¯¹ï¼š<a href="http://www.jianshu.com/users/596f2ba91ce9/latest_articles" target="_blank" rel="noopener">pmst</a>ï¼Œ<a href="undefined">Firecrest</a>ï¼›å®šç¨¿ï¼š<a href="https://github.com/chenmingbiao" target="_blank" rel="noopener">CMB</a></p></blockquote><!--æ­¤å¤„å¼€å§‹æ­£æ–‡--><p>è¿™ä¸ªç³»åˆ—ä¸­å…¶ä»–æ–‡ç« ï¼š</p><ol><li><a href="https://oleb.net/blog/2014/07/swift-strings/" target="_blank" rel="noopener">Swift 1 ä¸­çš„å­—ç¬¦ä¸²</a></li><li><a href="https://oleb.net/blog/2016/08/swift-3-strings/" target="_blank" rel="noopener">Swift 3 ä¸­çš„å­—ç¬¦ä¸²</a></li><li>Swift 4 ä¸­çš„å­—ç¬¦ä¸²ï¼ˆæœ¬æ–‡ï¼‰</li></ol><p>æœ¬æ–‡èŠ‚é€‰è‡ªæˆ‘ä»¬çš„æ–°ä¹¦ã€Šé«˜çº§ Swift ç¼–ç¨‹ã€‹ã€Œå­—ç¬¦ä¸²ã€è¿™ä¸€ç« ã€‚ã€Šé«˜çº§ Swift ç¼–ç¨‹ã€‹æ–°ç‰ˆæœ¬å·²æ ¹æ® Swift 4 çš„æ–°ç‰¹æ€§ä¿®è®¢è¡¥å……ï¼Œæ–°ç‰ˆç°å·²ä¸Šå¸‚ã€‚</p><a id="more"></a><p>æ‰€æœ‰çš„ç°ä»£ç¼–ç¨‹è¯­è¨€éƒ½æœ‰å¯¹ Unicode ç¼–ç å­—ç¬¦ä¸²çš„æ”¯æŒï¼Œä½†è¿™é€šå¸¸åªæ„å‘³ç€å®ƒä»¬çš„åŸç”Ÿå­—ç¬¦ä¸²ç±»å‹å¯ä»¥å­˜å‚¨ Unicode ç¼–ç çš„æ•°æ®â€”â€”å¹¶ä¸æ„å‘³ç€æ‰€æœ‰åƒè·å–å­—ç¬¦ä¸²é•¿åº¦è¿™æ ·ç®€å•çš„æ“ä½œéƒ½ä¼šå¾—åˆ°ã€Œåˆæƒ…åˆç†ã€çš„è¾“å‡ºç»“æœã€‚</p><p>å®é™…ä¸Šï¼Œå¤§å¤šæ•°è¯­è¨€ï¼Œä»¥åŠç”¨è¿™äº›è¯­è¨€ç¼–å†™çš„å¤§å¤šæ•°å­—ç¬¦ä¸²æ“ä½œä»£ç ï¼Œéƒ½è¡¨ç°å‡ºå¯¹Unicodeå›ºæœ‰å¤æ‚æ€§çš„æŸç§ç¨‹åº¦çš„å¦å®šã€‚è¿™å¯èƒ½ä¼šå¯¼è‡´ä¸€äº›ä»¤äººä¸å¼€å¿ƒçš„é”™è¯¯</p><p>Swift ä¸ºäº†å­—ç¬¦ä¸²çš„å®ç°æ”¯æŒ Unicode åšå‡ºäº†å·¨å¤§çš„åŠªåŠ›ã€‚Swift ä¸­çš„ <a href="https://developer.apple.com/documentation/swift/string" target="_blank" rel="noopener"><code>String</code></a>ï¼ˆå­—ç¬¦ä¸²ï¼‰æ˜¯ä¸€ç³»åˆ— <a href="https://developer.apple.com/documentation/swift/character" target="_blank" rel="noopener"><code>Character</code></a> å€¼ï¼ˆå­—ç¬¦ï¼‰çš„é›†åˆã€‚è¿™é‡Œçš„ <code>Character</code> æŒ‡çš„æ˜¯äººä»¬è§†ä¸ºå•ä¸ªå­—æ¯çš„å¯è¯»æ–‡æœ¬ï¼Œæ— è®ºè¿™ä¸ªå­—æ¯æ˜¯ç”±å¤šå°‘ä¸ª Unicode ç¼–ç å­—ç¬¦ç»„æˆã€‚å› æ­¤ï¼Œæ‰€æœ‰å¯¹äº <code>Collection</code>ï¼ˆé›†åˆï¼‰çš„æ“ä½œï¼ˆæ¯”å¦‚ <code>count</code> æˆ–è€… <code>prefix(5)</code>ï¼‰ä¹ŸåŒæ ·æ˜¯æŒ‰ç…§ç”¨æˆ·æ‰€ç†è§£çš„å­—æ¯æ¥æ“ä½œçš„ã€‚</p><p>è¿™æ ·çš„è®¾è®¡åœ¨æ­£ç¡®æ€§ä¸Šæ— å¯æŒ‘å‰”ï¼Œä½†è¿™æ˜¯æœ‰ä»£ä»·çš„ï¼Œä¸»è¦æ˜¯äººä»¬å¯¹å®ƒä¸ç†Ÿæ‚‰ã€‚å¦‚æœä½ ä¹ æƒ¯äº†ç†Ÿç»ƒæ“ä½œå…¶ä»–ç¼–ç¨‹è¯­è¨€é‡Œå­—ç¬¦ä¸²çš„æ•´æ•°ç´¢å¼•ï¼ŒSwift çš„è®¾è®¡ä¼šè®©ä½ è§‰å¾—ç¬¨é‡ä¸å ªï¼Œè®©ä½ æ„Ÿè§‰åˆ°å¥‡æ€ªã€‚ä¸ºä»€ä¹ˆ <code>str[999]</code> ä¸èƒ½è·å¾—å­—ç¬¦ä¸²ç¬¬ä¸€åƒä¸ªå­—ç¬¦ï¼Ÿä¸ºä»€ä¹ˆ <code>str[idx+1]</code> ä¸èƒ½è·å¾—ä¸‹ä¸€ä¸ªå­—ç¬¦ï¼Ÿä¸ºä»€ä¹ˆä¸èƒ½ç”¨ç±»ä¼¼ <code>&quot;a&quot;...&quot;z&quot;</code> çš„æ–¹å¼éå†ä¸€ä¸ªèŒƒå›´çš„ <code>Character</code>ï¼ˆå­—ç¬¦ï¼‰ï¼Ÿ</p><p>åŒæ—¶ï¼Œè¿™æ ·çš„è®¾è®¡å¯¹ä»£ç æ€§èƒ½ä¹Ÿæœ‰ä¸€å®šçš„å½±å“ï¼š<code>String</code> ä¸æ”¯æŒéšæ„è·å–ã€‚æ¢å¥è¯è¯´ï¼Œè·å¾—ä¸€ä¸ªä»»æ„å­—ç¬¦ä¸æ˜¯ O(1) çš„æ“ä½œâ€”â€”å½“å­—ç¬¦å®½åº¦æ˜¯ä¸ªå˜é‡çš„æ—¶å€™ï¼Œå­—ç¬¦ä¸²åªæœ‰æŸ¥çœ‹è¿‡å‰é¢æ‰€æœ‰å­—ç¬¦ä¹‹åï¼Œæ‰ä¼šçŸ¥é“ç¬¬ n ä¸ªå­—ç¬¦å‚¨å­˜åœ¨å“ªé‡Œã€‚</p><p>åœ¨æœ¬ç« ä¸­ï¼Œæˆ‘ä»¬ä¸€èµ·æ¥è¯¦ç»†è®¨è®ºä¸€ä¸‹ Swift ä¸­å­—ç¬¦ä¸²çš„è®¾è®¡ï¼Œä»¥åŠä¸€äº›è·å¾—åŠŸèƒ½å’Œæ€§èƒ½æœ€ä¼˜çš„æŠ€å·§ã€‚ä¸è¿‡ï¼Œé¦–å…ˆæˆ‘ä»¬è¦å…ˆæ¥å­¦ä¹ ä¸€ä¸‹ Unicode ç¼–ç çš„ä¸“ä¸šçŸ¥è¯†ã€‚</p><h2 id="Unicodeï¼šæŠ›å¼ƒå›ºå®šå®½åº¦"><a href="#Unicodeï¼šæŠ›å¼ƒå›ºå®šå®½åº¦" class="headerlink" title="Unicodeï¼šæŠ›å¼ƒå›ºå®šå®½åº¦"></a>Unicodeï¼šæŠ›å¼ƒå›ºå®šå®½åº¦</h2><p>æœ¬æ¥äº‹æƒ…å¾ˆç®€å•ã€‚<a href="https://en.wikipedia.org/wiki/ASCII" target="_blank" rel="noopener">ASCIIç¼–ç </a> çš„å­—ç¬¦ä¸²ç”¨ 0 åˆ° 127 ä¹‹é—´çš„ä¸€ç³»åˆ—æ•´æ•°è¡¨ç¤ºã€‚å¦‚æœä½¿ç”¨ 8 æ¯”ç‰¹çš„äºŒè¿›åˆ¶æ•°ç»„åˆè¡¨ç¤ºå­—ç¬¦ï¼Œç”šè‡³è¿˜å¤šä½™ä¸€ä¸ªæ¯”ç‰¹ï¼ç”±äºæ¯ä¸ªå­—ç¬¦çš„é•¿åº¦å›ºå®šï¼Œæ‰€ä»¥ ASCII ç¼–ç çš„å­—ç¬¦ä¸²æ˜¯å¯ä»¥éšæœºè·å–çš„ã€‚</p><p>ä½†æ˜¯ï¼Œå¦‚æœä¸æ˜¯è‹±è¯­è€Œæ˜¯å…¶ä»–å›½å®¶çš„è¯­è¨€çš„è¯ï¼Œå…¶ä¸­çš„ä¸€äº›å­—ç¬¦ ASCII ç¼–ç æ˜¯ä¸å¤Ÿçš„ï¼ˆå…¶å®å³ä½¿æ˜¯è¯´è‹±è¯­çš„è‹±å›½ä¹Ÿæœ‰ä¸€ä¸ªâ€Â£â€ç¬¦å·ï¼‰ã€‚è¿™äº›è¯­è¨€ä¸­çš„ç‰¹æ®Šå­—ç¬¦å¤§å¤šæ•°éƒ½éœ€è¦è¶…è¿‡ 7 æ¯”ç‰¹çš„ç¼–ç ã€‚åœ¨ <a href="https://en.wikipedia.org/wiki/ISO/IEC_8859" target="_blank" rel="noopener">ISO 8859</a> æ ‡å‡†ä¸­ï¼Œå°±ç”¨å¤šå‡ºæ¥çš„é‚£ä¸ªæ¯”ç‰¹å®šä¹‰äº† 16 ç§è¶…å‡º ASCII ç¼–ç èŒƒå›´çš„ç¼–ç ï¼Œæ¯”å¦‚ç¬¬ä¸€éƒ¨åˆ†ï¼ˆISO8859-1ï¼‰åŒ…æ‹¬äº†å‡ ç§è¥¿æ¬§è¯­è¨€çš„ç¼–ç ï¼Œç¬¬äº”éƒ¨åˆ†åŒ…æ‹¬äº†å¯¹è¥¿é‡Œå°”å­—æ¯è¯­è¨€çš„ç¼–ç ã€‚</p><p>ä½†è¿™æ ·çš„åšæ³•å…¶å®è¿˜æœ‰å±€é™ã€‚å¦‚æœä½ æƒ³æ ¹æ® ISO8859 æ ‡å‡†ï¼Œç”¨åœŸè€³å…¶è¯­å†™å¤å¸Œè…Šè¯­çš„è¯ï¼Œä½ å°±ä¸èµ°è¿äº†ï¼Œå› ä¸ºä½ è¦ä¹ˆå¾—é€‰æ‹©ç¬¬ä¸ƒéƒ¨åˆ†ï¼ˆæ‹‰ä¸è¯­/å¸Œè…Šè¯­ï¼‰æˆ–è€…ç¬¬ä¹éƒ¨åˆ†ï¼ˆåœŸè€³å…¶è¯­ï¼‰ã€‚è€Œä¸”ï¼Œæ€»çš„æ¥è¯´ 8 ä¸ªæ¯”ç‰¹çš„ç¼–ç ç©ºé—´æ— æ³•æ¶µç›–å¤šç§è¯­è¨€ã€‚ä¾‹å¦‚ï¼Œç¬¬å…­éƒ¨åˆ†ï¼ˆæ‹‰ä¸è¯­/é˜¿æ‹‰ä¼¯è¯­ï¼‰å°±ä¸åŒ…å«åŒæ ·ä½¿ç”¨é˜¿æ‹‰ä¼¯å­—æ¯çš„ä¹Œå°”éƒ½è¯­å’Œæ³¢æ–¯è¯­ä¸­çš„å¾ˆå¤šå­—ç¬¦ã€‚åŒæ—¶ï¼Œè¶Šå—è¯­è™½ç„¶ä½¿ç”¨çš„ä¹Ÿæ˜¯æ‹‰ä¸å­—æ¯ï¼Œä½†æ˜¯æœ‰å¾ˆå¤šå˜éŸ³ç»„åˆï¼Œè¿™ç§æƒ…å†µåªæœ‰æ›¿æ¢æ‰ä¸€äº›åŸæœ‰ ASCII ç¼–ç çš„å­—æ¯æ‰å¯èƒ½å­˜å‚¨åˆ° 8 ä¸ªæ¯”ç‰¹çš„ç©ºé—´é‡Œã€‚è€Œä¸”ï¼Œè¿™ç§æ–¹æ³•ä¸é€‚ç”¨å…¶ä»–å¾ˆå¤šä¸œäºšè¯­è¨€ã€‚</p><p>å½“å›ºå®šé•¿åº¦ç¼–ç ç©ºé—´ä¸è¶³ä»¥å®¹çº³æ›´å¤šå­—ç¬¦æ—¶ï¼Œä½ è¦åšä¸€ä¸ªé€‰æ‹©ï¼šè¦ä¹ˆæé«˜å­˜å‚¨ç©ºé—´ï¼Œè¦ä¹ˆé‡‡ç”¨å˜é•¿ç¼–ç ã€‚èµ·å…ˆï¼Œ<a href="https://en.wikipedia.org/wiki/Unicode" target="_blank" rel="noopener">Unicode</a> è¢«å®šä¹‰ä¸º 2 å­—èŠ‚å›ºå®šå®½åº¦çš„æ ¼å¼ï¼Œç°åœ¨æˆ‘ä»¬ç§°ä¹‹ä¸º <a href="https://en.wikipedia.org/wiki/Universal_Coded_Character_Set" target="_blank" rel="noopener">UCS-2</a>ã€‚å½¼æ—¶æ¢¦æƒ³å°šæœªç…§è¿›ç°å®ï¼Œåæ¥äººä»¬å‘ç°ï¼Œè¦å®ç°å¤§éƒ¨åˆ†çš„åŠŸèƒ½ï¼Œä¸ä»… 2 å­—èŠ‚ä¸å¤Ÿï¼Œç”šè‡³4ä¸ªå­—èŠ‚éƒ½è¿œè¿œä¸å¤Ÿã€‚</p><p>æ‰€ä»¥åˆ°äº†ä»Šå¤©ï¼ŒUnicode ç¼–ç çš„å®½åº¦æ˜¯å¯å˜çš„ï¼Œè¿™ç§å¯å˜æœ‰ä¸¤ä¸ªä¸åŒçš„å«ä¹‰ï¼šä¸€æ˜¯è¯´ Unicode æ ‡é‡å¯èƒ½ç”±è‹¥å¹²ä¸ªä»£ç å—ç»„æˆï¼›ä¸€æ˜¯è¯´å­—ç¬¦å¯èƒ½ç”±è‹¥å¹²ä¸ªæ ‡é‡ç»„æˆã€‚</p><p>Unicode ç¼–ç çš„æ•°æ®å¯ä»¥ç”¨å¤šç§ä¸åŒå®½åº¦çš„ <a href="https://www.unicode.org/glossary/#code_unit" target="_blank" rel="noopener">ä»£ç å•å…ƒï¼ˆ<em>code unit</em>ï¼‰</a> æ¥è¡¨ç¤ºï¼Œæœ€å¸¸è§çš„æ˜¯ 8 æ¯”ç‰¹ï¼ˆ<a href="https://en.wikipedia.org/wiki/UTF-8" target="_blank" rel="noopener">UTF-8</a>ï¼‰å’Œ 16ï¼ˆ<a href="https://en.wikipedia.org/wiki/UTF-16" target="_blank" rel="noopener">UTF-16</a>ï¼‰æ¯”ç‰¹ã€‚UTF-8 ç¼–ç çš„ä¸€å¤§ä¼˜åŠ¿æ˜¯å®ƒå‘åå…¼å®¹ 8 æ¯”ç‰¹çš„ ACSCII ç¼–ç ï¼Œè¿™ä¹Ÿæ˜¯å®ƒå–ä»£ ASCII æˆä¸ºäº’è”ç½‘ä¸Šæœ€å—æ¬¢è¿çš„ç¼–ç çš„ä¸€å¤§åŸå› ã€‚åœ¨ Swift é‡Œé¢ç”¨ <code>UInt16</code> å’Œ <code>UInt8</code> çš„æ•°å€¼ä»£è¡¨UTC-16å’ŒUTF-8çš„ä»£ç å•å…ƒï¼ˆåˆ«ååˆ†åˆ«æ˜¯ <a href="https://developer.apple.com/documentation/swift/unicode.utf8/codeunit" target="_blank" rel="noopener"><code>Unicode.UTF16.CodeUnit</code></a> å’Œ <a href="https://developer.apple.com/documentation/swift/unicode.utf16/codeunit" target="_blank" rel="noopener"><code>Unicode.UTF8.CodeUnit</code></a>ï¼‰ã€‚</p><p>ä¸€ä¸ª <a href="https://www.unicode.org/glossary/#code_point" target="_blank" rel="noopener"><em>ä»£ç ç‚¹ï¼ˆcode pointï¼‰</em></a> æŒ‡çš„æ˜¯ Unicode ç¼–ç ç©ºé—´ä¸­ä¸€ä¸ªå•ä¸€çš„å€¼ï¼Œå¯èƒ½çš„èŒƒå›´æ˜¯ <code>0</code> åˆ° <code>0x10FFFF</code> (æ¢ç®—æˆåè¿›åˆ¶å°±æ˜¯ 1114111)ã€‚ç°åœ¨å·²ä½¿ç”¨çš„ä»£ç ç‚¹å¤§çº¦åªæœ‰ 137000 ä¸ªï¼Œæ‰€ä»¥è¿˜æœ‰å¾ˆå¤šç©ºé—´å¯ä»¥å­˜å‚¨å„ç§ emojiã€‚å¦‚æœä½ ä½¿ç”¨çš„æ˜¯ <a href="https://en.wikipedia.org/wiki/UTF-32" target="_blank" rel="noopener">UTF-32</a> ç¼–ç ï¼Œé‚£ä¹ˆä¸€ä¸ªä»£ç ç‚¹å°±æ˜¯ä¸€ä¸ªä»£ç å—ï¼›å¦‚æœä½¿ç”¨çš„æ˜¯ UTF-8 ç¼–ç ï¼Œä¸€ä¸ªä»£ç ç‚¹å¯èƒ½æœ‰ 1 åˆ° 4 ä¸ªä»£ç å—ç»„æˆã€‚æœ€åˆçš„ 256 ä¸ª Unicode ç¼–ç çš„ä»£ç ç‚¹å¯¹åº”ç€ Latin-1 ä¸­çš„å­—æ¯ã€‚</p><p><a href="https://www.unicode.org/glossary/#unicode_scalar_value" target="_blank" rel="noopener">Unicode æ ‡é‡</a> è·Ÿä»£ç ç‚¹åŸºæœ¬ä¸€æ ·ï¼Œä½†æ˜¯ä¹Ÿæœ‰ä¸€ç‚¹ä¸ä¸€æ ·ã€‚é™¤å¼€ <code>0xD800-0xDFFF</code> ä¸­é—´çš„ 2048 ä¸ªä»£ç†ä»£ç ç‚¹ï¼ˆ<a href="https://en.wikipedia.org/wiki/UTF-16#U.2BD800_to_U.2BDFFF" target="_blank" rel="noopener"><em>surrogate code points</em></a>ï¼‰ä¹‹å¤–ï¼Œä»–ä»¬éƒ½æ˜¯ä¸€æ ·çš„ã€‚è¿™ 2048 ä¸ªä»£ç†ä»£ç ç‚¹æ˜¯ UTF-16 ä¸­ç”¨ä½œè¡¨ç¤ºé…å¯¹çš„å‰ç¼€æˆ–å°¾ç¼€ç¼–ç ã€‚æ ‡é‡åœ¨ Swift ä¸­ç”¨ <code>\u{xxxx}</code> è¡¨ç¤ºï¼Œxxxx ä»£è¡¨åè¿›åˆ¶çš„æ•°å­—ã€‚æ‰€ä»¥æ¬§å…ƒç¬¦å·åœ¨Swifté‡Œå¯ä»¥è¡¨ç¤ºä¸º <code>&quot;â‚¬&quot;</code> æˆ– <code>&quot;\u{20AC}&quot;</code>ã€‚ä¸ä¹‹å¯¹åº”çš„ Swift ç±»å‹æ˜¯ <a href="https://developer.apple.com/documentation/swift/unicode.scalar" target="_blank" rel="noopener"><code>Unicode.Scalar</code></a>ï¼Œä¸€ä¸ª <a href="https://developer.apple.com/documentation/swift/uint32" target="_blank" rel="noopener"><code>UInt32</code></a> æ•°å€¼çš„å°è£…ã€‚</p><p>ä¸ºäº†ç”¨ä¸€ä¸ªä»£ç å•å…ƒä»£è¡¨ä¸€ä¸ª Unicode scalarï¼Œä½ éœ€è¦ä¸€ä¸ª 21 æ¯”ç‰¹çš„ç¼–ç æœºåˆ¶ï¼ˆé€šå¸¸ä¼šè¾¾åˆ° 32 æ¯”ç‰¹ï¼Œæ¯”å¦‚ UTF-32ï¼‰ï¼Œä½†æ˜¯å³ä¾¿è¿™æ ·ä½ ä¹Ÿæ— æ³•å¾—åˆ°ä¸€ä¸ªå›ºå®šå®½åº¦çš„ç¼–ç ï¼šæœ€ç»ˆè¡¨ç¤ºå­—ç¬¦çš„æ—¶å€™ï¼ŒUnicode ä»ç„¶æ˜¯ä¸€ä¸ªå®½åº¦å¯å˜çš„ç¼–ç æ ¼å¼ã€‚å±å¹•ä¸Šæ˜¾ç¤ºçš„ä¸€ä¸ªå­—ç¬¦ï¼Œä¹Ÿå°±æ˜¯ç”¨æˆ·é€šå¸¸è®¤ä¸ºçš„ä¸€ä¸ªå­—ç¬¦ï¼Œå¯èƒ½éœ€è¦å¤šä¸ª scalar ç»„åˆè€Œæˆã€‚Unicode ç¼–ç é‡ŒæŠŠè¿™ç§ç”¨æˆ·ç†è§£çš„å­—ç¬¦ç§°ä¹‹ä¸º <a href="https://www.unicode.org/glossary/#extended_grapheme_cluster" target="_blank" rel="noopener">ï¼ˆæ‰©å±•ï¼‰å­—ä½é›†</a> (extended grapheme cluster)ã€‚</p><p>æ ‡é‡ç»„æˆå­—ä½é›†çš„è§„åˆ™å†³å®šäº†å¦‚ä½•åˆ†è¯ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ æŒ‰äº†ä¸€ä¸‹é”®ç›˜ä¸Šçš„é€€æ ¼é”®ï¼Œä½ è§‰å¾—ä½ çš„æ–‡æœ¬ç¼–è¾‘å™¨å°±åº”è¯¥åˆ é™¤æ‰ä¸€ä¸ªå­—ä½é›†ï¼Œå³ä½¿é‚£ä¸ªâ€œå­—ç¬¦â€æ˜¯ç”±å¤šä¸ª Unicode scalars ç»„æˆï¼Œä¸”æ¯ä¸ª scalar åœ¨è®¡ç®—æœºå†…å­˜ä¸Šè¿˜ç”±æ•°é‡ä¸ç­‰çš„ä»£ç å—ç»„æˆçš„ã€‚Swiftä¸­ç”¨ <code>Character</code> ç±»å‹ä»£è¡¨å­—ä½é›†ã€‚<code>Character</code> ç±»å‹å¯ä»¥ç”±ä»»æ„æ•°é‡çš„ Scalars ç»„æˆï¼Œåªè¦å®ƒä»¬å½¢æˆä¸€ä¸ªç”¨æˆ·çœ‹åˆ°çš„å­—ç¬¦ã€‚åœ¨ä¸‹ä¸€éƒ¨åˆ†ï¼Œæˆ‘ä»¬ä¼šçœ‹åˆ°å‡ ä¸ªè¿™æ ·çš„ä¾‹å­ã€‚</p><h2 id="å­—ä½é›†å’Œè§„èŒƒå¯¹ç­‰ï¼ˆCanonical-Equivalenceï¼‰"><a href="#å­—ä½é›†å’Œè§„èŒƒå¯¹ç­‰ï¼ˆCanonical-Equivalenceï¼‰" class="headerlink" title="å­—ä½é›†å’Œè§„èŒƒå¯¹ç­‰ï¼ˆCanonical Equivalenceï¼‰"></a>å­—ä½é›†å’Œè§„èŒƒå¯¹ç­‰ï¼ˆCanonical Equivalenceï¼‰</h2><h3 id="ç»„åˆç¬¦å·"><a href="#ç»„åˆç¬¦å·" class="headerlink" title="ç»„åˆç¬¦å·"></a>ç»„åˆç¬¦å·</h3><p>è¿™é‡Œæœ‰ä¸€ä¸ªå¿«é€Ÿäº†è§£ <code>String</code> ç±»å‹å¦‚ä½•å¤„ç† Unicode ç¼–ç æ•°æ®çš„æ–¹æ³•ï¼šå†™ â€œÃ©â€ çš„ä¸¤ç§ä¸åŒæ–¹æ³•ã€‚Unicode ç¼–ç ä¸­å®šä¹‰ä¸º <a href="https://codepoints.net/U+00E9" target="_blank" rel="noopener">U+00E9</a>ï¼Œ<em>Latin small letter e with acute</em>ï¼ˆæ‹‰ä¸å­—æ¯å°å†™ e åŠ é‡éŸ³ç¬¦å·ï¼‰ï¼Œå•ä¸€å€¼ã€‚ä½†æ˜¯ä½ ä¹Ÿå¯ä»¥å†™ä¸€ä¸ªæ­£å¸¸çš„ <a href="https://codepoints.net/U+0065" target="_blank" rel="noopener">å°å†™ e</a>ï¼Œå†è·Ÿä¸Šä¸€ä¸ª <a href="https://codepoints.net/U+0301" target="_blank" rel="noopener">U+0301</a>ï¼Œ<em>combining acute accent</em>ï¼ˆé‡éŸ³ç¬¦å·ï¼‰ã€‚åœ¨è¿™ä¸¤ç§æƒ…å†µä¸­ï¼Œæ˜¾ç¤ºçš„éƒ½æ˜¯ Ã©ï¼Œç”¨æˆ·å½“ç„¶ä¼šè®¤ä¸ºè¿™ä¸¤ä¸ª â€œrÃ©sumÃ©â€ æ— è®ºä½¿ç”¨ä»€ä¹ˆæ–¹å¼æ‰“å‡ºæ¥çš„ï¼Œè‚¯å®šæ˜¯ç›¸ç­‰çš„ï¼Œé•¿åº¦ä¹Ÿéƒ½æ˜¯ 6 ä¸ªå­—ç¬¦ã€‚è¿™å°±æ˜¯ Unicode ç¼–ç è§„èŒƒä¸­æ‰€è¯´çš„ <a href="https://www.unicode.org/glossary/#canonical_equivalent" target="_blank" rel="noopener">è§„èŒƒå¯¹ç­‰ï¼ˆCanonically Equivalentï¼‰</a>ã€‚</p><p>è€Œä¸”ï¼Œåœ¨ Swift è¯­è¨€é‡Œï¼Œä»£ç è¡Œä¸ºå’Œç”¨æˆ·é¢„æœŸæ˜¯ä¸€è‡´çš„ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> single = <span class="string">"Pok\u&#123;00E9&#125;mon"</span></span><br><span class="line"><span class="keyword">let</span> double = <span class="string">"Poke\u&#123;0301&#125;mon"</span></span><br></pre></td></tr></table></figure><p>å®ƒä»¬æ˜¾ç¤ºä¹Ÿæ˜¯å®Œå…¨ä¸€è‡´çš„ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">(single, double) <span class="comment">// â†’ ("PokÃ©mon", "PokÃ©mon")</span></span><br></pre></td></tr></table></figure><p>å®ƒä»¬çš„å­—ç¬¦æ•°ä¹Ÿæ˜¯ä¸€æ ·çš„ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">single.<span class="built_in">count</span> <span class="comment">// â†’ 7</span></span><br><span class="line">double.<span class="built_in">count</span> <span class="comment">// â†’ 7</span></span><br></pre></td></tr></table></figure><p>å› æ­¤ï¼Œæ¯”è¾ƒèµ·æ¥ï¼Œå®ƒä»¬ä¹Ÿæ˜¯ç›¸ç­‰çš„ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">single == double <span class="comment">// â†’ true</span></span><br></pre></td></tr></table></figure><p>åªæœ‰å½“ä½ é€šè¿‡åº•å±‚çš„æ˜¾ç¤ºæ–¹å¼æŸ¥çœ‹çš„æ—¶å€™ï¼Œæ‰èƒ½çœ‹åˆ°å®ƒä»¬çš„ä¸åŒä¹‹å¤„ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">single.utf16.<span class="built_in">count</span> <span class="comment">// â†’ 7</span></span><br><span class="line">double.utf16.<span class="built_in">count</span> <span class="comment">// â†’ 8</span></span><br></pre></td></tr></table></figure><p>è¿™ä¸€ç‚¹å’Œ Foundation ä¸­çš„ <a href="https://developer.apple.com/documentation/foundation/nsstring" target="_blank" rel="noopener"><code>NSString</code></a> å¯¹æ¯”ä¸€ä¸‹ï¼šåœ¨ <code>NSString</code> ä¸­ï¼Œä¸¤ä¸ªå­—ç¬¦ä¸²æ˜¯ä¸ç›¸ç­‰çš„ï¼Œå®ƒä»¬çš„ <code>length</code> ï¼ˆå¾ˆå¤šç¨‹åºå‘˜éƒ½ç”¨è¿™ä¸ªæ–¹æ³•æ¥ç¡®å®šå­—ç¬¦ä¸²æ˜¾ç¤ºåœ¨å±å¹•ä¸Šçš„é•¿åº¦ï¼‰ä¹Ÿæ˜¯ä¸åŒçš„ã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Foundation</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> nssingle = single <span class="keyword">as</span> <span class="type">NSString</span></span><br><span class="line">nssingle.length <span class="comment">// â†’ 7</span></span><br><span class="line"><span class="keyword">let</span> nsdouble = double <span class="keyword">as</span> <span class="type">NSString</span></span><br><span class="line">nsdouble.length <span class="comment">// â†’ 8</span></span><br><span class="line">nssingle == nsdouble <span class="comment">// â†’ false</span></span><br></pre></td></tr></table></figure><p>è¿™é‡Œï¼Œ<code>==</code> æ˜¯å®šä¹‰ä¸ºæ¯”è¾ƒä¸¤ä¸ª <code>NSObject</code> ï¼š</p><figure class="highlight objc"><table><tr><td class="code"><pre><span class="line">extension <span class="built_in">NSObject</span>: Equatable &#123;</span><br><span class="line">    <span class="keyword">static</span> func ==(lhs: <span class="built_in">NSObject</span>, rhs: <span class="built_in">NSObject</span>) -&gt; Bool &#123;</span><br><span class="line">        <span class="keyword">return</span> lhs.isEqual(rhs)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ <code>NSString</code> ä¸­ï¼Œè¿™ä¸ªæ“ä½œä¼šæ¯”è¾ƒä¸¤ä¸ª UTF-16 ä»£ç å—ã€‚å¾ˆå¤šå…¶ä»–è¯­è¨€é‡Œé¢çš„å­—ç¬¦ä¸² API ä¹Ÿæ˜¯è¿™æ ·çš„ã€‚å¦‚æœä½ æƒ³åšçš„æ˜¯ä¸€ä¸ªè§„èŒƒæ¯”è¾ƒï¼ˆcannonical comparisonï¼‰ï¼Œä½ å¿…é¡»ç”¨ <code>NSString.compare(_:)</code> ã€‚æ²¡å¬è¯´è¿‡è¿™ä¸ªæ–¹æ³•ï¼Ÿå°†æ¥é‡åˆ°ä¸€äº›æ‰¾ä¸å‡ºæ¥çš„ bug ï¼Œä»¥åŠä¸€äº›æ€’æ°”å†²å†²çš„å›½å¤–ç”¨æˆ·çš„æ—¶å€™ï¼Œå¤Ÿä½ å—çš„ã€‚</p><p>å½“ç„¶ï¼Œåªæ¯”è¾ƒä»£ç å•å…ƒæœ‰ä¸€ä¸ªå¾ˆå¤§çš„ä¼˜ç‚¹æ˜¯ï¼šé€Ÿåº¦å¿«ï¼åœ¨ Swift é‡Œï¼Œä½ ä¹Ÿå¯ä»¥é€šè¿‡ <code>utf16</code> è§†å›¾æ¥å®ç°è¿™ä¸€ç‚¹ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">single.utf16.elementsEqual(double.utf16) <span class="comment">// â†’ false</span></span><br></pre></td></tr></table></figure><p>ä¸ºä»€ä¹ˆ Unicode ç¼–ç è¦æ”¯æŒåŒä¸€å­—ç¬¦çš„å¤šç§å±•ç°æ–¹å¼å‘¢ï¼Ÿå› ä¸º Latin-1 ä¸­å·²ç»æœ‰äº†ç±»ä¼¼ Ã© å’Œ Ã± è¿™æ ·çš„å­—æ¯ï¼Œåªæœ‰çµæ´»çš„ç»„åˆæ–¹å¼æ‰èƒ½è®©é•¿åº¦å¯å˜çš„ Unicode ä»£ç ç‚¹å…¼å®¹ Latin-1ã€‚</p><p>è™½ç„¶ä½¿ç”¨èµ·æ¥ä¼šæœ‰ä¸€äº›éº»çƒ¦ï¼Œä½†æ˜¯å®ƒä½¿å¾—ä¸¤ç§ç¼–ç ä¹‹é—´çš„è½¬æ¢å˜å¾—ç®€å•å¿«é€Ÿã€‚</p><p>è€Œä¸”æŠ›å¼ƒå˜éŸ³å½¢å¼ä¹Ÿæ²¡æœ‰ä»€ä¹ˆç”¨ï¼Œå› ä¸ºè¿™ç§ç»„åˆä¸ä»…ä»…åªæ˜¯ä¸¤ä¸ªä¸¤ä¸ªçš„ï¼Œæœ‰æ—¶å€™ç”šè‡³æ˜¯å¤šç§å˜éŸ³ç¬¦å·ç»„åˆã€‚ä¾‹å¦‚ï¼Œçº¦é²å·´è¯­ä¸­æœ‰ä¸€ä¸ªå­—ç¬¦æ˜¯ á»Ì ï¼Œå¯ä»¥ç”¨ä¸‰ç§ä¸åŒæ–¹å¼å†™å‡ºæ¥ï¼šä¸€ä¸ª Ã³ åŠ ä¸€ç‚¹ï¼Œä¸€ä¸ª á» åŠ ä¸€ä¸ªé‡éŸ³ï¼Œæˆ–è€…ä¸€ä¸ª o  åŠ ä¸€ä¸ªé‡éŸ³å’Œä¸€ç‚¹ã€‚è€Œä¸”ï¼Œå¯¹æœ€åä¸€ç§æ–¹å¼æ¥è¯´ï¼Œä¸¤ä¸ªå˜éŸ³ç¬¦å·çš„é¡ºåºæ— å…³ç´§è¦ï¼æ‰€ä»¥ï¼Œä¸‹é¢å‡ ç§å½¢å¼çš„å†™æ³•éƒ½æ˜¯ç›¸ç­‰çš„ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> chars: [<span class="type">Character</span>] = [</span><br><span class="line">    <span class="string">"\u&#123;1ECD&#125;\u&#123;300&#125;"</span>,      <span class="comment">// á»Ì</span></span><br><span class="line">    <span class="string">"\u&#123;F2&#125;\u&#123;323&#125;"</span>,        <span class="comment">// á»Ì</span></span><br><span class="line">    <span class="string">"\u&#123;6F&#125;\u&#123;323&#125;\u&#123;300&#125;"</span>, <span class="comment">// á»Ì</span></span><br><span class="line">    <span class="string">"\u&#123;6F&#125;\u&#123;300&#125;\u&#123;323&#125;"</span>  <span class="comment">// á»Ì</span></span><br><span class="line">]</span><br><span class="line"><span class="keyword">let</span> allEqual = chars.<span class="built_in">dropFirst</span>()</span><br><span class="line">    .all(matching: &#123; $<span class="number">0</span> == chars.first &#125;) <span class="comment">// â†’ true</span></span><br></pre></td></tr></table></figure><p><code>all(matching:)</code> æ–¹æ³•ç”¨æ¥æ£€æµ‹æ¡ä»¶æ˜¯å¦å¯¹åºåˆ—ä¸­çš„æ‰€æœ‰å…ƒç´ éƒ½ä¸ºçœŸï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Sequence</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">all</span><span class="params">(matching predicate: <span class="params">(Element)</span></span></span> <span class="keyword">throws</span> -&gt; <span class="type">Bool</span>) <span class="keyword">rethrows</span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> element <span class="keyword">in</span> <span class="keyword">self</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">try</span> !predicate(element) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…¶å®ï¼Œä¸€äº›å˜éŸ³ç¬¦å·å¯ä»¥åŠ æ— ç©·ä¸ªã€‚è¿™ä¸€ç‚¹ï¼Œ<a href="http://knowyourmeme.com/memes/zalgo" target="_blank" rel="noopener">ç½‘ä¸Šæµä¼ å¾ˆå¹¿</a> çš„ä¸€ä¸ªé¢œæ–‡å­—è¡¨ç°å¾—å¾ˆå¥½ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> zalgo = <span class="string">"sÌ¼ÌÍ—ÍœoÌ Ì¦Ì¤Í¯Í¥Ì’Í«ÌÍ…oÌºÌªÍ–Ì—Ì½Í©ÌƒÍŸÍ…nÌ¢Í”Í–Í‡Í‡Í‰Ì«Ì°ÍªÍ‘"</span></span><br><span class="line"></span><br><span class="line">zalgo.<span class="built_in">count</span> <span class="comment">// â†’ 4</span></span><br><span class="line">zalgo.utf16.<span class="built_in">count</span> <span class="comment">// â†’ 36</span></span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œ<code>zalgo.count</code> è¿”å›å€¼æ˜¯ 4ï¼ˆæ­£ç¡®çš„ï¼‰ï¼Œè€Œ <code>zalgo.utf16.count</code> è¿”å›å€¼æ˜¯ 36ã€‚å¦‚æœä½ çš„ä»£ç è¿ç½‘ä¸Šçš„é¢œæ–‡å­—éƒ½æ— æ³•æ­£ç¡®å¤„ç†ï¼Œé‚£å®ƒæœ‰ä»€ä¹ˆå¥½çš„ï¼Ÿ</p><p>Unicode ç¼–ç çš„å­—ä½åˆ†å‰²è§„åˆ™ç”šè‡³åœ¨ä½ å¤„ç†çº¯ ASCII ç¼–ç çš„å­—ç¬¦çš„æ—¶å€™ä¹Ÿæœ‰å½±å“ï¼Œå›è½¦ <a href="https://codepoints.net/U+000D" target="_blank" rel="noopener">CR</a> å’Œ æ¢è¡Œ <a href="https://codepoints.net/U+000A" target="_blank" rel="noopener">LF</a> è¿™ä¸€ä¸ªå­—ç¬¦å¯¹åœ¨ Windows ç³»ç»Ÿä¸Šé€šå¸¸è¡¨ç¤ºæ–°å¼€ä¸€è¡Œï¼Œä½†å®ƒä»¬å…¶å®åªæ˜¯ä¸€ä¸ªå­—ä½ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// CR+LF is a single Character</span></span><br><span class="line"><span class="keyword">let</span> crlf = <span class="string">"\r\n"</span></span><br><span class="line">crlf.<span class="built_in">count</span> <span class="comment">// â†’ 1</span></span><br></pre></td></tr></table></figure><h3 id="Emoji"><a href="#Emoji" class="headerlink" title="Emoji"></a>Emoji</h3><p>è®¸å¤šå…¶ä»–ç¼–ç¨‹è¯­è¨€å¤„ç†åŒ…å« emoji çš„å­—ç¬¦ä¸²çš„æ—¶å€™ä¼šè®©äººæ„å¤–ã€‚è®¸å¤š emoji çš„ Unicode æ ‡é‡æ— æ³•å­˜å‚¨åœ¨ä¸€ä¸ª UTF-16 çš„ä»£ç å•å…ƒé‡Œé¢ã€‚æœ‰äº›è¯­è¨€ï¼ˆä¾‹å¦‚ Java æˆ–è€… C#ï¼‰æŠŠå­—ç¬¦ä¸²å½“åš UTF-16 ä»£ç å—çš„é›†åˆï¼Œè¿™äº›è¯­è¨€å®šä¹‰<a href="https://emojipedia.org/face-with-tears-of-joy/" target="_blank" rel="noopener">â€œğŸ˜‚â€</a>ä¸ºä¸¤ä¸ª â€œå­—ç¬¦â€ çš„é•¿åº¦ã€‚Swift å¤„ç†ä¸Šè¿°æƒ…å†µæ›´ä¸ºåˆç†ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> oneEmoji = <span class="string">"ğŸ˜‚"</span> <span class="comment">// U+1F602</span></span><br><span class="line">oneEmoji.<span class="built_in">count</span> <span class="comment">// â†’ 1</span></span><br></pre></td></tr></table></figure><blockquote><p>æ³¨æ„ï¼Œé‡è¦çš„æ˜¯å­—ç¬¦ä¸²å¦‚ä½•å±•ç°ç»™ç¨‹åºçš„ï¼Œ<strong>ä¸æ˜¯</strong>å­—ç¬¦ä¸²åœ¨å†…å­˜ä¸­æ˜¯å¦‚ä½•å­˜å‚¨çš„ã€‚å¯¹äºé ASCII çš„å­—ç¬¦ä¸²ï¼ŒSwift å†…éƒ¨ç”¨çš„æ˜¯ UTF-16 çš„ç¼–ç ï¼Œè¿™åªæ˜¯å†…éƒ¨çš„å®ç°ç»†èŠ‚ã€‚å…¬å…± API è¿˜æ˜¯åŸºäºå­—ä½é›†ï¼ˆgrapheme clusterï¼‰çš„ã€‚</p></blockquote><p>æœ‰äº› emoji ç”±å¤šä¸ªæ ‡é‡ç»„æˆã€‚emoji ä¸­çš„å›½æ——æ˜¯ç”±ä¸¤ä¸ªå¯¹åº” ISO å›½å®¶ä»£ç çš„<a href="https://en.wikipedia.org/wiki/Regional_Indicator_Symbol" target="_blank" rel="noopener">åœ°åŒºæ ‡è¯†ç¬¦å·ï¼ˆreginal indicator symbolsï¼‰</a>ç»„æˆçš„ã€‚Swift é‡Œå°†ä¸€ä¸ªå›½æ——è§†ä¸ºä¸€ä¸ª <code>Character</code> ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> flags = <span class="string">"ğŸ‡§ğŸ‡·ğŸ‡³ğŸ‡¿"</span></span><br><span class="line">flags.<span class="built_in">count</span> <span class="comment">// â†’ 2</span></span><br></pre></td></tr></table></figure><p>è¦æ£€æŸ¥ä¸€ä¸ªå­—ç¬¦ä¸²ç”±å‡ ä¸ª Unicode æ ‡é‡ç»„æˆï¼Œéœ€è¦ä½¿ç”¨ <a href="https://developer.apple.com/documentation/swift/string/1539070-unicodescalars" target="_blank" rel="noopener"><code>unicodeScalars</code></a> è§†å›¾ã€‚è¿™é‡Œï¼Œæˆ‘ä»¬å°† scalar çš„å€¼æ ¼å¼åŒ–ä¸ºåè¿›åˆ¶çš„æ•°å­—ï¼Œè¿™æ˜¯ä»£ç ç‚¹çš„æ™®éæ ¼å¼ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">flags.unicodeScalars.<span class="built_in">map</span> &#123;</span><br><span class="line">    <span class="string">"U+<span class="subst">\(String($<span class="number">0</span>.value, radix: <span class="number">16</span>, uppercase: <span class="literal">true</span>)</span>)"</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// â†’ ["U+1F1E7", "U+1F1F7", "U+1F1F3", "U+1F1FF"]</span></span><br></pre></td></tr></table></figure><p>è‚¤è‰²æ˜¯ç”±ä¸€ä¸ªåŸºç¡€çš„è§’è‰²ç¬¦å·ï¼ˆä¾‹å¦‚ğŸ‘§ï¼‰åŠ ä¸Šä¸€ä¸ªè‚¤è‰²ä¿®é¥°ç¬¦ï¼ˆä¾‹å¦‚ğŸ½ï¼‰ç»„æˆçš„ï¼ŒSwift é‡Œæ˜¯è¿™ä¹ˆå¤„ç†çš„ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> skinTone = <span class="string">"ğŸ‘§ğŸ½"</span> <span class="comment">// ğŸ‘§ + ğŸ½</span></span><br><span class="line">skinTone.<span class="built_in">count</span> <span class="comment">// â†’ 1</span></span><br></pre></td></tr></table></figure><p>è¿™æ¬¡æˆ‘ä»¬ç”¨ Foundation API é‡Œé¢çš„ <a href="https://oleb.net/blog/2016/01/icu-text-transforms/" target="_blank" rel="noopener">ICU string transform</a> æŠŠ Unicode æ ‡é‡è½¬æ¢æˆå®˜æ–¹çš„ Unicode åç§°ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">StringTransform</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">let</span> toUnicodeName = <span class="type">StringTransform</span>(rawValue: <span class="string">"Any-Name"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Unicode</span>.<span class="title">Scalar</span> </span>&#123;</span><br><span class="line">    <span class="comment">/// The scalarâ€™s Unicode name, e.g. "LATIN CAPITAL LETTER A".</span></span><br><span class="line">    <span class="keyword">var</span> unicodeName: <span class="type">String</span> &#123;</span><br><span class="line">        <span class="comment">// Force-unwrapping is safe because this transform always succeeds</span></span><br><span class="line">        <span class="keyword">let</span> name = <span class="type">String</span>(<span class="keyword">self</span>).applyingTransform(.toUnicodeName,</span><br><span class="line">            <span class="built_in">reverse</span>: <span class="literal">false</span>)!</span><br><span class="line"></span><br><span class="line">        <span class="comment">// The string transform returns the name wrapped in "\\N&#123;...&#125;". Remove those.</span></span><br><span class="line">        <span class="keyword">let</span> prefixPattern = <span class="string">"\\N&#123;"</span></span><br><span class="line">        <span class="keyword">let</span> suffixPattern = <span class="string">"&#125;"</span></span><br><span class="line">        <span class="keyword">let</span> prefixLength = name.hasPrefix(prefixPattern) ? prefixPattern.<span class="built_in">count</span> : <span class="number">0</span></span><br><span class="line">        <span class="keyword">let</span> suffixLength = name.hasSuffix(suffixPattern) ? suffixPattern.<span class="built_in">count</span> : <span class="number">0</span></span><br><span class="line">        <span class="keyword">return</span> <span class="type">String</span>(name.<span class="built_in">dropFirst</span>(prefixLength).<span class="built_in">dropLast</span>(suffixLength))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">skinTone.unicodeScalars.<span class="built_in">map</span> &#123; $<span class="number">0</span>.unicodeName &#125;</span><br><span class="line"><span class="comment">// â†’ ["GIRL", "EMOJI MODIFIER FITZPATRICK TYPE-4"]</span></span><br></pre></td></tr></table></figure><p>è¿™æ®µä»£ç é‡Œé¢æœ€é‡è¦çš„æ˜¯å¯¹ <code>applyingTransform(.toUnicodeName,...)</code> çš„è°ƒç”¨ã€‚å…¶ä»–çš„ä»£ç åªæ˜¯æŠŠè½¬æ¢æ–¹æ³•è¿”å›çš„åå­—æ¸…ç†äº†ä¸€ä¸‹ï¼Œç§»é™¤äº†æ‹¬å·ã€‚è¿™æ®µä»£ç å¾ˆä¿å®ˆï¼šå…ˆæ˜¯æ£€æŸ¥äº†å­—ç¬¦ä¸²æ˜¯å¦ç¬¦åˆæœŸæœ›çš„æ ¼å¼ï¼Œç„¶åè®¡ç®—äº†ä»å¤´åˆ°å°¾çš„å­—ç¬¦æ•°ã€‚å¦‚æœå°†æ¥è½¬æ¢æ–¹æ³•è¿”å›çš„åå­—æ ¼å¼å‘ç”Ÿäº†å˜åŒ–ï¼Œæœ€å¥½è¾“å‡ºåŸå­—ç¬¦ä¸²ï¼Œè€Œä¸æ˜¯ç§»é™¤å¤šä½™å­—ç¬¦åçš„å­—ç¬¦ä¸²ã€‚</p><p>æ³¨æ„æˆ‘ä»¬æ˜¯å¦‚ä½•ä½¿ç”¨æ ‡å‡†çš„é›†åˆï¼ˆ<code>Collection</code>ï¼‰æ–¹æ³• <code>dropFirst</code> å’Œ <code>droplast</code> è¿›è¡Œç§»é™¤æ“ä½œçš„ã€‚å¦‚æœä½ æƒ³å¯¹å­—ç¬¦ä¸²è¿›è¡Œæ“ä½œï¼Œä½†æ˜¯åˆä¸æƒ³å¯¹å­—ç¬¦ä¸²è¿›è¡Œæ‰‹åŠ¨ç´¢å¼•ï¼Œè¿™å°±æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­ã€‚è¿™ä¸ªæ–¹æ³•åŒæ ·ä¹Ÿå¾ˆé«˜æ•ˆï¼Œå› ä¸º <code>dropFisrt</code> å’Œ <code>dropLast</code> æ–¹æ³•è¿”å›çš„æ˜¯ <code>Substring</code> å€¼ï¼Œå®ƒä»¬åªæ˜¯åŸå­—ç¬¦ä¸²çš„ä¸€éƒ¨åˆ†ã€‚åœ¨æˆ‘ä»¬æœ€åä¸€æ­¥åˆ›å»ºä¸€ä¸ªæ–°çš„ <code>String</code> å­—ç¬¦ä¸²ï¼Œèµ‹å€¼ä¸ºè¿™ä¸ª substring ä¹‹å‰ï¼Œå®ƒæ˜¯ä¸å ç”¨æ–°çš„å†…å­˜çš„ã€‚å…³äºè¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬åœ¨è¿™ä¸€ç« çš„åé¢è¿˜æœ‰å¾ˆå¤šä¸œè¥¿ä¼šæ¶‰åŠåˆ°ã€‚</p><p>Emoji é‡Œé¢å¯¹å®¶åº­å’Œå¤«å¦»çš„è¡¨ç¤ºï¼ˆä¾‹å¦‚ <a href="https://emojipedia.org/family-man-woman-girl-boy/" target="_blank" rel="noopener">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦</a> å’Œ <a href="https://emojipedia.org/couple-with-heart-woman-woman/" target="_blank" rel="noopener">ğŸ‘©â€â¤ï¸â€ğŸ‘©</a>ï¼‰æ˜¯ Unicode ç¼–ç æ ‡å‡†é¢ä¸´çš„åˆä¸€ä¸ªæŒ‘æˆ˜ã€‚ç”±äºæ€§åˆ«ä»¥åŠäººæ•°çš„å¯èƒ½ç»„åˆå¤ªå¤šï¼Œä¸ºæ¯ç§å¯èƒ½çš„ç»„åˆéƒ½åšä¸€ä¸ªä»£ç ç‚¹è‚¯å®šä¼šæœ‰é—®é¢˜ã€‚å†åŠ ä¸Šæ¯ä¸ªäººç‰©è§’è‰²çš„è‚¤è‰²çš„é—®é¢˜ï¼Œè¿™æ ·åšå‡ ä¹ä¸å¯è¡Œã€‚Unicode ç¼–ç æ˜¯è¿™æ ·è§£å†³è¿™ä¸ªé—®é¢˜çš„ï¼Œå®ƒå°†è¿™ç§ emoji å®šä¹‰ä¸ºä¸€ç³»åˆ—ç”±é›¶å®½åº¦è¿æ¥ç¬¦ï¼ˆ<a href="https://codepoints.net/U+200D" target="_blank" rel="noopener"><em>zero-width joiner</em></a>ï¼‰è”ç³»èµ·æ¥çš„ emoji ã€‚è¿™æ ·ä¸‹æ¥ï¼Œè¿™ä¸ªå®¶åº­ ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ emoji å…¶å®å°±æ˜¯ <a href="https://emojipedia.org/man/" target="_blank" rel="noopener"><em>man</em> ğŸ‘¨</a> + ZWJ + <a href="https://emojipedia.org/woman/" target="_blank" rel="noopener"><em>woman</em> ğŸ‘©</a> + ZWJ + <a href="https://emojipedia.org/girl/" target="_blank" rel="noopener"><em>girl</em> ğŸ‘§</a> + ZWJ + <a href="https://emojipedia.org/boy/" target="_blank" rel="noopener"><em>boy</em> ğŸ‘¦</a>ã€‚è€Œé›¶å®½åº¦è¿æ¥ç¬¦çš„ä½œç”¨å°±æ˜¯è®©æ“ä½œç³»ç»ŸçŸ¥é“è¿™ä¸ª emoji åº”è¯¥åªæ˜¯ä¸€ä¸ªå­—ç´ ã€‚</p><p>æˆ‘ä»¬å¯ä»¥éªŒè¯ä¸€ä¸‹åˆ°åº•æ˜¯ä¸æ˜¯è¿™æ ·ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> family1 = <span class="string">"ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦"</span></span><br><span class="line"><span class="keyword">let</span> family2 = <span class="string">"ğŸ‘¨\u&#123;200D&#125;ğŸ‘©\u&#123;200D&#125;ğŸ‘§\u&#123;200D&#125;ğŸ‘¦"</span></span><br><span class="line">family1 == family2 <span class="comment">// â†’ true</span></span><br></pre></td></tr></table></figure><p>åœ¨ Swift é‡Œï¼Œè¿™æ ·ä¸€ä¸ª emoji ä¹ŸåŒæ ·è¢«è®¤ä¸ºæ˜¯ä¸€ä¸ªå­—ç¬¦ <code>Character</code> ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">family1.<span class="built_in">count</span> <span class="comment">// â†’ 1</span></span><br><span class="line">family2.<span class="built_in">count</span> <span class="comment">// â†’ 1</span></span><br></pre></td></tr></table></figure><p>2016å¹´æ–°å¼•å…¥çš„èŒä¸šç±»å‹ emoji ä¹Ÿæ˜¯è¿™ç§æƒ…å†µã€‚ä¾‹å¦‚å¥³æ€§æ¶ˆé˜²é˜Ÿå‘˜ <a href="https://emojipedia.org/female-firefighter/" target="_blank" rel="noopener">ğŸ‘©â€ğŸš’</a> å°±æ˜¯ <a href="https://emojipedia.org/woman/" target="_blank" rel="noopener"><em>woman</em> ğŸ‘©</a> + ZWJ + <a href="https://emojipedia.org/fire-engine/" target="_blank" rel="noopener"><em>fire engine</em> ğŸš’</a>ã€‚ç”·æ€§åŒ»ç”Ÿå°±æ˜¯ <a href="https://emojipedia.org/man/" target="_blank" rel="noopener"><em>man</em> ğŸ‘¨</a> + ZWJ + <a href="https://emojipedia.org/staff-of-aesculapius/" target="_blank" rel="noopener"><em>staff of aesculapius</em> âš•</a>ï¼ˆè¯‘è€…æ³¨ï¼šé˜¿æ–¯å…‹å‹’åº‡å„æ–¯ï¼Œæ˜¯å¤å¸Œè…Šç¥è¯ä¸­çš„åŒ»ç¥ï¼Œä¸€æ¡è›‡ç»•ç€ä¸€ä¸ªæŸ±å­æŒ‡åŒ»ç–—ç›¸å…³èŒä¸šï¼‰ã€‚</p><p>å°†è¿™äº›ä¸€ç³»åˆ—é›¶å®½åº¦è¿æ¥ç¬¦è¿æ¥èµ·æ¥çš„ emoji æ¸²æŸ“ä¸ºä¸€ä¸ªå­—ç´ æ˜¯æ“ä½œç³»ç»Ÿçš„å·¥ä½œã€‚2017å¹´ï¼ŒApple çš„æ“ä½œç³»ç»Ÿè¡¨ç¤ºæ”¯æŒ Unicode ç¼–ç æ ‡å‡†ä¸‹çš„ RGI ç³»åˆ—ï¼ˆâ€œ<a href="https://unicode.org/emoji/charts/emoji-zwj-sequences.html" target="_blank" rel="noopener">recommended for general interchange</a>â€ï¼‰ã€‚å¦‚æœæ²¡æœ‰å­—ä½å¯ä»¥æ­£ç¡®è¡¨ç¤ºè¿™ä¸ªåºåˆ—ï¼Œé‚£æ–‡æœ¬æ¸²æŸ“ç³»ç»Ÿä¼šå›é€€ï¼Œæ˜¾ç¤ºä¸ºæ¯ä¸ªå•ä¸ªçš„å­—ç´ ã€‚</p><p>æ³¨æ„è¿™é‡Œåˆå¯èƒ½ä¼šå¯¼è‡´ä¸€ä¸ªç†è§£åå·®ï¼Œå³ç”¨æˆ·æ‰€è®¤ä¸ºçš„å­—ç¬¦å’Œ Swift æ‰€è®¤ä¸ºçš„å­—ä½é›†ä¹‹é—´çš„åå·®ã€‚æˆ‘ä»¬ä¸Šé¢æ‰€æœ‰çš„ä¾‹å­éƒ½æ˜¯æ‹…å¿ƒç¼–ç¨‹è¯­è¨€ä¼šæŠŠå­—ç¬¦<strong>æ•°å¤šäº†</strong>ï¼Œä½†è¿™é‡Œæ­£å¥½ç›¸åã€‚ä¸¾ä¾‹æ¥è¯´ï¼Œä¸Šé¢é‚£ä¸ªå®¶åº­çš„ emoji é‡Œé¢æ¶‰åŠåˆ°çš„è‚¤è‰² emoji è¿˜æœªè¢«æ”¶å½•åˆ° RGI é›†åˆé‡Œé¢ã€‚ä½†å°½ç®¡å¤§å¤šæ•°æ“ä½œç³»ç»Ÿéƒ½æŠŠè¿™ç³»åˆ— emoji æ¸²æŸ“æˆå¤šä¸ªå­—ç´ ï¼Œä½† Swift ä»æ—§åªæŠŠå®ƒä»¬çœ‹åšä¸€ä¸ªå­—ç¬¦ï¼Œå› ä¸º Unicode ç¼–ç çš„åˆ†è¯è§„åˆ™å’Œæ¸²æŸ“æ— å…³ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Family with skin tones is rendered as multiple glyphs</span></span><br><span class="line"><span class="comment">// on most platforms in 2017</span></span><br><span class="line"><span class="keyword">let</span> family3 = <span class="string">"ğŸ‘±ğŸ¾\u&#123;200D&#125;ğŸ‘©ğŸ½\u&#123;200D&#125;ğŸ‘§ğŸ¿\u&#123;200D&#125;ğŸ‘¦ğŸ»"</span> <span class="comment">// â†’ "ğŸ‘±ğŸ¾â€ğŸ‘©ğŸ½â€ğŸ‘§ğŸ¿â€ğŸ‘¦ğŸ»"</span></span><br><span class="line"><span class="comment">// But Swift still counts it as a single Character</span></span><br><span class="line">family3.<span class="built_in">count</span> <span class="comment">// â†’ 1</span></span><br></pre></td></tr></table></figure><p><a href="https://blog.emojipedia.org/diverse-emoji-families-come-to-windows/" target="_blank" rel="noopener">Windows ç³»ç»Ÿå·²ç»å¯ä»¥</a>æŠŠè¿™äº› emoji æ¸²æŸ“ä¸ºä¸€ä¸ªå­—ç´ äº†ï¼Œå…¶ä»–æ“ä½œç³»ç»Ÿå‚å®¶è‚¯å®šä¹Ÿä¼šå°½å¿«æ”¯æŒã€‚ä½†æ˜¯ï¼Œæœ‰ä¸€ç‚¹æ˜¯ä¸å˜çš„ï¼šæ— è®ºä¸€ä¸ªå­—ç¬¦ä¸²çš„ API å¦‚ä½•ç²¾å¿ƒè®¾è®¡ï¼Œéƒ½æ— æ³•å®Œç¾æ”¯æŒæ¯ä¸€ä¸ªç»†å°çš„æ¡ˆä¾‹ï¼Œå› ä¸ºæ–‡æœ¬å¤ªå¤æ‚äº†ã€‚</p><blockquote><p>è¿‡å» Swift å¾ˆéš¾è·Ÿå¾—ä¸Š Unicode ç¼–ç æ ‡å‡†æ”¹å˜çš„æ­¥ä¼ã€‚Swift 3 æ¸²æŸ“è‚¤è‰²å’Œé›¶å®½åº¦è¿æ¥ç¬¦ç³»åˆ— emoji æ˜¯é”™è¯¯çš„ï¼Œå› ä¸ºå½“æ—¶çš„åˆ†è¯ç®—æ³•æ˜¯æ ¹æ®ä¸Šä¸€ä¸ªç‰ˆæœ¬çš„ Unicode ç¼–ç æ ‡å‡†ã€‚è‡ª Swift 4 èµ·ï¼ŒSwift å¼€å§‹å¯ç”¨æ“ä½œç³»ç»Ÿçš„ <a href="http://site.icu-project.org" target="_blank" rel="noopener">ICU</a> åº“ã€‚å› æ­¤ï¼Œåªè¦ç”¨æˆ·æ›´æ–°ä»–ä»¬çš„æ“ä½œç³»ç»Ÿï¼Œä½ çš„ç¨‹åºå°±ä¼šé‡‡ç”¨æœ€æ–°çš„ Unicode ç¼–ç æ ‡å‡†ã€‚ç¡¬å¸çš„å¦ä¸€é¢æ˜¯ï¼Œä½ å¼€å‘ä¸­çœ‹åˆ°çš„å’Œç”¨æˆ·çœ‹åˆ°çš„ä¸œè¥¿å¯èƒ½æ˜¯ä¸ä¸€æ ·çš„ã€‚</p></blockquote><p>ç¼–ç¨‹è¯­è¨€å¦‚æœå…¨é¢è€ƒè™‘ Unicode ç¼–ç å¤æ‚æ€§çš„è¯ï¼Œåœ¨å¤„ç†æ–‡æœ¬çš„æ—¶å€™ä¼šå¼•å‘å¾ˆå¤šé—®é¢˜ã€‚ä¸Šé¢è¿™ä¹ˆå¤šä¾‹å­æˆ‘ä»¬åªæ˜¯è°ˆåŠå…¶ä¸­çš„ä¸€ä¸ªé—®é¢˜ï¼šå­—ç¬¦ä¸²çš„é•¿åº¦ã€‚å¦‚æœä¸€ä¸ªç¼–ç¨‹è¯­è¨€ä¸æ˜¯æŒ‰å­—ç´ é›†å¤„ç†å­—ç¬¦ä¸²ï¼Œè€Œè¿™ä¸ªå­—ç¬¦ä¸²åˆåŒ…å«å¾ˆå¤šå­—ç¬¦åºåˆ—çš„è¯ï¼Œè¿™æ—¶å€™ä¸€ä¸ªç®€ç®€å•å•çš„ååºè¾“å‡ºå­—ç¬¦ä¸²çš„æ“ä½œä¼šå˜å¾—å¤šä¹ˆå¤æ‚ã€‚</p><p>è¿™ä¸æ˜¯ä¸ªæ–°é—®é¢˜ï¼Œä½†æ˜¯ emoji çš„æµè¡Œä½¿å¾—ç³Ÿç³•çš„æ–‡æœ¬å¤„ç†æ–¹æ³•é€ æˆçš„é—®é¢˜æ›´å®¹æ˜“æµ®å‡ºè¡¨é¢ï¼Œå³ä½¿ä½ çš„ç”¨æˆ·ç¾¤å¤§éƒ¨åˆ†æ˜¯è¯´è‹±è¯­çš„ã€‚è€Œä¸”ï¼Œé”™è¯¯çš„çº§åˆ«ä¹Ÿå¤§å¤§æå‡ï¼šåå¹´å‰ï¼Œå¼„é”™ä¸€ä¸ªå˜éŸ³ç¬¦å·çš„å­—æ¯å¯èƒ½åªä¼šé€ æˆ 1 ä¸ªå­—ç¬¦æ•°çš„è¯¯å·®ï¼Œç°åœ¨å¦‚æœå¼„é”™äº† emoji çš„è¯å¾ˆå¯èƒ½å°±æ˜¯ 10 ä¸ªå­—ç¬¦æ•°çš„è¯¯å·®ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªå››äººå®¶åº­çš„ emoji åœ¨ UTF-16 ç¼–ç ä¸‹æ˜¯ 11 ä¸ªå­—ç¬¦ï¼Œåœ¨ UTF-8 ç¼–ç ä¸‹å°±æ˜¯ 25 ä¸ªå­—ç¬¦äº†ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">family1.<span class="built_in">count</span> <span class="comment">// â†’ 1</span></span><br><span class="line">family1.utf16.<span class="built_in">count</span> <span class="comment">// â†’ 11</span></span><br><span class="line">family1.utf8.<span class="built_in">count</span> <span class="comment">// â†’ 25</span></span><br></pre></td></tr></table></figure><p>ä¹Ÿä¸æ˜¯è¯´å…¶ä»–ç¼–ç¨‹è¯­è¨€å°±å®Œå…¨æ²¡æœ‰ç¬¦åˆ Unicode ç¼–ç æ ‡å‡†çš„ APIï¼Œå¤§éƒ¨åˆ†è¿˜æ˜¯æœ‰çš„ã€‚ä¾‹å¦‚ï¼Œ<code>NSString</code> å°±æœ‰ä¸€ä¸ª <a href="https://developer.apple.com/documentation/foundation/nsstring/1416774-enumeratesubstrings" target="_blank" rel="noopener"><code>enumerateSubstrings</code></a> çš„æ–¹æ³•å¯ä»¥æŒ‰ç…§å­—ä½é›†éå†ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚ä½†æ˜¯ç¼ºçœè®¾ç½®å¾ˆé‡è¦ï¼Œè€Œ Swift çš„åŸåˆ™å°±æ˜¯ç¼ºçœæƒ…å†µä¸‹ï¼Œå°±æŒ‰æ­£ç¡®çš„æ–¹å¼æ¥åšã€‚è€Œä¸”å¦‚æœä½ éœ€è¦ä½ä¸€ä¸ªæŠ½è±¡çº§åˆ«å»çœ‹ï¼Œ<code>String</code> ä¹Ÿæä¾›ä¸åŒçš„è§†å›¾ï¼Œç„¶ä½ å¯ä»¥ç›´æ¥ä» Unicode æ ‡é‡æˆ–è€…ä»£ç å—çš„çº§åˆ«æ“ä½œã€‚ä¸‹é¢çš„å†…å®¹é‡Œæˆ‘ä»¬è¿˜ä¼šæ¶‰åŠåˆ°è¿™ä¸€ç‚¹ã€‚</p><h2 id="å­—ç¬¦ä¸²å’Œé›†åˆ"><a href="#å­—ç¬¦ä¸²å’Œé›†åˆ" class="headerlink" title="å­—ç¬¦ä¸²å’Œé›†åˆ"></a>å­—ç¬¦ä¸²å’Œé›†åˆ</h2><p>æˆ‘ä»¬å·²ç»çœ‹åˆ°ï¼Œ<code>String</code> æ˜¯ä¸€ä¸ª <code>Character</code> å€¼çš„é›†åˆã€‚åœ¨ Swift è¯­è¨€å‘å±•çš„å‰ä¸‰å¹´é‡Œï¼Œ<code>String</code> è¿™ä¸ªç±»åœ¨éµå®ˆè¿˜æ˜¯ä¸éµå®ˆ <code>Collection</code> é›†åˆåè®®è¿™ä¸ªé—®é¢˜ä¸Šå·¦å³æ‘‡æ‘†äº†å‡ æ¬¡ã€‚åšæŒä¸è¦éµå®ˆé›†åˆåè®®çš„äººè®¤ä¸ºï¼Œå¦‚æœéµå®ˆçš„è¯ï¼Œç¨‹åºå‘˜ä¼šè®¤ä¸ºæ‰€æœ‰é€šç”¨çš„é›†åˆå¤„ç†ç®—æ³•ç”¨åœ¨å­—ç¬¦ä¸²ä¸Šæ˜¯ç»å¯¹å®‰å…¨çš„ï¼Œä¹Ÿç»å¯¹ç¬¦åˆ Unicode ç¼–ç æ ‡å‡†çš„ï¼Œä½†æ˜¯æ˜¾ç„¶æœ‰ä¸€äº›ç‰¹ä¾‹å­˜åœ¨ã€‚</p><p>ä¸¾ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œä¸¤ä¸ªé›†åˆç›¸åŠ ï¼Œå¾—åˆ°çš„æ–°çš„é›†åˆçš„é•¿åº¦è‚¯å®šæ˜¯ä¸¤ä¸ªå­é›†åˆé•¿åº¦çš„å’Œã€‚ä½†æ˜¯åœ¨å­—ç¬¦ä¸²ä¸­ï¼Œå¦‚æœç¬¬ä¸€ä¸ªå­—ç¬¦ä¸²çš„åç¼€å’Œç¬¬äºŒä¸ªå­—ç¬¦ä¸²çš„å‰ç¼€å½¢æˆäº†ä¸€ä¸ªå­—ä½é›†ï¼Œé•¿åº¦å°±ä¼šæœ‰å˜åŒ–äº†ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> flagLetterJ = <span class="string">"ğŸ‡¯"</span></span><br><span class="line"><span class="keyword">let</span> flagLetterP = <span class="string">"ğŸ‡µ"</span></span><br><span class="line"><span class="keyword">let</span> flag = flagLetterJ + flagLetterP <span class="comment">// â†’ "ğŸ‡¯ğŸ‡µ"</span></span><br><span class="line">flag.<span class="built_in">count</span> <span class="comment">// â†’ 1</span></span><br><span class="line">flag.<span class="built_in">count</span> == flagLetterJ.<span class="built_in">count</span> + flagLetterP.<span class="built_in">count</span> <span class="comment">// â†’ false</span></span><br></pre></td></tr></table></figure><p>å‡ºäºè¿™ç§è€ƒè™‘ï¼Œåœ¨ Swift 2 å’Œ Swift 3 ä¸­ï¼Œ<code>String</code> å¹¶æ²¡æœ‰è¢«ç®—ä½œä¸€ä¸ªé›†åˆã€‚è¿™ä¸ªç‰¹æ€§æ˜¯ä½œä¸º <code>String</code> çš„ä¸€ä¸ª <a href="https://developer.apple.com/documentation/swift/string/1540072-characters" target="_blank" rel="noopener"><code>characters</code></a> è§†å›¾å­˜åœ¨çš„ï¼Œå’Œå…¶ä»–å‡ ä¸ªé›†åˆè§†å›¾ä¸€æ ·ï¼š<a href="https://developer.apple.com/documentation/swift/string/1539070-unicodescalars" target="_blank" rel="noopener"><code>unicodeScalars</code></a>ï¼Œ<a href="https://developer.apple.com/documentation/swift/string/1539703-utf8" target="_blank" rel="noopener"><code>utf8</code></a> å’Œ <a href="https://developer.apple.com/documentation/swift/string/1541301-utf16" target="_blank" rel="noopener"><code>utf16</code></a>ã€‚é€‰æ‹©ä¸€ä¸ªç‰¹å®šçš„è§†å›¾ï¼Œå°±ç›¸å½“äºè®©ç¨‹åºå‘˜è½¬æ¢åˆ°å¦ä¸€ç§â€œå¤„ç†é›†åˆâ€çš„æ¨¡å¼ï¼Œç›¸åº”çš„ï¼Œç¨‹åºå‘˜å°±å¿…é¡»è€ƒè™‘åˆ°è¿™ç§æ¨¡å¼ä¸‹å¯èƒ½äº§ç”Ÿçš„é—®é¢˜ã€‚</p><p>ä½†æ˜¯ï¼Œåœ¨å®é™…åº”ç”¨ä¸­ï¼Œè¿™ä¸ªæ”¹å˜æå‡äº†å­¦ä¹ æˆæœ¬ï¼Œé™ä½äº†å¯ç”¨æ€§ï¼›å•å•ä¸ºäº†ä¿è¯åœ¨é‚£äº›æç«¯ä¸ªä¾‹ä¸­çš„æ­£ç¡®æ€§ï¼ˆå…¶å®åœ¨çœŸå®åº”ç”¨ä¸­å¾ˆå°‘é‡åˆ°ï¼Œé™¤éä½ å†™çš„æ˜¯ä¸ªæ–‡æœ¬ç¼–è¾‘å™¨çš„åº”ç”¨ï¼‰åšå‡ºè¿™æ ·çš„æ”¹å˜å¤ªä¸å€¼å¾—äº†ã€‚å› æ­¤ï¼Œåœ¨ Swift 4 ä¸­ï¼Œ<code>String</code> å†æ¬¡æˆäº†ä¸€ä¸ªé›†åˆã€‚<code>characters</code> è§†å›¾è¿˜åœ¨ï¼Œä½†æ˜¯åªæ˜¯ä¸ºäº†å‘åå…¼å®¹ Swift 3ã€‚</p><h3 id="åŒå‘è·å–ï¼Œè€Œéä»»æ„è·å–"><a href="#åŒå‘è·å–ï¼Œè€Œéä»»æ„è·å–" class="headerlink" title="åŒå‘è·å–ï¼Œè€Œéä»»æ„è·å–"></a>åŒå‘è·å–ï¼Œè€Œéä»»æ„è·å–</h3><p>ç„¶è€Œï¼Œ<code>String</code> å¹¶<strong>ä¸æ˜¯</strong>ä¸€ä¸ªå¯ä»¥ä»»æ„è·å–çš„é›†åˆï¼ŒåŸå› çš„è¯ï¼Œä¸Šä¸€éƒ¨åˆ†çš„å‡ ä¸ªä¾‹å­å·²ç»å±•ç°çš„å¾ˆæ¸…æ¥šã€‚ä¸€ä¸ªå­—ç¬¦åˆ°åº•æ˜¯ç¬¬å‡ ä¸ªå­—ç¬¦å–å†³äºå®ƒå‰é¢æœ‰å¤šå°‘ä¸ª Unicode scalarï¼Œè¿™æ ·çš„æƒ…å†µä¸‹ï¼Œæ ¹æœ¬ä¸å¯èƒ½å®ç°ä»»æ„è·å–ã€‚ç”±äºè¿™ä¸ªåŸå› ï¼ŒSwift é‡Œé¢çš„å­—ç¬¦ä¸²éµå®ˆåŒå‘è·å–ï¼ˆ<a href="https://developer.apple.com/documentation/swift/bidirectionalcollection" target="_blank" rel="noopener"><code>BidirectionalCollection</code></a>ï¼‰è§„åˆ™ã€‚å¯ä»¥ä»å­—ç¬¦ä¸²çš„ä¸¤å¤´æ•°ï¼Œä»£ç ä¼šæ ¹æ®ç›¸é‚»å­—ç¬¦çš„ç»„æˆï¼Œè·³è¿‡æ­£ç¡®æ•°é‡çš„å­—èŠ‚ã€‚ä½†æ˜¯ï¼Œæ¯æ¬¡è®¿é—®åªèƒ½ä¸Šç§»æˆ–è€…ä¸‹ç§»ä¸€ä¸ªå­—ç¬¦ã€‚</p><p>åœ¨å†™å¤„ç†å­—ç¬¦ä¸²çš„ä»£ç çš„æ—¶å€™ï¼Œè¦è€ƒè™‘åˆ°è¿™ç§æ–¹å¼çš„æ“ä½œå¯¹ä»£ç æ€§èƒ½çš„å½±å“ã€‚é‚£äº›ä¾é ä»»æ„è·å–æ¥ä¿è¯ä»£ç æ€§èƒ½çš„ç®—æ³•å¯¹ Unicode ç¼–ç çš„å­—ç¬¦ä¸²å¹¶ä¸åˆé€‚ã€‚æˆ‘ä»¬çœ‹ä¸€ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬è¦è·å–ä¸€ä¸ªå­—ç¬¦ä¸²æ‰€æœ‰ prefix çš„åˆ—è¡¨ã€‚æˆ‘ä»¬åªéœ€è¦å¾—åˆ°ä¸€ä¸ªä»é›¶åˆ°å­—ç¬¦ä¸²é•¿åº¦çš„ä¸€ç³»åˆ—æ•´æ•°ï¼Œç„¶åæ ¹æ®æ¯ä¸ªé•¿åº¦çš„æ•´æ•°åœ¨å­—ç¬¦ä¸²ä¸­æ‰¾åˆ°å¯¹åº”é•¿åº¦çš„ prefixï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">String</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> allPrefixes1: [<span class="type">Substring</span>] &#123;</span><br><span class="line">        <span class="keyword">return</span> (<span class="number">0</span>...<span class="keyword">self</span>.<span class="built_in">count</span>).<span class="built_in">map</span>(<span class="keyword">self</span>.<span class="keyword">prefix</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> hello = <span class="string">"Hello"</span></span><br><span class="line">hello.allPrefixes1 <span class="comment">// â†’ ["", "H", "He", "Hel", "Hell", "Hello"]</span></span><br></pre></td></tr></table></figure><p>å°½ç®¡è¿™æ®µä»£ç çœ‹èµ·æ¥å¾ˆç®€å•ï¼Œä½†æ˜¯è¿è¡Œæ€§èƒ½å¾ˆä½ã€‚å®ƒå…ˆæ˜¯éå†äº†å­—ç¬¦ä¸²ä¸€æ¬¡ï¼Œè®¡ç®—å‡ºå­—ç¬¦ä¸²çš„é•¿åº¦ï¼Œè¿™è¿˜ OKã€‚ä½†æ˜¯æ¯æ¬¡å¯¹ <a href="https://developer.apple.com/documentation/swift/substring/2893985-prefix" target="_blank" rel="noopener"><code>prefix</code></a> è¿›è¡Œ n+1 çš„è°ƒç”¨éƒ½æ˜¯ä¸€æ¬¡ <em>O(n)</em> æ“ä½œï¼Œå› ä¸º <code>prefix</code> æ–¹æ³•éœ€è¦ä»å­—ç¬¦ä¸²çš„å¼€å¤´å¾€åæ‰¾å‡ºæ‰€éœ€æ•°é‡çš„å­—ç¬¦ã€‚è€Œåœ¨ä¸€ä¸ªçº¿æ€§è¿ç®—é‡Œè¿›è¡Œå¦ä¸€ä¸ªçº¿æ€§è¿ç®—å°±æ„å‘³ç€ç®—æ³•å·²ç»æˆäº† <em>O(n2)</em> â€”â€”éšç€å­—ç¬¦ä¸²é•¿åº¦çš„å¢åŠ ï¼Œç®—æ³•æ‰€éœ€çš„æ—¶é—´æ˜¯å‘ˆæŒ‡æ•°çº§å¢é•¿çš„ã€‚</p><p>å¦‚æœå¯èƒ½çš„è¯ï¼Œä¸€ä¸ªé«˜æ€§èƒ½çš„ç®—æ³•åº”è¯¥æ˜¯éå†å­—ç¬¦ä¸²ä¸€æ¬¡ï¼Œç„¶åé€šè¿‡å¯¹å­—ç¬¦ä¸²ç´¢å¼•çš„æ“ä½œå¾—åˆ°æƒ³è¦çš„å­å­—ç¬¦ä¸²ã€‚ä¸‹é¢æ˜¯ç›¸åŒç®—æ³•çš„å¦ä¸€ä¸ªç‰ˆæœ¬ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">String</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> allPrefixes2: [<span class="type">Substring</span>] &#123;</span><br><span class="line">        <span class="keyword">return</span> [<span class="string">""</span>] + <span class="keyword">self</span>.<span class="built_in">indices</span>.<span class="built_in">map</span> &#123; index <span class="keyword">in</span> <span class="keyword">self</span>[...index] &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">hello.allPrefixes2 <span class="comment">// â†’ ["", "H", "He", "Hel", "Hell", "Hello"]</span></span><br></pre></td></tr></table></figure><p>è¿™æ®µä»£ç åªéœ€è¦éå†å­—ç¬¦ä¸²ä¸€æ¬¡ï¼Œå¾—åˆ°å­—ç¬¦ä¸²çš„ç´¢å¼•ï¼ˆ<a href="https://developer.apple.com/documentation/swift/bidirectionalcollection/1785188-indices" target="_blank" rel="noopener"><code>indices</code></a>ï¼‰é›†åˆã€‚ä¸€æ—¦å®Œæˆä¹‹åï¼Œä¹‹åå† <code>map</code> å†…çš„æ“ä½œå°±åªæ˜¯ <em>O(1)</em>ã€‚æ•´ä¸ªç®—æ³•ä¹Ÿåªæ˜¯ <em>O(n)</em>ã€‚</p><h3 id="èŒƒå›´å¯æ›¿æ¢ï¼Œä¸å¯å˜"><a href="#èŒƒå›´å¯æ›¿æ¢ï¼Œä¸å¯å˜" class="headerlink" title="èŒƒå›´å¯æ›¿æ¢ï¼Œä¸å¯å˜"></a>èŒƒå›´å¯æ›¿æ¢ï¼Œä¸å¯å˜</h3><p><code>String</code> è¿˜éµä»äº <a href="https://developer.apple.com/documentation/swift/rangereplaceablecollection" target="_blank" rel="noopener"><code>RangeReplaceableCollection</code></a> ï¼ˆèŒƒå›´å¯æ›¿æ¢ï¼‰çš„é›†åˆæ“ä½œã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä½ å¯ä»¥å…ˆæŒ‰å­—ç¬¦ä¸²ç´¢å¼•çš„å½¢å¼å®šä¹‰å‡ºä¸€ä¸ªèŒƒå›´ï¼Œç„¶åé€šè¿‡è°ƒç”¨ <a href="https://developer.apple.com/documentation/swift/string/1641462-replacesubrange" target="_blank" rel="noopener"><code>replaceSubrange</code></a> ï¼ˆæ›¿æ¢å­èŒƒå›´ï¼‰æ–¹æ³•ï¼Œæ›¿æ¢æ‰å­—ç¬¦ä¸²ä¸­çš„ä¸€äº›å­—ç¬¦ã€‚è¿™é‡Œæœ‰ä¸€ä¸ªä¾‹å­ã€‚æ›¿æ¢çš„å­—ç¬¦ä¸²å¯ä»¥æœ‰ä¸åŒçš„é•¿åº¦ï¼Œç”šè‡³è¿˜å¯ä»¥æ˜¯ç©ºçš„ï¼ˆè¿™æ—¶å€™å°±ç›¸å½“äºè°ƒç”¨ <a href="https://developer.apple.com/documentation/swift/string/2893740-removesubrange" target="_blank" rel="noopener"><code>removeSubrange</code></a> æ–¹æ³•äº†ï¼‰ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> greeting = <span class="string">"Hello, world!"</span></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">let</span> comma = greeting.index(of: <span class="string">","</span>) &#123;</span><br><span class="line">    greeting[..&lt;comma] <span class="comment">// â†’ "Hello"</span></span><br><span class="line">    greeting.replaceSubrange(comma..., with: <span class="string">" again."</span>)</span><br><span class="line">&#125;</span><br><span class="line">greeting <span class="comment">// â†’ "Hello again."</span></span><br></pre></td></tr></table></figure><p>åŒæ ·ï¼Œè¿™é‡Œä¹Ÿè¦æ³¨æ„ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚æœæ›¿æ¢çš„å­—ç¬¦ä¸²å’ŒåŸå­—ç¬¦ä¸²ä¸­ç›¸é‚»çš„å­—ç¬¦å½¢æˆäº†æ–°çš„å­—ä½é›†ï¼Œé‚£ç»“æœå¯èƒ½å°±ä¼šæœ‰ç‚¹å‡ºäººæ„æ–™äº†ã€‚</p><p>å­—ç¬¦ä¸²æ— æ³•æä¾›çš„ä¸€ä¸ªç±»é›†åˆç‰¹æ€§æ˜¯ï¼š<a href="https://developer.apple.com/documentation/swift/mutablecollection" target="_blank" rel="noopener"><code>MutableCollection</code></a>ã€‚è¯¥åè®®ç»™é›†åˆé™¤ <code>get</code> ä¹‹å¤–ï¼Œæ·»åŠ äº†ä¸€ä¸ªé€šè¿‡ä¸‹æ ‡è¿›è¡Œå•ä¸€å…ƒç´  <code>set</code> çš„ç‰¹æ€§ã€‚è¿™å¹¶ä¸æ˜¯è¯´å­—ç¬¦ä¸²æ˜¯ä¸å¯å˜çš„â€”â€”æˆ‘ä»¬ä¸Šé¢å·²ç»çœ‹åˆ°äº†ï¼Œæœ‰å¥½å‡ ç§å˜åŒ–çš„æ–¹æ³•ã€‚ä½ æ— æ³•å®Œæˆçš„æ˜¯ä½¿ç”¨ä¸‹æ ‡æ“ä½œç¬¦æ›¿æ¢å…¶ä¸­çš„ä¸€ä¸ªå­—ç¬¦ã€‚è®¸å¤šäººç›´è§‰è®¤ä¸ºç”¨ä¸‹æ ‡æ“ä½œç¬¦æ›¿æ¢ä¸€ä¸ªå­—ç¬¦æ˜¯å³æ—¶å‘ç”Ÿçš„ï¼Œå°±åƒæ•°ç»„ <a href="https://developer.apple.com/documentation/swift/array" target="_blank" rel="noopener"><code>Array</code></a> é‡Œé¢çš„æ›¿æ¢ä¸€æ ·ã€‚ä½†æ˜¯ï¼Œå› ä¸ºå­—ç¬¦ä¸²é‡Œçš„å­—ç¬¦é•¿åº¦æ˜¯ä¸å®šçš„ï¼Œæ‰€ä»¥æ›¿æ¢ä¸€ä¸ªå­—ç¬¦çš„æ—¶é—´å’Œå­—ç¬¦ä¸²çš„é•¿åº¦å‘ˆçº¿æ€§å…³ç³»ï¼šæ›¿æ¢ä¸€ä¸ªå…ƒç´ çš„å®½åº¦ä¼šæŠŠå…¶ä»–æ‰€æœ‰å…ƒç´ åœ¨å†…å­˜ä¸­çš„ä½ç½®é‡æ–°æ´—ç‰Œã€‚è€Œä¸”ï¼Œæ›¿æ¢å…ƒç´ ç´¢å¼•åé¢çš„å…ƒç´ ç´¢å¼•åœ¨æ´—ç‰Œä¹‹åéƒ½å˜äº†ï¼Œè¿™ä¹Ÿæ˜¯è·Ÿäººä»¬çš„ç›´è§‰ç›¸è¿èƒŒçš„ã€‚å‡ºäºè¿™äº›åŸå› ï¼Œä½ å¿…é¡»ä½¿ç”¨ <code>replaceSubrange</code> è¿›è¡Œæ›¿æ¢ï¼Œå³ä½¿ä½ å˜åŒ–åªæ˜¯ä¸€ä¸ªå…ƒç´ ã€‚</p><h2 id="å­—ç¬¦ä¸²ç´¢å¼•"><a href="#å­—ç¬¦ä¸²ç´¢å¼•" class="headerlink" title="å­—ç¬¦ä¸²ç´¢å¼•"></a>å­—ç¬¦ä¸²ç´¢å¼•</h2><p>å¤§å¤šæ•°ç¼–ç¨‹è¯­è¨€éƒ½æ˜¯ç”¨æ•´æ•°ä½œä¸ºå­—ç¬¦ä¸²çš„ä¸‹æ ‡ï¼Œä¾‹å¦‚ <code>str[5]</code> å°±ä¼šè¿”å› <code>str</code> çš„ç¬¬å…­ä¸ªâ€œå­—ç¬¦â€ï¼ˆæ— è®ºè¿™ä¸ªè¯­è¨€å®šä¹‰çš„â€œå­—ç¬¦â€æ˜¯ä»€ä¹ˆï¼‰ã€‚Swift å´ä¸å…è®¸è¿™æ ·ã€‚ä¸ºä»€ä¹ˆå‘¢ï¼ŸåŸå› å¯èƒ½ä½ å·²ç»å¬äº†å¾ˆå¤šéäº†ï¼šä¸‹æ ‡åº”è¯¥æ˜¯ä½¿ç”¨å›ºå®šæ—¶é—´çš„(æ— è®ºæ˜¯ç›´è§‰ä¸Šï¼Œè¿˜æ˜¯æ ¹æ®é›†åˆåè®®)ï¼Œä½†æ˜¯æŸ¥è¯¢ç¬¬ n ä¸ªâ€œå­—ç¬¦â€çš„æ“ä½œå¿…é¡»æŸ¥è¯¢å®ƒå‰é¢æ‰€æœ‰çš„å­—èŠ‚ã€‚</p><p><a href="https://developer.apple.com/documentation/swift/string.index" target="_blank" rel="noopener">å­—ç¬¦ä¸²ç´¢å¼•ï¼ˆ<code>String.Index</code>ï¼‰</a> æ˜¯å­—ç¬¦ä¸²åŠå…¶è§†å›¾ä½¿ç”¨çš„ç´¢å¼•ç±»å‹ã€‚å®ƒæ˜¯ä¸ªä¸é€æ˜å€¼ï¼ˆopaque valueï¼Œå†…éƒ¨ä½¿ç”¨çš„å€¼ï¼Œå¼€å‘è€…ä¸€èˆ¬ä¸ç›´æ¥ä½¿ç”¨ï¼‰ï¼Œæœ¬è´¨ä¸Šå­˜å‚¨çš„æ˜¯ä»å­—ç¬¦ä¸²å¼€å¤´ç®—èµ·çš„å­—èŠ‚åç§»é‡ã€‚å¦‚æœä½ æƒ³è®¡ç®—ç¬¬ n ä¸ªå­—ç¬¦çš„ç´¢å¼•ï¼Œå®ƒè¿˜æ˜¯ä¸€ä¸ª <em>O(n)</em> çš„æ“ä½œï¼Œè€Œä¸”ä½ è¿˜æ˜¯å¿…é¡»ä»å­—ç¬¦ä¸²çš„å¼€å¤´å¼€å§‹ç®—èµ·ï¼Œä½†æ˜¯ä¸€æ—¦ä½ æœ‰äº†ä¸€ä¸ªæ­£ç¡®çš„ç´¢å¼•ä¹‹åï¼Œå¯¹è¿™ä¸ªå­—ç¬¦ä¸²è¿›è¡Œä¸‹æ ‡æ“ä½œå°±åªéœ€è¦ <em>O(1)</em> æ¬¡äº†ã€‚å…³é”®æ˜¯ï¼Œæ‰¾åˆ°ç°æœ‰ç´¢å¼•åé¢çš„å…ƒç´ çš„ç´¢å¼•çš„æ“ä½œä¹Ÿä¼šå˜å¾—å¾ˆå¿«ï¼Œå› ä¸ºä½ åªéœ€è¦ä»å·²æœ‰ç´¢å¼•å­—èŠ‚åé¢å¼€å§‹ç®—èµ·äº†â€”â€”æ²¡æœ‰å¿…è¦ä»å­—ç¬¦ä¸²å¼€å¤´å¼€å§‹äº†ã€‚è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆæœ‰åºï¼ˆå‘å‰æˆ–æ˜¯å‘åï¼‰è®¿é—®å­—ç¬¦ä¸²é‡Œçš„å­—ç¬¦æ•ˆç‡å¾ˆé«˜çš„åŸå› ã€‚</p><p>å­—ç¬¦ä¸²ç´¢å¼•æ“ä½œçš„ä¾æ®è·Ÿä½ åœ¨å…¶ä»–é›†åˆé‡Œä½¿ç”¨çš„æ‰€æœ‰ API ä¸€æ ·ã€‚å› ä¸ºæˆ‘ä»¬æœ€å¸¸ç”¨çš„é›†åˆï¼šæ•°ç»„ï¼Œä½¿ç”¨çš„æ˜¯æ•´æ•°ç´¢å¼•ï¼Œæˆ‘ä»¬é€šå¸¸ä½¿ç”¨ç®€å•çš„ç®—æœ¯æ¥æ“ä½œï¼Œæ‰€ä»¥æœ‰ä¸€ç‚¹å¾ˆå®¹æ˜“å¿˜è®°ï¼š <a href="https://developer.apple.com/documentation/swift/string/1782583-index" target="_blank" rel="noopener"><code>index(after:)</code></a> æ–¹æ³•è¿”å›çš„æ˜¯ä¸‹ä¸€ä¸ªå­—ç¬¦çš„ç´¢å¼•ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> s = <span class="string">"abcdef"</span></span><br><span class="line"><span class="keyword">let</span> second = s.index(after: s.startIndex)</span><br><span class="line">s[second] <span class="comment">// â†’ "b"</span></span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ <a href="https://developer.apple.com/documentation/swift/string/1786175-index" target="_blank" rel="noopener"><code>index(_:offsetBy:)</code></a>æ–¹æ³•ï¼Œä½ å¯ä»¥é€šè¿‡ä¸€æ¬¡æ“ä½œï¼Œè‡ªåŠ¨åœ°è®¿é—®å¤šä¸ªå­—ç¬¦ï¼Œ</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Advance 4 more characters</span></span><br><span class="line"><span class="keyword">let</span> sixth = s.index(second, offsetBy: <span class="number">4</span>)</span><br><span class="line">s[sixth] <span class="comment">// â†’ "f"</span></span><br></pre></td></tr></table></figure><p>å¦‚æœå¯èƒ½è¶…å‡ºå­—ç¬¦ä¸²æœ«å°¾ï¼Œä½ å¯ä»¥åŠ ä¸€ä¸ª <a href="https://developer.apple.com/documentation/swift/anybidirectionalcollection/1781464-index" target="_blank" rel="noopener"><code>limitedBy:</code></a> å‚æ•°ã€‚å¦‚æœåœ¨è®¿é—®åˆ°ç›®æ ‡ç´¢å¼•ä¹‹å‰åˆ°è¾¾äº†å­—ç¬¦ä¸²çš„æœ«å°¾ï¼Œè¿™ä¸ªæ–¹æ³•ä¼šè¿”å›ä¸€ä¸ª <code>nil</code> å€¼ã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> safeIdx = s.index(s.startIndex, offsetBy: <span class="number">400</span>, limitedBy: s.endIndex)</span><br><span class="line">safeIdx <span class="comment">// â†’ nil</span></span><br></pre></td></tr></table></figure><p>æ¯”èµ·ç®€å•çš„æ•´æ•°ç´¢å¼•ï¼Œè¿™æ— ç–‘ä½¿ç”¨äº†æ›´å¤šçš„ä»£ç ã€‚<strong>è¿™æ˜¯ Swift æ•…æ„çš„ã€‚</strong>å¦‚æœ Swift å…è®¸å¯¹å­—ç¬¦ä¸²è¿›è¡Œæ•´æ•°ç´¢å¼•ï¼Œé‚£ä¸å°å¿ƒå†™å‡ºæ€§èƒ½çƒ‚åˆ°çˆ†çš„ä»£ç ï¼ˆæ¯”å¦‚åœ¨ä¸€ä¸ªå¾ªç¯ä¸­ä½¿ç”¨æ•´æ•°çš„ä¸‹æ ‡æ“ä½œï¼‰çš„è¯±æƒ‘å¤ªå¤§äº†ã€‚</p><p>ç„¶è€Œï¼Œå¯¹ä¸€ä¸ªä¹ æƒ¯äºå¤„ç†å›ºå®šå®½åº¦å­—ç¬¦çš„äººæ¥è¯´ï¼Œåˆšå¼€å§‹ä½¿ç”¨ Swift å¤„ç†å­—ç¬¦ä¸²ä¼šæœ‰äº›æŒ‘æˆ˜â€”â€”æ²¡æœ‰äº†æ•´æ•°ç´¢å¼•æ€ä¹ˆæï¼Ÿè€Œä¸”ç¡®å®ï¼Œä¸€äº›çœ‹èµ·æ¥ç®€å•çš„ä»»åŠ¡å¤„ç†èµ·æ¥è¿˜å¾—å¤§åŠ¨å¹²æˆˆï¼Œæ¯”å¦‚æå–å­—ç¬¦ä¸²çš„å‰å››ä¸ªå­—ç¬¦ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">s[..&lt;s.index(s.startIndex, offsetBy: <span class="number">4</span>)] <span class="comment">// â†’ "abcd"</span></span><br></pre></td></tr></table></figure><p>ä¸è¿‡è°¢å¤©è°¢åœ°ï¼Œä½ å¯ä»¥ä½¿ç”¨é›†åˆçš„æ¥å£æ¥è·å–å­—ç¬¦ä¸²ï¼Œè¿™æ„å‘³ç€è®¸å¤šé€‚ç”¨äºæ•°ç»„çš„æ–¹æ³•åŒæ ·ä¹Ÿé€‚ç”¨äºå­—ç¬¦ä¸²ã€‚æ¯”å¦‚ä¸Šé¢é‚£ä¸ªä¾‹å­ï¼Œå¦‚æœä½¿ç”¨ <code>prefix</code> æ–¹æ³•å°±ç®€å•å¾—å¤šäº†ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">s.<span class="keyword">prefix</span>(<span class="number">4</span>) <span class="comment">// â†’ "abcd"</span></span><br></pre></td></tr></table></figure><p>ï¼ˆæ³¨æ„ï¼Œä¸Šé¢çš„å‡ ä¸ªæ–¹æ³•è¿”å›çš„éƒ½æ˜¯å­å­—ç¬¦ä¸² <a href="https://developer.apple.com/documentation/swift/substring" target="_blank" rel="noopener"><code>Substring</code></a>ï¼Œä½ å¯ä»¥ä½¿ç”¨ä¸€ä¸ª <code>String.init</code> æŠŠå®ƒè½¬æ¢ä¸ºå­—ç¬¦ä¸²ã€‚å…³äºè¿™ä¸€éƒ¨åˆ†ï¼Œæˆ‘ä»¬ä¸‹ä¸€éƒ¨åˆ†ä¼šè®²æ›´å¤šã€‚ï¼‰</p><p>æ²¡æœ‰æ•´æ•°ç´¢å¼•ï¼Œå¾ªç¯è®¿é—®å­—ç¬¦ä¸²é‡Œçš„å­—ç¬¦ä¹Ÿå¾ˆç®€å•ï¼Œç”¨ <code>for</code> å¾ªç¯ã€‚å¦‚æœä½ æƒ³æŒ‰é¡ºåºæ’åˆ—ï¼Œä½¿ç”¨ <a href="https://developer.apple.com/documentation/swift/sequence/1641222-enumerated" target="_blank" rel="noopener"><code>enumerated()</code></a>ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> (i, <span class="built_in">c</span>) <span class="keyword">in</span> s.enumerated() &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"<span class="subst">\(i)</span>: <span class="subst">\(<span class="built_in">c</span>)</span>"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ–è€…å¦‚æœä½ æƒ³æ‰¾åˆ°ä¸€ä¸ªç‰¹å®šçš„å­—ç¬¦ï¼Œä½ å¯ä»¥ä½¿ç”¨ <a href="https://developer.apple.com/documentation/swift/string/2893264-index" target="_blank" rel="noopener"><code>index(of:)</code></a>:</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> hello = <span class="string">"Hello!"</span></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">let</span> idx = hello.index(of: <span class="string">"!"</span>) &#123;</span><br><span class="line">    hello.insert(contentsOf: <span class="string">", world"</span>, at: idx)</span><br><span class="line">&#125;</span><br><span class="line">hello <span class="comment">// â†’ "Hello, world!"</span></span><br></pre></td></tr></table></figure><p><a href="https://developer.apple.com/documentation/swift/string/2893571-insert" target="_blank" rel="noopener"><code>insert(contentsOf:at:)</code></a> æ–¹æ³•å¯ä»¥åœ¨æŒ‡å®šç´¢å¼•å‰æ’å…¥ç›¸åŒç±»å‹çš„å¦ä¸€ä¸ªé›†åˆï¼ˆæ¯”å¦‚è¯´å­—ç¬¦ä¸²é‡Œçš„å­—ç¬¦ï¼‰ã€‚å¹¶ä¸ä¸€å®šæ˜¯å¦ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œä½ å¯ä»¥å¾ˆå®¹æ˜“åœ°æŠŠä¸€ä¸ªå­—ç¬¦çš„æ•°ç»„æ’å…¥åˆ°ä¸€ä¸ªå­—ç¬¦ä¸²é‡Œã€‚</p><h2 id="å­å­—ç¬¦ä¸²"><a href="#å­å­—ç¬¦ä¸²" class="headerlink" title="å­å­—ç¬¦ä¸²"></a>å­å­—ç¬¦ä¸²</h2><p>å’Œå…¶ä»–çš„é›†åˆä¸€æ ·ï¼Œå­—ç¬¦ä¸²æœ‰ä¸€ä¸ªç‰¹å®šçš„åˆ‡ç‰‡ç±»å‹æˆ–è€…è¯´å­åºåˆ—ç±»å‹ï¼ˆ<a href="https://developer.apple.com/documentation/swift/collection/1641276-subsequence" target="_blank" rel="noopener"><code>SubSequence</code></a>ï¼‰ï¼šå­å­—ç¬¦ä¸²ï¼ˆ<a href="https://developer.apple.com/documentation/swift/substring" target="_blank" rel="noopener"><code>Substring</code></a>ï¼‰ã€‚å­å­—ç¬¦ä¸²å°±åƒæ˜¯ä¸€ä¸ªæ•°ç»„åˆ‡ç‰‡ï¼ˆ<a href="https://developer.apple.com/documentation/swift/arrayslice" target="_blank" rel="noopener"><code>ArraySlice</code></a>ï¼‰ï¼šå®ƒæ˜¯åŸå­—ç¬¦ä¸²çš„ä¸€ä¸ªè§†å›¾ï¼Œèµ·å§‹ç´¢å¼•å’Œç»“æŸç´¢å¼•ä¸åŒã€‚å­å­—ç¬¦ä¸²å…±äº«åŸå­—ç¬¦ä¸²çš„æ–‡æœ¬å­˜å‚¨ç©ºé—´ã€‚è¿™æ˜¯ä¸€ä¸ªå¾ˆå¤§çš„ä¼˜åŠ¿ï¼Œå¯¹ä¸€ä¸ªå­—ç¬¦ä¸²è¿›è¡Œåˆ‡ç‰‡æ“ä½œä¸å ç”¨å†…å­˜ç©ºé—´ã€‚åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œåˆ›å»º<code>firstWord</code>å˜é‡ä¸å ç”¨å†…å­˜ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> sentence = <span class="string">"The quick brown fox jumped over the lazy dog."</span></span><br><span class="line"><span class="keyword">let</span> firstSpace = sentence.index(of: <span class="string">" "</span>) ?? sentence.endIndex</span><br><span class="line"><span class="keyword">let</span> firstWord = sentence[..&lt;firstSpace] <span class="comment">// â†’ "The"</span></span><br><span class="line">type(of: firstWord) <span class="comment">// â†’ Substring.Type</span></span><br></pre></td></tr></table></figure><p>åˆ‡ç‰‡æ“ä½œä¸å ç”¨å†…å­˜æ„ä¹‰é‡å¤§ï¼Œç‰¹åˆ«æ˜¯åœ¨ä¸€ä¸ªå¾ªç¯ä¸­ï¼Œæ¯”å¦‚ä½ è¦é€šè¿‡å¾ªç¯è®¿é—®æ•´ä¸ªå­—ç¬¦ä¸²ï¼ˆå¯èƒ½ä¼šå¾ˆé•¿ï¼‰æ¥æå–å…¶ä¸­çš„å­—ç¬¦ã€‚æ¯”å¦‚åœ¨æ–‡æœ¬ä¸­æ‰¾åˆ°ä¸€ä¸ªå•è¯ä½¿ç”¨çš„æ¬¡æ•°ï¼Œæ¯”å¦‚è§£æä¸€ä¸ª CSV æ–‡ä»¶ã€‚è¿™é‡Œæœ‰ä¸€ä¸ªéå¸¸æœ‰ç”¨çš„å­—ç¬¦ä¸²å¤„ç†æ“ä½œï¼šsplitã€‚<code>split</code> æ˜¯ <code>Collection</code> é›†åˆä¸­å®šä¹‰çš„ä¸€ä¸ªæ–¹æ³•ï¼Œå®ƒä¼šè¿”å›ä¸€ä¸ªå­åºåˆ—çš„æ•°ç»„ï¼ˆå³ <code>[Substring]</code> ï¼‰ã€‚å®ƒæœ€å¸¸è§çš„å˜ç§å°±åƒæ˜¯è¿™æ ·ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Collection</span> <span class="title">where</span> <span class="title">Element</span>: <span class="title">Equatable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">split</span><span class="params">(separator: Element, maxSplits: Int = Int.<span class="built_in">max</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">        omittingEmptySubsequences: Bool = <span class="literal">true</span>)</span></span> -&gt; [<span class="type">SubSequence</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½ å¯ä»¥è¿™æ ·ä½¿ç”¨ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> poem = <span class="string">""</span><span class="string">"</span></span><br><span class="line"><span class="string">    Over the wintry</span></span><br><span class="line"><span class="string">    forest, winds howl in rage</span></span><br><span class="line"><span class="string">    with no leaves to blow.</span></span><br><span class="line"><span class="string">    "</span><span class="string">""</span></span><br><span class="line"><span class="keyword">let</span> lines = poem.<span class="built_in">split</span>(separator: <span class="string">"\n"</span>)</span><br><span class="line"><span class="comment">// â†’ ["Over the wintry", "forest, winds howl in rage", "with no leaves to blow."]</span></span><br><span class="line">type(of: lines) <span class="comment">// â†’ Array&lt;Substring&gt;.Type</span></span><br></pre></td></tr></table></figure><p>è¿™ä¸ªè·Ÿ <code>String</code> ç»§æ‰¿è‡ª <code>NSString</code> çš„ <a href="https://developer.apple.com/documentation/swift/stringprotocol/2923413-components" target="_blank" rel="noopener"><code>components(separatedBy:)</code></a> æ–¹æ³•çš„åŠŸèƒ½ç±»ä¼¼ï¼Œä½ è¿˜å¯ä»¥ç”¨ä¸€äº›é¢å¤–è®¾ç½®æ¯”å¦‚æ˜¯å¦æŠ›å¼ƒç©ºçš„ç»„ä»¶ã€‚è€Œä¸”åœ¨è¿™ä¸ªæ“ä½œä¸­ï¼Œæ‰€æœ‰è¾“å…¥å­—ç¬¦ä¸²éƒ½æ²¡æœ‰åˆ›å»ºæ–°çš„å¤åˆ¶ã€‚å› ä¸ºè¿˜æœ‰å…¶ä»–<code>split</code>æ–¹æ³•çš„å˜ç§å¯ä»¥å®Œæˆæ“ä½œï¼Œé™¤äº†æ¯”è¾ƒå­—ç¬¦ä»¥å¤–ï¼Œ<code>split</code> è¿˜å¯ä»¥å®Œæˆæ›´å¤šçš„äº‹æƒ…ã€‚ä¸‹é¢è¿™ä¸ªä¾‹å­æ˜¯æ–‡æœ¬æ¢è¡Œç®—æ³•çš„ä¸€ä¸ªåŸå§‹çš„å®ç°ï¼Œæœ€åçš„ä»£ç è®¡ç®—äº†è¡Œçš„é•¿åº¦ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">String</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">wrapped</span><span class="params">(after: Int = <span class="number">70</span>)</span></span> -&gt; <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> i = <span class="number">0</span></span><br><span class="line">        <span class="keyword">let</span> lines = <span class="keyword">self</span>.<span class="built_in">split</span>(omittingEmptySubsequences: <span class="literal">false</span>) &#123;</span><br><span class="line">            character <span class="keyword">in</span></span><br><span class="line">            <span class="keyword">switch</span> character &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">"\n"</span>, <span class="string">" "</span> <span class="keyword">where</span> i &gt;= after:</span><br><span class="line">                i = <span class="number">0</span></span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                i += <span class="number">1</span></span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> lines.joined(separator: <span class="string">"\n"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">sentence.wrapped(after: <span class="number">15</span>)</span><br><span class="line"><span class="comment">// â†’ "The quick brown\nfox jumped over\nthe lazy dog."</span></span><br></pre></td></tr></table></figure><p>æˆ–è€…ï¼Œè€ƒè™‘å†™å¦å¤–ä¸€ä¸ªç‰ˆæœ¬ï¼Œå¯ä»¥æ‹¿åˆ°ä¸€ä¸ªåŒ…å«å¤šä¸ªåˆ†éš”ç¬¦çš„åºåˆ—ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Collection</span> <span class="title">where</span> <span class="title">Element</span>: <span class="title">Equatable</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">split</span>&lt;S: Sequence&gt;<span class="params">(separators: S)</span></span> -&gt; [<span class="type">SubSequence</span>]</span><br><span class="line">        <span class="keyword">where</span> <span class="type">Element</span> == <span class="type">S</span>.<span class="type">Element</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">split</span> &#123; separators.<span class="built_in">contains</span>($<span class="number">0</span>) &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·çš„è¯ï¼Œä½ è¿˜å¯ä»¥è¿™ä¹ˆå†™ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="string">"Hello, world!"</span>.<span class="built_in">split</span>(separators: <span class="string">",! "</span>) <span class="comment">// â†’ ["Hello", "world"]</span></span><br></pre></td></tr></table></figure><h3 id="å­—ç¬¦ä¸²åè®®-StringProtocol"><a href="#å­—ç¬¦ä¸²åè®®-StringProtocol" class="headerlink" title="å­—ç¬¦ä¸²åè®® StringProtocol"></a>å­—ç¬¦ä¸²åè®® <code>StringProtocol</code></h3><p><code>Substring</code> å’Œ <code>String</code> å‡ ä¹æœ‰ç€ç›¸åŒçš„æ¥å£ï¼Œå› ä¸ºä¸¤ç§ç±»å‹éƒ½éµå®ˆä¸€ä¸ªå…±åŒçš„å­—ç¬¦ä¸²åè®®ï¼ˆ<a href="https://developer.apple.com/documentation/swift/stringprotocol" target="_blank" rel="noopener"><code>StringProtocol</code></a>ï¼‰ã€‚å› ä¸ºå‡ ä¹æ‰€æœ‰çš„å­—ç¬¦ä¸²API éƒ½æ˜¯åœ¨ <a href="https://developer.apple.com/documentation/swift/stringprotocol" target="_blank" rel="noopener"><code>StringProtocol</code></a> ä¸­å®šä¹‰çš„ï¼Œæ‰€ä»¥æ“ä½œ <code>Substring</code> è·Ÿæ“ä½œ <code>String</code> æ²¡æœ‰ä»€ä¹ˆå¤§çš„åŒºåˆ«ã€‚ä½†æ˜¯ï¼Œåœ¨æœ‰äº›æƒ…å†µä¸‹ï¼Œä½ è¿˜å¿…é¡»æŠŠå­å­—ç¬¦ä¸²è½¬æ¢ä¸ºå­—ç¬¦ä¸²çš„ç±»å‹ï¼›å°±åƒæ‰€æœ‰çš„åˆ‡ç‰‡ï¼ˆsliceï¼‰ä¸€æ ·ï¼Œå­å­—ç¬¦ä¸²åªæ˜¯ä¸ºäº†çŸ­æ—¶é—´å†…çš„å­˜å‚¨ï¼Œä¸ºäº†é˜²æ­¢ä¸€æ¬¡æ“ä½œå®šä¹‰å¤ªå¤šä¸ªå¤åˆ¶ã€‚å¦‚æœæ“ä½œç»“æŸä¹‹åï¼Œä½ è¿˜æƒ³ä¿ç•™ç»“æœï¼Œå°†æ•°æ®ä¼ åˆ°å¦ä¸€ä¸ªå­ç³»ç»Ÿé‡Œï¼Œä½ åº”è¯¥åˆ›å»ºä¸€ä¸ªæ–°çš„å­—ç¬¦ä¸²ã€‚ä½ å¯ä»¥ç”¨ä¸€ä¸ª <code>Substring</code> çš„å€¼åˆå§‹åŒ–ä¸€ä¸ª <code>String</code>ï¼Œå°±åƒæˆ‘ä»¬åœ¨è¿™ä¸ªä¾‹å­ä¸­åšçš„ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">lastWord</span><span class="params">(<span class="keyword">in</span> input: String)</span></span> -&gt; <span class="type">String</span>? &#123;</span><br><span class="line">    <span class="comment">// Process the input, working on substrings</span></span><br><span class="line">    <span class="keyword">let</span> words = input.<span class="built_in">split</span>(separators: [<span class="string">","</span>, <span class="string">" "</span>])</span><br><span class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> lastWord = words.last <span class="keyword">else</span> &#123; <span class="keyword">return</span> <span class="literal">nil</span> &#125;</span><br><span class="line">    <span class="comment">// Convert to String for return</span></span><br><span class="line">    <span class="keyword">return</span> <span class="type">String</span>(lastWord)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">lastWord(<span class="keyword">in</span>: <span class="string">"one, two, three, four, five"</span>) <span class="comment">// â†’ "five"</span></span><br></pre></td></tr></table></figure><p>ä¸å»ºè®®å­å­—ç¬¦ä¸²é•¿æœŸå­˜å‚¨èƒŒåçš„åŸå› æ˜¯å­å­—ç¬¦ä¸²ä¸€ç›´å…³è”ç€åŸå­—ç¬¦ä¸²ã€‚å³ä½¿ä¸€ä¸ªè¶…é•¿å­—ç¬¦ä¸²çš„å­å­—ç¬¦ä¸²åªæœ‰ä¸€ä¸ªå­—ç¬¦ï¼Œåªè¦å­å­—ç¬¦ä¸²è¿˜åœ¨ä½¿ç”¨ï¼Œé‚£åŸå…ˆçš„å­—ç¬¦ä¸²å°±è¿˜ä¼šåœ¨å†…å­˜é‡Œï¼Œå³ä½¿åŸå­—ç¬¦ä¸²çš„ç”Ÿå‘½å‘¨æœŸå·²ç»ç»“æŸã€‚å› æ­¤ï¼Œé•¿æœŸå­˜å‚¨å­å­—ç¬¦ä¸²å¯èƒ½å¯¼è‡´å†…å­˜æ³„æ¼ï¼Œå› ä¸ºæœ‰æ—¶å€™åŸå­—ç¬¦ä¸²å·²ç»æ— æ³•è®¿é—®äº†ï¼Œä½†æ˜¯è¿˜åœ¨å ç”¨å†…å­˜ã€‚</p><p>æ“ä½œè¿‡ç¨‹ä¸­ä½¿ç”¨å­å­—ç¬¦ä¸²ï¼Œæ“ä½œç»“æŸçš„æ—¶å€™æ‰åˆ›å»ºæ–°çš„å­—ç¬¦ä¸²ï¼Œé€šè¿‡è¿™ç§æ–¹å¼ï¼Œæˆ‘ä»¬æŠŠå ç”¨å†…å­˜çš„åŠ¨ä½œæ¨è¿Ÿåˆ°äº†æœ€åä¸€åˆ»ï¼Œè€Œä¸”ä¿è¯äº†æˆ‘ä»¬åªä¼šåˆ›å»ºå¿…è¦çš„å­—ç¬¦ä¸²ã€‚åœ¨ä¸Šé¢çš„ä¾‹å­å½“ä¸­ï¼Œæˆ‘ä»¬æŠŠæ•´ä¸ªå­—ç¬¦ä¸²ï¼ˆå¯èƒ½ä¼šå¾ˆé•¿ï¼‰åˆ†æˆäº†ä¸€ä¸ªä¸ªçš„å­å­—ç¬¦ä¸²ï¼Œä½†æ˜¯åœ¨æœ€ååªæ˜¯åˆ›å»ºäº†ä¸€ä¸ªå¾ˆçŸ­çš„å­—ç¬¦ä¸²ã€‚ï¼ˆä¾‹å­ä¸­çš„ç®—æ³•å¯èƒ½æ•ˆç‡ä¸æ˜¯é‚£ä¹ˆé«˜ï¼Œæš‚æ—¶å¿½ç•¥ä¸€ä¸‹ï¼›ä»åå…ˆå‰æ‰¾åˆ°ç¬¬ä¸€ä¸ªåˆ†éš”ç¬¦å¯èƒ½æ˜¯ä¸ªæ›´å¥½çš„æ–¹æ³•ã€‚ï¼‰</p><p>é‡åˆ°åªæ¥å— <code>Substring</code> ç±»å‹çš„æ–¹æ³•ï¼Œä½†æ˜¯ä½ æƒ³ä¼ é€’ä¸€ä¸ª <code>String</code> çš„ç±»å‹ï¼Œè¿™ç§æƒ…å†µå¾ˆå°‘è§ï¼ˆå¤§éƒ¨åˆ†çš„æ–¹æ³•éƒ½æ¥å— <code>String</code> ç±»å‹æˆ–è€…æ¥å—æ‰€æœ‰ç¬¦åˆå­—ç¬¦ä¸²åè®®çš„ç±»å‹ï¼‰ï¼Œä½†æ˜¯å¦‚æœä½ ç¡®å®éœ€è¦ä¼ é€’ä¸€ä¸ª <code>String</code> çš„ç±»å‹ï¼Œæœ€ä¾¿æ·çš„æ–¹æ³•æ˜¯ä½¿ç”¨èŒƒå›´æ“ä½œç¬¦ï¼š<code>...</code>ï¼ˆrange operatorï¼‰ï¼Œä¸é™å®šèŒƒå›´ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å­å­—ç¬¦ä¸²å’ŒåŸå­—ç¬¦ä¸²çš„èµ·å§‹å’Œç»“æŸçš„ç´¢å¼•å®Œå…¨ä¸€è‡´ </span></span><br><span class="line"><span class="keyword">let</span> substring = sentence[...]</span><br></pre></td></tr></table></figure><hr><p><code>Substring</code> ç±»å‹æ˜¯ Swift 4 ä¸­çš„æ–°ç‰¹æ€§ã€‚åœ¨ Swift 3 ä¸­ï¼Œ<code>String.CharacterView</code> æ˜¯è‡ªå·±ç‹¬æœ‰çš„åˆ‡ç‰‡ç±»å‹ï¼ˆslice typeï¼‰ã€‚è¿™ä¹ˆåšçš„ä¼˜åŠ¿æ˜¯ç”¨æˆ·åªéœ€è¦äº†è§£ä¸€ç§ç±»å‹ï¼Œä½†è¿™ä¹Ÿæ„å‘³è¿™å¦‚æœå­˜å‚¨ä¸€ä¸ªå­å­—ç¬¦ä¸²ï¼Œæ•´ä¸ªåŸå­—ç¬¦ä¸²ä¹Ÿä¼šå æ®å†…å­˜ï¼Œå³ä½¿å®ƒæ­£å¸¸æƒ…å†µä¸‹åº”è¯¥å·²ç»è¢«é‡Šæ”¾äº†ã€‚Swift 4 æŸå¤±äº†ä¸€ç‚¹ä¾¿æ·ï¼Œæ¢æ¥çš„æ˜¯çš„æ–¹ä¾¿çš„åˆ‡ç‰‡æ“ä½œå’Œå¯é¢„æµ‹çš„å†…å­˜ä½¿ç”¨ã€‚</p><p>è¦æ±‚ <code>Substring</code> åˆ° <code>String</code> çš„è½¬æ¢å¿…é¡»æ˜ç¡®å†™å‡ºï¼ŒSwift å›¢é˜Ÿè®¤ä¸ºè¿™æ²¡é‚£ä¹ˆçƒ¦äººã€‚å¦‚æœå®é™…åº”ç”¨ä¸­å¤§å®¶éƒ½è§‰å¾—é—®é¢˜å¾ˆå¤§ï¼Œä»–ä»¬ä¹Ÿä¼šè€ƒè™‘ç›´æ¥åœ¨ç¼–è¯‘å™¨ä¸­å†™ä¸€ä¸ª <code>Substring</code> å’Œ <code>String</code> ä¹‹é—´çš„<a href="https://github.com/apple/swift/blob/master/docs/StringManifesto.md#substrings" target="_blank" rel="noopener">æ¨¡ç³Šå­ç±»å‹å…³ç³»ï¼ˆimplicit subtype relationshipï¼‰</a>ï¼Œå°±åƒ <code>Int</code> æ˜¯ <code>Optional&lt;Int&gt;</code> çš„å­ç±»å‹ä¸€æ ·ã€‚è¿™æ ·ä½ å°±å¯ä»¥éšæ„ä¼ é€’ <code>Substring</code> ç±»å‹ï¼Œç¼–è¯‘å™¨ä¼šå¸®ä½ å®Œæˆç±»å‹è½¬æ¢ã€‚</p><hr><p>ä½ å¯èƒ½ä¼šå€¾å‘äºå……åˆ†åˆ©ç”¨å­—ç¬¦ä¸²åè®®ï¼ŒæŠŠä½ æ‰€æœ‰çš„ API å†™æˆæ¥å—æ‰€æœ‰éµå®ˆå­—ç¬¦ä¸²åè®®çš„å®ä¾‹ï¼Œè€Œä¸æ˜¯ä»…ä»…æ¥å— <code>String</code> å­—ç¬¦ä¸²ã€‚ä½† Swift å›¢é˜Ÿçš„å»ºè®®æ˜¯ï¼Œ<a href="https://lists.swift.org/pipermail/swift-evolution/Week-of-Mon-20170626/037828.html" target="_blank" rel="noopener">åˆ«è¿™æ ·</a>ï¼š</p><blockquote><p>æ€»çš„æ¥è¯´ï¼Œæˆ‘ä»¬å»ºè®®ç»§ç»­ä½¿ç”¨å­—ç¬¦ä¸²å˜é‡ã€‚ ä½¿ç”¨å­—ç¬¦ä¸²å˜é‡ï¼Œå¤§å¤šæ•°çš„ API éƒ½ä¼šæ¯”æŠŠå®ƒä»¬å†™æˆé€šç”¨ç±»å‹ï¼ˆè¿™ä¸ªæ“ä½œæœ¬èº«å°±æœ‰ä¸€äº›ä»£ä»·ï¼‰æ›´åŠ ç®€æ´æ¸…æ™°ï¼Œç”¨æˆ·åœ¨å¿…è¦çš„æ—¶å€™è¿›è¡Œä¸€äº›è½¬æ¢å¹¶ä¸éœ€è¦èŠ±è´¹å¾ˆå¤§çš„ç²¾åŠ›ã€‚</p></blockquote><p>ä¸€äº› API ææœ‰å¯èƒ½å’Œå­å­—ç¬¦ä¸²ä¸€èµ·ä½¿ç”¨ï¼ŒåŒæ—¶æ— æ³•æ³›åŒ–åˆ°é€‚ç”¨äºæ•´ä¸ªåºåˆ— <code>Sequence</code> æˆ–é›†åˆ <code>Collection</code> çš„çº§åˆ«ï¼Œè¿™äº› API å¯ä»¥ä¸å—è¿™æ¡è§„åˆ™çš„é™åˆ¶ã€‚ä¸€ä¸ªä¾‹å­å°±æ˜¯æ ‡å‡†åº“ä¸­çš„ <a href="https://developer.apple.com/documentation/swift/sequence/1641243-joined" target="_blank" rel="noopener"><code>joined</code></a> æ–¹æ³•ã€‚Swift 4 ä¸­ï¼Œé’ˆå¯¹éµå®ˆå­—ç¬¦ä¸²åè®®çš„å…ƒç´ ç»„æˆçš„åºåˆ—ï¼ˆ<code>Sequence</code>ï¼‰æ·»åŠ äº†ä¸€ä¸ªé‡è½½ï¼ˆ<code>overload</code>ï¼‰ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Sequence</span> <span class="title">where</span> <span class="title">Element</span>: <span class="title">StringProtocol</span> </span>&#123;</span><br><span class="line">    <span class="comment">/// ä¸¤ä¸ªå…ƒç´ ä¸­é—´åŠ ä¸Šä¸€ä¸ªç‰¹å®šåˆ†éš”ç¬¦å</span></span><br><span class="line">    <span class="comment">/// åˆå¹¶åºåˆ—ä¸­æ‰€æœ‰å…ƒç´ ï¼Œè¿”å›ä¸€ä¸ªæ–°çš„å­—ç¬¦ä¸²</span></span><br><span class="line">    <span class="comment">/// Returns a new string by concatenating the elements of the sequence,</span></span><br><span class="line">    <span class="comment">/// adding the given separator between each element.</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">joined</span><span class="params">(separator: String = <span class="string">""</span>)</span></span> -&gt; <span class="type">String</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·ï¼Œä½ å°±å¯ä»¥ç›´æ¥å¯¹ä¸€ä¸ªå­å­—ç¬¦ä¸²çš„æ•°ç»„è°ƒç”¨ <code>joined</code> æ–¹æ³•äº†ï¼Œæ²¡å¿…è¦éå†ä¸€æ¬¡æ•°ç»„å¹¶ä¸”æŠŠæ¯ä¸ªå­å­—ç¬¦ä¸²è½¬æ¢ä¸ºæ–°çš„å­—ç¬¦ä¸²ã€‚è¿™æ ·ï¼Œä¸€åˆ‡éƒ½å¾ˆæ–¹ä¾¿å¿«é€Ÿã€‚</p><p>æ•°å€¼ç±»å‹åˆå§‹å™¨ï¼ˆnumber type initializerï¼‰å¯ä»¥å°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºä¸€ä¸ªæ•°å­—ã€‚åœ¨ Swift 4 ä¸­ï¼Œå®ƒä¹Ÿæ¥å—éµå®ˆå­—ç¬¦ä¸²åè®®çš„å€¼ã€‚å¦‚æœä½ è¦å¤„ç†ä¸€ä¸ªå­å­—ç¬¦ä¸²çš„æ•°ç»„çš„è¯ï¼Œè¿™ä¸ªæ–¹æ³•å¾ˆé¡ºæ‰‹ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> commaSeparatedNumbers = <span class="string">"1,2,3,4,5"</span></span><br><span class="line"><span class="keyword">let</span> numbers = commaSeparatedNumbers</span><br><span class="line">    .<span class="built_in">split</span>(separator: <span class="string">","</span>).flatMap &#123; <span class="type">Int</span>($<span class="number">0</span>) &#125;</span><br><span class="line"><span class="comment">// â†’ [1, 2, 3, 4, 5]</span></span><br></pre></td></tr></table></figure><p>ç”±äºå­å­—ç¬¦ä¸²çš„ç”Ÿå‘½å‘¨æœŸå¾ˆçŸ­ï¼Œæ‰€ä»¥ä¸å»ºè®®æ–¹æ³•çš„è¿”å›å€¼æ˜¯å­å­—ç¬¦ä¸²ï¼Œé™¤éæ˜¯åºåˆ— <code>Sequence</code> æˆ–é›†åˆ <code>Collection</code> çš„ä¸€äº›è¿”å›åˆ‡ç‰‡çš„ APIã€‚å¦‚æœä½ å†™äº†ä¸€ä¸ªç±»ä¼¼çš„æ–¹æ³•ï¼Œåªå¯¹å­—ç¬¦ä¸²æœ‰æ„ä¹‰ï¼Œé‚£è®©å®ƒçš„è¿”å›å€¼æ˜¯å­å­—ç¬¦ä¸²ï¼Œå¥½è®©è¯»è€…æ˜ç™½è¿™ä¸ªæ–¹æ³•å¹¶ä¸ä¼šäº§ç”Ÿå¤åˆ¶ï¼Œä¸ä¼šå ç”¨å†…å­˜ã€‚åˆ›å»ºæ–°å­—ç¬¦ä¸²çš„æ–¹æ³•éœ€è¦å ç”¨å†…å­˜ï¼Œæ¯”å¦‚ <a href="https://developer.apple.com/documentation/swift/stringprotocol/2908613-uppercased" target="_blank" rel="noopener"><code>uppercased()</code></a>ï¼Œè¿™ç±»çš„æ–¹æ³•åº”è¯¥è¿”å› <code>String</code> å­—ç¬¦ä¸²ç±»å‹çš„å€¼ã€‚</p><p>å¦‚æœä½ æƒ³ä¸ºå­—ç¬¦ä¸²ç±»å‹æ‰©å±•æ–°çš„åŠŸèƒ½ï¼Œ å¥½çš„åŠæ³•æ˜¯å°†æ‰©å±•æ”¾åœ¨å­—ç¬¦ä¸²åè®® <code>StringProtocol</code> ä¸Šï¼Œä¿è¯ API åœ¨å­—ç¬¦ä¸²å’Œå­å­—ç¬¦ä¸²å±‚é¢çš„ä¸€è‡´æ€§ã€‚å­—ç¬¦æƒåè®®çš„è®¾è®¡åˆè¡·å°±æ˜¯æ›¿æ¢åŸå…ˆåœ¨å­—ç¬¦ä¸²åŸºç¡€ä¸Šåšçš„æ‰©å±•åŠŸèƒ½ã€‚å¦‚æœä½ æƒ³æŠŠç°æœ‰çš„æ‰©å±•ä»å­—ç¬¦ä¸²è½¬ç§»åˆ°å­—ç¬¦ä¸²åè®®ä¸Šï¼Œä½ è¦åšçš„å”¯ä¸€æ”¹å˜å°±æ˜¯ï¼ŒæŠŠä¼ é€’ <code>Self</code> ç»™åªæ¥å—å…·ä½“ <code>String</code> å€¼çš„ APIæ›¿æ¢ä¸º <code>String(Self)</code>ã€‚</p><p>éœ€è¦è®°ä½çš„ä¸€ç‚¹æ˜¯ï¼Œä» Swift 4 å¼€å§‹ï¼Œå¦‚æœä½ æœ‰ä¸€äº›è‡ªå®šä¹‰çš„å­—ç¬¦ä¸²ç±»å‹ï¼Œä¸å»ºè®®éµå®ˆå­—ç¬¦ä¸²åè®®<code>StringProtocol</code>ã€‚å®˜æ–¹æ–‡æ¡£æ˜ç¡®è­¦å‘Šï¼š</p><blockquote><p>ä¸è¦åšä»»ä½•æ–°çš„éµå®ˆå­—ç¬¦ä¸²åè®® <code>StringProtocol</code> çš„å£°æ˜ã€‚åªæœ‰æ ‡å‡†åº“é‡Œçš„ <code>String</code> å’Œ <code>Substring</code> æ˜¯æœ‰æ•ˆçš„éµå®ˆç±»å‹ã€‚</p></blockquote><p>å…è®¸å¼€å‘è€…å†™è‡ªå·±çš„å­—ç¬¦ä¸²ç±»å‹ï¼ˆæ¯”å¦‚æœ‰ç‰¹æ®Šçš„å­˜å‚¨ä¼˜åŒ–æˆ–æ€§èƒ½ä¼˜åŒ–ï¼‰æ˜¯ç»ˆæç›®æ ‡ï¼Œä½†æ˜¯ç°é˜¶æ®µåè®®çš„è®¾è®¡è¿˜æ²¡æœ‰æœ€ç»ˆç¡®å®šï¼Œæ‰€ä»¥ç°åœ¨å°±å¯ç”¨å®ƒå¯èƒ½ä¼šå¯¼è‡´ä½ çš„ä»£ç åœ¨ Swift 5é‡Œæ— æ³•æ­£å¸¸è¿è¡Œã€‚</p><p><code>â€¦ &lt;SNIP&gt;  &lt;å†…å®¹æœ‰åˆ å‡&gt;â€¦</code></p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>Swift è¯­è¨€é‡Œçš„å­—ç¬¦ä¸²è·Ÿå…¶ä»–æ‰€æœ‰çš„ä¸»æµç¼–ç¨‹è¯­è¨€é‡Œçš„å­—ç¬¦ä¸²å·®å¼‚å¾ˆå¤§ã€‚å½“ä½ ä¹ æƒ¯äºæŠŠå­—ç¬¦ä¸²å½“åšä»£ç å—çš„æ•°ç»„åï¼Œä½ å¾—èŠ±ç‚¹æ—¶é—´è½¬åŒ–æ€ç»´ï¼Œä¹ æƒ¯ Swift çš„å¤„ç†æ–¹æ³•ï¼šå®ƒæŠŠéµå®ˆ Unicode ç¼–ç æ ‡å‡†æ”¾åœ¨<strong>ç®€æ´</strong>å‰é¢ã€‚</p><p>æ€»çš„æ¥è®²ï¼Œæˆ‘ä»¬è®¤ä¸º Swift çš„é€‰æ‹©æ˜¯æ­£ç¡®çš„ã€‚Unicode ç¼–ç æ–‡æœ¬æ¯”å…¶ä»–ç¼–ç¨‹è¯­è¨€æ‰€è®¤ä¸ºçš„è¦å¤æ‚å¾—å¤šã€‚é•¿è¿œæ¥çœ‹ï¼Œå¤„ç†ä½ å¯èƒ½å†™å‡ºæ¥çš„ bug çš„æ—¶é—´è‚¯å®šæ¯”å­¦ä¹ æ–°çš„ç´¢å¼•æ–¹å¼ï¼ˆå¿˜è®°æ•´æ•°ç´¢å¼•ï¼‰æ‰€éœ€çš„æ—¶é—´å¤šã€‚</p><p>æˆ‘ä»¬å·²ç»ä¹ æƒ¯äºä»»æ„è·å–â€œå­—ç¬¦â€ï¼Œä»¥è‡³äºæˆ‘ä»¬éƒ½å¿˜äº†å…¶å®è¿™ä¸ªç‰¹æ€§åœ¨çœŸæ­£çš„å­—ç¬¦ä¸²å¤„ç†çš„ä»£ç é‡Œå¾ˆå°‘ç”¨åˆ°ã€‚æˆ‘ä»¬å¸Œæœ›é€šè¿‡è¿™ä¸€ç« é‡Œçš„ä¾‹å­å¯ä»¥è¯´æœå¤§å®¶ï¼Œå¯¹äºå¤§å¤šæ•°å¸¸è§„çš„æ“ä½œï¼Œç®€å•çš„æŒ‰åºéå†ä¹Ÿå®Œå…¨ OKã€‚å¼ºè¿«ä½ æ¸…æ¥šåœ°å†™å‡ºä½ æƒ³åœ¨å“ªä¸ªå±‚é¢ï¼ˆå­—ä½é›†ï¼ŒUnicode scalarï¼ŒUTF-16 ä»£ç å—ï¼ŒUTF-8 ä»£ç å—ï¼‰å¤„ç†å­—ç¬¦ä¸²æ˜¯å¦ä¸€é¡¹å®‰å…¨æªæ–½ï¼›è¯»ä½ ä»£ç çš„äººä¼šå¯¹ä½ å¿ƒå­˜æ„Ÿæ¿€çš„ã€‚</p><p>2016å¹´7æœˆï¼ŒChris Lattner è°ˆåˆ°äº† <a href="https://lists.swift.org/pipermail/swift-evolution/Week-of-Mon-20160725/025676.html" target="_blank" rel="noopener">Swift è¯­è¨€å­—ç¬¦ä¸²å¤„ç†çš„ç›®æ ‡</a>ï¼Œä»–æœ€åæ˜¯è¿™ä¹ˆè¯´çš„ï¼š</p><blockquote><p>æˆ‘ä»¬çš„ç›®æ ‡æ˜¯åœ¨å­—ç¬¦ä¸²å¤„ç†ä¸Šè¶…è¶Š Perlã€‚</p></blockquote><p>å½“ç„¶ Swift 4 è¿˜æ²¡æœ‰å®ç°è¿™ä¸ªç›®æ ‡â€”â€”å¾ˆå¤šæƒ³è¦çš„ç‰¹æ€§è¿˜æ²¡å®ç°ï¼ŒåŒ…æ‹¬æŠŠ Foundation åº“ä¸­çš„è¯¸å¤šå­—ç¬¦ä¸² API è½¬ç§»åˆ°æ ‡å‡†åº“ï¼Œæ­£åˆ™è¡¨è¾¾å¼çš„è‡ªç„¶è¯­è¨€æ”¯æŒï¼Œå­—ç¬¦ä¸²æ ¼å¼åŒ–å’Œè§£æ APIï¼Œæ›´å¼ºå¤§çš„å­—ç¬¦ä¸²æ’å…¥åŠŸèƒ½ã€‚å¥½æ¶ˆæ¯æ˜¯ Swift å›¢é˜Ÿå·²ç»è¡¨ç¤º <a href="https://github.com/apple/swift/blob/master/docs/StringManifesto.md" target="_blank" rel="noopener">ä¼šåœ¨å°†æ¥è§£å†³æ‰€æœ‰è¿™äº›é—®é¢˜</a>ã€‚</p><hr><p>å¦‚æœå–œæ¬¢æœ¬æ–‡çš„è¯ï¼Œè¯·è€ƒè™‘<a href="https://gumroad.com/a/507458675" target="_blank" rel="noopener">è´­ä¹°å…¨ä¹¦</a>ã€‚è°¢è°¢ï¼</p><p>å…¨ä¹¦ä¸­ç¬¬ä¸€å¼ æ˜¯æœ¬æ–‡çš„ä¸¤æœ¬ã€‚è®¨è®ºäº†å…¶ä»–çš„ä¸€äº›é—®é¢˜ï¼ŒåŒ…æ‹¬å¦‚ä½•ä½¿ç”¨ä»¥åŠä»€ä¹ˆæ—¶å€™ä½¿ç”¨å­—ç¬¦ä¸²çš„ä»£ç å—è§†å›¾ï¼Œå¦‚ä½•å’Œ Foundationé‡Œçš„å¤„ç†å­—ç¬¦ä¸²çš„ APIï¼ˆä¾‹å¦‚ <a href="https://developer.apple.com/documentation/foundation/nsregularexpression" target="_blank" rel="noopener"><code>NSRegularExpression</code></a> æˆ–è€… <a href="https://developer.apple.com/documentation/foundation/nsattributedstring" target="_blank" rel="noopener"><code>NSAttributedString</code></a>ï¼‰ é…åˆå¤„ç†ã€‚è´´åˆ«æ˜¯åé¢è¿™ä¸ªé—®é¢˜å¾ˆéš¾ï¼Œè€Œä¸”å¾ˆå®¹æ˜“çŠ¯é”™ã€‚é™¤æ­¤ä¹‹å¤–è¿˜è®¨è®ºäº†å…¶ä»–æ ‡å‡†åº“é‡Œé¢æœºé‡å­—ç¬¦ä¸²çš„ APIï¼Œä¾‹å¦‚æ–‡æœ¬è¾“å‡ºæµï¼ˆ<a href="https://developer.apple.com/documentation/swift/textoutputstream" target="_blank" rel="noopener"><code>TextOutputStream</code></a>ï¼‰æˆ–è‡ªå®šä¹‰å­—ç¬¦ä¸²è½¬æ¢ï¼ˆ<a href="https://developer.apple.com/documentation/swift/customstringconvertible" target="_blank" rel="noopener"><code>CustomStringConvertible</code></a>ï¼‰ã€‚</p><blockquote><p>æœ¬æ–‡ç”± SwiftGG ç¿»è¯‘ç»„ç¿»è¯‘ï¼Œå·²ç»è·å¾—ä½œè€…ç¿»è¯‘æˆæƒï¼Œæœ€æ–°æ–‡ç« è¯·è®¿é—® <a href="http://swift.gg">http://swift.gg</a>ã€‚</p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;ä½œè€…ï¼šOle Begemannï¼Œ&lt;a href=&quot;https://oleb.net/blog/2017/11/swift-4-strings&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;åŸæ–‡é“¾æ¥&lt;/a&gt;ï¼ŒåŸæ–‡æ—¥æœŸï¼š2017-11-27&lt;br&gt;è¯‘è€…ï¼š&lt;a href=&quot;https://weibo.com/u/5029986118&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;ä¸œèå¤§å”å’Œå°š&lt;/a&gt;ï¼›æ ¡å¯¹ï¼š&lt;a href=&quot;http://www.jianshu.com/users/596f2ba91ce9/latest_articles&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;pmst&lt;/a&gt;ï¼Œ&lt;a href=&quot;undefined&quot;&gt;Firecrest&lt;/a&gt;ï¼›å®šç¨¿ï¼š&lt;a href=&quot;https://github.com/chenmingbiao&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;CMB&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;!--æ­¤å¤„å¼€å§‹æ­£æ–‡--&gt;
&lt;p&gt;è¿™ä¸ªç³»åˆ—ä¸­å…¶ä»–æ–‡ç« ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&quot;https://oleb.net/blog/2014/07/swift-strings/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Swift 1 ä¸­çš„å­—ç¬¦ä¸²&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://oleb.net/blog/2016/08/swift-3-strings/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Swift 3 ä¸­çš„å­—ç¬¦ä¸²&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Swift 4 ä¸­çš„å­—ç¬¦ä¸²ï¼ˆæœ¬æ–‡ï¼‰&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;æœ¬æ–‡èŠ‚é€‰è‡ªæˆ‘ä»¬çš„æ–°ä¹¦ã€Šé«˜çº§ Swift ç¼–ç¨‹ã€‹ã€Œå­—ç¬¦ä¸²ã€è¿™ä¸€ç« ã€‚ã€Šé«˜çº§ Swift ç¼–ç¨‹ã€‹æ–°ç‰ˆæœ¬å·²æ ¹æ® Swift 4 çš„æ–°ç‰¹æ€§ä¿®è®¢è¡¥å……ï¼Œæ–°ç‰ˆç°å·²ä¸Šå¸‚ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="Ole Begemannh" scheme="https://swift.gg/categories/Ole-Begemannh/"/>
    
    
      <category term="Swift è¿›é˜¶" scheme="https://swift.gg/tags/Swift-%E8%BF%9B%E9%98%B6/"/>
    
  </entry>
  
  <entry>
    <title>å‰–æ ARM 64 æ¶æ„ä¸­çš„ objc_msgSend</title>
    <link href="https://swift.gg/2018/08/06/friday-qa-2017-06-30-dissecting-objc_msgsend-on-arm64/"/>
    <id>https://swift.gg/2018/08/06/friday-qa-2017-06-30-dissecting-objc_msgsend-on-arm64/</id>
    <published>2018-08-06T00:00:00.000Z</published>
    <updated>2018-09-10T03:53:25.085Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ä½œè€…ï¼šMike Ashï¼Œ<a href="https://www.mikeash.com/pyblog/friday-qa-2017-06-30-dissecting-objc_msgsend-on-arm64.html" target="_blank" rel="noopener">åŸæ–‡é“¾æ¥</a>ï¼ŒåŸæ–‡æ—¥æœŸï¼š2017-06-30<br>è¯‘è€…ï¼š<a href="undefined">BigNerdCoding</a>ï¼›æ ¡å¯¹ï¼š<a href="http://www.jianshu.com/users/596f2ba91ce9/latest_articles" target="_blank" rel="noopener">pmst</a>ï¼Œ<a href="http://codebuild.me/" target="_blank" rel="noopener">shanks</a>ï¼›å®šç¨¿ï¼š<a href="https://github.com/chenmingbiao" target="_blank" rel="noopener">CMB</a></p></blockquote><!--æ­¤å¤„å¼€å§‹æ­£æ–‡--><p>å¾ˆé«˜å…´ï¼Œæˆ‘åˆå›æ¥äº†ã€‚åœ¨åˆšåˆšè¿‡å»çš„ WWDC æœŸé—´ï¼Œæˆ‘åœ¨ CocoaConf Next Door åšä¸ªä¸€ä¸ªå…³äºå‰–æ ARM64 ä¸Š <code>objc_msgSend</code> è¿è¡Œæµç¨‹çš„å‘è¨€ã€‚ç°åœ¨æˆ‘å°†æ•´ç†åçš„å†…å®¹é‡æ–°å‘å¸ƒåˆ° Friday Q&amp;A ä¸Šã€‚</p><a id="more"></a><h2 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><p>æ¯ä¸ª Objective-C å¯¹è±¡éƒ½ä¼šæŒ‡å‘ä¸€ä¸ªç±»ï¼Œè€Œæ¯ä¸ªç±»åˆåŒ…å«ä¸€ä¸ªæ–¹æ³•åˆ—è¡¨ã€‚æ¯ä¸ªæ–¹æ³•åˆ™ç”±é€‰æ‹©å™¨ï¼ˆ<code>selector</code>ï¼‰ã€å‡½æ•°æŒ‡é’ˆå’Œä¸€äº›å…ƒæ•°æ®ï¼ˆ<code>metadata</code>ï¼‰æ„æˆã€‚<code>objc_msgSend</code> èŒè´£å°±æ˜¯æ¥æ”¶å¯¹è±¡ï¼ˆ<code>object</code>ï¼‰å’Œé€‰æ‹©å™¨ï¼ˆ<code>selector</code>ï¼‰ï¼Œæ ¹æ®é€‰æ‹©å™¨åç§°æ‰¾åˆ°å¯¹åº”æ–¹æ³•çš„å‡½æ•°æŒ‡é’ˆå¹¶è·³è½¬æ‰§è¡Œè¯¥å‡½æ•°ã€‚</p><p>æŸ¥æ‰¾è¿‡ç¨‹ç›¸å¯¹æ¥è¯´è¿˜æ˜¯æ¯”è¾ƒå¤æ‚çš„ã€‚è‹¥æŸä¸ªæ–¹æ³•åœ¨å½“å‰ç±»ä¸­æœªæ‰¾åˆ°ï¼Œå°±éœ€è¦æ²¿ç€ç»§æ‰¿é“¾ç»§ç»­åœ¨çˆ¶ç±»ä¸­æŸ¥æ‰¾ã€‚å¦‚æœåœ¨çˆ¶ç±»ä¸­ä¹ŸæœªæŸ¥è¯¢åˆ°çš„è¯ï¼Œåˆ™ä¼šè§¦å‘ runtime æœºåˆ¶ä¸­çš„æ¶ˆæ¯è½¬å‘æœºåˆ¶ã€‚ä»»ä½•å¯¹è±¡åœ¨æ¥æ”¶åˆ°ç¬¬ä¸€æ¡æ¶ˆæ¯åéƒ½ä¼šè§¦å‘ç±»æ–¹æ³• <code>+initialize</code> ã€‚</p><p>å› ä¸ºæ¯æ¬¡æ–¹æ³•è°ƒç”¨éƒ½ä¼šè§¦å‘ä¸Šè¿°æµç¨‹ï¼Œæ‰€ä»¥åœ¨å¸¸è§åœºæ™¯ä¸‹çš„æŸ¥æ‰¾é€Ÿåº¦å¿…é¡»éå¸¸å¿«ã€‚æ˜¾ç„¶è¿™ä¸å¤æ‚çš„æ“ä½œè¿‡ç¨‹ä¹‹é—´å­˜åœ¨ä¸€å®šå†²çªã€‚</p><p>ä¸ºäº†è§£å†³è¿™å¯¹çŸ›ç›¾æé«˜æŸ¥è¯¢é€Ÿåº¦ï¼ŒObjective-C é‡‡ç”¨äº†æ–¹æ³•ç¼“å­˜ç­–ç•¥ã€‚æ¯ä¸ªç±»éƒ½ä¼šä½¿ç”¨å“ˆå¸Œè¡¨å°†å…¶æ–¹æ³•æŒ‰ç…§ Selector - IMPsï¼ˆå‡½æ•°æŒ‡é’ˆï¼‰ é”®å€¼å¯¹å…³ç³»ç¼“å­˜èµ·æ¥ã€‚è¿™æ ·åœ¨æŸ¥è¯¢æ–¹æ³•æ—¶ï¼Œruntime é¦–å…ˆä¼šç›´æ¥å»å“ˆå¸Œè¡¨ä¸­æŸ¥è¯¢ã€‚å¦‚æœå“ˆå¸Œè¡¨ä¸­ä¸å­˜åœ¨çš„è¯åˆ™è½¬è€Œæ‰§è¡ŒåŸæœ‰å¤æ‚ã€ç¼“æ…¢çš„å¤„ç†æµç¨‹ï¼Œå¹¶å°†æœ€ç»ˆç»“æœç¼“å­˜èµ·æ¥å·²å¤‡ä¸‹æ¬¡ä½¿ç”¨ã€‚</p><p><code>objc_msgSend</code> ç”¨æ±‡ç¼–è¯­è¨€è¿›è¡Œå®ç°ï¼Œå…·ä½“ç†ç”±æœ‰ä¸¤ä¸ªï¼šé¦–å…ˆçº¯ C è¯­è¨€æ— æ³•å®ç°è¿™ä¹ˆä¸€ä¸ªå‡½æ•°ï¼šæ¥æ”¶ä¸å®šä¸ªæ•°ä¸”æœªçŸ¥ç±»å‹çš„å‚æ•°ä½œä¸ºå…¥å‚è·³è½¬è‡³ä»»æ„å‡½æ•°æŒ‡é’ˆï¼ˆå³è°ƒç”¨å®ç°ï¼‰ï¼›å…¶æ¬¡ï¼Œæ‰§è¡Œé€Ÿåº¦å¯¹ <code>objc_msgSend</code> æ¥è¯´éå¸¸é‡è¦ï¼Œæ±‡ç¼–è¯­è¨€èƒ½æœ€å¤§åŒ–æå‡è¯¥é¡¹æŒ‡æ ‡ã€‚</p><p>å½“ç„¶ï¼Œä½¿ç”¨æ±‡ç¼–è¯­è¨€å®ç°æ•´ä¸ªå¤æ‚çš„æ¶ˆæ¯å¤„ç†è¿‡ç¨‹æ˜¯ä¸ç°å®çš„ï¼Œè€Œä¸”ä¹Ÿæ²¡è¿™ç§å¿…è¦ã€‚å› ä¸ºæœ‰äº›æµç¨‹ä¸€æ—¦è§¦å‘ç¨‹åºéƒ½ä¼šå˜æ…¢ï¼Œæ— è®ºé‡‡ç”¨ä½•ç§è¯­è¨€å±‚é¢çš„å®ç°ã€‚æ•´ä¸ªæ¶ˆæ¯å¤„ç†æµç¨‹ä»£ç å¯ä»¥åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†ï¼šé€šè¿‡æ±‡ç¼–ä»£ç å®ç°çš„å¿«é€Ÿè·¯å¾„éƒ¨åˆ†ï¼ˆfast pathï¼‰ ï¼ŒC è¯­è¨€å®ç°çš„æ…¢è·¯å¾„æµç¨‹ï¼ˆslow pathï¼‰ã€‚å…¶ä¸­æ±‡ç¼–ä»£ç å¯¹åº”ç¼“å­˜è¡¨ä¸­æŸ¥è¯¢æ–¹æ³•éƒ¨åˆ†å¹¶ä¸”æœªå‘½ä¸­æ—¶è·³è½¬ C ä»£ç æ¥è¿›è¡Œä¸‹ä¸€æ­¥å¤„ç†ã€‚</p><p>å› æ­¤ï¼Œ<code>objc_msgSend</code> ä»£ç å¤„ç†æµç¨‹å¤§è‡´å¦‚ä¸‹ï¼š</p><ol><li>è·å–æ¶ˆæ¯å¯¹è±¡æ‰€å¯¹åº”çš„ç±»ä¿¡æ¯</li><li>è·å–ç±»æ‰€å¯¹åº”çš„æ–¹æ³•ç¼“å­˜</li><li>åœ¨æ–¹æ³•ç¼“å­˜ä¸­æŸ¥è¯¢ <em>selector</em> å¯¹è±¡çš„å‡½æ•°å®ç°</li><li>å¦‚æœæŸ¥è¯¢å¤±è´¥åˆ™è°ƒç”¨ C ä»£ç è¿›è¡Œä¸‹ä¸€æ­¥å¤„ç†</li><li>è·³è½¬åˆ° IMP æ‰€æŒ‡çš„å‡½æ•°å®ç°</li></ol><p>ä¸‹é¢å¼€å§‹åˆ†æå…¶å…·ä½“å®ç°ã€‚</p><h2 id="æ‰§è¡Œè¿‡ç¨‹çš„æŒ‡ä»¤"><a href="#æ‰§è¡Œè¿‡ç¨‹çš„æŒ‡ä»¤" class="headerlink" title="æ‰§è¡Œè¿‡ç¨‹çš„æŒ‡ä»¤"></a>æ‰§è¡Œè¿‡ç¨‹çš„æŒ‡ä»¤</h2><p><em>objc_msgSend</em> åœ¨ä¸åŒæƒ…å½¢ä¸‹æ‰§è¡Œè·¯å¾„ä¸å°½ç›¸åŒã€‚å¯¹äºå‘ <code>nil</code> å‘é€æ¶ˆæ¯ï¼Œæ ‡è®°æŒ‡é’ˆï¼ˆtagged pointersï¼‰ï¼Œå“ˆå¸Œè¡¨å†²çªä¼šç›¸åº”ç‰¹æ®Šä»£ç ä¸­è¿›è¡Œå¤„ç†ã€‚ä¸‹é¢æˆ‘å°†é€šè¿‡æœ€å¸¸è§ä¹Ÿæ˜¯æœ€ç®€å•çš„æƒ…å½¢æ¥è§£é‡Š <code>objc_msgSend</code>  çš„æ‰§è¡Œï¼Œå³å¤„ç† non-nilã€non-tagged æ¶ˆæ¯å¹¶ä¸”å“ˆå¸Œè¡¨ä¹Ÿèƒ½å‘½ä¸­è¯¥æ–¹æ³•ã€‚æˆ‘ä¼šåœ¨è¯¥è¿‡ç¨‹ä¸­æ ‡è®°å‡ºé‚£äº›éœ€è¦æ³¨æ„çš„å¤„ç†è·¯å¾„<em>å²”è·¯å£</em>ï¼Œç„¶åå›è¿‡å¤´æ¥è¿›è¡Œè¯¦ç»†è®²è§£ã€‚</p><p>æˆ‘å°†åˆ—å‡ºå•æ¡æˆ–ä¸€ç»„æŒ‡ä»¤ï¼Œç„¶ååœ¨ä¸‹é¢ç´§æ¥ç›¸å…³è§£é‡Šå†…å®¹ã€‚</p><p>æ¯æ¡æŒ‡ä»¤å‰é¢éƒ½ä¼šæœ‰ä¸€ä¸ªåœ°å€åç§»é‡ï¼Œå¯ä»¥å°†å…¶çœ‹ä½œä¸€ä¸ªæŒ‡ç¤ºè·³è½¬ä½ç½®çš„æ ‡è®°é‡ã€‚</p><p>ARM64 æ¶æ„ä¸­åŒ…å« 31 ä¸ª 64 ä½æ•´å‹å¯„å­˜å™¨ï¼Œå¯¹åº”ç¬¦å·è¡¨ç¤ºä¸º x0 - x30 ã€‚æ¯ä¸ªå¯„å­˜å™¨çš„ä½ 32 ä½ä¹Ÿå¯ä»¥é€šè¿‡ w0 åˆ° w30 è¿›è¡Œè®¿é—®ï¼Œå°±åƒå®ƒä¹Ÿæ˜¯ä¸€ä¸ªå•ç‹¬çš„å¯„å­˜å™¨ã€‚å…¶ä¸­ x0 åˆ° x7 è¢«ç”¨æ¥ä¿å­˜å‡½æ•°è°ƒç”¨æ—¶çš„å‰ 8 ä¸ªå‚æ•°ã€‚è¿™æ„å‘³ç€ <code>objc_msgSend</code> å‡½æ•°ä¸­çš„ <code>self</code> å‚æ•°ä¿å­˜åœ¨ x0 è€Œ <code>_cmd</code> ä¿å­˜åœ¨ x1 ã€‚</p><p>èµ·å§‹æŒ‡ä»¤å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">0x0000 cmp     x0, #0x0</span><br><span class="line">0x0004 b.le    0x6c</span><br></pre></td></tr></table></figure><p>è¯¥æ®µæŒ‡ä»¤æ˜¯å°† <code>self</code> ä¸ 0 è¿›è¡Œæœ‰ç¬¦å·æ¯”è¾ƒï¼Œå¦‚æœ <code>self</code> ä¸å¤§äº 0 çš„è¯åˆ™ä¼šè¿›è¡Œè·³è½¬å¤„ç†ã€‚ç­‰äº 0 å…¶å®å°±ç›¸å½“äº <code>nil</code> å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯è¯´æ­¤æ—¶ä¼šè°ƒç”¨å‘ <em>nil</em> å‘é€æ¶ˆæ¯æƒ…å½¢ä¸‹å¯¹åº”çš„ç‰¹å®šä»£ç ã€‚å¦å¤–ï¼Œè¯¥æŒ‡ä»¤ä¹Ÿè¢«ç”¨äºæ ‡è®°æŒ‡é’ˆï¼ˆ<code>tagged pointers</code>ï¼‰çš„å¤„ç†ã€‚ARM64 é€šè¿‡è®¾ç½®æœ€é«˜ä½ä¸º 1 æ¥æ ‡è®° Tagged Pointersï¼ˆx86-64 åˆ™æ˜¯æœ€ä½ä½ï¼‰ï¼Œæ­¤æ—¶å¯¹åº”æœ‰ç¬¦å·æ•°æ¯”ä¸ºè´Ÿã€‚å¯¹äºæ™®é€šæŒ‡é’ˆæ¥è¯´ï¼Œä¸Šè¿°å¤„ç†åˆ†æ”¯éƒ½ä¼šä¸è¢«è§¦å‘ã€‚</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">0x0008 ldr    x13, [x0]</span><br></pre></td></tr></table></figure><p>è¯¥æŒ‡ä»¤å°† x0 ä¸­æ‰€è¡¨ç¤ºçš„ <em>self</em> çš„ isa åœ°å€åŠ è½½åˆ° x13 å¯„å­˜å™¨ä¸­ã€‚</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">0x000c and    x16, x13, #0xffffffff8</span><br></pre></td></tr></table></figure><p>å› ä¸º ARM64 æ¶æ„ä¸‹èƒ½å¤Ÿä½¿ç”¨ <a href="(http://www.sealiesoftware.com/blog/archive/2013/09/24/objc_explain_Non-pointer_isa.html)[http://www.sealiesoftware.com/blog/archive/2013/09/24/objc_explain_Non-pointer_isa.html]"><code>non-pointer isas</code></a> æŠ€æœ¯ï¼Œæ‰€ä»¥ä¸ä¹‹å‰ç›¸æ¯” isa å­—æ®µä¸ä»…å¯ä»¥åŒ…å«æŒ‡å‘ Class çš„ä¿¡æ¯ï¼Œå®ƒè¿˜èƒ½åˆ©ç”¨å¤šä½™æ¯”ç‰¹ä½å­˜å‚¨å…¶å®ƒæœ‰æ•ˆä¿¡æ¯ï¼ˆä¾‹å¦‚ï¼Œå¼•ç”¨è®¡æ•°ï¼‰ã€‚è¿™é‡Œé€šè¿‡ AND é€»è¾‘è¿ç®—å»é™¤ä½ä½çš„å†—ä½™ä¿¡æ¯å¾—åˆ°æœ€ç»ˆçš„ Class çš„åœ°å€å¹¶å°†å…¶å­˜å…¥ x13 å¯„å­˜å™¨ä¸­ã€‚</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">0x0010 ldp    x10, x11, [x16, #0x10]</span><br></pre></td></tr></table></figure><p>è¿™æ˜¯æ•´ä¸ª <code>objc_msgSend</code> å¤„ç†æµç¨‹ä¸­æˆ‘æœ€å–œæ¬¢çš„æŒ‡ä»¤ã€‚è¯¥æŒ‡ä»¤ä¼šå°† Class ä¸­çš„æ–¹æ³•ç¼“å­˜å“ˆå¸Œè¡¨åŠ è½½åˆ° x10 å’Œ x11 ä¸¤ä¸ªå¯„å­˜å™¨ä¸­ã€‚<code>ldp</code> æŒ‡ä»¤ä¼šå°†æœ‰æ•ˆçš„å†…å­˜ä¿¡æ¯åŠ è½½åˆ°è¯¥æŒ‡ä»¤çš„å‰ä¸¤ä¸ªå¯„å­˜å™¨ä¸­ï¼Œè€Œç¬¬ä¸‰ä¸ªå‚æ•°åˆ™å¯¹åº”è¯¥ä¿¡æ¯çš„å†…å­˜åœ°å€ã€‚åœ¨è¯¥ä¾‹ä¸­ç¼“å­˜å“ˆå¸Œè¡¨åœ°å€ä¸º x16 å¯„å­˜å™¨ä¸­åœ°å€åç§» 16 åæ‰€å¤„ä½ç½®ã€‚ç¼“å­˜å¯¹è±¡æ•°æ®ç»“æ„ç±»ä¼¼äºï¼š</p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">uint32_t</span> <span class="keyword">mask_t</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">cache_t</span> &#123;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">bucket_t</span> *_<span class="title">buckets</span>;</span></span><br><span class="line">    <span class="keyword">mask_t</span> _mask;</span><br><span class="line">    <span class="keyword">mask_t</span> _occupied;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ä¸Šè¿° <code>ldp</code> æŒ‡ä»¤ä¸­ï¼Œx10 ä¸­ä¿å­˜äº† <code>_buckets</code> å€¼ï¼Œè€Œ x11 å¯„å­˜å™¨çš„é«˜ 32 ä½ä¿å­˜çš„æ˜¯ <code>_occupied</code> ä½ 32 ä½åˆ™ä¿å­˜äº† <code>_mask</code> ã€‚</p><p><code>_occupied</code> è¡¨ç¤ºå“ˆå¸Œè¡¨ä¸­çš„å…ƒç´ çš„æ•°é‡ï¼Œåœ¨ <code>objc_msgSend</code> å¤„ç†è¿‡ç¨‹ä¸­æ²¡æœ‰å¤ªå¤§çš„ä½œç”¨ã€‚è€Œ <code>_mask</code> åˆ™ç›¸å¯¹é‡è¦ï¼šå®ƒå°†å“ˆå¸Œè¡¨å¤§å°æè¿°ä¸ºäº†ä¸€ä¸ªä¾¿äºè¿›è¡Œä¸æ“ä½œçš„æ©ç ã€‚<code>_mask</code> å€¼ä¸º 2^n - 1 ï¼Œæ¢å¥è¯è¯´å®ƒçš„äºŒè¿›åˆ¶è¡¨ç¤ºå°†ä»¥ä¸€ç»„ 1 ä½œä¸ºç»“å°¾ï¼Œå½¢å¦‚ 000000001111111 ã€‚è¯¥å€¼ä¸ºæŸ¥è¯¢ selector çš„å“ˆå¸Œè¡¨ç´¢å¼•ä»¥åŠæ ‡è®°è¡¨å°¾çš„å¿…è¦æ¡ä»¶ã€‚</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">0x0014 and    w12, w1, w11</span><br></pre></td></tr></table></figure><p>è¯¥æŒ‡ä»¤ç”¨äºè®¡ç®— <code>_cmd</code> æ‰€ä¼ é€’è¿‡æ¥çš„ <code>selector</code> åœ¨å“ˆå¸Œè¡¨ä¸­çš„èµ·å§‹ä½ç½®ã€‚å› ä¸º <code>_cmd</code> ä¿å­˜åœ¨ x1 å¯„å­˜å™¨ä¸­ï¼Œæ‰€ä»¥ w1 å¯„å­˜å™¨åˆ™åŒ…å«äº† <code>_cmd</code> çš„ä½ 32 ä½ä¿¡æ¯ã€‚è€Œ w11 å¯„å­˜å™¨ä¿å­˜äº†ä¸Šé¢æåˆ°çš„ <code>_mask</code> ä¿¡æ¯ã€‚é€šè¿‡ AND æŒ‡ä»¤æˆ‘ä»¬å°†è¿™ä¸¤ä¸ªå¯„å­˜å™¨ä¸­æ•°å€¼<em>ä¸æ“ä½œ</em>ç»“æœä¿å­˜åˆ° w12 å¯„å­˜å™¨ä¸­ã€‚è®¡ç®—ç»“æœç›¸å½“äº <code>_cmd % table_size</code>  ï¼Œä½†æ˜¯å®ƒå´é¿å…äº†æ¨¡æ“ä½œçš„æ˜‚è´µå¼€é”€ã€‚</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">0x0018 add    x12, x10, x12, lsl #4</span><br></pre></td></tr></table></figure><p>ä»…ä»…å¾—åˆ°ç´¢å¼•æ˜¯ä¸å¤Ÿï¼Œä¸ºäº†ä»è¡¨ä¸­åŠ è½½æ•°æ®ï¼Œæˆ‘ä»¬éœ€è¦å¾—åˆ°æœ€ç»ˆçš„å®é™…åœ°å€ã€‚è€Œè¿™æ­£æ˜¯è¯¥æŒ‡ä»¤çš„ç›®çš„ã€‚å› ä¸ºå“ˆå¸Œè¡¨çš„ bucket éƒ½æ˜¯ 16 ä¸ªæ¯”ç‰¹ä½ï¼Œæ‰€ä»¥è¿™é‡Œå…ˆå¯¹ x12 å¯„å­˜å™¨ä¸­çš„ç´¢å¼•å€¼å·¦ç§» 4 ä½ä¹Ÿå°±æ˜¯ä¹˜ä»¥ 16 ï¼Œç„¶åå†å°†å…¶ä¸è¡¨é¦–åœ°å€ç›¸åŠ åçš„ç¡®åˆ‡ bucket åœ°å€ä¿¡æ¯ä¿å­˜åˆ° x12 ä¸­ã€‚</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">0x001c ldp    x9, x17, [x12]</span><br></pre></td></tr></table></figure><p>å†ä¸€æ¬¡é€šè¿‡ <code>ldp</code> æŒ‡ä»¤ï¼Œå°†ä¸Šä¸€æ­¥ä¿å­˜åœ¨ x12 å¯„å­˜å™¨ä¸­ bucket å¯¹åº”çš„ä¿¡æ¯åŠ è½½åˆ° x9 å’Œ x17 å¯„å­˜å™¨ä¸­ã€‚å› ä¸º bucket ç”± selector å’Œ IMP ä¸¤éƒ¨åˆ†æ„æˆï¼Œæ‰€ä»¥ x9 å¯¹åº”ä¿å­˜äº† selector ä¿¡æ¯è€Œ x17 åˆ™ä¿å­˜äº† IMP ä¿¡æ¯ã€‚</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">0x0020 cmp    x9, x1</span><br><span class="line">0x0024 b.ne   0x2c</span><br></pre></td></tr></table></figure><p>è¯¥æ®µæŒ‡ä»¤ä¼šå°† x9 å¯„å­˜å™¨ä¸­çš„å†…å®¹å’Œ x1 ä¸­çš„ <code>_cmd</code> è¿›è¡Œå¯¹æ¯”ï¼Œå¦‚æœå®ƒä»¬ä¸ç­‰åˆ™æ„å‘³ç€ bucket ä¸­ä¸åŒ…å«æˆ‘ä»¬æ‰€æ“ä½œçš„ selector ï¼Œå¹¶ä¸”åœ¨æ­¤æ—¶è·³è½¬åˆ° 0x2c å¤„æ‰§è¡Œå¯¹åº”çš„æœªåŒ¹é…å¤„ç†ã€‚å¦‚æœç›¸åŒçš„è¯åˆ™è¡¨ç¤ºå‘½ä¸­ï¼Œç»§ç»­æ‰§è¡Œä¸‹ä¸€æ¡æŒ‡ä»¤ã€‚</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">0x0028 br    x17</span><br></pre></td></tr></table></figure><p>è¯¥æŒ‡ä»¤ä¸ºæ— æ¡ä»¶è·³è½¬åˆ° x17 å¯„å­˜å™¨æ‰€æŒ‡ä½ç½®ï¼Œä¹Ÿå°±æ˜¯è·³è½¬åˆ° IMP æ‰€æŒ‡å¤„æ‰§è¡Œå…·ä½“å®ç°ä»£ç ã€‚æ­¤æ—¶ <code>objc_msgSend</code> å¤„ç†æµç¨‹ä¸­æœ€å¿«çš„è·¯å¾„å·²ç»ç»“æŸã€‚å…¶ä½™å‚æ•°æ‰€åšå¯„å­˜å™¨éƒ½æ²¡æœ‰è¢«å¹²æ‰°ï¼Œç›®æ ‡æ–¹æ³•ä¼šæ¥å—ä¼ å…¥çš„å…¨éƒ¨å‚æ•°ï¼Œä¸€åˆ‡è¡Œå¦‚ç›´æ¥è°ƒç”¨ç›®æ ‡å‡½æ•°ã€‚</p><p>åœ¨æœ€ç†æƒ³çš„æƒ…å½¢ä¸‹ï¼Œ<code>objc_msgSend</code> å¤„ç†æµç¨‹æœ€å¿«å¯ä»¥åœ¨ 3 çº³ç§’å†…æ‰§è¡Œå®Œæ¯•ã€‚</p><p>åœ¨ä»‹ç»å®Œç†æƒ³çš„æœ€å¿«æƒ…å½¢åï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦å…³æ³¨å…¶ä½™å‡ ç§æƒ…å½¢ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹å½“æ–¹æ³•æœªç¼“å­˜æ—¶çš„å¤„ç†ã€‚</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">0x002c cbz    x9, __objc_msgSend_uncached</span><br></pre></td></tr></table></figure><p>å‰é¢æåˆ° x9 å¯„å­˜å™¨åŒ…å«äº†åŠ è½½åçš„ selector ä¿¡æ¯ã€‚å°†å¯„å­˜å™¨ä¸­çš„ä¿¡æ¯ä¸é›¶è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœç­‰äº 0 çš„è¯å°±è·³è½¬åˆ° <code>__objc_msgSend_uncached</code> ä»£ç å¤„ã€‚å› ä¸ºç­‰äº 0 å°±æ„å‘³ç€ bucket ä¸ºç©ºä¹Ÿå°±æ˜¯è¯´æ–¹æ³•æŸ¥è¯¢å¤±è´¥ï¼Œselector å¯¹åº”çš„æ–¹æ³•æ²¡æœ‰è¢«ç¼“å­˜åˆ°å“ˆå¸Œè¡¨ä¸­ã€‚æ­¤æ—¶æˆ‘ä»¬éœ€è¦è°ƒç”¨ C è¯­è¨€ä»£ç è¿›è¡Œæ›´ä¸ºå¤æ‚çš„å¤„ç†ï¼Œä¹Ÿå°±æ˜¯ <code>__objc_msgSend_uncached</code> ã€‚å¦‚æœä»…ä»…åªæ˜¯æ–¹æ³•ä¸åŒ¹é…ä¸” bucket ä¸ä¸ºç©ºçš„è¯ï¼Œåˆ™éœ€è¦ç»§ç»­è¿›è¡Œæ–¹æ³•æŸ¥æ‰¾ã€‚</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">0x0030 cmp    x12, x10</span><br><span class="line">0x0034 b.eq   0x40</span><br></pre></td></tr></table></figure><p>è¯¥æŒ‡ä»¤å°† x12 å¯„å­˜å™¨ä¸­çš„å½“å‰ bucket åœ°å€ä¸ x10 å¯„å­˜å™¨ä¸­çš„å“ˆå¸Œè¡¨é¦–åœ°å€è¿›è¡Œæ¯”è¾ƒã€‚å¦‚æœä¸¤è€…å†…å®¹åŒ¹é…ä¸Šäº†ï¼Œåˆ™æˆ‘ä»¬ä»å“ˆå¸Œè¡¨çš„æœ«å°¾è¿›è¡Œåå‘æŸ¥è¯¢ã€‚è™½ç„¶æˆ‘è¿˜æ²¡å¼„æ˜ç™½æ­¤æ—¶ä¸ºä»€ä¹ˆæ²¡æœ‰é‡‡ç”¨å¸¸è§çš„æ­£å‘éå†æŸ¥è¯¢ï¼Œä½†æ˜¯æœ‰ç†ç”±è®¤ä¸ºå¯èƒ½è¿™æ ·é€Ÿåº¦æ›´å¿«ã€‚</p><p>0x40 è¡¨ç¤ºåŒ¹é…åè·³è½¬ç›®çš„åœ°å€ã€‚å¦‚æœä¸¤è€…ä¸åŒ¹é…åˆ™ç»§ç»­æ‰§è¡Œä¸‹é¢çš„æŒ‡ä»¤ã€‚</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">0x0038 ldp    x9, x17, [x12, #-0x10]!</span><br></pre></td></tr></table></figure><p>å†ä¸€æ¬¡ä»£ç é€šè¿‡ ldp æŒ‡ä»¤åŠ è½½ç¼“å­˜ä¿¡æ¯ï¼Œåªä¸è¿‡åœ°å€ä¸ºè·å½“å‰ bucket  åç§» -0x10 æ‰€æŒ‡ä½ç½®ã€‚è¯¥æŒ‡ä»¤ä¸­çš„ ï¼ç¬¦å·è¡¨ç¤ºå¯„å­˜å™¨å›å†™æ“ä½œï¼Œä¹Ÿå°±æ˜¯è¯´ä¼šä½¿ç”¨è®¡ç®—åçš„ç»“æœæ›´æ–° x12 å¯„å­˜å™¨ã€‚å°†å…¶ç”¨æ•°å­¦æ–¹å¼è¡¨ç¤ºå°±æ˜¯ï¼šx12 -= 16ï¼Œå°† x12 ä¸­è¡¨ç¤ºçš„åœ°å€å‰ç§» 16 ä¸ªå•ä½ã€‚</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">0x003c b      0x20</span><br></pre></td></tr></table></figure><p>åŠ è½½æ–°çš„ bucket ä¿¡æ¯åï¼Œä»£ç é‡æ–°è·³è½¬åˆ° 0x20 å¤„å¾ªç¯æŸ¥è¯¢è¿‡ç¨‹ï¼Œç›´åˆ°å‡ºç°ä¸‹åˆ—æƒ…å½¢ï¼šæ‰¾åˆ°åŒ¹é…é¡¹ï¼Œbucket ä¸ºç©ºï¼Œå†æ¬¡å›åˆ°äº†å“ˆå¸Œè¡¨çš„èµ·å§‹å¤„ã€‚</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">0x0040 add    x12, x12, w11, uxtw #4</span><br></pre></td></tr></table></figure><p>å½“æŸ¥è¯¢åˆ°åŒ¹é…æƒ³åä¼šè§¦å‘è¯¥æŒ‡ä»¤ã€‚æ­¤æ—¶ x12 å¯„å­˜å™¨ä¸ºæœ€æ–°çš„ bucket åœ°å€ï¼Œè€Œ w11 ä¿å­˜äº†åŒ…å«å“ˆå¸Œè¡¨å¤§å°çš„æ©ç å€¼ã€‚è¯¥æŒ‡ä»¤å°† w11 å·¦ç§» 4 ä½åå°†ä¸¤ä¸ªå€¼è¿›è¡Œå åŠ å¾—åˆ°å“ˆå¸Œè¡¨å°¾åœ°å€ï¼Œå¹¶å°†ç»“æœä¿å­˜åˆ° x12 å¯„å­˜å™¨ä¸­ï¼Œç„¶åæ¥ç€æ¢å¤æŸ¥è¯¢æ“ä½œã€‚</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">0x0044 ldp    x9, x17, [x12]</span><br></pre></td></tr></table></figure><p>è¯¥æŒ‡ä»¤ä¸ºåŠ è½½æ–° bucket ä¿¡æ¯åˆ° x9ï¼Œx17 å¯„å­˜å™¨ä¸­ã€‚</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">0x0048 cmp    x9, x1</span><br><span class="line">0x004c b.ne   0x54</span><br><span class="line">0x0050 br     x17</span><br></pre></td></tr></table></figure><p>è¯¥æ®µæŒ‡ä»¤ä¸å‰é¢çš„ 0x0020 å¤„çš„åŠŸèƒ½ä¸€è‡´ï¼Œåªè¦å¯„å­˜å™¨å†…å®¹åŒ¹é…ä¸Šäº†å°±è·³è½¬åˆ°å¯¹åº” IMP ä½ç½®æ‰§è¡Œä»£ç ã€‚</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">0x0054 cbz    x9, __objc_msgSend_uncached</span><br></pre></td></tr></table></figure><p>åŒæ ·çš„ï¼Œè‹¥ä¸åŒ¹é…åˆ™æ‰§è¡Œä¸å‰é¢ 0x002c ä¸€æ ·çš„å¤„ç†æµç¨‹ã€‚</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">0x0058 cmp    x12, x10</span><br><span class="line">0x005c b.eq   0x68</span><br></pre></td></tr></table></figure><p>è¯¥æŒ‡ä»¤ä¸ 0x0030 å¤„ä¸€è‡´ï¼Œåªä¸è¿‡å¦‚æœæ­¤æ—¶ x12 å¯„å­˜å™¨å†…å®¹ä¾æ—§æ˜¯å“ˆå¸Œè¡¨é¦–åœ°å€çš„è¯ç¨‹åºä¼šè·³è½¬åˆ° 0x68 å¤„è¿›è¡Œå¤„ç†ã€‚</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">0x0068 b      __objc_msgSend_uncached</span><br></pre></td></tr></table></figure><p>è¿™ç§æƒ…å†µä¸€èˆ¬ä¸å¤ªå®¹æ˜“å‘ç”Ÿï¼Œå› ä¸ºå®ƒä¼šå¯¼è‡´å“ˆå¸Œè¡¨æŒç»­è†¨èƒ€ã€‚æ­¤æ—¶å“ˆå¸Œè¡¨çš„æŸ¥è¯¢æ•ˆç‡ä¼šä¸‹é™è€Œå»æ½œåœ¨å“ˆå¸Œç¢°æ’çš„å¯èƒ½æ€§ä¼šå˜é«˜ã€‚</p><p>è‡³äºåŸå› ï¼Œæºç ä¸­çš„æ³¨é‡Šæ˜¯è¿™äº›å†™çš„ï¼š</p><blockquote><p>Clone scanning loop to miss instead of hang when cache is corrupt. The slow path may detect any corruption and halt later.<br>å½“ç¼“å­˜æŸåæ—¶ï¼Œéœ€è¦è·³å‡ºä¸Šé¢çš„å¾ªç¯æŸ¥è¯¢æµç¨‹è€Œä¸æ˜¯è¿›å…¥æŒ‚èµ·çŠ¶æ€ã€‚ è½¬è€Œæ‰§è¡Œæ…¢é€Ÿè·¯å¾„æµç¨‹å»æ£€æµ‹ä»»ä½•å¯èƒ½çš„æŸåå¹¶ç»ˆæ­¢ä»£ç æ‰§è¡Œã€‚</p></blockquote><p>æˆ‘æ€€ç–‘è¿™ç§æƒ…å†µå¾ˆå¸¸è§ï¼Œä½†å¾ˆæ˜¾ç„¶è‹¹æœå…¬å¸çš„å‘˜å·¥å·²ç»çœ‹åˆ°å†…å­˜æŸåä¼šè®©å“ˆå¸Œè¡¨å……æ»¡æ— æ•ˆå†…å®¹æ‰€ä»¥åœ¨æ­¤å¤„è·³è½¬åˆ° C ä»£ç ä¸­è¿›è¡Œé”™è¯¯è¯Šæ–­ã€‚</p><p>æ­¤é¡¹æ£€æŸ¥çš„å­˜åœ¨åº”è¯¥å°†å¯¹æœªæŸåçš„ç¼“å­˜çš„å½±å“é™ä½åˆ°æœ€å°ã€‚å»é™¤è¯¥æ£€æŸ¥ï¼ŒåŸæ¥çš„å¾ªç¯å¤„ç†æµç¨‹å¯ä»¥è¢«é‡ç”¨ï¼Œè¿™ä¼šèŠ‚çœä¸€ç‚¹æŒ‡ä»¤ç¼“å­˜ç©ºé—´ã€‚ æ— è®ºå¦‚ä½•ï¼Œè¯¥å¤„ç†ç¨‹åºå™¨å¹¶ä¸æ˜¯å¸¸è§çš„æƒ…å†µã€‚ åªä¼šåœ¨å“ˆå¸Œè¡¨çš„å¼€å§‹ä½ç½®æŸ¥è¯¢åˆ°æ‰€éœ€çš„é€‰æ‹©å­æˆ–è€…å‘ç”Ÿäº†å“ˆå¸Œç¢°æ’æ—¶æ‰ä¼šè¢«è°ƒç”¨ã€‚</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">0x0060 ldp    x9, x17, [x12, #-0x10]!</span><br><span class="line">0x0064 b      0x48</span><br></pre></td></tr></table></figure><p>è¯¥æ®µæŒ‡ä»¤ä¸ä¹‹å‰åŠŸèƒ½ä¸€è‡´ï¼ŒåŠ è½½æ–° bucket ä¿¡æ¯åˆ° x9ï¼Œx17 å¯„å­˜å™¨ä¸­ã€‚æ›´æ–° x12 ä¸­çš„åœ°å€ï¼Œå¹¶è·³è½¬åˆ° 0x48 å¤„é‡å¤æŸ¥æ‰¾æµç¨‹ã€‚</p><p>objc_msgSend çš„ä¸»è¦å¤„ç†æµç¨‹åˆ°æ­¤å‘Šä¸€æ®µè½ï¼Œå‰©ä¸‹ Tagged Pointer å’Œ <code>nil</code> ä¸¤ä¸ªç‰¹æ®Šæƒ…å½¢çš„å¤„ç†ã€‚</p><h2 id="æ ‡è®°æŒ‡é’ˆçš„å¤„ç†"><a href="#æ ‡è®°æŒ‡é’ˆçš„å¤„ç†" class="headerlink" title="æ ‡è®°æŒ‡é’ˆçš„å¤„ç†"></a>æ ‡è®°æŒ‡é’ˆçš„å¤„ç†</h2><p>æˆ‘ä»¬å›åˆ°ç¬¬ä¸€ç»„æ±‡ç¼–æŒ‡ä»¤çš„è·³è½¬å¤„æ¥è®²è§£æ ‡è®°æŒ‡é’ˆï¼ˆ<code>Tagged Pointer</code>ï¼‰çš„å¤„ç†ã€‚</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">0x006c b.eq    0xa4</span><br></pre></td></tr></table></figure><p>å½“å‚æ•° <em>self</em> ä¸å¤§äº 0 æ—¶ï¼Œè¯¥æŒ‡ä»¤å°±ä¼šè¢«è§¦å‘ã€‚å…¶ä¸­å°äº 0 å¯¹åº”æ ‡è®°æŒ‡é’ˆï¼Œè€Œç­‰äºé›¶åˆ™å¯¹åº” <code>nil</code> ã€‚è¿™ä¸¤ç§æƒ…å½¢æœ‰å„è‡ªçš„å¤„ç†æµç¨‹ï¼Œæ‰€ä»¥ç¬¬ä¸€æ­¥å°±æ˜¯è¦åŒºåˆ†å‡ºåˆ°åº•æ˜¯å“ªç§æƒ…å½¢ã€‚è‹¥ä¸º <em>nil</em> æƒ…å½¢åˆ™è·³è½¬åˆ° 0xa4 å¤„è¿›è¡Œå¤„ç†ï¼Œå¦åˆ™ç»§ç»­æ‰§è¡Œã€‚</p><p>åœ¨ç»§ç»­è®²è§£ä¹‹å‰ï¼Œå…ˆç®€å•è®¨è®ºä¸‹æ ‡è®°æŒ‡é’ˆå·¥ä½œåŸç†ã€‚ æ ‡è®°æŒ‡é’ˆæ”¯æŒå¤šä¸ªç±»ã€‚å…¶ä¸­é«˜ 4 ä½ï¼ˆåœ¨ ARM64 ä¸Šï¼‰æŒ‡æ˜äº†â€œå¯¹è±¡â€çš„ç±»ä¿¡æ¯ï¼Œæœ¬è´¨ä¸Šå°±æ˜¯ Tagged Pointer çš„ isa ã€‚å½“ç„¶ 4 ä¸ªæ¯”ç‰¹ä½ä¸è¶³ä»¥å®¹çº³ä¸€ä¸ªç±»æŒ‡é’ˆï¼Œå®é™…ä¸Šè¿™äº›ä¿¡æ¯éƒ½è¢«å­˜åœ¨äº†ä¸€å¼ ç‰¹æ®Šè¡¨ä¸­ã€‚æˆ‘ä»¬å¯ä»¥ä»¥é«˜ 4 ä½çš„å€¼ä¸ºç´¢å¼•å»è¡¨ä¸­æŸ¥è¯¢çœŸæ­£çš„ç±»ä¿¡æ¯ã€‚</p><p>è¿™è¿˜ä¸æ˜¯å…¨éƒ¨ï¼Œæ ‡è®°æŒ‡é’ˆï¼ˆè‡³å°‘åœ¨ ARM64 ä¸Šï¼‰æ”¯æŒæ‹“å±•ç±»ã€‚å½“é«˜ 4 ä½å…¨ä¸º 1 æ—¶ï¼Œç´§æ¥ç€çš„ 8 ä¸ªæ¯”ç‰¹ä½å°†è¢«ç”¨ä½œæ‹“å±•ç±»è¡¨ä¸­çš„ç´¢å¼•å€¼ã€‚ è¿™æ ·åœ¨è¿è¡Œæ—¶æ”¯æŒæ›´å¤šçš„æ ‡è®°æŒ‡é’ˆç±»ï¼Œä¸è¿‡ä»£ä»·å°±æ˜¯èƒ½å­˜å‚¨çš„æœ‰æ•ˆä¿¡æ¯ä¼šå˜å°‘ã€‚</p><p>ä¸‹é¢ç»§ç»­æŒ‡ä»¤çš„æ‰§è¡Œã€‚</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">0x0070 mov    x10, #-0x1000000000000000</span><br></pre></td></tr></table></figure><p>è¯¥æŒ‡ä»¤å°†ä¸€ä¸ªæ•´å½¢å€¼ï¼ˆé«˜ 4 ä½ä¸º 1 ï¼Œå…¶ä½™å…¨ä¸º 0ï¼‰å†™å…¥ x10 å¯„å­˜å™¨ä¸­ã€‚è¿™å°†ç”¨ä½œä¸‹ä¸€æ­¥æå– <code>self</code> æ ‡è®°ä½çš„æ©ç ã€‚</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">0x0074 cmp    x0, x10</span><br><span class="line">0x0078 b.hs   0x90</span><br></pre></td></tr></table></figure><p>è¿™ä¸€æ­¥æ—¶æ£€æŸ¥æ‹“å±•æ ‡è®°æŒ‡é’ˆå†…å®¹ã€‚å¦‚æœ <code>self</code> å¤§äºæˆ–è€…ç­‰äº x10 ä¸­çš„å€¼ï¼Œåˆ™æ„å‘³è¿™ <code>self</code> çš„é«˜ 4 ä½ä¹Ÿå…¨éƒ¨ä¸º 1 ã€‚æ­¤æ—¶ä»£ç ä¼šè·³è½¬åˆ° 0x90 å¤„ç†æ‹“å±•ç±»éƒ¨åˆ†çš„å†…å®¹ï¼Œå¦åˆ™å°±ç»§ç»­æ‰§è¡Œä¸‹é¢çš„æŒ‡ä»¤å»ä¸»æ ‡è®°æŒ‡é’ˆè¡¨ä¸­çš„æŸ¥è¯¢ç±»ä¿¡æ¯ã€‚</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">0x007c adrp   x10, _objc_debug_taggedpointer_classes@PAGE</span><br><span class="line">0x0080 add    x10, x10, _objc_debug_taggedpointer_classes@PAGEOFF</span><br></pre></td></tr></table></figure><p>è¯¥æ®µæŒ‡ä»¤ä¸»è¦å°±æ˜¯åŠ è½½ <code>_objc_debug_taggedpointer_classes@PAGE</code>  æ‰€æŒ‡çš„ä¸»æ ‡è®°æŒ‡é’ˆè¡¨åœ°å€ã€‚å› ä¸º ARM64 ä¸Šçš„æŒ‡é’ˆæ˜¯ 64 ä½å®½ï¼Œè€ŒæŒ‡ä»¤åªæœ‰ 32 ä½å®½ï¼Œæ‰€ä»¥éœ€è¦é‡‡ç”¨ç±» RISC æ ‡å‡†æŠ€æœ¯é€šè¿‡ä¸¤ä¸ªæŒ‡ä»¤æ¥åŠ è½½ç¬¦å·åœ°å€ã€‚</p><p>x86 æ¶æ„åˆ™ä¸å­˜åœ¨è¯¥é—®é¢˜ï¼Œå› ä¸ºå®ƒé‡‡ç”¨å¯å˜é•¿åº¦æŒ‡ä»¤é›†ã€‚å®ƒå¯ä»¥é€šè¿‡ä¸€ä¸ª 10 å­—èŠ‚é•¿çš„æŒ‡ä»¤å¤„ç†ä¸Šé¢çš„é—®é¢˜ï¼š2 ä¸ªå­—èŠ‚ç”¨æ¥åŒºåˆ†å…·ä½“æŒ‡ä»¤å’Œå¯„å­˜å™¨ï¼Œå‰©ä¸‹ 8 ä¸ªå­—èŠ‚ç”¨æ¥ä¿å­˜æŒ‡é’ˆåœ°å€ã€‚</p><p>è€Œåœ¨å®šé•¿æŒ‡ä»¤é›†æœºå™¨ä¸Šï¼Œæˆ‘ä»¬åªèƒ½é€šè¿‡ä¸€ç»„å‘½ä»¤åŠ ä»¥åº”å¯¹ã€‚ä¾‹å¦‚ï¼Œä¸Šä¾‹å°±æ˜¯é€šè¿‡ä¸¤æ¡æŒ‡ä»¤å®ç° 64 ä½æŒ‡é’ˆåœ°å€çš„åŠ è½½æ“ä½œã€‚adrp æŒ‡ä»¤åŠ è½½é«˜ 32 ä½ä¿¡æ¯ç„¶åå†é€šè¿‡ add æŒ‡ä»¤å°†å…¶ä¸ä½ 32 ä½è¿›è¡Œæ±‚å’Œã€‚</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">0x0084 lsr    x11, x0, #60</span><br></pre></td></tr></table></figure><p>å› ä¸ºç´¢å¼•å€¼ä¿å­˜åœ¨ x0 çš„é«˜ 4 ä½ä¸­ï¼Œæ‰€ä»¥è¯¥æŒ‡ä»¤å°† x0 è¿›è¡Œå³ç§» 60 ä½å–å‡ºå¯¹åº”çš„ç´¢å¼•å€¼ï¼ˆå–å€¼èŒƒå›´ä¸º 0-15ï¼‰å¹¶ä¿å­˜åˆ° x11 ä¸­ã€‚</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">0x0088 ldr    x16, [x10, x11, lsl #3]</span><br></pre></td></tr></table></figure><p>æ ¹æ®ç´¢å¼•å€¼è·å–æ ‡è®°æŒ‡é’ˆçš„ç±»ä¿¡æ¯å¹¶ä¿å­˜åˆ° x16 ä¸­ã€‚</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">0x008c b      0x10</span><br></pre></td></tr></table></figure><p>è·å¾—ç±»ä¿¡æ¯åç¨‹åºä¼šæ— æ¡ä»¶è·³å› 0x10 å¤„ï¼Œå¹¶å¤ç”¨ä¸»åˆ†æ”¯ä¸­çš„ä»£ç è¿›è¡Œæ–¹æ³•æŸ¥è¯¢å¤„ç†ã€‚</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">0x0090 adrp   x10, _objc_debug_taggedpointer_ext_classes@PAGE</span><br><span class="line">0x0094 add    x10, x10, _objc_debug_taggedpointer_ext_classes@PAGEOFF</span><br></pre></td></tr></table></figure><p>è¯¥æ®µæŒ‡ä»¤ä¸å‰é¢åŠ è½½ä¸»æ ‡è®°æŒ‡é’ˆè¡¨åŠŸèƒ½ä¸€æ ·ï¼Œåªä¸è¿‡æ­¤æ—¶å®ƒç”¨äºå¤„ç†å‰é¢æåˆ°çš„æ‹“å±•è¡¨åˆ†æ”¯ã€‚</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">0x0098 ubfx   x11, x0, #52, #8</span><br></pre></td></tr></table></figure><p>è¯¥æŒ‡ä»¤åªè¦æ˜¯å–å‡º <em>self</em> ä¸­ä»ç¬¬ 52 ä½å¼€å§‹çš„ 8 ä½ä¿¡æ¯ä½œä¸ºæ‹“å±•è¡¨çš„ç´¢å¼•å€¼ï¼Œå¹¶å°†å…¶ä¿å­˜åˆ° x11 ä¸­ã€‚</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">0x009c ldr    x16, [x10, x11, lsl #3]</span><br></pre></td></tr></table></figure><p>å†ä¸€æ¬¡ï¼Œæˆ‘ä»¬å°†è·å¾—çš„ç±»ä¿¡æ¯åŠ è½½åˆ° x16 ä¸­ã€‚</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">0x00a0 b      0x10</span><br></pre></td></tr></table></figure><p>æœ€åï¼Œæˆ‘ä»¬åŒæ ·è·³å›åˆ° 0x10 å¤„ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥çœ‹ <code>nil</code> æƒ…å½¢çš„å¤„ç†è¿‡ç¨‹ã€‚</p><h2 id="nil-çš„å¤„ç†"><a href="#nil-çš„å¤„ç†" class="headerlink" title="nil çš„å¤„ç†"></a><code>nil</code> çš„å¤„ç†</h2><p>ä½œä¸ºæœ€åä¸€ä¸ªç‰¹æ®Šæƒ…å†µï¼Œä¸‹é¢å°±æ˜¯ <code>nil</code> æƒ…å½¢ä¸‹è¢«æ‰§è¡Œçš„æ‰€æœ‰æŒ‡ä»¤ã€‚</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">0x00a4 mov    x1, #0x0</span><br><span class="line">0x00a8 movi   d0, #0000000000000000</span><br><span class="line">0x00ac movi   d1, #0000000000000000</span><br><span class="line">0x00b0 movi   d2, #0000000000000000</span><br><span class="line">0x00b4 movi   d3, #0000000000000000</span><br><span class="line">0x00b8 ret</span><br></pre></td></tr></table></figure><p><code>nil</code> æƒ…å½¢çš„å¤„ç†ä¸å…¶ä»–æƒ…å½¢å®Œå…¨ä¸åŒï¼Œå®ƒä¸ä¼šè¿›è¡Œç±»æŸ¥è¯¢å’Œæ–¹æ³•æ´¾å‘ï¼Œè€Œä»…ä»…è¿”å› 0 ç»™è°ƒç”¨è€…ã€‚</p><p>è¯¥æ®µæŒ‡ä»¤æœ€éº»çƒ¦çš„äº‹æƒ…æ˜¯ <code>objc_msgSend</code> ä¸çŸ¥é“å…·ä½“çš„è¿”å›å€¼ç±»å‹ã€‚æ˜¯æ•´å‹å€¼ã€æµ®ç‚¹å€¼ã€äº¦æˆ–è€…æ˜¯ä»€ä¹ˆéƒ½ä¸è¿”å›ã€‚</p><p>å¹¸è¿çš„æ˜¯ï¼Œæ‰€æœ‰ç”¨äºè®¾ç½®è¿”å›å€¼çš„å¯„å­˜å™¨éƒ½èƒ½è¢«å®‰å…¨è¦†å†™ï¼Œå³ä½¿æ­¤æ¬¡è°ƒç”¨è¿‡ç¨‹ä¸ä¼šä½¿ç”¨åˆ°ã€‚æ•´å‹è¿”å›å€¼è¢«ä¿å­˜åœ¨ x0 å’Œ x1 ä¸­ï¼Œè€Œæµ®ç‚¹å€¼åˆ™ä¿å­˜åœ¨å‘é‡å¯„å­˜å™¨ v0 - v3 ä¸­ã€‚åŒæ—¶ä½¿ç”¨å¤šä¸ªå¯„å­˜å™¨å¯ä»¥è¿”å›ä¸€ä¸ªå°å‹ç»“æ„ä½“ç±»å‹è¿”å›å€¼ã€‚</p><p>åœ¨å¤„ç† <code>nil</code> æƒ…å½¢æ—¶ï¼Œä¸Šè¯‰æŒ‡ä»¤ä¼šå°† x1 ä»¥åŠ v0 - v3 ä¸­çš„å€¼å…¨éƒ¨æ¸…ç©ºå¹¶è®¾ç½®ä¸º 0ã€‚å…¶ä¸­ d0 - d3 åˆ†åˆ«å¯¹åº”å‘é‡å¯„å­˜å™¨ v0 - v3 çš„ååŠéƒ¨åˆ†ï¼Œé€šè¿‡å°†å…¶è®¾ç½®ä¸º 0 æ¸…é™¤äº†ååŠéƒ¨åˆ†ç„¶ååœ¨é€šè¿‡ movi æ¸…é™¤æ‰€æœ‰çš„å¯„å­˜å™¨å†…å®¹ã€‚æ¸…ç©ºè¿”å›å€¼å¯„å­˜å™¨åï¼Œæ§åˆ¶æƒå°†é‡æ–°å›åˆ°è°ƒç”¨æ–¹ã€‚</p><p>å¦‚æœè¿”å›å€¼ä¸ºæ¯”è¾ƒå¤§çš„ç»“æ„ä½“ï¼Œé‚£ä¹ˆå¯„å­˜å™¨å¯èƒ½å°±å˜çš„ä¸å¤Ÿç”¨äº†ã€‚æ­¤æ—¶å°±éœ€è¦è°ƒç”¨è€…åšå‡ºä¸€äº›é…åˆã€‚è°ƒç”¨è€…ä¼šåœ¨ä¸€å¼€å§‹ä¸ºè¯¥ç»“æ„ä½“åˆ†é…ä¸€å—å†…å­˜ï¼Œç„¶åå°†å…¶åœ°å€æå‰å†™å…¥åˆ° x8 å¯„å­˜å™¨ä¸­ã€‚åœ¨è®¾ç½®è¿”å›å€¼çš„æ—¶å€™ï¼Œç›´æ¥å¾€è¯¥åœ°å€ä¸­å†™æ•°æ®å³å¯ã€‚<br>å› ä¸ºè¯¥å†…å­˜å¤§å°å¯¹ <code>objc_msgSend</code> æ˜¯é€æ˜çš„ï¼Œå› æ­¤ä¸èƒ½å¯¹å…¶è¿›è¡Œæ¸…ç©ºæ“ä½œã€‚å–è€Œä»£ä¹‹çš„æ“ä½œå°±æ˜¯åœ¨è°ƒç”¨ <code>objc_msgSend</code>  ä¹‹å‰ç¼–è¯‘å™¨ä¼šå°†å…¶è®¾ç½®ä¸º 0 ã€‚</p><p>ä»¥ä¸Šå°±æ˜¯ <code>nil</code> æƒ…å½¢çš„å¤„ç†ï¼Œ<code>objc_msgSend</code> æµç¨‹åˆ°æ­¤ä¹Ÿå®£å‘Šç»“æŸã€‚</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>æ·±å…¥æ¡†æ¶åº•å±‚è¿˜æ˜¯å¾ˆæœ‰è¶£çš„ï¼Œè€Œ <code>objc_msgSend</code>  å°±åƒä¸€ä»¶è‰ºæœ¯å“ï¼Œå€¼å¾—ç»†ç»†ç©å‘³ã€‚</p><p>ä»Šå¤©çš„å†…å®¹åˆ°æ­¤ç»“æŸï¼Œä¸‹æ¬¡å†ä¼šä¸ºå¤§å®¶å¸¦æ¥ä¸€äº›æ›´å¥½çš„å†…å®¹ã€‚Friday Q&amp;A å¾ˆå¤šå†…å®¹éƒ½æ˜¯ç”±è¯»è€…é©±åŠ¨è€Œæ¥ï¼Œæ‰€ä»¥æ¬¢è¿å¤§å®¶åœ¨ä¸‹é¢ç§¯æå‘è¨€ã€‚</p><h3 id="æ±‡ç¼–æŒ‡ä»¤æ ¡å¯¹è€…æ³¨"><a href="#æ±‡ç¼–æŒ‡ä»¤æ ¡å¯¹è€…æ³¨" class="headerlink" title="æ±‡ç¼–æŒ‡ä»¤æ ¡å¯¹è€…æ³¨"></a>æ±‡ç¼–æŒ‡ä»¤æ ¡å¯¹è€…æ³¨</h3><ol><li><code>#0x0</code>ï¼šâ€œ#â€ä¿®é¥°çš„æ•°å­—è¡¨ç¤ºç«‹å³æ•°ï¼Œå¯ç®€å•ç†è§£ä¸ºæ•°å€¼ï¼Œè€Œéåœ°å€ï¼š</li><li><code>b</code> ï¼šè·³è½¬æŒ‡ä»¤ï¼Œb.le æŒ‡æ¯”è¾ƒç»“æœå°äºç­‰äºçš„æ—¶å€™è·³è½¬è‡³æŸå†…å­˜åœ°å€ï¼›</li><li><code>ldr</code> ï¼šä»å†…å­˜ä¸­è¯»å–æ•°æ®åˆ°å¯„å­˜å™¨ï¼›</li><li><code>and</code>ï¼šarm çš„ <code>and</code> æŒ‡ä»¤ï¼Œéœ€è¦3ä¸ªæ“ä½œæ•°ï¼Œä¾‹å¦‚ <code>AND R0ï¼ŒR0ï¼Œ#3</code> æ˜¯å°† R0 å¯„å­˜å™¨çš„å€¼ä¸æ•°å­—3ï¼ˆ0x0000003ï¼‰é€»è¾‘ä¸ï¼Œå°†ç»“æœå­˜å‚¨ä¸º R0 å¯„å­˜å™¨</li><li><code>add</code>ï¼š<code>ADD[con][S] Rd,Rn,operand</code>ï¼Œå°† operand æ•°æ®ä¸ Rn çš„å€¼ç›¸åŠ ï¼Œç»“æœä¿å­˜åˆ° Rd å¯„å­˜å™¨ï¼›</li><li><code>lsl</code>ï¼š é€»è¾‘å·¦ç§»æŒ‡ä»¤ï¼Œå¯ä»¥ç»“åˆ <code>add</code> æŒ‡ä»¤ä¸€èµ·ä½¿ç”¨ï¼Œå¦‚<code>ADDS R0,R1,R2,LSL#2</code>ï¼Œå°† R2 å¯„å­˜å™¨å·¦ç§» 2 ä½ï¼Œæ¥ç€ R1 å’Œ R2 å€¼ç›¸åŠ ï¼Œå°†ç»“æœå­˜å‚¨åˆ° R0 ä¸­ï¼›</li><li><code>cbz</code>ï¼šcå¯¹åº”compareï¼Œbå°±æ˜¯ä¸Šé¢çš„è·³è½¬ï¼Œzå¯¹åº”0 zeroï¼Œå› æ­¤è¿™æ¡å‘½ä»¤å½“æ¯”è¾ƒç»“æœä¸ºé›¶ï¼ˆZeroï¼‰å°±è·³è½¬è‡³ä¹‹åçš„æŒ‡ä»¤ï¼›</li><li><code>UXTW</code>ï¼š 32 ä½çš„é€»è¾‘å·¦ç§»æŒ‡ä»¤ï¼Œæ›´å¤šè¯·è§<a href="http://lists.llvm.org/pipermail/llvm-commits/Week-of-Mon-20140407/212142.html" target="_blank" rel="noopener">[llvm] r205861</a>;</li><li><code>LSR</code>ï¼š é€»è¾‘å³ç§»ï¼›</li><li><code>UBFX</code>ï¼š<code>UBFX{cond} Rd, Rn, #lsb, #width</code> ä»ä¸€ä¸ªå¯„å­˜å™¨ä¸­æå–ä½åŸŸï¼Œcond â€”å¯é€‰ï¼Œæ¡ä»¶ç  ï¼›Rd â€” ç›®æ ‡å¯„å­˜å™¨ ï¼›Rn â€” æºå¯„å­˜å™¨ ï¼›lsb â€”ä½åŸŸçš„æœ€ä½æœ‰æ•ˆä½çš„ä½ç½®ï¼ŒèŒƒå›´æ˜¯ 0 - 31ï¼› width â€” ä½åŸŸçš„å®½åº¦ï¼ŒèŒƒå›´æ˜¯1åˆ° 32-lsb</li></ol><blockquote><p>æœ¬æ–‡ç”± SwiftGG ç¿»è¯‘ç»„ç¿»è¯‘ï¼Œå·²ç»è·å¾—ä½œè€…ç¿»è¯‘æˆæƒï¼Œæœ€æ–°æ–‡ç« è¯·è®¿é—® <a href="http://swift.gg">http://swift.gg</a>ã€‚</p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;ä½œè€…ï¼šMike Ashï¼Œ&lt;a href=&quot;https://www.mikeash.com/pyblog/friday-qa-2017-06-30-dissecting-objc_msgsend-on-arm64.html&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;åŸæ–‡é“¾æ¥&lt;/a&gt;ï¼ŒåŸæ–‡æ—¥æœŸï¼š2017-06-30&lt;br&gt;è¯‘è€…ï¼š&lt;a href=&quot;undefined&quot;&gt;BigNerdCoding&lt;/a&gt;ï¼›æ ¡å¯¹ï¼š&lt;a href=&quot;http://www.jianshu.com/users/596f2ba91ce9/latest_articles&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;pmst&lt;/a&gt;ï¼Œ&lt;a href=&quot;http://codebuild.me/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;shanks&lt;/a&gt;ï¼›å®šç¨¿ï¼š&lt;a href=&quot;https://github.com/chenmingbiao&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;CMB&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;!--æ­¤å¤„å¼€å§‹æ­£æ–‡--&gt;
&lt;p&gt;å¾ˆé«˜å…´ï¼Œæˆ‘åˆå›æ¥äº†ã€‚åœ¨åˆšåˆšè¿‡å»çš„ WWDC æœŸé—´ï¼Œæˆ‘åœ¨ CocoaConf Next Door åšä¸ªä¸€ä¸ªå…³äºå‰–æ ARM64 ä¸Š &lt;code&gt;objc_msgSend&lt;/code&gt; è¿è¡Œæµç¨‹çš„å‘è¨€ã€‚ç°åœ¨æˆ‘å°†æ•´ç†åçš„å†…å®¹é‡æ–°å‘å¸ƒåˆ° Friday Q&amp;amp;A ä¸Šã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="Mike Ash" scheme="https://swift.gg/categories/Mike-Ash/"/>
    
    
      <category term="iOS å¼€å‘" scheme="https://swift.gg/tags/iOS-%E5%BC%80%E5%8F%91/"/>
    
  </entry>
  
  <entry>
    <title>Swift 4 å¼±å¼•ç”¨å®ç°</title>
    <link href="https://swift.gg/2018/08/02/swift-4-weak-references/"/>
    <id>https://swift.gg/2018/08/02/swift-4-weak-references/</id>
    <published>2018-08-02T00:00:00.000Z</published>
    <updated>2018-09-10T03:53:25.085Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ä½œè€…ï¼šMike Ashï¼Œ<a href="https://www.mikeash.com/pyblog/friday-qa-2017-09-22-swift-4-weak-references.html" target="_blank" rel="noopener">åŸæ–‡é“¾æ¥</a>ï¼ŒåŸæ–‡æ—¥æœŸï¼š2017-09-22<br>è¯‘è€…ï¼š<a href="undefined">BigNerdCoding</a>ï¼›æ ¡å¯¹ï¼š<a href="http://blog.yousanflics.com.cn" target="_blank" rel="noopener">Yousanflics</a>ï¼Œ<a href="http://numbbbbb.com/" target="_blank" rel="noopener">numbbbbb</a>ï¼Œ<a href="https://github.com/Cee" target="_blank" rel="noopener">Cee</a>ï¼›å®šç¨¿ï¼š<a href="https://github.com/chenmingbiao" target="_blank" rel="noopener">CMB</a></p></blockquote><!--æ­¤å¤„å¼€å§‹æ­£æ–‡--><p>Swift å¼€æºä¸ä¹…æˆ‘å°±å†™äº†ç¯‡å…³äºå¼±å¼•ç”¨å®ç°çš„<a href="https://mikeash.com/pyblog/friday-qa-2015-12-11-swift-weak-references.html" target="_blank" rel="noopener">æ–‡ç« </a>ã€‚æ—¶ç§»åŠ¿æ˜“ï¼ŒSwift 4 ä¸­çš„å¼±å¼•ç”¨å®ç°å·²ç»ä¸æ—§æ–‡ä¸ä¸€è‡´äº†ã€‚åº” Guillaume Lessard å»ºè®®ï¼Œä»Šå¤©æˆ‘å°†ä¼šä»‹ç»æ–°ç‰ˆå®ç°ï¼Œå¹¶æ¯”è¾ƒå…¶ä¸è€ç‰ˆçš„åŒºåˆ«ã€‚</p><a id="more"></a><h2 id="æ—§å®ç°"><a href="#æ—§å®ç°" class="headerlink" title="æ—§å®ç°"></a>æ—§å®ç°</h2><p>è€ƒè™‘åˆ°æœ‰äº›äººå¯èƒ½å·²ç»å¿˜è®°äº†æ—§å®ç°å¹¶ä¸”ä¸æ„¿é‡çœ‹å‰é¢çš„æ–‡ç« ï¼Œä¸‹é¢æˆ‘ä»¬å°±ä¸€èµ·ç®€è¦çš„å›é¡¾ä¸‹ä¹‹å‰çš„å®ç°æ–¹å¼ã€‚</p><p>åœ¨æ—§å®ç°ä¸­ï¼ŒSwift å¯¹è±¡æœ‰ä¸¤ä¸ªå¼•ç”¨è®¡æ•°ï¼šå¼ºå¼•ç”¨è®¡æ•°å’Œå¼±å¼•ç”¨è®¡æ•°ã€‚å½“å¼ºå¼•ç”¨è®¡æ•°ä¸º 0 è€Œå¼±å¼•ç”¨è®¡æ•°ä¸ä¸º 0 æ—¶ï¼Œå¯¹è±¡ä¼šè¢«é”€æ¯ï¼Œä½†æ˜¯å†…å­˜å¹¶ä¸ä¼šè¢«ç«‹å³é‡Šæ”¾ã€‚å†…å­˜ä¸­ä¼šä¿ç•™å¼±å¼•ç”¨æŒ‡å‘çš„åƒµå°¸å¯¹è±¡ã€‚</p><p>åœ¨åŠ è½½å¼±å¼•ç”¨æ—¶ï¼Œè¿è¡Œæ—¶ä¼šå¯¹å¼•ç”¨å¯¹è±¡è¿›è¡Œæ£€æŸ¥ã€‚å¦‚æœæ˜¯åƒµå°¸å¯¹è±¡ï¼Œåˆ™ä¼šå¯¹å¼±å¼•ç”¨è®¡æ•°è¿›è¡Œé€’å‡æ“ä½œã€‚ä¸€æ—¦å¼±å¼•ç”¨è®¡æ•°ä¸º 0ï¼Œå¯¹è±¡å†…å­˜å°†ä¼šè¢«é‡Šæ”¾ã€‚æ¢å¥è¯è¯´ï¼Œåƒµå°¸å¯¹è±¡çš„æ‰€æœ‰å¼±å¼•ç”¨è¢«åŠ è½½è®¿é—®ååƒµå°¸å¯¹è±¡æ‰ä¼šçœŸæ­£è¢«æ¸…ç©ºã€‚</p><p>è™½ç„¶æˆ‘å–œæ¬¢è¯¥å®ç°çš„ç®€å•æ€§ï¼Œä½†å®ƒæœ‰ä¸€äº›ç¼ºé™·ã€‚å…¶ä¸­ä¸€ä¸ªå°±æ˜¯ï¼Œåƒµå°¸å¯¹è±¡å¯èƒ½ä¼šé•¿æ—¶é—´åœç•™åœ¨å†…å­˜ä¸­ã€‚å¯¹äºé‚£äº›æ‹¥æœ‰å¾ˆå¤šå®ä¾‹çš„ç±»ï¼ˆå› ä¸ºå®ƒä»¬åŒ…å«è®¸å¤šå±æ€§ï¼Œæˆ–ä½¿ç”¨ç±»ä¼¼ ManagedBuffer åˆ†é…äº†å†…è”çš„é¢å¤–å†…å­˜ï¼‰ï¼Œè¿™ä¼šé€ æˆä¸¥é‡çš„å†…å­˜æµªè´¹ã€‚</p><p>å¦å¤–ï¼Œåœ¨å†™å®Œæ—§æ–‡åæˆ‘è¿˜å‘ç°ï¼šå¯¹äºå¹¶å‘è¯»å–ï¼Œè¯¥å®ç°æ˜¯éçº¿ç¨‹å®‰å…¨çš„ã€‚è™½ç„¶å·²ç»æœ‰è¡¥ä¸ä¿®å¤äº†è¿™ä¸ªé—®é¢˜ï¼Œä½†ä»ç›¸å…³è®¨è®ºå¯ä»¥çœ‹å‡ºï¼Œå¼€å‘è€…å¸Œæœ›æ‰¾åˆ°ä¸€ä¸ªæ›´å¥½çš„å®ç°æ–¹å¼ï¼Œé¿å…å‡ºç°ç±»ä¼¼é—®é¢˜ã€‚</p><h2 id="å¯¹è±¡æ•°æ®"><a href="#å¯¹è±¡æ•°æ®" class="headerlink" title="å¯¹è±¡æ•°æ®"></a>å¯¹è±¡æ•°æ®</h2><p>Swift ä¸­çš„ â€œå¯¹è±¡â€ å…¶å®æ˜¯ç”±ä¸€ç»„æ•°æ®æ„æˆã€‚</p><p>é¦–å…ˆï¼Œæœ€å®¹æ˜“æƒ³åˆ°çš„å°±æ˜¯æºç ä¸­å£°æ˜çš„é‚£äº›å¯ç›´æ¥è®¿é—®çš„å­˜å‚¨å±æ€§ã€‚</p><p>å…¶æ¬¡å°±æ˜¯å¯¹è±¡çš„ç±»ä¿¡æ¯ã€‚è¯¥ä¿¡æ¯ä¸»è¦è¢«ç”¨äºåŠ¨æ€æ´¾å‘å’Œ <strong>type(of: )</strong> å†…ç½®å‡½æ•°ã€‚è™½ç„¶åŠ¨æ€æ´¾å‘å’Œ <strong>type(of: )</strong> å†…ç½®å‡½æ•°ä»ä¾§é¢æš—ç¤ºäº†å®ƒçš„å­˜åœ¨ï¼Œä½†æ˜¯å®é™…ä¸Šè¯¥ä¿¡æ¯å¤§å¤šæ˜¯è¢«éšè—çš„ã€‚</p><p>ç¬¬ä¸‰ç§å°±æ˜¯å„ç§å¼•ç”¨è®¡æ•°ä¿¡æ¯ã€‚é™¤éä½ è¿›è¡Œä¸€äº›éå¸¸è§„æ“ä½œï¼Œä¾‹å¦‚ï¼Œè¯»å–å¯¹è±¡çš„åŸå§‹å†…å­˜æˆ–è¯´æœç¼–è¯‘å™¨è®©ä½ è°ƒç”¨ CFGetRetainCountï¼Œå¦åˆ™è¿™äº›ä¿¡æ¯å¯¹ä½ æ¥è¯´æ˜¯å®Œå…¨é€æ˜ä¸å¯è§çš„ã€‚</p><p>ç¬¬å››ç§å°±æ˜¯ Objective-C è¿è¡Œæ—¶å­˜å‚¨çš„è¾…åŠ©ä¿¡æ¯ï¼Œä¾‹å¦‚ Objective-C å¼±å¼•ç”¨åˆ—è¡¨ï¼ˆObjective-C çš„å¼±å¼•ç”¨å®ç°æ˜¯é€šè¿‡å•ç‹¬è¿½è¸ªæ¯ä¸ªå¼±å¼•ç”¨ï¼‰å’Œå…³è”å¯¹è±¡ã€‚</p><p>é‚£ä¹ˆè¿™äº›ä¿¡æ¯æœ€ç»ˆéƒ½å­˜å‚¨åœ¨å“ªé‡Œå‘¢ï¼Ÿ</p><p>åœ¨ Objective-C ä¸­ï¼Œç±»ä¿¡æ¯å’Œå­˜å‚¨å±æ€§ï¼ˆä¾‹å¦‚ï¼Œå®ä¾‹å˜é‡ï¼‰å†…è”åœ¨å¯¹è±¡å†…å­˜ä¸­ã€‚å…¶ä¸­ç±»ä¿¡æ¯ä½äºæŒ‡é’ˆæ‰€åœ¨ç¬¬ä¸€å—å†…å­˜ï¼Œå…¶åæ‰æ˜¯å®ä¾‹å˜é‡ã€‚è¾…åŠ©ç±»ä¿¡æ¯åˆ™ä¿å­˜åœ¨å¤–éƒ¨è¡¨ä¸­ã€‚å½“ä½ éœ€è¦æ“ä½œå…³è”å¯¹è±¡æ—¶ï¼Œè¿è¡Œæ—¶æœºåˆ¶ä¼šä½¿ç”¨å†…å­˜åœ°å€å»ä¸€ä¸ªå¤§çš„å“ˆå¸Œè¡¨ä¸­æŸ¥æ‰¾å®ƒã€‚ä¸ºäº†å®ç°å¤šçº¿ç¨‹å®‰å…¨ï¼Œè¯¥è¡¨åœ¨æ“ä½œæ—¶ä¼šåŠ é”ï¼Œæ‰€ä»¥å­˜åœ¨ä¸€å®šç¨‹åº¦è®¿é—®é€Ÿåº¦é—®é¢˜ã€‚å¼•ç”¨è®¡æ•°çš„ä¿å­˜ä½ç½®ï¼Œåˆ™å–å†³äºå…·ä½“æ“ä½œç³»ç»Ÿç‰ˆæœ¬å’Œ CPU æ¶æ„ï¼Œå®ƒæœ‰æ—¶ä½äºå¯¹è±¡å†…å­˜ä¸­ï¼Œè€Œæœ‰æ—¶åˆå­˜å‚¨åœ¨å¤–éƒ¨è¡¨ä¸­ã€‚</p><p>åœ¨ Swift æ—§æœ‰å®ç°ä¸­ï¼Œç±»ä¿¡æ¯ï¼Œå¼•ç”¨è®¡æ•°å’Œå­˜å‚¨å±æ€§å…¨éƒ¨å†…è”åœ¨å¯¹è±¡å†…å­˜ä¸­ã€‚è€Œè¾…åŠ©ä¿¡æ¯åˆ™ä¾æ—§å­˜å‚¨åœ¨å•ç‹¬çš„å¤–éƒ¨è¡¨ä¸­ã€‚</p><p>ä¸‹é¢æˆ‘ä»¬ä¸å¦¨å°†å…·ä½“å®ç°ä»£ç å…ˆæ”¾ä¸€è¾¹ï¼Œä»”ç»†æ€è€ƒä¸‹ï¼šç†è®ºä¸Šåº”è¯¥å¦‚ä½•å­˜å‚¨è¿™äº›ä¿¡æ¯å‘¢ï¼Ÿ</p><p>æ¯ç§å­˜å‚¨æ–¹æ¡ˆéƒ½æœ‰åˆ©å¼Šã€‚å°†æ•°æ®å­˜å‚¨åœ¨å¯¹è±¡å†…å­˜ä¸­è™½ç„¶èƒ½æé«˜è®¿é—®é€Ÿåº¦ï¼Œä½†æ˜¯ä¼šè®©å†…å­˜ç©ºé—´å˜å¾—åƒç´§ã€‚ä¸ä¹‹ç›¸å¯¹ï¼Œå¤–éƒ¨å­˜å‚¨æ–¹æ¡ˆåˆ™æ˜¯é€šè¿‡ç‰ºç‰²é€Ÿåº¦æ¥æ¢ç©ºé—´ã€‚</p><p>Objective-C ä¼ ç»Ÿå­˜å‚¨æ–¹æ¡ˆä¸å°†å¯¹è±¡å¼•ç”¨è®¡æ•°ä¿å­˜åœ¨å†…å­˜ä¸­ï¼Œéƒ¨åˆ†åŸå› æ­£æ˜¯åŸºäºæ­¤ã€‚å› ä¸ºåœ¨ Objective-C å¼•å…¥å¼•ç”¨è®¡æ•°æ¦‚å¿µæ—¶ï¼Œè®¾å¤‡çš„æ€§èƒ½è¿œä¸å¦‚ç°åœ¨ï¼Œè€Œä¸”å†…å­˜å®¹é‡ä¹Ÿæä¸ºæœ‰é™ã€‚Objective-C ç¨‹åºä¸­å¤§å¤šæ•°å¯¹è±¡åªæœ‰ä¸€ä¸ªæ‰€æœ‰è€…ï¼Œå³å¼•ç”¨è®¡æ•°ä¸º 1 ã€‚æ­¤æ—¶åœ¨å¯¹è±¡å†…å­˜ä¸­è…¾å‡º 4 ä¸ªå­—èŠ‚ç©ºé—´å­˜å‚¨è¯¥å¼•ç”¨è®¡æ•° 1 æ˜¯å¾ˆæµªè´¹çš„ã€‚è€Œå¤–éƒ¨è¡¨æ–¹æ¡ˆä¸­ï¼Œæ•°å€¼ 1 å¯ä»¥é€šè¿‡ç¼ºçœé»˜è®¤å€¼æ–¹å¼è¡¨ç¤ºä»è€Œå‡å°‘å†…å­˜æ¶ˆè€—ã€‚</p><p>æ¯æ¬¡è¿›è¡ŒåŠ¨æ€æ–¹æ³•æ´¾å‘æ—¶éƒ½éœ€è¦å¯¹è±¡çš„ç±»ä¿¡æ¯ï¼Œæ‰€æœ‰ä½œä¸ºæœ€å¸¸ç”¨ä¿¡æ¯ï¼Œç±»ä¿¡æ¯åº”è¯¥ç›´æ¥ä¿å­˜åœ¨å†…å­˜ä¸­ï¼Œå­˜åœ¨å¤–éƒ¨è¡¨ä¸­æ˜¯ä¸åˆé€‚çš„ã€‚</p><p>è€Œå®ä¾‹å˜é‡è¿™ç±»å­˜å‚¨å±æ€§åœ¨ç¼–è¯‘æœŸå°±ç¡®å®šäº†ï¼Œè€Œä¸”æœ‰ç°å®çš„è®¿é—®é€Ÿåº¦éœ€æ±‚ï¼Œæ‰€ä»¥å­˜åœ¨å¯¹è±¡å†…å­˜ä¸­ä¹Ÿæ˜¯æœ€åˆç†çš„è®¾è®¡ã€‚å¦å¤–ï¼Œå½“å¯¹è±¡æ²¡æœ‰å­˜å‚¨å±æ€§æ—¶ï¼Œç³»ç»Ÿä¸ä¼šä¸ºå…¶åˆ†é…å†…å­˜ç©ºé—´ä¹Ÿå°±ä¸å­˜åœ¨æµªè´¹é—®é¢˜ã€‚</p><p>æ¯ä¸ªå¯¹è±¡éƒ½éœ€è¦ä¿ç•™å¼•ç”¨è®¡æ•°ã€‚è™½ç„¶ä¸æ˜¯æ¯ä¸ªå¯¹è±¡çš„å¼•ç”¨è®¡æ•°éƒ½ä¸º 1ï¼Œä½†å®ƒä¾æ—§æ˜¯ä¸€ä¸ªç›¸å¯¹å¸¸è§çš„æƒ…å½¢ï¼ŒåŠ ä¸Šç°åœ¨å†…å­˜è¶³å¤Ÿï¼Œå®ƒå¯ä»¥ç›´æ¥ä¿å­˜åœ¨å†…å­˜ä¸­ã€‚</p><p>å¤§å¤šæ•°å¯¹è±¡éƒ½ä¸ä¼šæœ‰å¼±å¼•ç”¨æˆ–å…³è”å¯¹è±¡æ•°æ®ï¼Œæ‰€æœ‰å®ƒä»¬åº”è¯¥ä¿å­˜åœ¨å¤–éƒ¨ä»¥æœŸèŠ‚çº¦å†…å­˜ç©ºé—´ã€‚</p><p>å¯¹äºé‚£äº›æœ‰å¼±å¼•ç”¨æˆ–å…³è”å¯¹è±¡æ•°æ®çš„å¯¹è±¡æ¥è¯´ï¼Œè®¿é—®é€Ÿåº¦ç¡®å®ä¸å¤Ÿå¿«ä½†è¿™æ˜¯åˆç†çš„æƒè¡¡ç»“æœã€‚é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œè¯¥æ—§å®ç°æœ‰æ²¡æœ‰æ”¹è¿›ç©ºé—´å’Œå¯è¡Œæ–¹æ³•å‘¢ï¼Ÿ</p><h2 id="Side-Tables"><a href="#Side-Tables" class="headerlink" title="Side Tables"></a>Side Tables</h2><p>åœ¨ Swift å¼±å¼•ç”¨çš„æ–°ç‰ˆå®ç°ä»£ç ä¸­ï¼Œå¼•å…¥äº† <em>side tables</em> æ¦‚å¿µæ¥æ”¹è¿›ä¸Šè¯‰ç¼ºé™·ã€‚</p><p>Side table æœ¬è´¨å°±æ˜¯ç”¨äºä¿å­˜é¢å¤–ä¿¡æ¯çš„å•ç‹¬å†…å­˜å—ï¼Œå¹¶ä¸”å®ƒè¿˜æ˜¯å¯é€‰çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¯¹äºé‚£äº›æ— éœ€ä¿å­˜é¢å¤–ä¿¡æ¯çš„å¯¹è±¡æ¥è¯´å¹¶æ²¡æœ‰å¤šä½™å¼€é”€ã€‚</p><p>æ¯ä¸ªå¯¹è±¡éƒ½æœ‰ä¸€ä¸ªæŒ‡å‘å…¶å¯¹åº” side table çš„æŒ‡é’ˆï¼Œè€Œ side table ä¹Ÿæœ‰ä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘è¯¥å¯¹è±¡ã€‚å¦å¤–ï¼Œside table å¯ä»¥å­˜å‚¨å…³è”çš„å¯¹è±¡æ•°æ®ç­‰å…¶ä»–ä¿¡æ¯ã€‚</p><p>ä¸ºäº†é¿å… side table å¸¦æ¥çš„ 8 å­—èŠ‚ç©ºé—´å¼€é”€ï¼ŒSwift åšäº†ä¸€ä¸ªæ¼‚äº®çš„ä¼˜åŒ–ã€‚é€šå¸¸å†…å­˜ä¸­çš„ç¬¬ä¸€ä¸ªå­—ï¼ˆWordï¼‰æ˜¯ç±»ä¿¡æ¯ï¼Œç¬¬äºŒä¸ªå­—åˆ™æ˜¯å¼•ç”¨è®¡æ•°ã€‚å½“å¯¹è±¡å­˜åœ¨ side table éœ€æ±‚æ—¶ï¼Œç¬¬äºŒä¸ªå­—å°†ä¿å­˜æŒ‡å‘ side table çš„æŒ‡é’ˆã€‚å› ä¸ºå¼•ç”¨è®¡æ•°æ˜¯å¿…è¦ä¿¡æ¯ï¼Œæ‰€ä»¥æ­¤æ—¶ä¼šå°†å¼•ç”¨è®¡æ•°ä¿å­˜åˆ° side table ä¸­ã€‚è‡³äºç¨‹åºè¿è¡Œæ—¶åˆ°åº•æ˜¯å“ªç§æƒ…å½¢ï¼Œåˆ™ç”±è¯¥å—å†…å­˜ä¸­çš„ä¸€ä¸ªæ ‡å¿—ä½è¿›è¡ŒåŒºåˆ†ã€‚</p><p>é€šè¿‡å°†å¼±å¼•ç”¨ä»æŒ‡å‘å¯¹è±¡æœ¬èº«æ”¹ä¸ºæŒ‡å‘ side table ï¼ŒSwift å¾—ä»¥åœ¨ä¿ç•™åŸæœ‰å¼•ç”¨è®¡æ•°è®¾è®¡çš„åŒæ—¶ä¿®å¤äº†æ—§è®¾è®¡ä¸­çš„ç¼ºé™·ã€‚</p><p>å› ä¸º side table æ¯”è¾ƒå°å¹¶ä¸”å¼±å¼•ç”¨ä¸å†æŒ‡å‘å¯¹è±¡æœ¬èº«ï¼Œè¿™æ ·ä¹‹å‰å¤§å‹åƒµå°¸å¯¹è±¡çš„å†…å­˜ç©ºé—´å°†èƒ½ç«‹å³é‡Šæ”¾ä»è€Œé™ä½äº†å†…å­˜æµªè´¹ã€‚åŒæ—¶è¯¥å®ç°ä¹Ÿè®©çº¿ç¨‹å®‰å…¨é—®é¢˜å˜å¾—æ›´æ˜“è§£å†³ï¼šä¸å†éœ€è¦æå‰å°†å¼±å¼•ç”¨ç½®ç©ºã€‚å› ä¸º side table æ¯”è¾ƒå°ï¼ŒæŒ‡å‘å®ƒçš„å¼±å¼•ç”¨å¯ä»¥æŒç»­ä¿ç•™ï¼Œç›´åˆ°è¿™äº›å¼•ç”¨è‡ªèº«è¢«è¦†å†™æˆ–é”€æ¯ã€‚</p><p>è¿™é‡Œéœ€è¦æé†’ä¸€ä¸‹ï¼Œå½“å‰ side table å®ç°ä¸­åªä¿å­˜å¼•ç”¨è®¡æ•°å’ŒæŒ‡å‘åŸå§‹å¯¹è±¡çš„æŒ‡é’ˆã€‚ç±»ä¼¼ä¿å­˜å…³è”å¯¹è±¡ç­‰ç”¨é€”åªæ˜¯ä¸€ä¸ªçŒœæƒ³å’Œå‡è®¾ã€‚å› ä¸º Swift è¿˜æ²¡æœ‰å†…å»ºå…³è”å¯¹è±¡åŠŸèƒ½ï¼Œè€Œ Objective-C API ä»åœ¨ä½¿ç”¨å…¨å±€è¡¨ã€‚</p><p>è¯¥æŠ€æœ¯è¿˜æœ‰ä¸å°‘æ½œåŠ›å¯æŒ–ï¼Œä¹Ÿè®¸åœ¨ä¸ä¹…çš„å°†æ¥èƒ½çœ‹åˆ°å…¶åº”ç”¨åœ¨å…³è”å¯¹è±¡ç­‰å†…å®¹ä¸Šã€‚æˆ‘å¸Œæœ›å®ƒèƒ½ä¸ºç±»æ‹“å±•ä¸­çš„å­˜å‚¨å±æ€§å’Œå…¶ä»–æœ‰è¶£çš„åŠŸèƒ½æ‰“å¼€ä¸€æ‰‡æ–°çª—ã€‚</p><h2 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h2><p>å› ä¸º Swift å·²ç»å¼€æºï¼Œæ‰€æœ‰ç›¸å…³ä»£ç éƒ½èƒ½ç›´æ¥è®¿é—®ã€‚</p><p>å…³äº side table çš„å¤§éƒ¨åˆ†ä»£ç éƒ½åœ¨ <a href="https://github.com/apple/swift/blob/c262440e70896299118a0a050c8a834e1270b606/stdlib/public/SwiftShims/RefCount.h" target="_blank" rel="noopener">stdlib/public/SwiftShims/RefCount.h</a> ã€‚</p><p>é«˜å±‚çº§çš„å¼±å¼•ç”¨ API ä»¥åŠç›¸å…³æ³¨é‡Šéƒ½åœ¨ <a href="https://github.com/apple/swift/blob/c262440e70896299118a0a050c8a834e1270b606/stdlib/public/runtime/WeakReference.h" target="_blank" rel="noopener">swift/stdlib/public/runtime/WeakReference.h</a>ã€‚</p><p>æ›´å¤šå…³äºå †å¯¹è±¡çš„å®ç°å’Œæ³¨é‡Šåœ¨ <a href="https://github.com/apple/swift/blob/c262440e70896299118a0a050c8a834e1270b606/stdlib/public/runtime/HeapObject.cpp" target="_blank" rel="noopener">stdlib/public/runtime/HeapObject.cpp</a>ã€‚</p><p>ä¸Šè¿°é“¾æ¥å…¶å®å¸¦ç€ç‰ˆæœ¬ä¿¡æ¯ï¼Œä»¥ä¾¿åé¢çš„è¯»è€…ä¹Ÿèƒ½æ‰¾åˆ°æœ¬æ–‡å†…å®¹å½“æ—¶çš„ä¸Šä¸‹æ–‡ã€‚å¦‚æœä½ æƒ³çœ‹æœ€æ–°çš„å®ç°ä»£ç ï¼Œä½ åœ¨ç‚¹å‡»é“¾æ¥ååˆ‡æ¢åˆ° master åˆ†æ”¯å³å¯ã€‚</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>å¼±å¼•ç”¨æ˜¯ä¸€ä¸ªé‡è¦çš„è¯­è¨€ç‰¹æ€§ã€‚Swift æœ€åˆçš„å®ç°æ–¹å¼éå¸¸èªæ˜ï¼Œä¹Ÿæœ‰ä¸€äº›ä¸é”™çš„ç‰¹æ€§ï¼Œä½†æ˜¯åŒæ—¶ä¹Ÿå­˜åœ¨ä¸€äº›é—®é¢˜ã€‚é€šè¿‡å¼•å…¥ side tableï¼ŒSwift å¼€å‘å·¥ç¨‹å¸ˆåœ¨ä¿ç•™åŸæœ‰ç‰¹ç‚¹çš„åŒæ—¶è¿˜è§£å†³äº†è¿™äº›ç¼ºé™·ã€‚Side table çš„å®ç°ä¹Ÿä¸ºå°†æ¥æ›´å¤šæ–°ç‰¹æ€§åˆ›é€ äº†æ›´å¤šå¯èƒ½æ€§ã€‚</p><p>ä»Šå¤©å†…å®¹åˆ°æ­¤ä¸ºæ­¢ã€‚ä¸‹æ¬¡æˆ‘è¿˜ä¼šå¸¦æ¥ä¸ç¼–ç¨‹å’Œä»£ç ç›¸å…³çš„æ–°å†…å®¹ã€‚å½“ç„¶ä½ ä¹Ÿå¯ä»¥å°†ä½ æ„Ÿå…´è¶£çš„è¯é¢˜<a href="mailto:mike@mikeash.com" target="_blank" rel="noopener">å‘é€ç»™æˆ‘</a>ã€‚</p><blockquote><p>æœ¬æ–‡ç”± SwiftGG ç¿»è¯‘ç»„ç¿»è¯‘ï¼Œå·²ç»è·å¾—ä½œè€…ç¿»è¯‘æˆæƒï¼Œæœ€æ–°æ–‡ç« è¯·è®¿é—® <a href="http://swift.gg">http://swift.gg</a>ã€‚</p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;ä½œè€…ï¼šMike Ashï¼Œ&lt;a href=&quot;https://www.mikeash.com/pyblog/friday-qa-2017-09-22-swift-4-weak-references.html&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;åŸæ–‡é“¾æ¥&lt;/a&gt;ï¼ŒåŸæ–‡æ—¥æœŸï¼š2017-09-22&lt;br&gt;è¯‘è€…ï¼š&lt;a href=&quot;undefined&quot;&gt;BigNerdCoding&lt;/a&gt;ï¼›æ ¡å¯¹ï¼š&lt;a href=&quot;http://blog.yousanflics.com.cn&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Yousanflics&lt;/a&gt;ï¼Œ&lt;a href=&quot;http://numbbbbb.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;numbbbbb&lt;/a&gt;ï¼Œ&lt;a href=&quot;https://github.com/Cee&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Cee&lt;/a&gt;ï¼›å®šç¨¿ï¼š&lt;a href=&quot;https://github.com/chenmingbiao&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;CMB&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;!--æ­¤å¤„å¼€å§‹æ­£æ–‡--&gt;
&lt;p&gt;Swift å¼€æºä¸ä¹…æˆ‘å°±å†™äº†ç¯‡å…³äºå¼±å¼•ç”¨å®ç°çš„&lt;a href=&quot;https://mikeash.com/pyblog/friday-qa-2015-12-11-swift-weak-references.html&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;æ–‡ç« &lt;/a&gt;ã€‚æ—¶ç§»åŠ¿æ˜“ï¼ŒSwift 4 ä¸­çš„å¼±å¼•ç”¨å®ç°å·²ç»ä¸æ—§æ–‡ä¸ä¸€è‡´äº†ã€‚åº” Guillaume Lessard å»ºè®®ï¼Œä»Šå¤©æˆ‘å°†ä¼šä»‹ç»æ–°ç‰ˆå®ç°ï¼Œå¹¶æ¯”è¾ƒå…¶ä¸è€ç‰ˆçš„åŒºåˆ«ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="Mike Ash" scheme="https://swift.gg/categories/Mike-Ash/"/>
    
    
      <category term="Swift å…¥é—¨" scheme="https://swift.gg/tags/Swift-%E5%85%A5%E9%97%A8/"/>
    
  </entry>
  
  <entry>
    <title>æ„å»ºä¸€ä¸ª @synchronized</title>
    <link href="https://swift.gg/2018/07/30/friday-qa-2015-02-20-lets-build-synchronized/"/>
    <id>https://swift.gg/2018/07/30/friday-qa-2015-02-20-lets-build-synchronized/</id>
    <published>2018-07-30T00:00:00.000Z</published>
    <updated>2018-09-10T03:53:25.085Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ä½œè€…ï¼šMike Ashï¼Œ<a href="https://www.mikeash.com/pyblog/friday-qa-2015-02-20-lets-build-synchronized.html" target="_blank" rel="noopener">åŸæ–‡é“¾æ¥</a>ï¼ŒåŸæ–‡æ—¥æœŸï¼š2015-02-20<br>è¯‘è€…ï¼š<a href="undefined">Sunnyyoung</a>ï¼›æ ¡å¯¹ï¼š<a href="http://hulizhen.me" target="_blank" rel="noopener">æ™ºå¤šèŠ¯</a>ï¼›å®šç¨¿ï¼š<a href="http://numbbbbb.com/" target="_blank" rel="noopener">numbbbbb</a>ï¼Œ<a href="https://github.com/chenmingbiao" target="_blank" rel="noopener">CMB</a></p></blockquote><!--æ­¤å¤„å¼€å§‹æ­£æ–‡--><p>ä¸Šä¸€ç¯‡æ–‡ç« è®²äº†çº¿ç¨‹å®‰å…¨ï¼Œä»Šå¤©è¿™ç¯‡æœ€æ–°ä¸€æœŸçš„ Letâ€™s Build æˆ‘ä¼šæ¢è®¨ä¸€ä¸‹å¦‚ä½•å®ç° Objective-C ä¸­çš„ <code>@synchronized</code>ã€‚æœ¬æ–‡åŸºäº Swift å®ç°ï¼ŒObjective-C ç‰ˆæœ¬å¤§ä½“ä¸Šä¹Ÿå·®ä¸å¤šã€‚</p><a id="more"></a><h2 id="å›é¡¾"><a href="#å›é¡¾" class="headerlink" title="å›é¡¾"></a>å›é¡¾</h2><p><code>@synchronized</code> åœ¨ Objective-C ä¸­æ˜¯ä¸€ç§æ§åˆ¶ç»“æ„ã€‚å®ƒæ¥å—ä¸€ä¸ªå¯¹è±¡æŒ‡é’ˆä½œä¸ºå‚æ•°ï¼Œåé¢è·Ÿç€ä¸€æ®µä»£ç å—ã€‚å¯¹è±¡æŒ‡é’ˆå……å½“é”ï¼Œåœ¨ä»»ä½•æ—¶å€™ <code>@synchronized</code> ä»£ç å—ä¸­åªå…è®¸æœ‰ä¸€ä¸ªçº¿ç¨‹ä½¿ç”¨è¯¥å¯¹è±¡æŒ‡é’ˆã€‚</p><p>è¿™æ˜¯ä¸€ç§ä½¿ç”¨é”è¿›è¡Œå¤šçº¿ç¨‹ç¼–ç¨‹çš„ç®€å•æ–¹æ³•ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œä½ å¯ä»¥ä½¿ç”¨ <code>NSLock</code> æ¥ä¿æŠ¤å¯¹ NSMutableArray çš„æ“ä½œï¼š</p><figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="built_in">NSMutableArray</span> *array;</span><br><span class="line"><span class="built_in">NSLock</span> *arrayLock;</span><br><span class="line"></span><br><span class="line">[arrayLock lock];</span><br><span class="line">[array addObject: obj];</span><br><span class="line">[arrayLock unlock];</span><br></pre></td></tr></table></figure><p>ä¹Ÿå¯ä»¥ä½¿ç”¨ <code>@synchronized</code> æ¥å°†æ•°ç»„æœ¬èº«åŠ é”ï¼š</p><figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="keyword">@synchronized</span>(array) &#123;</span><br><span class="line">    [array addObject: obj];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä¸ªäººæ›´å–œæ¬¢æ˜¾å¼çš„é”ï¼Œè¿™æ ·åšæ—¢å¯ä»¥ä½¿äº‹æƒ…æ›´æ¸…æ¥šï¼Œ<code>@synchronized</code> çš„æ€§èƒ½æ²¡é‚£ä¹ˆå¥½ï¼ŒåŸå› å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ä½†å®ƒï¼ˆ<code>@synchronized</code>ï¼‰ä½¿ç”¨å¾ˆæ–¹ä¾¿ï¼Œä¸ç®¡æ€æ ·ï¼Œå®ç°èµ·æ¥éƒ½å¾ˆæœ‰æ„æ€ã€‚</p><h2 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h2><p>Swift ç‰ˆæœ¬çš„ <code>@synchronized</code> æ˜¯ä¸€ä¸ªå‡½æ•°ã€‚å®ƒæ¥å—ä¸€ä¸ªå¯¹è±¡å’Œä¸€ä¸ªé—­åŒ…ï¼Œå¹¶ä½¿ç”¨æŒæœ‰çš„é”è°ƒç”¨é—­åŒ…ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">synchronized</span><span class="params">(obj: AnyObject, f: Void -&gt; Void)</span></span> &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é—®é¢˜æ˜¯ï¼Œå¦‚ä½•å°†ä»»æ„å¯¹è±¡å˜æˆé”ï¼Ÿ</p><p>åœ¨ä¸€ä¸ªç†æƒ³çš„ä¸–ç•Œé‡Œï¼ˆä»å®ç°è¿™ä¸ªå‡½æ•°çš„è§’åº¦æ¥çœ‹ï¼‰ï¼Œæ¯ä¸ªå¯¹è±¡éƒ½ä¼šä¸ºé”ç•™å‡ºä¸€äº›é¢å¤–ç©ºé—´ã€‚åœ¨è¿™ä¸ªé¢å¤–çš„å°ç©ºé—´é‡Œ <code>synchronized</code> å¯ä»¥ä½¿ç”¨é€‚å½“çš„ <code>lock</code> å’Œ <code>unlock</code> æ–¹æ³•ã€‚ç„¶è€Œå®é™…ä¸Šå¹¶æ²¡æœ‰è¿™ç§é¢å¤–ç©ºé—´ã€‚è¿™å¯èƒ½æ˜¯ä»¶å¥½äº‹ï¼Œå› ä¸ºè¿™ä¼šå¢å¤§å¯¹è±¡å ç”¨çš„å†…å­˜ç©ºé—´ï¼Œä½†æ˜¯å¤§å¤šæ•°å¯¹è±¡æ°¸è¿œéƒ½ä¸ä¼šç”¨åˆ°è¿™ä¸ªç‰¹æ€§ã€‚</p><p>å¦ä¸€ç§æ–¹æ³•æ˜¯ç”¨ä¸€å¼ è¡¨æ¥è®°å½•å¯¹è±¡åˆ°é”çš„æ˜ å°„ã€‚<code>synchronized</code> å¯ä»¥æŸ¥æ‰¾è¡¨ä¸­çš„é”ï¼Œç„¶åæ‰§è¡Œ <code>lock</code> å’Œ <code>unlock</code> æ“ä½œã€‚è¿™ç§æ–¹æ³•çš„é—®é¢˜æ˜¯è¡¨æœ¬èº«éœ€è¦ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œå®ƒè¦ä¹ˆéœ€è¦è‡ªå·±çš„é”ï¼Œè¦ä¹ˆéœ€è¦æŸç§ç‰¹æ®Šçš„æ— é”æ•°æ®ç»“æ„ã€‚ä¸ºè¡¨å•ç‹¬è®¾ç½®ä¸€ä¸ªé”è¦å®¹æ˜“å¾—å¤šã€‚</p><p>ä¸ºäº†é˜²æ­¢é”ä¸æ–­ç´¯ç§¯å¸¸é©»ï¼Œè¡¨éœ€è¦è·Ÿè¸ªé”çš„ä½¿ç”¨æƒ…å†µï¼Œå¹¶åœ¨ä¸å†éœ€è¦é”çš„æ—¶å€™é”€æ¯æˆ–è€…å¤ç”¨ã€‚</p><h2 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h2><p>è¦å®ç°å°†å¯¹è±¡æ˜ å°„åˆ°é”çš„è¡¨ï¼Œ<code>NSMapTable</code> éå¸¸åˆé€‚ã€‚å®ƒå¯ä»¥æŠŠåŸå§‹å¯¹è±¡çš„åœ°å€è®¾ç½®æˆé”®ï¼ˆkeyï¼‰ï¼Œå¹¶ä¸”å¯ä»¥ä¿å­˜å¯¹é”®ï¼ˆkeyï¼‰å’Œå€¼ï¼ˆvalueï¼‰çš„å¼±å¼•ç”¨ï¼Œä»è€Œå…è®¸ç³»ç»Ÿè‡ªåŠ¨å›æ”¶æœªè¢«ä½¿ç”¨çš„é”ã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> locksTable = <span class="type">NSMapTable</span>.weakToWeakObjectsMapTable()</span><br></pre></td></tr></table></figure><p>è¡¨ä¸­å­˜å‚¨çš„å¯¹è±¡æ˜¯ <code>NSRecursiveLock</code> å®ä¾‹ã€‚å› ä¸ºå®ƒæ˜¯ä¸€ä¸ªç±»ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥ç”¨åœ¨ <code>NSMapTable</code> ä¸­ï¼Œè¿™ç‚¹ <code>pthread_mutex_t</code> å°±åšä¸åˆ°ã€‚<code>@synchronized</code> æ”¯æŒé€’å½’è¯­ä¹‰ï¼Œæˆ‘ä»¬çš„å®ç°ä¸€æ ·æ”¯æŒã€‚</p><p>è¡¨æœ¬èº«ä¹Ÿéœ€è¦ä¸€ä¸ªé”ã€‚è‡ªæ—‹é”ï¼ˆspinlockï¼‰åœ¨è¿™ç§æƒ…å†µä¸‹å¾ˆé€‚åˆä½¿ç”¨ï¼Œå› ä¸ºå¯¹è¡¨çš„è®¿é—®æ˜¯çŸ­æš‚çš„ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> locksTableLock = <span class="type">OS_SPINLOCK_INIT</span></span><br></pre></td></tr></table></figure><p>æœ‰äº†è¿™ä¸ªè¡¨ï¼Œæˆ‘ä»¬å°±å¯ä»¥å®ç°ä»¥ä¸‹æ–¹æ³•ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">synchronized</span><span class="params">(obj: AnyObject, f: Void -&gt; Void)</span></span> &#123;</span><br></pre></td></tr></table></figure><p>å®ƒæ‰€åšçš„ç¬¬ä¸€ä»¶äº‹å°±æ˜¯åœ¨ <code>locksTable</code> ä¸­æ‰¾å‡ºä¸ <code>obj</code> å¯¹åº”çš„é”ï¼Œæ‰§è¡Œæ“ä½œä¹‹å‰å¿…é¡»æŒæœ‰ <code>locksTableLock</code> é”ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="type">OSSpinLockLock</span>(&amp;locksTableLock)</span><br><span class="line"><span class="keyword">var</span> lock = locksTable.objectForKey(obj) <span class="keyword">as</span>! <span class="type">NSRecursiveLock</span>?</span><br></pre></td></tr></table></figure><p>å¦‚æœè¡¨ä¸­æ²¡æœ‰æ‰¾åˆ°å¯¹åº”é”ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªæ–°é”å¹¶ä¿å­˜åˆ°è¡¨ä¸­ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> lock == <span class="literal">nil</span> &#123;</span><br><span class="line">    lock = <span class="type">NSRecursiveLock</span>()</span><br><span class="line">    locksTable.setObject(lock!, forKey: obj)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ‰äº†é”ä¹‹åä¸»è¡¨é”å°±å¯ä»¥é‡Šæ”¾äº†ã€‚ä¸ºäº†é¿å…æ­»é”è¿™å¿…é¡»è¦åœ¨è°ƒç”¨ <code>f</code> ä¹‹å‰å®Œæˆï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="type">OSSpinLockUnlock</span>(&amp;locksTableLock)</span><br></pre></td></tr></table></figure><p>ç°åœ¨æˆ‘ä»¬å¯ä»¥è°ƒç”¨ <code>f</code> äº†ï¼Œåœ¨è°ƒç”¨å‰ååˆ†åˆ«è¿›è¡ŒåŠ é”å’Œè§£é”æ“ä½œï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">    lock!.lock()</span><br><span class="line">    f()</span><br><span class="line">    lock!.unlock()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å¯¹æ¯”è‹¹æœçš„æ–¹æ¡ˆ"><a href="#å¯¹æ¯”è‹¹æœçš„æ–¹æ¡ˆ" class="headerlink" title="å¯¹æ¯”è‹¹æœçš„æ–¹æ¡ˆ"></a>å¯¹æ¯”è‹¹æœçš„æ–¹æ¡ˆ</h2><p>è‹¹æœå®ç° <code>@synchronized</code> çš„æ–¹æ¡ˆå¯ä»¥åœ¨ Objective-C runtime æºç ä¸­æ‰¾åˆ°:</p><p><a href="http://www.opensource.apple.com/source/objc4/objc4-646/runtime/objc-sync.mm" target="_blank" rel="noopener">http://www.opensource.apple.com/source/objc4/objc4-646/runtime/objc-sync.mm</a></p><p>å®ƒçš„ä¸»è¦ç›®æ ‡æ˜¯æ€§èƒ½ï¼Œå› æ­¤ä¸åƒä¸Šé¢é‚£ä¸ªç©å…·èˆ¬çš„ä¾‹å­é‚£ä¹ˆç®€å•ã€‚å¯¹æ¯”å®ƒä»¬ä¹‹é—´æœ‰ä»€ä¹ˆå¼‚åŒæ˜¯ä¸€ä»¶éå¸¸æœ‰è¶£çš„äº‹ã€‚</p><p>åŸºæœ¬æ¦‚å¿µæ˜¯ç›¸åŒçš„ã€‚å­˜åœ¨ä¸€ä¸ªå…¨å±€è¡¨ï¼Œå®ƒå°†å¯¹è±¡æŒ‡é’ˆæ˜ å°„åˆ°é”ï¼Œç„¶åè¯¥é”åœ¨ <code>@synchronized</code> ä»£ç å—å‰åè¿›è¡ŒåŠ é”è§£é”æ“ä½œã€‚</p><p>å¯¹äºåº•å±‚çš„é”å¯¹è±¡ï¼ŒApple ä½¿ç”¨é…ç½®ä¸ºé€’å½’é”çš„ <code>pthread_mutex_t</code>ã€‚<code>NSRecursiveLock</code> å†…éƒ¨å¾ˆå¯èƒ½ä¹Ÿä½¿ç”¨äº† <code>pthread_mutex_t</code>ï¼Œç›´æ¥ä½¿ç”¨å°±çœå»äº†ä¸­é—´ç¯èŠ‚ï¼Œå¹¶é¿å…äº†è¿è¡Œæ—¶å¯¹ Foundation çš„ä¾èµ–ã€‚</p><p>è¡¨æœ¬èº«çš„å®ç°æ˜¯ä¸€ä¸ªé“¾è¡¨è€Œä¸æ˜¯ä¸€ä¸ªå“ˆå¸Œè¡¨ã€‚å¸¸è§çš„æƒ…å†µæ˜¯åœ¨ä»»ä½•ç»™å®šçš„æ—¶é—´é‡Œåªå­˜åœ¨å°‘æ•°å‡ ä¸ªé”ï¼Œæ‰€ä»¥é“¾è¡¨çš„æ€§èƒ½è¡¨ç°å¾ˆä¸é”™ï¼Œå¯èƒ½æ¯”å“ˆå¸Œè¡¨æ€§èƒ½æ›´å¥½ã€‚æ¯ä¸ªçº¿ç¨‹ç¼“å­˜äº†æœ€è¿‘åœ¨å½“å‰çº¿ç¨‹æŸ¥æ‰¾çš„é”ï¼Œä»è€Œè¿›ä¸€æ­¥æé«˜æ€§èƒ½ã€‚</p><p>è‹¹æœçš„å®ç°å¹¶ä¸æ˜¯åªæœ‰ä¸€ä¸ªå…¨å±€è¡¨ï¼Œè€Œæ˜¯åœ¨ä¸€ä¸ªæ•°ç»„é‡Œä¿å­˜äº† 16 ä¸ªè¡¨ã€‚å¯¹è±¡æ ¹æ®åœ°å€æ˜ å°„åˆ°ä¸åŒçš„è¡¨ï¼Œè¿™å‡å°‘äº†ä¸åŒå¯¹è±¡ <code>@synchronized</code> æ“ä½œå¯¼è‡´çš„ä¸å¿…è¦çš„èµ„æºç«äº‰ï¼Œå› ä¸ºå®ƒä»¬å¾ˆå¯èƒ½ä½¿ç”¨çš„æ˜¯ä¸¤ä¸ªä¸åŒçš„å…¨å±€è¡¨ã€‚</p><p>è‹¹æœçš„å®ç°æ²¡æœ‰ä½¿ç”¨å¼±æŒ‡é’ˆå¼•ç”¨ï¼ˆè¿™ä¼šå¤§é‡å¢åŠ é¢å¤–å¼€é”€ï¼‰ï¼Œè€Œæ˜¯ä¸ºæ¯ä¸ªé”ä¿ç•™ä¸€ä¸ªå†…éƒ¨çš„å¼•ç”¨è®¡æ•°ã€‚å½“å¼•ç”¨è®¡æ•°è¾¾åˆ°é›¶æ—¶ï¼Œè¯¥é”å¯ä»¥ç»™æ–°å¯¹è±¡é‡æ–°ä½¿ç”¨ã€‚æœªä½¿ç”¨çš„é”ä¸ä¼šè¢«é”€æ¯ï¼Œä½†å¤ç”¨æ„å‘³ç€åœ¨ä»»ä½•æ—¶é—´é”çš„æ€»æ•°éƒ½ä¸èƒ½è¶…è¿‡æ¿€æ´»é”çš„æ•°é‡ï¼Œä¹Ÿå°±æ˜¯è¯´é”çš„æ•°é‡ä¸éšç€æ–°å¯¹è±¡çš„åˆ›å»ºæ— é™åˆ¶å¢é•¿ã€‚</p><p>è‹¹æœçš„å®ç°æ–¹æ¡ˆéå¸¸å·§å¦™ï¼Œæ€§èƒ½ä¹Ÿä¸é”™ã€‚ä½†ä¸ä½¿ç”¨å•ç‹¬çš„æ˜¾å¼é”ç›¸æ¯”ï¼Œå®ƒä»ç„¶ä¼šå¸¦æ¥ä¸€äº›ä¸å¯é¿å…çš„é¢å¤–å¼€é”€ã€‚å°¤å…¶æ˜¯ï¼š</p><ol><li>å¦‚æœä¸ç›¸å…³çš„å¯¹è±¡åˆšå¥½è¢«åˆ†é…åˆ°åŒä¸€ä¸ªå…¨å±€è¡¨ä¸­ï¼Œé‚£ä¹ˆå®ƒä»¬ä»ç„¶å¯èƒ½å­˜åœ¨èµ„æºç«äº‰ã€‚</li><li>é€šå¸¸æƒ…å†µä¸‹åœ¨çº¿ç¨‹ç¼“å­˜ä¸­æŸ¥æ‰¾ä¸€ä¸ªä¸å­˜åœ¨çš„é”æ—¶ï¼Œå¿…é¡»è·å–å¹¶é‡Šæ”¾ä¸€ä¸ªè‡ªæ—‹é”ã€‚</li><li>å¿…é¡»åšæ›´å¤šçš„å·¥ä½œæ¥æŸ¥æ‰¾å…¨å±€è¡¨ä¸­å¯¹è±¡çš„é”ã€‚</li><li>å³ä½¿ä¸éœ€è¦ï¼Œæ¯ä¸ªåŠ é”/è§£é”å‘¨æœŸéƒ½ä¼šäº§ç”Ÿé€’å½’è¯­ä¹‰æ–¹é¢çš„å¼€é”€ã€‚</li></ol><h2 id="ç»“è®º"><a href="#ç»“è®º" class="headerlink" title="ç»“è®º"></a>ç»“è®º</h2><p><code>@synchronized</code> æ˜¯ä¸€ä¸ªæœ‰è¶£çš„è¯­è¨€ç»“æ„ï¼Œå®ç°èµ·æ¥å¹¶ä¸ç®€å•ã€‚å®ƒçš„ä½œç”¨æ˜¯å®ç°çº¿ç¨‹å®‰å…¨ï¼Œä½†å®ƒçš„å®ç°æœ¬èº«ä¹Ÿéœ€è¦åŒæ­¥æ“ä½œæ¥ä¿è¯çº¿ç¨‹å®‰å…¨ã€‚æˆ‘ä»¬ä½¿ç”¨å…¨å±€é”æ¥ä¿æŠ¤å¯¹é”è¡¨çš„è®¿é—®ï¼Œè‹¹æœçš„å®ç°ä¸­åˆ™ä½¿ç”¨ä¸åŒçš„æŠ€å·§æ¥æé«˜æ€§èƒ½ã€‚</p><blockquote><p>æœ¬æ–‡ç”± SwiftGG ç¿»è¯‘ç»„ç¿»è¯‘ï¼Œå·²ç»è·å¾—ä½œè€…ç¿»è¯‘æˆæƒï¼Œæœ€æ–°æ–‡ç« è¯·è®¿é—® <a href="http://swift.gg">http://swift.gg</a>ã€‚</p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;ä½œè€…ï¼šMike Ashï¼Œ&lt;a href=&quot;https://www.mikeash.com/pyblog/friday-qa-2015-02-20-lets-build-synchronized.html&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;åŸæ–‡é“¾æ¥&lt;/a&gt;ï¼ŒåŸæ–‡æ—¥æœŸï¼š2015-02-20&lt;br&gt;è¯‘è€…ï¼š&lt;a href=&quot;undefined&quot;&gt;Sunnyyoung&lt;/a&gt;ï¼›æ ¡å¯¹ï¼š&lt;a href=&quot;http://hulizhen.me&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;æ™ºå¤šèŠ¯&lt;/a&gt;ï¼›å®šç¨¿ï¼š&lt;a href=&quot;http://numbbbbb.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;numbbbbb&lt;/a&gt;ï¼Œ&lt;a href=&quot;https://github.com/chenmingbiao&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;CMB&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;!--æ­¤å¤„å¼€å§‹æ­£æ–‡--&gt;
&lt;p&gt;ä¸Šä¸€ç¯‡æ–‡ç« è®²äº†çº¿ç¨‹å®‰å…¨ï¼Œä»Šå¤©è¿™ç¯‡æœ€æ–°ä¸€æœŸçš„ Letâ€™s Build æˆ‘ä¼šæ¢è®¨ä¸€ä¸‹å¦‚ä½•å®ç° Objective-C ä¸­çš„ &lt;code&gt;@synchronized&lt;/code&gt;ã€‚æœ¬æ–‡åŸºäº Swift å®ç°ï¼ŒObjective-C ç‰ˆæœ¬å¤§ä½“ä¸Šä¹Ÿå·®ä¸å¤šã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="Mike Ash" scheme="https://swift.gg/categories/Mike-Ash/"/>
    
    
      <category term="iOS å¼€å‘" scheme="https://swift.gg/tags/iOS-%E5%BC%80%E5%8F%91/"/>
    
  </entry>
  
  <entry>
    <title>Block å½¢å¼çš„é€šçŸ¥ä¸­å¿ƒè§‚å¯Ÿè€…æ˜¯å¦éœ€è¦æ‰‹åŠ¨æ³¨é”€</title>
    <link href="https://swift.gg/2018/07/26/notificationcenter-removeobserver/"/>
    <id>https://swift.gg/2018/07/26/notificationcenter-removeobserver/</id>
    <published>2018-07-26T00:00:00.000Z</published>
    <updated>2018-09-10T03:53:25.085Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ä½œè€…ï¼šOle Begemannï¼Œ<a href="https://oleb.net/blog/2018/01/notificationcenter-removeobserver/" target="_blank" rel="noopener">åŸæ–‡é“¾æ¥</a>ï¼ŒåŸæ–‡æ—¥æœŸï¼š2018-01-05<br>è¯‘è€…ï¼š<a href="undefined">BigNerdCoding</a>ï¼›æ ¡å¯¹ï¼š<a href="http://www.jianshu.com/users/596f2ba91ce9/latest_articles" target="_blank" rel="noopener">pmst</a>ï¼›å®šç¨¿ï¼š<a href="https://github.com/chenmingbiao" target="_blank" rel="noopener">CMB</a></p></blockquote><!--æ­¤å¤„å¼€å§‹æ­£æ–‡--><p>ç®€å•å›ç­”ï¼šéœ€è¦ ï¼ˆåœ¨ iOS 11.2 ä¸ŠéªŒè¯è¿‡ï¼‰</p><p>å‡ å‘¨ä¹‹å‰ï¼Œæˆ‘åœ¨ twitter ä¸Šæå‡ºäº†ä¸€ä¸ª<a href="https://twitter.com/olebegemann/status/938085544780877824" target="_blank" rel="noopener">é—®é¢˜</a>ï¼š</p><blockquote><p>åœ¨ iOS 11 ä¸­æ˜¯å¦è¿˜éœ€è¦æ‰‹åŠ¨ç§»é™¤åŸºäº block å½¢å¼çš„é€šçŸ¥è§‚å¯Ÿè€…ï¼Ÿè‹¹æœå¼€å‘æ–‡æ¡£ä¸­æ¯”è¾ƒæ¨¡ç³Šã€‚<a href="https://developer.apple.com/documentation/foundation/notificationcenter/1411723-addobserver" target="_blank" rel="noopener"><code>addObserver(forName:object:queue:using:)</code></a> ä¸­è¯´éœ€è¦ï¼Œè€Œ <a href="https://developer.apple.com/documentation/foundation/notificationcenter/1413994-removeobserver" target="_blank" rel="noopener"><code>removeObserver(_:)</code></a> ä¸­åˆè¡¨æ˜ iOS 9 ä¹‹åéƒ½ä¸åœ¨éœ€è¦ã€‚</p></blockquote><p>è™½ç„¶æˆ‘æ²¡æœ‰ç»Ÿè®¡å‡†ç¡®çš„æ•°å­—ï¼Œä½†æ˜¯å¤§è‡´çœ‹æ¥æŒä¸åŒæ„è§çš„äººå·®ä¸å¤šäº”äº”å¼€ã€‚</p><p>æ‰€ä»¥ä¸‹é¢æˆ‘ä»¬å°±æ¥å…·ä½“æµ‹è¯•éªŒè¯ä¸€ä¸‹ã€‚</p><a id="more"></a><h2 id="é—®é¢˜"><a href="#é—®é¢˜" class="headerlink" title="é—®é¢˜"></a>é—®é¢˜</h2><p>é¦–å…ˆï¼Œæˆ‘æ‰€è¯´çš„åŸºäº block çš„æ¥å£å£°æ˜æ˜¯ <a href="https://developer.apple.com/documentation/foundation/notificationcenter/1411723-addobserver" target="_blank" rel="noopener"><code>NotificationCenter.addObserver(forName: object: queue: using:)</code></a> ã€‚ä½¿ç”¨è¯¥ API æˆ‘ä»¬åœ¨é€šçŸ¥ä¸­å¿ƒæ³¨å†Œäº†ä¸€ä¸ªå‡½æ•°ç”¨äºå¤„ç†å¯¹åº”çš„é€šçŸ¥ï¼Œå¹¶ä¸”å¾—åˆ°ä¸€ä¸ªè¡¨ç¤ºè§‚å¯Ÿè€…çš„è¿”å›å€¼ã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyObserver</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> observation: <span class="type">Any</span>? = <span class="literal">nil</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">init</span>() &#123;</span><br><span class="line">        observation = <span class="type">NotificationCenter</span>.<span class="keyword">default</span>.addObserver(</span><br><span class="line">            forName: myNotification, object: <span class="literal">nil</span>, queue: <span class="literal">nil</span>) &#123; notification <span class="keyword">in</span></span><br><span class="line">                <span class="built_in">print</span>(<span class="string">"Received <span class="subst">\(notification.name.rawValue)</span>"</span>)</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é—®é¢˜æ˜¯ï¼šå½“ä»£ç ä¸­çš„è¿”å›å€¼ <em>observation</em> é”€æ¯æ—¶ï¼ˆä¾‹å¦‚ï¼ŒMyObserver å®ä¾‹å¯¹è±¡ææ„äº†ï¼‰ï¼Œé€šçŸ¥ä¸­å¿ƒä¼šä¸ä¼šè‡ªåŠ¨å¿½ç•¥å¹¶åœæ­¢è°ƒç”¨å¤„ç†å‡½æ•°å‘¢ï¼Ÿæ¯•ç«ŸåŸºäº <a href="https://developer.apple.com/documentation/swift/key_path_expressions" target="_blank" rel="noopener">KeyPath</a> çš„ <a href="http://skyefreeman.io/programming/2017/06/28/kvo-in-ios11.html" target="_blank" rel="noopener">KVO æ–°æ¥å£</a>å½“è§‚å¯Ÿè€…é”€æ¯åï¼Œå“åº”å¤„ç†ä¸å†è¢«è°ƒç”¨ï¼Œæ‰€ä»¥é€šçŸ¥å¯èƒ½ä¹Ÿè¢«ç†è§£æˆæ˜¯è¿™æ ·è¿›è¡Œçš„ã€‚</p><p>æˆ–è€…ï¼Œæˆ‘ä»¬ä¾æ—§éœ€è¦æ‰‹åŠ¨è°ƒç”¨ <a href="https://developer.apple.com/documentation/foundation/notificationcenter/1413994-removeobserver" target="_blank" rel="noopener"><code>NotificationCenter.removeObserver(_:)</code></a>ï¼ˆä¾‹å¦‚ï¼Œåœ¨ MyObserver çš„ææ„å‡½æ•° <strong>deinit</strong> æ‰‹åŠ¨æ³¨é”€ï¼‰ï¼Ÿ</p><h2 id="æ–‡æ¡£ä¸­çš„è¯´æ˜"><a href="#æ–‡æ¡£ä¸­çš„è¯´æ˜" class="headerlink" title="æ–‡æ¡£ä¸­çš„è¯´æ˜"></a>æ–‡æ¡£ä¸­çš„è¯´æ˜</h2><p>åŸºäº selector å½¢å¼çš„è§‚å¯Ÿæ¥å£ <a href="https://developer.apple.com/documentation/foundation/notificationcenter/1415360-addobserver" target="_blank" rel="noopener"><code>addObserver(_:selector:name:object:)</code></a> çš„æ‰‹åŠ¨æ³¨é”€æ“ä½œåœ¨ iOS 9 å’Œ OSX 10.11 ä¹‹åå·²ç»å˜æˆå¯é€‰äº†ã€‚ç„¶è€Œåœ¨ <a href="https://developer.apple.com/library/archive/releasenotes/Foundation/RN-FoundationOlderNotes/index.html#10_11NotificationCenter" target="_blank" rel="noopener">Foundation å‘å¸ƒæ³¨æ„äº‹é¡¹</a>ä¸­æ˜ç¡®è¡¨æ˜ Block å½¢å¼çš„æ¥å£ä¾ç„¶éœ€è¦è¿›è¡Œæ‰‹åŠ¨æ³¨é”€æ“ä½œã€‚</p><blockquote><p>é€šè¿‡ <code>-[NSNotificationCenter addObserverForName:object:queue:usingBlock:_]</code> å½¢å¼æ·»åŠ çš„blockç±»å‹è§‚å¯Ÿè€…åœ¨æ— ç”¨æ—¶ä¾ç„¶éœ€è¦è¿›è¡Œæ³¨é”€æ“ä½œï¼Œå› ä¸ºç³»ç»Ÿä¼šä¿ç•™å¯¹è¯¥è§‚å¯Ÿè€…çš„å¼ºå¼•ç”¨ã€‚</p></blockquote><p>è¯¥æ–‡æ¡£å‘å¸ƒä¹‹åæ˜¯å¦å­˜åœ¨æ–°å˜åŒ–å‘¢ï¼Ÿ</p><p>åœ¨ <a href="https://developer.apple.com/documentation/foundation/notificationcenter/1411723-addobserver" target="_blank" rel="noopener"><code>addObserver(forName:object:queue:using:)</code></a> æ–‡æ¡£è¯´æ˜éƒ¨åˆ†ä¹Ÿæ˜ç¡®æŒ‡å‡ºäº†æ³¨é”€æ“ä½œæ˜¯å¿…è¦çš„ï¼š</p><blockquote><p>æ‰€æœ‰é€šè¿‡ <code>addObserver(forName:object:queue:using:)</code> åˆ›å»ºçš„è§‚å¯Ÿè€…åœ¨ææ„ä¹‹å‰éƒ½éœ€è¦è°ƒç”¨ <a href="https://developer.apple.com/documentation/foundation/notificationcenter/1413994-removeobserver" target="_blank" rel="noopener"><code>removeObserver(_:)</code></a> æˆ–è€… <a href="https://developer.apple.com/documentation/foundation/notificationcenter/1407263-removeobserver" target="_blank" rel="noopener"><code>removeObserver(_:name:object:)</code></a> è¿›è¡Œæ³¨é”€æ“ä½œã€‚</p></blockquote><p>ç„¶è€Œ <a href="https://developer.apple.com/documentation/foundation/notificationcenter/1413994-removeobserver" target="_blank" rel="noopener"><code>removeObserver(_:)</code></a> æ–‡æ¡£è¯´æ˜å¤„ä¼¼ä¹ä¸ä¹‹ç›¸åï¼š</p><blockquote><p>å¦‚æœä½ çš„ APP è¿è¡Œåœ¨ iOS 9 æˆ–è€… macOS 10.11 åŠæœ€æ–°çš„ç‰ˆæœ¬ä¸Šçš„è¯åˆ™ä¸éœ€è¦æ³¨é”€è¿™ä¸ªè§‚å¯Ÿè€…åœ¨å®ƒçš„ææ„æ–¹æ³•ã€‚</p></blockquote><p>è¯¥æ–‡æ¡£ä¸­å¹¶æ²¡æœ‰å¯¹ selector æˆ–è€… block è¿›è¡ŒåŒºåˆ†è¯´æ˜ï¼Œä¹Ÿå°±æ˜¯è¯´è¯¥æ“ä½œåŒæ—¶é€‚ç”¨äºä¸¤è€…ã€‚</p><h2 id="è¿›è¡Œæµ‹è¯•éªŒè¯"><a href="#è¿›è¡Œæµ‹è¯•éªŒè¯" class="headerlink" title="è¿›è¡Œæµ‹è¯•éªŒè¯"></a>è¿›è¡Œæµ‹è¯•éªŒè¯</h2><p>é€šè¿‡æˆ‘å†™çš„<a href="https://github.com/ole/NotificationUnregistering" target="_blank" rel="noopener">æµ‹è¯•åº”ç”¨</a>ï¼Œä½ å¯ä»¥å¾—åˆ°éªŒè¯ä¸Šè¯‰é—®é¢˜ï¼ˆé€šè¿‡ Xcode çš„ç»ˆç«¯è¾“å‡ºï¼‰ã€‚</p><p>ä¸‹é¢æ˜¯æˆ‘å‘ç°çš„ï¼š</p><ul><li>åŸºäºblock å½¢å¼çš„è§‚å¯Ÿè€…ä¾ç„¶éœ€è¦è¿›è¡Œæ‰‹åŠ¨æ³¨é”€æ“ä½œï¼ˆå³ä½¿åœ¨ iOS 11.2 ä¸Šï¼‰ï¼Œæ‰€ä»¥ <code>removeObserver (_:)</code> æ–‡æ¡£å­˜åœ¨æ˜æ˜¾çš„è¯¯å¯¼ã€‚</li><li>å¦‚æœæ²¡æœ‰è¿›è¡Œæ³¨é”€æ“ä½œçš„è¯ï¼Œé‚£ä¹ˆ block å°±ä¼šè¢«ä¸€ç›´æŒæœ‰è€Œä¸”ä¾ç„¶èƒ½å¤Ÿè¢«ç›¸å…³é€šçŸ¥è§¦å‘æ‰§è¡Œã€‚æ­¤æ—¶è¯¥è¡Œä¸ºå¯¹ APP çš„æ½œåœ¨å¨èƒå–å†³äº block å†…éƒ¨æŒæœ‰çš„å¯¹è±¡ã€‚</li><li>å³ä½¿ä½ åœ¨ <em>deinit</em> ä¸­è°ƒç”¨äº†æ³¨é”€æ“ä½œï¼Œä½ ä¾æ—§éœ€è¦æ³¨æ„ block ä¸­ä¸èƒ½æ•è· self å¼•ç”¨ï¼Œå¦åˆ™ä¼šé€ æˆå¾ªç¯å¼•ç”¨æ­¤æ—¶ <em>deinit</em> ä¹Ÿæ°¸è¿œä¸ä¼šå¾—åˆ°æ‰§è¡Œã€‚</li></ul><h2 id="è‡ªåŠ¨æ³¨é”€"><a href="#è‡ªåŠ¨æ³¨é”€" class="headerlink" title="è‡ªåŠ¨æ³¨é”€"></a>è‡ªåŠ¨æ³¨é”€</h2><p>å¤„ç†è¿™ä¸ªé—®é¢˜æœ€å¥½çš„æ–¹å¼æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿæˆ‘çš„å»ºè®®æ˜¯ï¼šå¯¹è§‚å¯Ÿå¯¹è±¡è¿›è¡Œä¸€æ¬¡å°è£…ã€‚è¯¥å°è£…ç±»å‹çš„æŒ‡è´£å°±æ˜¯ä¿æŒè§‚å¯Ÿè€…å¯¹è±¡å¹¶ä¸”åœ¨ææ„å‡½æ•°ä¸­è‡ªåŠ¨å°†å…¶æ³¨é”€ã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">/// Wraps the observer token received from </span></span><br><span class="line"><span class="comment">/// NotificationCenter.addObserver(forName:object:queue:using:)</span></span><br><span class="line"><span class="comment">/// and unregisters it in deinit.</span></span><br><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">NotificationToken</span>: <span class="title">NSObject</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> notificationCenter: <span class="type">NotificationCenter</span></span><br><span class="line">    <span class="keyword">let</span> token: <span class="type">Any</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">init</span>(notificationCenter: <span class="type">NotificationCenter</span> = .<span class="keyword">default</span>, token: <span class="type">Any</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.notificationCenter = notificationCenter</span><br><span class="line">        <span class="keyword">self</span>.token = token</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">deinit</span> &#123;</span><br><span class="line">        notificationCenter.removeObserver(token)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€šè¿‡å°è£…å¤„ç†ï¼Œæˆ‘ä»¬å°†è§‚å¯Ÿè€…çš„ç”Ÿå‘½å‘¨æœŸå’Œè¯¥ç±»å‹å®ä¾‹è¿›è¡Œäº†ç»‘å®šã€‚æ¥ä¸‹æ¥æˆ‘ä»¬åªéœ€è¦å°†è¯¥å°è£…ç±»å‹å®ä¾‹é€šè¿‡ç§æœ‰å±æ€§è¿›è¡Œä¿å­˜ï¼Œé‚£ä¹ˆå…¶æŒæœ‰è€…å°±ä¼š <em>deinit</em> è§¦å‘æ—¶é”€æ¯è¯¥å°è£…å®ä¾‹ç´§æ¥ç€é”€æ¯è§‚å¯Ÿè€…å®ä¾‹å¯¹è±¡ã€‚è¿™æ ·å°±ä¸éœ€è¦åœ¨ä»£ç ä¸­å¯¹å…¶è¿›è¡Œæ‰‹åŠ¨æ³¨é”€æ“ä½œäº†ã€‚å¦å¤–æˆ‘ä»¬è¿˜å¯ä»¥å°†è¯¥å®ä¾‹å£°æ˜ä¸º <code>Optional &lt;Notificationâ€‹Token&gt;</code> ï¼Œè¿™æ ·é€šè¿‡å°†å…¶è®¾ç½®ä¸º nil ä¹Ÿèƒ½è¿›è¡Œæ‰‹åŠ¨æ³¨é”€æ“ä½œã€‚è¯¥æ¨¡å¼è¢«ç§°ä¸º<a href="https://en.wikipedia.org/wiki/Resource_acquisition_is_initialization" target="_blank" rel="noopener"> <strong>èµ„æºè·å–å³åˆå§‹åŒ–</strong> ï¼ˆRAIIï¼‰</a>ã€‚</p><p>æ¥ä¸‹æ¥è®©æˆ‘ä»¬ä¸º <code>NotificationCenter</code> ç¼–å†™ä¸€ä¸ªä¾¿åˆ©ç‚¹çš„æ–¹æ³•ï¼Œå®ƒä¸ºæˆ‘ä»¬æ‰¿æ‹…äº†åŒ…è£…è§‚å¯Ÿæ¥å£çš„ä»»åŠ¡ã€‚ </p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">NotificationCenter</span> </span>&#123;</span><br><span class="line">    <span class="comment">/// Convenience wrapper for addObserver(forName:object:queue:using:)</span></span><br><span class="line">    <span class="comment">/// that returns our custom NotificationToken.</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">observe</span><span class="params">(name: NSNotification.Name?, object obj: Any?, </span></span></span><br><span class="line"><span class="function"><span class="params">    queue: OperationQueue?, using block: @escaping <span class="params">(Notification)</span></span></span> -&gt; ())</span><br><span class="line">    -&gt; <span class="type">NotificationToken</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">let</span> token = addObserver(forName: name, object: obj, queue: queue, using: block)</span><br><span class="line">        <span class="keyword">return</span> <span class="type">NotificationToken</span>(notificationCenter: <span class="keyword">self</span>, token: token)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœæ­¤æ—¶å°†åŸæœ‰çš„ <code>addObserver(forName:â€‹object:â€‹queue:â€‹using:)</code> æ›¿æ¢ä¸ºæ–° API ï¼Œå¹¶å°†å¾—åˆ° <em>NotificationToken</em> å®ä¾‹é€šè¿‡å±æ€§ä¿å­˜çš„è¯ï¼Œä½ å°†ä¸å†éœ€è¦æ‰‹åŠ¨æ³¨é”€æ“ä½œäº†ã€‚</p><p>Chris å’Œ Florian ä¹Ÿåœ¨ <a href="https://talk.objc.io/episodes/S01E27-typed-notifications-part-1" target="_blank" rel="noopener"><strong>Swift Talk episode 27: Typed Notifications</strong></a> ä¸­æåˆ°è¿‡è¯¥æŠ€æœ¯ï¼Œæˆ‘å‘ä½ å¼ºçƒˆçš„æ¨èå®ƒã€‚</p><blockquote><p>æœ¬æ–‡ç”± SwiftGG ç¿»è¯‘ç»„ç¿»è¯‘ï¼Œå·²ç»è·å¾—ä½œè€…ç¿»è¯‘æˆæƒï¼Œæœ€æ–°æ–‡ç« è¯·è®¿é—® <a href="http://swift.gg">http://swift.gg</a>ã€‚</p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;ä½œè€…ï¼šOle Begemannï¼Œ&lt;a href=&quot;https://oleb.net/blog/2018/01/notificationcenter-removeobserver/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;åŸæ–‡é“¾æ¥&lt;/a&gt;ï¼ŒåŸæ–‡æ—¥æœŸï¼š2018-01-05&lt;br&gt;è¯‘è€…ï¼š&lt;a href=&quot;undefined&quot;&gt;BigNerdCoding&lt;/a&gt;ï¼›æ ¡å¯¹ï¼š&lt;a href=&quot;http://www.jianshu.com/users/596f2ba91ce9/latest_articles&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;pmst&lt;/a&gt;ï¼›å®šç¨¿ï¼š&lt;a href=&quot;https://github.com/chenmingbiao&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;CMB&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;!--æ­¤å¤„å¼€å§‹æ­£æ–‡--&gt;
&lt;p&gt;ç®€å•å›ç­”ï¼šéœ€è¦ ï¼ˆåœ¨ iOS 11.2 ä¸ŠéªŒè¯è¿‡ï¼‰&lt;/p&gt;
&lt;p&gt;å‡ å‘¨ä¹‹å‰ï¼Œæˆ‘åœ¨ twitter ä¸Šæå‡ºäº†ä¸€ä¸ª&lt;a href=&quot;https://twitter.com/olebegemann/status/938085544780877824&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;é—®é¢˜&lt;/a&gt;ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;åœ¨ iOS 11 ä¸­æ˜¯å¦è¿˜éœ€è¦æ‰‹åŠ¨ç§»é™¤åŸºäº block å½¢å¼çš„é€šçŸ¥è§‚å¯Ÿè€…ï¼Ÿè‹¹æœå¼€å‘æ–‡æ¡£ä¸­æ¯”è¾ƒæ¨¡ç³Šã€‚&lt;a href=&quot;https://developer.apple.com/documentation/foundation/notificationcenter/1411723-addobserver&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;&lt;code&gt;addObserver(forName:object:queue:using:)&lt;/code&gt;&lt;/a&gt; ä¸­è¯´éœ€è¦ï¼Œè€Œ &lt;a href=&quot;https://developer.apple.com/documentation/foundation/notificationcenter/1413994-removeobserver&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;&lt;code&gt;removeObserver(_:)&lt;/code&gt;&lt;/a&gt; ä¸­åˆè¡¨æ˜ iOS 9 ä¹‹åéƒ½ä¸åœ¨éœ€è¦ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;è™½ç„¶æˆ‘æ²¡æœ‰ç»Ÿè®¡å‡†ç¡®çš„æ•°å­—ï¼Œä½†æ˜¯å¤§è‡´çœ‹æ¥æŒä¸åŒæ„è§çš„äººå·®ä¸å¤šäº”äº”å¼€ã€‚&lt;/p&gt;
&lt;p&gt;æ‰€ä»¥ä¸‹é¢æˆ‘ä»¬å°±æ¥å…·ä½“æµ‹è¯•éªŒè¯ä¸€ä¸‹ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="Ole Begemann" scheme="https://swift.gg/categories/Ole-Begemann/"/>
    
    
      <category term="iOS å¼€å‘" scheme="https://swift.gg/tags/iOS-%E5%BC%80%E5%8F%91/"/>
    
  </entry>
  
  <entry>
    <title>åœ¨ Swift ä¸­ä½¿ç”¨é©¬å°”å¯å¤«é“¾ç”Ÿæˆæ–‡æœ¬</title>
    <link href="https://swift.gg/2018/07/23/friday-qa-2018-04-27-generating-text-with-markov-chains-in-swift/"/>
    <id>https://swift.gg/2018/07/23/friday-qa-2018-04-27-generating-text-with-markov-chains-in-swift/</id>
    <published>2018-07-23T00:00:00.000Z</published>
    <updated>2018-09-10T03:53:25.085Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ä½œè€…ï¼šMike Ashï¼Œ<a href="https://www.mikeash.com/pyblog/friday-qa-2018-04-27-generating-text-with-markov-chains-in-swift.html" target="_blank" rel="noopener">åŸæ–‡é“¾æ¥</a>ï¼ŒåŸæ–‡æ—¥æœŸï¼š2018-04-28<br>è¯‘è€…ï¼š<a href="http://wuqiuhao.github.io" target="_blank" rel="noopener">Hale</a>ï¼›æ ¡å¯¹ï¼š<a href="http://numbbbbb.com/" target="_blank" rel="noopener">numbbbbb</a>ï¼Œ<a href="http://www.jianshu.com/u/2d46948e84e3" target="_blank" rel="noopener">mmoaay</a>ï¼Œ<a href="https://github.com/Cee" target="_blank" rel="noopener">Cee</a>ï¼›å®šç¨¿ï¼š<a href="https://github.com/chenmingbiao" target="_blank" rel="noopener">CMB</a></p></blockquote><!--æ­¤å¤„å¼€å§‹æ­£æ–‡--><p>é©¬å°”å¯å¤«é“¾å¯ç”¨äºå¿«é€Ÿç”ŸæˆçœŸå®ä½†æ— æ„ä¹‰çš„æ–‡æœ¬ã€‚ä»Šå¤©ï¼Œæˆ‘å°†ä½¿ç”¨è¿™ç§æŠ€æœ¯æ¥åˆ›å»ºä¸€ä¸ªåŸºäºè¿™ç¯‡åšå®¢å†…å®¹çš„æ–‡æœ¬ç”Ÿæˆå™¨ã€‚è¿™ä¸ªçµæ„Ÿæ¥æºäºè¯»è€… Jordan Pittmanã€‚</p><a id="more"></a><h2 id="é©¬å°”å¯å¤«é“¾"><a href="#é©¬å°”å¯å¤«é“¾" class="headerlink" title="é©¬å°”å¯å¤«é“¾"></a>é©¬å°”å¯å¤«é“¾</h2><p>ç†è®ºä¸Šè®²ï¼Œé©¬å°”å¯å¤«é“¾æ˜¯ä¸€ç§çŠ¶æ€æœºï¼Œæ¯ä¸€ä¸ªçŠ¶æ€è½¬æ¢éƒ½æœ‰ä¸€ä¸ªä¸ä¹‹ç›¸å…³çš„æ¦‚ç‡ã€‚ä½ å¯ä»¥é€‰æ‹©ä¸€ä¸ªèµ·å§‹çŠ¶æ€ï¼Œç„¶åéšæœºåœ°è½¬æ¢æˆå…¶ä»–çŠ¶æ€ï¼Œé€šè¿‡è½¬ç§»æ¦‚ç‡æ¥åŠ æƒï¼Œç›´åˆ°åˆ°è¾¾ä¸€ä¸ªç»ˆæ­¢çŠ¶æ€ã€‚</p><p>é©¬å°”å¯å¤«é“¾æœ‰ç€<a href="https://en.wikipedia.org/wiki/Markov_chain#Steady-state_analysis_and_limiting_distributions" target="_blank" rel="noopener">å¹¿æ³›çš„åº”ç”¨</a>ï¼Œä½†æœ€æœ‰è¶£çš„æ˜¯ç”¨äºæ–‡æœ¬ç”Ÿæˆã€‚åœ¨æœ¬æ–‡ç”Ÿæˆé¢†åŸŸï¼Œæ¯ä¸ªçŠ¶æ€æ˜¯æ–‡æœ¬çš„ä¸€éƒ¨åˆ†ï¼Œé€šå¸¸æ˜¯ä¸€ä¸ªå•è¯ã€‚çŠ¶æ€å’Œè½¬æ¢æ˜¯ç”±ä¸€äº›è¯­æ–™åº“ç”Ÿæˆçš„ï¼Œç„¶åéå†æ•´ä¸ªé“¾å¹¶ä¸ºæ¯ä¸ªçŠ¶æ€è¾“å‡ºå•è¯æ¥ç”Ÿæˆæ–‡æœ¬ã€‚è¿™æ ·ç”Ÿæˆçš„æ–‡æœ¬é€šå¸¸æ²¡æœ‰å®é™…æ„ä¹‰ï¼Œå› ä¸ºè¯¥é“¾ä¸åŒ…å«è¶³å¤Ÿçš„ä¿¡æ¯æ¥ä¿ç•™è¯­æ–™åº“çš„ä»»ä½•æ½œåœ¨å«ä¹‰åŠè¯­æ³•ç»“æ„ï¼Œä½†æ˜¯ç¼ºä¹æ„ä¹‰æœ¬èº«å´ç»™æ–‡æœ¬å¸¦æ¥äº†æ„æ–™ä¹‹å¤–çš„ä¹è¶£ã€‚</p><h2 id="æ„å»ºç®—æ³•"><a href="#æ„å»ºç®—æ³•" class="headerlink" title="æ„å»ºç®—æ³•"></a>æ„å»ºç®—æ³•</h2><p>é“¾ä¸­çš„èŠ‚ç‚¹ç”± <code>Word</code> ç±»çš„å®ä¾‹è¡¨ç¤ºï¼Œæ­¤ç±»å°†ä¼šä¸ºå®ƒæ‰€è¡¨ç¤ºçš„å•è¯ä¿å­˜ä¸€ä¸ªå­—ç¬¦ä¸²ï¼ŒåŒæ—¶æŒæœ‰ä¸€ç»„æŒ‡å‘å…¶ä»–å•è¯çš„é“¾æ¥ã€‚</p><p>æˆ‘ä»¬å¦‚ä½•è¡¨ç¤ºè¿™ä¸€ç»„é“¾æ¥å‘¢ï¼Ÿæœ€ç›´æ¥çš„æ–¹æ³•æ˜¯é‡‡ç”¨æŸç§è®¡æ•°çš„é›†åˆï¼Œå®ƒå°†å­˜å‚¨å…¶ä»– <code>Word</code> å®ä¾‹ä»¥åŠåœ¨è¾“å…¥è¯­æ–™åº“ä¸­è½¬æ¢æ¬¡æ•°çš„è®¡æ•°ã€‚ä¸è¿‡ï¼Œä»è¿™æ ·ä¸€ä¸ªé›†åˆä¸­éšæœºé€‰æ‹©ä¸€ä¸ªé“¾æ¥å¯èƒ½ä¼šéå¸¸æ£˜æ‰‹ã€‚ä¸€ä¸ªç®€å•çš„æ–¹æ³•æ˜¯ç”Ÿæˆä¸€ä¸ªèŒƒå›´ä» 0 åˆ°é›†åˆå…ƒç´ æ€»è®¡æ•°ä¹‹é—´çš„éšæœºæ•°ï¼Œç„¶åéå†è¯¥é›†åˆç›´åˆ°å–åˆ°å¾ˆå¤šçš„é“¾æ¥ï¼Œç„¶åé€‰ä¸­ä½ æƒ³è¦çš„é“¾æ¥ã€‚è™½ç„¶è¿™ä¸ªæ–¹å¼ç®€å•ï¼Œä½†å¯èƒ½æ¯”è¾ƒè€—æ—¶ã€‚å¦ä¸€ç§æ–¹æ³•æ˜¯é¢„å…ˆç”Ÿæˆä¸€ä¸ªæ•°ç»„ï¼Œç”¨äºå­˜å‚¨æ•°ç»„ä¸­æ¯ä¸ªé“¾æ¥çš„ç´¯ç§¯æ€»æ•°ï¼Œç„¶åå¯¹ 0 å’Œæ€»æ•°ä¹‹é—´çš„éšæœºæ•°è¿›è¡ŒäºŒåˆ†æœç´¢ã€‚è¿™ç›¸å¯¹æ¥è¯´æ›´ç¹çä¸€äº›ï¼Œä½†æ‰§è¡Œæ•ˆç‡æ›´é«˜ã€‚å¦‚æœä½ è¿½æ±‚æ›´å¥½çš„æ–¹æ¡ˆï¼Œä½ å…¶å®å¯ä»¥åšæ›´å¤šçš„é¢„å¤„ç†ï¼Œå¹¶æœ€ç»ˆå¾—åˆ°ä¸€ä¸ªå¯ä»¥åœ¨<a href="http://www.keithschwarz.com/darts-dice-coins/" target="_blank" rel="noopener">å¸¸é‡æ—¶é—´å†…å®ŒæˆæŸ¥è¯¢çš„ç´§å‡‘ç»“æ„</a>ã€‚</p><p>æœ€ç»ˆï¼Œæˆ‘å†³å®šå·æ‡’ä½¿ç”¨ä¸€ç§åœ¨ç©ºé—´ä¸Šæå…¶æµªè´¹ï¼Œä½†åœ¨æ—¶é—´ä¸Šæ•ˆç‡å¾ˆé«˜ä¸”æ˜“äºå®ç°çš„ç»“æ„ã€‚è¯¥ç»“æ„æ¯ä¸ª <code>Word</code> åŒ…å«ä¸€ä¸ªåç»­ <code>Words</code> çš„æ•°ç»„ã€‚å¦‚æœä¸€ä¸ªé“¾æ¥è¢«æŒ‡å‘å¤šæ¬¡ï¼Œé‚£ä¹ˆå°†ä¼šä¿å­˜é‡å¤çš„ <code>Words</code> æ•°ç»„ã€‚åœ¨æ•°ç»„ä¸­é€‰æ‹©ä¸€ä¸ªéšæœºç´¢å¼•ï¼Œæ ¹æ®ç´¢å¼•è¿”å›å…·æœ‰é€‚å½“æƒé‡çš„éšæœºå…ƒç´ ã€‚</p><p><code>Word</code> ç±»ç»“æ„å¦‚ä¸‹ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Word</span> </span>&#123;</span><br><span class="line">   <span class="keyword">let</span> str: <span class="type">String</span>?</span><br><span class="line">   <span class="keyword">var</span> links: [<span class="type">Word</span>] = []</span><br><span class="line"></span><br><span class="line">   <span class="keyword">init</span>(str: <span class="type">String</span>?) &#123;</span><br><span class="line">       <span class="keyword">self</span>.str = str</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">func</span> <span class="title">randomNext</span><span class="params">()</span></span> -&gt; <span class="type">Word</span> &#123;</span><br><span class="line">       <span class="keyword">let</span> index = arc4random_uniform(<span class="type">UInt32</span>(links.<span class="built_in">count</span>))</span><br><span class="line">       <span class="keyword">return</span> links[<span class="type">Int</span>(index)]</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¯·æ³¨æ„ï¼Œ<code>links</code> æ•°ç»„å¯èƒ½ä¼šå¯¼è‡´å¤§é‡å¾ªç¯å¼•ç”¨ã€‚ä¸ºäº†é¿å…å†…å­˜æ³„æ¼ï¼Œæˆ‘ä»¬éœ€è¦æ‰‹åŠ¨æ¸…ç†é‚£äº›å†…å­˜ã€‚</p><p>æˆ‘ä»¬å¼•å…¥ <code>Chain</code> ç±»ï¼Œå®ƒå°†ç®¡ç†é“¾ä¸­æ‰€æœ‰çš„ <code>Words</code> ã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Chain</span> </span>&#123;</span><br><span class="line">   <span class="keyword">var</span> words: [<span class="type">String</span>?: <span class="type">Word</span>] = [:]</span><br></pre></td></tr></table></figure><p>åœ¨ <code>deinit</code> æ–¹æ³•ä¸­ï¼Œæ¸…é™¤æ‰€æœ‰çš„ <code>links</code> æ•°ç»„ï¼Œä»¥æ¶ˆé™¤æ‰€æœ‰çš„å¾ªç¯å¼•ç”¨ã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">deinit</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> word <span class="keyword">in</span> words.values &#123;</span><br><span class="line">        word.links = []</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœæ²¡æœ‰è¿™ä¸€æ­¥ï¼Œè®¸å¤šå•è¯å®ä¾‹çš„å†…å­˜éƒ½ä¼šæ³„æ¼ã€‚</p><p>ç°åœ¨è®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•å°†å•è¯æ·»åŠ åˆ°é“¾ä¸­ã€‚<code>add</code> æ–¹æ³•éœ€è¦ä¸€ä¸ªå­—ç¬¦ä¸²æ•°ç»„ï¼Œè¯¥æ•°ç»„ä¸­æ¯ä¸€ä¸ªå…ƒç´ éƒ½ä¿å­˜ç€ä¸€ä¸ªå•è¯ï¼ˆæˆ–è°ƒç”¨è€…å¸Œæœ›ä½¿ç”¨çš„å…¶ä»–ä»»ä½•å­—ç¬¦ä¸²ï¼‰:</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">add</span><span class="params">(<span class="number">_</span> words: [String])</span></span> &#123;</span><br></pre></td></tr></table></figure><p>å¦‚æœé“¾ä¸­æ²¡æœ‰å•è¯ï¼Œé‚£ä¹ˆæå‰è¿”å›ã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> words.isEmpty &#123; <span class="keyword">return</span> &#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬æƒ³è¦éå†é‚£äº›æˆå¯¹çš„å•è¯ï¼Œéå†è§„åˆ™æ˜¯ç¬¬äºŒä¸ªå…ƒç´ çš„ç¬¬ä¸€ä¸ªå•è¯ç´§éšç¬¬ä¸€ä¸ªå…ƒç´ åé¢çš„å•è¯ã€‚ä¾‹å¦‚ï¼Œåœ¨å¥å­ â€œHelp, Iâ€™m being oppressed,â€ ä¸­ï¼Œæˆ‘ä»¬è¦è¿­ä»£ <code>(&quot;Help&quot;, &quot;I&#39;m&quot;)</code> ï¼Œ <code>(&quot;I&#39;m&quot;, &quot;being&quot;)</code> ï¼Œ <code>(&quot;being&quot;, &quot;oppressed&quot;)</code> ã€‚</p><p>å®é™…ä¸Šï¼Œè¿˜éœ€è¦å¤šåšä¸€ç‚¹äº‹æƒ…ï¼Œå› ä¸ºæˆ‘ä»¬éœ€è¦ç¼–ç å¥å­çš„å¼€å¤´å’Œç»“å°¾ã€‚æˆ‘ä»¬å°†å¥å­çš„å¼€å¤´å’Œç»“å°¾ç”¨ <code>nil</code> è¡¨ç¤ºï¼Œæ‰€ä»¥æˆ‘ä»¬è¦è¿­ä»£çš„å®é™…åºåˆ—æ˜¯ <code>(nil, &quot;Help&quot;)</code> ï¼Œ <code>(&quot;Help&quot;, &quot;I&#39;m&quot;)</code> ï¼Œ <code>(&quot;I&#39;m&quot;, &quot;being&quot;)</code> ï¼Œ <code>(&quot;being&quot;, &quot;oppressed&quot;)</code> ï¼Œ <code>(&quot;oppressed&quot;, nil)</code> ã€‚</p><p>ä¸ºäº†å…è®¸å€¼ä¸º <code>nil</code> ï¼Œ æˆ‘ä»¬çš„æ•°ç»„å£°æ˜ä¸º <code>String?</code> ç±»å‹ï¼Œè€Œä¸æ˜¯ <code>String</code>  ç±»å‹ã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> words = words <span class="keyword">as</span> [<span class="type">String</span>?]</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥æ„é€ ä¸¤ä¸ªæ•°ç»„ï¼Œä¸€ä¸ªå¤´éƒ¨æ·»åŠ  <code>nil</code>ï¼Œå¦ä¸€ä¸ªå°¾éƒ¨æ·»åŠ  <code>nil</code>ã€‚æŠŠå®ƒä»¬é€šè¿‡ <code>zip</code> åˆå¹¶åœ¨ä¸€èµ·ç”Ÿæˆæˆ‘ä»¬æƒ³è¦çš„åºåˆ—ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> wordPairs = <span class="built_in">zip</span>([<span class="literal">nil</span>] + words, words + [<span class="literal">nil</span>])</span><br><span class="line"><span class="keyword">for</span> (first, second) <span class="keyword">in</span> wordPairs &#123;</span><br></pre></td></tr></table></figure><p>å¯¹äºè¿™ä¸€å¯¹ä¸­çš„æ¯ä¸ªå•è¯ï¼Œæˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªè¾…åŠ©æ–¹æ³•æ¥è·å–ç›¸åº”çš„ <code>Word</code> å¯¹è±¡ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> firstWord = word(first)</span><br><span class="line"><span class="keyword">let</span> secondWord = word(second)</span><br></pre></td></tr></table></figure><p>ç„¶åæŠŠç¬¬äºŒä¸ªå•è¯æ·»åŠ åˆ°ç¬¬ä¸€ä¸ªå•è¯çš„é“¾æ¥ä¸­ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">        firstWord.links.append(secondWord)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>Word</code> è¾…åŠ©æ–¹æ³•ä» <code>words</code> å­—å…¸ä¸­æå–å®ä¾‹ï¼Œå¦‚æœå®ä¾‹ä¸å­˜åœ¨å°±åˆ›å»ºä¸€ä¸ªæ–°å®ä¾‹å¹¶å°†å…¶æ”¾å…¥å­—å…¸ä¸­ã€‚è¿™æ ·å°±ä¸ç”¨æ‹…å¿ƒå­—ç¬¦ä¸²åŒ¹é…ä¸åˆ°å•è¯ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">word</span><span class="params">(<span class="number">_</span> str: String?)</span></span> -&gt; <span class="type">Word</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> word = words[str] &#123;</span><br><span class="line">        <span class="keyword">return</span> word</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> word = <span class="type">Word</span>(str: str)</span><br><span class="line">        words[str] = word</span><br><span class="line">        <span class="keyword">return</span> word</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ€åç”Ÿæˆæˆ‘ä»¬è¦çš„å•è¯åºåˆ—ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">generate</span><span class="params">()</span></span> -&gt; [<span class="type">String</span>] &#123;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å°†é€ä¸ªç”Ÿæˆå•è¯ï¼Œå¹¶å°†ä»–ä»¬å­˜å‚¨åœ¨ä¸‹é¢çš„æ•°ç»„ä¸­:</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> result: [<span class="type">String</span>] = []</span><br></pre></td></tr></table></figure><p>è¿™æ˜¯ä¸€ä¸ªæ— é™å¾ªç¯ã€‚å› ä¸ºé€€å‡ºæ¡ä»¶æ²¡æœ‰æ¸…æ™°çš„æ˜ å°„åˆ°å¾ªç¯æ¡ä»¶ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">while</span> <span class="literal">true</span> &#123;</span><br></pre></td></tr></table></figure><p>åœ¨ <code>result</code> ä¸­è·å–æœ€åä¸€ä¸ªå­—ç¬¦ä¸²æ„æˆ <code>Word</code> å®ä¾‹ã€‚è¿™å¾ˆå¥½åœ°å¤„ç†äº†å½“ <code>result</code> ä¸ºç©ºæ—¶çš„åˆå§‹æƒ…å†µï¼Œå› ä¸ºä¸€æ—¦ <code>last</code> å–å€¼ä¸º <code>nil</code> å°±è¡¨ç¤ºç¬¬ä¸€ä¸ªå•è¯ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> currentWord = word(result.last)</span><br></pre></td></tr></table></figure><p>éšæœºè·å–é“¾æ¥çš„è¯ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> nextWord = currentWord.randomNext()</span><br></pre></td></tr></table></figure><p>å¦‚æœé“¾æ¥çš„å•è¯ä¸æ˜¯ç»“å°¾ï¼Œå°†å…¶è¿½åŠ åˆ° <code>result</code> ä¸­ã€‚å¦‚æœæ˜¯ç»“æŸï¼Œåˆ™ç»ˆæ­¢å¾ªç¯ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> str = nextWord.str &#123;</span><br><span class="line">        result.append(str)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿”å›åŒ…å«æ‰€æœ‰å•è¯çš„ <code>result</code>ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">        <span class="keyword">return</span> result</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ€åä¸€ä»¶äº‹ï¼šæˆ‘ä»¬æ­£åœ¨ä½¿ç”¨ <code>String?</code> ä½œä¸º <code>words</code> çš„é”®ç±»å‹ï¼Œä½† <code>Optional</code> ä¸ç¬¦åˆ <code>Hashable</code> åè®®ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªæ‰©å±•ï¼Œå½“å®ƒçš„å°è£…ç±»å‹éµå¾ª <code>Hashable</code> æ—¶æ·»åŠ  <code>Optional</code> å¯¹ <code>Hashable</code> çš„å®ç°ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Optional</span>: <span class="title">Hashable</span> <span class="title">where</span> <span class="title">Wrapped</span>: <span class="title">Hashable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">var</span> hashValue: <span class="type">Int</span> &#123;</span><br><span class="line">        <span class="keyword">switch</span> <span class="keyword">self</span> &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="keyword">let</span> wrapped?: <span class="keyword">return</span> wrapped.hashValue</span><br><span class="line">        <span class="keyword">case</span> .<span class="keyword">none</span>: <span class="keyword">return</span> <span class="number">42</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>å¤‡æ³¨ï¼šSwift 4.2 ä¸­ <code>Optional</code> ç±»å‹å·²é»˜è®¤å®ç° <code>Hashable</code> åè®®</p></blockquote><h2 id="ç”Ÿæˆè¾“å…¥æ•°æ®"><a href="#ç”Ÿæˆè¾“å…¥æ•°æ®" class="headerlink" title="ç”Ÿæˆè¾“å…¥æ•°æ®"></a>ç”Ÿæˆè¾“å…¥æ•°æ®</h2><p>ä»¥ä¸Šå°±æ˜¯é©¬å°”å¯å¤«é“¾çš„ç»“æ„ï¼Œä¸‹é¢æˆ‘ä»¬è¾“å…¥ä¸€äº›çœŸå®æ–‡æœ¬è¯•è¯•çœ‹ã€‚</p><p>æˆ‘å†³å®šä» <code>RSS</code> æè¦ä¸­æå–æ–‡æœ¬ã€‚è¿˜æœ‰ä»€ä¹ˆæ¯”ç”¨æˆ‘è‡ªå·±åšå®¢å…¨æ–‡ä½œä¸ºè¾“å…¥æ›´å¥½çš„é€‰æ‹©å‘¢ï¼Ÿ</p><p><code>let feedURL = URL(string: &quot;https://www.mikeash.com/pyblog/rss.py?mode=fulltext&quot;)!</code></p><p><code>RSS</code> æ˜¯ä¸€ç§ <code>XML</code> æ ¼å¼ï¼Œæ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨ <code>XMLDocument</code> æ¥è§£æå®ƒï¼š</p><p><code>let xmlDocument = try! XMLDocument(contentsOf: feedURL, options: [])</code></p><p>æ–‡ç« ä¸»ä½“è¢«åµŒå¥—åœ¨ <code>item</code> èŠ‚ç‚¹ä¸‹çš„ <code>description</code> èŠ‚ç‚¹ã€‚é€šè¿‡ <code>XPath</code> æŸ¥è¯¢æ£€ç´¢ï¼š</p><p><code>let descriptionNodes = try! xmlDocument.nodes(forXPath: &quot;//item/description&quot;)</code></p><p>æˆ‘ä»¬éœ€è¦ <code>XML</code> èŠ‚ç‚¹ä¸­çš„å­—ç¬¦ä¸²ï¼Œæ‰€ä»¥æˆ‘ä»¬ä»ä¸­æå–å¹¶è¿‡æ»¤æ‰ä¸º <code>nil</code> çš„å†…å®¹ã€‚</p><p><code>let descriptionHTMLs = descriptionNodes.compactMap({ $0.stringValue })</code></p><p>æˆ‘ä»¬æ ¹æœ¬ä¸ç”¨å…³å¿ƒæ ‡ç­¾ã€‚<code>NSAttributedString</code> å¯ä»¥è§£æ <code>HTML</code> å¹¶ç”Ÿæˆä¸€ä¸ª <code>AttributedString</code>ï¼Œç„¶åæˆ‘ä»¬å¯ä»¥è¿‡æ»¤å®ƒï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> descriptionStrings = descriptionHTMLs.<span class="built_in">map</span>(&#123;</span><br><span class="line">   <span class="type">NSAttributedString</span>(html: $<span class="number">0</span>.data(using: .utf8)!, options: [:], documentAttributes: <span class="literal">nil</span>)!.string</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬éœ€è¦ä¸€ä¸ªå°†å­—ç¬¦ä¸²åˆ†è§£æˆè‹¥å¹²éƒ¨åˆ†çš„å‡½æ•°ã€‚æˆ‘ä»¬çš„ç›®çš„æ˜¯ç”Ÿæˆ String æ•°ç»„ï¼Œæ¯ä¸ªæ•°ç»„å¯¹åº”æ–‡æœ¬é‡Œçš„ä¸€å¥è¯ã€‚ä¸€æ®µæ–‡æœ¬å¯èƒ½ä¼šæœ‰å¾ˆå¤šå¥è¯ï¼Œæ‰€ä»¥ <code>wordSequences</code> å‡½æ•°ä¼šè¿”å›ä¸€ä¸ª String çš„äºŒç»´æ•°ç»„ï¼š</p><p><code>func wordSequences(in str: String) -&gt; [[String]] {</code></p><p>ç„¶åæˆ‘ä»¬å°†å¤„ç†ç»“æœå­˜å‚¨åœ¨ä¸€ä¸ªå±€éƒ¨å˜é‡ä¸­ï¼š</p><p><code>var result: [[String]] = []</code></p><p>å°†å­—ç¬¦ä¸²åˆ†è§£æˆå¥å­å¹¶ä¸ç®€å•ã€‚ä½ å¯ä»¥ç›´æ¥æœç´¢æ ‡ç‚¹ç¬¦å·ï¼Œä½†éœ€è¦è€ƒè™‘åˆ°åƒ <code>â€œMr. Jock, TV quiz Ph.D., bags few lynx.â€</code> è¿™æ ·çš„å¥å­ï¼ŒæŒ‰ç…§æ ‡ç‚¹ç¬¦å·ä¼šè¢«åˆ†å‰²æˆå››æ®µï¼Œä½†è¿™æ˜¯ä¸€ä¸ªå®Œæ•´çš„å¥å­ã€‚</p><p><code>NSString</code> æä¾›äº†ä¸€äº›æ™ºèƒ½æ£€æŸ¥å­—ç¬¦ä¸²éƒ¨åˆ†çš„æ–¹æ³•ï¼Œå‰ææ˜¯ä½ éœ€è¦ <code>import Foundation</code> ã€‚æˆ‘ä»¬ä¼šæšä¸¾ <code>str</code> åŒ…å«çš„å¥å­ï¼Œå¹¶è®© <code>Foundation</code> è¿›è¡Œå¤„ç†ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">str.enumerateSubstrings(<span class="keyword">in</span>: str.startIndex..., options: .bySentences, &#123; substring, substringRange, enclosingRange, stop <span class="keyword">in</span></span><br></pre></td></tr></table></figure><p>åœ¨å°†å¥å­æ‹†åˆ†æˆå•è¯çš„æ—¶å€™ä¼šé‡åˆ°ç›¸ä¼¼çš„é—®é¢˜ã€‚<code>NSString</code> ä¹Ÿæä¾›äº†ä¸€ç§ç”¨äºæšä¸¾è¯çš„æ–¹æ³•ï¼Œä½†æ˜¯å­˜åœ¨ä¸€äº›é—®é¢˜ï¼Œä¾‹å¦‚ä¸¢å¤±æ ‡ç‚¹ç¬¦å·ã€‚æˆ‘æœ€ç»ˆå†³å®šç”¨ä¸€ç§æ„šè ¢çš„æ–¹å¼æ¥è¿›è¡Œå•è¯åˆ†å‰²ï¼ŒåªæŒ‰ç©ºæ ¼è¿›è¡Œåˆ†å‰²ã€‚è¿™æ„å‘³ç€ä½ æœ€ç»ˆå°†åŒ…å«æ ‡ç‚¹ç¬¦å·çš„å•è¯ä½œä¸ºå­—ç¬¦ä¸²çš„ä¸€éƒ¨åˆ†ã€‚ä¸æ ‡ç‚¹ç¬¦å·è¢«åˆ é™¤ç›¸æ¯”ï¼Œè¿™æ›´å¤šåœ°é™åˆ¶äº†é©¬å°”å¯å¤«é“¾ï¼Œä½†å¦ä¸€æ–¹é¢ï¼Œè¾“å‡ºä¼šåŒ…å«åˆç†çš„æ ‡ç‚¹ç¬¦å·ã€‚æˆ‘è§‰å¾—è¿™ä¸ªæŠ˜ä¸­æ–¹æ¡ˆè¿˜ä¸é”™ã€‚</p><p>ä¸€äº›æ¢è¡Œç¬¦ä¼šè¿›å…¥æ•°æ®é›†ï¼Œæˆ‘ä»¬é¦–å…ˆå°†è¿™äº›æ¢è¡Œç¬¦ç§»é™¤ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> words = substring!.<span class="built_in">split</span>(separator: <span class="string">" "</span>).<span class="built_in">map</span>(&#123;</span><br><span class="line">    $<span class="number">0</span>.trimmingCharacters(<span class="keyword">in</span>: <span class="type">CharacterSet</span>.newlines)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>åˆ†å‰²çš„å¥å­æœ€ç»ˆè¢«æ·»åŠ åˆ° <code>result</code> ä¸­ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">    result.append(words)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>æšä¸¾å®Œæˆåï¼Œæ ¹æ®è¾“å…¥çš„å¥å­è®¡ç®—å‡º <code>result</code> ï¼Œç„¶åå°†å…¶è¿”å›ç»™è°ƒç”¨è€…ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">    <span class="keyword">return</span> result</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å›åˆ°ä¸»ä»£ç ã€‚ç°åœ¨å·²ç»æœ‰åŠæ³•å°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºå¥å­åˆ—è¡¨ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç»§ç»­æ„å»ºè‡ªå·±çš„é©¬å°”å¯å¤«é“¾ã€‚é¦–å…ˆæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªç©ºçš„ <code>Chain</code> å¯¹è±¡ï¼š</p><p><code>let chain = Chain()</code></p><p>ç„¶åæˆ‘ä»¬éå†æ‰€æœ‰çš„å­—ç¬¦ä¸²ï¼Œæå–å¥å­ï¼Œå¹¶å°†å®ƒä»¬æ·»åŠ åˆ°é“¾ä¸­ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> str <span class="keyword">in</span> descriptionStrings &#123;</span><br><span class="line">   <span class="keyword">for</span> sentence <span class="keyword">in</span> wordSequences(<span class="keyword">in</span>: str) &#123;</span><br><span class="line">       chain.add(sentence)</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ€åä¸€æ­¥å½“ç„¶æ˜¯ç”Ÿæˆä¸€äº›æ–°å¥å­ï¼æˆ‘ä»¬è°ƒç”¨ <code>generate()</code>ï¼Œç„¶åç”¨ç©ºæ ¼è¿æ¥ç»“æœã€‚è¾“å‡ºç»“æœå¯èƒ½å‘½ä¸­ä¹Ÿå¯èƒ½ä¸å‘½ä¸­ï¼ˆè€ƒè™‘åˆ°è¯¥æŠ€æœ¯çš„éšæœºæ€§ï¼Œè¿™å¹¶ä¸å¥‡æ€ªï¼‰ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¼šå¤šç”Ÿæˆä¸€äº›ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> <span class="number">_</span> <span class="keyword">in</span> <span class="number">0</span> ..&lt; <span class="number">200</span> &#123;</span><br><span class="line">   <span class="built_in">print</span>(<span class="string">"\""</span> + chain.generate().joined(separator: <span class="string">" "</span>) + <span class="string">"\""</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ç¤ºä¾‹è¾“å‡º"><a href="#ç¤ºä¾‹è¾“å‡º" class="headerlink" title="ç¤ºä¾‹è¾“å‡º"></a>ç¤ºä¾‹è¾“å‡º</h2><p>ä¸ºäº†æ¼”ç¤ºï¼Œä¸‹é¢æ˜¯è¿™ä¸ªç¨‹åºçš„ä¸€äº›ç¤ºä¾‹è¾“å‡ºï¼š</p><ul><li>â€œWeâ€™re ready to be small, weak references in New York City.â€</li><li>â€œIt thus makes no values?â€</li><li>â€œSimple JSON tasks, itâ€™s wasteful if you can be.â€</li><li>â€œAnother problem, but it would make things more programming-related mystery goo.â€</li><li>â€œThe escalating delays after excessive focus on Friday, September 29th.â€</li><li>â€œYou may not set.â€</li><li>â€œDeclare conformance to use = Self.init() to detect the requested values.â€</li><li>â€œThe tagged pointer is inlined at this nature; even hundreds of software and writing out at 64 bits wide.â€</li><li>â€œWeâ€™re ready to express that it works by reader ideas, so the decoding methods for great while, itâ€™s inaccessible to 0xa4, which takes care of increasing addresses as the timing.â€</li><li>â€œAPIs which is mostly a one-sided use it yourself?â€</li><li>â€œThereâ€™s no surprise.â€</li><li>â€œI wasnâ€™t sure why Iâ€™ve been called â€˜zero-costâ€™ in control both take serious effort to miss instead of ARC and games.â€</li><li>â€œFor now, we can look at the filesystem.â€</li><li>â€œThe intent is intended as reader-writer locks.â€</li><li>â€œFor example, we can use of the code?â€</li><li>â€œSwiftâ€™s generics can all fields of Swift programming, with them is no parameters are static subscript, these instantiate self = cluster.reduce(0, +) / Double(cluster.count)â€</li><li>â€œHowever, the common case, you to the left-hand side tables.â€</li></ul><p>ä¸Šé¢æœ‰å¾ˆå¤šæ— æ„ä¹‰çš„å¥å­ï¼Œæ‰€ä»¥ä½ å¿…é¡»æ·±å…¥æŒ–æ˜æ‰èƒ½æ‰¾åˆ°æœ‰æ„ä¹‰çš„å¥å­ï¼Œä½†ä¸å¯å¦è®¤é©¬å°”å¯å¤«é“¾å¯ä»¥äº§ç”Ÿä¸€äº›éå¸¸æœ‰è¶£çš„è¾“å‡ºã€‚</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>é©¬å°”å¯å¤«é“¾æœ‰è®¸å¤šå®é™…ç”¨é€”ï¼Œåœ¨ç”¨äºç”Ÿæˆæ–‡æœ¬æ—¶å®ƒå¯èƒ½æ˜¾å¾—æ¯”è¾ƒæœ‰è¶£ä½†ä¸æ˜¯å¾ˆå®ç”¨ã€‚é™¤äº†å±•ç¤ºäº†å…¶å¨±ä¹æ€§ä¹‹å¤–ï¼Œè¯¥ä»£ç è¿˜è¯´æ˜äº†åœ¨æ²¡æœ‰æ˜ç¡®å¼•ç”¨å…³ç³»çš„æƒ…å†µä¸‹å¦‚ä½•å¤„ç†å¾ªç¯å¼•ç”¨ï¼Œå¦‚ä½•çµæ´»åœ°ä½¿ç”¨ <code>NSString</code> æä¾›çš„æšä¸¾æ–¹æ³•ä»æ–‡æœ¬ä¸­æå–ç‰¹å¾ï¼Œä»¥åŠç®€è¦è¯´æ˜äº†æ¡ä»¶ä¸€è‡´æ€§ï¼ˆ<a href="https://github.com/apple/swift-evolution/blob/master/proposals/0143-conditional-conformances.md" target="_blank" rel="noopener">conditional conformances</a>ï¼‰çš„ä¼˜ç‚¹ã€‚</p><p>ä»Šå¤©å°±è®²è¿™äº›ã€‚æœŸå¾…ä¸‹æ¬¡ä¸€èµ·åˆ†äº«æ›´å¤šçš„ä¹è¶£ï¼Œåœ¨å¨±ä¹ä¸­è¿›è¡Œå­¦ä¹ ã€‚<code>Friday Q&amp;A</code> æ˜¯ç”±è¯»è€…çš„æƒ³æ³•é©±åŠ¨çš„ï¼Œæ‰€ä»¥å¦‚æœä½ æœ‰ä¸€äº›æƒ³åœ¨è¿™é‡Œçœ‹åˆ°çš„è¯é¢˜ï¼Œè¯·ç»™æˆ‘<a href="mailto:mike@mikeash.com" target="_blank" rel="noopener">å‘é€é‚®ä»¶</a>ï¼</p><blockquote><p>ä½ å–œæ¬¢è¿™ç¯‡æ–‡ç« å—ï¼Ÿæˆ‘æ­£åœ¨å–æ”¶å½•äº†è¿™äº›æ–‡ç« çš„ä¸€æœ¬ä¹¦ï¼ç¬¬äºŒå·å’Œç¬¬ä¸‰å·ç°åœ¨ä¹Ÿå‡ºæ¥äº†ï¼åŒ…æ‹¬ ePubï¼ŒPDFï¼Œå®ä½“ç‰ˆä»¥åŠ iBook å’Œ Kindleã€‚<a href="https://www.mikeash.com/book.html" target="_blank" rel="noopener">ç‚¹å‡»è¿™é‡ŒæŸ¥çœ‹æ›´å¤šä¿¡æ¯</a>ã€‚</p></blockquote><blockquote><p>æœ¬æ–‡ç”± SwiftGG ç¿»è¯‘ç»„ç¿»è¯‘ï¼Œå·²ç»è·å¾—ä½œè€…ç¿»è¯‘æˆæƒï¼Œæœ€æ–°æ–‡ç« è¯·è®¿é—® <a href="http://swift.gg">http://swift.gg</a>ã€‚</p></blockquote>]]></content>
    
    <summary type="html">
    
      æœ¬æ–‡ä»‹ç»äº†ä½¿ç”¨ Swift æ¥æ„é€ é©¬å°”å¯å¤«é“¾ç»“æ„ï¼Œå¹¶ä½¿ç”¨è¯¥ç»“æ„æŒ‡å®šè¾“å…¥æ•°æ®æºéšæœºç”Ÿæˆæ–‡æœ¬ã€‚
    
    </summary>
    
      <category term="Mike Ash" scheme="https://swift.gg/categories/Mike-Ash/"/>
    
    
      <category term="Swift" scheme="https://swift.gg/tags/Swift/"/>
    
  </entry>
  
  <entry>
    <title>Swift Package Manager é‡å†™ macOS éƒ¨ç½²ç›®æ ‡</title>
    <link href="https://swift.gg/2018/07/19/swift-3-1-package-manager-deployment-target/"/>
    <id>https://swift.gg/2018/07/19/swift-3-1-package-manager-deployment-target/</id>
    <published>2018-07-19T00:00:00.000Z</published>
    <updated>2018-09-10T03:53:25.085Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ä½œè€…ï¼šOle Begemannï¼Œ<a href="https://oleb.net/blog/2017/04/swift-3-1-package-manager-deployment-target/" target="_blank" rel="noopener">åŸæ–‡é“¾æ¥</a>ï¼ŒåŸæ–‡æ—¥æœŸï¼š2017-04-07<br>è¯‘è€…ï¼š<a href="undefined">EyreFree</a>ï¼›æ ¡å¯¹ï¼š<a href="https://weibo.com/1743643682/profile?topnav=1&amp;wvr=6" target="_blank" rel="noopener">liberalism</a>ï¼Œ<a href="undefined">Firecrest</a>ï¼›å®šç¨¿ï¼š<a href="https://github.com/chenmingbiao" target="_blank" rel="noopener">CMB</a></p></blockquote><!--æ­¤å¤„å¼€å§‹æ­£æ–‡--><p>Swift 3.1 ä¿®å¤äº† <a href="https://swift.org/package-manager/" target="_blank" rel="noopener">Swift Package Manager</a> æ— æ³•é‡å†™ MacOS éƒ¨ç½²ç›®æ ‡çš„ Bugã€‚</p><p>å½“ä½ åœ¨ macOS ä¸Šæ‰§è¡Œ <code>swift build</code> å‘½ä»¤æ—¶ï¼ŒåŒ…ç®¡ç†å™¨ç›®å‰ï¼ˆSwift 3.0 å’Œ 3.1ï¼‰ä¼šå°†éƒ¨ç½²ç›®æ ‡ç¡¬ç¼–ç ä¸º macOS 10.10 Â¹  ç°å·²è¯æ˜æ˜¯å‘½ä»¤å‚æ•°çš„ä¸€ä¸ª <a href="https://bugs.swift.org/browse/SR-2535" target="_blank" rel="noopener">Bug</a> å¼•èµ·çš„ Swift 3.0 ä¸­æ— æ³•é‡å†™éƒ¨ç½²ç›®æ ‡è¿™ä¸ªé—®é¢˜ã€‚</p><a id="more"></a><p>å› æ­¤ï¼Œä½ ä¸èƒ½è½»æ¾ç¼–è¯‘ç”¨åˆ°äº†æœ€æ–° API çš„ä»£ç  Â²  ä¸¾ä¸ªæ —å­ï¼Œå‡è®¾æœ‰ä¸€ä¸ªéå¸¸ç®€å•çš„åŒ…ï¼ŒåªåŒ…å«å‡ è¡Œä»£ç åœ¨ä¸€ä¸ªæºæ–‡ä»¶ä¸­ã€‚è¿™ä¸ªç¨‹åºç”¨åˆ°äº† macOS 10.12 å¼•å…¥çš„æ–°çš„ <a href="https://oleb.net/blog/2016/07/measurements-and-units/" target="_blank" rel="noopener">å•ä½å’Œæµ‹é‡ç±»å‹</a> æ¥å°†ä¸€ä¸ªå€¼ä»ä»¥ km/h è½¬æ¢ä¸º m/s ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// main.swift</span></span><br><span class="line"><span class="keyword">import</span> Foundation</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> kph = <span class="type">Measurement</span>(value: <span class="number">100</span>,</span><br><span class="line">    unit: <span class="type">UnitSpeed</span>.kilometersPerHour)</span><br><span class="line"><span class="keyword">let</span> mps = kph.converted(to: .metersPerSecond)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">"<span class="subst">\(kph)</span> is <span class="subst">\(mps)</span>"</span>)</span><br></pre></td></tr></table></figure><p>åœ¨ macOSï¼ˆSwift 3.0 æˆ– 3.1ï¼‰ä¸Šç”¨ <code>swift build</code> å‘½ä»¤ç¼–è¯‘ä¸Šé¢è¿™æ®µä»£ç ä¼šæŠ¥é”™ï¼Œå› ä¸ºè¿™æ®µä»£ç ç”¨åˆ°çš„ API åœ¨ macOS 10.10 ä¸Šä¸å¯ç”¨ï¼š</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ swift build</span><br><span class="line">Compile Swift Module <span class="string">'Units'</span> (1 sources)</span><br><span class="line">main.swift:3:11: error: <span class="string">'Measurement'</span> is only available on OS X 10.12 or newer</span><br><span class="line"><span class="built_in">let</span> kph = Measurement(value: 100,</span><br><span class="line">          ^</span><br><span class="line">main.swift:3:11: note: add <span class="string">'if #available'</span> version check</span><br><span class="line"><span class="built_in">let</span> kph = Measurement(value: 100,</span><br><span class="line">          ^</span><br><span class="line">...</span><br><span class="line">&lt;unknown&gt;:0: error: build had 1 <span class="built_in">command</span> failures</span><br><span class="line">error: <span class="built_in">exit</span>(1): /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/swift-build-tool -f .build/debug.yaml</span><br></pre></td></tr></table></figure><p>åœ¨ Swift 3.1 ä¸­ï¼Œä½ å¯ä»¥åœ¨å‘½ä»¤è¡Œä¸­ä¿®æ”¹éƒ¨ç½²ç›®æ ‡ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ swift build -Xswiftc <span class="string">"-target"</span> \</span><br><span class="line">    -Xswiftc <span class="string">"x86_64-apple-macosx10.12"</span></span><br><span class="line">Compile Swift Module <span class="string">'Units'</span> (1 sources)</span><br><span class="line">Linking ./.build/debug/Units</span><br></pre></td></tr></table></figure><p>ç°åœ¨ï¼Œä½ å¯ä»¥æ­£å¸¸æ‰§è¡Œä¹‹å‰çš„è¿™æ®µä»£ç äº†ï¼š</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ .build/debug/Units</span><br><span class="line">100.0 km/h is 27.7778 m/s</span><br></pre></td></tr></table></figure><h2 id="ç»“è®º"><a href="#ç»“è®º" class="headerlink" title="ç»“è®º"></a>ç»“è®º</h2><p>é™¤äº†éƒ¨ç½²ç›®æ ‡ï¼Œå¦ä¸€ä¸ªå¸¸è§çš„è‡ªå®šä¹‰ç¼–è¯‘è®¾ç½®ä¾‹å­æ˜¯ä¼ é€’ä¸€ä¸ª <code>DEBUG</code> æ ‡å¿—ç»™ç¼–è¯‘å™¨ï¼Œæ‰€ä»¥å¯ä»¥åœ¨ä½ çš„ä»£ç ä¸­ä½¿ç”¨ <code>#if DEBUG/#endif</code> ä»£ç æ®µä½œä¸ºæ ‡å¿—ä¼ é€’ç»™ç¼–è¯‘å™¨ï¼Œä»è€Œæ¥åˆ¤æ–­æ˜¯å¦å¤„äº Debug æ¨¡å¼ - å½“å‰åŒ…ç®¡ç†å™¨å¹¶æ²¡æœ‰åœ¨ Debug æ„å»ºæ¨¡å¼ä¸‹è‡ªåŠ¨å®Œæˆè¿™äº›å·¥ä½œã€‚ä½ å¯ä»¥é€šè¿‡ <code>swift build -Xswiftc &quot;-D&quot; -Xswiftc &quot;DEBUG&quot;</code> å‘½ä»¤å®ç°è¿™ä¸€ç›®çš„ã€‚</p><p>è¿™ä»ç„¶ä¸å¤Ÿç†æƒ³ - ä½ åœ¨æ¯æ¬¡æ‰§è¡Œ <code>swift build</code> æˆ– <code>swift test</code> å‘½ä»¤æ—¶éƒ½éœ€è¦æ‰‹åŠ¨è¾“å…¥å‘½ä»¤è¡Œå‚æ•° - ä½†è‡³å°‘è¿™æ˜¯å¯è¡Œçš„ã€‚</p><p>å¯¹äºåŒ…ç®¡ç†å™¨æ¥è¯´èƒ½å¤Ÿåœ¨åŒ…é…ç½®æ¸…å•ä¸­æŒ‡å®šè‡ªå®šä¹‰ç¼–è¯‘è®¾ç½®æ˜¯ <a href="https://lists.swift.org/pipermail/swift-evolution-announce/2017-January/000307.html" target="_blank" rel="noopener">Swift 4 è·¯çº¿å›¾</a>çš„ä¸€éƒ¨åˆ†ã€‚æˆ‘çŒœæˆ‘ä»¬å¾ˆå¿«å°±ä¼šçœ‹åˆ°ä¸€ä¸ªå’Œè¿™ä¸€ç‰¹æ€§æœ‰å…³çš„ <a href="https://apple.github.io/swift-evolution/" target="_blank" rel="noopener">Swift å‘å±•ææ¡ˆ</a>ã€‚</p><hr><ol><li>ä½ å¯ä»¥é€šè¿‡æ·»åŠ å¦‚ä¸‹ä»£ç æ®µåˆ°ä½ çš„ <code>main.swift</code> æ–‡ä»¶ç„¶åç¼–è¯‘å¹¶æ‰§è¡Œå¯¹åº”åŒ…çš„æ–¹å¼æ¥éªŒè¯è¿™ä¸€ç‚¹ï¼š</li></ol><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">#<span class="keyword">if</span> os(macOS)</span><br><span class="line">     <span class="built_in">print</span>(<span class="string">"macOS deployment target:"</span>, __MAC_OS_X_VERSION_MIN_REQUIRED)</span><br><span class="line">#endif</span><br></pre></td></tr></table></figure><p>å¦‚æœåœ¨ macOS æ‰§è¡Œï¼Œå°†ä¼šæ‰“å°ï¼š</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">macOS deployment target: 101000</span><br></pre></td></tr></table></figure><ol start="2"><li>ä½ å¿…é¡»æŠŠæ‰€æœ‰ä¾èµ–æ–° API çš„ä»£ç ç”¨ <code>if #available(macOS 10.12, iOS 10.0, tvOS 10.0, watchOS 3.0, *) { ... }</code> æˆ–ç±»ä¼¼çš„ block è¿›è¡ŒåŒ…è£¹ã€‚</li></ol><blockquote><p>æœ¬æ–‡ç”± SwiftGG ç¿»è¯‘ç»„ç¿»è¯‘ï¼Œå·²ç»è·å¾—ä½œè€…ç¿»è¯‘æˆæƒï¼Œæœ€æ–°æ–‡ç« è¯·è®¿é—® <a href="http://swift.gg">http://swift.gg</a>ã€‚</p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;ä½œè€…ï¼šOle Begemannï¼Œ&lt;a href=&quot;https://oleb.net/blog/2017/04/swift-3-1-package-manager-deployment-target/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;åŸæ–‡é“¾æ¥&lt;/a&gt;ï¼ŒåŸæ–‡æ—¥æœŸï¼š2017-04-07&lt;br&gt;è¯‘è€…ï¼š&lt;a href=&quot;undefined&quot;&gt;EyreFree&lt;/a&gt;ï¼›æ ¡å¯¹ï¼š&lt;a href=&quot;https://weibo.com/1743643682/profile?topnav=1&amp;amp;wvr=6&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;liberalism&lt;/a&gt;ï¼Œ&lt;a href=&quot;undefined&quot;&gt;Firecrest&lt;/a&gt;ï¼›å®šç¨¿ï¼š&lt;a href=&quot;https://github.com/chenmingbiao&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;CMB&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;!--æ­¤å¤„å¼€å§‹æ­£æ–‡--&gt;
&lt;p&gt;Swift 3.1 ä¿®å¤äº† &lt;a href=&quot;https://swift.org/package-manager/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Swift Package Manager&lt;/a&gt; æ— æ³•é‡å†™ MacOS éƒ¨ç½²ç›®æ ‡çš„ Bugã€‚&lt;/p&gt;
&lt;p&gt;å½“ä½ åœ¨ macOS ä¸Šæ‰§è¡Œ &lt;code&gt;swift build&lt;/code&gt; å‘½ä»¤æ—¶ï¼ŒåŒ…ç®¡ç†å™¨ç›®å‰ï¼ˆSwift 3.0 å’Œ 3.1ï¼‰ä¼šå°†éƒ¨ç½²ç›®æ ‡ç¡¬ç¼–ç ä¸º macOS 10.10 Â¹  ç°å·²è¯æ˜æ˜¯å‘½ä»¤å‚æ•°çš„ä¸€ä¸ª &lt;a href=&quot;https://bugs.swift.org/browse/SR-2535&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Bug&lt;/a&gt; å¼•èµ·çš„ Swift 3.0 ä¸­æ— æ³•é‡å†™éƒ¨ç½²ç›®æ ‡è¿™ä¸ªé—®é¢˜ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="Ole Begemann" scheme="https://swift.gg/categories/Ole-Begemann/"/>
    
    
      <category term="iOS å¼€å‘" scheme="https://swift.gg/tags/iOS-%E5%BC%80%E5%8F%91/"/>
    
  </entry>
  
  <entry>
    <title>ä½•æ—¶ç”¨ structï¼Ÿä½•æ—¶ç”¨ classï¼Ÿ</title>
    <link href="https://swift.gg/2018/07/16/friday-qa-2015-07-17-when-to-use-swift-structs-and-classes/"/>
    <id>https://swift.gg/2018/07/16/friday-qa-2015-07-17-when-to-use-swift-structs-and-classes/</id>
    <published>2018-07-16T00:00:00.000Z</published>
    <updated>2018-09-10T03:53:25.085Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ä½œè€…ï¼šMike Ashï¼Œ<a href="https://www.mikeash.com/pyblog/friday-qa-2015-07-17-when-to-use-swift-structs-and-classes.html" target="_blank" rel="noopener">åŸæ–‡é“¾æ¥</a>ï¼ŒåŸæ–‡æ—¥æœŸï¼š2015-07-17<br>è¯‘è€…ï¼š<a href="http://muhlenxi.com/" target="_blank" rel="noopener">muhlenXi</a>ï¼›æ ¡å¯¹ï¼š<a href="undefined">Firecrest</a>ï¼Œ<a href="http://numbbbbb.com/" target="_blank" rel="noopener">numbbbbb</a>ï¼Œ<a href="https://github.com/Cee" target="_blank" rel="noopener">Cee</a>ï¼›å®šç¨¿ï¼š<a href="https://github.com/chenmingbiao" target="_blank" rel="noopener">CMB</a></p></blockquote><!--æ­¤å¤„å¼€å§‹æ­£æ–‡--><p>åœ¨ Swift çš„ä¸–ç•Œä¸­ï¼Œæœ‰ä¸€ä¸ªçƒ­è®®å¾ˆä¹…çš„ä¸»é¢˜ï¼Œä½•æ—¶ä½¿ç”¨ <code>class</code> å’Œä½•æ—¶ä½¿ç”¨ <code>struct</code> ï¼Œä»Šå¤©ï¼Œæˆ‘æƒ³å‘è¡¨ä¸€ä¸‹æˆ‘è‡ªå·±çš„è§‚ç‚¹ã€‚</p><a id="more"></a><h2 id="å€¼ç±»å‹-VS-å¼•ç”¨ç±»å‹"><a href="#å€¼ç±»å‹-VS-å¼•ç”¨ç±»å‹" class="headerlink" title="å€¼ç±»å‹ VS å¼•ç”¨ç±»å‹"></a>å€¼ç±»å‹ VS å¼•ç”¨ç±»å‹</h2><p>äº‹å®ä¸Šï¼Œè¿™ä¸ªé—®é¢˜çš„ç­”æ¡ˆå¾ˆç®€å•ï¼šå½“ä½ éœ€è¦å€¼è¯­ä¹‰çš„æ—¶å€™ç”¨ <code>struct</code> ï¼Œå½“ä½ éœ€è¦å¼•ç”¨è¯­ä¹‰çš„æ—¶å€™å°±ç”¨ <code>class</code> ã€‚</p><p>å¥½äº†ï¼Œä¸‹å‘¨åŒä¸€æ—¶é—´è¯·å†æ¬¡è®¿é—®æˆ‘çš„åšå®¢â€¦â€¦</p><p><strong>ç­‰ç­‰</strong></p><p>æ€ä¹ˆäº†ï¼Ÿ</p><p><strong>è¿™æ²¡æœ‰å›ç­”ä¸Šè¿°ä¸­çš„é—®é¢˜</strong></p><p>ä½ ä»€ä¹ˆæ„æ€ï¼Ÿç­”æ¡ˆå°±åœ¨é‚£å„¿ã€‚</p><p><strong>æ˜¯çš„ï¼Œä½†æ˜¯â€¦â€¦</strong></p><p>ä½†æ˜¯ä»€ä¹ˆï¼Ÿ</p><p><strong>é‚£ä»€ä¹ˆæ˜¯å€¼è¯­ä¹‰ï¼Œä»€ä¹ˆæ˜¯å¼•ç”¨è¯­ä¹‰å‘¢ï¼Ÿ</strong></p><p>æ˜‚ï¼Œä½ æé†’äº†æˆ‘ã€‚æˆ‘ç¡®å®åº”è¯¥è®²è§£ä¸€ä¸‹ã€‚</p><p><strong>è¿˜æœ‰å®ƒä»¬å’Œ structã€class çš„å…³ç³»</strong></p><p>å¥½å§ã€‚</p><p>è¿™äº›é—®é¢˜çš„æ ¸å¿ƒå°±æ˜¯æ•°æ®å’Œæ•°æ®çš„å­˜å‚¨ä½ç½®ã€‚æˆ‘ä»¬ç”¨å±€éƒ¨å˜é‡ã€å‚æ•°ã€å±æ€§å’Œå…¨å±€å˜é‡æ¥å­˜å‚¨æ•°æ®ã€‚å­˜å‚¨æ•°æ®æœ‰ä¸¤ç§æœ€åŸºæœ¬çš„æ–¹å¼ã€‚</p><p>å¯¹äºå€¼è¯­ä¹‰ï¼Œæ•°æ®æ˜¯ç›´æ¥ä¿å­˜åœ¨å˜é‡ä¸­ã€‚å¯¹äºå¼•ç”¨è¯­ä¹‰ï¼Œæ•°æ®ä¿å­˜åœ¨å…¶ä»–åœ°æ–¹ï¼Œå˜é‡å­˜å‚¨çš„æ˜¯è¯¥æ•°æ®çš„å¼•ç”¨åœ°å€ã€‚å½“æˆ‘ä»¬è®¿é—®æ•°æ®æ—¶ï¼Œè¿™ç§å·®å¼‚ä¸ä¸€å®šå¾ˆæ˜æ˜¾ã€‚ä½†æ˜¯æ‹·è´æ•°æ®æ—¶å°±å®Œå…¨ä¸ä¸€æ ·äº†ã€‚å¯¹äºå€¼è¯­ä¹‰ï¼Œä½ å¾—åˆ°çš„æ˜¯è¯¥æ•°æ®çš„æ‹·è´ã€‚å¯¹äºå¼•ç”¨è¯­ä¹‰ï¼Œä½ å¾—åˆ°çš„æ˜¯è¯¥æ•°æ®çš„å¼•ç”¨åœ°å€æ‹·è´ã€‚</p><p>è¿™æœ‰äº›æŠ½è±¡ï¼Œæˆ‘ä»¬é€šè¿‡ä¸€ä¸ªç¤ºä¾‹æ¥äº†è§£ä¸€ä¸‹ã€‚å…ˆæš‚æ—¶è·³è¿‡ Swift çš„ç¤ºä¾‹ï¼Œä¸€èµ·æ¥çœ‹ä¸€ä¸ª Objective-C çš„ç¤ºä¾‹ï¼š</p><figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">SomeClass</span> : <span class="title">NSObject</span> </span></span><br><span class="line"><span class="keyword">@property</span> <span class="keyword">int</span> number;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">SomeClass</span></span></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> SomeStruct &#123;</span><br><span class="line">    <span class="keyword">int</span> number;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">SomeClass *reference = [[SomeClass alloc] init];</span><br><span class="line">reference.number = <span class="number">42</span>;</span><br><span class="line">SomeClass *reference2 = reference;</span><br><span class="line">reference.number = <span class="number">43</span>;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"The number in reference2 is %d"</span>, reference2.number);</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> SomeStruct value = &#123;&#125;;</span><br><span class="line">value.number = <span class="number">42</span>;</span><br><span class="line"><span class="keyword">struct</span> SomeStruct value2 = value;</span><br><span class="line">value.number = <span class="number">43</span>;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"The number in value2 is %d"</span>, value2.number);</span><br></pre></td></tr></table></figure><p>æ‰“å°çš„ç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight objc"><table><tr><td class="code"><pre><span class="line">The number <span class="keyword">in</span> reference2 is <span class="number">43</span></span><br><span class="line">The number <span class="keyword">in</span> value2 is <span class="number">42</span></span><br></pre></td></tr></table></figure><p>ä¸ºä»€ä¹ˆæ‰“å°ç»“æœä¼šä¸ä¸€æ ·?</p><p>ä»£ç  <code>SomeClass *reference = [[SomeClass alloc] init]</code> åœ¨å†…å­˜ä¸­åˆ›å»ºäº† SomeClass ç±»çš„ä¸€ä¸ªæ–°å®ä¾‹ï¼Œç„¶åå°†è¯¥å®ä¾‹çš„å¼•ç”¨æ”¾åˆ° reference å˜é‡ä¸­ã€‚ä»£ç  <code>reference2 = reference</code> å°† reference å˜é‡çš„å€¼ï¼ˆå®ä¾‹çš„å¼•ç”¨ï¼‰èµ‹å€¼ç»™æ–°çš„ reference2 å˜é‡ã€‚ç„¶å <code>reference.number = 43</code> å°†ä¸¤ä¸ªå˜é‡æŒ‡å‘çš„å¯¹è±¡ï¼ˆåŒä¸€ä¸ªå¯¹è±¡ï¼‰çš„ number å±æ€§ä¿®æ”¹ä¸º 43ã€‚ è¿™å°±å¯¼è‡´æ‰“å°çš„ reference2 çš„å€¼ä¹Ÿæ˜¯ 43ã€‚</p><p>ä»£ç  <code>struct SomeStruct value = {}</code> åˆ›å»º  SomeStruct ç»“æ„ä½“çš„ä¸€ä¸ªæ–°å®ä¾‹å¹¶èµ‹å€¼ç»™å˜é‡ valueã€‚ä»£ç  <code>value2 = value</code> æ‹·è´ value çš„å€¼åˆ° å˜é‡ value2 ä¸­ã€‚æ¯ä¸ªå˜é‡åŒ…å«å„è‡ªçš„æ•°æ®å—ã€‚è€Œä»£ç  <code>value.number = 43</code> ä»…ä»…ä¿®æ”¹ value å˜é‡çš„å€¼ã€‚æ‰€ä»¥ï¼Œvalue2 å˜é‡çš„å€¼ä»ç„¶æ˜¯ 42ã€‚</p><p>ç”¨ Swift å®ç°è¿™ä¸ªä¾‹å­ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SomeClass</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> number: <span class="type">Int</span> = <span class="number">0</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">SomeStruct</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> number: <span class="type">Int</span> = <span class="number">0</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> reference = <span class="type">SomeClass</span>()</span><br><span class="line">reference.number = <span class="number">42</span></span><br><span class="line"><span class="keyword">var</span> reference2 = reference</span><br><span class="line">reference.number = <span class="number">43</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">"The number in reference2 is <span class="subst">\(reference2.number)</span>"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> value = <span class="type">SomeStruct</span>()</span><br><span class="line">value.number = <span class="number">42</span></span><br><span class="line"><span class="keyword">var</span> value2 = value</span><br><span class="line">value.number = <span class="number">43</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">"The number in value2 is <span class="subst">\(value2.number)</span>"</span>)</span><br></pre></td></tr></table></figure><p>å’Œä¹‹å‰ä¸€æ ·ï¼Œæ‰“å°å¦‚ä¸‹ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="type">The</span> number <span class="keyword">in</span> reference2 <span class="keyword">is</span> <span class="number">43</span></span><br><span class="line"><span class="type">The</span> number <span class="keyword">in</span> value2 <span class="keyword">is</span> <span class="number">42</span></span><br></pre></td></tr></table></figure><h2 id="ä½¿ç”¨å€¼ç±»å‹çš„ç»éªŒ"><a href="#ä½¿ç”¨å€¼ç±»å‹çš„ç»éªŒ" class="headerlink" title="ä½¿ç”¨å€¼ç±»å‹çš„ç»éªŒ"></a>ä½¿ç”¨å€¼ç±»å‹çš„ç»éªŒ</h2><p>å€¼ç±»å‹ä¸æ˜¯æ–°å‡ºçš„ç±»å‹ã€‚ä½†æ˜¯å¯¹äºå¾ˆå¤šäººæ¥è¯´ï¼Œä»–ä»¬<em>æ„Ÿè§‰ä¸Š</em>å¾ˆæ–°ã€‚è¿™æ˜¯æ€ä¹ˆå›äº‹ï¼Ÿ</p><p>å¤§éƒ¨åˆ† Objective-C ä»£ç ä¸ä¼šç”¨åˆ° structã€‚æˆ‘ä»¬é€šå¸¸æ“ä½œçš„æ˜¯ CGRect ã€ CGPoint å’Œå‹å…ƒï¼Œå¾ˆå°‘è‡ªå·±å®šä¹‰ç»“æ„ä½“ã€‚ä¸€æ–¹é¢ï¼Œç»“æ„ä½“ä¸å®ç”¨ï¼Œæ— æ³•åšå‡½æ•°å¼çš„å¼•ç”¨èµ‹å€¼ã€‚åœ¨ Objective-C ä¸­ï¼Œæ­£ç¡®ä¿å­˜å¯¹è±¡çš„å¼•ç”¨åˆ° struct ä¸­æ˜¯å¾ˆå›°éš¾çš„ï¼Œå°¤å…¶æ˜¯ä½¿ç”¨ ARC çš„æ—¶å€™ã€‚</p><p>å¤§éƒ¨åˆ†è¯­è¨€æ²¡æœ‰ç±»ä¼¼ struct ç»“æ„ä½“çš„ä¸œè¥¿ã€‚åƒ Python å’Œ JavaScript è¿™æ ·â€œä¸€åˆ‡çš†å¯¹è±¡â€çš„è¯­è¨€éƒ½åªæœ‰å¼•ç”¨ç±»å‹ã€‚å¦‚æœä½ æ˜¯ä»è¿™æ ·çš„è¯­è¨€è½¬åˆ° Swiftï¼Œå€¼ç±»å‹è¿™ä¸ªæ¦‚å¿µå¯èƒ½å¯¹ä½ æ¥è¯´æ›´åŠ é™Œç”Ÿã€‚</p><p>ä¸è¿‡ç­‰ä¸€ä¸‹ï¼æœ‰ä¸€ä¸ªåœ°æ–¹å‡ ä¹æ‰€æœ‰çš„è¯­è¨€éƒ½ä¼šä½¿ç”¨å€¼ç±»å‹ï¼šæ•°å€¼ï¼ˆnumberï¼‰ï¼åªè¦ä½ å†™è¿‡ä¸€æ®µæ—¶é—´ä»£ç ï¼Œæ— è®ºæ˜¯ä»€ä¹ˆè¯­è¨€ï¼Œè‚¯å®šèƒ½ç†è§£ä¸‹é¢è¿™æ®µä»£ç çš„è¡Œä¸ºï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> x = <span class="number">42</span></span><br><span class="line"><span class="keyword">var</span> x2 = x</span><br><span class="line">x++</span><br><span class="line"><span class="built_in">print</span>(<span class="string">"x=<span class="subst">\(x)</span> x2=<span class="subst">\(x2)</span>"</span>)</span><br><span class="line"><span class="comment">// prints: x=43 x2=42</span></span><br></pre></td></tr></table></figure><p>è¿™å¯¹æˆ‘ä»¬æ¥è¯´æ˜¯éå¸¸æ˜æ˜¾å’Œè‡ªç„¶çš„ï¼Œæˆ‘ä»¬ç”šè‡³æ²¡æœ‰æ„è¯†åˆ°å®ƒçš„è¡Œä¸ºä¸ä¼—ä¸åŒã€‚ä½†æ˜¯å®ƒç¡®ç¡®å®å®æ˜¯å€¼ç±»å‹ã€‚ä»ä½ ç¼–ç¨‹çš„ç¬¬ä¸€å¤©å¼€å§‹å°±ä¸€ç›´åœ¨ä½¿ç”¨å€¼ç±»å‹ï¼Œå³ä½¿ä½ æ²¡æœ‰æ„è¯†åˆ°è¿™ä¸€ç‚¹ã€‚</p><p>ç”±äºè®¸å¤šè¯­è¨€çš„æ ¸å¿ƒæ˜¯â€œä¸€åˆ‡çš†å¯¹è±¡â€ï¼Œnumber å…¶å®æ˜¯ç”¨å¼•ç”¨ç±»å‹æ¥å®ç°çš„ã€‚ç„¶è€Œï¼Œå®ƒä»¬æ˜¯ä¸å¯å˜å¼•ç”¨ç±»å‹ï¼Œä¸å¯å˜å¼•ç”¨ç±»å‹å’Œå€¼ç±»å‹çš„å·®å¼‚æ˜¯å¾ˆéš¾å¯Ÿè§‰çš„ã€‚å®ƒä»¬çš„è¡Œä¸ºå’Œå€¼ç±»å‹ä¸€æ ·ï¼Œå³ä½¿å®ƒä»¬ä¸æ˜¯ä»¥è¿™ç§æ–¹å¼å®ç°ã€‚</p><p>è¿™æ˜¯ç†è§£å€¼ç±»å‹å’Œå¼•ç”¨ç±»å‹çš„é‡è¦éƒ¨åˆ†ã€‚å°±è¯­è¨€è¯­ä¹‰æ–¹é¢ï¼ŒåŒºåˆ«æ˜¯å¾ˆé‡è¦çš„ã€‚å½“ä¿®æ”¹æ•°æ®æ—¶ï¼Œå¦‚æœä½ çš„æ•°æ®æ˜¯ä¸å¯å˜çš„ï¼Œé‚£ä¹ˆå€¼ç±»å‹/å¼•ç”¨ç±»å‹ä¹‹é—´çš„åŒºåˆ«å°±æ¶ˆå¤±äº†ï¼Œæˆ–è€…è‡³å°‘å˜æˆçº¯ç²¹çš„æ€§èƒ½é—®é¢˜è€Œä¸æ˜¯è¯­ä¹‰é—®é¢˜ã€‚</p><p>Objective-C ä¸­ä¹Ÿæœ‰ç±»ä¼¼çš„ä¸œè¥¿ï¼Œå°±æ˜¯æ ‡è®°æŒ‡é’ˆï¼ˆtagged pointersï¼‰ã€‚æ ‡è®°æŒ‡é’ˆæŠŠå¯¹è±¡ç›´æ¥å­˜å‚¨åœ¨æŒ‡é’ˆå€¼ä¸­ï¼Œå› æ­¤å®ƒå®é™…ä¸Šæ˜¯å€¼ç±»å‹ï¼Œæ‹·è´æŒ‡é’ˆç›¸å½“äºæ‹·è´å¯¹è±¡ã€‚Objective-C çš„åº“åªä¼šæŠŠä¸å¯å˜ç±»å‹å­˜å‚¨åˆ°æ ‡è®°æŒ‡é’ˆä¸­ï¼Œæ‰€ä»¥ä½¿ç”¨çš„æ—¶å€™æ„Ÿå—ä¸åˆ°åŒºåˆ«ã€‚æœ‰äº› NSNumber æ˜¯å¼•ç”¨ç±»å‹ï¼Œæœ‰äº›æ˜¯å€¼ç±»å‹ï¼Œä½†æ˜¯ä½¿ç”¨ä¸Šæ²¡æœ‰åŒºåˆ«ã€‚</p><h2 id="åšå‡ºé€‰æ‹©"><a href="#åšå‡ºé€‰æ‹©" class="headerlink" title="åšå‡ºé€‰æ‹©"></a>åšå‡ºé€‰æ‹©</h2><p>æ—¢ç„¶æˆ‘ä»¬å·²ç»çŸ¥é“å€¼ç±»å‹æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Œé‚£ä¹ˆä½ è‡ªå·±çš„æ•°æ®ç±»å‹è¯¥ç”¨ä»€ä¹ˆå‘¢ï¼Ÿ</p><p>è¿™ä¸¤è€…ä¹‹é—´çš„æ ¹æœ¬åŒºåˆ«åœ¨äºï¼Œå½“ä½ ä½¿ç”¨ <code>=</code> æ—¶ä¼šå‘ç”Ÿä»€ä¹ˆã€‚å€¼ç±»å‹ä¼šå¾—åˆ°è¯¥å¯¹è±¡çš„å‰¯æœ¬ï¼Œå¼•ç”¨ç±»å‹ä»…ä»…å¾—åˆ°è¯¥å¯¹è±¡çš„å¼•ç”¨ã€‚</p><p>å› æ­¤ï¼Œå†³å®šä½¿ç”¨å“ªä¸€ä¸ªçš„åŸºæœ¬é—®é¢˜æ˜¯ï¼šæ˜¯å¦éœ€è¦æ‹·è´ï¼Ÿæ˜¯å¦éœ€è¦ç»å¸¸æ‹·è´ï¼Ÿ</p><p>é¦–å…ˆæ¥çœ‹ä¸€äº›æ¯«æ— äº‰è®®çš„ä¾‹å­ã€‚Integer æ˜¾ç„¶æ˜¯å¯æ‹·è´çš„ï¼Œå®ƒåº”è¯¥æ˜¯å€¼ç±»å‹ã€‚ç½‘ç»œå¥—æ¥å­—ï¼ˆNetwork socketsï¼‰æ˜æ˜¾æ˜¯ä¸å¯æ‹·è´çš„ï¼Œå®ƒåº”è¯¥æ˜¯å¼•ç”¨ç±»å‹ã€‚å†æ¯”å¦‚ä½¿ç”¨ (x, y) å®æ•°å¯¹è¡¨ç¤ºçš„åæ ‡ï¼ˆPointsï¼‰æ˜¯å¯æ‹·è´çš„ï¼Œå®ƒåº”è¯¥æ˜¯å€¼ç±»å‹ã€‚ä»£è¡¨ç£ç›˜çš„æ§åˆ¶å™¨æ˜¯æ˜æ˜¾ä¸å¯æ‹·è´çš„ï¼Œå®ƒåº”è¯¥æ˜¯å¼•ç”¨ç±»å‹ã€‚</p><p>æœ‰äº›ç±»å‹ç†è®ºä¸Š<em>å¯ä»¥</em>æ‹·è´ï¼Œä½†æ˜¯è¿™ç§æ‹·è´å¯èƒ½ä¸æ˜¯ä½ æƒ³è¦çš„ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œå®ƒä»¬åº”è¯¥æ˜¯å¼•ç”¨ç±»å‹ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå±å¹•ä¸Šçš„æŒ‰é’®åœ¨ä»£ç å±‚é¢å¯ä»¥æ‹·è´ï¼Œä½†æ˜¯æ‹·è´çš„æŒ‰é’®å’ŒåŸå§‹æŒ‰é’®å¹¶ä¸ä¸€æ ·ã€‚ç‚¹å‡»æ‹·è´çš„æŒ‰é’®å¹¶ä¸ä¼šè§¦å‘åŸå§‹æŒ‰é’®ï¼Œæ‹·è´çš„æŒ‰é’®åœ¨å±å¹•ä¸Šçš„ä½ç½®ä¹Ÿå’ŒåŸå§‹æŒ‰é’®ä¸ä¸€æ ·ã€‚å¦‚æœä½ éœ€è¦æŠŠæŒ‰é’®å½“æˆå‚æ•°ä¼ é€’ï¼Œæˆ–è€…å°†å®ƒèµ‹å€¼ç»™ä¸€ä¸ªæ–°å˜é‡ï¼Œé‚£ä½ éœ€è¦çš„æ˜¯åŸå§‹æŒ‰é’®çš„å¼•ç”¨ï¼Œåªæœ‰æ˜ç¡®å£°æ˜çš„æ—¶å€™æ‰è¿›è¡Œæ‹·è´ã€‚å› æ­¤ï¼ŒæŒ‰é’®åº”è¯¥æ˜¯å¼•ç”¨ç±»å‹ã€‚</p><p>è§†å›¾å’Œçª—å£æ§åˆ¶å™¨ä¹Ÿç±»ä¼¼ã€‚å®ƒä»¬å¯ä»¥æ”¯æŒæ‹·è´ï¼Œä½†ä¸€èˆ¬æ¥è¯´è¿™ä¸æ˜¯ä½ æœŸæœ›çš„è¡Œä¸ºï¼Œå®ƒä»¬åº”è¯¥æ˜¯å¼•ç”¨ç±»å‹ã€‚</p><p>æ¥ç€è°ˆè°ˆæ¨¡å‹ï¼ˆmodelï¼‰ç±»å‹ã€‚å‡è®¾ä½ æœ‰ä¸€ä¸ª User ç±»å‹ï¼Œç”¨æ¥è¡¨ç¤ºç³»ç»Ÿä¸­çš„ç”¨æˆ·ï¼Œç„¶åç”¨ Crime ç±»å‹æ¥è¡¨ç¤º User çš„æ“ä½œã€‚è¿™ä¸¤ä¸ªç±»å‹çœ‹èµ·æ¥éƒ½å¯ä»¥æ‹·è´ï¼Œå¯ä»¥è®¾ç½®æˆå€¼ç±»å‹ã€‚ä½†æ˜¯ï¼Œå¦‚æœä½ çš„ç¨‹åºéœ€è¦æ›´æ–° User çš„ Crime å¹¶ä¸”èƒ½æŠŠæ”¹åŠ¨åŒæ­¥åˆ°å…¶ä»–ä»£ç ï¼Œé‚£æœ€å¥½ç”¨ä¸€ä¸ªç”¨æˆ·æ§åˆ¶å™¨ï¼ˆUser Controllerï¼‰æ¥ç®¡ç† Userï¼Œæ˜¾ç„¶è¿™ä¸ªç”¨æˆ·æ§åˆ¶å™¨åº”è¯¥æ˜¯å¼•ç”¨ç±»å‹ã€‚</p><p>é›†åˆæ˜¯ä¸ªæœ‰è¶£çš„ä¾‹å­ã€‚é›†åˆåŒ…æ‹¬æ•°ç»„ã€å­—å…¸ã€å­—ç¬¦ä¸²ç­‰ç±»å‹ã€‚å®ƒä»¬æ˜¯å¯æ‹·è´çš„å—ï¼Ÿæ˜¾ç„¶æ˜¯ã€‚æ˜¯å¦éœ€è¦ç»å¸¸æ‹·è´ï¼Ÿè¿™å°±ä¸å¥½è¯´äº†</p><p>å¤§éƒ¨åˆ†è¯­è¨€çš„å›ç­”æ˜¯â€œNoâ€ï¼Œå®ƒä»¬çš„é›†åˆæ˜¯å¼•ç”¨ç±»å‹ã€‚æ¯”å¦‚ Objective-Cã€Javaã€Pythonã€JavaScript ä»¥åŠä¸€äº›æˆ‘èƒ½æƒ³åˆ°çš„è¯­è¨€ã€‚ï¼ˆä¸€ä¸ªä¾‹å¤–æ˜¯ C++ çš„ STL é›†åˆï¼Œä½†æ˜¯ C++ æ˜¯è¯­è¨€ä¸­çš„ç–¯å­ï¼Œå®ƒåšçš„æ¯ä»¶äº‹éƒ½å¾ˆå¥‡æ€ªã€‚ï¼‰</p><p>Swift æ˜¯å¯æ‹·è´çš„ã€‚è¿™æ„å‘³ç€ <code>Array</code> ã€ <code>Dictionary</code> å’Œ <code>String</code> æ˜¯ç»“æ„ä½“è€Œä¸æ˜¯ç±»ã€‚å¯ä»¥å°†ä»–ä»¬çš„æ‹·è´ä½œä¸ºå‚æ•°æ¥ä½¿ç”¨ã€‚å¦‚æœæ‹·è´ä»˜å‡ºçš„ä»£ä»·å¾ˆå°ï¼Œè¿™ä¹ˆåšå°±å®Œå…¨åˆç†ã€‚Swift ä¸ºäº†å®ç°è¿™ä¸ªåŠŸèƒ½èŠ±äº†å¾ˆå¤§åŠŸå¤«ã€‚ã€‚</p><h2 id="åµŒå¥—ç±»å‹"><a href="#åµŒå¥—ç±»å‹" class="headerlink" title="åµŒå¥—ç±»å‹"></a>åµŒå¥—ç±»å‹</h2><p>åµŒå¥—å€¼ç±»å‹å’Œå¼•ç”¨ç±»å‹æœ‰å››ç§æ–¹å¼ã€‚å“ªæ€•åªç”¨åˆ°äº†å…¶ä¸­ä¸€ç§ï¼Œä½ çš„ç”Ÿæ´»éƒ½ä¼šå˜å¾—æ›´åŠ æœ‰è¶£ã€‚</p><ol><li>åŒ…å«å…¶ä»–å¼•ç”¨ç±»å‹çš„å¼•ç”¨ç±»å‹ï¼Œè¿™æ²¡ä»€ä¹ˆç‰¹åˆ«çš„ã€‚å¦‚æœæŒæœ‰å†…éƒ¨æˆ–å¤–éƒ¨å€¼çš„å¼•ç”¨ï¼Œå°±å¯ä»¥ä¿®æ”¹è¿™ä¸ªå€¼ã€‚æ”¹åŠ¨ä¼šåŒæ­¥åˆ°æ‰€æœ‰æŒæœ‰è€…ã€‚</li><li>åŒ…å«å…¶ä»–å€¼ç±»å‹çš„å€¼ç±»å‹ï¼Œè¿™æ ·åšçš„ç»“æœæ˜¯ä¸€ä¸ªæ›´åºå¤§çš„å€¼ç±»å‹ã€‚å½“å†…éƒ¨å€¼æ˜¯å¤–éƒ¨å€¼çš„ä¸€éƒ¨åˆ†æ—¶ï¼Œå¦‚æœä½ å°†å¤–éƒ¨å€¼å­˜å‚¨åˆ°æŸä¸ªæ–°åœ°æ–¹ï¼Œæ•´ä¸ªå€¼ç±»å‹éƒ½ä¼šè¢«æ‹·è´ï¼ŒåŒ…æ‹¬å†…éƒ¨å€¼ã€‚å¦‚æœä½ å°†å†…éƒ¨å€¼å‚¨å­˜åˆ°æ–°åœ°æ–¹ï¼Œé‚£å°±åªæ‹·è´å†…éƒ¨å€¼ã€‚</li><li>åŒ…å«å€¼ç±»å‹çš„å¼•ç”¨ç±»å‹ï¼Œè¢«å¼•ç”¨çš„å€¼ä¼šå˜å¤§ã€‚å¤–éƒ¨å€¼çš„å¼•ç”¨å¯ä»¥æ“ä½œæ•´ä¸ªå¯¹è±¡ï¼ŒåŒ…æ‹¬å†…éƒ¨å€¼ã€‚ä¿®æ”¹å†…éƒ¨å€¼æ—¶ï¼Œå¤–éƒ¨å€¼å¼•ç”¨çš„æŒæœ‰è€…éƒ½ä¼šåŒæ­¥æ”¹åŠ¨ã€‚å¦‚æœä½ å°†å†…éƒ¨å€¼å‚¨å­˜åˆ°æ–°åœ°æ–¹ï¼Œå®ƒä¼šè¢«æ‹·è´ã€‚</li><li>åŒ…å«å¼•ç”¨ç±»å‹çš„å€¼ç±»å‹ï¼Œè¿™å°±æœ‰ç‚¹å¤æ‚äº†ã€‚ä½ å¯èƒ½ä¼šé‡åˆ°æ„æ–™ä¹‹å¤–çš„è¡Œä¸ºã€‚è¿™æœ‰åˆ©æœ‰å¼Šï¼Œå–å†³äºä½ çš„ä½¿ç”¨æ–¹å¼ã€‚å¦‚æœä½ å°†ä¸€ä¸ªå¼•ç”¨ç±»å‹æ”¾åˆ°å€¼ç±»å‹ä¸­ï¼Œç„¶åæ‹·è´è¿™ä¸ªå€¼ç±»å‹åˆ°ä¸€ä¸ªæ–°åœ°æ–¹ï¼Œæ‹·è´ä¸­çš„å†…éƒ¨å¯¹è±¡çš„å¼•ç”¨å€¼æ˜¯ç›¸åŒçš„ï¼Œå®ƒä»¬éƒ½æŒ‡å‘ç›¸åŒçš„åœ°æ–¹ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼š</li></ol><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Inner</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> value = <span class="number">42</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Outer</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> value = <span class="number">42</span></span><br><span class="line">    <span class="keyword">var</span> inner = <span class="type">Inner</span>()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> outer = <span class="type">Outer</span>()</span><br><span class="line"><span class="keyword">var</span> outer2 = outer</span><br><span class="line">outer.value = <span class="number">43</span></span><br><span class="line">outer.inner.value = <span class="number">43</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">"outer2.value=<span class="subst">\(outer2.value)</span> outer2.inner.value=<span class="subst">\(outer2.inner.value)</span>"</span>)</span><br></pre></td></tr></table></figure><p>æ‰“å°å¦‚ä¸‹ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">outer2.value=<span class="number">42</span> outer2.inner.value=<span class="number">43</span></span><br></pre></td></tr></table></figure><p><code>outer2</code> æ˜¯ <code>outer</code> çš„æ‹·è´ï¼Œå®ƒä»…ä»…æ‹·è´äº† <code>inner</code> çš„å¼•ç”¨ï¼Œå› æ­¤ä¸¤ä¸ªç»“æ„ä½“çš„ <code>inner</code> å…±äº«ä¸€ä¸ªå­˜å‚¨ç©ºé—´ã€‚å› æ­¤æ›´æ–° <code>outer.inner.value</code> çš„å€¼ä¼šå½±å“ <code>outer2.inner.value</code> çš„å€¼ã€‚ç¥å¥‡ï¼</p><p>å¦‚æœä½¿ç”¨å¾—å½“ï¼Œä¸Šé¢çš„è¿™ç§è¡Œä¸ºä½¿ç¼–ç¨‹å˜å¾—å¾ˆæ–¹ä¾¿ï¼Œå®ƒå…è®¸ä½ åˆ›å»ºä¸€ä¸ªæ”¯æŒå†™æ—¶å¤åˆ¶çš„ <code>struct</code> ï¼Œå…è®¸ä½ ä¸éœ€è¦æ‹·è´å¤§é‡çš„æ•°æ®å°±å¯ä»¥å®ç°å€¼è¯­ä¹‰ã€‚è¿™å°±æ˜¯ Swift çš„é›†åˆå·¥ä½œæœºåˆ¶ï¼Œä½ ä¹Ÿå¯ä»¥åˆ›å»ºè‡ªå·±çš„é›†åˆã€‚å¦‚æœæƒ³äº†è§£æ›´å¤šï¼Œå¯ä»¥é˜…è¯» <a href="https://www.mikeash.com/pyblog/friday-qa-2015-04-17-lets-build-swiftarray.html" target="_blank" rel="noopener">ä¸€èµ·æ¥æ„å»º Swift Array</a>ã€‚</p><p>è¿™ç§è¡Œä¸ºä¹Ÿç›¸å½“å±é™©ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œä½ æœ‰ä¸€ä¸ªå¯æ‹·è´çš„ Person ç±»ï¼Œæ‰€ä»¥å®ƒå¯ä»¥æ˜¯ <code>struct</code> ç±»å‹ï¼Œä¸ºäº†æ€€æ—§ï¼Œä½ å†³å®šç”¨ <code>NSString</code> ç±»å‹æ¥ä¿å­˜å§“åï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">     <span class="keyword">var</span> name: <span class="type">NSString</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åç”Ÿæˆä¸€å¯¹å¤«å¦‡çš„å®ä¾‹ï¼Œåˆ†åˆ«ç»™æ¯ä¸ªå®ä¾‹çš„å§“åèµ‹å€¼ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> name = <span class="type">NSMutableString</span>()</span><br><span class="line">name.appendString(<span class="string">"Bob"</span>)</span><br><span class="line">name.appendString(<span class="string">" "</span>)</span><br><span class="line">name.appendString(<span class="string">"Josephsonson"</span>)</span><br><span class="line"><span class="keyword">let</span> bob = <span class="type">Person</span>(name: name)</span><br><span class="line"></span><br><span class="line">name.appendString(<span class="string">", Jr."</span>)</span><br><span class="line"><span class="keyword">let</span> bobjr = <span class="type">Person</span>(name: name)</span><br></pre></td></tr></table></figure><p>æ‰“å°ä»–ä»¬çš„å§“åï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="built_in">print</span>(bob.name)</span><br><span class="line"><span class="built_in">print</span>(bobjr.name)</span><br></pre></td></tr></table></figure><p>ç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="type">Bob</span> <span class="type">Josephsonson</span>, <span class="type">Jr</span>.</span><br><span class="line"><span class="type">Bob</span> <span class="type">Josephsonson</span>, <span class="type">Jr</span>.</span><br></pre></td></tr></table></figure><p>å–”ï¼</p><p>å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿä¸ Swift ä¸­çš„ <code>String</code> ç±»å‹ä¸åŒï¼Œ<code>NSString</code> æ˜¯ä¸€ä¸ªå¼•ç”¨ç±»å‹ï¼Œæ˜¯ä¸å¯å˜çš„ï¼Œä½†æ˜¯å®ƒæœ‰ä¸€ä¸ªå¯å˜çš„å­ç±» <code>NSMutableString</code> ã€‚æ„å»º bob æ—¶ï¼Œç”Ÿæˆäº†ä¸€ä¸ªè¢« name ä¸­å­—ç¬¦ä¸²æ‰€æŒæœ‰çš„å¼•ç”¨ã€‚éšåæ”¹å˜ è¿™ä¸ªå­—ç¬¦ä¸²æ—¶ï¼Œæ”¹åŠ¨è¢«åŒæ­¥åˆ°äº† bob ä¸­ã€‚è™½ç„¶ bob æ˜¯ç”¨ <code>let</code> å£°æ˜å€¼ç±»å‹ï¼Œä½†æ˜¯æ­¤å¤„çš„èµ‹å€¼æ“ä½œæ˜¾ç„¶æ”¹å˜äº† bobã€‚äº‹å®ä¸Šï¼Œè¿™æ²¡æœ‰è¦†å†™ bobï¼Œåªä¸è¿‡æ˜¯æ”¹å˜äº† bob æŒæœ‰çš„å¼•ç”¨çš„æ•°æ®ã€‚å› ä¸º name æ˜¯ bob çš„ä¸€éƒ¨åˆ†æ•°æ®ï¼Œä»è¯­ä¹‰ä¸Šçœ‹ï¼Œå°±å¥½åƒè¦†å†™äº† bobã€‚</p><p>è¿™ç§è¡Œä¸ºåœ¨ Objective-C ä¸­ä¸€ç›´å­˜åœ¨ã€‚æ¯ä¸ªæœ‰ç»éªŒçš„ Objective-C å¼€å‘è€…éƒ½èƒ½é¿å…è¿™ç§è¡Œä¸ºã€‚å› ä¸ºä¸€ä¸ª <code>NSString</code> å®é™…ä¸Šå¯èƒ½æ˜¯ä¸€ä¸ª <code>NSMutableString</code> ã€‚ä¸ºäº†é˜²æ­¢è¿™ç§è¡Œä¸ºï¼Œå¯ä»¥å£°æ˜ä¸€ä¸ª <code>copy</code> çš„å±æ€§æˆ–è€…åœ¨åˆå§‹åŒ–çš„æ—¶å€™æ˜¾å¼çš„è°ƒç”¨ <code>copy</code> æ–¹æ³•ã€‚åœ¨è®¸å¤š Cocoa çš„é›†åˆä¸­å¯ä»¥å‘ç°è¿™ç§åšæ³•ã€‚</p><p>Swift çš„è§£å†³æ–¹æ³•å¾ˆç®€å•ï¼šç”¨å€¼ç±»å‹è€Œä¸æ˜¯å¼•ç”¨ç±»å‹ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå£°æ˜ name ä¸º <code>String</code> ç±»å‹å³å¯ã€‚è¿™æ ·å°±ä¸ç”¨æ‹…å¿ƒæ— æ„ä¸­å‡ºç°å­˜å‚¨å…±äº«çš„é—®é¢˜ã€‚</p><p>æœ‰äº›æƒ…å†µä¸‹ï¼Œè§£å†³æ–¹æ³•å¯èƒ½æ²¡æœ‰è¿™ä¹ˆç®€å•ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œä½ å¯èƒ½ä¼šåˆ›å»ºä¸€ä¸ª åŒ…å«å¼•ç”¨ç±»å‹å˜é‡ view çš„ <code>struct</code> ï¼Œå¹¶ä¸”å®ƒä¸èƒ½æ”¹å˜ä¸ºå€¼ç±»å‹ã€‚è¿™<em>ä¹Ÿè®¸</em>è¡¨ç¤ºä½ çš„ç±»å‹ä¸åº”è¯¥æ˜¯ <code>struct</code> ï¼Œå› ä¸ºä½ æ— è®ºå¦‚ä½•ä¹Ÿä¸èƒ½å®ç°å€¼è¯­ä¹‰ã€‚</p><h2 id="ç»“è®º"><a href="#ç»“è®º" class="headerlink" title="ç»“è®º"></a>ç»“è®º</h2><p>ç§»åŠ¨å€¼è¯­ä¹‰ç±»å‹çš„æ•°æ®æ—¶ï¼Œæ–°æ•°æ®æ˜¯åŸæ•°æ®çš„æ‹·è´ã€‚ç„¶è€Œï¼Œå¼•ç”¨è¯­ä¹‰ç±»å‹çš„æ•°æ®å¾—åˆ°çš„æ˜¯åŸæ•°æ®çš„å¼•ç”¨æ‹·è´ã€‚è¿™æ„å‘³ç€ä½ å¯ä»¥åœ¨ä»»ä½•åœ°æ–¹é€šè¿‡å¼•ç”¨è¦†å†™åŸæ•°æ®ã€‚è€Œå€¼è¯­ä¹‰åªèƒ½é€šè¿‡æ”¹å˜åŸæ•°æ®æ¥æ”¹å˜åŸæ•°æ®çš„å€¼ã€‚é€‰æ‹©ç±»å‹æ—¶ï¼Œè¦è€ƒè™‘è¯¥ç±»å‹æ˜¯å¦é€‚åˆæ‹·è´å’Œå€¾å‘äºæ‹·è´çš„å›ºæœ‰ç±»å‹ã€‚æœ€åï¼Œæ³¨æ„å€¼ç±»å‹ä¸­åµŒå¥—çš„å¼•ç”¨ç±»å‹ï¼Œå¦‚æœä½ ä¸ç•™å¿ƒå°†ä¼šå‘ç”Ÿä¸€äº›ç³Ÿç³•çš„äº‹æƒ…ã€‚</p><p>ä»Šå¤©çš„å†…å®¹åˆ°æ­¤ç»“æŸï¼Œè¿™æ¬¡æ˜¯çœŸçš„ç»“æŸäº†ï¼Œä¸‹æ¬¡å†è§ã€‚ä½ ä»¬çš„å»ºè®®å¯¹ Friday Q&amp;A  æ˜¯æœ€å¥½çš„é¼“åŠ±ï¼Œæ‰€ä»¥å¦‚æœä½ å…³äºè¿™ä¸ªä¸»é¢˜æœ‰ä»€ä¹ˆå¥½çš„æƒ³æ³•ï¼Œè¯·<a href="mailto:mike@mikeash.com" target="_blank" rel="noopener">å‘é‚®ä»¶åˆ°è¿™é‡Œ</a>ã€‚</p><blockquote><p>ä½ å–œæ¬¢è¿™ç¯‡æ–‡ç« ä¹ˆï¼Ÿæˆ‘çš„ä¹¦é‡Œè¿˜æœ‰æ›´å¤šæœ‰æ„æ€çš„å†…å®¹ï¼ç¬¬äºŒå· å’Œ ç¬¬ä¸‰å·æ­£åœ¨å‡ºå”®ä¸­ï¼åŒ…æ‹¬ ePubï¼ŒPDFï¼Œçº¸è´¨ç‰ˆï¼ŒiBooks å’Œ Kindleï¼Œ<a href="https://www.mikeash.com/book.html" target="_blank" rel="noopener">ç‚¹å‡»æŸ¥çœ‹æ›´å¤šä¿¡æ¯</a>ã€‚</p></blockquote><blockquote><p>æœ¬æ–‡ç”± SwiftGG ç¿»è¯‘ç»„ç¿»è¯‘ï¼Œå·²ç»è·å¾—ä½œè€…ç¿»è¯‘æˆæƒï¼Œæœ€æ–°æ–‡ç« è¯·è®¿é—® <a href="http://swift.gg">http://swift.gg</a>ã€‚</p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;ä½œè€…ï¼šMike Ashï¼Œ&lt;a href=&quot;https://www.mikeash.com/pyblog/friday-qa-2015-07-17-when-to-use-swift-structs-and-classes.html&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;åŸæ–‡é“¾æ¥&lt;/a&gt;ï¼ŒåŸæ–‡æ—¥æœŸï¼š2015-07-17&lt;br&gt;è¯‘è€…ï¼š&lt;a href=&quot;http://muhlenxi.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;muhlenXi&lt;/a&gt;ï¼›æ ¡å¯¹ï¼š&lt;a href=&quot;undefined&quot;&gt;Firecrest&lt;/a&gt;ï¼Œ&lt;a href=&quot;http://numbbbbb.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;numbbbbb&lt;/a&gt;ï¼Œ&lt;a href=&quot;https://github.com/Cee&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Cee&lt;/a&gt;ï¼›å®šç¨¿ï¼š&lt;a href=&quot;https://github.com/chenmingbiao&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;CMB&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;!--æ­¤å¤„å¼€å§‹æ­£æ–‡--&gt;
&lt;p&gt;åœ¨ Swift çš„ä¸–ç•Œä¸­ï¼Œæœ‰ä¸€ä¸ªçƒ­è®®å¾ˆä¹…çš„ä¸»é¢˜ï¼Œä½•æ—¶ä½¿ç”¨ &lt;code&gt;class&lt;/code&gt; å’Œä½•æ—¶ä½¿ç”¨ &lt;code&gt;struct&lt;/code&gt; ï¼Œä»Šå¤©ï¼Œæˆ‘æƒ³å‘è¡¨ä¸€ä¸‹æˆ‘è‡ªå·±çš„è§‚ç‚¹ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="mikeash.com" scheme="https://swift.gg/categories/mikeash-com/"/>
    
    
      <category term="Swift å…¥é—¨" scheme="https://swift.gg/tags/Swift-%E5%85%A5%E9%97%A8/"/>
    
  </entry>
  
  <entry>
    <title>å…³äºæ³¨é‡Š</title>
    <link href="https://swift.gg/2018/07/11/on-comments/"/>
    <id>https://swift.gg/2018/07/11/on-comments/</id>
    <published>2018-07-11T00:00:00.000Z</published>
    <updated>2018-09-10T03:53:25.085Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ä½œè€…ï¼šSoroush Khanlouï¼Œ<a href="http://khanlou.com/2017/03/on-comments/" target="_blank" rel="noopener">åŸæ–‡é“¾æ¥</a>ï¼ŒåŸæ–‡æ—¥æœŸï¼š2017-03-22<br>è¯‘è€…ï¼š<a href="undefined">TonyHan</a>ï¼›æ ¡å¯¹ï¼š<a href="https://weibo.com/1743643682/profile?topnav=1&amp;wvr=6" target="_blank" rel="noopener">liberalism</a>ï¼Œ<a href="undefined">Firecrest</a>ï¼›å®šç¨¿ï¼š<a href="https://github.com/chenmingbiao" target="_blank" rel="noopener">CMB</a></p></blockquote><!--æ­¤å¤„å¼€å§‹æ­£æ–‡--><p>å†™ä»£ç çš„è¿‡ç¨‹ä¸­ï¼Œå¤æ‚æ€§æ˜¯æœ€å¤§çš„æ•Œäººã€‚å¯¹äºå¤§å‹çš„è½¯ä»¶é¡¹ç›®æ¥è¯´ï¼Œç»´æŠ¤å¤šå±‚æŠ½è±¡å¹¶ä¸”è®©åœ¨ä»£ç åº“ä¸­å·¥ä½œçš„å¼€å‘è€…æ­£ç¡®çš„ç†è§£è¿™äº›æ¦‚å¿µæ˜¯å¾ˆé‡è¦çš„ã€‚</p><p>æ³¨é‡Šå¯ä»¥å¯¹ç®¡ç†ä»£ç å¤æ‚æ€§èµ·åˆ°ä¸€å®šä½œç”¨ï¼Œä½†ä¹Ÿä¼šå¯¹ä»£ç äº§ç”Ÿä¸è‰¯å½±å“ã€‚</p><p>æˆ‘å¯¹æ³¨é‡Šçš„çœ‹æ³•æ¥è‡ªäºä¸¤ä¸ªäº‹å®ï¼š1ï¼‰æ³¨é‡Šå¹¶ä¸å¤æ‚ã€‚2ï¼‰æ³¨é‡Šé€šå¸¸åœ¨è¯­æ³•é«˜äº®ä¸­ä½¿ç”¨æŸ”å’Œçš„è‰²å½©ã€‚å› ä¸ºå®ƒä»¬ä¸å‚ä¸ç¼–è¯‘ï¼Œå¹¶ä¸”å› ä¸ºå®ƒä»¬å¹¶ä¸é†’ç›®ï¼Œæ‰€ä»¥åœ¨æ›´æ”¹ä»£ç æ—¶ï¼Œå¾ˆå®¹æ˜“å¿½ç•¥å®ƒä»¬ã€‚å¦‚æœæ›´æ”¹äº†ä»£ç ä½†ä¸æ›´æ–°æ³¨é‡Šï¼Œä¾¿å¾—åˆ°äº†ä¸€ä»½æ— æ³•å‡†ç¡®æè¿°ä»£ç åŠŸèƒ½çš„æ³¨é‡Šã€‚</p><a id="more"></a><p>ç†æƒ³çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥åœ¨ä»£ç å®¡æŸ¥ä¸­å¯¹æ³¨é‡ŠåŠæ—¶ä¿®æ­£ï¼Œä½†æ˜¯å®é™…å¼€å‘ä¸­å¾ˆéš¾åšåˆ°è¿™ä¸€ç‚¹ã€‚ä»£ç å®¡æŸ¥å·¥å…·ä¹Ÿä¼šæœ‰è¯­æ³•é«˜äº®æ˜¾ç¤ºï¼Œè¿™åŒæ ·ä¼šè®©æ³¨é‡Šæ˜¾å¾—ä¸é†’ç›®ã€‚å¦å¤–ï¼Œç”±äºä»£ç å®¡æŸ¥åªä¼šæ˜¾ç¤ºè¢«æ”¹åŠ¨çš„å‡ è¡Œä»£ç ï¼Œåªæœ‰å½“æ³¨é‡Šåœ¨æ”¹åŠ¨çš„é™„è¿‘æ—¶ï¼Œè¿™äº›å·²ç»ä¸é€‚ç”¨çš„æ³¨é‡Šæ‰ä¼šè¢«è§‚å¯Ÿåˆ°ã€‚å¦‚æœåœ¨ä¸€ä¸ªæ–¹æ³•ä¸­ä¸èµ·çœ¼çš„ä½ç½®ä¿®æ”¹äº†ä¸€è¡Œä»£ç ï¼Œä½¿å¾—æ–¹æ³•çš„å‰ææ¡ä»¶å‘ç”Ÿäº†å˜åŒ–ï¼Œå®¡æŸ¥ä»£ç çš„äººåˆ™å¾ˆéš¾æ³¨æ„åˆ°ï¼Œä¹Ÿä¸ä¼šå‘ŠçŸ¥ä½ å»æ›´æ–°æ³¨é‡Šã€‚</p><p>è¿™é‡Œæœ‰ä¸€äº›é¿å…æœ€å¸¸è§æ³¨é‡Šè¯¯åŒºçš„æŠ€å·§ï¼Œå…¶ä¸­ä¸€äº›åœ¨<a href="http://www.strongopinionsweaklytyped.com/blog/2014/08/27/beware-the-siren-song-of-comments/" target="_blank" rel="noopener">æˆ‘çš„è€é¢†å¯¼çš„åšå®¢</a>ä¸­æåˆ°è¿‡ï¼Œå…¶ä»–çš„å®‰å¾·é²æ²¡æœ‰æƒ³åˆ°æ˜¯å› ä¸ºä»–æ˜¯ Rubyï¼ˆä¸€é—¨åŠ¨æ€ç±»å‹çš„è¯­è¨€ï¼‰ ç¨‹åºå‘˜ã€‚</p><ol><li><p>è‰¯å¥½çš„å‘½åä¹ æƒ¯ï¼ä¼˜ç§€æ³¨é‡Šçš„ç¬¬ä¸€æ­¥å°±æ˜¯é¿å…ä½¿ç”¨å•å­—æ¯ã€æŠ½è±¡æˆ–æ¨¡ç³Šçš„åå­—ã€‚åå­—è¶Šç²¾ç¡®ï¼Œæ‰€éœ€çš„æ³¨é‡Šå°±è¶Šå°‘ã€‚</p></li><li><p>å¦‚æœæ–¹æ³•æœ‰å‰ææ¡ä»¶ï¼Œå¹¶ä¸”æ·»åŠ äº†ä¸€ä¸ªæ–­è¨€ï¼Œæ¥ä½¿å¾—ä¼ å…¥éæ³•å‚æ•°çš„æƒ…å†µå´©æºƒï¼ˆè‡³å°‘åœ¨è°ƒè¯•çš„æ—¶å€™ï¼ï¼‰ã€‚å¦‚æœåªæ¥å—æ­£æ•´æ•°ï¼Œåˆ™å†™ä¸€äº›ç±»ä¼¼è¿™æ ·çš„ä»£ç ï¼š<code>precondition(int &gt; 0)</code>ã€‚</p></li><li><p>ç¼–è¯‘æ—¶çš„æ–­è¨€æ¯”è¿è¡Œæ—¶çš„æ–­è¨€æ›´å¥½ã€‚å¦‚æœæ–¹æ³•ä»…æ¥å—éç©ºæ•°ç»„ï¼Œåˆ™å¯ä»¥æå‰ä½¿ç”¨åˆ¤æ–­ï¼š<code>precondition(!array.isEmpty)</code>ã€‚ä½†æ˜¯ä¹Ÿå¯ä»¥ä½¿ç”¨ä¸€ç§æ°¸è¿œä¸èƒ½è¡¨è¾¾ä¸ºç©ºæ•°ç»„çš„<a href="https://github.com/khanlou/NonEmptyArray" target="_blank" rel="noopener">ç±»å‹</a>ã€‚è°ƒç”¨ä½  API æ—¶æ°¸è¿œä¸å¯èƒ½ä¼ å…¥ç©ºçš„ç»„æ•°ä½œä¸ºå‚æ•°ã€‚<br>åŒæ ·ï¼Œå¦‚æœæ˜¯ bool ç±»å‹çš„å‚æ•°ï¼Œèƒ½ä¸èƒ½é€šè¿‡å‘½åä¸¤ä¸ªæšä¸¾é€‰é¡¹æ¥æ›´å¥½çš„è¡¨è¾¾ï¼Ÿ<a href="http://khanlou.com/2017/03/that-one-optional-property/" target="_blank" rel="noopener">ä½ çš„é€‰é¡¹æ˜¯å¦ä»¥æšä¸¾çš„æ–¹å¼æ›´å¥½çš„è¡¨è¾¾å‡ºæ¥ï¼Ÿ</a><a href="http://wiki.c2.com/?IntentionRevealingNames" target="_blank" rel="noopener">ä½¿ç”¨å‘½åæ¥è¡¨è¾¾æ„å›¾ã€‚</a></p></li><li><p>æ ‡è®°å‡ºé»‘ç§‘æŠ€ã€ä¸´æ—¶ä»£ç å’ŒåŸå‹ä»£ç ã€‚æˆ‘ç»å¸¸ä½¿ç”¨ç±»ä¼¼äº <code>hack_</code> çš„å‰ç¼€ä»£ç æ¥æ ‡è®°å‡ºæ­¤åŠŸèƒ½å®ç°åœ°å¹¶ä¸å®Œç¾ã€‚åœ¨ Swift çš„æ–¹æ³•å‘½åä¸­ä½¿ç”¨ä¸‹åˆ’çº¿æ˜¾å¾—ä¸ä¼¦ä¸ç±»ï¼Œæˆ‘èƒ½æ„Ÿè§‰åˆ°æˆ‘ä»£ç å˜å¾—æ›´ç³Ÿï¼Œäºæ˜¯æˆ‘ä¼šæƒ³è¦ä¿®å¤å®ƒã€‚æˆ‘ä»¬æœ€è¿‘å†™äº†ä¸€ä¸ªå‰ç¼€ä¸º <code>shouldReallyBeInTheCoordinator_</code> çš„å‡½æ•°ï¼Œè¿™æ˜¯å› ä¸ºéœ€è¦ä»£ç å®¡æŸ¥ï¼Œä½†æ˜¯ä»£ç å¹¶ä¸åœ¨æ­£ç¡®çš„ç±»ä¸­ã€‚å½“ç³Ÿç³•çš„ä»£ç å˜æˆä¸‘é™‹çš„ä»£ç ï¼Œä»£ç åº“çš„éœ€æ±‚å’Œä½ è‡ªå·±çš„æ„Ÿè§‰ä¼šç»Ÿä¸€èµ·æ¥ã€‚å…¶ä»–çš„å¥½å‰ç¼€æ¯”å¦‚ï¼š<code>perf_</code> å’Œ <code>temp_</code>ã€‚</p></li><li><p>ä½ å¯ä»¥åœ¨æ–¹æ³•åä¸­æ·»åŠ  ID æ¥è¿›è¡Œ bug çš„è¿½è¸ªï¼Œè¿™æ ·å®ƒä»¬å°±ä¼šåœ¨å †æ ˆä¸­å‡ºç°ã€‚UIKit æ¡†æ¶åœ¨å°‘æ•°æƒ…å†µä¸‹ä¹Ÿä½¿ç”¨äº†æ•°å­—ã€‚æ¯”å¦‚ä»¥ä¸‹ï¼š</p></li></ol><figure class="highlight objc"><table><tr><td class="code"><pre><span class="line">-[<span class="built_in">UIViewController</span> _hackFor11408026_beginAppearanceTransition:animated:]</span><br></pre></td></tr></table></figure><ol start="6"><li><p>ä¸è¦æ‹…å¿ƒåœ¨æ–¹æ³•åé‡Œæè¿°ä¸ºä½•å¦‚æ­¤å‘½åã€‚ä½ å¯ä»¥å°†æ–¹æ³•å‘½åä¸º <code>updateFrameOnNextTickBecauseAutoLayoutHasntCompletedYet(frame: CGRect)</code>ã€‚ç¼–è¯‘å™¨å¹¶ä¸å…³å¿ƒæ–¹æ³•å‘½åçš„é•¿çŸ­ï¼Œä»£ç è¯»çš„æ¬¡æ•°æ¯”å†™çš„æ¬¡æ•°å¤šå¾—å¤šã€‚æ³¨é‡Šåªæ˜¯æ–‡å­—ï¼Œæ–¹æ³•åä¹Ÿæ˜¯ã€‚å°†æ¥ç»´æŠ¤ä»£ç çš„äººè‚¯å®šä¼šèµåŒä½ è¯¦ç»†çš„å‘½åã€‚</p></li><li><p>è®¾ç½®ä¸€ä¸ªè¾…åŠ©å‡½æ•°ï¼Œä¾‹å¦‚ <code>TODO(date: Date, message: String)</code> ï¼Œå¦‚æœ TODO å°†æ¥ä¸€ç›´æ²¡æœ‰è¢«ä¿®æ”¹ï¼Œåˆ™ä¼šæ‰“å°é”™è¯¯æ—¥å¿—ï¼ˆç”šè‡³æ›´è¿›ä¸€æ­¥ï¼Œåœ¨è°ƒè¯•ä¸­å´©æºƒï¼‰ã€‚å¯ä»¥å‚è€ƒ Jordan Rose çš„å¦ä¸€ä¸ª<a href="https://twitter.com/UINT_MIN/status/836316697388695552" target="_blank" rel="noopener">ä¾‹å­</a>ã€‚</p></li><li><p>å°†æ‰€æœ‰çš„ç®—æ³•éœ€æ±‚ç¼–ç åˆ°æµ‹è¯•ä¸­ã€‚å¦‚æœä»¥ä¸Šå‡ æ¡éƒ½æ— æ³•ä½¿ç”¨ï¼Œå¹¶ä¸”æ— æ³•ä¾èµ–å‰ææ¡ä»¶ã€ç±»å‹æˆ–æ–¹æ³•åæ¥è§£å†³æŸä¸ªé—®é¢˜ï¼Œé‚£å°±å†™ä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹ã€‚è¿™å¯¹è¾¹ç•Œæƒ…å†µç‰¹åˆ«é€‚ç”¨ã€‚å¦‚æœæœ‰äººé‡å†™è¿™éƒ¨åˆ†ä»£ç ï¼Œæµ‹è¯•å°†ä¼šå¤±è´¥ï¼Œä»–ä¾¿ä¼šçŸ¥é“éœ€è¦åœ¨æ–°ä»£ç ä¹Ÿè¦å¤„ç†æ­¤ç§æƒ…å†µã€‚</p></li></ol><p>åˆ‡è®°ï¼šè¿™å¹¶ä¸æ˜¯å†™å¤æ‚ä»£ç å¹¶ä¸”ä¸åŠ æ³¨é‡Šçš„å€Ÿå£ã€‚å¦‚æœè¦è·³è¿‡æ³¨é‡Šï¼Œé‚£ä¹ˆä»£ç å¿…é¡»æ¸…æ™°ã€‚å¯¹æˆ‘è€Œè¨€ï¼Œæ³¨é‡Šæ˜¯æœ€åçš„æ‰‹æ®µã€‚å¦‚æœæˆ‘èƒ½æ‰¾åˆ°ä»»ä½•å…¶ä»–çš„æ–¹å¼æ¥å°†æˆ‘çš„æ„å›¾ä¼ è¾¾ç»™ä¸‹ä¸€ä¸ªç¨‹åºå‘˜ï¼Œæˆ‘éƒ½ä¸ä¼šæ·»åŠ æ³¨é‡Šã€‚</p><h3 id="è¿›ä¸€æ­¥é˜…è¯»"><a href="#è¿›ä¸€æ­¥é˜…è¯»" class="headerlink" title="è¿›ä¸€æ­¥é˜…è¯»"></a>è¿›ä¸€æ­¥é˜…è¯»</h3><ul><li><a href="http://ericasadun.com/2016/11/03/swift-holy-war-comments-are-not-an-anti-pattern/" target="_blank" rel="noopener">Erica Sadun çš„å…³äºä¸ºä½•æ³¨é‡Šæ˜¯æœ‰ç›Šçš„</a>ã€‚</li></ul><blockquote><p>æœ¬æ–‡ç”± SwiftGG ç¿»è¯‘ç»„ç¿»è¯‘ï¼Œå·²ç»è·å¾—ä½œè€…ç¿»è¯‘æˆæƒï¼Œæœ€æ–°æ–‡ç« è¯·è®¿é—® <a href="http://swift.gg">http://swift.gg</a>ã€‚</p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;ä½œè€…ï¼šSoroush Khanlouï¼Œ&lt;a href=&quot;http://khanlou.com/2017/03/on-comments/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;åŸæ–‡é“¾æ¥&lt;/a&gt;ï¼ŒåŸæ–‡æ—¥æœŸï¼š2017-03-22&lt;br&gt;è¯‘è€…ï¼š&lt;a href=&quot;undefined&quot;&gt;TonyHan&lt;/a&gt;ï¼›æ ¡å¯¹ï¼š&lt;a href=&quot;https://weibo.com/1743643682/profile?topnav=1&amp;amp;wvr=6&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;liberalism&lt;/a&gt;ï¼Œ&lt;a href=&quot;undefined&quot;&gt;Firecrest&lt;/a&gt;ï¼›å®šç¨¿ï¼š&lt;a href=&quot;https://github.com/chenmingbiao&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;CMB&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;!--æ­¤å¤„å¼€å§‹æ­£æ–‡--&gt;
&lt;p&gt;å†™ä»£ç çš„è¿‡ç¨‹ä¸­ï¼Œå¤æ‚æ€§æ˜¯æœ€å¤§çš„æ•Œäººã€‚å¯¹äºå¤§å‹çš„è½¯ä»¶é¡¹ç›®æ¥è¯´ï¼Œç»´æŠ¤å¤šå±‚æŠ½è±¡å¹¶ä¸”è®©åœ¨ä»£ç åº“ä¸­å·¥ä½œçš„å¼€å‘è€…æ­£ç¡®çš„ç†è§£è¿™äº›æ¦‚å¿µæ˜¯å¾ˆé‡è¦çš„ã€‚&lt;/p&gt;
&lt;p&gt;æ³¨é‡Šå¯ä»¥å¯¹ç®¡ç†ä»£ç å¤æ‚æ€§èµ·åˆ°ä¸€å®šä½œç”¨ï¼Œä½†ä¹Ÿä¼šå¯¹ä»£ç äº§ç”Ÿä¸è‰¯å½±å“ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘å¯¹æ³¨é‡Šçš„çœ‹æ³•æ¥è‡ªäºä¸¤ä¸ªäº‹å®ï¼š1ï¼‰æ³¨é‡Šå¹¶ä¸å¤æ‚ã€‚2ï¼‰æ³¨é‡Šé€šå¸¸åœ¨è¯­æ³•é«˜äº®ä¸­ä½¿ç”¨æŸ”å’Œçš„è‰²å½©ã€‚å› ä¸ºå®ƒä»¬ä¸å‚ä¸ç¼–è¯‘ï¼Œå¹¶ä¸”å› ä¸ºå®ƒä»¬å¹¶ä¸é†’ç›®ï¼Œæ‰€ä»¥åœ¨æ›´æ”¹ä»£ç æ—¶ï¼Œå¾ˆå®¹æ˜“å¿½ç•¥å®ƒä»¬ã€‚å¦‚æœæ›´æ”¹äº†ä»£ç ä½†ä¸æ›´æ–°æ³¨é‡Šï¼Œä¾¿å¾—åˆ°äº†ä¸€ä»½æ— æ³•å‡†ç¡®æè¿°ä»£ç åŠŸèƒ½çš„æ³¨é‡Šã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="KHANLOU" scheme="https://swift.gg/categories/KHANLOU/"/>
    
    
      <category term="iOS å¼€å‘" scheme="https://swift.gg/tags/iOS-%E5%BC%80%E5%8F%91/"/>
    
  </entry>
  
  <entry>
    <title>ä½¿ç”¨ç±»å‹æ¥è®©ä½ è‡ªå·±æ›´å¯é </title>
    <link href="https://swift.gg/2018/07/03/using-types-to-keep-yourself-honest/"/>
    <id>https://swift.gg/2018/07/03/using-types-to-keep-yourself-honest/</id>
    <published>2018-07-03T00:00:00.000Z</published>
    <updated>2018-09-10T03:53:25.085Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ä½œè€…ï¼šMATTHIJS HOLLEMANSï¼Œ<a href="http://machinethink.net/blog/using-types-to-keep-yourself-honest/" target="_blank" rel="noopener">åŸæ–‡é“¾æ¥</a>ï¼ŒåŸæ–‡æ—¥æœŸï¼š2016-03-25<br>è¯‘è€…ï¼š<a href="undefined">TonyHan</a>ï¼›æ ¡å¯¹ï¼š<a href="http://blog.yousanflics.com.cn" target="_blank" rel="noopener">Yousanflics</a>ï¼›å®šç¨¿ï¼š<a href="https://github.com/chenmingbiao" target="_blank" rel="noopener">CMB</a></p></blockquote><!--æ­¤å¤„å¼€å§‹æ­£æ–‡--><p>è¿™ç¯‡æ–‡ç« å±•ç¤ºäº†å¦‚ä½•åˆ©ç”¨ Swift çš„ç±»å‹ç³»ç»Ÿæ¥ä½¿ä½ çš„ç¨‹åºæ›´å…·è¡¨ç°åŠ›å’Œå¥å£®æ€§ã€‚</p><p>åœ¨æœ€è¿‘ä¸€å‘¨å·¦å³çš„æ—¶é—´é‡Œï¼Œæˆ‘ä¸€ç›´åœ¨å€’è…¾ Swift çš„æœºå™¨å­¦ä¹ ç®—æ³•ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ä½¿ç”¨çŸ©é˜µæ¥ç®€æ´æœ‰æ•ˆåœ°å®ç°è¿™äº›ç®—æ³•ã€‚</p><p>å¦‚æœä½ å¿˜è®°äº†çº¿æ€§ä»£æ•°ï¼Œé‚£åªéœ€å°†çŸ©é˜µçœ‹ä½œæ•°å­—è¡¨æ ¼ã€‚</p><p>å½“æåˆ° â€œM æ˜¯ä¸€ä¸ª 4 ä¹˜ 3 çš„çŸ©é˜µâ€ï¼Œæ„æ€æ˜¯æŒ‡ M æ˜¯ä¸€ä¸ª 4 è¡Œ 3 åˆ—çš„æ•°å­—è¡¨æ ¼ã€‚å…³äºçŸ©é˜µä½ å°±éœ€è¦äº†è§£è¿™äº›ï¼ˆè¯‘è€…æ³¨:å³å¯å°†å…¶çœ‹ä½œæ˜¯è¡¨æ ¼ï¼‰ï¼Œå°±å¯ä»¥ç†è§£æœ¬æ–‡åé¢çš„è®²è§£ã€‚</p><a id="more"></a><p>ä¸‹é¢æ˜¯ä¸€ä¸ª 4Ã—3 çŸ©é˜µçš„ä¾‹å­ï¼š</p><p><img src="/img/articles/using-types-to-keep-yourself-honest/Matrix.png1530582060.2468634" alt="Matrix"></p><p>ä¸‹é¢å†™ä»£ç åˆ›å»ºä¸€ä¸ª <code>çŸ©é˜µç»“æ„ä½“</code>ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Matrix</span> </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> rows: <span class="type">Int</span></span><br><span class="line">  <span class="keyword">let</span> columns: <span class="type">Int</span></span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»å¸¸éœ€è¦å¯¹çŸ©é˜µçš„æ“ä½œæ˜¯å°†å®ƒä»¬ç›¸ä¹˜ï¼Œå› æ­¤æˆ‘åˆ›å»ºäº†ä¸€ä¸ªå‡½æ•°ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">multiply</span><span class="params">(m1: Matrix, <span class="number">_</span> m2: Matrix)</span></span> -&gt; <span class="type">Matrix</span> &#123;</span><br><span class="line">  <span class="comment">// bunch of math...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸€åˆ‡å¯èƒ½çœ‹èµ·æ¥å¾ˆç®€å•ï¼Œä½†æ˜¯è¿˜æœ‰äº›è®©æˆ‘å¾ˆçƒ¦çš„ä¸œè¥¿ã€‚</p><p>å³ä¾¿ m1 å’Œ m2 éƒ½æ˜¯ Matrix å¯¹è±¡ï¼Œä½†æ˜¯å®é™…ä¸Šå®ƒä»¬å¯èƒ½å…·æœ‰ä¸åŒæ•°é‡çš„è¡Œå’Œåˆ—ã€‚è¿™å¯èƒ½æ˜¯ä¸€ä¸ªé—®é¢˜ã€‚</p><p>ä¾‹å¦‚ï¼Œä½¿ç”¨çŸ©é˜µä¹˜æ³•ï¼Œä¸¤ä¸ªçŸ©é˜µçš„å¤§å°å¿…é¡»ä»¥ç‰¹å®šæ–¹å¼åŒ¹é…ã€‚</p><p><img src="/img/articles/using-types-to-keep-yourself-honest/MatrixMultiplication.png1530582060.3889682" alt="MatrixMultiplication"></p><p>ç¬¬ä¸€ä¸ªçŸ©é˜µä¸­çš„åˆ—æ•°å¿…é¡»ä¸ç¬¬äºŒä¸ªçŸ©é˜µä¸­çš„è¡Œæ•°ç›¸åŒã€‚å¦‚æœç¬¬ä¸€ä¸ªçŸ©é˜µçš„å¤§å°ä¸º <code>U Ã— V</code>ï¼Œåˆ™ç¬¬äºŒä¸ªçŸ©é˜µçš„å¤§å°å¿…é¡»ä¸º <code>V Ã— W</code>ã€‚è¿™å°±æ˜¯æ•°å­¦ä¸Šè§„å®šçš„ã€‚</p><p>ç»“æœæ˜¯å¤§å°ä¸º <code>U Ã— W</code> çš„æ–°çŸ©é˜µã€‚å¦‚æœçŸ©é˜µçš„å¤§å°ä¸åŒ¹é…è¿™ç§ç‰¹å®šçš„æ–¹å¼ï¼Œæˆ‘ä»¬å°±ä¸èƒ½å°†å®ƒä»¬ç›¸ä¹˜ã€‚</p><p>ä¾‹å¦‚ï¼Œä»¥ä¸‹å°†å·¥ä½œæ­£å¸¸ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="type">A</span> = <span class="type">Matrix</span>(rows: <span class="number">4</span>, columns: <span class="number">3</span>)</span><br><span class="line"><span class="keyword">let</span> <span class="type">B</span> = <span class="type">Matrix</span>(rows: <span class="number">3</span>, columns: <span class="number">2</span>)</span><br><span class="line"><span class="keyword">let</span> <span class="type">C</span> = multiply(<span class="type">A</span>, <span class="type">B</span>)                <span class="comment">// gives a 4Ã—2 matrix</span></span><br></pre></td></tr></table></figure><blockquote><p>æ³¨æ„ï¼šåœ¨æ•°å­¦ä¸­ï¼ŒçŸ©é˜µé€šå¸¸ç”¨å¤§å†™è¡¨ç¤ºï¼Œæˆ‘åœ¨è¿™é‡Œéµå¾ªå˜é‡åç§°çš„æƒ¯ä¾‹ã€‚</p></blockquote><p>ç”±äº <code>A.columns == B.rows</code>ï¼Œå› æ­¤å¯ä»¥å°† <code>A</code> ä¸ <code>B</code> è¿›è¡Œä¹˜æ³•ã€‚ç›¸ååœ°ï¼Œä»¥ä¸‹å°±ä¸æ˜¯æœ‰æ•ˆçš„æ“ä½œï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="type">D</span> = multiply(<span class="type">B</span>, <span class="type">A</span>)</span><br></pre></td></tr></table></figure><p>çŸ©é˜µ <code>B</code> ä¸­çš„åˆ—æ•°ä¸çŸ©é˜µ <code>A</code> ä¸­çš„è¡Œæ•°ä¸åŒ¹é…ã€‚ä¹Ÿå°±æ˜¯ <code>B.columnsï¼= A.rows</code>ã€‚ä»æ•°å­¦å®šä¹‰æ¥è¯´ï¼ŒçŸ©é˜µBå’ŒAç›¸ä¹˜æ²¡æœ‰ä»»ä½•æ„ä¹‰ã€‚</p><p>ç›®å‰ï¼Œæ•æ‰è¿™äº›é”™è¯¯çš„å”¯ä¸€æ–¹æ³•æ˜¯åœ¨è¿è¡Œæ—¶è§¦å‘æ–­è¨€ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">multiply</span><span class="params">(m1: Matrix, <span class="number">_</span> m2: Matrix)</span></span> -&gt; <span class="type">Matrix</span> &#123;</span><br><span class="line">  <span class="comment">// do the matrices have the correct sizes?</span></span><br><span class="line">  <span class="built_in">precondition</span>(m1.columns == m2.rows)</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// bunch of math...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·åšå½“ç„¶å¯ä»¥ï¼Œä½†æˆ‘å¹¶ä¸å–œæ¬¢ã€‚Swift é™æ€ç±»å‹çš„é‡ç‚¹åœ¨äºç¼–è¯‘å™¨å¯ä»¥åœ¨ç¼–è¯‘æœŸé—´å‘ç°å°½å¯èƒ½å¤šçš„ç¼–ç¨‹é”™è¯¯ã€‚å¦‚æœæˆ‘ä»¬å¯ä»¥ä½¿ç¼–è¯‘å™¨ä¹Ÿæ•è·è¿™ç§é”™è¯¯ï¼Œè¿™å°±ä¼šå¾ˆæ£’ã€‚</p><p>äº‹å®è¯æ˜æ˜¯å¯ä»¥çš„ï¼åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘å°†æ¢è®¨å¦‚ä½•ä½¿ç”¨ Swift çš„ç±»å‹ç³»ç»Ÿæ¥é¿å…è¿™æ ·çš„é”™è¯¯ã€‚</p><h2 id="ä¸å¤ªå¥½çš„å®ç°"><a href="#ä¸å¤ªå¥½çš„å®ç°" class="headerlink" title="ä¸å¤ªå¥½çš„å®ç°"></a>ä¸å¤ªå¥½çš„å®ç°</h2><p>è§£å†³è¿™ä¸ªé—®é¢˜çš„æ¯”è¾ƒåŸå§‹çš„æ–¹æ³•æ˜¯ä¸ºä¸åŒå¤§å°çš„çŸ©é˜µåˆ›å»ºä¸åŒçš„ç»“æ„ä½“ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="type">A</span> = <span class="type">Matrix_4x3</span>()</span><br><span class="line"><span class="keyword">let</span> <span class="type">B</span> = <span class="type">Matrix_3x2</span>()</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯ï¼Œè¿˜éœ€è¦ä¸€ä¸ªå°†è¿™äº›ç‰¹å®šç±»å‹ä½œä¸ºå‚æ•°çš„ <code>multiply()</code> æ–¹æ³•ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">multiply</span><span class="params">(m1: Matrix_4x3, <span class="number">_</span> m2: Matrix_3x2)</span></span> -&gt; <span class="type">Matrix_4x2</span></span><br></pre></td></tr></table></figure><p>è¿™ä¼¼ä¹æœ‰ç‚¹å‚»ï¼Œå¯¼è‡´äº†å¾ˆå¤šé‡å¤çš„ä»£ç ã€‚</p><p>æ›´ç³Ÿç³•çš„æ˜¯ï¼Œç¼–è¯‘æ—¶å¯èƒ½å¹¶ä¸çŸ¥é“çŸ©é˜µçš„å¤§å°ã€‚åœ¨æœºå™¨å­¦ä¹ é—®é¢˜ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸éœ€è¦ä»æ–‡ä»¶ä¸­åŠ è½½æ•°æ®é›†ï¼Œä½†å¹¶ä¸ä¼šæå‰çŸ¥é“æœ‰å¤šå°‘è¡Œã€‚</p><p>æ‰€ä»¥è¿™ä¸æ˜¯ä¸€ä¸ªå¯è¡Œçš„è§£å†³æ–¹æ¡ˆã€‚ç„¶è€Œï¼Œä¸ºä¸åŒå¤§å°çš„çŸ©é˜µå£°æ˜ä¸åŒç±»å‹çš„æ€è·¯è¿˜æ˜¯æœ‰å¸Œæœ›çš„â€¦</p><h2 id="é€šç”¨çš„è§£å†³æ–¹æ¡ˆ"><a href="#é€šç”¨çš„è§£å†³æ–¹æ¡ˆ" class="headerlink" title="é€šç”¨çš„è§£å†³æ–¹æ¡ˆ"></a>é€šç”¨çš„è§£å†³æ–¹æ¡ˆ</h2><p>æˆ‘ä»¬å¸Œæœ›å°†çŸ©é˜µçš„ç»´åº¦ä»¥æŸç§æ–¹å¼å¹¶å…¥ Matrix çš„ç±»å‹ï¼Œè€Œä¸éœ€è¦ä»»ä½•çŸ©é˜µä»£ç ï¼Œå¦‚ <code>multiply()</code> çŸ¥é“å…¶å…·ä½“å¤§å°ã€‚</p><p>å®šä¹‰ä»¥ä¸‹ Matrixï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Matrix</span>&lt;<span class="title">R</span>,<span class="title">C</span>&gt; </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> rows: <span class="type">Int</span></span><br><span class="line">  <span class="keyword">let</span> columns: <span class="type">Int</span></span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®ƒç°åœ¨æœ‰ä¸¤ä¸ªé€šç”¨å‚æ•° <code>R</code> å’Œ <code>C</code>ï¼Œå…¶ä¸­ <code>R</code> è¡¨ç¤ºè¡Œæ•°ï¼Œ<code>C</code> è¡¨ç¤ºåˆ—æ•°ã€‚</p><p>æˆ‘ä»¬å¯ä»¥è¿™æ ·å®šä¹‰ <code>multiply()</code>ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">multiply</span>&lt;U,V,W&gt;<span class="params">(m1: Matrix&lt;U,V&gt;, <span class="number">_</span> m2: Matrix&lt;V,W&gt;)</span></span> -&gt; <span class="type">Matrix</span>&lt;<span class="type">U</span>,<span class="type">W</span>&gt; &#123;</span><br><span class="line">  <span class="comment">// bunch of math...</span></span><br><span class="line">  <span class="keyword">return</span> <span class="type">Matrix</span>(rows: m1.rows, columns: m2.columns)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¯·æ³¨æ„è·å–çŸ©é˜µä¹˜æ³•è§„åˆ™çš„æ–¹æ³•ï¼šå¤§å°ä¸º <code>U Ã— V</code> çš„çŸ©é˜µä¹˜ä»¥å¤§å°ä¸º <code>V Ã— W</code> çš„çŸ©é˜µï¼Œå¾—åˆ° <code>U Ã— W</code> å¤§å°çš„æ–°çŸ©é˜µã€‚</p><p>ä¸‹é¢æ˜¯å¦‚ä½•ä½¿ç”¨æ–°çš„ <code>Matrix</code> çš„ä¾‹å­ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">NumExamples</span> </span>&#123;&#125;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">NumFeatures</span> </span>&#123;&#125;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">OneDimensional</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="type">A</span> = <span class="type">Matrix</span>&lt;<span class="type">NumExamples</span>, <span class="type">NumFeatures</span>&gt;(rows: <span class="number">20</span>, columns: <span class="number">10</span>)</span><br><span class="line"><span class="keyword">let</span> <span class="type">B</span> = <span class="type">Matrix</span>&lt;<span class="type">NumFeatures</span>, <span class="type">OneDimensional</span>&gt;(rows: <span class="number">10</span>, columns: <span class="number">1</span>)</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬åˆ›å»ºäº†ä¸‰ç§æ–°çš„ç±»å‹ - åä¸º <code>NumExamples</code> ï¼Œ<code>NumFeatures</code> å’Œ <code>OneDimensional</code> â€”â€” æ¥è¡¨ç¤ºçŸ©é˜µçš„å¯èƒ½ç»´æ•°ã€‚æ³¨æ„æˆ‘å¦‚ä½•ç»™å‡ºè¿™äº›ç±»å‹çš„æè¿°æ€§åç§°ï¼Œä»è€Œæ›´å®¹æ˜“å±•ç°å‡ºå®ƒä»¬çš„ç”¨é€”ã€‚</p><p><code>NumExamples</code> å’Œ <code>NumFeatures</code> çš„åç§°æ¥è‡ªæœºå™¨å­¦ä¹ ï¼Œå› ä¸ºæˆ‘å°†åœ¨å…¶ä¸­ä½¿ç”¨è¿™äº›çŸ©é˜µã€‚<code>NumExamples</code> æ˜¯æ•°æ®é›†ä¸­çš„å¯¹è±¡æ•°ç›®ï¼Œ<code>NumFeatures</code> æ˜¯æ¯ä¸ªç¤ºä¾‹çš„å±æ€§æ•°ã€‚(å½“ç„¶ï¼Œå¦‚æœä½ è¦ä½¿ç”¨è¿™äº›çŸ©é˜µæ¥åšåˆ«çš„äº‹æƒ…ï¼Œä½ å¯ä»¥ä½¿ç”¨ä¸åŒçš„åå­—ã€‚ï¼‰</p><p><code>OneDimensional</code> æ„æŒ‡çŸ©é˜µ <code>B</code> åªæœ‰ä¸€åˆ—ã€‚åœ¨çº¿æ€§ä»£æ•°ä¸­ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºåˆ—å‘é‡è€Œä¸æ˜¯çŸ©é˜µã€‚ä¸ºäº†ä½¿æˆ‘ä»¬çš„ä»£ç æ›´æ¸…æ™°ï¼Œå¦‚æœæˆ‘ä»¬å¯ä»¥è¿™æ ·å†™ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">typealias</span> <span class="type">ColumnVector</span>&lt;<span class="type">Rows</span>&gt; = <span class="type">Matrix</span>&lt;<span class="type">Rows</span>, <span class="type">OneDimensional</span>&gt;</span><br><span class="line"><span class="keyword">typealias</span> <span class="type">RowVector</span>&lt;<span class="type">Columns</span>&gt; = <span class="type">Matrix</span>&lt;<span class="type">OneDimensional</span>, <span class="type">Columns</span>&gt;</span><br></pre></td></tr></table></figure><p>ç±»å‹åˆ«åä¼šå°† <code>ColumnVector</code> å’Œ <code>RowVector</code> æ ‡è®°æˆ <code>Matrix</code> çš„ç‰¹æ®Šæƒ…å†µã€‚ä½†ä¸å¹¸çš„æ˜¯ï¼ŒSwift 2.2 ä¸­ä¸æ”¯æŒè¿™ç§è¯­æ³•ã€‚å³å°†å‘å¸ƒ(<strong>åŸæ–‡æ—¥æœŸ=2016/03/25</strong>)çš„ <a href="https://github.com/apple/swift-evolution/blob/master/proposals/0048-generic-typealias.md" target="_blank" rel="noopener">Swift 3.0</a> ä¸­å¯èƒ½ä¼šæ”¯æŒã€‚</p><p>ä¸ç®¡æ€æ ·è®©æˆ‘ä»¬å›åˆ°æœ¬ä¾‹ä¸­ã€‚å½“ä½ å†™ä¸‹ä»£ç ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="type">C</span> = multiply(<span class="type">A</span>, <span class="type">B</span>)</span><br></pre></td></tr></table></figure><p>å®ƒä¾¿ä¼šæŒ‰ç…§é¢„æœŸç»™å‡ºäº†ä¸€ä¸ªæ–°çš„ 20Ã—1çŸ©é˜µã€‚ç„¶è€Œï¼Œä¸ä¹‹å‰ä¸åŒçš„æ˜¯ï¼Œæ— æ•ˆçš„ä¹˜æ³•å°è¯•ä¼šå¯¼è‡´ç¼–è¯‘å™¨é”™è¯¯ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="type">D</span> = multiply(<span class="type">B</span>, <span class="type">A</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// error: cannot convert value of type 'Matrix&lt;NumFeatures, OneDimensional&gt;'</span></span><br><span class="line"><span class="comment">// to expected argument type 'Matrix&lt;_, _&gt;'</span></span><br></pre></td></tr></table></figure><p>é”™è¯¯æ¶ˆæ¯æœ‰ç‚¹æ¨¡ç³Šï¼Œä½†æ˜¯ä½¿ç”¨ Swift çš„ç±»å‹ç³»ç»Ÿæ¥æ•è·è¿™ç§é”™è¯¯æ˜¯æå¥½çš„ã€‚è€Œä¸æ˜¯åœ¨è¿è¡Œæ—¶å´©æºƒåº”ç”¨ç¨‹åºï¼Œç°åœ¨ä¸å¯èƒ½å°†ä¸¤ä¸ªä¸å…·æœ‰æ­£ç¡®ç»´åº¦çš„çŸ©é˜µç›¸ä¹˜ã€‚ç°åœ¨å·²ç»å®ç°ç¦æ­¢å°†ä¸¤ä¸ªä¸å…·æœ‰æ­£ç¡®ç»´åº¦çš„çŸ©é˜µç›¸ä¹˜ï¼Œé¿å…äº†åœ¨è¿è¡Œæ—¶å´©æºƒã€‚</p><p>æœçœŸå¦‚æ­¤ä¹ˆï¼Ÿæˆ‘ä»¬ä»ç„¶å¯ä»¥éª—è¿‡ç¼–è¯‘å™¨ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="type">A</span> = <span class="type">Matrix</span>&lt;<span class="type">NumExamples</span>, <span class="type">NumFeatures</span>&gt;(rows: <span class="number">20</span>, columns: <span class="number">10</span>)</span><br><span class="line"><span class="keyword">let</span> <span class="type">B</span> = <span class="type">Matrix</span>&lt;<span class="type">NumFeatures</span>, <span class="type">OneDimensional</span>&gt;(rows: <span class="number">500</span>, columns: <span class="number">1</span>)</span><br></pre></td></tr></table></figure><p>é€šè¿‡å°† <code>B</code> çš„è¡Œæ•°æ”¹ä¸º 500ï¼Œæˆ‘ä»¬ä»ç„¶å¤„äºä¸ä¹‹å‰ç›¸åŒçš„æƒ…å†µã€‚ç°åœ¨ <code>multiply(A, B)</code> ä¸å†æœ‰æ•ˆã€‚</p><p>åªæœ‰è¿™äº›é¢å¤–çš„ç±»å‹æ˜¯ä¸å¤Ÿçš„â€¦æˆ‘ä»¬éœ€è¦ç¡®ä¿ç±»å‹ <code>NumFeatures</code> æ— è®ºå®ƒåœ¨å“ªé‡Œä½¿ç”¨ï¼Œæ€»ä¼šä»¥æŸç§æ–¹å¼å¼•ç”¨ç›¸åŒçš„æ•°å­—ã€‚</p><h2 id="ä½¿ç”¨åè®®å¼¥è¡¥"><a href="#ä½¿ç”¨åè®®å¼¥è¡¥" class="headerlink" title="ä½¿ç”¨åè®®å¼¥è¡¥"></a>ä½¿ç”¨åè®®å¼¥è¡¥</h2><p>æˆ‘ä»¬å¯ä»¥åƒè¿™æ ·åšï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">NumExamples</span> </span>&#123; <span class="keyword">let</span> size = <span class="number">20</span> &#125;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">NumFeatures</span> </span>&#123; <span class="keyword">let</span> size = <span class="number">10</span> &#125;</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯è¿è¡Œæ—¶è¿™äº›ç»´åº¦çš„å¤§å°ä¾¿è¢«å›ºå®šäº†ã€‚è¯·è®°ä½ï¼Œæˆ‘ä»¬å¸Œæœ›èƒ½å¤Ÿåœ¨è¿è¡Œæ—¶è®¾ç½®çŸ©é˜µå¤§å°ï¼Œä¾‹å¦‚é€šè¿‡ä»æ–‡ä»¶è¯»å–æ•°æ®é›†â€”â€”è€Œä¸”æˆ‘ä»¬å¯èƒ½ä¸çŸ¥é“è¯¥æ–‡ä»¶ä¸­æœ‰å¤šå°‘æ•°æ®ã€‚å¯¹çŸ©é˜µå¤§å°è¿›è¡Œç¡¬ç¼–ç ä¸æ˜¯ä¸€ç§å¥½åŠæ³•ã€‚</p><p>ç›¸åï¼Œè®©æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªæ–°åè®®ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">Dimension</span> </span>&#123;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">var</span> size: <span class="type">Int</span> &#123; <span class="keyword">get</span> <span class="keyword">set</span> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>äºæ˜¯ <code>Matrix</code> å˜æˆäº†ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Matrix</span>&lt;<span class="title">R</span>: <span class="title">Dimension</span>, <span class="title">C</span>: <span class="title">Dimension</span>&gt; </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> rows: <span class="type">Int</span></span><br><span class="line">  <span class="keyword">let</span> columns: <span class="type">Int</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">init</span>() &#123;</span><br><span class="line">    <span class="keyword">self</span>.rows = <span class="type">R</span>.size</span><br><span class="line">    <span class="keyword">self</span>.columns = <span class="type">C</span>.size</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼Œ<code>init(rows:columns:)</code> æ–¹æ³•å·²ç»è¢«å»æ‰ã€‚çŸ©é˜µçš„å¤§å°ç›´æ¥ç”±æ³›å‹ <code>R</code> å’Œ <code>C</code> å†³å®šã€‚</p><p>æœ€åä¸€æ­¥æ˜¯ä½¿æˆ‘ä»¬çš„ç»´åº¦ç±»å‹ç¬¦åˆæ–°åè®®ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">NumExamples</span>: <span class="title">Dimension</span> </span>&#123; <span class="keyword">static</span> <span class="keyword">var</span> size = <span class="number">20</span> &#125;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">NumFeatures</span>: <span class="title">Dimension</span> </span>&#123; <span class="keyword">static</span> <span class="keyword">var</span> size = <span class="number">10</span> &#125;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">OneDimensional</span>: <span class="title">Dimension</span> </span>&#123; <span class="keyword">static</span> <span class="keyword">var</span> size = <span class="number">1</span> &#125;</span><br></pre></td></tr></table></figure><p>ç„¶åå¯ä»¥å¦‚ä¸‹å®ç° <code>multiply()</code>ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">multiply</span>&lt;U: Dimension, V: Dimension, W: Dimension&gt;</span></span><br><span class="line"><span class="function">             <span class="params">(m1: Matrix&lt;U,V&gt;, <span class="number">_</span> m2: Matrix&lt;V,W&gt;)</span></span> -&gt; <span class="type">Matrix</span>&lt;<span class="type">U</span>,<span class="type">W</span>&gt; &#123;</span><br><span class="line">  <span class="comment">// bunch of math...</span></span><br><span class="line">  <span class="keyword">return</span> <span class="type">Matrix</span>&lt;<span class="type">U</span>,<span class="type">W</span>&gt;()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç°åœ¨ï¼ŒçŸ©é˜µ m1 å’Œ m2 ä¸å¯èƒ½ä¸åŒ¹é…ã€‚ç¼–è¯‘å™¨æ ¹æœ¬ä¸ä¼šæ¥å—è¿™ç§æƒ…å†µã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="type">A</span> = <span class="type">Matrix</span>&lt;<span class="type">NumExamples</span>, <span class="type">NumFeatures</span>&gt;()</span><br><span class="line"><span class="keyword">let</span> <span class="type">B</span> = <span class="type">Matrix</span>&lt;<span class="type">NumFeatures</span>, <span class="type">OneDimensional</span>&gt;()</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="type">C</span> = multiply(<span class="type">A</span>, <span class="type">B</span>)   <span class="comment">// yay!</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="type">D</span> = multiply(<span class="type">B</span>, <span class="type">A</span>)   <span class="comment">// compiler error</span></span><br></pre></td></tr></table></figure><p>è¿™æ ·å°±ä¸ä¼šå‡ºç°æ— æ„çš„é”™è¯¯ã€‚å½“ç„¶ï¼Œä½ ä»ç„¶å¯ä»¥é€šè¿‡è¿™æ ·åšæ¥æ¬ºéª—ç³»ç»Ÿï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="type">A</span> = <span class="type">Matrix</span>&lt;<span class="type">NumExamples</span>, <span class="type">NumFeatures</span>&gt;()</span><br><span class="line"><span class="type">NumFeatures</span>.size = <span class="number">500</span></span><br><span class="line"><span class="keyword">let</span> <span class="type">B</span> = <span class="type">Matrix</span>&lt;<span class="type">NumFeatures</span>, <span class="type">OneDimensional</span>&gt;()</span><br></pre></td></tr></table></figure><p>å³ä¾¿ Swift çš„ç±»å‹ç³»ç»Ÿä¹Ÿæ— æ³•é˜»æ­¢å‡ºäºæ¶æ„çš„è¡Œä¸ºã€‚ï¼ˆä¹Ÿè®¸åœ¨ <code>multiply()</code> ä¸­ä¿ç•™ <code>precondition()</code> æ˜¯æ˜æ™ºçš„ã€‚ï¼‰</p><p>é¡ºä¾¿è¯´ä¸€å¥ï¼Œä½ å®é™…ä¸Šéœ€è¦æœ‰æ”¹å˜ <code>NumFeatures.size</code> çš„èƒ½åŠ›ã€‚ä½†ä½ ä½¿ç”¨æ—¶åº”è¯¥å¤šåŠ å°å¿ƒã€‚æ­£å¦‚ç›´åˆ°æˆ‘ä»¬è¿è¡Œè¯¥ç¨‹åºæ‰èƒ½çŸ¥é“å®ƒç‰¹å®šå¤§å°ï¼Œå®ƒä¹Ÿæ²¡æœ‰ç†ç”±ä¼šä¸€ç›´ä¿æŒä¸å˜ã€‚ä¾‹å¦‚ï¼Œä½ å¯èƒ½éœ€è¦ä½¿ç”¨ç›¸åŒçš„æµç¨‹æ¥å¤„ç†ä¸åŒå¤§å°çš„å¤šä¸ªæ•°æ®é›†ã€‚</p><p>å½“ç„¶ï¼Œä½ å¯ä»¥ä½¿ç”¨çŸ©é˜µæ¥åšæ›´å¤šäº‹æƒ…ï¼Œè€Œä¸ä»…ä»…æ˜¯ä¹˜ä»¥å®ƒä»¬ã€‚ä»¥ä¸‹æ˜¯è¿™äº›ç»´åº¦ç±»å‹ç”¨å¤„çš„å¦ä¸€ä¸ªç¤ºä¾‹ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">processData</span>&lt;M: Dimension, N: Dimension&gt;</span></span><br><span class="line"><span class="function">                <span class="params">(X: Matrix&lt;M, N&gt;, <span class="number">_</span> y: Matrix&lt;M, OneDimensional&gt;)</span></span> </span><br><span class="line">                -&gt; <span class="type">Matrix</span>&lt;<span class="type">OneDimensional</span>, <span class="type">N</span>&gt; &#123;</span><br><span class="line">  <span class="comment">// do impressive stuff...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="type">X</span> = <span class="type">Matrix</span>&lt;<span class="type">NumExamples</span>, <span class="type">NumFeatures</span>&gt;()</span><br><span class="line"><span class="keyword">let</span> y = <span class="type">Matrix</span>&lt;<span class="type">NumExamples</span>, <span class="type">OneDimensional</span>&gt;()</span><br><span class="line">processData(<span class="type">X</span>, y)</span><br></pre></td></tr></table></figure><p>è¯¥å‡½æ•°é‡‡ç”¨çŸ©é˜µ <code>X</code> å’Œåˆ—å‘é‡ <code>y</code> ï¼Œå¹¶å¯¹å®ƒä»¬è¿›è¡Œä¸€äº›å¤„ç†ã€‚ä¾‹å¦‚ï¼Œå¯èƒ½ä¼šè®­ç»ƒå­¦ä¹ ç³»ç»Ÿã€‚è¿™é‡Œçš„çº¦æŸæ˜¯ <code>X</code> å’Œ <code>y</code> å¿…é¡»å…·æœ‰ç›¸åŒçš„è¡Œæ•°ã€‚å¤šäºäº†æˆ‘ä»¬çš„ç»´åº¦ç±»å‹ï¼Œç¼–è¯‘å™¨å¯ä»¥å¼ºåˆ¶æ‰§è¡Œè¯¥çº¦æŸã€‚</p><h2 id="ç»“è®º"><a href="#ç»“è®º" class="headerlink" title="ç»“è®º"></a>ç»“è®º</h2><p>æˆ‘ä»¬ä½¿ç”¨ç±»å‹æ¥æ›´å¥½åœ°å‘Šè¯‰ç¼–è¯‘å™¨æˆ‘ä»¬çš„ç¨‹åºæ­£åœ¨åšä»€ä¹ˆã€‚è¿™æœ‰åŠ©äºç¼–è¯‘å™¨æ•è·é”™è¯¯ã€‚</p><blockquote><p>æœ¬æ–‡ç”± SwiftGG ç¿»è¯‘ç»„ç¿»è¯‘ï¼Œå·²ç»è·å¾—ä½œè€…ç¿»è¯‘æˆæƒï¼Œæœ€æ–°æ–‡ç« è¯·è®¿é—® <a href="http://swift.gg">http://swift.gg</a>ã€‚</p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;ä½œè€…ï¼šMATTHIJS HOLLEMANSï¼Œ&lt;a href=&quot;http://machinethink.net/blog/using-types-to-keep-yourself-honest/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;åŸæ–‡é“¾æ¥&lt;/a&gt;ï¼ŒåŸæ–‡æ—¥æœŸï¼š2016-03-25&lt;br&gt;è¯‘è€…ï¼š&lt;a href=&quot;undefined&quot;&gt;TonyHan&lt;/a&gt;ï¼›æ ¡å¯¹ï¼š&lt;a href=&quot;http://blog.yousanflics.com.cn&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Yousanflics&lt;/a&gt;ï¼›å®šç¨¿ï¼š&lt;a href=&quot;https://github.com/chenmingbiao&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;CMB&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;!--æ­¤å¤„å¼€å§‹æ­£æ–‡--&gt;
&lt;p&gt;è¿™ç¯‡æ–‡ç« å±•ç¤ºäº†å¦‚ä½•åˆ©ç”¨ Swift çš„ç±»å‹ç³»ç»Ÿæ¥ä½¿ä½ çš„ç¨‹åºæ›´å…·è¡¨ç°åŠ›å’Œå¥å£®æ€§ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨æœ€è¿‘ä¸€å‘¨å·¦å³çš„æ—¶é—´é‡Œï¼Œæˆ‘ä¸€ç›´åœ¨å€’è…¾ Swift çš„æœºå™¨å­¦ä¹ ç®—æ³•ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ä½¿ç”¨çŸ©é˜µæ¥ç®€æ´æœ‰æ•ˆåœ°å®ç°è¿™äº›ç®—æ³•ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœä½ å¿˜è®°äº†çº¿æ€§ä»£æ•°ï¼Œé‚£åªéœ€å°†çŸ©é˜µçœ‹ä½œæ•°å­—è¡¨æ ¼ã€‚&lt;/p&gt;
&lt;p&gt;å½“æåˆ° â€œM æ˜¯ä¸€ä¸ª 4 ä¹˜ 3 çš„çŸ©é˜µâ€ï¼Œæ„æ€æ˜¯æŒ‡ M æ˜¯ä¸€ä¸ª 4 è¡Œ 3 åˆ—çš„æ•°å­—è¡¨æ ¼ã€‚å…³äºçŸ©é˜µä½ å°±éœ€è¦äº†è§£è¿™äº›ï¼ˆè¯‘è€…æ³¨:å³å¯å°†å…¶çœ‹ä½œæ˜¯è¡¨æ ¼ï¼‰ï¼Œå°±å¯ä»¥ç†è§£æœ¬æ–‡åé¢çš„è®²è§£ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="machinethink" scheme="https://swift.gg/categories/machinethink/"/>
    
    
      <category term="Swift" scheme="https://swift.gg/tags/Swift/"/>
    
  </entry>
  
  <entry>
    <title>Swiftä¸­çš„å¼ºåˆ¶ç¼–è¯‘æ—¶æŠ¥é”™</title>
    <link href="https://swift.gg/2018/06/25/forcing-compiler-errors-in-swift/"/>
    <id>https://swift.gg/2018/06/25/forcing-compiler-errors-in-swift/</id>
    <published>2018-06-25T00:00:00.000Z</published>
    <updated>2018-09-10T03:53:25.085Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ä½œè€…ï¼šErica Sadunï¼Œ<a href="https://ericasadun.com/2018/04/18/forcing-compiler-errors-in-swift/" target="_blank" rel="noopener">åŸæ–‡é“¾æ¥</a>ï¼ŒåŸæ–‡æ—¥æœŸï¼š2018-04-18<br>è¯‘è€…ï¼š<a href="http://wuqiuhao.github.io" target="_blank" rel="noopener">Hale</a>ï¼›æ ¡å¯¹ï¼š<a href="undefined">æ¢æ°</a>ï¼Œ<a href="http://blog.yousanflics.com.cn" target="_blank" rel="noopener">Yousanflics</a>ï¼›å®šç¨¿ï¼š<a href="http://blog.yousanflics.com.cn" target="_blank" rel="noopener">Yousanflics</a>ï¼Œ<a href="https://github.com/chenmingbiao" target="_blank" rel="noopener">CMB</a></p></blockquote><!--æ­¤å¤„å¼€å§‹æ­£æ–‡--><p>å¾—ç›Šäº<a href="https://github.com/apple/swift-evolution/blob/master/proposals/0196-diagnostic-directives.md" target="_blank" rel="noopener">SE-0196</a>ï¼ŒSwift 4.2 å°†å¼•è¿› <code>#warning()</code> å’Œ <code>#error()</code> ä¸¤ä¸ªç¼–è¯‘æŒ‡ä»¤ã€‚è¿™ä¸¤ä¸ªæŒ‡ä»¤å…è®¸ä½ åœ¨ç¼–è¯‘æœŸé—´åˆå¹¶è¯Šæ–­æ¶ˆæ¯å’ŒæŠ›å‡ºé”™è¯¯ã€‚ä¸‹é¢è¿™ä¸ªä¾‹å­æ¥è‡ªå·²è¢«ç¡®å®šæ¥å—çš„æè®®å¹¶ä¸”å·²ç»è¢«å®æ–½ã€‚</p><a id="more"></a><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">#warning(<span class="string">"this is incomplete"</span>)</span><br><span class="line"></span><br><span class="line">#<span class="keyword">if</span> <span class="type">MY_BUILD_CONFIG</span> &amp;&amp; <span class="type">MY_OTHER_BUILD_CONFIG</span></span><br><span class="line">  #error(<span class="string">"MY_BUILD_CONFIG and MY_OTHER_BUILD_CONFIG cannot both be set"</span>)</span><br><span class="line">#endif</span><br></pre></td></tr></table></figure><p><code>#error</code> æŒ‡ä»¤çš„ä¾‹å­ä½¿ç”¨æ¡ä»¶ç¼–è¯‘æ ‡å¿—ï¼ˆç”¨-Dé€‰é¡¹è®¾ç½®ï¼‰æ¥æ£€å¯Ÿç¼–è¯‘æ˜¯å¦äº§ç”Ÿäº†é…ç½®å†²çªã€‚</p><p>æˆ‘(åŸæ–‡ä½œè€…)å·²ç»å†™äº†å¾ˆå¤šå…³äºæˆ‘ä¸å–œæ¬¢åœ¨Swiftä¸­ä½¿ç”¨è›‡å½¢å‘½åæ³•ï¼ˆTHINGS_LIKE_THISï¼‰çš„æ–‡ç« ã€‚ä½†ä¸å¯é¿å…çš„ï¼Œå¼€å‘è€…ä»¬éƒ½å–œæ¬¢ä½¿ç”¨è›‡å½¢å‘½åæ³•åˆ™æ¥å®šä¹‰æ¡ä»¶ç¼–è¯‘æ ‡å¿—ã€‚æ— è®ºæ˜¯ <code>MY_BUILD_CONFIG</code> ã€ <code>MY_OTHER_BUILD_CONFIG</code> è¿˜æ˜¯ <code>DEBUG</code> ã€‚è™½ç„¶è¿™æ˜¯è¡Œä¸šæ ‡å‡†ï¼Œä½†æ„Ÿè§‰è¿™å’ŒSwiftçš„ç¾å­¦å­˜åœ¨å†²çªã€‚</p><p>æˆ‘ä¹Ÿå†™è¿‡å…³äºå¦‚ä½•ä¸æ˜¾ç¤ºä½¿ç”¨ <code>DEBUG</code> æ ‡å¿—æ¥<a href="https://ericasadun.com/2018/04/15/writing-swift-adventures-in-compiler-mods/" target="_blank" rel="noopener">æ£€æµ‹è°ƒè¯•æ¡ä»¶çš„æè®®</a>ã€‚è¿™è¾¹æˆ‘é™„ä¸Šäº†æè®®çš„é“¾æ¥ï¼Œä½ ä»¬å¯ä»¥ç‚¹å‡»æŸ¥çœ‹æ›´å¤šè¯¥æè®®çš„ç›¸å…³å†…å®¹ã€‚</p><p>è¨€å½’æ­£ä¼ ï¼ŒSwiftæ–°è¿‘æå‡ºçš„ <code>#error</code> å’Œ <code>#warning</code> æŒ‡ä»¤ï¼Œåœ¨å½“å‰çš„å®è·µåŸºç¡€ä¸Šæœ‰äº†å¾ˆå¤§è¿›æ­¥ã€‚å®ƒä»¬é€šå¸¸ä¾èµ–äºè¿è¡Œæ—¶çš„åé¦ˆè€Œéç¼–è¯‘æ—¶ã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">#<span class="keyword">if</span> !<span class="type">DEBUG</span></span><br><span class="line"><span class="built_in">fatalError</span>(<span class="string">"This code is incomplete. Please fix before release."</span>)</span><br><span class="line">#endif</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªä»£ç å—ä¸­çš„ç¼©è¿›æ ·å¼æ˜¯ Swift é»˜è®¤çš„ï¼Œä¸»è¦æ˜¯ä¸ºäº†é¿å…æ¡ä»¶ç¼–è¯‘å—ä¸­å‡ºç°è½»å¾®çš„<a href="https://en.wikipedia.org/wiki/Pyramid_of_doom_(programming" target="_blank" rel="noopener">Pyramid of doom</a>)(é‡‘å­—å¡”å„è¿)ã€‚ä½†å¦‚æœæŠŠé‡Œé¢çš„ä»£ç ç¼©è¿›ï¼Œåœ¨è¿™ä¸ªæ¡ä»¶å—çš„å‘¨å›´ä»£ç è¿˜æ˜¯çºµå‘å¢é•¿çš„ï¼Œä¸»è§‚ä¸Šæ„Ÿè§‰æœ‰ç‚¹ä¸‘ã€‚ä¸ºäº†é¿å…è¿™ç§æƒ…å†µï¼Œä¸€äº›ç¼–ç äººå‘˜é‡‡ç”¨å†…è”æ–¹å¼ï¼Œç”¨æœ€å°‘çš„æ¡ä»¶å—å’Œæ›´ç®€æ´çš„æ–¹æ³•å¼ºåˆ¶ç¼–è¯‘æ—¶ï¼ˆè€Œä¸æ˜¯è¿è¡Œæ—¶ï¼‰æŠ¥é”™ã€‚</p><p>ä»¥ä¸‹æ˜¯æˆ‘ä» John Estropia é‚£å‘ç°çš„ä¸€ä¸ªä¾‹å­ï¼ˆä»–å€Ÿé‰´äºä»–çš„åŒäº‹ï¼‰ã€‚ä»–ä½¿ç”¨æ¡ä»¶ç¼–è¯‘æŒ‡ä»¤æ¥è®¾ç½® <code>TODO</code> æˆ– <code>FIXME</code> ç­‰ç±»å‹åˆ«åï¼Œç„¶ååœ¨éœ€è¦çš„åœ°æ–¹ä½¿ç”¨å®ƒä»¬ã€‚åœ¨ debug ç¯å¢ƒæ—¶ï¼Œç¼–è¯‘èƒ½å¤Ÿé€šè¿‡è€Œåœ¨ release ç¯å¢ƒä¸‹ç¼–è¯‘å°±ä¼šæŠ¥é”™ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">#<span class="keyword">if</span> <span class="type">DEBUG</span> </span><br><span class="line"><span class="keyword">internal</span> <span class="keyword">typealias</span> <span class="type">TODO</span>&lt;<span class="type">T</span>&gt; = <span class="type">T</span></span><br><span class="line">#endif</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">"Remove this later"</span>) <span class="keyword">as</span> <span class="type">TODO</span></span><br></pre></td></tr></table></figure><p>è¿™ä¸ªä¸»æ„å¾ˆæ£’ã€‚<code>TODO</code> ç±»å‹åˆ«åå°†æ”¯æŒ debug è¿‡ç¨‹ä¸­åœ¨æƒ³è¦æ³¨é‡Šçš„è¡Œæœ«å°¾ä½¿ç”¨ <code>as TODO</code> ï¼Œåœ¨ release ç¼–è¯‘ç¯å¢ƒä¸‹å°±ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚è¿™ç¡®ä¿äº†æ‰€æœ‰ç”¨ <code>TODO</code> æ ‡æ³¨çš„ç‚¹èƒ½å¤Ÿå®ç°ç¼–è¯‘æ—¶åé¦ˆã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">error: <span class="type">ManyWays</span>.playground:<span class="number">5</span>:<span class="number">31</span>: error: use of undeclared type '<span class="type">TODO'</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">"Remove this later"</span>) <span class="keyword">as</span> <span class="type">TODO</span></span><br></pre></td></tr></table></figure><p>è™½ç„¶ä¸æ˜¯å¾ˆç¾è§‚ï¼Œä½†è¿™å¾ˆæœ‰æ•ˆã€‚å®ƒåŒ…å«äº†å…³äºä»£ç è°ƒç”¨çš„ä½ç½®ä¿¡æ¯å’Œä½ è¦å‘é€çš„ä¿¡æ¯ã€‚å¦‚æœæˆ‘æ­£åœ¨ä½¿ç”¨è¿™ä¸ªæ–¹æ³•ï¼Œæˆ‘å¯èƒ½ä¼šåˆ›å»ºä¸€ä¸ª <code>todo</code> æ–¹æ³•ï¼Œè€Œä¸æ˜¯ç›´æ¥ä½¿ç”¨ä¸Šé¢çš„æ–¹æ³•ã€‚åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä½¿ç”¨é©¼å³°å¼å‘½åä½¿è°ƒç”¨çœ‹èµ·æ¥æ›´å…·æœ‰æŒ‡ä»¤æ€§ï¼Œè€Œä¸åƒæ ‡å‡†çš„å…¨å±€å‡½æ•°ã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">#<span class="keyword">if</span> <span class="type">DEBUG</span></span><br><span class="line"><span class="keyword">internal</span> <span class="class"><span class="keyword">enum</span> <span class="title">IssueLevel</span> </span>&#123;</span><br><span class="line">    <span class="keyword">case</span></span><br><span class="line">    mildImportance,</span><br><span class="line">    moderateImportance,</span><br><span class="line">    highImportance,</span><br><span class="line">    criticalImportance</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">internal</span> <span class="function"><span class="keyword">func</span> <span class="title">ToDo</span><span class="params">(<span class="number">_</span> level: IssueLevel, <span class="number">_</span> string: String)</span></span> &#123;&#125;</span><br><span class="line">#endif</span><br><span class="line"></span><br><span class="line"><span class="comment">// æä¾›ç¼–è¯‘é”™è¯¯ã€æè¿°ä¿¡æ¯å’Œä¼˜å…ˆçº§</span></span><br><span class="line"><span class="type">ToDo</span>(.highImportance, <span class="string">"Remove this later"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// error: ManyWays.playground:13:1: error: use of unresolved identifier 'ToDo'</span></span><br><span class="line"><span class="comment">// ToDo(.highImportance, "Remove this later")</span></span><br></pre></td></tr></table></figure><p>è¿™ç§æ–¹å¼æœ€å¤§çš„å¥½å¤„å°±æ˜¯ä» debug ç¯å¢ƒåˆ° release ç¯å¢ƒï¼Œåªéœ€é€šè¿‡ <code>#if</code> è¿›è¡Œåˆ¤æ–­ã€‚è¿™ç§åšæ³•å¾ˆè¯±äººï¼Œåªè¦ç¡®ä¿å…¨å±€éƒ½åœ¨éœ€è¦æ ‡æ³¨çš„åœ°æ–¹ä½¿ç”¨ï¼Œç„¶ååœ¨åˆ‡æ¢åˆ° release ä¹‹å‰è§£å†³æˆ–ç§»é™¤æ‰€æœ‰çš„æ ‡æ³¨å³å¯ã€‚</p><p>ç›®å‰ï¼ŒSwift ä¸æ”¯æŒç”¨ <code>#message</code> æŒ‡ä»¤æ¥æ‰§è¡Œç±»ä¼¼çš„ä»»åŠ¡ã€‚å¾ˆå¤šå¼€å‘è€…å°†è­¦å‘Šè§†ä¸ºé”™è¯¯ï¼Œä»–ä»¬æ— æ³•åœ¨ä¸¤è€…ä¹‹é—´è¿›è¡Œç»†å¾®çš„åŒºåˆ†ã€‚å¦‚æœ <code>#warning</code> è¢«å‘å¸ƒäº†ï¼Œä½ å°±å¯ä»¥ä½¿ç”¨ <code>#warning</code> å®ç°ç±»ä¼¼â€œfix meâ€çš„åé¦ˆäº†ã€‚è¿›ä¸€æ­¥æ”¹è‰¯çš„è¯ï¼Œ<code>#messageOrDie</code> ï¼ˆæˆ–è€…å…¶ä»–å«æ³•ï¼Œå‘½åçœŸçš„å¾ˆéš¾ï¼‰å¯ä»¥åœ¨ debug build æ—¶å‘é€è­¦å‘Šæ¶ˆæ¯ï¼Œåœ¨ release build æ—¶æŠ¥å‡ºé”™è¯¯ï¼Œé€šè¿‡ <code>æ–­è¨€</code> æ¥åˆ¤æ–­ç”³æ˜æ˜¯å¦å‘ç”Ÿã€‚</p><p>Dave DeLong ä¸ºç»“æ„æ€§é¡¹ç›®è¯­ä¹‰æä¾›äº†å¦ä¸€ç§æ–¹æ³•ã€‚ä»–ä»‹ç»äº†ä¸€ä¸ª <code>Fatal</code> ç±»å‹ä¸ºå¼€å‘ä¸­ä¸€äº›æ¯”è¾ƒå¸¸è§çš„ç»“æœåˆ¤æ–­ä¾‹å¦‚ <code>noImplemented</code>ã€<code>unreachable</code> å’Œ <code>mustOverride</code> ç­‰æä¾›<a href="https://forums.swift.org/t/introducing-namespacing-for-common-swift-error-scenarios/10773" target="_blank" rel="noopener">è¿è¡Œæ—¶çº¿ç´¢</a>,å®ƒæ²¡æœ‰ç”¨â€œyou need to remember to implement thisâ€è¿™æ ·çš„æç¤ºï¼Œè€Œæ˜¯ä»¥è¿è¡Œæ—¶å¥”æºƒçš„å½¢å¼ï¼Œé€šè¿‡ä¸ŠæŠ¥å®Œæ•´çš„ä½ç½®å’Œæ–¹æ³•ä¿¡æ¯æ¥è§£é‡Šã€‚å¦ä¸€ä¸ªæ£€ç´¢è¢«å‘½åä¸º <code>silenceXcode()</code> å…è®¸ä½ æ·»åŠ ä½ è®¤ä¸ºæ°¸è¿œä¸ä¼šå®ç°çš„ä¸€äº›æ–¹æ³•ï¼Œå¦‚æœä½ ä½¿ç”¨äº†å®ƒä¹Ÿä¼šæŠ¥é”™ã€‚</p><p>Swift ä»æœ‰å¾ˆå¤§çš„ç©ºé—´æ¥æ‰©å±•è¿™æ–¹é¢çš„æ”¯æŒã€‚æˆ‘ä¸ä»‹æ„çœ‹åˆ°è¿™ä¸¤ç§æ–¹å¼éƒ½è¢«æ·»åŠ åˆ°æœªæ¥ Swift çš„å®ç°ä¸­ã€‚ä¸€ç§ç”¨äºç¼–è¯‘æ—¶ï¼ˆåƒ <code>#messageOrDie</code> ï¼‰å¦ä¸€ç§ç”¨äºè¿è¡Œæ—¶ï¼ˆåƒ <code>Fatal</code> å‘½åç©ºé—´çš„é™æ€æ£€ç´¢æ–¹æ³•ï¼‰</p><p>ä½ ä»¬æ€ä¹ˆçœ‹å¾…è¿™äº›ï¼Ÿåœ¨ Swift ä¸­è¿˜æœ‰å“ªäº›éƒ¨åˆ†æ˜¯å…ƒç¼–ç¨‹å¼€å‘è¿‡ç¨‹ä¸­ï¼ˆåƒå®ï¼‰è®©ä½ æ„Ÿåˆ°å›°æƒ‘çš„ï¼Ÿæˆ‘å¾ˆæƒ³çŸ¥é“è¿˜æœ‰å“ªäº›å·²ç»ç¡®å®šå‘å¸ƒçš„ç‰¹æ€§èƒ½å¤Ÿæ›´å¥½åœ°æ”¯æŒå¼€å‘ã€‚</p><blockquote><p>æœ¬æ–‡ç”± SwiftGG ç¿»è¯‘ç»„ç¿»è¯‘ï¼Œå·²ç»è·å¾—ä½œè€…ç¿»è¯‘æˆæƒï¼Œæœ€æ–°æ–‡ç« è¯·è®¿é—® <a href="http://swift.gg">http://swift.gg</a>ã€‚</p></blockquote>]]></content>
    
    <summary type="html">
    
      æœ¬æ–‡ä»‹ç»äº†Swift4.2å³å°†å‘å¸ƒçš„
    
    </summary>
    
      <category term="iAchieved.it" scheme="https://swift.gg/categories/iAchieved-it/"/>
    
    
      <category term="Swift" scheme="https://swift.gg/tags/Swift/"/>
    
  </entry>
  
  <entry>
    <title>é‡æ–°å®ç°å¯é€‰ç±»å‹çš„éšå¼è§£åŒ…</title>
    <link href="https://swift.gg/2018/06/19/swift-org-blog-iuo/"/>
    <id>https://swift.gg/2018/06/19/swift-org-blog-iuo/</id>
    <published>2018-06-19T00:00:00.000Z</published>
    <updated>2018-09-10T03:53:25.085Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ä½œè€…ï¼šMark Laceyï¼Œ<a href="https://swift.org/blog/iuo/" target="_blank" rel="noopener">åŸæ–‡é“¾æ¥</a>ï¼ŒåŸæ–‡æ—¥æœŸï¼š2018-04-26<br>è¯‘è€…ï¼š<a href="undefined">ç°s</a>ï¼›æ ¡å¯¹ï¼š<a href="http://numbbbbb.com/" target="_blank" rel="noopener">numbbbbb</a>ï¼Œ<a href="undefined"> mmoaay</a>ï¼›å®šç¨¿ï¼š<a href="https://github.com/chenmingbiao" target="_blank" rel="noopener">CMB</a></p></blockquote><!--æ­¤å¤„å¼€å§‹æ­£æ–‡--><p>ä»Šå¹´æ—©äº›æ—¶å€™ï¼ŒSwift ç¼–è¯‘å™¨å®ç°äº†ä¸€ç§æ–°çš„å¯é€‰ç±»å‹éšå¼è§£åŒ… (IUOs)ï¼Œåœ¨æœ€è¿‘çš„ Swift <a href="https://swift.org/download/#snapshots" target="_blank" rel="noopener">æµ‹è¯•ç‰ˆæœ¬</a> ä¸­å¼€æ”¾ä½¿ç”¨ã€‚å®ƒå®ç°äº† <a href="https://github.com/apple/swift-evolution/blob/master/proposals/0054-abolish-iuo.md" target="_blank" rel="noopener"> SE-0054 - Abolish ImplicitlyUnwrappedOptional Type</a>ã€‚å¯¹äº Swift æ¥è¯´ï¼Œè¿™æ˜¯ä¸€æ¬¡é‡å¤§çš„æ”¹å˜ï¼Œæ¶ˆé™¤äº†ç±»å‹æ£€æµ‹ä¸­çš„ä¸€äº›çŸ›ç›¾ï¼Œå¹¶ä¸”é˜æ˜äº†å¤„ç†è¿™äº›å€¼çš„è§„åˆ™ï¼Œä½¿è¯­ä¹‰ä¿æŒä¸€è‡´ä¸”æ˜“äºæ¨ç†ã€‚æ›´å¤šä¿¡æ¯å¯ä»¥é˜…è¯»è¿™æ¡ææ¡ˆçš„ <a href="https://github.com/apple/swift-evolution/blob/master/proposals/0054-abolish-iuo.md#motivation" target="_blank" rel="noopener">åŠ¨æœº</a>ã€‚</p><p>ä¸»è¦å˜åŒ–æ˜¯ï¼Œå½“å¼•ç”¨ä¸€ä¸ªè¢«å£°æ˜ä¸ºéšå¼è§£åŒ…å¯é€‰çš„åŸºç¡€ç±»å‹ <code>T</code> æ—¶ï¼Œåœ¨è¯Šæ–­ä¿¡æ¯ä¸­ä¼šæ‰“å° <code>T?</code>ï¼Œè€Œä¸æ˜¯ä¹‹å‰çš„ <code>T!</code>ã€‚ä½ å¯èƒ½ä¼šé‡åˆ°æºä»£ç å…¼å®¹æ€§é—®é¢˜ï¼Œéœ€è¦ä¿®æ”¹ä»£ç ä¹‹åæ‰èƒ½ç¼–è¯‘æˆåŠŸã€‚</p><a id="more"></a><h2 id="éšå¼è§£åŒ…æ˜¯å£°æ˜çš„ä¸€éƒ¨åˆ†"><a href="#éšå¼è§£åŒ…æ˜¯å£°æ˜çš„ä¸€éƒ¨åˆ†" class="headerlink" title="éšå¼è§£åŒ…æ˜¯å£°æ˜çš„ä¸€éƒ¨åˆ†"></a>éšå¼è§£åŒ…æ˜¯å£°æ˜çš„ä¸€éƒ¨åˆ†</h2><p><em>å¯é€‰ç±»å‹çš„éšå¼è§£åŒ…</em> åœ¨ç¼–è¯‘æ—¶ä¼šæ ¹æ®éœ€è¦è‡ªåŠ¨è§£åŒ…ã€‚è¦å£°æ˜ä¸€ä¸ªå¯é€‰ç±»å‹çš„éšå¼è§£åŒ…ï¼Œéœ€è¦å°†ç±»å‹åé¢çš„ <code>?</code> æ”¹æˆ <code>!</code>ã€‚  </p><p>åœ¨å¾ˆå¤šäººçš„è®¤çŸ¥ä¸­ï¼Œéšå¼è§£åŒ…çš„å¯é€‰ç±»å‹ä¸å¸¸è§„å¯é€‰ç±»å‹å¹¶ä¸å±äºåŒä¸€ä¸ªç±»åˆ«ã€‚åœ¨ Swift 3 ä¸­ï¼Œå®ƒä»¬ä¹Ÿç¡®å®ä¸ä¸€æ ·ï¼šåƒ <code>var a: Int?</code>  è¿™æ ·çš„å£°æ˜ï¼Œä¼šåˆ›å»ºä¸€ä¸ªæ‹¥æœ‰ <code>Optional&lt;Int&gt;</code> ç±»å‹çš„ <code>a</code>ï¼›åƒ <code>var b: String!</code>  è¿™æ ·çš„å£°æ˜ï¼Œä¼šåˆ›å»ºä¸€ä¸ªæ‹¥æœ‰ <code>ImplicitlyUnwrappedOptional&lt;String&gt;</code> ç±»å‹çš„ <code>b</code> ã€‚  </p><p>åœ¨ IUOs çš„æ–°æ¨¡å‹ä¸­ï¼Œä½ éœ€è¦å°† <code>!</code> è§†ä¸º <code>?</code> çš„åŒä¹‰è¯ï¼Œå®ƒåªæ˜¯åœ¨å£°æ˜ä¸­æ·»åŠ ä¸€ä¸ªæ ‡å¿—è®©ç¼–è¯‘å™¨çŸ¥é“è¢«å£°æ˜çš„å€¼å¯ä»¥è¿›è¡Œéšå¼è§£åŒ…ã€‚  </p><p>æ¢å¥è¯è¯´ï¼Œå¯¹äº <code>String!</code> çš„ç†è§£ä½ å¯ä»¥è®¤ä¸ºæ˜¯ â€œè¿™ä¸ªå€¼æ‹¥æœ‰ <code>Optional&lt;String&gt;</code> ç±»å‹å¹¶ä¸”æºå¸¦äº†ä¿¡æ¯è¯´åœ¨éœ€è¦çš„æ—¶å€™å®ƒå¯ä»¥è¢«éšå¼çš„è§£åŒ…ã€‚â€  </p><p>è¿™ç§æ€ç»´æ¨¡å‹ä¸æ–°çš„å®ç°ç›¸åŒ¹é…ã€‚ç°åœ¨ï¼Œä»»ä½•åœ°æ–¹ä½ ç”³æ˜äº† <code>T!</code> ï¼Œç¼–è¯‘å™¨éƒ½ä¼šå°†å®ƒçœ‹åš <code>T?</code> ç±»å‹ï¼Œç„¶ååœ¨ç”³æ˜çš„å†…éƒ¨è¡¨ç¤ºä¸­æ·»åŠ ä¸€ä¸ªæ ‡ç­¾ä½¿å¾—ç±»å‹æ£€æµ‹å™¨çŸ¥é“å½“éœ€è¦çš„æ—¶å€™å¯ä»¥å¯¹å®ƒè¿›è¡Œéšå¼è§£åŒ…ã€‚  </p><p>è¿™ä¸€å˜åŒ–æœ€æ˜æ˜¾çš„ç»“æœå°±æ˜¯å¯¹äºç”³æ˜ä¸º <code>T!</code> çš„å˜é‡ï¼Œä½ å°†çœ‹åˆ°å…³äº <code>T?</code> çš„è¯Šæ–­è€Œä¸æ˜¯ <code>T!</code>ã€‚ åœ¨è¯Šæ–­ä¸­çœ‹åˆ° <code>T?</code> è€Œä¸æ˜¯ <code>T!</code> å¯èƒ½éœ€è¦ä¸€ç‚¹æ—¶é—´å»é€‚åº”å®ƒï¼Œä½†æ˜¯æ‹¥æŠ±è¿™ä¸€æ–°çš„æ€ç»´æ¨¡å‹å°†ä¼šä¸€ç›´å¸®åŠ©ä½ ã€‚</p><p><strong>ä¸ºäº†ä¾¿äºç†è§£ï¼Œè¯‘è€…è‡ªå·±åšäº†é…å›¾ï¼Œå±•ç¤ºæ–°æ—§ Swift çš„åŒºåˆ«ï¼š</strong>  </p><p><img src="/img/articles/swift-org-blog-iuo/40166397-082f067e-59f1-11e8-931a-3d3d0cb892eb.png1529377151.6054707" alt="old"><br><img src="/img/articles/swift-org-blog-iuo/40166527-52d1029a-59f1-11e8-94f2-44d9dc1660ce.png1529377151.9917665" alt="new"></p><h2 id="æºä»£ç å…¼å®¹æ€§"><a href="#æºä»£ç å…¼å®¹æ€§" class="headerlink" title="æºä»£ç å…¼å®¹æ€§"></a>æºä»£ç å…¼å®¹æ€§</h2><h3 id="å¼ºåˆ¶è½¬æ¢ä¸º-T"><a href="#å¼ºåˆ¶è½¬æ¢ä¸º-T" class="headerlink" title="å¼ºåˆ¶è½¬æ¢ä¸º T!"></a>å¼ºåˆ¶è½¬æ¢ä¸º <code>T!</code></h3><p>æŒ‰ç…§ SE-0054 ææ¡ˆï¼Œ<code>as T!</code> è¿™æ ·çš„å¼ºåˆ¶è½¬æ¢å·²ç»ä¸å†è¢«å…è®¸ã€‚</p><p>åœ¨ Swift 4.1 ä¸­ï¼Œè¿™ç§å½¢å¼çš„å¼ºåˆ¶è½¬æ¢ä¼šæ˜¾ç¤ºä¸€ä¸ªå¼ƒç”¨è­¦å‘Šã€‚å¤šæ•°æƒ…å†µä¸‹ï¼Œä½¿ç”¨ <code>as T?</code> æ¥æ›¿ä»£ <code>as T!</code> æˆ–è€…ç›´æ¥ç§»é™¤è¯¥å¼ºåˆ¶è½¬æ¢å³å¯ç¼–è¯‘æˆåŠŸã€‚</p><p>å¦‚æœè¿™ä¸¤ç§æ–¹æ³•éƒ½ä¸ç®¡ç”¨ï¼Œæ–°çš„å®ç°ä¸­ä¹Ÿæœ‰å¯¹åº”çš„ç‰¹æ®Šå¤„ç†ã€‚å…·ä½“æ¥è¯´ï¼Œå¦‚æœé‡åˆ° <code>x as T!</code>ï¼Œç¼–è¾‘å™¨é¦–å…ˆä¼šå°è¯• <code>x as T?</code>ã€‚å¦‚æœå¤±è´¥ï¼Œç¼–è¾‘å™¨ä¼šç”¨ <code>(x as T?)!</code> æ¥è¿›è¡Œå¼ºåˆ¶è§£åŒ…ã€‚</p><p>ä½†æ˜¯ï¼Œè¿™ç§å½¢å¼çš„å¼ºåˆ¶è½¬æ¢ä»ç„¶ä¸æ¨èä½¿ç”¨ï¼Œåœ¨å°†æ¥çš„ Swift ç‰ˆæœ¬ä¸­æœ‰å¯èƒ½ä¼šç§»é™¤è¿™ç§ç‰¹æ®Šå¤„ç†ã€‚</p><h3 id="åœ¨ç±»å‹ä¸­ä½¿ç”¨"><a href="#åœ¨ç±»å‹ä¸­ä½¿ç”¨" class="headerlink" title="åœ¨ç±»å‹ä¸­ä½¿ç”¨ !"></a>åœ¨ç±»å‹ä¸­ä½¿ç”¨ <code>!</code></h3><p>å¼ºåˆ¶è½¬æ¢ä¸º <code>T!</code> ä½œä¸ºä¸€ä¸ªç‰¹ä¾‹å­˜åœ¨äºä¸€ä¸ªæ›´æ™®éçš„é—®é¢˜ä¸­ï¼šä½¿ç”¨ <code>!</code> ä½œä¸ºç±»å‹çš„ä¸€éƒ¨åˆ†ã€‚  </p><p>å¯ä»¥åœ¨ä¸‹é¢ä¸‰ä¸ªåœ°æ–¹ä½¿ç”¨ <code>!</code> ä½œä¸ºç±»å‹ä¸­çš„ä¸€éƒ¨åˆ†ï¼š</p><pre><code>1. å±æ€§å£°æ˜2. æ–¹æ³•çš„å‚æ•°ç±»å‹å£°æ˜3. æ–¹æ³•çš„è¿”å›å€¼ç±»å‹å£°æ˜</code></pre><p>åœ¨å…¶å®ƒåœ°æ–¹ä½¿ç”¨ <code>!</code> å°†è¢«æ ‡è®°æˆä¸€ä¸ªé”™è¯¯ã€‚Swift 4.1 ä¹‹å‰çš„ç‰ˆæœ¬å°±å·²ç»å®ç°äº†è¿™ä¸ªæ£€æµ‹ï¼Œä½†æ˜¯é—æ¼äº†ä¸€äº›æƒ…å†µï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> fn: (<span class="type">Int</span>!) -&gt; <span class="type">Int</span>! = ...   <span class="comment">// error: not a function declaration!</span></span><br></pre></td></tr></table></figure><p>è¿™é‡Œ Swift 4.1 æ˜¾ç¤ºäº†å¼ƒç”¨è­¦å‘Šï¼Œä½†æ˜¯ä»ç„¶é»˜è®¤äº†éšå¼è§£åŒ…çš„è¡Œä¸ºã€‚åœ¨è¿‘æœŸæµ‹è¯•ç‰ˆæœ¬çš„æ–°å®ç°ä¸­ï¼Œç¼–è¯‘å™¨ä¼šå°† <code>!</code> è§†ä¸º <code>?</code>ï¼ŒåŒæ—¶åœ¨è¯Šæ–­ä¿¡æ¯ä¸­å‘Šè¯‰ä½ å‘ç”Ÿäº†ä»€ä¹ˆï¼Œä»¥åŠè¿™ç§ç”¨æ³•ä¼šè¢«åºŸå¼ƒã€‚  </p><p><strong>è¯‘è€…é…å›¾ï¼š</strong>  </p><p><img src="/img/articles/swift-org-blog-iuo/40213466-2dd070ba-5a88-11e8-888a-0ca5066f4d36.png1529377152.1436236" alt="old-2"><br><img src="/img/articles/swift-org-blog-iuo/40213471-336db9ba-5a88-11e8-9b8e-11287e1bfccd.png1529377152.292037" alt="new-2"></p><h3 id="éšå¼è§£åŒ…å¯é€‰ç±»å‹çš„-map-æ–¹æ³•"><a href="#éšå¼è§£åŒ…å¯é€‰ç±»å‹çš„-map-æ–¹æ³•" class="headerlink" title="éšå¼è§£åŒ…å¯é€‰ç±»å‹çš„ map æ–¹æ³•"></a>éšå¼è§£åŒ…å¯é€‰ç±»å‹çš„ map æ–¹æ³•</h3><p>ä»¥å‰çš„ä»£ç æ˜¯è¿™æ ·çš„ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span> </span>&#123;&#125;</span><br><span class="line"><span class="keyword">let</span> values: [<span class="type">Any</span>]! = [<span class="type">C</span>()]</span><br><span class="line"><span class="keyword">let</span> transformed = values.<span class="built_in">map</span> &#123; $<span class="number">0</span> <span class="keyword">as</span>! <span class="type">C</span> &#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„ä»£ç ä¼šå¯¹ <code>values</code> å¼ºåˆ¶è§£åŒ…ï¼Œç„¶åå¯¹æ•°ç»„è°ƒç”¨ <code>map(_:)</code> æ–¹æ³•ã€‚å³ä½¿ä½ åœ¨ <code>ImplicitlyUnwrappedOptional</code> çš„æ‰©å±•ä¸­å®šä¹‰äº† <code>map(_:)</code> æ–¹æ³•ä¹Ÿæ— æ³•è¦†ç›–é»˜è®¤æ–¹æ³•ï¼Œå› ä¸ºå®ƒå¹¶ä¸ä¼šåƒä½ æƒ³çš„é‚£æ ·ï¼Œåœ¨ <code>ImplicitlyUnwrappedOptional</code> ä¸­æ‰§è¡Œæ–¹æ³•æŸ¥æ‰¾ã€‚  </p><p>åœ¨æ–°çš„å®ç°ä¸­ï¼Œå› ä¸º <code>!</code> å’Œ <code>?</code> æ˜¯åŒä¹‰è¯ï¼Œç¼–è¯‘å™¨ä¼šå°è¯•ä½¿ç”¨ <code>Optional&lt;T&gt;</code> ä¸­çš„ <code>map(_:)</code> æ–¹æ³•ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> transformed = values.<span class="built_in">map</span> &#123; $<span class="number">0</span> <span class="keyword">as</span>! <span class="type">C</span> &#125; <span class="comment">// calls Optional.map; $0 has type [Any]</span></span><br></pre></td></tr></table></figure><p>å¹¶ä¸”æ˜¾ç¤ºï¼š <code>warning: cast from &#39;[Any]&#39; to unrelated type &#39;C&#39; always fails</code>ã€‚  </p><p>è¿™æ ·ä»è¯­ä¹‰ä¸Šå°±é€šè¿‡äº†ç±»å‹æ£€æµ‹ï¼Œæˆ‘ä»¬ä¸éœ€è¦å¯¹ <code>values</code> è¿›è¡Œå¼ºåˆ¶è§£åŒ…ã€‚  </p><p>ä½ å¯ä»¥ä½¿ç”¨å¯é€‰é“¾åˆ¶é€ ä¸€ä¸ªå¯é€‰çš„æ•°ç»„æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> transformed = values?.<span class="built_in">map</span> &#123; $<span class="number">0</span> <span class="keyword">as</span>! <span class="type">C</span> &#125; <span class="comment">// transformed çš„ç±»å‹æ˜¯ Optional&lt;[C]&gt;</span></span><br></pre></td></tr></table></figure><p>æˆ–è€…å¯¹ <code>values</code> è¿›è¡Œå¼ºåˆ¶è§£åŒ…æ¥å¾—åˆ°ä¸€ä¸ªæ•°ç»„ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> transformed = values!.<span class="built_in">map</span> &#123; $<span class="number">0</span> <span class="keyword">as</span>! <span class="type">C</span> &#125; <span class="comment">// transformed has type [C]</span></span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼Œå¤§éƒ¨åˆ†æƒ…å†µä¸‹ä½ ä¸éœ€è¦ä¿®æ”¹ä»£ç ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> values: [<span class="type">Int</span>]! = [<span class="number">1</span>]</span><br><span class="line"><span class="keyword">let</span> transformed = values.<span class="built_in">map</span> &#123; $<span class="number">0</span> + <span class="number">1</span> &#125;</span><br></pre></td></tr></table></figure><p>å®ƒå°†ç»§ç»­æŒ‰ç…§è€ç‰ˆæœ¬çš„æ–¹å¼å·¥ä½œï¼Œå› ä¸ºåœ¨è¿™é‡Œå°†è¡¨è¾¾å¼çœ‹ä½œ <code>Optional</code> æ‰§è¡Œ <code>map(_:)</code> æ–¹æ³•æ— æ³•è¿›è¡Œç±»å‹æ£€æµ‹ã€‚å–è€Œä»£ä¹‹ï¼Œæˆ‘ä»¬ä¼šå¯¹ <code>values</code> è¿›è¡Œå¼ºåˆ¶è§£åŒ…ï¼Œå¹¶å¯¹è¿”å›çš„æ•°ç»„æ‰§è¡Œ <code>map(_:)</code> æ–¹æ³•ã€‚</p><h3 id="æ— æ³•æ¨æ–­ç±»å‹"><a href="#æ— æ³•æ¨æ–­ç±»å‹" class="headerlink" title="æ— æ³•æ¨æ–­ç±»å‹"></a>æ— æ³•æ¨æ–­ç±»å‹</h3><p>å› ä¸ºéšå¼è§£åŒ…å¯é€‰ä¸å†æ˜¯ä¸€ä¸ªç±»å‹ï¼Œæ‰€ä»¥ä¸èƒ½è¢«æ¨æ–­æˆä¸€ç§ç±»å‹æˆ–è€…ç±»å‹çš„ä»»ä½•éƒ¨åˆ†ã€‚</p><p>åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œå°½ç®¡å³è¾¹çš„èµ‹å€¼åŒ…å«ä¸€ä¸ªè¢«å£°æ˜ä¸ºéšå¼è§£åŒ…çš„å€¼ï¼Œå·¦è¾¹ç±»å‹æ¨æ–­ä»…è¡¨ç¤ºè¿™ä¸ªå€¼ï¼ˆæˆ–è€…è¿”å›å€¼ï¼‰æ˜¯ä¸€ä¸ªå¯é€‰ç±»å‹ã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> x: <span class="type">Int</span>!</span><br><span class="line"><span class="keyword">let</span> y = x   <span class="comment">// y has type Int?</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">forcedResult</span><span class="params">()</span></span> -&gt; <span class="type">Int</span>! &#123; ... &#125;</span><br><span class="line"><span class="keyword">let</span> getValue = forcedResult    <span class="comment">// getValue çš„ç±»å‹æ˜¯ () -&gt; Int?</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">id</span>&lt;T&gt;<span class="params">(<span class="number">_</span> value: T)</span></span> -&gt; <span class="type">T</span> &#123; <span class="keyword">return</span> value &#125;</span><br><span class="line"><span class="keyword">let</span> z = id(x)   <span class="comment">// z çš„ç±»å‹æ˜¯ Int?</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">apply</span>&lt;T&gt;<span class="params">(<span class="number">_</span> fn: <span class="params">()</span></span></span> -&gt; <span class="type">T</span>) -&gt; <span class="type">T</span> &#123; <span class="keyword">return</span> fn() &#125;</span><br><span class="line"><span class="keyword">let</span> w: <span class="type">Int</span> = apply(forcedResult)    <span class="comment">// æŠ¥é”™ï¼Œå› ä¸º apply() è¿”å›çš„æ˜¯ Int?</span></span><br></pre></td></tr></table></figure><p>è¿˜æœ‰ä¸€äº›ç‰¹æ®Šçš„å®ä¾‹ä¼šé‡åˆ°è¿™ä¸ªé—®é¢˜ï¼Œæ¯”å¦‚ <code>AnyObject</code> çš„æŸ¥æ‰¾æ“ä½œï¼Œ<code>try?</code> å’Œ <code>switch</code>ã€‚</p><h4 id="AnyObject-çš„æŸ¥æ‰¾æ“ä½œ"><a href="#AnyObject-çš„æŸ¥æ‰¾æ“ä½œ" class="headerlink" title="AnyObject çš„æŸ¥æ‰¾æ“ä½œ"></a>AnyObject çš„æŸ¥æ‰¾æ“ä½œ</h4><p><code>AnyObject</code> çš„æŸ¥æ‰¾ç»“æœä¼šè¢«å½“ä½œä¸€ä¸ªéšå¼è§£åŒ…çš„å¯é€‰ç±»å‹ã€‚å¦‚æœä½ æŸ¥æ‰¾ä¸€ä¸ªæœ¬èº«å°±è¢«å£°æ˜æˆéšå¼è§£åŒ…çš„å±æ€§ï¼Œé‚£ä¹ˆè¡¨è¾¾å¼ç°åœ¨å°±æœ‰ä¸¤å±‚éšå¼è§£åŒ… ( <code>property</code> è¢«å£°æ˜ä¸º <code>UILabel!</code>)ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">getLabel</span><span class="params">(object: AnyObject)</span></span> -&gt; <span class="type">UILabel</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> object.property <span class="comment">// forces both optionals, resulting in a UILabel</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>if let</code> å’Œ <code>guard let</code> ä»…èƒ½è§£åŒ…ä¸€å±‚å¯é€‰å±æ€§ã€‚  </p><p>åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œä¹‹å‰çš„ Swift ç‰ˆæœ¬åœ¨ç»è¿‡ <code>if let</code> è¿›è¡Œä¸€å±‚è§£åŒ…ä¹‹åï¼Œæ¨æµ‹å‡º <code>label</code> çš„å±æ€§ä¸º <code>UILabel!</code>ã€‚åœ¨æµ‹è¯•ç‰ˆæœ¬ä¸­ Swift å°†æ¨æµ‹å‡º <code>UILabel?</code> ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// label is inferred to be UILabel?</span></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">let</span> label = object.property &#123; </span><br><span class="line">   <span class="comment">// Error due to passing a UILabel? where a UILabel is expected</span></span><br><span class="line">  functionTakingLabel(label)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€ä¸ªæ˜ç¡®çš„ç±»å‹æ¥ä¿®å¤è¿™ä¸ªé—®é¢˜ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Implicitly unwrap object.property due to explicit type.</span></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">let</span> label: <span class="type">UILabel</span> = object.property &#123;</span><br><span class="line">  functionTakingLabel(label) <span class="comment">// okay</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="try"><a href="#try" class="headerlink" title="try?"></a><code>try?</code></h4><p>ç±»ä¼¼çš„ï¼Œ<code>try?</code> ä¼šæ·»åŠ ä¸€å±‚å¯é€‰æ€§ï¼Œæ‰€ä»¥å½“å¯¹ä¸€ä¸ªè¿”å›å€¼ä¸ºéšå¼å¯é€‰ç±»å‹çš„æ–¹æ³•ä½¿ç”¨ <code>try?</code> æ—¶ï¼Œä½ å¯èƒ½ä¼šå‘ç°ç°åœ¨éœ€è¦æ›´æ”¹ä»£ç æ¥æ˜¾å¼å¯¹ä¸¤å±‚å¯é€‰æ€§è¿›è¡Œè§£åŒ…ã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">test</span><span class="params">()</span></span> <span class="keyword">throws</span> -&gt; <span class="type">Int</span>! &#123; ... &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">let</span> x = <span class="keyword">try</span>? test() &#123;</span><br><span class="line">  <span class="keyword">let</span> y: <span class="type">Int</span> = x    <span class="comment">// error: x is an Int?</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">let</span> x: <span class="type">Int</span> = <span class="keyword">try</span>? test() &#123; <span class="comment">// explicitly typed as Int</span></span><br><span class="line">  <span class="keyword">let</span> y: <span class="type">Int</span> = x    <span class="comment">// okay, x is an Int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">let</span> x = <span class="keyword">try</span>? test(), <span class="keyword">let</span> y = x &#123; <span class="comment">// okay, x is Int?, y is Int</span></span><br><span class="line"> ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="switch"><a href="#switch" class="headerlink" title="switch"></a><code>switch</code></h4><p>Swift 4.1 å¯ä»¥ç¼–è¯‘ä¸‹é¢è¿™æ ·çš„ä»£ç ï¼Œå› ä¸ºå®ƒå°† <code>output</code> ä½œä¸ºéšå¼è§£åŒ…å¯¹å¾…ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">switchExample</span><span class="params">(input: String!)</span></span> -&gt; <span class="type">String</span> &#123;</span><br><span class="line">  <span class="keyword">switch</span> input &#123;</span><br><span class="line">  <span class="keyword">case</span> <span class="string">"okay"</span>:</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"fine"</span></span><br><span class="line">  <span class="keyword">case</span> <span class="keyword">let</span> output:</span><br><span class="line">    <span class="keyword">return</span> output  <span class="comment">// éšå¼è§£åŒ…å¯é€‰å€¼ï¼Œè¿”å› String</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¯·æ³¨æ„ï¼Œå¦‚æœç”¨ä¸‹é¢è¿™ç§æ–¹æ³•å®ç°è¿™ä¸ªä¾‹å­ï¼Œæ— æ³•ç¼–è¯‘æˆåŠŸï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">switchExample</span><span class="params">(input: String!)</span></span> -&gt; <span class="type">String</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> output = input  <span class="comment">// output is inferred to be String?</span></span><br><span class="line">  <span class="keyword">switch</span> input &#123;</span><br><span class="line">  <span class="keyword">case</span> <span class="string">"okay"</span>:</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"fine"</span></span><br><span class="line">  <span class="keyword">default</span>:</span><br><span class="line">    <span class="keyword">return</span> output  <span class="comment">// error: value of optional type 'String?' not unwrapped;</span></span><br><span class="line">                   <span class="comment">// did you mean to use '!' or '?'?</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨æ–°çš„å®ç°ä¸­ï¼Œç¬¬ä¸€ä¸ªä¾‹å­ä¸­çš„ <code>output</code> å°†è¢«æ¨æ–­æˆæ²¡æœ‰éšå¼è§£åŒ…çš„ <code>String?</code> ç±»å‹ã€‚  </p><p>ä¸‹é¢æ˜¯ä¸€ç§ä¿®å¤æ–¹æ³•ï¼Œå¯¹å€¼è¿›è¡Œå¼ºåˆ¶è§£åŒ…ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">case</span> <span class="keyword">let</span> output:</span><br><span class="line">   <span class="keyword">return</span> output!</span><br></pre></td></tr></table></figure><p>å¦ä¸€ç§ä¿®å¤æ–¹æ³•æ˜¯å¯¹ non-nil å’Œ nil è¿›è¡Œæ˜¾å¼çš„æ¨¡å¼åŒ¹é…ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">switchExample</span><span class="params">(input: String!)</span></span> -&gt; <span class="type">String</span> &#123;</span><br><span class="line">  <span class="keyword">switch</span> input &#123;</span><br><span class="line">  <span class="keyword">case</span> <span class="string">"okay"</span>:</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"fine"</span></span><br><span class="line">  <span class="keyword">case</span> <span class="keyword">let</span> output?: <span class="comment">// non-nil case</span></span><br><span class="line">    <span class="keyword">return</span> output   <span class="comment">// okay; output is a String</span></span><br><span class="line">  <span class="keyword">case</span> <span class="literal">nil</span>:</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"&lt;empty&gt;"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ä½¿ç”¨å¯é€‰ç±»å‹å’Œéšå¼è§£åŒ…å¯é€‰ç±»å‹é‡è½½è¾“å…¥è¾“å‡ºå‚æ•°"><a href="#ä½¿ç”¨å¯é€‰ç±»å‹å’Œéšå¼è§£åŒ…å¯é€‰ç±»å‹é‡è½½è¾“å…¥è¾“å‡ºå‚æ•°" class="headerlink" title="ä½¿ç”¨å¯é€‰ç±»å‹å’Œéšå¼è§£åŒ…å¯é€‰ç±»å‹é‡è½½è¾“å…¥è¾“å‡ºå‚æ•°"></a>ä½¿ç”¨å¯é€‰ç±»å‹å’Œéšå¼è§£åŒ…å¯é€‰ç±»å‹é‡è½½è¾“å…¥è¾“å‡ºå‚æ•°</h3><p>å¦‚æœåœ¨ Swift 4.1 ä¸­å°è¯•å»é‡è½½ä¸€ä¸ªå‡½æ•°å¹¶ä¸” in-out å‚æ•°æ˜¯éšå¼è§£åŒ…å¯é€‰ç±»å‹ï¼Œä¼šæ˜¾ç¤ºä¸€ä¸ªå¼ƒç”¨è­¦å‘Š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">someKindOfOptional</span><span class="params">(<span class="number">_</span>: <span class="keyword">inout</span> Int?)</span></span> &#123; ... &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Warning in Swift 4.1.  Error in new implementation.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">someKindOfOptional</span><span class="params">(<span class="number">_</span>: <span class="keyword">inout</span> Int!)</span></span> &#123; ... &#125;</span><br></pre></td></tr></table></figure><p>Swift 4.1 ä¸­ï¼Œå¦‚æœ in-out å‚æ•°æ˜¯å¯é€‰çš„ï¼Œé‚£å¯ä»¥ç›´æ¥ä¼ å…¥ä¸€ä¸ªéšå¼è§£åŒ…å¯é€‰ç±»å‹çš„å€¼ï¼Œåä¹‹äº¦ç„¶ã€‚è¿™æ ·å°±å¯ä»¥åˆ é™¤ä¸Šé¢çš„ç¬¬äºŒä¸ªé‡è½½ï¼ˆå‡è®¾ä¸¤ä¸ªå‡½æ•°å®ç°å®Œå…¨ä¸€è‡´ï¼‰ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">someKindOfOptional</span><span class="params">(<span class="number">_</span>: <span class="keyword">inout</span> Int?)</span></span> &#123; ... &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> i: <span class="type">Int</span>! = <span class="number">1</span></span><br><span class="line">someKindOfOptional(&amp;i)   <span class="comment">// å®Œå…¨æ²¡é—®é¢˜ï¼Œi çš„ç±»å‹æ˜¯ Optional&lt;Int&gt;</span></span><br></pre></td></tr></table></figure><p>åœ¨ä¹‹åçš„æ–°ç‰ˆæœ¬ä¸­ï¼Œç”±äº <code>Int!</code> ä¸ <code>Int?</code> æ˜¯åŒä¹‰è¯ï¼Œé‡è½½çš„å¯é€‰æ€§ä¸å†æœ‰æ„ä¹‰ã€‚å› æ­¤ï¼Œå’Œä¸Šé¢ä¾‹å­ä¸­ç±»ä¼¼çš„é‡è½½éƒ½ä¼šæŠ¥é”™ï¼Œå¹¶ä¸”ç¬¬äºŒä¸ªé‡è½½ï¼ˆå£°æ˜ä¸º <code>Int!</code>ï¼‰å¿…é¡»è¢«åˆ é™¤ã€‚</p><h3 id="ImplicitlyUnwrappedOptional-æ‰©å±•"><a href="#ImplicitlyUnwrappedOptional-æ‰©å±•" class="headerlink" title="ImplicitlyUnwrappedOptional æ‰©å±•"></a>ImplicitlyUnwrappedOptional æ‰©å±•</h3><p>ç°åœ¨ <code>ImplicitlyUnwrappedOptional&lt;T&gt;</code> åªæ˜¯ <code>Optional&lt;T&gt;</code> çš„åˆ«åï¼Œè€Œä¸”ä¸èƒ½ç›´æ¥ä½¿ç”¨ï¼Œæ‰€ä»¥å°è¯•ç»™å®ƒåˆ›å»º <code>extension</code> ä¼šç¼–è¯‘å¤±è´¥ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 1:11: error: 'ImplicitlyUnwrappedOptional' has been renamed to 'Optional'</span></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">ImplicitlyUnwrappedOptional</span> </span>&#123;</span><br></pre></td></tr></table></figure><h3 id="nil-æ¡¥æ¥"><a href="#nil-æ¡¥æ¥" class="headerlink" title="nil æ¡¥æ¥"></a>nil æ¡¥æ¥</h3><p>å¯¹ <code>nil</code> ç±»å‹çš„å€¼è¿›è¡Œæ¡¥æ¥æ—¶ä¸ä¼šæŠ¥è¿è¡Œæ—¶é”™è¯¯ï¼Œè€Œæ˜¯æŠŠ <code>nil</code> æ¡¥æ¥ä¸º <code>NSNull</code> ã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Foundation</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span>: <span class="title">NSObject</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> iuoElement: <span class="type">C</span>! = <span class="literal">nil</span></span><br><span class="line"><span class="keyword">let</span> array: [<span class="type">Any</span>] = [iuoElement <span class="keyword">as</span> <span class="type">Any</span>]</span><br><span class="line"><span class="keyword">let</span> ns = array <span class="keyword">as</span> <span class="type">NSArray</span></span><br><span class="line"><span class="keyword">let</span> element = ns[<span class="number">0</span>] <span class="comment">// Swift 4.1: Fatal error: Attempt to bridge</span></span><br><span class="line">                    <span class="comment">// an implicitly unwrapped optional containing nil</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">let</span> value = element <span class="keyword">as</span>? <span class="type">NSNull</span>, value == <span class="type">NSNull</span>() &#123;</span><br><span class="line">  <span class="built_in">print</span>(<span class="string">"pass"</span>)     <span class="comment">// æ–°ç‰ˆæœ¬ä¸­ä¼šæ‰§è¡Œåˆ°è¿™é‡Œ</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="built_in">print</span>(<span class="string">"fail"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ç»“è®º"><a href="#ç»“è®º" class="headerlink" title="ç»“è®º"></a>ç»“è®º</h3><p>éšå¼è§£åŒ…çš„å¯é€‰ç±»å‹å·²ç»è¢«é‡æ–°å®ç°ï¼Œå®ƒä»¬ä¸å†æ˜¯ <code>Optional&lt;T&gt;</code> çš„ç‰¹æ®Šå½¢å¼ã€‚å› æ­¤ï¼Œç±»å‹æ£€æµ‹çš„ä¸€è‡´æ€§å°†ä¼šæ›´å¥½ï¼Œç¼–è¯‘å™¨çš„ç‰¹æ®Šæƒ…å†µä¹Ÿä¼šæ›´å°‘ã€‚åˆ é™¤è¿™äº›ç‰¹æ®Šæƒ…å†µä¼šå‡å°‘å¤„ç†å£°æ˜æ—¶çš„é”™è¯¯æ•°é‡ã€‚  </p><p>å¯¼å…¥çš„ Object-C API å¯èƒ½ä¼šè¿”å›éšå¼è§£åŒ…çš„å€¼ã€‚ä½ å¯èƒ½ä¼šå‘ç°åœ¨å£°æ˜ <code>@IBOutlet</code> å±æ€§ï¼ˆæˆ–è€…ä»»ä½•åˆå§‹åŒ–ä¹‹å‰ä¸ä¼šä½¿ç”¨çš„å€¼ï¼‰æ—¶ä½¿ç”¨éšå¼è§£åŒ…ä¼šæ›´åŠ æ–¹ä¾¿ã€‚ä¸è¿‡æ€»ä½“æ¥è¯´ï¼Œéšå¼è§£åŒ…èƒ½ä¸ç”¨æœ€å¥½åˆ«ç”¨ï¼Œæ”¹ç”¨ <code>if let</code> å’Œ <code>guard let</code> æ¥æ˜¾å¼è§£åŒ…ã€‚å¦‚æœç¡®å®šæœ‰å€¼ï¼Œå°±ç”¨ <code>!</code> æ¥æ˜¾å¼å¼ºåˆ¶è§£åŒ…ã€‚</p><h3 id="åé¦ˆ"><a href="#åé¦ˆ" class="headerlink" title="åé¦ˆ"></a>åé¦ˆ</h3><p>å¦‚æœä½ å¯¹è¿™ç¯‡æ–‡ç« æœ‰ç–‘é—®æˆ–è€…æƒ³æ³•ï¼Œå¯ä»¥åœ¨ Swift è®ºå›ä¸­å‚ä¸<a href="https://forums.swift.org/t/swift-org-blog-reimplementation-of-implicitly-unwrapped-optionals/12175" target="_blank" rel="noopener">ç›¸å…³è®¨è®º</a>ã€‚</p><blockquote><p>æœ¬æ–‡ç”± SwiftGG ç¿»è¯‘ç»„ç¿»è¯‘ï¼Œå·²ç»è·å¾—ä½œè€…ç¿»è¯‘æˆæƒï¼Œæœ€æ–°æ–‡ç« è¯·è®¿é—® <a href="http://swift.gg">http://swift.gg</a>ã€‚</p></blockquote>]]></content>
    
    <summary type="html">
    
      é‡æ–°å®ç°éšå¼è§£åŒ…çš„åŸå› ï¼Œä¼šç¢°åˆ°é—®é¢˜ã€‚
    
    </summary>
    
      <category term="swift.org" scheme="https://swift.gg/categories/swift-org/"/>
    
    
      <category term="Swift" scheme="https://swift.gg/tags/Swift/"/>
    
  </entry>
  
  <entry>
    <title>Objective-C Runtime ä¸­å†…å­˜é‡Šæ”¾çš„å¹¶å‘é—®é¢˜</title>
    <link href="https://swift.gg/2018/06/11/friday-qa-2015-05-29-concurrent-memory-deallocation-in-the-objective-c-runtime/"/>
    <id>https://swift.gg/2018/06/11/friday-qa-2015-05-29-concurrent-memory-deallocation-in-the-objective-c-runtime/</id>
    <published>2018-06-11T00:00:00.000Z</published>
    <updated>2018-09-10T03:53:25.081Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ä½œè€…ï¼šMike Ashï¼Œ<a href="https://www.mikeash.com/pyblog/friday-qa-2015-05-29-concurrent-memory-deallocation-in-the-objective-c-runtime.html" target="_blank" rel="noopener">åŸæ–‡é“¾æ¥</a>ï¼ŒåŸæ–‡æ—¥æœŸï¼š2015-06-05<br>è¯‘è€…ï¼š<a href="https://github.com/YangGao1991" target="_blank" rel="noopener">é˜³ä»”</a>ï¼›æ ¡å¯¹ï¼š<a href="http://numbbbbb.com/" target="_blank" rel="noopener">numbbbbb</a>ï¼Œ<a href="https://weibo.com/1743643682/profile?topnav=1&amp;wvr=6" target="_blank" rel="noopener">liberalism</a>ï¼›å®šç¨¿ï¼š<a href="https://github.com/chenmingbiao" target="_blank" rel="noopener">CMB</a></p></blockquote><!--æ­¤å¤„å¼€å§‹æ­£æ–‡--><p>Objective-C Runtime æ˜¯ç»å¤§å¤šæ•° Mac å’Œ iOS ç¨‹åºä»£ç çš„æ ¸å¿ƒã€‚Runtime çš„æ ¸å¿ƒå°±æ˜¯ <code>objc_msgSend</code> å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°æœ€å…³é”®çš„å°±æ˜¯æ–¹æ³•ç¼“å­˜ã€‚æˆ‘åœ¨è¿™ç¯‡æ–‡ç« ä¸­å°†ä¼šé˜è¿°ä¸€ä¸‹ï¼ŒApple æ˜¯å¦‚ä½•åœ¨ä¸å½±å“æ€§èƒ½çš„æƒ…å†µä¸‹ï¼Œä»¥çº¿ç¨‹å®‰å…¨çš„æ–¹å¼æ¥é‡æ–°åˆ†é…ç¼“å­˜å¤§å°ã€é‡Šæ”¾æ–¹æ³•ç¼“å­˜ã€‚</p><a id="more"></a><h3 id="æ¶ˆæ¯ä¼ é€’çš„æ¦‚å¿µ"><a href="#æ¶ˆæ¯ä¼ é€’çš„æ¦‚å¿µ" class="headerlink" title="æ¶ˆæ¯ä¼ é€’çš„æ¦‚å¿µ"></a>æ¶ˆæ¯ä¼ é€’çš„æ¦‚å¿µ</h3><p><code>objc_msgSend</code> ä¼šæŸ¥æ‰¾è¢«è°ƒç”¨çš„æ–¹æ³•çš„å®ç°ï¼Œç„¶åå»æ‰§è¡Œã€‚ä»æ¦‚å¿µä¸Šè®²ï¼ŒæŸ¥æ‰¾æ–¹æ³•çš„è¿‡ç¨‹å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">IMP lookUp(id obj, SEL selector) &#123;</span><br><span class="line">    Class c = object_getClass(obj);</span><br><span class="line"></span><br><span class="line">    while(c) &#123;</span><br><span class="line">        for(int i = 0; i &lt; c-&gt;numMethods; i++) &#123;</span><br><span class="line">            Method m = c-&gt;methods[i];</span><br><span class="line">            if(m.selector == selector) &#123;</span><br><span class="line">                return m.imp;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        c = c-&gt;superclass;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return _objc_msgForward;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è€ƒè™‘åˆ°æºç çš„ç‰ˆæƒï¼Œä¸€äº›å˜é‡ååšäº†ä¿®æ”¹ã€‚å¦‚æœä½ æƒ³çœ‹çœ‹çœŸå®çš„å®ç°ä»£ç ï¼Œå¯ä»¥æŸ¥çœ‹ Objective-C runtime çš„<a href="http://www.opensource.apple.com/source/objc4/" target="_blank" rel="noopener">å¼€æºä»£ç </a>ã€‚</p><h3 id="æ–¹æ³•ç¼“å­˜"><a href="#æ–¹æ³•ç¼“å­˜" class="headerlink" title="æ–¹æ³•ç¼“å­˜"></a>æ–¹æ³•ç¼“å­˜</h3><p>ç»å¤§éƒ¨åˆ† Objective-C çš„ä»£ç éƒ½ç”¨åˆ°äº†æ¶ˆæ¯ä¼ é€’ã€‚å¦‚æœæ¯ä¸€æ¬¡æ¶ˆæ¯ä¼ é€’éƒ½éœ€è¦è¿›è¡Œä¸€æ¬¡å®Œæ•´æŸ¥æ‰¾çš„è¯ï¼Œé€Ÿåº¦å°†ä¼šéå¸¸æ…¢ã€‚</p><p>è§£å†³æ–¹æ³•æ˜¯å»ºç«‹æ–¹æ³•çš„ç¼“å­˜ã€‚æ¯ä¸ªç±»æŒæœ‰ä¸€ä¸ªå“ˆå¸Œè¡¨ï¼Œå°†æ–¹æ³•åæ˜ å°„åˆ°æ–¹æ³•çš„å®ç°ã€‚è¿™ä¸ªå“ˆå¸Œè¡¨éœ€è¦å°½å¯èƒ½åœ°æé«˜è¯»å–æ•ˆç‡ï¼Œ<code>objc_msgSend</code> å‡½æ•°ä½¿ç”¨ç²¾å¿ƒæ„é€ çš„æ±‡ç¼–ä»£ç æ¥å¿«é€Ÿå®ç°è¿™ä¸ªå“ˆå¸Œè¡¨çš„æŸ¥è¯¢ã€‚è¿™æ ·ï¼Œåœ¨æœ‰ç¼“å­˜çš„æƒ…å†µä¸‹ï¼Œä¸€æ¡æ¶ˆæ¯çš„ä¼ é€’åªéœ€è¦å‡ çº³ç§’çš„æ—¶é—´ã€‚è™½ç„¶æ¯æ¡æ¶ˆæ¯ç¬¬ä¸€æ¬¡è¢«ä¼ é€’çš„æ—¶å€™è¿˜æ˜¯å¾ˆæ…¢ï¼Œä½†è¿™ä¹‹åï¼Œå°±ä¼šå˜å¾—å¾ˆå¿«ã€‚</p><p>æˆ‘ä»¬æ‰€è¯´çš„â€œç¼“å­˜â€ï¼Œé€šå¸¸æ¥è¯´æ˜¯æŒ‡ä¸ºäº†åŠ å¿«å¤šæ¬¡è®¿é—®æœ€è¿‘ä½¿ç”¨è¿‡çš„èµ„æºçš„é€Ÿåº¦ï¼Œè€Œå¼€è¾Ÿçš„ä¸€å—æœ‰é™å¤§å°çš„åŒºåŸŸã€‚ä¾‹å¦‚ï¼Œä½ å¯èƒ½ä¼šæŠŠä»ç½‘ç»œä¸Šä¸‹è½½çš„å›¾ç‰‡ç¼“å­˜èµ·æ¥ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥çš„ä¸€æ®µæ—¶é—´ï¼Œå¦‚æœå†éœ€è¦ä½¿ç”¨åˆ°è¿™äº›å›¾ç‰‡çš„è¯ï¼Œå°±ä¸éœ€è¦å†å»ä»ç½‘ç»œä¸‹è½½äº†ã€‚å°½ç®¡å¦‚æ­¤ï¼Œä½ ä¹Ÿä¸ä¼šå¸Œæœ›ç¼“å­˜å ç”¨å¤ªå¤šçš„å†…å­˜ç©ºé—´ã€‚æ‰€ä»¥ä½ å¯èƒ½ä¼šé™åˆ¶ç¼“å­˜å›¾ç‰‡çš„æœ€å¤§æ•°é‡ã€‚å½“ç¼“å­˜çš„å›¾ç‰‡è¾¾åˆ°æœ€å¤§æ•°é‡åï¼Œæ¯æ¬¡ç¼“å­˜æ–°çš„å›¾ç‰‡ï¼Œå°±ä¼šæŠŠæœ€æ—§çš„é‚£ä¸ªä»ç¼“å­˜ä¸­å»æ‰ã€‚</p><p>è¿™å¯¹äºå¤§éƒ¨åˆ†é—®é¢˜æ¥è¯´æ˜¯ä¸€ä¸ªä¸é”™çš„åšæ³•ï¼Œä½†å®ƒä¹Ÿå¯èƒ½å¯¼è‡´æ€§èƒ½ä¸Šçš„æŸè€—ã€‚æ¯”å¦‚ï¼Œä½ è®¾å®šå›¾ç‰‡ç¼“å­˜æœ€å¤šç¼“å­˜ 40 å¼ å›¾ç‰‡ï¼Œä½†åœ¨æŸç§æƒ…å†µä¸‹ï¼Œä½ çš„åº”ç”¨éœ€è¦ä¸€ç›´å¾ªç¯ä½¿ç”¨ 41 å¼ å›¾ç‰‡ï¼Œè¿™æ—¶ä½ ä¼šå‘ç°ç¼“å­˜å®Œå…¨ä¸èµ·ä½œç”¨ï¼</p><p>å¯¹äºæˆ‘ä»¬è‡ªå·±çš„åº”ç”¨ï¼Œå¯ä»¥é€šè¿‡æµ‹è¯•ï¼Œè°ƒæ•´ç¼“å­˜çš„å¤§å°æ¥é¿å…å‡ºç°è¿™ç§æƒ…å†µï¼Œä½† Objective-C çš„ runtime å¹¶ä¸èƒ½è¿™æ ·åšã€‚æ–¹æ³•ç¼“å­˜å¯¹æ€§èƒ½æ¥è¯´éå¸¸é‡è¦ï¼Œå¹¶ä¸”æ¯ä¸ªæ–¹æ³•çš„ç¼“å­˜å ç”¨çš„ç©ºé—´éƒ½å¾ˆå°ï¼Œå› æ­¤ï¼Œruntime å¹¶ä¸ä¼šå¯¹ç¼“å­˜ç©ºé—´çš„å¤§å°è¿›è¡Œé™åˆ¶ï¼Œè€Œæ˜¯ä¼šåœ¨éœ€è¦æ—¶éšæ—¶æ‰©å¤§ç¼“å­˜ç©ºé—´ï¼Œæ¥ç¼“å­˜æ‰€æœ‰å‘é€è¿‡çš„æ¶ˆæ¯ã€‚</p><p>è¯·æ³¨æ„ï¼Œruntime çš„æ–¹æ³•ç¼“å­˜æœ‰æ—¶ç¡®å®æ˜¯ä¼šåˆ·æ–°çš„ã€‚æ¯”å¦‚å½“å°†æ–°çš„ä»£ç åŠ è½½åˆ°è¿›ç¨‹æ—¶ï¼Œæˆ–è€…ä¿®æ”¹äº†ä¸€ä¸ªç±»çš„æ–¹æ³•åˆ—è¡¨æ—¶ï¼Œå¯èƒ½ä¼šå¯¼è‡´æŸäº›ç¼“å­˜çš„æ•°æ®å¤±æ•ˆã€‚è¿™æ—¶ï¼Œç›¸åº”çš„æ—§çš„ç¼“å­˜æ•°æ®å°±ä¼šè¢«åˆ é™¤ï¼Œå¹¶é‡æ–°å†™å…¥æ–°çš„ç¼“å­˜æ•°æ®ã€‚</p><h3 id="æ”¹å˜ç¼“å­˜å¤§å°ï¼Œé”€æ¯ï¼Œä»¥åŠçº¿ç¨‹é—®é¢˜"><a href="#æ”¹å˜ç¼“å­˜å¤§å°ï¼Œé”€æ¯ï¼Œä»¥åŠçº¿ç¨‹é—®é¢˜" class="headerlink" title="æ”¹å˜ç¼“å­˜å¤§å°ï¼Œé”€æ¯ï¼Œä»¥åŠçº¿ç¨‹é—®é¢˜"></a>æ”¹å˜ç¼“å­˜å¤§å°ï¼Œé”€æ¯ï¼Œä»¥åŠçº¿ç¨‹é—®é¢˜</h3><p>æ”¹å˜ç¼“å­˜å¤§å°ï¼Œä»æ¦‚å¿µä¸Šæ¥è¯´æ¯”è¾ƒç®€å•ï¼Œæ¯”å¦‚è¿™æ ·ï¼š</p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">bucket_t</span> *newCache = <span class="built_in">malloc</span>(newSize);</span><br><span class="line">copyEntries(newCache, class-&gt;cache);</span><br><span class="line"><span class="built_in">free</span>(class-&gt;cache);</span><br><span class="line"><span class="class"><span class="keyword">class</span>-&gt;<span class="title">cache</span> = <span class="title">newCache</span>;</span></span><br></pre></td></tr></table></figure><p>å®é™…ä¸Šï¼ŒObjective-C runtime åœ¨è¿™ä¸ªåŸºç¡€ä¸Šåˆå¯¹ä»£ç è¿›è¡Œäº†ç²¾ç®€ï¼šæ—§çš„ç¼“å­˜æ•°æ®å¹¶æ²¡æœ‰è¢«å¤åˆ¶åˆ°æ–°çš„ç¼“å­˜ç©ºé—´ä¸­ï¼æ¯•ç«Ÿï¼Œè¿™åªæ˜¯ä¸€å—ç¼“å­˜ç©ºé—´è€Œå·²ï¼Œå¹¶æ²¡æœ‰è¦æ±‚ä¸€å®šè¦ä¿ç•™å…¶ä¸­çš„æ•°æ®ã€‚åœ¨æ¶ˆæ¯å‘é€çš„æ—¶å€™ï¼Œæ–°çš„æ•°æ®è‡ªç„¶åˆä¼šè¢«ç¼“å­˜ä¸‹æ¥ã€‚å› æ­¤ï¼Œäº‹å®ä¸Šï¼Œä»£ç æ˜¯è¿™æ ·ï¼š</p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="built_in">free</span>(class-&gt;cache);</span><br><span class="line"><span class="class"><span class="keyword">class</span>-&gt;<span class="title">cache</span> = <span class="title">malloc</span>(<span class="title">newSize</span>);</span></span><br></pre></td></tr></table></figure><p>å¦‚æœåªè®²å•çº¿ç¨‹ï¼Œéœ€è¦åšçš„å°±æ˜¯è¿™ä¹ˆå¤šäº†ï¼Œè¿™ç¯‡æ–‡ç« åˆ°è¿™ä¹Ÿå¯ä»¥ç»“æŸäº†ã€‚ä½†æ˜¯ï¼ŒObjective-C runtime è‚¯å®šè¦æ”¯æŒå¤šçº¿ç¨‹æ“ä½œï¼Œè¿™å°±æ„å‘³ç€æ‰€æœ‰çš„ä»£ç å¿…é¡»ä¿è¯çº¿ç¨‹å®‰å…¨ã€‚æ¯ä¸€ä¸ªç±»çš„ç¼“å­˜æ•°æ®éƒ½å¯èƒ½ä¼šè¢«å¤šä¸ªçº¿ç¨‹åŒæ—¶æ“ä½œï¼Œå› æ­¤ï¼Œè¿™é‡Œçš„ä»£ç å¿…é¡»è°¨æ…å¤„ç†ï¼Œæ‰èƒ½æ»¡è¶³çº¿ç¨‹å®‰å…¨çš„æ¡ä»¶ã€‚</p><p>åƒä¸Šé¢çš„å†™æ³•è‡ªç„¶ä¸è¡Œã€‚åœ¨é‡Šæ”¾äº†æ—§çš„ç¼“å­˜ç©ºé—´ï¼Œå¹¶ä¸”è¿˜æ²¡æœ‰æ­£ç¡®èµ‹å€¼æ–°å¼€è¾Ÿçš„ç©ºé—´çš„è¿™æ®µâ€œçª—å£æ—¶é—´â€ä¸­ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹å°±å¯èƒ½è®¿é—®åˆ°éæ³•çš„åœ°å€ï¼Œè¿™ä¼šå¯¼è‡´å…¶è®¿é—®åˆ°åƒåœ¾æ•°æ®ã€‚æ­¤å¤–ï¼Œå¦‚æœé‚£å—å†…å­˜æ²¡æœ‰è¿›è¡Œæ˜ å°„çš„è¯ï¼Œå°±ä¼šé€ æˆé—ªé€€ã€‚</p><p>æˆ‘ä»¬å¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜ï¼Ÿå…¸å‹çš„åšæ³•æ˜¯ä½¿ç”¨çº¿ç¨‹é”ï¼Œå°±åƒè¿™æ ·ï¼š</p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line">lock(class-&gt;lock);</span><br><span class="line"><span class="built_in">free</span>(class-&gt;cache);</span><br><span class="line"><span class="class"><span class="keyword">class</span>-&gt;<span class="title">cache</span> = <span class="title">malloc</span>(<span class="title">newSize</span>);</span></span><br><span class="line">unlock(class-&gt;lock);</span><br></pre></td></tr></table></figure><p>æ‰€æœ‰è®¿é—®éƒ½å¿…é¡»ç”±é”æ§åˆ¶ï¼ŒåŒ…æ‹¬è¯»æ“ä½œã€‚è¿™æ ·å°±æ„å‘³ç€ï¼Œ<code>objc_msgSend</code> æ–¹æ³•å¯èƒ½éœ€è¦è·å–çº¿ç¨‹é”ï¼Œè®¿é—®ç¼“å­˜ç©ºé—´ï¼Œç„¶åé‡Šæ”¾é”ã€‚è€ƒè™‘åˆ°ç¼“å­˜çš„æŸ¥æ‰¾æœ¬èº«åªä¼šå ç”¨å‡ çº³ç§’çš„æ—¶é—´ï¼Œæ¯æ¬¡è·å–ã€é‡Šæ”¾é”ä¼šå¢åŠ å¾ˆå¤šæ—¶é—´çš„æŸè€—ï¼Œå¯¹æ€§èƒ½çš„å½±å“å¤ªå¤§äº†ã€‚</p><p>æˆ‘ä»¬ä¹Ÿå¯ä»¥å°è¯•ç”¨å¦å¤–çš„æ–¹æ³•å»è§£å†³â€œçª—å£æ—¶é—´â€ï¼Œæ¯”å¦‚å…ˆåˆ†é…å’Œèµ‹å€¼æ–°çš„å†…å­˜ç©ºé—´ï¼Œå†é”€æ¯æ—§çš„ï¼š</p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">bucket_t</span> *oldCache = class-&gt;cache;</span><br><span class="line"><span class="class"><span class="keyword">class</span>-&gt;<span class="title">cache</span> = <span class="title">malloc</span>(<span class="title">newSize</span>);</span></span><br><span class="line"><span class="built_in">free</span>(oldCache);</span><br></pre></td></tr></table></figure><p>è¿™ä¹Ÿè®¸æœ‰ç‚¹ç”¨ï¼Œä½†å¹¶æ²¡æœ‰è§£å†³é—®é¢˜ã€‚å¦ä¸€ä¸ªçº¿ç¨‹ä¹Ÿå¯èƒ½å…ˆè·å–åˆ°æ—§ç¼“å­˜çš„æŒ‡é’ˆï¼Œç„¶ååœ¨è®¿é—®å†…å­˜å‰è¢«ç³»ç»Ÿä¸­æ–­ã€‚ç„¶åï¼Œæ—§çš„ç¼“å­˜è¢«é”€æ¯åï¼Œå¦å¤–çš„çº¿ç¨‹åˆé‡æ–°å¯åŠ¨ï¼Œè¿™å°±å¯¼è‡´äº†å’Œå‰é¢ä¸€æ ·çš„é—®é¢˜ã€‚</p><p>å¦‚æœæˆ‘ä»¬åŠ ä¸€ä¸ªå»¶è¿Ÿå‘¢ï¼Ÿæ¯”å¦‚è¯´ï¼š</p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">bucket_t</span> *oldCache = class-&gt;cache;</span><br><span class="line"><span class="class"><span class="keyword">class</span>-&gt;<span class="title">cache</span> = <span class="title">malloc</span>(<span class="title">newSize</span>);</span></span><br><span class="line">after(<span class="number">5</span> <span class="comment">/* seconds */</span>, ^&#123;</span><br><span class="line">    <span class="built_in">free</span>(oldCache);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>è¿™ä¼¼ä¹æ˜¯å¯è¡Œçš„ï¼Œä½†è¿˜æ˜¯å¯ä»¥æƒ³åˆ°ä¸€ç§æƒ…å†µï¼Œå°±æ˜¯ä¸€ä¸ªçº¿ç¨‹åˆšå¥½è¢«ä¸­æ–­è¶³å¤Ÿä¹…ï¼Œä»¥è‡³äºäº”ç§’çš„å»¶è¿Ÿç»“æŸäº†æ‰é‡æ–°å¯åŠ¨ã€‚è™½ç„¶è¿™æ ·çš„æƒ…å†µåŠå…¶ç½•è§ï¼Œä½†å¹¶ä¸æ˜¯æ¯«æ— å¯èƒ½ã€‚</p><p>å¦‚æœä¸æ˜¯è®¾ç½®ä¸€ä¸ªå›ºå®šçš„å»¶è¿Ÿæ—¶é—´ï¼Œè€Œæ˜¯ç¡®å®šç­‰åˆ°â€œçª—å£æ—¶é—´â€ç»“æŸå‘¢ã€‚æˆ‘ä»¬å¯ä»¥ç»™ <code>objc_msgSend</code> å‡½æ•°å¢åŠ ä¸€ä¸ªè®¡æ•°å™¨ï¼Œå°±åƒè¿™æ ·ï¼š</p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line">gInMsgSend++;</span><br><span class="line">lookUpCache(class-&gt;cache);</span><br><span class="line">gInMsgSend--;</span><br></pre></td></tr></table></figure><p>æ­£ç¡®çš„çº¿ç¨‹å®‰å…¨çš„åšæ³•éœ€è¦å¯¹è®¡æ•°å™¨ä½¿ç”¨åŸå­æ€§ï¼Œä»¥åŠä½¿ç”¨å†…å­˜å±éšœï¼Œæ¥ä¿è¯äº’ç›¸ä¾èµ–çš„ç¼“å­˜çš„è¯»å–/å­˜å‚¨æ­£ç¡®è¿›è¡Œã€‚è¿™é‡Œæˆ‘ä»¬å‡è®¾è®¡æ•°å™¨å·²ç»æ»¡è¶³è¿™äº›æ¡ä»¶ã€‚</p><p>æœ‰äº†è®¡æ•°å™¨ï¼Œé‡æ–°åˆ†é…ç¼“å­˜çš„ä»£ç å°±ä¼šåƒè¿™æ ·ï¼š</p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">bucket_t</span> *oldCache = class-&gt;cache;</span><br><span class="line"><span class="class"><span class="keyword">class</span>-&gt;<span class="title">cache</span> = <span class="title">malloc</span>(<span class="title">newSize</span>);</span></span><br><span class="line"><span class="keyword">while</span>(gInMsgSend)</span><br><span class="line">    ; <span class="comment">// spin</span></span><br><span class="line"><span class="built_in">free</span>(oldCache);</span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼Œæˆ‘ä»¬å¹¶ä¸éœ€è¦é˜»å¡ <code>objc_msgSend</code> æ‰§è¡Œï¼Œå°±èƒ½è®©è¿™æ®µä»£ç æ­£ç¡®å·¥ä½œã€‚åœ¨ç»™ç¼“å­˜çš„æŒ‡é’ˆé‡æ–°èµ‹å€¼åï¼Œä¸€æ—¦æŸä¸€æ—¶åˆ»ï¼Œç¡®è®¤æ²¡æœ‰æ–¹æ³•åœ¨è°ƒç”¨ <code>objc_msgSend</code> äº†ï¼Œå°±å¯ä»¥å°†æ—§çš„ç¼“å­˜ç©ºé—´é‡Šæ”¾ã€‚å¦ä¸€ä¸ªçº¿ç¨‹æœ‰å¯èƒ½ä¼šåœ¨æ—§ç¼“å­˜ç©ºé—´è¢«é‡Šæ”¾çš„æ—¶å€™è°ƒç”¨ <code>objc_msgSend</code> ï¼Œä½†è¿™ä¸ªæ–°çš„è°ƒç”¨ä¸ä¼šè®¿é—®åˆ°æ—§çš„ç¼“å­˜çš„æŒ‡é’ˆï¼Œå› æ­¤æ˜¯å®‰å…¨çš„ã€‚</p><p>ç„¶è€Œï¼Œè½®è¯¢æ“ä½œæ•ˆç‡è¾ƒä½ï¼Œä¸”ä¸ä¼˜é›…ã€‚äº‹å®ä¸Šï¼Œé‡Šæ”¾æ—§çš„ç¼“å­˜ç©ºé—´å¹¶ä¸æ˜¯ååˆ†è¦ç´§çš„ä¸€ä»¶äº‹ã€‚å†…å­˜èƒ½å¤Ÿæ­£ç¡®é‡Šæ”¾å½“ç„¶æ˜¯å¥½çš„ï¼Œä½†æ™šç‚¹å†é‡Šæ”¾ä¹Ÿæ²¡æœ‰ä»€ä¹ˆå¤§ä¸äº†çš„ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥ä¸ä½¿ç”¨è½®è¯¢ï¼Œè€Œæ˜¯æŒæœ‰ä¸€ä»½æœªé‡Šæ”¾çš„ç¼“å­˜çš„è®°å½•è¡¨ã€‚æ¯æ¬¡éœ€è¦é‡Šæ”¾ç¼“å­˜æ—¶ï¼Œå°±æ¸…ç©ºæ‰€æœ‰å¾…é‡Šæ”¾çš„ç¼“å­˜ï¼š</p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">bucket_t</span> *oldCache = class-&gt;cache;</span><br><span class="line"><span class="class"><span class="keyword">class</span>-&gt;<span class="title">cache</span> = <span class="title">malloc</span>(<span class="title">newSize</span>);</span></span><br><span class="line"></span><br><span class="line">append(gOldCachesList, oldCache);</span><br><span class="line"><span class="keyword">if</span>(!gInMsgSend) &#123;</span><br><span class="line">    <span class="keyword">for</span>(cache in gOldCachesList) &#123;</span><br><span class="line">        <span class="built_in">free</span>(cache);</span><br><span class="line">    &#125;</span><br><span class="line">    gOldCachesList.clear();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœä¸€æ¡æ¶ˆæ¯æ­£åœ¨ä¼ é€’çš„è¯ï¼Œé‚£è¿™é‡Œå¹¶ä¸ä¼šç«‹åˆ»æ¸…ç©ºæ—§çš„ç¼“å­˜ã€‚ä½†æ²¡å…³ç³»ï¼Œå½“ä¸‹æ¬¡æ—¶æœºæ¥ä¸´æ—¶ï¼Œæ¯”å¦‚æ¶ˆæ¯ä¼ é€’ç»“æŸæˆ–æœªæ¥çš„æŸä¸ªæ—¶é—´ç‚¹ï¼Œè¿™äº›è¿‡æœŸçš„ç¼“å­˜éƒ½ä¼šè¢«æ¸…ç©ºã€‚</p><p>è¿™ä¸ªç‰ˆæœ¬å·²ç»å¾ˆæ¥è¿‘ Objective-C runtime çš„æºç äº†ã€‚</p><h3 id="é›¶æ¶ˆè€—çš„æ ‡å¿—ä½"><a href="#é›¶æ¶ˆè€—çš„æ ‡å¿—ä½" class="headerlink" title="é›¶æ¶ˆè€—çš„æ ‡å¿—ä½"></a>é›¶æ¶ˆè€—çš„æ ‡å¿—ä½</h3><p>æ¶ˆæ¯ä¼ é€’ä¸­çš„ä¸¤éƒ¨åˆ†å­˜åœ¨ç€æ˜æ˜¾çš„ä¸åŒã€‚<code>objc_msgSend</code> å¯èƒ½æ¯ç§’é’Ÿéœ€è¦è¿è¡Œæ•°ç™¾ä¸‡æ¬¡ï¼Œå› æ­¤é€Ÿåº¦å¿…é¡»è¶³å¤Ÿå¿«ï¼Œæœ€å¥½å•æ¬¡è°ƒç”¨åªæ¶ˆè€—å‡ çº³ç§’çš„æ—¶é—´ã€‚ç„¶è€Œï¼Œé‡æ–°åˆ†é…ç¼“å­˜å´æ˜¯ä¸ªæ¯”è¾ƒä¸é¢‘ç¹çš„æ“ä½œï¼Œè€Œä¸”éšç€åº”ç”¨çš„æŒç»­è¿è¡Œï¼Œè¯¥æ“ä½œä¹Ÿä¼šå˜å¾—è¶Šæ¥è¶Šå°‘ã€‚ä¸€æ—¦åº”ç”¨è¾¾åˆ°ä¸€ä¸ªç¨³å®šçŠ¶æ€ï¼Œä¸å†åŠ è½½æ–°çš„ä»£ç ï¼Œä¸å†ä¿®æ”¹æ¶ˆæ¯åˆ—è¡¨ï¼Œè¿™æ—¶ç¼“å­˜ä¹Ÿå°±è¾¾åˆ°äº†å®ƒä»¬æ‰€éœ€çš„æœ€å¤§å®¹é‡ï¼Œå†ä¹Ÿä¸éœ€è¦é‡æ–°åˆ†é…ç¼“å­˜äº†ã€‚åœ¨è¿™ä¹‹å‰ï¼Œå¯èƒ½ä¼šå‘ç”Ÿæˆç™¾ä¸Šåƒæ¬¡çš„ç¼“å­˜çš„é‡æ–°åˆ†é…ï¼Œä½†ç›¸æ¯”äº <code>objc_msgSend</code> æ¥è¯´ï¼Œè°ƒç”¨æ¬¡æ•°è¿˜æ˜¯å¾ˆå°‘ï¼Œå› æ­¤å¯¹æ€§èƒ½çš„è¦æ±‚ä¹Ÿå¾ˆä½ã€‚</p><p>å› æ­¤ï¼Œåº”å½“å°½å¯èƒ½å°‘çš„å»å¹²é¢„æ¶ˆæ¯ä¼ é€’çš„è¿‡ç¨‹ï¼Œå°½ç®¡è¿™æ ·ä¼šè®©ç¼“å­˜é‡Šæ”¾çš„è¿‡ç¨‹å˜æ…¢ã€‚å¦‚æœåœ¨ <code>objc_msgSend</code> é˜¶æ®µèƒ½å‡å°‘ä¸€ä¸ª CPU å‘¨æœŸï¼Œé‚£ä¹ˆå³ä½¿æ¯æ¬¡ç¼“å­˜é‡Šæ”¾æ“ä½œéƒ½ä¼šæ¶ˆè€—ä¸€ç™¾ä¸‡ä¸ª CPU å‘¨æœŸï¼Œé‚£ä¹Ÿèƒ½æå¤§æé«˜æ•ˆç‡ã€‚</p><p>è¿™ä¹ˆè¯´æ¥ï¼Œå“ªæ€•è®¾ç½®ä¸€ä¸ªå…¨å±€çš„è®¡æ•°å™¨ï¼Œæ€§èƒ½æŸè€—çš„ä»£ä»·è¿˜æ˜¯å¤ªé«˜ã€‚é‚£æ„å‘³ç€ <code>objc_msgSend</code> è¿‡ç¨‹ä¸­éœ€è¦å¢åŠ ä¸¤æ¬¡å†…å­˜è®¿é—®ï¼Œä»è€Œå¢åŠ å¾ˆå¤šæ€§èƒ½å¼€é”€ã€‚è€Œéœ€è¦ä½¿ç”¨åŸå­æ€§ä»¥åŠå†…å­˜å±éšœåªä¼šè®©è¿™å˜å¾—æ›´ç³Ÿã€‚å¹¸è¿çš„æ˜¯ï¼ŒObjective-C runtime èƒ½å¤Ÿå°† <code>objc_msgSend</code> çš„æ€§èƒ½æŸè€—é™åˆ°é›¶ï¼Œä»£ä»·æ˜¯ä¼šè®©ç¼“å­˜é‡Šæ”¾çš„è¿‡ç¨‹å˜å¾—æ…¢å¾ˆå¤šã€‚</p><p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬è®¾ç½®å…¨å±€è®¡æ•°å™¨çš„ç›®çš„æ˜¯è¿½è¸ªæ˜¯å¦æœ‰çº¿ç¨‹å¤„äºæ¶ˆæ¯ä¼ é€’çš„è¿‡ç¨‹ä¸­ã€‚äº‹å®ä¸Šï¼Œçº¿ç¨‹æœ¬èº«çŸ¥é“è‡ªå·±æ­£åœ¨è¿è¡Œä»€ä¹ˆä»£ç ï¼šç¨‹åºè®¡æ•°å™¨ã€‚è¿™æ˜¯ä¸€ä¸ªè®°å½•å½“å‰æŒ‡ä»¤çš„å†…å­˜åœ°å€çš„ CPU å¯„å­˜å™¨ã€‚æˆ‘ä»¬å¯ä»¥ç”¨å®ƒæ¥ä»£æ›¿å…¨å±€çš„è®¡æ•°å™¨ï¼Œæ¥æ£€æŸ¥æ¯ä¸ªçº¿ç¨‹æ˜¯å¦å¤„äº <code>objc_msgSend</code> å½“ä¸­ã€‚å¦‚æœæ‰€æœ‰çº¿ç¨‹éƒ½ä¸å¤„äº <code>objc_msgSend</code> ä¸­ï¼Œé‚£ä¹ˆæ—§çš„ç¼“å­˜å°±å¯ä»¥è¢«å®‰å…¨é‡Šæ”¾ã€‚è¿™ç§æ–¹æ³•çš„å®ç°å¦‚ä¸‹ï¼š</p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="function">BOOL <span class="title">ThreadsInMsgSend</span><span class="params">(<span class="keyword">void</span>)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(thread in GetAllThreads()) &#123;</span><br><span class="line">        <span class="keyword">uintptr_t</span> pc = thread.GetPC();</span><br><span class="line">        <span class="keyword">if</span>(pc &gt;= objc_msgSend_startAddress &amp;&amp; pc &lt;= objc_msgSend_endAddress) &#123;</span><br><span class="line">            <span class="keyword">return</span> YES;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> NO;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">bucket_t</span> *oldCache = class-&gt;cache;</span><br><span class="line"><span class="class"><span class="keyword">class</span>-&gt;<span class="title">cache</span> = <span class="title">malloc</span>(<span class="title">newSize</span>);</span></span><br><span class="line"></span><br><span class="line">append(gOldCachesList, oldCache);</span><br><span class="line"><span class="keyword">if</span>(!ThreadsInMsgSend()) &#123;</span><br><span class="line">    <span class="keyword">for</span>(cache in gOldCachesList) &#123;</span><br><span class="line">        <span class="built_in">free</span>(cache);</span><br><span class="line">    &#125;</span><br><span class="line">    gOldCachesList.clear();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>objc_msgSend</code> å¹¶ä¸éœ€è¦é¢å¤–åšä»»ä½•äº‹æƒ…ï¼Œå®ƒå¯ä»¥ä¸ç”¨è€ƒè™‘è®¾ç½®æ ‡å¿—ä½ï¼Œç›´æ¥è®¿é—®ç¼“å­˜ï¼š</p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line">lookUpCache(class-&gt;cache);</span><br></pre></td></tr></table></figure><p>ç¼“å­˜é‡Šæ”¾çš„ä»£ç æ•ˆç‡å¾ˆä½ï¼Œå› ä¸ºå®ƒéœ€è¦æ£€æŸ¥è¿›ç¨‹ä¸­æ‰€æœ‰çº¿ç¨‹çš„çŠ¶æ€ã€‚ä½†è¿™æ · <code>objc_msgSend</code> å¯ä»¥åšåˆ°ä¸å•çº¿ç¨‹ç¯å¢ƒä¸­åŒæ ·é«˜çš„æ•ˆç‡ï¼Œè¿™æ˜¯ä¸€ä¸ªå€¼å¾—ä»˜å‡ºçš„ä»£ä»·ã€‚è¿™å°±æ˜¯ Apple çš„ runtime æºç å®ç°æ–¹å¼ã€‚</p><h3 id="çœŸå®ä»£ç "><a href="#çœŸå®ä»£ç " class="headerlink" title="çœŸå®ä»£ç "></a>çœŸå®ä»£ç </h3><p>å…·ä½“çš„å®ç°å¯ä»¥æŸ¥çœ‹ runtime æºç  <a href="https://opensource.apple.com/source/objc4/objc4-646/runtime/objc-cache.mm" target="_blank" rel="noopener">objc-cache.mm</a> ä¸­çš„ <code>_collecting_in_critical</code> å‡½æ•°ã€‚</p><p>éœ€è¦ä½¿ç”¨ç¨‹åºè®¡æ•°å™¨çš„å…¥å£å’Œå‡ºå£ä½ç½®è¢«å‚¨å­˜åœ¨å…¨å±€å˜é‡ä¸­ï¼š</p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line">OBJC_EXPORT <span class="keyword">uintptr_t</span> objc_entryPoints[];</span><br><span class="line">OBJC_EXPORT <span class="keyword">uintptr_t</span> objc_exitPoints[];</span><br></pre></td></tr></table></figure><p>äº‹å®ä¸Šï¼Œ<code>objc_msgSend</code> æœ‰å¤šç§å®ç°æ–¹å¼ï¼ˆæ¯”å¦‚è¿”å› struct ç±»å‹ï¼‰ï¼Œå†…éƒ¨çš„ <code>cache_getImp</code> ä¹Ÿä¼šç›´æ¥è®¿é—®ç¼“å­˜ã€‚è¿™äº›éƒ½éœ€è¦åœ¨ç¼“å­˜é‡Šæ”¾çš„æ—¶å€™è¢«æ£€æŸ¥ã€‚</p><p><code>_collecting_in_critical</code> å‡½æ•°æ²¡æœ‰å…¥å‚ï¼Œè¿”å›ä¸€ä¸ª <code>int</code> ç±»å‹ï¼Œè¢«å½“åšä¸€ä¸ªå¸ƒå°”ç±»å‹çš„æ ‡å¿—ä½ï¼ŒæŒ‡æ˜æ˜¯å¦æœ‰çº¿ç¨‹å¤„äºå…³é”®çš„å‡½æ•°ä¸­ï¼š</p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">int</span> _collecting_in_critical(<span class="keyword">void</span>)</span><br><span class="line">&#123;</span><br></pre></td></tr></table></figure><p>æˆ‘ä¼šè·³è¿‡è¯¥å‡½æ•°ä¸­ä¸é‡è¦çš„éƒ¨åˆ†ï¼Œåªä»‹ç»æœ€å…³é”®çš„éƒ¨åˆ†ã€‚å¦‚æœä½ æƒ³é˜…è¯»å®Œæ•´ä»£ç ï¼Œå¯ä»¥æŸ¥çœ‹ <a href="https://opensource.apple.com/source/objc4/objc4-646/runtime/objc-cache.mm" target="_blank" rel="noopener">opensource.apple.com</a>ã€‚</p><p>è·å–çº¿ç¨‹ä¿¡æ¯çš„ API å¤„äº mach å±‚ã€‚<code>task_threads</code> èƒ½å¤Ÿè·å–åˆ°æŒ‡å®šä»»åŠ¡ï¼ˆè¿›ç¨‹åœ¨ mach ä¸­çš„è¡¨ç¤ºï¼‰ä¸­çš„æ‰€æœ‰çº¿ç¨‹ï¼Œè¿™é‡Œç”¨å®ƒæ¥è·å–å½“å‰è¿›ç¨‹ä¸­çš„çº¿ç¨‹ï¼š</p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line">ret = task_threads(mach_task_self(), &amp;threads, &amp;number);</span><br></pre></td></tr></table></figure><p>å‡½æ•°ä¼šåœ¨ <code>threads</code> ä¸­ä¿å­˜ <code>thread_t</code> æ•°ç»„ï¼Œåœ¨ <code>number</code> ä¸­ä¿å­˜çº¿ç¨‹çš„æ•°é‡ã€‚ç„¶åä¼šéå†æ‰€æœ‰çº¿ç¨‹ï¼š</p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> (count = <span class="number">0</span>; count &lt; number; count++)</span><br><span class="line">&#123;</span><br></pre></td></tr></table></figure><p>è·å–ä¸€ä¸ªçº¿ç¨‹çš„ç¨‹åºè®¡æ•°å™¨æ˜¯åœ¨å¦å¤–ä¸€ä¸ªå•ç‹¬çš„å‡½æ•°ä¸­ï¼š</p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line">pc = _get_pc_for_thread (threads[count]);</span><br></pre></td></tr></table></figure><p>ç„¶åï¼Œç¨‹åºä¼šéå†æ‰€æœ‰çš„å…¥å£å’Œå‡ºå£ï¼Œå¹¶é€ä¸ªè¿›è¡Œåˆ¤æ–­ï¼š</p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line">    <span class="keyword">for</span> (region = <span class="number">0</span>; objc_entryPoints[region] != <span class="number">0</span>; region++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> ((pc &gt;= objc_entryPoints[region]) &amp;&amp;</span><br><span class="line">            (pc &lt;= objc_exitPoints[region])) </span><br><span class="line">        &#123;</span><br><span class="line">            result = TRUE;</span><br><span class="line">            <span class="keyword">goto</span> done;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>éå†ç»“æŸåï¼Œå°†ç»“æœè¿”å›ç»™è°ƒç”¨è€…ï¼š</p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>_get_pc_for_thread</code> å‡½æ•°æ˜¯æ€ä¹ˆå·¥ä½œçš„å‘¢ï¼Ÿå®ƒåªæ˜¯ç®€å•åœ°è°ƒç”¨ <code>thread_get_state</code> å‡½æ•°æ¥è·å¾—ç›®æ ‡çº¿ç¨‹çš„å¯„å­˜å™¨çŠ¶æ€ã€‚ä¹‹æ‰€ä»¥è¦æ”¾åˆ°ä¸€ä¸ªå•ç‹¬çš„å‡½æ•°ä¸­ï¼Œæ˜¯å› ä¸ºå¯„å­˜å™¨çŠ¶æ€çš„ç»“æ„ä½“æ˜¯ä¸å…·ä½“æ¶æ„ç›¸å…³çš„ï¼Œä¸åŒæ¶æ„éƒ½æœ‰ä¸åŒçš„å¯„å­˜å™¨ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™ä¸ªå‡½æ•°éœ€è¦å¯¹æ¯ä¸ªæ”¯æŒçš„æ¶æ„æœ‰ä¸€å¥—å•ç‹¬çš„å®ç°ï¼Œå°½ç®¡è¿™äº›å®ç°å·®åˆ«ä¸å¤§ã€‚ä¸‹é¢æ˜¯ x86-64 ä¸‹çš„å®ç°ï¼š</p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">uintptr_t</span> _get_pc_for_thread(<span class="keyword">thread_t</span> thread)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">x86_thread_state64_t</span>            state;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> count = x86_THREAD_STATE64_COUNT;</span><br><span class="line">    <span class="keyword">kern_return_t</span> okay = thread_get_state (thread, x86_THREAD_STATE64, (<span class="keyword">thread_state_t</span>)&amp;state, &amp;count);</span><br><span class="line">    <span class="keyword">return</span> (okay == KERN_SUCCESS) ? state.__rip : PC_SENTINEL;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>rip æ˜¯ x86-64 ä¸‹ç¨‹åºè®¡æ•°å™¨çš„å¯„å­˜å™¨åå­—ã€‚â€œRâ€ä»£è¡¨â€œregisterâ€ï¼Œâ€œIPâ€ä»£è¡¨â€œinstruction pointerâ€ã€‚</p><p>ä¸Šé¢æ‰€è¯´çš„å…¥å£å’Œå‡ºå£çš„ä»£ç ä½ç½®ï¼Œä¸å…¶å‡½æ•°ä¸€åŒå®šä¹‰åœ¨æ±‡ç¼–æ–‡ä»¶ä¸­ï¼š</p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line">.private_extern _objc_entryPoints</span><br><span class="line">_objc_entryPoints:</span><br><span class="line">    .quad   _cache_getImp</span><br><span class="line">    .quad   _objc_msgSend</span><br><span class="line">    .quad   _objc_msgSend_fpret</span><br><span class="line">    .quad   _objc_msgSend_fp2ret</span><br><span class="line">    .quad   _objc_msgSend_stret</span><br><span class="line">    .quad   _objc_msgSendSuper</span><br><span class="line">    .quad   _objc_msgSendSuper_stret</span><br><span class="line">    .quad   _objc_msgSendSuper2</span><br><span class="line">    .quad   _objc_msgSendSuper2_stret</span><br><span class="line">    .quad   <span class="number">0</span></span><br><span class="line"></span><br><span class="line">.private_extern _objc_exitPoints</span><br><span class="line">_objc_exitPoints:</span><br><span class="line">    .quad   LExit_cache_getImp</span><br><span class="line">    .quad   LExit_objc_msgSend</span><br><span class="line">    .quad   LExit_objc_msgSend_fpret</span><br><span class="line">    .quad   LExit_objc_msgSend_fp2ret</span><br><span class="line">    .quad   LExit_objc_msgSend_stret</span><br><span class="line">    .quad   LExit_objc_msgSendSuper</span><br><span class="line">    .quad   LExit_objc_msgSendSuper_stret</span><br><span class="line">    .quad   LExit_objc_msgSendSuper2</span><br><span class="line">    .quad   LExit_objc_msgSendSuper2_stret</span><br><span class="line">    .quad   <span class="number">0</span></span><br></pre></td></tr></table></figure><p><code>_collecting_in_critical</code> çš„ç”¨æ³•å’Œä¸Šé¢æˆ‘ä»¬å‡è®¾çš„ä¾‹å­å¾ˆç›¸ä¼¼ã€‚å®ƒåœ¨é‡Šæ”¾ç¼“å­˜ä¹‹å‰è¢«è°ƒç”¨ã€‚äº‹å®ä¸Šï¼Œruntime æœ‰ä¸¤ç§å·¥ä½œæ¨¡å¼ï¼šä¸€ç§æ˜¯å¦‚æœå…¶ä»–çº¿ç¨‹æ­£åœ¨è°ƒç”¨ç›¸å…³å‡½æ•°çš„è¯ï¼Œå°±æŠŠåƒåœ¾å†…å­˜çš„æ¸…ç†å·¥ä½œç•™åˆ°ä¸‹ä¸€æ¬¡è°ƒç”¨ï¼›å¦ä¸€ç§æ˜¯ä¸€ç›´è½®è¯¢ï¼Œç›´åˆ°ç¡®è®¤æ²¡æœ‰çº¿ç¨‹æ­£åœ¨è°ƒç”¨ï¼Œç„¶åå†è¿›è¡Œé”€æ¯ï¼š</p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Synchronize collection with objc_msgSend and other cache readers</span></span><br><span class="line"><span class="keyword">if</span> (!collectALot) &#123;</span><br><span class="line">    <span class="keyword">if</span> (_collecting_in_critical ()) &#123;</span><br><span class="line">        <span class="comment">// objc_msgSend (or other cache reader) is currently looking in</span></span><br><span class="line">        <span class="comment">// the cache and might still be using some garbage.</span></span><br><span class="line">        <span class="keyword">if</span> (PrintCaches) &#123;</span><br><span class="line">            _objc_inform (<span class="string">"CACHES: not collecting; "</span></span><br><span class="line">                          <span class="string">"objc_msgSend in progress"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; </span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// No excuses.</span></span><br><span class="line">    <span class="keyword">while</span> (_collecting_in_critical()) </span><br><span class="line">        ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// free garbage here</span></span><br></pre></td></tr></table></figure><p>ç¬¬ä¸€ç§å°†åƒåœ¾å†…å­˜ç•™åˆ°ä¸‹ä¸€æ¬¡è°ƒç”¨æ—¶æ¸…ç†çš„æ¨¡å¼ï¼Œæ˜¯åœ¨æ­£å¸¸çš„é‡æ–°åˆ†é…ç¼“å­˜å¤§å°æ—¶é‡‡ç”¨ï¼›ç¬¬äºŒç§å§‹ç»ˆæ¸…ç†åƒåœ¾å†…å­˜çš„æ¨¡å¼ï¼Œæ˜¯åœ¨éœ€è¦åˆ·æ–°æ‰€æœ‰ç±»çš„æ‰€æœ‰ç¼“å­˜æ—¶ä½¿ç”¨ï¼Œå› ä¸ºè¿™æ ·å¾€å¾€ä¼šäº§ç”Ÿå¤§é‡çš„åƒåœ¾å†…å­˜ã€‚ä»¥æˆ‘é˜…è¯»ä»£ç æ¥çœ‹ï¼Œè¿™ç§æƒ…å†µåªä¼šåœ¨å¼€å¯ä¸€é¡¹æ—¥å¿—è°ƒè¯•åŠŸèƒ½æ—¶å‘ç”Ÿã€‚æ—¥å¿—è°ƒè¯•ä¼šå°†æ‰€æœ‰çš„æ¶ˆæ¯å‘é€è®°å½•åˆ°æ–‡ä»¶ä¸­ï¼Œæ¶ˆæ¯ç¼“å­˜ä¼šå½±å“è¿™ä¸€æ—¥å¿—ï¼Œå› æ­¤éœ€è¦å…¨éƒ¨åˆ·æ–°ã€‚</p><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>æ€§èƒ½å’Œçº¿ç¨‹å®‰å…¨ç»å¸¸ä¼šäº’ç›¸å†²çªã€‚ä¸åŒéƒ¨åˆ†çš„ä»£ç å¯¹åŒä¸€å—å†…å­˜çš„è®¿é—®æ–¹å¼å¾€å¾€ä¸åŒï¼Œä¹Ÿå°±å…è®¸æˆ‘ä»¬ä»¥æ›´åŠ æœ‰æ•ˆç‡çš„æ–¹å¼æ¥å®ç°çº¿ç¨‹å®‰å…¨ã€‚æ–¹å¼ä¹‹ä¸€æ˜¯ç”¨ä¸€ä¸ªå…¨å±€æ ‡å¿—ä½æˆ–è€…è®¡æ•°å™¨æ¥æŒ‡æ˜å¯¹å†…å­˜çš„æ”¹åŠ¨æ“ä½œæ˜¯å¦å®‰å…¨ã€‚åœ¨ Objective-C runtime ä¸­ï¼ŒApple æ›´è¿›ä¸€æ­¥ï¼Œä½¿ç”¨äº†å„ä¸ªçº¿ç¨‹çš„ç¨‹åºè®¡æ•°å™¨æ¥åˆ¤æ–­çº¿ç¨‹æ˜¯å¦æ­£åœ¨è¿›è¡Œä¸å®‰å…¨çš„æ“ä½œã€‚è¿™æ˜¯ä¸€ä¸ªå¾ˆä¸“ä¸šçš„æ¡ˆä¾‹ï¼Œè¿™ç§åšæ³•æƒ³è¦ç”¨åˆ°å…¶ä»–åœ°æ–¹ä¹Ÿä¸æ˜¯å¾ˆæœ‰ç”¨ï¼Œä½†ç ”ç©¶å®ƒçš„åŸç†æœ¬èº«å°±æ˜¯ä¸€ä»¶å¾ˆæœ‰æ„æ€çš„äº‹æƒ…ã€‚</p><blockquote><p>æœ¬æ–‡ç”± SwiftGG ç¿»è¯‘ç»„ç¿»è¯‘ï¼Œå·²ç»è·å¾—ä½œè€…ç¿»è¯‘æˆæƒï¼Œæœ€æ–°æ–‡ç« è¯·è®¿é—® <a href="http://swift.gg">http://swift.gg</a>ã€‚</p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;ä½œè€…ï¼šMike Ashï¼Œ&lt;a href=&quot;https://www.mikeash.com/pyblog/friday-qa-2015-05-29-concurrent-memory-deallocation-in-the-objective-c-runtime.html&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;åŸæ–‡é“¾æ¥&lt;/a&gt;ï¼ŒåŸæ–‡æ—¥æœŸï¼š2015-06-05&lt;br&gt;è¯‘è€…ï¼š&lt;a href=&quot;https://github.com/YangGao1991&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;é˜³ä»”&lt;/a&gt;ï¼›æ ¡å¯¹ï¼š&lt;a href=&quot;http://numbbbbb.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;numbbbbb&lt;/a&gt;ï¼Œ&lt;a href=&quot;https://weibo.com/1743643682/profile?topnav=1&amp;amp;wvr=6&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;liberalism&lt;/a&gt;ï¼›å®šç¨¿ï¼š&lt;a href=&quot;https://github.com/chenmingbiao&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;CMB&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;!--æ­¤å¤„å¼€å§‹æ­£æ–‡--&gt;
&lt;p&gt;Objective-C Runtime æ˜¯ç»å¤§å¤šæ•° Mac å’Œ iOS ç¨‹åºä»£ç çš„æ ¸å¿ƒã€‚Runtime çš„æ ¸å¿ƒå°±æ˜¯ &lt;code&gt;objc_msgSend&lt;/code&gt; å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°æœ€å…³é”®çš„å°±æ˜¯æ–¹æ³•ç¼“å­˜ã€‚æˆ‘åœ¨è¿™ç¯‡æ–‡ç« ä¸­å°†ä¼šé˜è¿°ä¸€ä¸‹ï¼ŒApple æ˜¯å¦‚ä½•åœ¨ä¸å½±å“æ€§èƒ½çš„æƒ…å†µä¸‹ï¼Œä»¥çº¿ç¨‹å®‰å…¨çš„æ–¹å¼æ¥é‡æ–°åˆ†é…ç¼“å­˜å¤§å°ã€é‡Šæ”¾æ–¹æ³•ç¼“å­˜ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="Mike Ash" scheme="https://swift.gg/categories/Mike-Ash/"/>
    
    
      <category term="iOS å¼€å‘" scheme="https://swift.gg/tags/iOS-%E5%BC%80%E5%8F%91/"/>
    
  </entry>
  
  <entry>
    <title>Swift ä¸­çš„é”å’Œçº¿ç¨‹å®‰å…¨</title>
    <link href="https://swift.gg/2018/06/07/friday-qa-2015-02-06-locks-thread-safety-and-swift/"/>
    <id>https://swift.gg/2018/06/07/friday-qa-2015-02-06-locks-thread-safety-and-swift/</id>
    <published>2018-06-07T00:00:00.000Z</published>
    <updated>2018-09-10T03:53:25.081Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ä½œè€…ï¼šMike Ashï¼Œ<a href="https://www.mikeash.com/pyblog/friday-qa-2015-02-06-locks-thread-safety-and-swift.html" target="_blank" rel="noopener">åŸæ–‡é“¾æ¥</a>ï¼ŒåŸæ–‡æ—¥æœŸï¼š2015-02-06<br>è¯‘è€…ï¼š<a href="undefined">Lefe_x</a>ï¼›æ ¡å¯¹ï¼š<a href="http://numbbbbb.com/" target="_blank" rel="noopener">numbbbbb</a>ï¼Œ<a href="http://blog.yousanflics.com.cn" target="_blank" rel="noopener">Yousanflics</a>ï¼Œ<a href="https://weibo.com/1743643682/profile?topnav=1&amp;wvr=6" target="_blank" rel="noopener">liberalism</a>ï¼›å®šç¨¿ï¼š<a href="https://github.com/chenmingbiao" target="_blank" rel="noopener">CMB</a></p></blockquote><!--æ­¤å¤„å¼€å§‹æ­£æ–‡--><p>åœ¨ Swift ä¸­æœ‰ä¸ªæœ‰è¶£çš„ç°è±¡ï¼šå®ƒæ²¡æœ‰ä¸çº¿ç¨‹ç›¸å…³çš„è¯­æ³•ï¼Œä¹Ÿæ²¡æœ‰æ˜ç¡®çš„äº’æ–¥é”/é”ï¼ˆ<code>mutexes/locks</code>ï¼‰æ¦‚å¿µï¼Œç”šè‡³ Objective-C ä¸­æœ‰çš„ <code>@synchronized</code> å’ŒåŸå­å±æ€§å®ƒéƒ½æ²¡æœ‰ã€‚å¹¸è¿çš„æ˜¯ï¼Œè‹¹æœç³»ç»Ÿçš„ API å¯ä»¥éå¸¸å®¹æ˜“åœ°åº”ç”¨åˆ° Swift ä¸­ã€‚ä»Šå¤©ï¼Œæˆ‘ä¼šä»‹ç»è¿™äº› API çš„ç”¨æ³•ä»¥åŠä» Objective-C è¿‡æ¸¡çš„ä¸€äº›é—®é¢˜ï¼Œè¿™äº›çµæ„Ÿéƒ½æ¥æºäº Cameron Pulsfordã€‚</p><a id="more"></a><h2 id="å¿«é€Ÿå›é¡¾ä¸€ä¸‹é”"><a href="#å¿«é€Ÿå›é¡¾ä¸€ä¸‹é”" class="headerlink" title="å¿«é€Ÿå›é¡¾ä¸€ä¸‹é”"></a>å¿«é€Ÿå›é¡¾ä¸€ä¸‹é”</h2><p>é”ï¼ˆ<code>lock</code>ï¼‰æˆ–è€…äº’æ–¥é”ï¼ˆ<code>mutex</code>ï¼‰æ˜¯ä¸€ç§ç»“æ„ï¼Œç”¨æ¥ä¿è¯ä¸€æ®µä»£ç åœ¨åŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œã€‚å®ƒä»¬é€šå¸¸è¢«ç”¨æ¥ä¿è¯å¤šçº¿ç¨‹è®¿é—®åŒä¸€å¯å˜æ•°æ®ç»“æ„æ—¶çš„æ•°æ®ä¸€è‡´æ€§ã€‚ä¸»è¦æœ‰ä¸‹é¢å‡ ç§é”ï¼š</p><ul><li>é˜»å¡é”ï¼ˆ<code>Blocking locks</code>ï¼‰ï¼šå¸¸è§çš„è¡¨ç°å½¢å¼æ˜¯å½“å‰çº¿ç¨‹ä¼šè¿›å…¥ä¼‘çœ ï¼Œç›´åˆ°è¢«å…¶ä»–çº¿ç¨‹é‡Šæ”¾ã€‚</li><li>è‡ªæ—‹é”ï¼ˆ<code>Spinlocks</code>ï¼‰ï¼šä½¿ç”¨ä¸€ä¸ªå¾ªç¯ä¸æ–­åœ°æ£€æŸ¥é”æ˜¯å¦è¢«é‡Šæ”¾ã€‚å¦‚æœç­‰å¾…æƒ…å†µå¾ˆå°‘è¯è¿™ç§é”æ˜¯éå¸¸é«˜æ•ˆçš„ï¼Œç›¸åï¼Œç­‰å¾…æƒ…å†µéå¸¸å¤šçš„æƒ…å†µä¸‹ä¼šæµªè´¹ CPU æ—¶é—´ã€‚</li><li>è¯»å†™é”ï¼ˆ<code>Reader/writer locks</code>ï¼‰ï¼šå…è®¸å¤šä¸ªè¯»çº¿ç¨‹åŒæ—¶è¿›å…¥ä¸€æ®µä»£ç ï¼Œä½†å½“å†™çº¿ç¨‹è·å–é”æ—¶ï¼Œå…¶ä»–çº¿ç¨‹ï¼ˆåŒ…æ‹¬è¯»å–å™¨ï¼‰åªèƒ½ç­‰å¾…ã€‚è¿™æ˜¯éå¸¸æœ‰ç”¨çš„ï¼Œå› ä¸ºå¤§å¤šæ•°æ•°æ®ç»“æ„è¯»å–æ—¶æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œä½†å½“å…¶ä»–çº¿ç¨‹è¾¹è¯»è¾¹å†™æ—¶å°±ä¸å®‰å…¨äº†ã€‚</li><li>é€’å½’é”ï¼ˆ<code>Recursive locks</code>ï¼‰ï¼šå…è®¸å•ä¸ªçº¿ç¨‹å¤šæ¬¡è·å–ç›¸åŒçš„é”ã€‚éé€’å½’é”è¢«åŒä¸€çº¿ç¨‹é‡å¤è·å–æ—¶å¯èƒ½ä¼šå¯¼è‡´æ­»é”ã€å´©æºƒæˆ–å…¶ä»–é”™è¯¯è¡Œä¸ºã€‚</li></ul><h2 id="APIs"><a href="#APIs" class="headerlink" title="APIs"></a>APIs</h2><p>è‹¹æœæä¾›äº†ä¸€ç³»åˆ—ä¸åŒçš„é” APIï¼Œä¸‹é¢åˆ—å‡ºäº†å…¶ä¸­ä¸€äº›ï¼š </p><ul><li><code>pthread_mutex_t</code></li><li><code>pthread_rwlock_t</code></li><li><code>dispatch_queue_t</code></li><li><code>NSOperationQueue</code> å½“é…ç½®ä¸º <code>serial</code> æ—¶</li><li><code>NSLock</code></li><li><code>OSSpinLock</code></li></ul><p>é™¤æ­¤ä¹‹å¤–ï¼ŒObjective-C æä¾›äº† <code>@synchronized</code> è¯­æ³•ç»“æ„ï¼Œå®ƒå…¶å®å°±æ˜¯å°è£…äº† <code>pthread_mutex_t</code> ã€‚ä¸å…¶ä»– API ä¸åŒçš„æ˜¯ï¼Œ<code>@synchronized</code> å¹¶æœªä½¿ç”¨ä¸“é—¨çš„é”å¯¹è±¡ï¼Œå®ƒå¯ä»¥å°†ä»»æ„ Objective-C å¯¹è±¡è§†ä¸ºé”ã€‚<code>@synchronized(someObject)</code> åŒºåŸŸä¼šé˜»æ­¢å…¶ä»– <code>@synchronized(someObject)</code> åŒºåŸŸè®¿é—®åŒä¸€å¯¹è±¡æŒ‡é’ˆã€‚ä¸åŒçš„ API æœ‰ä¸åŒçš„è¡Œä¸ºå’Œèƒ½åŠ›ï¼š </p><ul><li><code>pthread_mutex_t</code> æ˜¯ä¸€ä¸ªå¯é€‰æ‹©æ€§åœ°é…ç½®ä¸ºé€’å½’é”çš„é˜»å¡é”ï¼›</li><li><code>pthread_rwlock_t</code> æ˜¯ä¸€ä¸ªé˜»å¡è¯»å†™é”ï¼›</li><li><code>dispatch_queue_t</code> å¯ä»¥ç”¨ä½œé˜»å¡é”ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ä½¿ç”¨ barrier block é…ç½®ä¸€ä¸ªåŒæ­¥é˜Ÿåˆ—ä½œä¸ºè¯»å†™é”ï¼Œè¿˜æ”¯æŒå¼‚æ­¥æ‰§è¡ŒåŠ é”ä»£ç ï¼›</li><li><code>NSOperationQueue</code> å¯ä»¥ç”¨ä½œé˜»å¡é”ã€‚ä¸ <code>dispatch_queue_t</code> ä¸€æ ·ï¼Œæ”¯æŒå¼‚æ­¥æ‰§è¡ŒåŠ é”ä»£ç ã€‚</li><li><code>NSLock</code> æ˜¯ Objective-C ç±»çš„é˜»å¡é”ï¼Œå®ƒçš„åŒä¼´ç±» <code>NSRecursiveLock</code> æ˜¯é€’å½’é”ã€‚</li><li><code>OSSpinLock</code> é¡¾åæ€ä¹‰ï¼Œæ˜¯ä¸€ä¸ªè‡ªæ—‹é”ã€‚</li></ul><p>æœ€åï¼Œ<code>@synchronized</code> æ˜¯ä¸€ä¸ªé˜»å¡é€’å½’é”ã€‚</p><h3 id="å€¼ç±»å‹"><a href="#å€¼ç±»å‹" class="headerlink" title="å€¼ç±»å‹"></a>å€¼ç±»å‹</h3><p>æ³¨æ„ï¼Œ<code>pthread_mutex_t</code>ï¼Œ<code>pthread_rwlock_t</code> å’Œ <code>OSSpinLock</code> æ˜¯å€¼ç±»å‹ï¼Œè€Œä¸æ˜¯å¼•ç”¨ç±»å‹ã€‚è¿™æ„å‘³ç€å¦‚æœä½ ç”¨ <code>=</code> è¿›è¡Œèµ‹å€¼æ“ä½œï¼Œå®é™…ä¸Šä¼šå¤åˆ¶ä¸€ä¸ªå‰¯æœ¬ã€‚è¿™ä¼šé€ æˆä¸¥é‡çš„åæœï¼Œå› ä¸ºè¿™äº›ç±»å‹æ— æ³•å¤åˆ¶ï¼å¦‚æœä½ ä¸å°å¿ƒå¤åˆ¶äº†å®ƒä»¬ä¸­çš„ä»»æ„ä¸€ä¸ªï¼Œè¿™ä¸ªå‰¯æœ¬æ— æ³•ä½¿ç”¨ï¼Œå¦‚æœä½¿ç”¨å¯èƒ½ä¼šç›´æ¥å´©æºƒã€‚è¿™äº›ç±»å‹çš„ <code>pthread</code> å‡½æ•°ä¼šå‡å®šå®ƒä»¬çš„å†…å­˜åœ°å€ä¸åˆå§‹åŒ–æ—¶ä¸€æ ·ï¼Œå› æ­¤å¦‚æœå°†å®ƒä»¬ç§»åŠ¨åˆ°å…¶ä»–åœ°æ–¹å°±å¯èƒ½ä¼šå‡ºé—®é¢˜ã€‚<code>OSSpinLock</code> ä¸ä¼šå´©æºƒï¼Œä½†å¤åˆ¶æ“ä½œä¼šç”Ÿæˆä¸€ä¸ªå®Œå…¨ç‹¬ç«‹çš„é”ï¼Œè¿™ä¸æ˜¯ä½ æƒ³è¦çš„ã€‚</p><p>å¦‚æœä½¿ç”¨è¿™äº›ç±»å‹ï¼Œå°±å¿…é¡»æ³¨æ„ä¸è¦å»å¤åˆ¶å®ƒä»¬ï¼Œæ— è®ºæ˜¯æ˜¾å¼çš„ä½¿ç”¨ <code>=</code> æ“ä½œç¬¦è¿˜æ˜¯éšå¼åœ°æ“ä½œã€‚<br>ä¾‹å¦‚ï¼Œå°†å®ƒä»¬åµŒå…¥åˆ°ç»“æ„ä¸­æˆ–åœ¨é—­åŒ…ä¸­æ•è·å®ƒä»¬ã€‚</p><p>å¦å¤–ï¼Œç”±äºé”æœ¬è´¨ä¸Šæ˜¯å¯å˜å¯¹è±¡ï¼Œéœ€è¦ç”¨ <code>var</code> æ¥å£°æ˜å®ƒä»¬ã€‚</p><p>å…¶ä»–é”éƒ½æ˜¯æ˜¯å¼•ç”¨ç±»å‹ï¼Œå®ƒä»¬å¯ä»¥éšæ„ä¼ é€’ï¼Œå¹¶ä¸”å¯ä»¥ç”¨ <code>let</code> å£°æ˜ã€‚ </p><h3 id="åˆå§‹åŒ–"><a href="#åˆå§‹åŒ–" class="headerlink" title="åˆå§‹åŒ–"></a>åˆå§‹åŒ–</h3><p>2015-02-10 æ›´æ–°ï¼šæœ¬èŠ‚ä¸­æ‰€æè¿°çš„é—®é¢˜å·²ç»ä»¥æƒŠäººçš„é€Ÿåº¦è¢«æ·˜æ±°ã€‚è‹¹æœæ˜¨å¤©å‘å¸ƒäº† Xcode 6.3 beta 1ï¼Œå…¶ä¸­åŒ…æ‹¬ Swift 1.2ã€‚åœ¨å…¶ä»–æ›´æ”¹ä¸­ï¼Œç°åœ¨ä½¿ç”¨ä¸€ä¸ªç©ºçš„åˆå§‹åŒ–å™¨å¯¼å…¥ C ç»“æ„ï¼Œå°†æ‰€æœ‰å­—æ®µè®¾ç½®ä¸ºé›¶ã€‚ç®€è€Œè¨€ä¹‹ï¼Œä½ ç°åœ¨å¯ä»¥ç›´æ¥ä½¿ç”¨ <code>pthread_mutex_t()</code>ï¼Œä¸éœ€è¦ä¸‹é¢æåˆ°çš„æ‰©å±•ã€‚</p><p>pthread ç±»å‹å¾ˆéš¾åœ¨ swift ä¸­ä½¿ç”¨ã€‚å®ƒä»¬è¢«å®šä¹‰ä¸ºä¸é€æ˜çš„ç»“æ„ä½“ä¸­åŒ…å«äº†ä¸€å †å­˜å‚¨å˜é‡ï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">_opaque_pthread_mutex_t</span> </span>&#123;</span><br><span class="line">    long __sig;</span><br><span class="line">    char __opaque[__PTHREAD_MUTEX_SIZE__];</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>ç›®çš„æ˜¯å£°æ˜å®ƒä»¬ï¼Œç„¶åä½¿ç”¨ init å‡½æ•°å¯¹å®ƒä»¬è¿›è¡Œåˆå§‹åŒ–ï¼Œä½¿ç”¨ä¸€ä¸ªæŒ‡é’ˆå­˜å‚¨å’Œå¡«å……ã€‚åœ¨ C ä¸­ï¼Œå®ƒçœ‹èµ·æ¥åƒï¼š </p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">pthread_mutex_t</span> mutex;</span><br><span class="line">pthread_mutex_init(&amp;mutex, <span class="literal">NULL</span>);</span><br></pre></td></tr></table></figure><p>è¿™æ®µä»£ç å¯ä»¥æ­£å¸¸çš„å·¥ä½œï¼Œåªè¦ä½ è®°å¾—è°ƒç”¨ <code>pthread_mutex_init</code>ã€‚ç„¶è€Œï¼ŒSwift çœŸçš„çœŸçš„ä¸å–œæ¬¢æœªåˆå§‹åŒ–çš„å˜é‡ã€‚ä¸ä¸Šé¢ä»£ç ç­‰æ•ˆçš„ Swift ç‰ˆæœ¬æ— æ³•ç¼–è¯‘ï¼š </p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> mutex: pthread_mutex_t</span><br><span class="line">pthread_mutex_init(&amp;mutex, <span class="literal">nil</span>)</span><br><span class="line"><span class="comment">// error: address of variable 'mutex' taken before it is initialized</span></span><br></pre></td></tr></table></figure><p>Swift éœ€è¦å˜é‡åœ¨ä½¿ç”¨å‰åˆå§‹åŒ–ã€‚<code>pthread_mutex_init</code> ä¸ä½¿ç”¨ä¼ å…¥çš„å˜é‡çš„å€¼ï¼Œåªæ˜¯é‡å†™å®ƒï¼Œä½†æ˜¯ Swift ä¸çŸ¥é“ï¼Œå› æ­¤å®ƒäº§ç”Ÿäº†ä¸€ä¸ªé”™è¯¯ã€‚ä¸ºäº†æ»¡è¶³ç¼–è¯‘å™¨ï¼Œå˜é‡éœ€è¦ç”¨æŸç§ä¸œè¥¿åˆå§‹åŒ–ã€‚åœ¨ç±»å‹ä¹‹åä½¿ç”¨ <code>()</code>ï¼Œä½†è¿™æ ·å†™ä»ç„¶ä¼šæŠ¥é”™ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> mutex = pthread_mutex_t()</span><br><span class="line"><span class="comment">// error: missing argument for parameter '__sig' in call</span></span><br></pre></td></tr></table></figure><p>Swift éœ€è¦é‚£äº›ä¸é€æ˜å­—æ®µçš„å€¼ã€‚<code>__sig</code> å¯ä»¥ä¼ å…¥é›¶ï¼Œä½†æ˜¯ <code>__opaque</code> å°±æœ‰ç‚¹çƒ¦äººäº†ã€‚ä¸‹é¢çš„ç»“æ„ä½“éœ€è¦æ¡¥æ¥åˆ° swift ä¸­ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">_opaque_pthread_mutex_t</span> </span>&#123;</span><br><span class="line">   <span class="keyword">var</span> __sig: <span class="type">Int</span></span><br><span class="line">   <span class="keyword">var</span> __opaque: (<span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>,</span><br><span class="line">               <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>,</span><br><span class="line">               <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>,</span><br><span class="line">               <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>,</span><br><span class="line">               <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>,</span><br><span class="line">               <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>,</span><br><span class="line">               <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>,</span><br><span class="line">               <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>,</span><br><span class="line">               <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>,</span><br><span class="line">               <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>,</span><br><span class="line">               <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>,</span><br><span class="line">               <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>,</span><br><span class="line">               <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>,</span><br><span class="line">               <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç›®å‰æ²¡æœ‰ç®€å•çš„æ–¹æ³•ä½¿ç”¨ä¸€å † 0 æ„å»ºä¸€ä¸ªå…ƒç»„ï¼Œåªèƒ½åƒä¸‹é¢è¿™æ ·æŠŠæ‰€æœ‰çš„ 0 éƒ½å†™å‡ºæ¥ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> mutex = pthread_mutex_t(__sig: <span class="number">0</span>,</span><br><span class="line">                             __opaque: (<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>,</span><br><span class="line">                                        <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>,</span><br><span class="line">                                        <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>,</span><br><span class="line">                                        <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>,</span><br><span class="line">                                        <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>,</span><br><span class="line">                                        <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>,</span><br><span class="line">                                        <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>))</span><br></pre></td></tr></table></figure><p>è¿™ä¹ˆå†™å¤ªéš¾çœ‹äº†ï¼Œä½†æˆ‘æ²¡æ‰¾åˆ°å¥½çš„æ–¹æ³•ã€‚æˆ‘èƒ½æƒ³åˆ°æœ€å¥½çš„åšæ³•å°±æ˜¯æŠŠå®ƒå†™åˆ°ä¸€ä¸ªæ‰©å±•ä¸­ï¼Œè¿™æ ·ç›´æ¥ä½¿ç”¨ç©ºçš„ <code>()</code> å°±å¯ä»¥äº†ã€‚ä¸‹é¢æ˜¯æˆ‘å†™çš„ä¸¤ä¸ªæ‰©å±•ï¼š </p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">pthread_mutex_t</span> </span>&#123;</span><br><span class="line">    <span class="keyword">init</span>() &#123;</span><br><span class="line">        __sig = <span class="number">0</span></span><br><span class="line">        __opaque = (<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>,</span><br><span class="line">                    <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>,</span><br><span class="line">                    <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>,</span><br><span class="line">                    <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>,</span><br><span class="line">                    <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>,</span><br><span class="line">                    <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>,</span><br><span class="line">                    <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">pthread_rwlock_t</span> </span>&#123;</span><br><span class="line">    <span class="keyword">init</span>() &#123;</span><br><span class="line">        __sig = <span class="number">0</span></span><br><span class="line">        __opaque = (<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>,</span><br><span class="line">                    <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>,</span><br><span class="line">                    <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>,</span><br><span class="line">                    <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>,</span><br><span class="line">                    <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>,</span><br><span class="line">                    <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>,</span><br><span class="line">                    <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>,</span><br><span class="line">                    <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>,</span><br><span class="line">                    <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>,</span><br><span class="line">                    <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>,</span><br><span class="line">                    <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>,</span><br><span class="line">                    <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>,</span><br><span class="line">                    <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>,</span><br><span class="line">                    <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>,</span><br><span class="line">                    <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>,</span><br><span class="line">                    <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>,</span><br><span class="line">                    <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>,</span><br><span class="line">                    <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>,</span><br><span class="line">                    <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>,</span><br><span class="line">                    <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>,</span><br><span class="line">                    <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>,</span><br><span class="line">                    <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>,</span><br><span class="line">                    <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>,</span><br><span class="line">                    <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥é€šè¿‡ä¸‹é¢è¿™ç§æ–¹å¼ä½¿ç”¨ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> mutex = pthread_mutex_t()</span><br><span class="line">pthread_mutex_init(&amp;mutex, <span class="literal">nil</span>)</span><br></pre></td></tr></table></figure><h2 id="é”çš„å°è£…"><a href="#é”çš„å°è£…" class="headerlink" title="é”çš„å°è£…"></a>é”çš„å°è£…</h2><p>ä¸ºäº†ä½¿è¿™äº›ä¸åŒçš„ API æ›´æ˜“äºä½¿ç”¨ï¼Œæˆ‘ç¼–å†™äº†ä¸€ç³»åˆ—å°å‹å‡½æ•°ã€‚æˆ‘å†³å®šæŠŠ <code>with</code> ä½œä¸ºä¸€ä¸ªæ–¹ä¾¿ã€ç®€çŸ­ã€çœ‹èµ·æ¥åƒè¯­æ³•çš„åå­—ï¼Œçµæ„Ÿæ¥è‡ª python çš„ <code>with</code> å£°æ˜ã€‚Swift å‡½æ•°é‡è½½å…è®¸ä¸åŒç±»å‹ä½¿ç”¨ç›¸åŒçš„åç§°ã€‚åŸºæœ¬å½¢å¼å¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">with</span><span class="params">(lock: SomeLockType, f: Void -&gt; Void)</span></span> &#123; ...</span><br></pre></td></tr></table></figure><p>ç„¶ååœ¨é”å®šçš„æƒ…å†µä¸‹æ‰§è¡Œå‡½æ•° fã€‚ä¸‹é¢æˆ‘ä»¬æ¥å®ç°è¿™äº›ç±»å‹ã€‚</p><p>å¯¹äºå€¼ç±»å‹ï¼Œå®ƒéœ€è¦ä¸€ä¸ªæŒ‡å‘é”çš„æŒ‡é’ˆï¼Œä»¥ä¾¿ lock/unlock å‡½æ•°å¯ä»¥ä¿®æ”¹å®ƒã€‚è¿™ä¸ªå®ç°<code>pthread_mutex_t</code> åªæ˜¯è°ƒç”¨ç›¸åº”çš„ lock å’Œ unlock å‡½æ•°ï¼Œf å‡½æ•°åœ¨ä¸¤è€…ä¹‹é—´è°ƒç”¨ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">with</span><span class="params">(mutex: UnsafeMutablePointer&lt;pthread_mutex_t&gt;, f: Void -&gt; Void)</span></span> &#123;</span><br><span class="line">    pthread_mutex_lock(mutex)</span><br><span class="line">    f()</span><br><span class="line">    pthread_mutex_unlock(mutex)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>pthread_rwlock_t</code> çš„å®ç°å‡ ä¹å®Œå…¨ç›¸åŒï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">with</span><span class="params">(rwlock: UnsafeMutablePointer&lt;pthread_rwlock_t&gt;, f: Void -&gt; Void)</span></span> &#123;</span><br><span class="line">    pthread_rwlock_rdlock(rwlock)</span><br><span class="line">    f()</span><br><span class="line">    pthread_rwlock_unlock(rwlock)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸è¯»å†™é”åšä¸ªå¯¹æ¯”ï¼Œå®ƒä»¬çœ‹èµ·æ¥å¾ˆåƒï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">with_write</span><span class="params">(rwlock: UnsafeMutablePointer&lt;pthread_rwlock_t&gt;, f: Void -&gt; Void)</span></span> &#123;</span><br><span class="line">    pthread_rwlock_wrlock(rwlock)</span><br><span class="line">    f()</span><br><span class="line">    pthread_rwlock_unlock(rwlock)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>dispatch_queue_t</code> æ›´ç®€å•ã€‚å®ƒåªéœ€è¦å°è£… <code>dispatch_syncï¼š</code>ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">with</span><span class="params">(queue: dispatch_queue_t, f: Void -&gt; Void)</span></span> &#123;</span><br><span class="line">    dispatch_sync(queue, f)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœä¸€ä¸ªäººæƒ³æ˜¾æ‘†è‡ªå·±å¾ˆèªæ˜ï¼Œé‚£ä¹ˆå¯ä»¥å……åˆ†åˆ©ç”¨ Swift çš„å‡½æ•°å¼ç‰¹æ€§ç®€å•çš„å†™å‡ºè¿™æ ·çš„ä»£ç ï¼š</p><p><code>let with = dispatch_sync</code></p><p>è¿™ç§å†™æ³•å­˜åœ¨ä¸€äº›é—®é¢˜ï¼Œæœ€å¤§çš„é—®é¢˜æ˜¯å®ƒä¼šå’Œæˆ‘ä»¬è¿™é‡Œä½¿ç”¨çš„åŸºäºç±»å‹çš„é‡è½½æ··æ·†ã€‚</p><p><code>NSOperationQueue</code> åœ¨æ¦‚å¿µä¸Šæ˜¯ç›¸ä¼¼çš„ï¼Œä¸è¿‡æ²¡æœ‰ <code>dispatch_sync</code> å¯ä»¥ç”¨ã€‚æˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªæ“ä½œï¼ˆ<code>operation</code>ï¼‰ï¼Œå°†å…¶æ·»åŠ åˆ°é˜Ÿåˆ—ä¸­ï¼Œå¹¶æ˜¾å¼ç­‰å¾…å®ƒå®Œæˆï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">with</span><span class="params">(opQ: NSOperationQueue, f: Void -&gt; Void)</span></span> &#123;</span><br><span class="line">    <span class="keyword">let</span> op = <span class="type">NSBlockOperation</span>(f)</span><br><span class="line">    opQ.addOperation(op)</span><br><span class="line">    op.waitUntilFinished()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®ç° <code>NSLock</code> çœ‹èµ·æ¥åƒ <code>pthread</code> ç‰ˆæœ¬ï¼Œåªæ˜¯é”å®šè°ƒç”¨æœ‰äº›ä¸åŒï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">with</span><span class="params">(lock: NSLock, f: Void -&gt; Void)</span></span> &#123;</span><br><span class="line">    lock.lock()</span><br><span class="line">    f()</span><br><span class="line">    lock.unlock()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ€åï¼Œ<code>OSSpinLock</code> çš„å®ç°åŒæ ·ä¹Ÿæ˜¯å¦‚æ­¤ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">with</span><span class="params">(spinlock: UnsafeMutablePointer&lt;OSSpinLock&gt;, f: Void -&gt; Void)</span></span> &#123;</span><br><span class="line">    <span class="type">OSSpinLockLock</span>(spinlock)</span><br><span class="line">    f()</span><br><span class="line">    <span class="type">OSSpinLockUnlock</span>(spinlock)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ¨¡ä»¿-synchronized"><a href="#æ¨¡ä»¿-synchronized" class="headerlink" title="æ¨¡ä»¿ @synchronized"></a>æ¨¡ä»¿ <code>@synchronized</code></h3><p>æœ‰äº†ä¸Šé¢çš„å°è£…ï¼Œæ¨¡ä»¿ <code>@synchronized</code> çš„å®ç°å°±å˜å¾—å¾ˆç®€å•ã€‚ç»™ä½ çš„ç±»æ·»åŠ ä¸€ä¸ªå±æ€§ï¼ŒæŒæœ‰ä¸€ä¸ªé”ï¼Œç„¶åä½¿ç”¨ <code>with</code> æ›¿ä»£ <code>@synchronized</code> ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> queue = dispatch_queue_create(<span class="string">"com.example.myqueue"</span>, <span class="literal">nil</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">setEntryForKey</span><span class="params">(key: Key, entry: Entry)</span></span> &#123;</span><br><span class="line">    with(queue) &#123;</span><br><span class="line">        entries[key] = entry</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä» block ä¸­è·å–æ•°æ®æ¯”è¾ƒéº»çƒ¦ã€‚<code>@synchronized</code> å¯ä»¥ä»å†…éƒ¨ <code>return</code> ï¼Œä½†æ˜¯ <code>with</code> åšä¸åˆ°ã€‚ä½ å¿…é¡»ä½¿ç”¨ä¸€ä¸ª <code>var</code> å˜é‡åœ¨ block å†…éƒ¨èµ‹å€¼ç»™å®ƒï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">entryForKey</span><span class="params">(key: Key)</span></span> -&gt; <span class="type">Entry</span>? &#123;</span><br><span class="line">    <span class="keyword">var</span> result: <span class="type">Entry</span>?</span><br><span class="line">    with(queue) &#123;</span><br><span class="line">        result = entries[key]</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æŒ‰ç†è¯´å¯ä»¥å°†è¿™æ®µä»£ç å½“åšæ¨¡æ¿å°è£…åœ¨ä¸€ä¸ªé€šç”¨å‡½æ•°ä¸­ï¼Œä½†æ˜¯å®ƒæ— æ³•é€šè¿‡ Swift ç¼–è¯‘å™¨çš„ç±»å‹æ¨æ–­ï¼Œç›®å‰è¿˜æ²¡æœ‰æ‰¾åˆ°è§£å†³æ–¹æ³•ã€‚</p><h3 id="æ¨¡æ‹ŸåŸå­å±æ€§"><a href="#æ¨¡æ‹ŸåŸå­å±æ€§" class="headerlink" title="æ¨¡æ‹ŸåŸå­å±æ€§"></a>æ¨¡æ‹ŸåŸå­å±æ€§</h3><p>åŸå­å±æ€§ï¼ˆ<code>atomic</code>ï¼‰å¹¶ä¸å¸¸ç”¨ã€‚ä¸å…¶ä»–ä»£ç å±æ€§ä¸åŒï¼ŒåŸå­å±æ€§å¹¶ä¸æ”¯æŒç»„åˆç‡ã€‚å¦‚æœå‡½æ•° f ä¸å­˜åœ¨å†…å­˜æ³„æ¼ï¼Œå‡½æ•° g ä¸å­˜åœ¨å†…å­˜æ³„æ¼ï¼Œé‚£ä¹ˆå‡½æ•° h åªæ˜¯è°ƒç”¨ f å’Œ g ä¹Ÿä¸ä¼šå­˜åœ¨å†…å­˜æ³„æ¼ã€‚ä½†æ˜¯åŸå­å±æ€§å¹¶ä¸æ»¡è¶³è¿™ä¸ªæ¡ä»¶ã€‚ä¸¾ä¸€ä¸ªä¾‹å­ï¼Œå‡è®¾ä½ æœ‰ä¸€ä¸ªå®šä¹‰æˆåŸå­å±æ€§å¹¶ä¸”çº¿ç¨‹å®‰å…¨çš„ Account ç±»ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> checkingAccount = <span class="type">Account</span>(amount: <span class="number">100</span>)</span><br><span class="line"><span class="keyword">let</span> savingsAccount = <span class="type">Account</span>(amount: <span class="number">0</span>)</span><br></pre></td></tr></table></figure><p>ç°åœ¨è¦æŠŠé’±è½¬åˆ°å‚¨è“„è´¦æˆ·ä¸­ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">checkingAccount.withDraw(<span class="number">100</span>)</span><br><span class="line">savingsAccount.deposit(<span class="number">100</span>)</span><br></pre></td></tr></table></figure><p>åœ¨å¦ä¸€ä¸ªçº¿ç¨‹ä¸­ï¼Œç»Ÿè®¡å¹¶æ˜¾ç¤ºä½™é¢ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="built_in">println</span>(<span class="string">"Your total balance is: <span class="subst">\(checkingAccount.amount + savingsAccount.amount)</span>"</span>)</span><br></pre></td></tr></table></figure><p>åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œè¿™æ®µä»£ç ä¼šæ‰“å° 0ï¼Œè€Œä¸æ˜¯ 100ï¼Œå°½ç®¡äº‹å®ä¸Šè¿™äº› Account å¯¹è±¡æœ¬èº«æ˜¯åŸå­å±æ€§ï¼Œå¹¶ä¸”ç”¨æˆ·ç¡®å®æœ‰ 100 çš„ä½™é¢ã€‚æ‰€ä»¥ï¼Œæœ€å¥½è®©æ•´ä¸ªå­ç³»ç»Ÿéƒ½æ»¡è¶³åŸå­æ€§ï¼Œè€Œä¸æ˜¯å•ä¸ªå±æ€§ã€‚</p><p>åœ¨æå°‘æ•°æƒ…å†µä¸‹ï¼ŒåŸå­å±æ€§æ˜¯æœ‰ç”¨çš„ï¼Œå› ä¸ºå®ƒå¹¶ä¸ä¾èµ–å…¶ä»–ç‰¹æ€§ï¼Œåªéœ€è¦çº¿ç¨‹å®‰å…¨å³å¯ã€‚è¦åœ¨ Swift ä¸­å®ç°è¿™ä¸€ç‚¹ï¼Œéœ€è¦ä¸€ä¸ªè®¡ç®—å±æ€§æ¥å®Œæˆé”å®šï¼Œç”¨å¦ä¸€ä¸ªå¸¸è§„å±æ€§ä¿å­˜å€¼ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">let</span> queue = dispatch_queue_create(<span class="string">"..."</span>, <span class="literal">nil</span>)</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">var</span> _myPropertyStorage: <span class="type">SomeType</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> myProperty: <span class="type">SomeType</span> &#123;</span><br><span class="line">    <span class="keyword">get</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> result: <span class="type">SomeType</span>?</span><br><span class="line">        with(queue) &#123;</span><br><span class="line">            result = _myPropertyStorage</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result!</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">set</span> &#123;</span><br><span class="line">        with(queue) &#123;</span><br><span class="line">            _myPropertyStorage = newValue</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å¦‚ä½•é€‰æ‹©é”-API"><a href="#å¦‚ä½•é€‰æ‹©é”-API" class="headerlink" title="å¦‚ä½•é€‰æ‹©é” API"></a>å¦‚ä½•é€‰æ‹©é” API</h3><p><code>pthread</code> API åœ¨ Swift ä¸­ä¸å¤ªå¥½ç”¨ï¼Œè€Œä¸”åŠŸèƒ½å¹¶ä¸æ¯”å…¶å®ƒ API å¤šã€‚ä¸€èˆ¬æˆ‘æ¯”è¾ƒå–œæ¬¢åœ¨ C å’Œ Objective-C ä¸­ä½¿ç”¨å®ƒä»¬ï¼Œå› ä¸ºå®ƒä»¬åˆå¥½ç”¨åˆé«˜æ•ˆã€‚ä½†æ˜¯åœ¨ Swift ä¸­ï¼Œé™¤éå¿…è¦ï¼Œæˆ‘ä¸€èˆ¬ä¸ä¼šç”¨ã€‚</p><p>ä¸€èˆ¬æ¥è¯´ä¸éœ€è¦ç”¨è¯»å†™é”ï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹è¯»å†™é€Ÿåº¦éƒ½éå¸¸å¿«ã€‚è¯»å†™é”å¸¦æ¥çš„é¢å¤–å¼€é”€è¶…è¿‡äº†å¹¶å‘è¯»å–å¸¦æ¥çš„æ•ˆç‡æå‡ã€‚</p><p>é€’å½’é”ä¼šå‘ç”Ÿæ­»é”ã€‚å¤šæ•°æƒ…å†µä¸‹å®ƒä»¬æ˜¯æœ‰ç”¨çš„ï¼Œä½†å¦‚æœä½ å‘ç°è‡ªå·±éœ€è¦è·å–ä¸€ä¸ªå·²ç»åœ¨å½“å‰çº¿ç¨‹è¢«é”ä½çš„é”ï¼Œé‚£æœ€å¥½é‡æ–°è®¾è®¡ä»£ç ï¼Œé€šå¸¸æ¥è¯´ä¸ä¼šå‡ºç°è¿™ç§éœ€æ±‚ã€‚</p><p>æˆ‘çš„å»ºè®®æ˜¯ï¼Œå¦‚æœä¸çŸ¥é“è¯¥ç”¨ä»€ä¹ˆï¼Œé‚£å°±é»˜è®¤é€‰æ‹© <code>dispatch_queue_t</code> ã€‚è™½ç„¶ç”¨èµ·æ¥ç›¸å¯¹éº»çƒ¦ï¼Œä½†æ˜¯ä¸ä¼šäº§ç”Ÿå¤ªå¤šé—®é¢˜ã€‚è¯¥ API éå¸¸æ–¹ä¾¿ï¼Œå¹¶ä¸”ç¡®ä¿ä½ æ°¸è¿œä¸ä¼šå¿˜è®°è°ƒç”¨ lock å’Œ unlockã€‚å®ƒæä¾›äº†è®¸å¤šæœ‰ç”¨çš„ APIï¼Œå¦‚ä½¿ç”¨å•ä¸ª <code>dispatch_async</code> åœ¨åå°æ‰§è¡Œè¢«é”å®šçš„ä»£ç ï¼Œæˆ–è€…è®¾ç½®å®šæ—¶å™¨æˆ–å…¶ä»–ä½œç”¨äº queue çš„äº‹ä»¶æºï¼Œä»¥ä¾¿å®ƒä»¬è‡ªåŠ¨æ‰§è¡Œé”å®šã€‚ä½ ç”šè‡³å¯ä»¥ç”¨å®ƒä½œä¸º <code>NSNotificationCenter</code> è§‚å¯Ÿè€…ï¼Œæˆ–è€…ä½¿ç”¨ <code>NSOperationQueue</code> çš„å±æ€§ <code>underlyingQueue</code> ä½œä¸º <code>NSURLSession</code> ä»£ç†ã€‚</p><p><code>NSOperationQueue</code> å¯èƒ½è®¤ä¸ºè‡ªå·±å’Œ <code>dispatch_queue_t</code> ä¸€æ ·ç‰›ğŸ‘ƒï¼Œä½†æ˜¯å®é™…ä¸Šå¾ˆå°‘æœ‰åœºæ™¯éœ€è¦ä½¿ç”¨å®ƒã€‚è¿™ä¸ª API ä½¿ç”¨èµ·æ¥æ›´éº»çƒ¦ï¼Œè€Œä¸”å’Œå…¶ä»– API æ¯”æ²¡æœ‰ä»€ä¹ˆä¼˜åŠ¿ï¼Œæ— éåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå®ƒèƒ½è‡ªåŠ¨è¿›è¡Œæ“ä½œçš„ä¾èµ–å…³ç³»ç®¡ç†ï¼Œä¹Ÿå°±è¿™ç‚¹æ¯”è¾ƒæœ‰ç”¨ã€‚</p><p><code>NSLock</code> æ˜¯ä¸€ä¸ªç®€å•çš„é”å®šç±»ï¼Œæ˜“äºä½¿ç”¨ä¸”æ•ˆç‡å¾ˆé«˜ã€‚å¦‚æœéœ€è¦æ˜¾å¼é”å®šå’Œè§£é”ï¼Œé‚£å¯ä»¥ç”¨å®ƒæ›¿ä»£ <code>dispatch_queue_t</code> ã€‚ä½†åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ä¸éœ€è¦ä½¿ç”¨å®ƒã€‚</p><p><code>OSSpinLock</code> å¯¹äºç»å¸¸ä½¿ç”¨é”å®šã€ç«äº‰è¾ƒå°‘ä¸”é”å®šä»£ç è¿è¡Œé€Ÿåº¦å¿«çš„ç”¨æˆ·æ¥è¯´ï¼Œæ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é€‰æ‹©ã€‚å®ƒçš„å¼€é”€éå¸¸å°‘ï¼Œæœ‰åŠ©äºæå‡æ€§èƒ½ã€‚å¦‚æœä»£ç å¯èƒ½ä¼šåœ¨å¾ˆé•¿ä¸€æ®µæ—¶é—´å†…ä¿æŒé”å®šæˆ–ç«äº‰å¾ˆå¤šï¼Œé‚£æœ€å¥½ä¸è¦ç”¨è¿™ä¸ª APIï¼Œå› ä¸ºè¿™ä¼šæµªè´¹ CPU æ—¶é—´ã€‚é€šå¸¸æ¥è¯´ï¼Œä½ å¯ä»¥å…ˆä½¿ç”¨ <code>dispatch_queue_t</code> ï¼Œå¦‚æœè¿™å—å‡ºç°äº†æ€§èƒ½é—®é¢˜ï¼Œå†è€ƒè™‘æ¢æˆ <code>OSSpinLock</code> ã€‚</p><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>Swift è¯­è¨€å±‚é¢å¹¶ä¸æ”¯æŒçº¿ç¨‹åŒæ­¥ï¼Œä½†æ˜¯ Apple çš„ç³»ç»Ÿæ¡†æ¶æœ‰å¾ˆå¤šå¥½ç”¨çš„ APIã€‚<code>GCD</code> å’Œ <code>dispatch_queue_t</code> éå¸¸å¥½ç”¨ï¼Œå¹¶ä¸”Swift ä¸­çš„ API ä¹Ÿæ˜¯å¦‚æ­¤ã€‚è™½ç„¶ Swift é‡Œæ²¡æœ‰ <code>@synchronized</code> å’ŒåŸå­å±æ€§ï¼Œä½†æˆ‘ä»¬æœ‰å…¶ä»–æ›´å¥½çš„é€‰æ‹©ã€‚</p><blockquote><p>æœ¬æ–‡ç”± SwiftGG ç¿»è¯‘ç»„ç¿»è¯‘ï¼Œå·²ç»è·å¾—ä½œè€…ç¿»è¯‘æˆæƒï¼Œæœ€æ–°æ–‡ç« è¯·è®¿é—® <a href="http://swift.gg">http://swift.gg</a>ã€‚</p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;ä½œè€…ï¼šMike Ashï¼Œ&lt;a href=&quot;https://www.mikeash.com/pyblog/friday-qa-2015-02-06-locks-thread-safety-and-swift.html&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;åŸæ–‡é“¾æ¥&lt;/a&gt;ï¼ŒåŸæ–‡æ—¥æœŸï¼š2015-02-06&lt;br&gt;è¯‘è€…ï¼š&lt;a href=&quot;undefined&quot;&gt;Lefe_x&lt;/a&gt;ï¼›æ ¡å¯¹ï¼š&lt;a href=&quot;http://numbbbbb.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;numbbbbb&lt;/a&gt;ï¼Œ&lt;a href=&quot;http://blog.yousanflics.com.cn&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Yousanflics&lt;/a&gt;ï¼Œ&lt;a href=&quot;https://weibo.com/1743643682/profile?topnav=1&amp;amp;wvr=6&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;liberalism&lt;/a&gt;ï¼›å®šç¨¿ï¼š&lt;a href=&quot;https://github.com/chenmingbiao&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;CMB&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;!--æ­¤å¤„å¼€å§‹æ­£æ–‡--&gt;
&lt;p&gt;åœ¨ Swift ä¸­æœ‰ä¸ªæœ‰è¶£çš„ç°è±¡ï¼šå®ƒæ²¡æœ‰ä¸çº¿ç¨‹ç›¸å…³çš„è¯­æ³•ï¼Œä¹Ÿæ²¡æœ‰æ˜ç¡®çš„äº’æ–¥é”/é”ï¼ˆ&lt;code&gt;mutexes/locks&lt;/code&gt;ï¼‰æ¦‚å¿µï¼Œç”šè‡³ Objective-C ä¸­æœ‰çš„ &lt;code&gt;@synchronized&lt;/code&gt; å’ŒåŸå­å±æ€§å®ƒéƒ½æ²¡æœ‰ã€‚å¹¸è¿çš„æ˜¯ï¼Œè‹¹æœç³»ç»Ÿçš„ API å¯ä»¥éå¸¸å®¹æ˜“åœ°åº”ç”¨åˆ° Swift ä¸­ã€‚ä»Šå¤©ï¼Œæˆ‘ä¼šä»‹ç»è¿™äº› API çš„ç”¨æ³•ä»¥åŠä» Objective-C è¿‡æ¸¡çš„ä¸€äº›é—®é¢˜ï¼Œè¿™äº›çµæ„Ÿéƒ½æ¥æºäº Cameron Pulsfordã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="Mike Ash" scheme="https://swift.gg/categories/Mike-Ash/"/>
    
    
      <category term="Swift" scheme="https://swift.gg/tags/Swift/"/>
    
  </entry>
  
  <entry>
    <title>Swift å·¥å…·ç±»ï¼šå¤„ç†ä¸´æ—¶æ–‡ä»¶</title>
    <link href="https://swift.gg/2018/06/04/temp-file-helper/"/>
    <id>https://swift.gg/2018/06/04/temp-file-helper/</id>
    <published>2018-06-04T00:00:00.000Z</published>
    <updated>2018-09-10T03:53:25.081Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ä½œè€…ï¼šOle Begemannï¼Œ<a href="https://oleb.net/blog/2018/03/temp-file-helper/" target="_blank" rel="noopener">åŸæ–‡é“¾æ¥</a>ï¼ŒåŸæ–‡æ—¥æœŸï¼š2018-03-22<br>è¯‘è€…ï¼š<a href="http://daizi.me" target="_blank" rel="noopener">å°è¢‹å­</a>ï¼›æ ¡å¯¹ï¼š<a href="http://numbbbbb.com/" target="_blank" rel="noopener">numbbbbb</a>ï¼Œ<a href="http://blog.yousanflics.com.cn" target="_blank" rel="noopener">Yousanflics</a>ï¼›å®šç¨¿ï¼š<a href="http://forelax.space" target="_blank" rel="noopener">Forelax</a></p></blockquote><!--æ­¤å¤„å¼€å§‹æ­£æ–‡--><p>æˆ‘ç»å¸¸éœ€è¦åœ¨æŸäº›æ“ä½œä¸­åˆ›å»ºä¸´æ—¶æ–‡ä»¶ï¼Œæ¯æ¬¡éƒ½å¾ˆç¹çï¼šå¿…é¡»æœ‰åˆé€‚çš„ä¸´æ—¶ç›®å½•ï¼Œç¡®ä¿æ–‡ä»¶åæ˜¯å”¯ä¸€çš„ï¼Œæœ€åè¿˜ä¸èƒ½å¿˜è®°åœ¨æ“ä½œå®Œæˆä¹‹ååˆ é™¤æ–‡ä»¶ã€‚</p><p>å®é™…ä¸Šï¼Œâ€œåˆ›å»ºâ€æ˜¯ä¸€ä¸ªé”™è¯¯çš„è¯´æ³•ï¼Œå› ä¸ºåˆ›å»ºå·¥ä½œé€šå¸¸æ˜¯ç”±æˆ‘ä½¿ç”¨çš„ API è´Ÿè´£çš„ â€” è€Œæˆ‘åªæ˜¯æä¾›äº†ä¸€ä¸ªæŒ‡å‘ç›®çš„ä½ç½®çš„ URLã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾ä½ çš„åº”ç”¨æä¾›äº†ä¸€ä¸ªåˆ†äº« PDF æ–‡ä»¶çš„åŠŸèƒ½ã€‚ä½ éœ€è¦åˆ›å»ºä¸€ä¸ª <a href="https://developer.apple.com/documentation/uikit/uigraphicspdfrenderer" target="_blank" rel="noopener"><code>UIGraphicsPDFRenderer</code></a>å¯¹è±¡æ¥ç”Ÿæˆ PDFï¼Œç„¶åè°ƒç”¨ <a href="https://developer.apple.com/documentation/uikit/uigraphicspdfrenderer/1649119-writepdf" target="_blank" rel="noopener"><code>writePDF</code></a> æ–¹æ³•å¹¶ä¼ å…¥ä¸´æ—¶æ–‡ä»¶çš„ URL ç”Ÿæˆ PDF æ–‡ä»¶ï¼Œæœ€ååœ¨ iOS åˆ†äº«åˆ—è¡¨ï¼ˆshare sheetï¼‰ä¸­åˆ†äº«å®ƒã€‚</p><p>ä¸ºäº†ä½¿è¿™ä¸ªæ“ä½œæ›´åŠ ç®€ä¾¿ï¼Œæˆ‘æœ€è¿‘å†™äº†ä¸€ä¸ªç®€å•çš„ Swift å·¥å…·ç±»ã€‚ä½ å¯ä»¥è¿™æ ·ä½¿ç”¨ï¼š</p><a id="more"></a><p>1ã€é€‰æ‹©ä¸€ä¸ªæ–‡ä»¶åæ¥åˆå§‹åŒ– <code>TemporaryFile</code> ï¼š<br><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> tmp = <span class="keyword">try</span> <span class="type">TemporaryFile</span>(creatingTempDirectoryForFilename: <span class="string">"report.pdf"</span>)</span><br></pre></td></tr></table></figure></p><p>è¿™æ ·å°±æ–°å»ºäº†ä¸€ä¸ªå”¯ä¸€çš„ä¸´æ—¶ç›®å½•ã€‚æ­£å¦‚æˆ‘å‰é¢æåˆ°çš„ï¼Œè¿™æ˜¯ä¸ªç©ºç›®å½•ï¼Œ<code>TemporaryFile</code> å¹¶ä¸ä¼šåˆ›å»ºä»»ä½•æ–‡ä»¶ã€‚æ›´ç¡®åˆ‡åœ°è¯´ï¼Œå®ƒåªæ˜¯æä¾›äº†ä¸€ä¸ªå¯ä»¥å®‰å…¨åˆ›å»ºå¾ˆå¤šæ–‡ä»¶çš„ç›®å½•ï¼Œå¹¶ä¸”ä¸ç”¨æ‹…å¿ƒå‘½åå†²çªã€‚</p><p>2ã€<code>TemporaryFile</code>æœ‰ä¸¤ä¸ªå±æ€§ï¼Œ<code>directoryURL</code> æ˜¯åˆ›å»ºçš„ä¸´æ—¶ç›®å½• URLã€‚<code>fileURL</code> æ˜¯ç›®å½•ä¸­çš„æ–‡ä»¶ URLï¼Œå³åˆå§‹åŒ–æ—¶æŒ‡å®šçš„æ–‡ä»¶åï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="built_in">print</span>(tmp.directoryURL.path)</span><br><span class="line"><span class="comment">// â†’ /var/folders/v8/tft1qâ€¦/T/â€¦-8DC6DD131DC1</span></span><br><span class="line"><span class="built_in">print</span>(tmp.fileURL.path)</span><br><span class="line"><span class="comment">// â†’ /var/folders/v8/tft1qâ€¦/T/â€¦-8DC6DD131DC1/report.pdf</span></span><br></pre></td></tr></table></figure><p>å†æ¬¡å¼ºè°ƒä¸€ä¸‹ï¼Œè¯¥ URL å¯¹åº”çš„æ–‡ä»¶æš‚æ—¶è¿˜ä¸å­˜åœ¨â€”â€”ä½ å¿…é¡»è‡ªå·±åˆ›å»ºæ–‡ä»¶ï¼Œé€šå¸¸æ¥è¯´å¯ä»¥æŠŠ URL ä¼ å…¥å…¶ä»– API æ¥ç”Ÿæˆæ–‡ä»¶ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> renderer = <span class="type">UIGraphicsPDFRenderer</span>(...)</span><br><span class="line"><span class="keyword">try</span> renderer.writePDF(to: tmp.fileURL) &#123; context <span class="keyword">in</span></span><br><span class="line">    <span class="comment">// ç¼–å†™ä»£ç </span></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½ å¯ä»¥åœ¨ç›®å½•ä¸­åˆ›å»ºä¸åŒåå­—çš„æ–‡ä»¶ï¼Œä½†æ˜¯ <code>TemporaryFile</code> ç±»å‹ç›®å‰åªèƒ½ç”¨æ¥å­˜å‚¨å•ä¸€çš„æ–‡ä»¶ URLã€‚å¦‚æœèƒ½å¤Ÿæ”¯æŒå¤šæ–‡ä»¶ URL çš„å­˜å‚¨ï¼Œé‚£å°±ä¼šæ›´å¥½ç”¨äº†ã€‚</p><p>3ã€åˆ›å»ºæ–‡ä»¶åï¼Œ<code>TemporaryFile</code> çš„å€¼è¢«åº”ç”¨ä¸­ä½¿ç”¨è¯¥æ–‡ä»¶çš„å¯¹è±¡æ‰€æŒæœ‰ï¼ˆä¾‹å¦‚ï¼Œåˆ›å»ºæ–‡ä»¶å‡½æ•°çš„è°ƒç”¨è€…ï¼‰ã€‚å½“è¯¥å¯¹è±¡å®Œæˆåå¹¶ä¸”ä¸å†éœ€è¦è¯¥æ–‡ä»¶æ—¶ï¼Œå¯ä»¥è°ƒç”¨<code>DeleTeDirectory</code>æ–¹æ³•åˆ é™¤ä¸´æ—¶ç›®å½•ï¼ŒåŒ…æ‹¬å…¶ä¸­çš„æ‰€æœ‰æ–‡ä»¶ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ä¾‹å¦‚å°† temp æ–‡ä»¶ä¼ ç»™ UIActivityController ç”¨ä»¥åˆ†äº«</span></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"><span class="comment">// å½“ä½ å®Œæˆå, è°ƒç”¨ deleteDirectory</span></span><br><span class="line"><span class="keyword">try</span> tmp.deleteDirectory()</span><br></pre></td></tr></table></figure><p>æˆ‘æ›¾è€ƒè™‘åˆ°è®©è¿™ä¸ªæ­¥éª¤è‡ªåŠ¨åŒ– â€” ä½ å¯ä»¥åˆ›å»º <code>TemporaryFile</code> ç±»ï¼Œç„¶ååœ¨ <code>deinitializer</code> ä¸­è°ƒç”¨ <code>deleteDirectory</code>ã€‚æœ€åæˆ‘æ”¾å¼ƒäº†ï¼Œå› ä¸ºè¿™ç§è¡Œä¸ºå¯èƒ½è®©ç±»å‹çš„ä½¿ç”¨è€…æ„Ÿåˆ°å›°æƒ‘ã€‚å¦‚æœèƒ½å¤Ÿæ·»åŠ ä¸€ä¸ªåˆå§‹åŒ–æ ‡å¿—ä½æ¥é…ç½®åˆ é™¤è¡Œä¸ºå°±å¥½äº†ã€‚</p><h3 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h3><p>ä»¥ä¸‹æ˜¯å®Œæ•´ä»£ç  (Swift 4.0):</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Foundation</span><br><span class="line"><span class="comment">/// ä¸´æ—¶ç›®å½•ä¸­ä¸´æ—¶æ–‡ä»¶çš„åŒ…è£…ï¼ˆWrapperï¼‰ã€‚ç›®å½•æ˜¯ä¸ºæ–‡ä»¶è€Œç‰¹åˆ«åˆ›å»ºçš„ï¼Œå› æ­¤ä¸å†éœ€è¦æ–‡ä»¶æ—¶ï¼Œå¯ä»¥å®‰å…¨åœ°åˆ é™¤è¯¥æ–‡ä»¶ã€‚</span></span><br><span class="line"><span class="comment">///</span></span><br><span class="line"><span class="comment">/// åœ¨ä½ ä¸å†éœ€è¦æ–‡ä»¶æ—¶ï¼Œè°ƒç”¨ `deleteDirectory`</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">TemporaryFile</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> directoryURL: <span class="type">URL</span></span><br><span class="line">    <span class="keyword">let</span> fileURL: <span class="type">URL</span></span><br><span class="line">    <span class="comment">/// åˆ é™¤ä¸´æ—¶ç›®å½•å’Œå…¶ä¸­çš„æ‰€æœ‰æ–‡ä»¶ã€‚</span></span><br><span class="line">    <span class="keyword">let</span> deleteDirectory: () <span class="keyword">throws</span> -&gt; <span class="type">Void</span></span><br><span class="line"><span class="comment">/// ä½¿ç”¨å”¯ä¸€çš„åå­—æ¥åˆ›å»ºä¸´æ—¶ç›®å½•ï¼Œå¹¶ä¸”ä½¿ç”¨ `fileURL` ç›®å½•ä¸­åä¸º `filename` çš„æ–‡ä»¶æ¥åˆå§‹åŒ–æ¥æ”¶è€…ã€‚</span></span><br><span class="line">    <span class="comment">///</span></span><br><span class="line">    <span class="comment">/// - æ³¨æ„: è¿™é‡Œä¸ä¼šåˆ›å»ºæ–‡ä»¶ï¼</span></span><br><span class="line">    <span class="keyword">init</span>(creatingTempDirectoryForFilename filename: <span class="type">String</span>) <span class="keyword">throws</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> (directory, deleteDirectory) = <span class="keyword">try</span> <span class="type">FileManager</span>.<span class="keyword">default</span></span><br><span class="line">            .urlForUniqueTemporaryDirectory()</span><br><span class="line">        <span class="keyword">self</span>.directoryURL = directory</span><br><span class="line">        <span class="keyword">self</span>.fileURL = directory.appendingPathComponent(filename)</span><br><span class="line">        <span class="keyword">self</span>.deleteDirectory = deleteDirectory</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">FileManager</span> </span>&#123;</span><br><span class="line"><span class="comment">/// åˆ›å»ºä¸€ä¸ªæœ‰å”¯ä¸€åå­—çš„ä¸´æ—¶ç›®å½•å¹¶è¿”å› URLã€‚</span></span><br><span class="line">    <span class="comment">///</span></span><br><span class="line">    <span class="comment">/// - è¿”å›ï¼šç›®å½• URL çš„ tuple ä»¥åŠåˆ é™¤å‡½æ•°ã€‚</span></span><br><span class="line">    <span class="comment">///   å®Œæˆåè°ƒç”¨å‡½æ•°åˆ é™¤ç›®å½•ã€‚</span></span><br><span class="line">    <span class="comment">///</span></span><br><span class="line">    <span class="comment">/// - æ³¨æ„: åœ¨åº”ç”¨é€€å‡ºåï¼Œä¸åº”è¯¥å­˜åœ¨ä¾èµ–çš„ä¸´æ—¶ç›®å½•ã€‚</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">urlForUniqueTemporaryDirectory</span><span class="params">(preferredName: String? = <span class="literal">nil</span>)</span></span> <span class="keyword">throws</span></span><br><span class="line">        -&gt; (url: <span class="type">URL</span>, deleteDirectory: () <span class="keyword">throws</span> -&gt; <span class="type">Void</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">let</span> basename = preferredName ?? <span class="type">UUID</span>().uuidString</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> counter = <span class="number">0</span></span><br><span class="line">        <span class="keyword">var</span> createdSubdirectory: <span class="type">URL</span>? = <span class="literal">nil</span></span><br><span class="line">        <span class="keyword">repeat</span> &#123;</span><br><span class="line">            <span class="keyword">do</span> &#123;</span><br><span class="line">                <span class="keyword">let</span> subdirName = counter == <span class="number">0</span> ? basename : <span class="string">"<span class="subst">\(basename)</span>-<span class="subst">\(counter)</span>"</span></span><br><span class="line">                <span class="keyword">let</span> subdirectory = temporaryDirectory</span><br><span class="line">                    .appendingPathComponent(subdirName, isDirectory: <span class="literal">true</span>)</span><br><span class="line">                <span class="keyword">try</span> createDirectory(at: subdirectory, withIntermediateDirectories: <span class="literal">false</span>)</span><br><span class="line">                createdSubdirectory = subdirectory</span><br><span class="line">            &#125; <span class="keyword">catch</span> <span class="type">CocoaError</span>.fileWriteFileExists &#123;</span><br><span class="line">                <span class="comment">// æ•æ‰åˆ°æ–‡ä»¶å·²å­˜åœ¨çš„é”™è¯¯ï¼Œå¹¶ä½¿ç”¨å…¶ä»–åå­—é‡è¯•ã€‚</span></span><br><span class="line">                <span class="comment">// å…¶ä»–é”™è¯¯ä¼ æ’­åˆ°è°ƒç”¨æ–¹ã€‚</span></span><br><span class="line">                counter += <span class="number">1</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">while</span> createdSubdirectory == <span class="literal">nil</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> directory = createdSubdirectory!</span><br><span class="line">        <span class="keyword">let</span> deleteDirectory: () <span class="keyword">throws</span> -&gt; <span class="type">Void</span> = &#123;</span><br><span class="line">            <span class="keyword">try</span> <span class="keyword">self</span>.removeItem(at: directory)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> (directory, deleteDirectory)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>æœ¬æ–‡ç”± SwiftGG ç¿»è¯‘ç»„ç¿»è¯‘ï¼Œå·²ç»è·å¾—ä½œè€…ç¿»è¯‘æˆæƒï¼Œæœ€æ–°æ–‡ç« è¯·è®¿é—® <a href="http://swift.gg">http://swift.gg</a>ã€‚</p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;ä½œè€…ï¼šOle Begemannï¼Œ&lt;a href=&quot;https://oleb.net/blog/2018/03/temp-file-helper/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;åŸæ–‡é“¾æ¥&lt;/a&gt;ï¼ŒåŸæ–‡æ—¥æœŸï¼š2018-03-22&lt;br&gt;è¯‘è€…ï¼š&lt;a href=&quot;http://daizi.me&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;å°è¢‹å­&lt;/a&gt;ï¼›æ ¡å¯¹ï¼š&lt;a href=&quot;http://numbbbbb.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;numbbbbb&lt;/a&gt;ï¼Œ&lt;a href=&quot;http://blog.yousanflics.com.cn&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Yousanflics&lt;/a&gt;ï¼›å®šç¨¿ï¼š&lt;a href=&quot;http://forelax.space&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Forelax&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;!--æ­¤å¤„å¼€å§‹æ­£æ–‡--&gt;
&lt;p&gt;æˆ‘ç»å¸¸éœ€è¦åœ¨æŸäº›æ“ä½œä¸­åˆ›å»ºä¸´æ—¶æ–‡ä»¶ï¼Œæ¯æ¬¡éƒ½å¾ˆç¹çï¼šå¿…é¡»æœ‰åˆé€‚çš„ä¸´æ—¶ç›®å½•ï¼Œç¡®ä¿æ–‡ä»¶åæ˜¯å”¯ä¸€çš„ï¼Œæœ€åè¿˜ä¸èƒ½å¿˜è®°åœ¨æ“ä½œå®Œæˆä¹‹ååˆ é™¤æ–‡ä»¶ã€‚&lt;/p&gt;
&lt;p&gt;å®é™…ä¸Šï¼Œâ€œåˆ›å»ºâ€æ˜¯ä¸€ä¸ªé”™è¯¯çš„è¯´æ³•ï¼Œå› ä¸ºåˆ›å»ºå·¥ä½œé€šå¸¸æ˜¯ç”±æˆ‘ä½¿ç”¨çš„ API è´Ÿè´£çš„ â€” è€Œæˆ‘åªæ˜¯æä¾›äº†ä¸€ä¸ªæŒ‡å‘ç›®çš„ä½ç½®çš„ URLã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾ä½ çš„åº”ç”¨æä¾›äº†ä¸€ä¸ªåˆ†äº« PDF æ–‡ä»¶çš„åŠŸèƒ½ã€‚ä½ éœ€è¦åˆ›å»ºä¸€ä¸ª &lt;a href=&quot;https://developer.apple.com/documentation/uikit/uigraphicspdfrenderer&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;&lt;code&gt;UIGraphicsPDFRenderer&lt;/code&gt;&lt;/a&gt;å¯¹è±¡æ¥ç”Ÿæˆ PDFï¼Œç„¶åè°ƒç”¨ &lt;a href=&quot;https://developer.apple.com/documentation/uikit/uigraphicspdfrenderer/1649119-writepdf&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;&lt;code&gt;writePDF&lt;/code&gt;&lt;/a&gt; æ–¹æ³•å¹¶ä¼ å…¥ä¸´æ—¶æ–‡ä»¶çš„ URL ç”Ÿæˆ PDF æ–‡ä»¶ï¼Œæœ€ååœ¨ iOS åˆ†äº«åˆ—è¡¨ï¼ˆshare sheetï¼‰ä¸­åˆ†äº«å®ƒã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†ä½¿è¿™ä¸ªæ“ä½œæ›´åŠ ç®€ä¾¿ï¼Œæˆ‘æœ€è¿‘å†™äº†ä¸€ä¸ªç®€å•çš„ Swift å·¥å…·ç±»ã€‚ä½ å¯ä»¥è¿™æ ·ä½¿ç”¨ï¼š&lt;/p&gt;
    
    </summary>
    
      <category term="Ole Begemann" scheme="https://swift.gg/categories/Ole-Begemann/"/>
    
    
      <category term="Swift" scheme="https://swift.gg/tags/Swift/"/>
    
  </entry>
  
  <entry>
    <title>Swift ä¸­çš„ Error Handling</title>
    <link href="https://swift.gg/2018/05/31/error-handling-swift/"/>
    <id>https://swift.gg/2018/05/31/error-handling-swift/</id>
    <published>2018-05-31T00:00:00.000Z</published>
    <updated>2018-09-10T03:53:25.081Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ä½œè€…ï¼šNick Hananï¼Œ<a href="http://www.codingexplorer.com/error-handling-swift/" target="_blank" rel="noopener">åŸæ–‡é“¾æ¥</a>ï¼ŒåŸæ–‡æ—¥æœŸï¼š2016/05/05<br>è¯‘è€…ï¼š<a href="undefined">TonyHan</a>ï¼›æ ¡å¯¹ï¼š<a href="http://blog.yousanflics.com.cn" target="_blank" rel="noopener">Yousanflics</a>ï¼›å®šç¨¿ï¼š<a href="http://forelax.space" target="_blank" rel="noopener">Forelax</a></p></blockquote><!--æ­¤å¤„å¼€å§‹æ­£æ–‡--><p><img src="/img/articles/error-handling-swift/ErrorHandlingInSwiftTitle.png1527734952.362786" alt=""></p><p>ç†æƒ³æƒ…å†µä¸‹ï¼Œé”™è¯¯æ°¸è¿œä¸ä¼šå‡ºç°ã€‚æˆ‘ä»¬æ‰€éœ€çš„æ–‡ä»¶æ°¸è¿œå¯ä»¥è®¿é—®ï¼Œç½‘ç»œæ°¸è¿œå¯ç”¨å¹¶ä¸”ç¨³å®šã€‚ä¸å¹¸çš„æ˜¯ï¼Œç°å®å¹¶ä¸ç†æƒ³ï¼Œæˆ‘ä»¬éœ€è¦å¤„ç†è¿™ç§ä¸ç†æƒ³çš„ç»“æœã€‚å¹¸è¿çš„æ˜¯ï¼ŒSwift å›¢é˜Ÿåœ¨ Swift 2 ä¸­åŒ…å«äº†ä¸€ç§å¾ˆå¥½çš„æ–¹å¼æ¥å¤„ç†ä¸ç†æƒ³æƒ…å†µçš„åå·®ã€‚Swift Error Handling èƒ½å¤Ÿè®©æˆ‘ä»¬å¿«é€Ÿè€Œç®€ä¾¿çš„å‘ŠçŸ¥ç¼–è¯‘å™¨ä¸€ä¸ªå‡½æ•°èƒ½å¦æŠ›å‡ºé”™è¯¯ï¼Œå¹¶ä¸”åœ¨æŠ›å‡ºåä»¥åˆé€‚çš„æ–¹å¼å»å¤„ç†é”™è¯¯ã€‚</p><a id="more"></a><p>Objective-C å¤„ç†é”™è¯¯çš„æ–¹å¼ä¸æ–°çš„ Swift Error Handling æœ‰ä¸€ä¸ªä¸»è¦åŒºåˆ«ã€‚å¦‚æœä½ ä¹‹å‰åœ¨ Objective-C ä¸­å¤„ç†è¿‡ NSErrorï¼Œè¯´å®è¯ï¼Œåœ¨å¤„ç†å¯èƒ½æŠ›å‡ºé”™è¯¯çš„æ–¹æ³•æ—¶ï¼Œä½ æœ‰æ²¡æœ‰è¿‡ä¸ºå…¶èµ‹å€¼ä¸º â€œnilâ€ è€Œä¸æ˜¯ NSError æŒ‡é’ˆï¼Ÿæ˜¯çš„ï¼Œæˆ‘ä¹Ÿæ˜¯è¿™ä¹ˆè®¤ä¸ºã€‚åœ¨ Objective-C ä¸­ï¼Œè¦æ­£ç¡®çš„å¤„ç†é”™è¯¯ï¼Œä½ éœ€è¦è¿™æ ·åšï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">NSError *err = nil;</span><br><span class="line">NSString *fileStuff = [[NSString alloc] initWithContentsOfFile:@&quot;someFile.txt&quot; encoding:NSUTF8StringEncoding error:&amp;err];</span><br></pre></td></tr></table></figure><p>ä¸Šè¿°ä»£ç æ‰€åšçš„ï¼Œæ˜¯åˆ›å»ºä¸€ä¸ªç©ºçš„ NSError å¯¹è±¡ï¼Œç„¶åä½ å¯ä»¥ç”¨ ï¼† ç¬¦å·ä¼ å…¥æ„é€ æ–¹æ³•ï¼Œï¼† ç¬¦å·ç”¨äºè¾¨è¯†å‡ºä¼ å…¥çš„æ˜¯å˜é‡åœ°å€ã€‚ç„¶åï¼Œå¦‚æœæœ‰é”™è¯¯ï¼Œæ–¹æ³•æˆ–æ„é€ å‡½æ•°å¯ä»¥é€šè¿‡æ­¤åœ°å€æ‰¾åˆ°å¯¹åº”çš„å†…å­˜ï¼Œå°† NSError èµ‹å€¼è¿‡å»ï¼Œç„¶åé€€å‡ºå‡½æ•°ã€‚å°†å¯èµ‹å€¼çš„åœ°å€ä½œä¸ºå‚æ•°ä¼ å…¥ï¼Œæ˜¯ä¸€ç§å®ç°å‡½æ•°å¤šè¿”å›å€¼çš„æ‰‹æ®µã€‚åœ¨ Swift ä¸­è¿™è¢«è½¬å˜æˆäº†æ–¹æ³•åŸå‹ä¸­çš„ â€œinoutâ€ å…³é”®å­—ã€‚</p><p>ç°åœ¨ï¼Œå¦‚æœæœ‰é”™è¯¯ï¼Œä½ å¯ä»¥æŸ¥çœ‹ â€œerrâ€ å˜é‡ï¼Œä»è€Œç¡®è®¤æ˜¯ä»€ä¹ˆé”™è¯¯ï¼Œç„¶åæ­£ç¡®çš„å¤„ç†é”™è¯¯ã€‚ä½†æ˜¯ï¼Œå¦‚æœä¸å…³å¿ƒé”™è¯¯ï¼Œå¯ä»¥ä¸ä¼ é”™è¯¯æŒ‡é’ˆï¼ˆå³ &amp;errï¼‰è€Œç›´æ¥ä¼ å…¥ â€œnilâ€ï¼Œç„¶åä»»ä½• NSError éƒ½ä¼šè¢«å¿½ç•¥æ‰ã€‚</p><p>Swift ä¸­æ–°çš„é”™è¯¯å¤„ç†çš„è¯­æ³•ï¼Œä½¿é”™è¯¯å¤„ç†æ›´åŠ æ˜ç¡®ã€‚å‡½æ•°ä¼šæ˜ç¡®çš„æ ‡è¯†å‡ºå®ƒä»¬ä¼šæŠ›å‡ºé”™è¯¯ï¼Œä½ çš„ç¨‹åºéœ€è¦å¯¹æ­¤å¾ˆæ˜ç¡®ï¼ŒåŒæ—¶è¦æ­£ç¡®å¤„ç†è¿™äº›é”™è¯¯ï¼ˆæˆ–æ˜ç¡®åœ°å¿½ç•¥ï¼‰ã€‚</p><h4 id="åˆ›å»º-Swift-é”™è¯¯"><a href="#åˆ›å»º-Swift-é”™è¯¯" class="headerlink" title="åˆ›å»º Swift é”™è¯¯"></a>åˆ›å»º Swift é”™è¯¯</h4><p>è¿™å¯çœŸæ˜¯ä¸ªå¥‡æ€ªçš„æ ‡é¢˜ï¼Œä»€ä¹ˆæ˜¯åˆ›å»ºä¸€ä¸ªé”™è¯¯ï¼Ÿäº‹å®ä¸Šï¼Œæˆ‘ä»¬æ˜¯è¦åˆ›å»ºä¸€ä¸ªèƒ½å¤Ÿè¡¨ç¤ºç¨‹åºä¸­çœŸå®é”™è¯¯çš„å®ä¾‹ã€‚å¦‚æœä¸€åˆ‡è¿è¡Œæ­£å¸¸ï¼Œæˆ–è€…æ–‡ä»¶ç”šè‡³ä¸å­˜åœ¨ï¼Œè¿™å½“ç„¶æ²¡é—®é¢˜ã€‚å¦‚æœå­˜åœ¨ï¼Œç”¨æˆ·å¯èƒ½æ²¡æœ‰è®¿é—®æƒé™ï¼Œæˆ–è€…æ–‡ä»¶å› ä¸ºæœªçŸ¥åŸå› æŸåã€‚æˆ‘ä»¬éœ€è¦ä¸ºè¦è®¿é—®è¿™ä¸ªæ–‡ä»¶çš„å‡½æ•°åˆ›å»º Swift Error å¹¶åˆ—å‡ºä»¥ä¸‹é€‰é¡¹ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">FileReadingError</span>: <span class="title">ErrorType</span> </span>&#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="type">FileNotFound</span></span><br><span class="line">    <span class="keyword">case</span> <span class="type">InsufficientPermission</span></span><br><span class="line">    <span class="keyword">case</span> <span class="type">FileCorrupted</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚ä¸Šæ‰€ç¤ºï¼Œåˆ›å»º Swift Error çš„æœ€ç®€å•æ–¹æ³•æ˜¯åˆ›å»ºç¬¦åˆ ErrorType åè®®çš„æšä¸¾ã€‚ç„¶ååˆ—å‡ºä»£è¡¨ä¸åŒé”™è¯¯æƒ…å†µçš„é€‰é¡¹ã€‚ä»æŠ€æœ¯æ¥è®²ï¼Œä»»ä½•å¯¹è±¡éƒ½å¯ä»¥ç¬¦åˆ ErrorType åè®®ï¼Œæ‰€ä»¥ä½ å¯ä»¥ä½¿ç”¨ä¸€ä¸ªç»“æ„ä½“æˆ–ä¸€ä¸ªç±»ï¼Œä½†æˆ‘è§‰å¾—ä¸åº”è¯¥è¿™æ ·åšã€‚æšä¸¾æ˜¯æ›´å®Œç¾çš„æ–¹æ¡ˆï¼Œå®ƒèƒ½å¤Ÿåˆ—ä¸¾å‡ºæœ‰é™æ•°ç›®çš„é”™è¯¯åç§°ã€‚å…³è”å€¼çš„åŠŸèƒ½ä¼šè®©æšä¸¾æ›´å¼ºå¤§ï¼Œæ¯”å¦‚è¯´ï¼Œä½ å¯ä»¥ä½¿ç”¨ InsufficientPermissionï¼Œæ¥æ˜¾ç¤ºå‡ºå½“å‰ç”¨æˆ·çš„æƒé™ç­‰çº§ã€‚å¦‚æœæƒ³äº†è§£æ›´å¤šå…³äºæšä¸¾çš„å†…å®¹ï¼Œè¯·æŸ¥çœ‹è¿™ç¯‡æ–‡ç«  <a href="http://www.codingexplorer.com/enumerations-swift/" target="_blank" rel="noopener">Enumerations in Swift</a>ã€‚</p><p>ç°åœ¨æˆ‘ä»¬æ¥åˆ›å»ºä¸€ä¸ªèƒ½æŠ›å‡ºé”™è¯¯çš„å‡½æ•°ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">pretendToReadTestFile</span><span class="params">()</span></span> <span class="keyword">throws</span> -&gt; <span class="type">NSData</span> &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="type">FileReadingError</span>.<span class="type">FileNotFound</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¥½å§ï¼Œä¸Šè¿°ä»£ç å®é™…ä¸Šä»€ä¹ˆä¹Ÿä¸ä¼šè¿”å›ï¼Œåªä¼šè‡ªåŠ¨æŠ›å‡ºé”™è¯¯ï¼Œä½†æˆ‘ä»¬åªæ˜¯æƒ³äº†è§£å¦‚ä½•å®ç°æŠ›å‡ºé”™è¯¯çš„æœºåˆ¶ï¼Œè€Œå¹¶éçœŸæ­£å®ç°ä¸€ä¸ªè®¿é—®æ–‡ä»¶å¹¶è¿”å›æ–‡ä»¶å†…å®¹çš„å‡½æ•°ã€‚</p><p>é¦–å…ˆï¼Œä½ å¿…é¡»å°†æ–¹æ³•æ ‡è®°ä¸ºèƒ½å¤ŸæŠ›å‡ºé”™è¯¯ã€‚è¦å®ç°è¿™ä¸ªï¼Œåªéœ€è¦åœ¨åœ¨å‚æ•°ä¹‹åã€ç”¨äºè¡¨ç¤ºè¿”å›ç±»å‹çš„ç®­å¤´ â€œ -&gt; â€œ ä¹‹å‰ä½¿ç”¨ â€œthrowsâ€ å…³é”®å­—å³å¯ã€‚æ¥ä¸‹æ¥è¦åœ¨å‡½æ•°å†…éƒ¨å®ç°æŠ›å‡ºé”™è¯¯ï¼Œåªéœ€è¦è¾“å…¥ â€œthrowâ€ ç„¶ååˆ—å‡ºæƒ³è¦ä½œä¸ºé”™è¯¯çš„é€‰é¡¹ã€‚å°±æ˜¯è¿™ä¹ˆç®€å•ï¼</p><p>åªéœ€è¦åœ¨è°ƒç”¨å‡½æ•°ä¹‹å‰ä½¿ç”¨ â€œtryâ€ å…³é”®å­—ï¼Œä¾¿å¯ä»¥æ•è·å‡½æ•°çš„é”™è¯¯ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> data = <span class="keyword">try</span> pretendToReadTestFile()</span><br></pre></td></tr></table></figure><h4 id="å¤„ç†-Swift-Errors"><a href="#å¤„ç†-Swift-Errors" class="headerlink" title="å¤„ç† Swift Errors"></a>å¤„ç† Swift Errors</h4><p>ä¸»è¦æœ‰å››ç§å¤„ç† Swift Errors çš„æ–¹å¼ï¼š</p><h5 id="è®©å…¶ä»–äººå¤„ç†"><a href="#è®©å…¶ä»–äººå¤„ç†" class="headerlink" title="è®©å…¶ä»–äººå¤„ç†"></a>è®©å…¶ä»–äººå¤„ç†</h5><p>ç¬¬ä¸€ç§æ–¹æ³•å°±æ˜¯ä¸åšå¤„ç†ï¼Œè®©å…¶ä»–äººæ¥å¤„ç†ã€‚è¦å®ç°è¿™ä¸ªç‰¹æ€§ï¼Œéœ€è¦å°†å‡½æ•°æ ‡è®°ä¸ºä¼šæŠ›å‡ºé”™è¯¯çš„å‡½æ•°ã€‚ä¹‹åå†è°ƒç”¨æ­¤å‡½æ•°æ—¶åˆ™å¿…é¡»è¿›è¡Œå¤„ç†ã€‚æœ€ç»ˆéœ€è¦æœ‰åœ°æ–¹æ¥æ­£ç¡®å¤„ç†é”™è¯¯ï¼Œä½†ä¸ä¸€å®šæ˜¯è°ƒç”¨æŠ›å‡ºé”™è¯¯æ–¹æ³•çš„åœ°æ–¹ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæœ‰ä¸€ä¸ªè´Ÿè´£è¯»å†™æˆ–å…¶ä»–æ–‡ä»¶ç®¡ç†æ“ä½œçš„æ–‡ä»¶ç®¡ç†å™¨å¯¹è±¡ï¼Œæˆ‘ä»¬å¯èƒ½åªæƒ³å°†é”™è¯¯æŠ›ç»™è°ƒç”¨è€…è€Œä¸æ˜¯åœ¨å…¶é‡Œé¢å¤„ç†ã€‚</p><p>è¦å®ç°ä¸Šè¿°ç‰¹æ€§ï¼Œåªéœ€è¦ç”¨ â€œthrowsâ€ å…³é”®å­—æ ‡è®°å‡½æ•°å³å¯ã€‚è¿™ä»ç„¶éœ€è¦ç”¨ â€œtryâ€ å°†è°ƒç”¨åŠŸèƒ½å‡½æ•°çš„å‡½æ•°æ ‡è®°ä¸ºå¯èƒ½æŠ›å‡ºé”™è¯¯ã€‚å¦‚æœéœ€è¦å­˜å‚¨æŠ›å‡ºé”™è¯¯å‡½æ•°çš„è¿”å›å€¼ï¼Œåªéœ€è¦æ­£å¸¸è°ƒç”¨å‡½æ•°ç„¶åä¿å­˜æ•°æ®å³å¯ï¼Œä½†éœ€è¦åœ¨ç­‰å·å’Œå‡½æ•°è°ƒç”¨ä¹‹é—´ä½¿ç”¨ â€œtryâ€ å…³é”®å­—ã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">getDataFromSomething</span><span class="params">()</span></span> <span class="keyword">throws</span> -&gt; <span class="type">NSData</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">let</span> data = <span class="keyword">try</span> pretendToReadTestFile()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> data</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="å¤„ç†ç‰¹å®šçš„-Swift-Errors"><a href="#å¤„ç†ç‰¹å®šçš„-Swift-Errors" class="headerlink" title="å¤„ç†ç‰¹å®šçš„ Swift Errors"></a>å¤„ç†ç‰¹å®šçš„ Swift Errors</h5><p>åœ¨å…¶ä»–è¯­è¨€ä¸­ï¼Œè¿™å¯èƒ½æ˜¯æœ€ç†Ÿæ‚‰çš„ç”¨æ¥å¤„ç†å¼‚å¸¸çš„æ–¹æ³•äº†ã€‚Swift Error çš„å¤„ç†æ–¹å¼ä¸å¼‚å¸¸çš„å¤„ç†æœ‰æ˜¾è‘—çš„ä¸åŒï¼Œä¼šæ›´é«˜æ•ˆã€‚æŠ›å‡º Swift Error æ›´åƒæ˜¯æ›¿ä»£äº†è¿”å›è¯­å¥ï¼Œè‡³å°‘åœ¨ä½¿ç”¨æ–¹å¼ä¸Šæ˜¯è¿™æ ·ï¼šå‡½æ•°ä¼šè¿”å›ç›¸åº”çš„ Swift Errorï¼Œè€Œä¸æ˜¯è¿”å›æŸä¸ªé¢„æœŸçš„è¿”å›å€¼ã€‚</p><p>é¦–å…ˆä½¿ç”¨ â€œdoâ€ è¯­å¥å°†æŠ›å‡ºé”™è¯¯çš„å‡½æ•°åŒ…è£¹èµ·æ¥ï¼Œç„¶åä½¿ç”¨ â€œcatchâ€ è¯­å¥ï¼Œæœ‰ç‚¹åƒ Switch çš„ â€œcaseâ€ è¯­å¥ï¼Œæˆ–è€… if è¯­å¥çš„ else-ifï¼Œæ¥å¾—åˆ°éœ€è¦çš„ Swift Errorsï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> someData = <span class="keyword">try</span> pretendToReadTestFile()</span><br><span class="line">&#125; <span class="keyword">catch</span> <span class="type">FileReadingError</span>.<span class="type">FileNotFound</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"The file was not found."</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»£ç å— â€œdoâ€ åŒ…å«äº†è°ƒç”¨æŠ›å‡ºé”™è¯¯çš„å‡½æ•°çš„ä»£ç ã€‚å¦‚æœå‡ºç°é”™è¯¯ï¼Œå°†ä¼šè·³è½¬åˆ°å¯¹åº”çš„ catch è¯­å¥ï¼Œå¾ˆåƒ switch case è¯­å¥ã€‚åŒæ—¶ï¼Œå¦‚æœè€ƒè™‘ä¸åˆ°æ‰€æœ‰å¯èƒ½çš„é”™è¯¯æƒ…å†µï¼Œåˆ™éœ€è¦ç±»ä¼¼ Switch è¯­å¥ä¸­ â€œdefaultâ€ æˆ– if è¯­å¥ä¸­ â€œelseâ€ çš„é€‰é¡¹ï¼Œåªç”¨ â€œcatchâ€ æ¥å¤„ç†å…¶ä½™æ‰€æœ‰çš„ Swift Errorï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> someData = <span class="keyword">try</span> pretendToReadTestFile()</span><br><span class="line">&#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"Something weird happened."</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="æŠ›å‡ºé”™è¯¯çš„å‡½æ•°è¿”å›å¯é€‰ç±»å‹"><a href="#æŠ›å‡ºé”™è¯¯çš„å‡½æ•°è¿”å›å¯é€‰ç±»å‹" class="headerlink" title="æŠ›å‡ºé”™è¯¯çš„å‡½æ•°è¿”å›å¯é€‰ç±»å‹"></a>æŠ›å‡ºé”™è¯¯çš„å‡½æ•°è¿”å›å¯é€‰ç±»å‹</h5><p>å¦‚æœåªéœ€è¦è¿”å›å€¼æˆ–æ˜¯å¦æœ‰è¿”å›å€¼ï¼Œè€Œä¸å…³å¿ƒæ˜¯ä»€ä¹ˆé”™è¯¯ï¼Œå¬èµ·æ¥è¿™æœ‰ç‚¹åƒ Swift çš„å¯é€‰ç±»å‹ã€‚è¿™æ ·çš„è¯ï¼Œå³ä¾¿è¿”å›å€¼ä¸æ˜¯å¯é€‰çš„ï¼Œä¹Ÿå¯ä»¥å‘Šè¯‰ç¼–è¯‘å™¨â€œå¦‚æœæœ‰é”™è¯¯ï¼Œæˆ‘ä¹Ÿå¹¶ä¸å…³å¿ƒï¼Œåªéœ€è¦å°†è¿”å›å€¼è®¾ç½®ä¸º nilâ€ã€‚å¯ä»¥åœ¨ â€œtryâ€ å…³é”®å­—åé¢ä½¿ç”¨é—®å·ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> possibleData = <span class="keyword">try</span>? pretendToReadTestFile()</span><br><span class="line"><span class="comment">//possibleData now contains "nil"</span></span><br></pre></td></tr></table></figure><p>æ ¹æ®å®é™…éœ€è¦æ¥å†³å®šä½¿ç”¨ do-catch è¯­å¥è¿˜æ˜¯ä½¿ç”¨ä¸Šè¿°æ–¹å¼æ¥å¤„ç†æŒ‡å®šçš„é”™è¯¯ã€‚å¦‚æœçš„ç¡®ä¸éœ€è¦æ˜ç¡®é”™è¯¯åŸå› ï¼Œæˆ–è€…é”™è¯¯åŸå› å¾ˆæ˜æ˜¾ï¼Œé‚£ä¹ˆä½¿ç”¨ â€œtry?â€ å°†æ›´åˆé€‚ã€‚å¦‚æœæ˜¯ç½‘ç»œè°ƒç”¨ï¼Œé”™è¯¯æ˜¯ç”±äºæ— æ•ˆçš„ URLã€è¿æ¥å¤±è´¥è¿˜æ˜¯æ— æ³•æ‰¾åˆ°ä¸»æœºå¯¹äºä½ çš„ App çš„ç”¨æˆ·æœ‰æ„ä¹‰ä¹ˆï¼Ÿå¯¹äºæœ‰çš„ App æˆ–è®¸æœ‰æ„ä¹‰ï¼Œä½†ä¹Ÿæœ‰çš„æ²¡æœ‰æ„ä¹‰ï¼Œä¸Šé¢é‚£ä¸‰ç§æƒ…å†µéƒ½æ„å‘³ç€æ²¡æœ‰æ‹¿åˆ°æ•°æ®ã€‚æ—¢ç„¶æ²¡æœ‰è¯·æ±‚åˆ°æ•°æ®ï¼Œé‚£ä¹ˆ â€œnilâ€ å·²ç»å¯ä»¥å‘ŠçŸ¥ä½ çš„ä»£ç å¦‚ä½•å¤„ç†æ­¤ç§æƒ…å†µã€‚</p><h5 id="ç¡®ä¿ç¼–è¯‘å™¨ä¸ä¼šæŠ›å‡º-Error"><a href="#ç¡®ä¿ç¼–è¯‘å™¨ä¸ä¼šæŠ›å‡º-Error" class="headerlink" title="ç¡®ä¿ç¼–è¯‘å™¨ä¸ä¼šæŠ›å‡º Error"></a>ç¡®ä¿ç¼–è¯‘å™¨ä¸ä¼šæŠ›å‡º Error</h5><p>å¦‚æœæœ‰ä½¿ç”¨é—®å·çš„ç‰ˆæœ¬ï¼Œé‚£ä¹ˆä½ å¯ä»¥çŒœåˆ°è¿™ä¸ªåœ°æ–¹å¯èƒ½ä¼šæœ‰æ„Ÿå¹å·çš„ç‰ˆæœ¬ï¼ˆè¯‘è€…æ³¨ï¼šå¯é€‰ç±»å‹å’Œå¼ºåˆ¶è§£åŒ…ï¼‰ã€‚å¦‚æœä½¿ç”¨ â€œtry!â€ï¼Œæ›´åƒæ˜¯å¼ºåˆ¶è§£åŒ…å¯é€‰ç±»å‹ã€‚ä½ å¯ä»¥è°ƒç”¨æŠ›å‡ºé”™è¯¯çš„å‡½æ•°ï¼Œä½†å¦‚æœçœŸçš„æŠ›å‡ºé”™è¯¯ï¼ŒApp å°†ä¼šå´©æºƒã€‚å¦‚æœä½ ç¡®è®¤è°ƒç”¨ä¸ä¼šå‡ºé—®é¢˜ï¼Œå¯ä»¥ä½¿ç”¨è¿™ç§æ–¹å¼ã€‚Apple çš„ iBook è§£é‡Šäº†ä¸€ç§åŸå› ï¼Œå³ä½¿ç”¨æŠ›å‡ºé”™è¯¯çš„å‡½æ•°æ¥è®¿é—® App çš„ bundle ä¸­çš„æ–‡ä»¶ã€‚æ—¢ç„¶èµ„æºæ¥è‡ª Appï¼Œé‚£å®ƒå°±åº”è¯¥å­˜åœ¨ï¼Œæ‰€ä»¥ä¸ä¼šå‡ºç° â€œFile Not Foundâ€ æˆ–å…¶ä»–ç±»ä¼¼é”™è¯¯ã€‚å¦‚æœçœŸå‡ºç°äº†é”™è¯¯ï¼Œé‚£ä¹ˆåº”è¯¥è€ƒè™‘ä¸‹æ˜¯ä¸æ˜¯æœ‰æ›´ä¸¥é‡çš„é—®é¢˜ã€‚</p><p>å¦‚æœæˆ‘ä»¬çš„å‡½æ•°æ€»ä¼šæŠ›å‡ºé”™è¯¯ï¼Œé‚£è¿™ç§æ–¹å¼è‚¯å®šä¼šå¼•å‘å´©æºƒï¼Œä»¥ä¸‹ä»…ä»…å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ï¼ˆé¡ºä¾¿çœ‹ä¸‹å´©æºƒæ˜¯ä»€ä¹ˆæ ·ï¼‰ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> definitelyNoData = <span class="keyword">try</span>! pretendToReadTestFile()</span><br><span class="line"><span class="comment">//Execution was interrupted, reason:  EXC_BAD_INSTRUCTION</span></span><br><span class="line"><span class="comment">//error: 'try!' expression unexpectedly raised an error: FileReadingError.FileNotFound</span></span><br></pre></td></tr></table></figure><h4 id="ç»“è®º"><a href="#ç»“è®º" class="headerlink" title="ç»“è®º"></a>ç»“è®º</h4><blockquote><p>è¯‘è€…æ³¨:æ‰€æœ‰è´´å‡ºçš„ä»£ç éƒ½åœ¨ Xcode 7.3.1 è¿›è¡Œäº†æµ‹è¯•ã€‚</p></blockquote><p>Swift Team åœ¨ Swift ä¸­å®ç°äº†é”™è¯¯çš„å¤„ç†ï¼Œè¿™ç‚¹æˆ‘æ„Ÿåˆ°å¾ˆæ»¡æ„ã€‚è¡¨é¢ä¸Šçœ‹è¿™æ˜¯ä¸€ç§ç›¸å½“å¸¸è§çš„å¤„ç†æ–¹å¼ï¼Œä½†å®é™…ä¸Šï¼Œè¿™æ›´é«˜æ•ˆï¼Œå¹¶ä¸”ä¸å…¶è¡¨äº² â€œException Handlingâ€ ç›¸æ¯”å±å®³æ›´å°ã€‚ä¸ç”¨ä½¿ç”¨è°ƒç”¨æ ˆï¼Œä»…ä»…é€šè¿‡ä¸åŒçš„è¿”å›å€¼æ¥å‘Šè¯‰æˆ‘ä»¬é”™è¯¯çš„æ€§è´¨ã€‚</p><p>æˆ‘å¸Œæœ›è¿™ç¯‡æ–‡ç« å¯¹è¯»è€…æœ‰æ‰€å¸®åŠ©ã€‚å¦‚æœçœŸçš„æ˜¯è¿™æ ·ï¼Œè¯·æ¯«ä¸çŠ¹è±«åœ°åœ¨ Twitter æˆ–å…¶ä»–ç¤¾äº¤åª’ä½“ä¸Šåˆ†äº«è¿™ç‰‡æ–‡ç« ï¼Œä»»ä½•åˆ†äº«éƒ½å¯ä»¥ã€‚å½“ç„¶ï¼Œå¦‚æœæœ‰ä»»ä½•ç–‘é—®ï¼Œä¹Ÿè¯·æ¯«ä¸çŠ¹è±«åœ°åˆ°è”ç³»<a href="http://www.codingexplorer.com/contact/" target="_blank" rel="noopener">é¡µé¢è”ç³»</a>æˆ‘ï¼Œæˆ–è€…åœ¨ Twitter ä¸Š <a href="https://twitter.com/CodingExplorer" target="_blank" rel="noopener">@CodingExplorer</a>ï¼Œæˆ‘ä¼šå°½é‡æä¾›å¸®åŠ©çš„ã€‚è°¢è°¢ï¼</p><h4 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h4><ul><li><a href="https://itunes.apple.com/us/book/swift-programming-language/id881256329?mt=11&amp;uo=4&amp;at=10lJ3x&amp;ct=blog-SwiftErrorHandling" target="_blank" rel="noopener">The Swift Programming Language â€“ Apple Inc.</a></li></ul><blockquote><p>è¯‘è€…æ³¨ï¼šç›®å‰åœ¨ä¸­å›½å¤§é™† iBooks ä¸å¯ç”¨ã€‚<br>æœ¬æ–‡ç”± SwiftGG ç¿»è¯‘ç»„ç¿»è¯‘ï¼Œå·²ç»è·å¾—ä½œè€…ç¿»è¯‘æˆæƒï¼Œæœ€æ–°æ–‡ç« è¯·è®¿é—® <a href="http://swift.gg">http://swift.gg</a>ã€‚</p></blockquote>]]></content>
    
    <summary type="html">
    
      Xcode 7.3.1, Swift 2.2
    
    </summary>
    
      <category term="Coding Explorer Blog" scheme="https://swift.gg/categories/Coding-Explorer-Blog/"/>
    
    
      <category term="Swift" scheme="https://swift.gg/tags/Swift/"/>
    
  </entry>
  
</feed>
