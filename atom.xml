<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>SwiftGG</title>
  
  <subtitle>èµ°å¿ƒçš„ Swift ç¿»è¯‘ç»„</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://swift.gg/"/>
  <updated>2019-02-18T08:52:32.961Z</updated>
  <id>https://swift.gg/</id>
  
  <author>
    <name>SwiftGG</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>åè®®ä¸­çš„ç§æœ‰å±æ€§</title>
    <link href="https://swift.gg/2019/02/18/protocols-private-properties/"/>
    <id>https://swift.gg/2019/02/18/protocols-private-properties/</id>
    <published>2019-02-18T00:00:00.000Z</published>
    <updated>2019-02-18T08:52:32.961Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ä½œè€…ï¼šOlivier Halligonï¼Œ<a href="http://alisoftware.github.io/swift/protocols/2018/09/02/protocols-private-properties/" target="_blank" rel="noopener">åŸæ–‡é“¾æ¥</a>ï¼ŒåŸæ–‡æ—¥æœŸï¼š2018-09-02<br>è¯‘è€…ï¼š<a href="https://github.com/dzyding" target="_blank" rel="noopener">ç°s</a>ï¼›æ ¡å¯¹ï¼š<a href="http://numbbbbb.com/" target="_blank" rel="noopener">numbbbbb</a>ï¼Œ<a href="http://linusling.com" target="_blank" rel="noopener">å°é“åŒ Linus</a>ï¼›å®šç¨¿ï¼š<a href="http://forelax.space" target="_blank" rel="noopener">Forelax</a></p></blockquote><!--æ­¤å¤„å¼€å§‹æ­£æ–‡--><p>åœ¨ Swift ä¸­ï¼Œåè®®ä¸èƒ½å¯¹å…¶å£°æ˜çš„å±æ€§è¿›è¡ŒæŒ‡å®šçš„è®¿é—®æ§åˆ¶ã€‚å¦‚æœåè®®ä¸­åˆ—å‡ºäº†æŸä¸ªå±æ€§ï¼Œåˆ™å¿…é¡»ä½¿éµå®ˆåè®®çš„ç±»å‹æ˜¾å¼å£°æ˜è¿™äº›å±æ€§ã€‚  </p><p>ä¸è¿‡æœ‰äº›æ—¶å€™ï¼Œå°½ç®¡ä½ ä¼šåœ¨åè®®ä¸­å£°æ˜ä¸€äº›å±æ€§ï¼Œä½†ä½ æ˜¯è¦åˆ©ç”¨è¿™äº›å±æ€§æ¥æä¾›ä½ çš„å®ç°ï¼Œå¹¶ä¸å¸Œæœ›è¿™äº›å±æ€§åœ¨ç±»å‹çš„å¤–éƒ¨è¢«ä½¿ç”¨ã€‚è®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜ã€‚ </p><a id="more"></a><h2 id="ä¸€ä¸ªç®€å•çš„ä¾‹å­"><a href="#ä¸€ä¸ªç®€å•çš„ä¾‹å­" class="headerlink" title="ä¸€ä¸ªç®€å•çš„ä¾‹å­"></a>ä¸€ä¸ªç®€å•çš„ä¾‹å­</h2><p>å‡è®¾ä½ éœ€è¦åˆ›å»ºä¸€ä¸ªä¸“é—¨çš„å¯¹è±¡æ¥ç®¡ç†ä½ çš„è§†å›¾æ§åˆ¶å™¨ï¼ˆViewControllersï¼‰å¯¼èˆªï¼Œæ¯”å¦‚ä¸€ä¸ªåè°ƒå™¨ï¼ˆCoordinatorï¼‰ã€‚  </p><p>æ¯ä¸ªåè°ƒå™¨éƒ½æœ‰ä¸€ä¸ªæ ¹æ§åˆ¶å™¨ <code>UINavigationController</code>ï¼Œå¹¶å…±äº«ä¸€äº›é€šç”¨çš„åŠŸèƒ½ï¼Œæ¯”å¦‚åœ¨å®ƒä¸Šé¢æ¨è¿›ï¼ˆpushï¼‰å’Œå¼¹å‡ºï¼ˆpopï¼‰å…¶ä»– ViewControllerã€‚æ‰€ä»¥æœ€åˆå®ƒçœ‹èµ·æ¥å¯èƒ½æ˜¯è¿™æ · <a href="#foot1" id="1"><sup>[1]</sup></a>ï¼š  </p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Coordinator.swift</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">Coordinator</span> </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> navigationController: <span class="type">UINavigationController</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">  <span class="keyword">var</span> childCoordinator: <span class="type">Coordinator</span>? &#123; <span class="keyword">get</span> <span class="keyword">set</span> &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">push</span><span class="params">(viewController: UIViewController, animated: Bool)</span></span></span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">present</span><span class="params">(childViewController: UIViewController, animated: Bool)</span></span></span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">pop</span><span class="params">(animated: Bool)</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Coordinator</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">push</span><span class="params">(viewController: UIViewController, animated: Bool = <span class="literal">true</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">self</span>.navigationController.pushViewController(viewController, animated: animated)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">present</span><span class="params">(childCoordinator: Coordinator, animated: Bool)</span></span> &#123;</span><br><span class="line">    <span class="keyword">self</span>.navigationController.present(childCoordinator.navigationController, animated: animated) &#123; [<span class="keyword">weak</span> <span class="keyword">self</span>] <span class="keyword">in</span></span><br><span class="line">      <span class="keyword">self</span>?.childCoordinator = childCoordinator</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">pop</span><span class="params">(animated: Bool = <span class="literal">true</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> childCoordinator = <span class="keyword">self</span>.childCoordinator &#123;</span><br><span class="line">      <span class="keyword">self</span>.dismissViewController(animated: animated) &#123; [<span class="keyword">weak</span> <span class="keyword">self</span>] <span class="keyword">in</span></span><br><span class="line">        <span class="keyword">self</span>?.childCoordinator = <span class="literal">nil</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">self</span>.navigationController.popViewController(animated: animated)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“æˆ‘ä»¬æƒ³è¦å£°æ˜ä¸€ä¸ªæ–°çš„ <code>Coordinator</code> å¯¹è±¡æ—¶ï¼Œä¼šåƒè¿™æ ·åšï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// MainCoordinator.swift</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MainCoordinator</span>: <span class="title">Coordinator</span> </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> navigationController: <span class="type">UINavigationController</span> = <span class="type">UINavigationController</span>()</span><br><span class="line">  <span class="keyword">var</span> childCoordinator: <span class="type">Coordinator</span>?</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">showTutorialPage1</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">let</span> vc = makeTutorialPage(<span class="number">1</span>, coordinator: <span class="keyword">self</span>)</span><br><span class="line">    <span class="keyword">self</span>.push(viewController: vc)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">showTutorialPage2</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">let</span> vc = makeTutorialPage(<span class="number">2</span>, coordinator: <span class="keyword">self</span>)</span><br><span class="line">    <span class="keyword">self</span>.push(viewController: vc)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">makeTutorialPage</span><span class="params">(<span class="number">_</span> num: Int, coordinator: Coordinator)</span></span> -&gt; <span class="type">UIViewController</span> &#123; â€¦ &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="é—®é¢˜ï¼šæ³„æ¼å®ç°ç»†èŠ‚"><a href="#é—®é¢˜ï¼šæ³„æ¼å®ç°ç»†èŠ‚" class="headerlink" title="é—®é¢˜ï¼šæ³„æ¼å®ç°ç»†èŠ‚"></a>é—®é¢˜ï¼šæ³„æ¼å®ç°ç»†èŠ‚</h2><p>è¿™ä¸ªè§£å†³æ–¹æ¡ˆåœ¨ <code>protocol</code> çš„å¯è§æ€§ä¸Šæœ‰ä¸¤ä¸ªé—®é¢˜ï¼š  </p><ul><li>æ¯å½“æˆ‘ä»¬æƒ³è¦å£°æ˜ä¸€ä¸ªæ–°çš„ <code>Coordinator</code> å¯¹è±¡ï¼Œéƒ½å¿…é¡»æ˜¾å¼çš„å£°æ˜ä¸€ä¸ª <code>let navigationController: UINavigationController</code> å±æ€§å’Œä¸€ä¸ª <code>var childCoordinator: Coordinator?</code> å±æ€§ã€‚<strong>è™½ç„¶ï¼Œåœ¨éµå®ˆåè®®çš„ç±»å‹ç°å®ä¸­ï¼Œæˆ‘ä»¬å¹¶æ²¡æœ‰æ˜¾å¼çš„ä½¿ç”¨ä»–ä»¬</strong> - ä½†å®ƒä»¬å°±åœ¨é‚£é‡Œï¼Œå› ä¸ºæˆ‘ä»¬éœ€è¦å®ƒä»¬ä½œä¸ºé»˜è®¤çš„å®ç°æ¥ä¾› <code>protocol Coordinator</code> æ­£å¸¸å·¥ä½œã€‚  </li><li>æˆ‘ä»¬å¿…é¡»å£°æ˜çš„è¿™ä¸¤ä¸ªå±æ€§å…·æœ‰ä¸ <code>MainCoordinator</code> ç›¸åŒçš„å¯è§æ€§ï¼ˆåœ¨æœ¬ä¾‹ä¸­ä¸ºéšå¼ <code>internalï¼ˆå†…éƒ¨ï¼‰</code> è®¿é—®æ§åˆ¶çº§åˆ«ï¼‰ï¼Œå› ä¸ºè¿™æ˜¯ <code>protocol Coordinator</code> çš„å¿…å¤‡æ¡ä»¶ã€‚è¿™ä½¿å¾—å®ƒä»¬å¯¹å¤–éƒ¨å¯è§ï¼Œå°±åƒåœ¨ç¼–ç æ—¶å¯ä»¥ä½¿ç”¨ <code>MainCoordinator</code>ã€‚  </li></ul><p>æ‰€ä»¥é—®é¢˜æ˜¯æˆ‘ä»¬æ¯æ¬¡éƒ½è¦å£°æ˜ä¸€äº›å±æ€§â€”â€”å³ä½¿å®ƒåªæ˜¯ä¸€äº›å®ç°ç»†èŠ‚ï¼Œè€Œä¸”è¿™äº›å®ç°ç»†èŠ‚ä¼šé€šè¿‡å¤–éƒ¨æ¥å£è¢«æ³„æ¼ï¼Œä»è€Œå…è®¸ç±»çš„è®¿é—®è€…åšä¸€äº›æœ¬ä¸åº”è¯¥è¢«å…è®¸çš„äº‹ï¼Œä¾‹å¦‚ï¼š  </p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> mainCoord = <span class="type">MainCoordinator</span>()</span><br><span class="line"><span class="comment">// è®¿é—®è€…ä¸åº”è¯¥è¢«å…è®¸ç›´æ¥è®¿é—® navigationController ï¼Œä½†æ˜¯ä»–ä»¬å¯ä»¥</span></span><br><span class="line">mainCoord.navigationController.dismissViewController(animated: <span class="literal">true</span>)</span><br><span class="line"><span class="comment">// ä»–ä»¬ä¹Ÿä¸åº”è¯¥è¢«å…è®¸åšè¿™æ ·çš„äº‹æƒ…</span></span><br><span class="line">mainCoord.childCoordinator = mainCoord</span><br></pre></td></tr></table></figure><p>ä¹Ÿè®¸ä½ ä¼šè®¤ä¸ºï¼Œæ—¢ç„¶æˆ‘ä»¬ä¸å¸Œæœ›å®ƒä»¬æ˜¯å¯è§çš„ï¼Œé‚£ä¹ˆå¯ä»¥ç›´æ¥åœ¨ç¬¬ä¸€æ®µä»£ç çš„ <code>protocol</code> ä¸­ä¸å£°æ˜è¿™ä¸¤ä¸ªå±æ€§ã€‚ä½†æ˜¯å¦‚æœæˆ‘ä»¬è¿™æ ·åšï¼Œå°†æ— æ³•é€šè¿‡ <code>extension Coordinator</code> æ¥æä¾›é»˜è®¤çš„å®ç°ï¼Œå› ä¸ºé»˜è®¤çš„å®ç°éœ€è¦è¿™ä¸¤ä¸ªå±æ€§å­˜åœ¨ä»¥ä¾¿å®ƒä»¬çš„ä»£ç è¢«ç¼–è¯‘ã€‚  </p><p>ä½ å¯èƒ½å¸Œæœ› Swift å…è®¸åœ¨åè®®ä¸­ç”³æ˜è¿™äº›å±æ€§ä¸º <code>fileprivate</code>ï¼Œä½†æ˜¯åœ¨ Swift 4 ä¸­ï¼Œä½ ä¸èƒ½åœ¨ <code>protocols</code> ä¸­ä½¿ç”¨ä»»ä½•è®¿é—®æ§åˆ¶çš„å…³é”®å­—ã€‚  </p><p>æ‰€ä»¥æˆ‘ä»¬å¦‚ä½•æ‰èƒ½è§£å†³è¿™ä¸ªâ€œæ—¢è¦æä¾›ç”¨åˆ°è¿™ä¸ªå±æ€§çš„é»˜è®¤å®ç°ï¼Œæœ‰ä¸è®©è¿™äº›å±æ€§å¯¹å¤–æš´éœ²â€çš„é—®é¢˜å‘¢ï¼Ÿ</p><h2 id="ä¸€ä¸ªè§£å†³æ–¹æ¡ˆ"><a href="#ä¸€ä¸ªè§£å†³æ–¹æ¡ˆ" class="headerlink" title="ä¸€ä¸ªè§£å†³æ–¹æ¡ˆ"></a>ä¸€ä¸ªè§£å†³æ–¹æ¡ˆ</h2><p>å®ç°è¿™ä¸€ç‚¹çš„ä¸€ä¸ªæŠ€å·§æ˜¯å°†è¿™äº›å±æ€§éšè—åœ¨ä¸­é—´å¯¹è±¡ä¸­ï¼Œå¹¶åœ¨è¯¥å¯¹è±¡ä¸­å°†å¯¹åº”çš„å±æ€§å£°æ˜ä¸º <code>fileprivate</code>ã€‚  </p><p>é€šè¿‡è¿™ç§æ–¹å¼ï¼Œå°½ç®¡æˆ‘ä»¬ä¾æ—§åœ¨å¯¹åº”ç±»å‹çš„å…¬å…±æ¥å£ä¸­å£°æ˜äº†å±æ€§ï¼Œä½†æ˜¯æ¥å£çš„è®¿é—®è€…å´ä¸èƒ½è®¿é—®è¯¥å¯¹è±¡çš„å†…éƒ¨å±æ€§ã€‚è€Œæˆ‘ä»¬å¯¹äºåè®®çš„é»˜è®¤å®ç°å´èƒ½å¤Ÿè®¿é—®å®ƒä»¬ â€”â€” åªè¦å®ƒä»¬åœ¨åŒä¸€ä¸ªæ–‡ä»¶ä¸­è¢«å£°æ˜å°±è¡Œäº†ï¼ˆå› ä¸ºå®ƒä»¬æ˜¯ <code>fileprivate</code> ï¼‰ã€‚  </p><p>çœ‹èµ·æ¥å°±åƒè¿™æ ·ï¼š  </p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Coordinator.swift</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CoordinatorComponents</span> </span>&#123;</span><br><span class="line">  <span class="keyword">fileprivate</span> <span class="keyword">let</span> navigationController: <span class="type">UINavigationController</span> = <span class="type">UINavigationController</span>()</span><br><span class="line">  <span class="keyword">fileprivate</span> <span class="keyword">var</span> childCoordinator: <span class="type">Coordinator</span>? = <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">Coordinator</span>: <span class="title">AnyObject</span> </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> coordinatorComponents: <span class="type">CoordinatorComponents</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">push</span><span class="params">(viewController: UIViewController, animated: Bool)</span></span></span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">present</span><span class="params">(childCoordinator: Coordinator, animated: Bool)</span></span></span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">pop</span><span class="params">(animated: Bool)</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Coordinator</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">push</span><span class="params">(viewController: UIViewController, animated: Bool = <span class="literal">true</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">self</span>.coordinatorComponents.navigationController.pushViewController(viewController, animated: animated)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">present</span><span class="params">(childCoordinator: Coordinator, animated: Bool = <span class="literal">true</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">let</span> childVC = childCoordinator.coordinatorComponents.navigationController</span><br><span class="line">    <span class="keyword">self</span>.coordinatorComponents.navigationController.present(childVC, animated: animated) &#123; [<span class="keyword">weak</span> <span class="keyword">self</span>] <span class="keyword">in</span></span><br><span class="line">      <span class="keyword">self</span>?.coordinatorComponents.childCoordinator = childCoordinator <span class="comment">// retain the child strongly</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">pop</span><span class="params">(animated: Bool = <span class="literal">true</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">let</span> privateAPI = <span class="keyword">self</span>.coordinatorComponents</span><br><span class="line">    <span class="keyword">if</span> privateAPI.childCoordinator != <span class="literal">nil</span> &#123;</span><br><span class="line">      privateAPI.navigationController.dismiss(animated: animated) &#123; [<span class="keyword">weak</span> privateAPI] <span class="keyword">in</span></span><br><span class="line">        privateAPI?.childCoordinator = <span class="literal">nil</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      privateAPI.navigationController.popViewController(animated: animated)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">```  </span><br><span class="line"></span><br><span class="line">ç°åœ¨ï¼Œéµå®ˆåè®®çš„ `<span class="type">MainCoordinator</span>` ç±»å‹ï¼š  </span><br><span class="line"></span><br><span class="line">- ä»…éœ€è¦å£°æ˜ä¸€ä¸ª `<span class="keyword">let</span> coordinatorComponents = <span class="type">CoordinatorComponents</span>() ` å±æ€§ï¼Œå¹¶ä¸ç”¨çŸ¥é“ `<span class="type">CoordinatorComponents</span>` ç±»å‹çš„å†…éƒ¨æœ‰äº›ä»€ä¹ˆï¼ˆéšè—äº†å®ç°ç»†èŠ‚ï¼‰ã€‚  </span><br><span class="line">- åœ¨ `<span class="type">MainCoordinator</span>.swift` æ–‡ä»¶ä¸­ï¼Œä¸èƒ½è®¿é—® `coordinatorComponents` çš„ä»»ä½•å±æ€§ï¼Œå› ä¸ºå®ƒä»¬è¢«å£°æ˜ä¸º `<span class="keyword">fileprivate</span>`ã€‚  </span><br><span class="line"></span><br><span class="line">```swift</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainCoordinator</span>: <span class="title">Coordinator</span> </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> coordinatorComponents = <span class="type">CoordinatorComponents</span>()</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">showTutorialPage1</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">let</span> vc = makeTutorialPage(<span class="number">1</span>, coordinator: <span class="keyword">self</span>)</span><br><span class="line">    <span class="keyword">self</span>.push(viewController: vc)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">showTutorialPage2</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">let</span> vc = makeTutorialPage(<span class="number">2</span>, coordinator: <span class="keyword">self</span>)</span><br><span class="line">    <span class="keyword">self</span>.push(viewController: vc)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">makeTutorialPage</span><span class="params">(<span class="number">_</span> num: Int, coordinator: Coordinator)</span></span> -&gt; <span class="type">UIViewController</span> &#123; â€¦ &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“ç„¶ï¼Œä½ ä»ç„¶éœ€è¦åœ¨éµå®ˆåè®®çš„ç±»å‹ä¸­å£°æ˜ <code>let coordinatorComponents</code> æ¥æä¾›å­˜å‚¨ï¼Œè¿™ä¸ªå£°æ˜å¿…é¡»æ˜¯å¯è§çš„ï¼ˆä¸èƒ½æ˜¯ <code>private</code>ï¼‰ï¼Œå› ä¸ºè¿™æ˜¯éµå®ˆ <code>protocol Coordinator</code> æ‰€è¦æ±‚çš„ä¸€éƒ¨åˆ†ã€‚ä½†æ˜¯ï¼š  </p><ul><li>åªéœ€è¦å£°æ˜ 1 ä¸ªå±æ€§ï¼Œå–ä»£ä¹‹å‰çš„ 2 ä¸ªï¼ˆåœ¨æ›´å¤æ‚çš„æƒ…å†µä¸‹ä¼šæœ‰æ›´å¤šï¼‰ã€‚  </li><li>æ›´é‡è¦çš„æ˜¯ï¼Œå³ä½¿å®ƒå¯ä»¥ä»éµå®ˆåè®®çš„ç±»å‹çš„å®ç°ä¸­è®¿é—®ï¼Œä¹Ÿå¯ä»¥ä»å¤–éƒ¨æ¥å£è®¿é—®ï¼Œä½ å´ä¸èƒ½å¯¹å®ƒåšä»»ä½•äº‹æƒ…ã€‚  </li></ul><p>å½“ç„¶ï¼Œä½ ä»ç„¶å¯ä»¥è®¿é—® <code>myMainCoordinator.coordinatorComponents</code>ï¼Œä½†æ˜¯ä¸èƒ½ä½¿ç”¨å®ƒåšä»»ä½•äº‹æƒ…ï¼Œå› ä¸ºå®ƒæ‰€æœ‰çš„å±æ€§éƒ½æ˜¯ <code>fileprivate</code> ï¼  </p><h2 id="ç»“è®º"><a href="#ç»“è®º" class="headerlink" title="ç»“è®º"></a>ç»“è®º</h2><p>Swift å¯èƒ½æ— æ³•æä¾›ä½ æƒ³è¦çš„æ‰€æœ‰åŠŸèƒ½ã€‚ä½ å¯èƒ½å¸Œæœ›æœ‰æœä¸€æ—¥ <code>protocols</code> å…è®¸å¯¹å®ƒå£°æ˜éœ€è¦çš„å±æ€§å’Œæ–¹æ³•ä½¿ç”¨è®¿é—®æ§åˆ¶å…³é”®å­—ï¼Œæˆ–è€…é€šè¿‡æŸç§æ–¹å¼å°†å®ƒä»¬åœ¨å…¬å…± API ä¸­éšè—ã€‚  </p><p>ä½†ä¸æ­¤åŒæ—¶ï¼ŒæŒæ¡è¿™äº›æŠ€å·§å’Œå˜é€šæ–¹æ³•å¯ä»¥ä½¿ä½ çš„å…¬å…± API æ›´å¥½ã€æ›´å®‰å…¨ï¼Œé¿å…æ³„éœ²å®ç°ç»†èŠ‚æˆ–è€…è®¿é—®åœ¨å®ç°ä¹‹å¤–ä¸åº”è¯¥è¢«ä¿®æ”¹çš„å±æ€§ï¼ŒåŒæ—¶ä»ç„¶ä½¿ç”¨ <a href="http://alisoftware.github.io/swift/protocol/2015/11/08/mixins-over-inheritance/" target="_blank" rel="noopener">Mixin pattern</a> å¹¶æä¾›é»˜è®¤å®ç°ã€‚  </p><hr><p><a id="foot1" href="#1"><sup>[1]</sup></a>.è¿™æ˜¯ä¸€ä¸ªç®€åŒ–çš„ä¾‹å­ï¼›ä¸è¦å°†æ³¨æ„åŠ›é›†ä¸­åœ¨ Coordinator çš„å®ç° - å®ƒä¸æ˜¯è¿™ä¸ªä¾‹å­çš„é‡ç‚¹ï¼Œæ›´åº”è¯¥å…³æ³¨çš„æ˜¯éœ€è¦åœ¨åè®®ä¸­å£°æ˜å…¬å¼€å¯è®¿é—®çš„å±æ€§ã€‚</p><blockquote><p>æœ¬æ–‡ç”± SwiftGG ç¿»è¯‘ç»„ç¿»è¯‘ï¼Œå·²ç»è·å¾—ä½œè€…ç¿»è¯‘æˆæƒï¼Œæœ€æ–°æ–‡ç« è¯·è®¿é—® <a href="http://swift.gg">http://swift.gg</a>ã€‚</p></blockquote>]]></content>
    
    <summary type="html">
    
      é€šè¿‡å¦ä¸€ç§æ–¹å¼æ¥æ§åˆ¶åè®®ä¸­å±æ€§å’Œæ–¹æ³•çš„è®¿é—®æƒé™
    
    </summary>
    
      <category term="Olivier Halligon" scheme="https://swift.gg/categories/Olivier-Halligon/"/>
    
      <category term="Swift" scheme="https://swift.gg/categories/Olivier-Halligon/Swift/"/>
    
    
      <category term="åè®®" scheme="https://swift.gg/tags/%E5%8D%8F%E8%AE%AE/"/>
    
  </entry>
  
  <entry>
    <title>SwiftSyntax</title>
    <link href="https://swift.gg/2019/01/25/nshipster-swiftsyntax/"/>
    <id>https://swift.gg/2019/01/25/nshipster-swiftsyntax/</id>
    <published>2019-01-25T00:00:00.000Z</published>
    <updated>2019-02-18T08:52:32.961Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ä½œè€…ï¼šMatttï¼Œ<a href="https://nshipster.com/swiftsyntax/" target="_blank" rel="noopener">åŸæ–‡é“¾æ¥</a>ï¼ŒåŸæ–‡æ—¥æœŸï¼š2018-10-22<br>è¯‘è€…ï¼š<a href="https://dingtz.com/" target="_blank" rel="noopener">jojotov</a>ï¼›æ ¡å¯¹ï¼š<a href="http://numbbbbb.com/" target="_blank" rel="noopener">numbbbbb</a>ï¼Œ<a href="http://blog.yousanflics.com.cn" target="_blank" rel="noopener">Yousanflics</a>ï¼Œ<a href="http://www.jianshu.com/users/596f2ba91ce9/latest_articles" target="_blank" rel="noopener">pmst</a>ï¼›å®šç¨¿ï¼š<a href="http://forelax.space" target="_blank" rel="noopener">Forelax</a></p></blockquote><!--æ­¤å¤„å¼€å§‹æ­£æ–‡--><p><a href="https://github.com/apple/swift-syntax" target="_blank" rel="noopener">SwiftSyntax</a> æ˜¯ä¸€ä¸ªå¯ä»¥åˆ†æã€ç”Ÿæˆä»¥åŠè½¬æ¢ Swift æºä»£ç çš„ Swift åº“ã€‚å®ƒæ˜¯åŸºäº <a href="https://github.com/apple/swift/tree/master/lib/Syntax" target="_blank" rel="noopener">libSyntax</a> åº“å¼€å‘çš„ï¼Œå¹¶äº <a href="https://github.com/apple/swift-syntax/commit/909d336aefacdcbdd45ec6130471644c1ae929f5" target="_blank" rel="noopener">2017 å¹´ 8 æœˆ</a> ä» Swift è¯­è¨€çš„ä¸»ä»“åº“ä¸­åˆ†ç¦»å‡ºæ¥ï¼Œå•ç‹¬å»ºç«‹äº†ä¸€ä¸ªä»“åº“ã€‚</p><a id="more"></a><p>æ€»çš„æ¥è¯´ï¼Œè¿™äº›åº“éƒ½æ˜¯ä¸ºäº†ç»™ç»“æ„åŒ–ç¼–è¾‘ï¼ˆstructured editingï¼‰æä¾›å®‰å…¨ã€æ­£ç¡®ä¸”ç›´è§‚çš„å·¥å…·ã€‚å…³äºç»“æ„åŒ–ç¼–è¾‘ï¼Œåœ¨ <a href="https://github.com/apple/swift/blob/master/lib/Syntax/README.md#swift-syntax-and-structured-editing-library" target="_blank" rel="noopener">thusly</a> ä¸­æœ‰å…·ä½“çš„æè¿°:</p><blockquote><p>ä»€ä¹ˆæ˜¯ç»“æ„åŒ–ç¼–è¾‘ï¼Ÿç»“æ„åŒ–ç¼–è¾‘æ˜¯ä¸€ç§ç¼–è¾‘çš„ç­–ç•¥ï¼Œå®ƒå¯¹æºä»£ç çš„<em>ç»“æ„</em>æ›´åŠ æ•æ„Ÿï¼Œè€Œæºä»£ç çš„è¡¨ç¤ºï¼ˆä¾‹å¦‚å­—ç¬¦æˆ–è€…å­—èŠ‚ï¼‰åˆ™æ²¡é‚£ä¹ˆé‡è¦ã€‚è¿™å¯ä»¥ç»†åŒ–ä¸ºä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†ï¼šæ›¿æ¢æ ‡è¯†ç¬¦ï¼Œå°†å¯¹å…¨å±€æ–¹æ³•çš„è°ƒç”¨è½¬ä¸ºå¯¹æ–¹æ³•çš„è°ƒç”¨ï¼Œæˆ–è€…æ ¹æ®å·²å®šçš„è§„åˆ™è¯†åˆ«å¹¶æ ¼å¼åŒ–æ•´ä¸ªæºæ–‡ä»¶ã€‚</p></blockquote><p>åœ¨å†™è¿™ç¯‡æ–‡ç« æ—¶ï¼ŒSwiftSyntax ä»å¤„äºåœ¨å¼€å‘ä¸­å¹¶è¿›è¡Œ API è°ƒæ•´çš„é˜¶æ®µã€‚ä¸è¿‡ç›®å‰ä½ å·²ç»å¯ä»¥ä½¿ç”¨å®ƒå¯¹ Swift ä»£ç è¿›è¡Œä¸€äº›ç¼–ç¨‹å·¥ä½œã€‚</p><p>ç›®å‰ï¼Œ<a href="https://github.com/apple/swift/tree/master/lib/Migrator" target="_blank" rel="noopener">Swift Migrator</a> å·²ç»åœ¨ä½¿ç”¨ SwiftSyntax äº†ï¼Œå¹¶ä¸”åœ¨å¯¹å†…å’Œå¯¹å¤–å±‚é¢ä¸Šï¼Œå¯¹ SwiftSyntax çš„æ¥å…¥ä¹Ÿåœ¨ä¸æ–­åœ°åŠªåŠ›ç€ã€‚</p><h2 id="SwiftSyntax-å¦‚ä½•å·¥ä½œï¼Ÿ"><a href="#SwiftSyntax-å¦‚ä½•å·¥ä½œï¼Ÿ" class="headerlink" title="SwiftSyntax å¦‚ä½•å·¥ä½œï¼Ÿ"></a>SwiftSyntax å¦‚ä½•å·¥ä½œï¼Ÿ</h2><p>ä¸ºäº†æ˜ç™½ SwiftSyntax å¦‚ä½•å·¥ä½œï¼Œæˆ‘ä»¬é¦–å…ˆè¦å›å¤´çœ‹çœ‹ Swift ç¼–è¯‘å™¨çš„æ¶æ„ï¼š</p><p><img src="https://nshipster.com/assets/swift-compilation-diagram-8af7d0078f72cdaa8f50430e608f15a9d4214f5772439d2fd6904bb5a8a53c60.png" alt=""></p><p>Swift ç¼–è¯‘å™¨çš„ä¸»è¦èŒè´£æ˜¯æŠŠ Swift ä»£ç è½¬æ¢ä¸ºå¯æ‰§è¡Œçš„æœºå™¨ä»£ç ã€‚æ•´ä¸ªè¿‡ç¨‹å¯ä»¥åˆ’åˆ†ä¸ºå‡ ä¸ªç¦»æ•£çš„æ­¥éª¤ï¼Œä¸€å¼€å§‹ï¼Œ<a href="https://github.com/apple/swift/tree/master/lib/Parse" target="_blank" rel="noopener">è¯­æ³•åˆ†æå™¨</a> ä¼šç”Ÿæˆä¸€ä¸ªæŠ½è±¡è¯­æ³•æ ‘ï¼ˆASTï¼‰ã€‚ä¹‹åï¼Œè¯­ä¹‰åˆ†æå™¨ä¼šè¿›è¡Œå·¥ä½œå¹¶ç”Ÿæˆä¸€ä¸ªé€šè¿‡ç±»å‹æ£€æŸ¥çš„ ASTã€‚è‡³æ­¤æ­¥éª¤ï¼Œä»£ç ä¼šé™çº§åˆ° <a href="https://github.com/apple/swift/blob/master/docs/SIL.rst" target="_blank" rel="noopener">Swift ä¸­é—´å±‚è¯­è¨€</a>ï¼›éšå SIL ä¼šç»§ç»­è½¬æ¢å¹¶ä¼˜åŒ–è‡ªèº«ï¼Œé™çº§ä¸º <a href="http://llvm.org/docs/LangRef.html" target="_blank" rel="noopener">LLVM IR</a>ï¼Œå¹¶æœ€ç»ˆç¼–è¯‘ä¸ºæœºå™¨ä»£ç ã€‚</p><p>å¯¹äºæˆ‘ä»¬çš„è®¨è®ºæ¥è¯´ï¼Œæœ€é‡è¦çš„å…³é”®ç‚¹æ˜¯ SwiftSyntax çš„æ“ä½œç›®æ ‡æ˜¯ç¼–è¯‘è¿‡ç¨‹ç¬¬ä¸€æ­¥æ‰€ç”Ÿæˆçš„ ASTã€‚ä½†ä¹Ÿç”±äºè¿™æ ·ï¼ŒSwiftSyntax æ— æ³•å‘ŠçŸ¥ä½ ä»»ä½•å…³äºä»£ç çš„è¯­ä¹‰æˆ–ç±»å‹ä¿¡æ¯ã€‚</p><p>ä¸ SwiftSyntax ç›¸åï¼Œä¸€äº›å¦‚ <a href="https://github.com/apple/swift/tree/master/tools/SourceKit" target="_blank" rel="noopener">SourceKit</a> ä¹‹ç±»çš„å·¥å…·ï¼Œæ“ä½œçš„ç›®æ ‡ä¸ºæ›´å®¹æ˜“ç†è§£çš„ Swift ä»£ç ã€‚è¿™å¯ä»¥å¸®åŠ©æ­¤ç±»å·¥å…·å®ç°ä¸€äº›ç¼–è¾‘å™¨ç›¸å…³çš„ç‰¹æ€§ï¼Œä¾‹å¦‚ä»£ç è¡¥å…¨æˆ–è€…æ–‡ä»¶ä¹‹é—´çš„è·³è½¬ã€‚è™½ç„¶ SwiftSyntax ä¸èƒ½åƒ SourceKit ä¸€æ ·å®ç°è·³è½¬æˆ–è€…è¡¥å…¨çš„åŠŸèƒ½ï¼Œä½†åœ¨è¯­æ³•å±‚é¢ä¸Šä¹Ÿæœ‰å¾ˆå¤šåº”ç”¨åœºæ™¯ï¼Œä¾‹å¦‚ä»£ç æ ¼å¼åŒ–å’Œè¯­æ³•é«˜äº®ã€‚</p><h3 id="æ­ç§˜-AST"><a href="#æ­ç§˜-AST" class="headerlink" title="æ­ç§˜ AST"></a>æ­ç§˜ AST</h3><p>æŠ½è±¡è¯­æ³•æ ‘åœ¨æŠ½è±¡å±‚é¢ä¸Šæ¯”è¾ƒéš¾ä»¥ç†è§£ã€‚å› æ­¤æˆ‘ä»¬å…ˆç”Ÿæˆä¸€ä¸ªç¤ºä¾‹æ¥ä¸€ç¹å…¶è²Œã€‚</p><p>ç•™æ„ä¸€ä¸‹å¦‚ä¸‹çš„ä¸€è¡Œ Swift ä»£ç ï¼Œå®ƒå£°æ˜äº†ä¸€ä¸ªåä¸º <code>one()</code> çš„å‡½æ•°ï¼Œå‡½æ•°è¿”å›å€¼ä¸º <code>1</code>ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">one</span><span class="params">()</span></span> -&gt; <span class="type">Int</span> &#123; <span class="keyword">return</span> <span class="number">1</span> &#125;</span><br></pre></td></tr></table></figure><p>åœ¨å‘½ä»¤è¡Œä¸­å¯¹æ­¤æ–‡ä»¶è¿è¡Œ <code>swiftc</code> å‘½ä»¤å¹¶ä¼ å…¥ <code>-frontend -emit-syntax</code> å‚æ•°ï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> xcrun swiftc -frontend -emit-syntax ./One.swift</span></span><br></pre></td></tr></table></figure><p>è¿è¡Œçš„ç»“æœä¸ºä¸€ä¸² JSON æ ¼å¼çš„ ASTã€‚å½“ä½ ç”¨ JSON æ ¼å¼æ¥å±•ç¤ºæ—¶ï¼ŒAST çš„ç»“æ„ä¼šè¡¨ç°çš„æ›´åŠ æ¸…æ™°ï¼š</p><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"kind"</span>: <span class="string">"SourceFile"</span>,</span><br><span class="line">    <span class="attr">"layout"</span>: [&#123;</span><br><span class="line">        <span class="attr">"kind"</span>: <span class="string">"CodeBlockItemList"</span>,</span><br><span class="line">        <span class="attr">"layout"</span>: [&#123;</span><br><span class="line">            <span class="attr">"kind"</span>: <span class="string">"CodeBlockItem"</span>,</span><br><span class="line">            <span class="attr">"layout"</span>: [&#123;</span><br><span class="line">                <span class="attr">"kind"</span>: <span class="string">"FunctionDecl"</span>,</span><br><span class="line">                <span class="attr">"layout"</span>: [<span class="literal">null</span>, <span class="literal">null</span>, &#123;</span><br><span class="line">                    <span class="attr">"tokenKind"</span>: &#123;</span><br><span class="line">                        <span class="attr">"kind"</span>: <span class="string">"kw_func"</span></span><br><span class="line">                    &#125;,</span><br><span class="line">                    <span class="attr">"leadingTrivia"</span>: [],</span><br><span class="line">                    <span class="attr">"trailingTrivia"</span>: [&#123;</span><br><span class="line">                        <span class="attr">"kind"</span>: <span class="string">"Space"</span>,</span><br><span class="line">                        <span class="attr">"value"</span>: <span class="number">1</span></span><br><span class="line">                    &#125;],</span><br><span class="line">                    <span class="attr">"presence"</span>: <span class="string">"Present"</span></span><br><span class="line">                &#125;, &#123;</span><br><span class="line">                    <span class="attr">"tokenKind"</span>: &#123;</span><br><span class="line">                        <span class="attr">"kind"</span>: <span class="string">"identifier"</span>,</span><br><span class="line">                        <span class="attr">"text"</span>: <span class="string">"one"</span></span><br><span class="line">                    &#125;,</span><br><span class="line">                    <span class="attr">"leadingTrivia"</span>: [],</span><br><span class="line">                    <span class="attr">"trailingTrivia"</span>: [],</span><br><span class="line">                    <span class="attr">"presence"</span>: <span class="string">"Present"</span></span><br><span class="line">                &#125;, ...</span><br></pre></td></tr></table></figure><p>Python ä¸­çš„ <code>json.tool</code> æ¨¡å—æä¾›äº†ä¾¿æ·åœ°æ ¼å¼åŒ– JSON çš„èƒ½åŠ›ã€‚ä¸”å‡ ä¹æ‰€æœ‰çš„ macOS ç³»ç»Ÿéƒ½å·²ç»é›†æˆäº†æ­¤æ¨¡å—ï¼Œå› æ­¤æ¯ä¸ªäººéƒ½å¯ä»¥ä½¿ç”¨å®ƒã€‚ä¸¾ä¸ªä¾‹å­ï¼Œä½ å¯ä»¥ä½¿ç”¨å¦‚ä¸‹çš„å‘½ä»¤å¯¹ç¼–è¯‘çš„è¾“å‡ºç»“æœä½¿ç”¨ <code>json.tool</code> æ ¼å¼åŒ–ï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> xcrun swiftc -frontend -emit-syntax ./One.swift | python -m json.tool</span></span><br></pre></td></tr></table></figure><p>åœ¨æœ€å¤–å±‚ï¼Œå¯ä»¥çœ‹åˆ° <code>SourceFile</code>ï¼Œå®ƒç”± <code>CodeBlockItemList</code> ä»¥åŠ <code>CodeBlockItemList</code> å†…éƒ¨çš„ <code>CodeBlockItem</code> è¿™å‡ ä¸ªéƒ¨åˆ†ç»„æˆã€‚å¯¹äºè¿™ä¸ªç¤ºä¾‹æ¥è¯´ï¼Œä»…æœ‰ä¸€ä¸ª <code>CodeBlockItem</code> å¯¹åº”å‡½æ•°çš„å®šä¹‰ï¼ˆ<code>FunctionDecl</code>ï¼‰ï¼Œå…¶è‡ªèº«åŒ…å«äº†å‡ ä¸ªå­ç»„ä»¶å¦‚å‡½æ•°ç­¾åã€å‚æ•°é—­åŒ…å’Œè¿”å›é—­åŒ…ã€‚</p><p>æœ¯è¯­ trivia ç”¨äºæè¿°ä»»ä½•æ²¡æœ‰å®é™…è¯­æ³•æ„ä¹‰çš„ä¸œè¥¿ï¼Œä¾‹å¦‚ç©ºæ ¼ã€‚æ¯ä¸ªæ ‡è®°ç¬¦ï¼ˆTokenï¼‰å¯ä»¥æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªè¡Œå‰å’Œè¡Œå°¾çš„ triviaã€‚ä¾‹å¦‚ï¼Œåœ¨è¿”å›çš„é—­åŒ…ï¼ˆ<code>-&gt; Int</code>ï¼‰ä¸­çš„ <code>Int</code> åçš„ç©ºæ ¼å¯ä»¥ç”¨å¦‚ä¸‹çš„è¡Œå°¾ trivia è¡¨ç¤ºï¼š</p><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"kind"</span>: <span class="string">"Space"</span>,</span><br><span class="line">  <span class="attr">"value"</span>: <span class="number">1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å¤„ç†æ–‡ä»¶ç³»ç»Ÿé™åˆ¶"><a href="#å¤„ç†æ–‡ä»¶ç³»ç»Ÿé™åˆ¶" class="headerlink" title="å¤„ç†æ–‡ä»¶ç³»ç»Ÿé™åˆ¶"></a>å¤„ç†æ–‡ä»¶ç³»ç»Ÿé™åˆ¶</h3><p>SwiftSyntax é€šè¿‡ä»£ç†ç³»ç»Ÿçš„ <code>swiftc</code> è°ƒç”¨æ¥ç”ŸæˆæŠ½è±¡è¯­æ³•æ ‘ã€‚ä½†æ˜¯ï¼Œè¿™ä¹Ÿé™åˆ¶äº†ä»£ç å¿…é¡»æ”¾åœ¨æŸä¸ªæ–‡ä»¶æ‰èƒ½è¿›è¡Œå¤„ç†ï¼Œè€Œæˆ‘ä»¬å´ç»å¸¸éœ€è¦å¯¹ä»¥å­—ç¬¦ä¸²è¡¨ç¤ºçš„ä»£ç è¿›è¡Œå¤„ç†ã€‚</p><p>ä¸ºäº†è§£å†³è¿™ä¸ªé™åˆ¶ï¼Œå…¶ä¸­ä¸€ç§åŠæ³•æ˜¯æŠŠä»£ç å†™å…¥ä¸€ä¸ªä¸´æ—¶æ–‡ä»¶å¹¶ä¼ å…¥åˆ°ç¼–è¯‘å™¨ä¸­ã€‚</p><p><a href="https://nshipster.com/nstemporarydirectory/" target="_blank" rel="noopener">æˆ‘ä»¬æ›¾ç»å°è¯•è¿‡å†™å…¥ä¸´æ—¶æ–‡ä»¶</a>ï¼Œä½†ç›®å‰ï¼Œæœ‰æ›´å¥½çš„ API å¯ä»¥å¸®åŠ©æˆ‘ä»¬å®Œæˆè¿™é¡¹å·¥ä½œï¼Œå®ƒç”±  <a href="https://github.com/apple/swift-package-manager" target="_blank" rel="noopener">Swift Package Manager</a> æœ¬èº«æä¾›ã€‚åœ¨ä½ çš„ <code>Package.swift</code> æ–‡ä»¶ä¸­ï¼Œæ·»åŠ å¦‚ä¸‹çš„åŒ…ä¾èµ–å…³ç³»ï¼Œå¹¶æŠŠ <code>Utility</code> ä¾èµ–æ·»åŠ åˆ°æ­£ç¡®çš„ target ä¸­ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">.package(url: <span class="string">"https://github.com/apple/swift-package-manager.git"</span>, from: <span class="string">"0.3.0"</span>),</span><br></pre></td></tr></table></figure><p>ç°åœ¨ï¼Œä½ å¯ä»¥åƒä¸‹é¢è¿™æ ·å¼•å…¥ <code>Basic</code> æ¨¡å—å¹¶ä½¿ç”¨ <code>TemporaryFile</code> APIï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Basic</span><br><span class="line"><span class="keyword">import</span> Foundation</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> code: <span class="type">String</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> tempfile = <span class="keyword">try</span> <span class="type">TemporaryFile</span>(deleteOnClose: <span class="literal">true</span>)</span><br><span class="line"><span class="keyword">defer</span> &#123; tempfile.fileHandle.closeFile() &#125;</span><br><span class="line">tempfile.fileHandle.write(code.data(using: .utf8)!)</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> url = <span class="type">URL</span>(fileURLWithPath: tempfile.path.asString)</span><br><span class="line"><span class="keyword">let</span> sourceFile = <span class="keyword">try</span> <span class="type">SyntaxTreeParser</span>.parse(url)</span><br></pre></td></tr></table></figure><h2 id="æˆ‘ä»¬å¯ä»¥ç”¨-SwiftSyntax-åšä»€ä¹ˆ"><a href="#æˆ‘ä»¬å¯ä»¥ç”¨-SwiftSyntax-åšä»€ä¹ˆ" class="headerlink" title="æˆ‘ä»¬å¯ä»¥ç”¨ SwiftSyntax åšä»€ä¹ˆ"></a>æˆ‘ä»¬å¯ä»¥ç”¨ SwiftSyntax åšä»€ä¹ˆ</h2><p>ç°åœ¨æˆ‘ä»¬å¯¹ SwiftSyntax å¦‚ä½•å·¥ä½œå·²ç»æœ‰äº†è¶³å¤Ÿçš„ç†è§£ï¼Œæ˜¯æ—¶å€™è®¨è®ºä¸€ä¸‹å‡ ä¸ªä½¿ç”¨å®ƒçš„æ–¹å¼äº†ï¼</p><h3 id="ç¼–å†™-Swift-ä»£ç ï¼šåœ°ç‹±æ¨¡å¼"><a href="#ç¼–å†™-Swift-ä»£ç ï¼šåœ°ç‹±æ¨¡å¼" class="headerlink" title="ç¼–å†™ Swift ä»£ç ï¼šåœ°ç‹±æ¨¡å¼"></a>ç¼–å†™ Swift ä»£ç ï¼šåœ°ç‹±æ¨¡å¼</h3><p>æˆ‘ä»¬ç¬¬ä¸€ä¸ªæƒ³åˆ°ï¼Œä½†å´æ˜¯æœ€æ²¡æœ‰å®é™…æ„ä¹‰çš„ SwiftSyntax ç”¨ä¾‹å°±æ˜¯è®©ç¼–å†™ Swift ä»£ç çš„éš¾åº¦æå‡å‡ ä¸ªæ•°é‡çº§ã€‚</p><p>åˆ©ç”¨ SwiftSyntax ä¸­çš„ <code>SyntaxFactory</code> APIsï¼Œæˆ‘ä»¬å¯ä»¥ç”Ÿæˆå®Œæ•´çš„ Swift ä»£ç ã€‚ä¸å¹¸çš„æ˜¯ï¼Œç¼–å†™è¿™æ ·çš„ä»£ç å¹¶ä¸åƒé—²åº­æ•£æ­¥èˆ¬è½»æ¾ã€‚</p><p>ç•™æ„ä¸€ä¸‹å¦‚ä¸‹çš„ç¤ºä¾‹ä»£ç ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftSyntax</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> structKeyword = <span class="type">SyntaxFactory</span>.makeStructKeyword(trailingTrivia: .spaces(<span class="number">1</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> identifier = <span class="type">SyntaxFactory</span>.makeIdentifier(<span class="string">"Example"</span>, trailingTrivia: .spaces(<span class="number">1</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> leftBrace = <span class="type">SyntaxFactory</span>.makeLeftBraceToken()</span><br><span class="line"><span class="keyword">let</span> rightBrace = <span class="type">SyntaxFactory</span>.makeRightBraceToken(leadingTrivia: .newlines(<span class="number">1</span>))</span><br><span class="line"><span class="keyword">let</span> members = <span class="type">MemberDeclBlockSyntax</span> &#123; builder <span class="keyword">in</span></span><br><span class="line">    builder.useLeftBrace(leftBrace)</span><br><span class="line">    builder.useRightBrace(rightBrace)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> structureDeclaration = <span class="type">StructDeclSyntax</span> &#123; builder <span class="keyword">in</span></span><br><span class="line">    builder.useStructKeyword(structKeyword)</span><br><span class="line">    builder.useIdentifier(identifier)</span><br><span class="line">    builder.useMembers(members)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(structureDeclaration)</span><br></pre></td></tr></table></figure><p><em>å”·ã€‚</em>é‚£æœ€åè¿™æ®µä»£ç è®©æˆ‘ä»¬å¾—åˆ°äº†ä»€ä¹ˆå‘¢ï¼Ÿ</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Example</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><em>ä»¤äººçª’æ¯çš„æ“ä½œã€‚</em></p><p>è¿™ç»ä¸æ˜¯ä¸ºäº†å–ä»£ <a href="https://nshipster.com/swift-gyb/" target="_blank" rel="noopener">GYB</a> æ¥ç”¨äºæ¯å¤©çš„ä»£ç ç”Ÿæˆã€‚ï¼ˆäº‹å®ä¸Šï¼Œ<a href="https://github.com/apple/swift/blob/master/lib/Syntax/SyntaxKind.cpp.gyb" target="_blank" rel="noopener">libSyntax</a> å’Œ <a href="https://github.com/apple/swift-syntax/blob/master/Sources/SwiftSyntax/SyntaxKind.swift.gyb" target="_blank" rel="noopener">SwiftSyntax</a> éƒ½ä½¿ç”¨äº† <code>gyb</code> æ¥ç”Ÿæˆæ¥å£ã€‚</p><p>ä½†è¿™ä¸ªæ¥å£åœ¨æŸäº›ç‰¹æ®Šçš„é—®é¢˜ä¸Šå´æ ¼å¤–æœ‰ç”¨ã€‚ä¾‹å¦‚ï¼Œä½ æˆ–è®¸ä¼šä½¿ç”¨ SwiftSyntax æ¥å®ç°ä¸€ä¸ª Swift ç¼–è¯‘å™¨çš„ <a href="https://en.wikipedia.org/wiki/Fuzzing" target="_blank" rel="noopener">æ¨¡ç³Šæµ‹è¯•</a>ï¼Œä½¿ç”¨å®ƒå¯ä»¥éšæœºç”Ÿæˆä¸€ä¸ªè¡¨é¢æœ‰æ•ˆå´å®é™…ä¸Šéå¸¸å¤æ‚çš„ç¨‹åºï¼Œä»¥æ­¤æ¥è¿›è¡Œå‹åŠ›æµ‹è¯•ã€‚</p><h2 id="é‡å†™-Swift-ä»£ç "><a href="#é‡å†™-Swift-ä»£ç " class="headerlink" title="é‡å†™ Swift ä»£ç "></a>é‡å†™ Swift ä»£ç </h2><p><a href="https://github.com/apple/swift-syntax#example" target="_blank" rel="noopener">åœ¨ SwiftSyntax çš„ README ä¸­æœ‰ä¸€ä¸ªç¤ºä¾‹</a> å±•ç¤ºäº†å¦‚ä½•ç¼–å†™ä¸€ä¸ªç¨‹åºæ¥éå†æºæ–‡ä»¶ä¸­çš„æ•´å‹å¹¶æŠŠä»–ä»¬çš„å€¼åŠ  1ã€‚</p><p>é€šè¿‡è¿™ä¸ªï¼Œä½ åº”è¯¥å·²ç»æ¨æ–­å¾—å‡ºå¦‚ä½•ä½¿ç”¨å®ƒæ¥åˆ›å»ºä¸€ä¸ªå…¸å‹çš„ <code>swift-format</code> å·¥å…·ã€‚</p><p>ä½†ç°åœ¨ï¼Œæˆ‘ä»¬å…ˆè€ƒè™‘ä¸€ä¸ªç›¸å½“<em>æ²¡æœ‰</em>æ•ˆç‡â€”â€”å¹¶ä¸”å¯èƒ½åœ¨ä¸‡åœ£èŠ‚ï¼ˆğŸƒï¼‰è¿™ç§éœ€è¦æ£è›‹çš„åœºæ™¯æ‰åˆé€‚çš„ç”¨ä¾‹ï¼Œæºä»£ç é‡å†™ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftSyntax</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ZalgoRewriter</span>: <span class="title">SyntaxRewriter</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">visit</span><span class="params">(<span class="number">_</span> token: TokenSyntax)</span></span> -&gt; <span class="type">Syntax</span> &#123;</span><br><span class="line">        <span class="keyword">guard</span> <span class="keyword">case</span> <span class="keyword">let</span> .stringLiteral(text) = token.tokenKind <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> token</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> token.withKind(.stringLiteral(zalgo(text)))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a href="https://gist.github.com/mattt/b46ab5027f1ee6ab1a45583a41240033" target="_blank" rel="noopener"><code>zalgo</code></a> å‡½æ•°æ˜¯ç”¨æ¥åšä»€ä¹ˆçš„ï¼Ÿå¯èƒ½ä¸çŸ¥é“ä¼šæ›´å¥½â€¦â€¦</p><p>ä¸ç®¡æ€æ ·ï¼Œåœ¨ä½ çš„æºä»£ç ä¸­è¿è¡Œè¿™ä¸ªé‡å†™å™¨ï¼Œå¯ä»¥æŠŠæ‰€æœ‰çš„æ–‡æœ¬å­—ç¬¦ä¸²è½¬æ¢ä¸ºåƒä¸‹é¢ä¸€æ ·çš„æ•ˆæœï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Before ğŸ‘‹ğŸ˜„</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">"Hello, world!"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// After ğŸ¦‘ğŸ˜µ</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">"HÍÍÌ‚ÌŸÍ©elÍ¬ÍœÍ†ÌµlÍÌªÌ£ÌÍ oÌ‹Ì¡ÍÌ¼Í“Ì›, wÍ¢ÍÌ½Ì‡ÍªoÌ•ÌŒÌ©Í”Ì²ÍrÌ‰Ì Ì¡Í‚Í“Ì·lÌ˜Ì†Í¯ÌŠÌ³d!"</span>)</span><br></pre></td></tr></table></figure><p><em>é¬¼é­…ä¸€èˆ¬ï¼Œå¯¹å§ï¼Ÿ</em></p><h2 id="é«˜äº®-Swift-ä»£ç "><a href="#é«˜äº®-Swift-ä»£ç " class="headerlink" title="é«˜äº® Swift ä»£ç "></a>é«˜äº® Swift ä»£ç </h2><p>è®©æˆ‘ä»¬ç”¨ä¸€ä¸ªçœŸæ­£å®ç”¨çš„ä¸œè¥¿æ¥æ€»ç»“æˆ‘ä»¬å¯¹ SwiftSyntax çš„æ¢ç©¶ï¼šä¸€ä¸ª Swift è¯­æ³•é«˜äº®å·¥å…·ã€‚</p><p>ä»è¯­æ³•é«˜äº®å·¥å…·çš„æ„ä¹‰ä¸Šæ¥è¯´ï¼Œå®ƒå¯ä»¥æŠŠæºä»£ç æŒ‰æŸç§æ–¹å¼æ ¼å¼åŒ–ä¸ºæ˜¾ç¤ºæ›´ä¸ºå‹å¥½çš„ HTMLã€‚</p><p><a href="https://github.com/NSHipster/nshipster.com" target="_blank" rel="noopener">NSHipster é€šè¿‡ Jekyll æ­å»º</a>ï¼Œå¹¶ä½¿ç”¨äº† Ruby çš„åº“ <a href="https://github.com/jneen/rouge" target="_blank" rel="noopener">Rouge</a> æ¥æ¸²æŸ“ä½ åœ¨æ¯ç¯‡æ–‡ç« ä¸­çœ‹åˆ°çš„ç¤ºä¾‹ä»£ç ã€‚å°½ç®¡å¦‚æ­¤ï¼Œç”±äº Swift çš„å¤æ‚è¯­æ³•å’Œè¿‡å¿«è¿­ä»£ï¼Œæ¸²æŸ“å‡ºæ¥çš„ HTML å¹¶ä¸æ˜¯ 100% æ­£ç¡®ã€‚</p><p>ä¸åŒäº <a href="https://github.com/jneen/rouge/blob/master/lib/rouge/lexers/swift.rb" target="_blank" rel="noopener">å¤„ç†ä¸€å †éº»çƒ¦çš„æ­£åˆ™è¡¨è¾¾å¼</a>ï¼Œæˆ‘ä»¬å¯ä»¥æ„é€ ä¸€ä¸ª <a href="https://github.com/NSHipster/SwiftSyntaxHighlighter" target="_blank" rel="noopener">è¯­æ³•é«˜äº®å™¨</a> æ¥æ”¾å¤§ SwiftSyntax å¯¹è¯­è¨€çš„ç†è§£çš„ä¼˜åŠ¿ã€‚</p><p>æ ¹æ®è¿™ä¸ªæ ¸å¿ƒç›®çš„ï¼Œå®ç°çš„æ–¹æ³•å¯ä»¥å¾ˆç›´æ¥ï¼šå®ç°ä¸€ä¸ª <code>SyntaxRewriter</code> çš„å­ç±»å¹¶é‡å†™ <code>visit(_:)</code> æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•ä¼šåœ¨éå†æºæ–‡ä»¶çš„æ¯ä¸ªæ ‡è¯†ç¬¦æ—¶è¢«è°ƒç”¨ã€‚é€šè¿‡åˆ¤æ–­æ¯ç§ä¸åŒçš„æ ‡è¯†ç¬¦ç±»å‹ï¼Œä½ å¯ä»¥æŠŠç›¸åº”çš„å¯é«˜äº®æ ‡è¯†ç¬¦æ˜ å°„ä¸º HTML æ ‡è®°ã€‚</p><p>ä¾‹å¦‚ï¼Œæ•°å­—æ–‡æœ¬å¯ä»¥ç”¨ç±»åæ˜¯ <code>m</code> å¼€å¤´çš„ <code>&lt;span&gt;</code> å…ƒç´ æ¥è¡¨ç¤ºï¼ˆ<code>mf</code> è¡¨ç¤ºæµ®ç‚¹å‹ï¼Œ<code>mi</code> è¡¨ç¤ºæ•´å‹ï¼‰ã€‚å¦‚ä¸‹æ˜¯å¯¹åº”çš„åœ¨ <code>SyntaxRewriter</code> å­ç±»ä¸­çš„ä»£ç ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftSyntax</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SwiftSyntaxHighlighter</span>: <span class="title">SyntaxRewriter</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> html: <span class="type">String</span> = <span class="string">""</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">visit</span><span class="params">(<span class="number">_</span> token: TokenSyntax)</span></span> -&gt; <span class="type">Syntax</span> &#123;</span><br><span class="line">        <span class="keyword">switch</span> token.tokenKind &#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">        <span class="keyword">case</span> .floatingLiteral(<span class="keyword">let</span> string):</span><br><span class="line">            html += <span class="string">"&lt;span class=\"mf\"&gt;<span class="subst">\(string)</span>&lt;/span&gt;"</span></span><br><span class="line">        <span class="keyword">case</span> .integerLiteral(<span class="keyword">let</span> string):</span><br><span class="line">            <span class="keyword">if</span> string.hasPrefix(<span class="string">"0b"</span>) &#123;</span><br><span class="line">                html += <span class="string">"&lt;span class=\"mb\"&gt;<span class="subst">\(string)</span>&lt;/span&gt;"</span></span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> string.hasPrefix(<span class="string">"0o"</span>) &#123;</span><br><span class="line">                html += <span class="string">"&lt;span class=\"mo\"&gt;<span class="subst">\(string)</span>&lt;/span&gt;"</span></span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> string.hasPrefix(<span class="string">"0x"</span>) &#123;</span><br><span class="line">                html += <span class="string">"&lt;span class=\"mh\"&gt;<span class="subst">\(string)</span>&lt;/span&gt;"</span></span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                html += <span class="string">"&lt;span class=\"mi\"&gt;<span class="subst">\(string)</span>&lt;/span&gt;"</span></span><br><span class="line">            &#125;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> token</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å°½ç®¡ <code>SyntaxRewritere</code> é’ˆå¯¹æ¯ä¸€ç§ä¸åŒç±»å‹çš„è¯­æ³•å…ƒç´ ï¼Œéƒ½å·²ç»å®ç°äº† <code>visit(:)</code> æ–¹æ³•ï¼Œä½†æˆ‘å‘ç°ä½¿ç”¨ä¸€ä¸ª <code>switch</code> è¯­å¥å¯ä»¥æ›´ç®€å•åœ°å¤„ç†æ‰€æœ‰å·¥ä½œã€‚ï¼ˆåœ¨ <code>default</code> åˆ†æ”¯ä¸­æ‰“å°å‡ºæ— æ³•å¤„ç†çš„æ ‡è®°ç¬¦ï¼Œå¯ä»¥æ›´å¥½åœ°å¸®åŠ©æˆ‘ä»¬æ‰¾åˆ°é‚£äº›æ²¡æœ‰å¤„ç†çš„æƒ…å†µï¼‰ã€‚è¿™ä¸æ˜¯æœ€ä¼˜é›…çš„å®ç°ï¼Œä½†é‰´äºæˆ‘å¯¹ SwiftSyntax ä¸è¶³çš„ç†è§£ï¼Œè¿™æ˜¯ä¸ªè¾ƒå¥½çš„å¼€ç«¯ã€‚</p><p>ä¸ç®¡æ€æ ·ï¼Œåœ¨å‡ ä¸ªå°æ—¶çš„å¼€å‘å·¥ä½œåï¼Œæˆ‘å·²ç»å¯ä»¥åœ¨ Swift å¤§é‡çš„è¯­æ³•ç‰¹æ€§ä¸­ï¼Œç”Ÿæˆå‡ºæ¯”è¾ƒç†æƒ³çš„æ¸²æŸ“è¿‡çš„è¾“å‡ºã€‚</p><p><img src="https://nshipster.com/assets/swiftsyntaxhightlighter-example-output-829aa64ab4bdf73a2e3070aab017e21e3db37ca0ee35079f0e89e22594806df0.png" alt=""></p><p>è¿™ä¸ªé¡¹ç›®éœ€è¦ä¸€ä¸ªåº“å’Œå‘½ä»¤è¡Œå·¥å…·çš„æ”¯æŒã€‚å¿«å» <a href="https://github.com/NSHipster/SwiftSyntaxHighlighter" target="_blank" rel="noopener">å°è¯•ä¸€ä¸‹ </a>ç„¶åè®©æˆ‘çŸ¥é“ä½ çš„æƒ³æ³•å§ï¼</p><blockquote><p>æœ¬æ–‡ç”± SwiftGG ç¿»è¯‘ç»„ç¿»è¯‘ï¼Œå·²ç»è·å¾—ä½œè€…ç¿»è¯‘æˆæƒï¼Œæœ€æ–°æ–‡ç« è¯·è®¿é—® <a href="http://swift.gg">http://swift.gg</a>ã€‚</p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;ä½œè€…ï¼šMatttï¼Œ&lt;a href=&quot;https://nshipster.com/swiftsyntax/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;åŸæ–‡é“¾æ¥&lt;/a&gt;ï¼ŒåŸæ–‡æ—¥æœŸï¼š2018-10-22&lt;br&gt;è¯‘è€…ï¼š&lt;a href=&quot;https://dingtz.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;jojotov&lt;/a&gt;ï¼›æ ¡å¯¹ï¼š&lt;a href=&quot;http://numbbbbb.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;numbbbbb&lt;/a&gt;ï¼Œ&lt;a href=&quot;http://blog.yousanflics.com.cn&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Yousanflics&lt;/a&gt;ï¼Œ&lt;a href=&quot;http://www.jianshu.com/users/596f2ba91ce9/latest_articles&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;pmst&lt;/a&gt;ï¼›å®šç¨¿ï¼š&lt;a href=&quot;http://forelax.space&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Forelax&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;!--æ­¤å¤„å¼€å§‹æ­£æ–‡--&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/apple/swift-syntax&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;SwiftSyntax&lt;/a&gt; æ˜¯ä¸€ä¸ªå¯ä»¥åˆ†æã€ç”Ÿæˆä»¥åŠè½¬æ¢ Swift æºä»£ç çš„ Swift åº“ã€‚å®ƒæ˜¯åŸºäº &lt;a href=&quot;https://github.com/apple/swift/tree/master/lib/Syntax&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;libSyntax&lt;/a&gt; åº“å¼€å‘çš„ï¼Œå¹¶äº &lt;a href=&quot;https://github.com/apple/swift-syntax/commit/909d336aefacdcbdd45ec6130471644c1ae929f5&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;2017 å¹´ 8 æœˆ&lt;/a&gt; ä» Swift è¯­è¨€çš„ä¸»ä»“åº“ä¸­åˆ†ç¦»å‡ºæ¥ï¼Œå•ç‹¬å»ºç«‹äº†ä¸€ä¸ªä»“åº“ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="Swift" scheme="https://swift.gg/categories/Swift/"/>
    
      <category term="NSHipster" scheme="https://swift.gg/categories/Swift/NSHipster/"/>
    
    
      <category term="Swift" scheme="https://swift.gg/tags/Swift/"/>
    
      <category term="NSHipster" scheme="https://swift.gg/tags/NSHipster/"/>
    
  </entry>
  
  <entry>
    <title>ä»¥æµçš„å½¢å¼æ‰§è¡Œ Multipart è¯·æ±‚</title>
    <link href="https://swift.gg/2019/01/21/streaming-multipart-requests/"/>
    <id>https://swift.gg/2019/01/21/streaming-multipart-requests/</id>
    <published>2019-01-21T00:00:00.000Z</published>
    <updated>2019-02-18T08:52:32.961Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ä½œè€…ï¼šSoroush Khanlouï¼Œ<a href="http://khanlou.com/2018/11/streaming-multipart-requests/" target="_blank" rel="noopener">åŸæ–‡é“¾æ¥</a>ï¼ŒåŸæ–‡æ—¥æœŸï¼š2018-11-14<br>è¯‘è€…ï¼š<a href="https://www.jianshu.com/u/076cc5e18bb8" target="_blank" rel="noopener">éƒ‘ä¸€ä¸€</a>ï¼›æ ¡å¯¹ï¼š<a href="http://numbbbbb.com/" target="_blank" rel="noopener">numbbbbb</a>ï¼Œ<a href="http://www.jianshu.com/users/596f2ba91ce9/latest_articles" target="_blank" rel="noopener">pmst</a>ï¼›å®šç¨¿ï¼š<a href="http://forelax.space" target="_blank" rel="noopener">Forelax</a></p></blockquote><!--æ­¤å¤„å¼€å§‹æ­£æ–‡--><p>Foundation æ¡†æ¶ä¸­çš„ URL ç±»æä¾›äº†éå¸¸å…¨é¢çš„åŠŸèƒ½ï¼Œæ­¤åè¿˜åœ¨ iOS 7 ä¸­æ–°å¢äº† URLSession ç±»ã€‚å°½ç®¡å¦‚æ­¤ï¼ŒåŸºç¡€åº“ä¸­ä»ç„¶ç¼ºå°‘ multipart æ–‡ä»¶ä¸Šä¼ çš„åŠŸèƒ½ã€‚</p><a id="more"></a><h2 id="ä»€ä¹ˆæ˜¯-multipart-è¯·æ±‚ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯-multipart-è¯·æ±‚ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯ multipart è¯·æ±‚ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯ multipart è¯·æ±‚ï¼Ÿ</h2><p>Multipart ç¼–ç å®é™…ä¸Šå°±æ˜¯åœ¨ç½‘ç»œä¸­ä¸Šä¼ å¤§å‹æ–‡ä»¶çš„æ–¹æ³•ã€‚åœ¨æµè§ˆå™¨ä¸­ï¼Œæœ‰æ—¶å€™ä½ ä¼šé€‰æ‹©ä¸€ä¸ªæ–‡ä»¶ä½œä¸ºè¡¨å•æäº¤å†…å®¹çš„ä¸€éƒ¨åˆ†ã€‚è¿™ä¸ªæ–‡ä»¶ä¾¿æ˜¯ä»¥ multipart è¯·æ±‚çš„æ–¹å¼å®ç°ä¸Šä¼ çš„ã€‚</p><p>ä¹ä¸€çœ‹ï¼Œmultipart è¯·æ±‚å’Œä¸€èˆ¬è¯·æ±‚å·®ä¸å¤šã€‚ä¸åŒä¹‹å¤„æ˜¯ multipart è¯·æ±‚é¢å¤–ä¸º <code>HTTP</code> è¯·æ±‚ä½“æŒ‡å®šäº†å”¯ä¸€ç¼–ç ã€‚åŒ JSON ç¼–ç ï¼ˆ<code>{&quot;key&quot;: &quot;value&quot;}</code>ï¼‰æˆ–è€… URL å­—ç¬¦ç¼–ç  (<code>key=value</code>) ç›¸æ¯”ï¼Œmultipart ç¼–ç å¹²çš„äº‹ç•¥å¾®æœ‰æ‰€ä¸åŒã€‚å› ä¸º multipart è¯·æ±‚ä½“å®é™…ä¸Šåªæ˜¯ä¸€ä¸²å­—èŠ‚æµï¼Œæ¥æ”¶ç«¯å®ä½“åœ¨è§£ææ•°æ®æ—¶ï¼Œéœ€è¦çŸ¥é“å­—èŠ‚æµä¸­å„ä¸ªéƒ¨åˆ†ä¹‹é—´çš„ç•Œé™ã€‚æ‰€ä»¥ multipart è¯·æ±‚éœ€è¦ä½¿ç”¨ â€œboundariesâ€ æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚åœ¨è¯·æ±‚é¦–éƒ¨çš„ <code>Content-Type</code> ä¸­ï¼Œå¯ä»¥å®šä¹‰ boundaryï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Accept: application/json</span><br><span class="line">Content-Type: multipart/form-data; boundary=khanlou.comNczcJGcxe</span><br></pre></td></tr></table></figure><p>Boundary çš„å…·ä½“å†…å®¹å¹¶ä¸é‡è¦ï¼Œå”¯ä¸€éœ€è¦æ³¨æ„çš„æ˜¯ï¼šåœ¨è¯·æ±‚ä½“ä¸­ï¼Œboundary æ˜¯ä¸èƒ½é‡å¤å‡ºç°ï¼ˆè¿™æ ·æ‰èƒ½ä½“ç° boundary çš„ä½œç”¨ï¼‰ã€‚ä½ å¯ä»¥ä½¿ç”¨ UUID ä½œä¸º boundaryã€‚</p><p>è¯·æ±‚çš„æ¯ä¸€éƒ¨åˆ†å¯ä»¥æ˜¯æ™®é€šæ•°æ®ï¼ˆæ¯”å¦‚å›¾ç‰‡ï¼‰æˆ–è€…å…ƒæ•°æ®ï¼ˆä¸€èˆ¬æ˜¯æ–‡æœ¬ï¼Œå¯¹åº”ä¸€ä¸ªåå­—ï¼Œç»„æˆä¸€ä¸ªé”®å€¼å¯¹ï¼‰ã€‚å¦‚æœæ•°æ®æ˜¯å›¾ç‰‡çš„è¯ï¼Œé‚£å®ƒçœ‹èµ·æ¥åº”è¯¥æ˜¯è¿™æ ·çš„ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">--&lt;boundary&gt;</span><br><span class="line">Content-Disposition: form-data; name=&lt;name&gt;; filename=&lt;filename.jpg&gt;</span><br><span class="line">Content-Type: image/jpeg</span><br><span class="line"></span><br><span class="line">&lt;image data&gt;</span><br></pre></td></tr></table></figure><p>å¦‚æœæ˜¯æ™®é€šæ–‡æœ¬ï¼Œåˆ™æ˜¯è¿™æ ·ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">--&lt;boundary&gt;</span><br><span class="line">Content-Disposition: form-data; name=&lt;name&gt;</span><br><span class="line">Content-Type: text/plain</span><br><span class="line"></span><br><span class="line">&lt;some text&gt;</span><br></pre></td></tr></table></figure><p>è¯·æ±‚ç»“å°¾ä¼šæœ‰ä¸€ä¸ªå¸¦ç€ä¸¤ä¸ªè¿å­—ç¬¦çš„ boundaryï¼Œ<code>--&lt;boundary&gt;--</code>ã€‚ï¼ˆæ­¤å¤„éœ€è¦æ³¨æ„ï¼Œæ‰€æœ‰æ–°è¡Œå¿…é¡»æ˜¯å›è½¦æ¢è¡Œã€‚ï¼‰</p><p>ä»¥ä¸Šå°±æ˜¯å…³äº multipart è¯·æ±‚çš„æ‰€æœ‰å†…å®¹ï¼Œå¹¶ä¸æ˜¯ç‰¹åˆ«å¤æ‚ã€‚äº‹å®ä¸Šï¼Œå½“åœ¨å†™ç¬¬ä¸€ä¸ªæœ‰å…³ multipart ç¼–ç çš„å®¢æˆ·ç«¯å®ç°æ—¶ï¼Œæˆ‘æœ‰äº›æŠµè§¦é˜…è¯» multipart/form-data çš„ <a href="https://tools.ietf.org/html/rfc7578" target="_blank" rel="noopener">RFC</a>ã€‚å¯æ˜¯åœ¨å¼€å§‹é˜…è¯»ä¹‹åï¼Œæˆ‘å¯¹è¿™ä¸ªåè®®çš„ç†è§£æ›´æ·±äº†ã€‚æ•´ä¸ªæ–‡æ¡£å¯è¯»æ€§å¾ˆå¼ºï¼Œå¾ˆè½»æ˜“å°±èƒ½ç›´è¾¾çŸ¥è¯†çš„æºå¤´ã€‚</p><p>æˆ‘åœ¨å¼€æºçš„ <a href="https://github.com/backchannel/BackchannelSDK-iOS" target="_blank" rel="noopener">Backchannel SDK</a> å®ç°äº†ä¸Šè¿°åŠŸèƒ½ã€‚<a href="https://github.com/backchannel/BackchannelSDK-iOS/blob/master/Source/Image%20Chooser/BAKUploadAttachmentRequest.m" target="_blank" rel="noopener"><code>BAKUploadAttachmentRequest</code></a> å’Œ <a href="https://github.com/backchannel/BackchannelSDK-iOS/blob/master/Source/Image%20Chooser/BAKMultipartRequestBuilder.m" target="_blank" rel="noopener"><code>BAKMultipartRequestBuilder</code></a> ç±»åŒ…å«äº†å¤„ç† mulitipart çš„æ–¹æ³•ã€‚åœ¨è¿™ä¸ªé¡¹ç›®ä¸­ï¼Œä»…ä»…åŒ…å«äº†å¤„ç†å•ä¸ªæ–‡ä»¶çš„æƒ…å†µï¼Œå¹¶ä¸”æ²¡æœ‰åŒ…æ‹¬å…ƒæ•°æ®ã€‚ä½†æ˜¯ä½œä¸ºèŒƒä¾‹ï¼Œä¾æ—§å¾ˆå¥½åœ°å±•ç¤ºäº† mulitipart è¯·æ±‚æ˜¯å¦‚ä½•æ„å»ºçš„ã€‚å¯ä»¥é€šè¿‡æ·»åŠ é¢å¤–çš„å®ç°ä»£ç ï¼Œæ¥æ”¯æŒå…ƒæ•°æ®å’Œå¤šæ–‡ä»¶çš„åŠŸèƒ½ã€‚</p><p>æ— è®ºæ˜¯ä½¿ç”¨ä¸€ä¸ªè¯·æ±‚ä¸Šä¼ å¤šä¸ªæ–‡ä»¶ï¼Œè¿˜æ˜¯å¤šä¸ªè¯·æ±‚åˆ†åˆ«å¯¹åº”ä¸Šä¼ ä¸€ä¸ªæ–‡ä»¶ï¼Œæ¥å®ç°å¤šæ–‡ä»¶ä¸Šä¼ åŠŸèƒ½ï¼Œéƒ½ä¼šç¢°åˆ°ä¸€ä¸ªé—®é¢˜ã€‚è¿™ä¸ªé—®é¢˜å°±æ˜¯ï¼Œå¦‚æœä½ å°è¯•ä¸€æ¬¡æ€§ä¸Šä¼ å¾ˆå¤šæ–‡ä»¶çš„è¯ï¼Œapp å°†ä¼šé—ªé€€ã€‚è¿™æ˜¯å› ä¸ºä½¿ç”¨ <a href="https://github.com/backchannel/BackchannelSDK-iOS/blob/master/Source/Image%20Chooser/BAKMultipartRequestBuilder.m#L66-L70" target="_blank" rel="noopener">è¯¥ç‰ˆæœ¬çš„ä»£ç </a>ï¼ŒåŠ è½½çš„æ•°æ®ä¼šç›´æ¥è¿›å…¥å†…å­˜ï¼Œåœ¨å†…å­˜æš´æ¶¨çš„æƒ…å†µä¸‹ï¼Œå³ä½¿ä½¿ç”¨å½“ä¸‹æ€§èƒ½æœ€å¼ºçš„æ——èˆ°æ‰‹æœºä¹Ÿä¼šæœ‰é—ªé€€å‘ç”Ÿã€‚</p><h2 id="å°†ç¡¬ç›˜ä¸­æ•°æ®ä»¥æµçš„å½¢å¼è¯»å–"><a href="#å°†ç¡¬ç›˜ä¸­æ•°æ®ä»¥æµçš„å½¢å¼è¯»å–" class="headerlink" title="å°†ç¡¬ç›˜ä¸­æ•°æ®ä»¥æµçš„å½¢å¼è¯»å–"></a>å°†ç¡¬ç›˜ä¸­æ•°æ®ä»¥æµçš„å½¢å¼è¯»å–</h2><p>æœ€å¸¸è§çš„è§£å†³æ–¹æ³•æ˜¯å°†ç¡¬ç›˜ä¸­çš„æ•°æ®ä»¥æµçš„å½¢å¼è¯»å–å‡ºæ¥ã€‚å…¶æ ¸å¿ƒæ€æƒ³æ˜¯æ–‡ä»¶çš„å­—èŠ‚æ•°æ®ä¼šä¸€ç›´ä¿å­˜åœ¨ç¡¬ç›˜é‡Œï¼Œç›´åˆ°è¢«è¯»å–å¹¶å‘å¾€ç½‘ç»œã€‚å†…å­˜ä¸­åªä¿ç•™äº†å¾ˆå°ä¸€éƒ¨åˆ†çš„é•œåƒæ•°æ®ã€‚</p><p>ç›®å‰ï¼Œæˆ‘æƒ³å‡ºä¸¤ç§æ–¹æ³•å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚ç¬¬ä¸€ä¸ªæ–¹æ³•ï¼ŒæŠŠ multipart è¯·æ±‚ä½“ä¸­çš„æ‰€æœ‰æ•°æ®å†™åˆ°ç¡¬ç›˜çš„ä¸€ä¸ªæ–°æ–‡ä»¶ä¸­ï¼Œå¹¶ä½¿ç”¨ URLSession çš„ <code>uploadTask(with request: URLRequest, fromFile fileURL: URL)</code> æ–¹æ³•å°†æ–‡ä»¶è½¬åŒ–ä¸ºæµã€‚è¿™ä¸ªæ–¹æ³•å¯ä»¥å¥æ•ˆï¼Œä½†æˆ‘å¹¶ä¸æƒ³ä¸ºæ¯ä¸€ä¸ªè¯·æ±‚æ–°å»ºä¸€ä¸ªæ–°æ–‡ä»¶ä¿å­˜åˆ°ç¡¬ç›˜ä¸­ã€‚å› ä¸ºè¿™æ„å‘³ç€åœ¨è¯·æ±‚å‘å‡ºåï¼Œè¿˜éœ€è¦åˆ é™¤è¿™ä¸ªæ–‡ä»¶ã€‚</p><p>ç¬¬äºŒç§æ–¹æ³•æ˜¯å°†å†…å­˜å’Œç¡¬ç›˜çš„æ•°æ®åˆå¹¶åœ¨ä¸€èµ·ï¼Œå¹¶é€šè¿‡ç»Ÿä¸€çš„æ¥å£å‘ç½‘ç»œè¾“å‡ºæ•°æ®ã€‚</p><p>å¦‚æœä½ è§‰å¾—ç¬¬äºŒç§æ–¹æ³•å¬èµ·æ¥åƒæ˜¯ <a href="http://khanlou.com/2015/10/clustering/" target="_blank" rel="noopener">ç±»ç°‡</a>ï¼Œæ­å–œä½ ï¼Œå®Œå…¨æ­£ç¡®ã€‚å¾ˆå¤šå¸¸ç”¨ Cocoa ç±»éƒ½å…è®¸åˆ›å»ºå­ç±»ï¼Œå¹¶å®ç°ä¸€äº›çˆ¶ç±»æ–¹æ³•ï¼Œä½¿å…¶å’Œçˆ¶ç±»è¡¨ç°ä¸€è‡´ã€‚å›æƒ³ä¸€ä¸‹ <code>NSArray</code> çš„ <code>-count</code> å±æ€§å’Œ <code>-objectAtIndex:</code> æ–¹æ³•ã€‚å› ä¸º <code>NSArray</code> çš„æ‰€æœ‰å…¶å®ƒæ–¹æ³•éƒ½æ˜¯åŸºäº <code>-count</code> å±æ€§å’Œ <code>-objectAtIndex:</code> æ–¹æ³•å®ç°çš„ï¼Œä½ å¯ä»¥éå¸¸è½»æ˜“åœ°åˆ›å»ºä¼˜åŒ–ç‰ˆæœ¬çš„ <code>NSArray</code> å­ç±»ã€‚</p><p>ä½ å¯ä»¥åˆ›å»ºä¸€ä¸ª <code>NSData</code> å­ç±»ï¼Œå®ƒæ— éœ€çœŸæ­£ä»ç¡¬ç›˜è¯»å–æ•°æ®ï¼Œè€Œåªæ˜¯åˆ›å»ºä¸€ä¸ªæŒ‡é’ˆç›´æ¥æŒ‡å‘ç¡¬ç›˜ä¸­çš„æ•°æ®ã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯æ˜¯ä¸éœ€è¦æŠŠæ•°æ®è½½å…¥å†…å­˜ä¸­è¿›è¡Œè¯»å–ã€‚è¿™ç§æ–¹æ³•ç§°ä¸ºå†…å­˜æ˜ å°„ï¼ŒåŸºäº Unix æ–¹æ³• <code>mmap</code>ã€‚ä½ å¯ä»¥é€šè¿‡ <code>.mappedIfSafe</code> æˆ–è€… <code>alwaysMapped</code> é€‰é¡¹ï¼Œæ¥ä½¿ç”¨ <code>NSData</code> çš„è¿™é¡¹ç‰¹æ€§ã€‚å› ä¸º <code>NSData</code> æ˜¯ä¸€ä¸ªç±»ç°‡ï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ª <code>ConcatenatedData</code> å­ç±»ï¼ˆå°±åƒ <code>FlattenCollection</code> åœ¨ Swift ä¸­çš„å·¥ä½œæ–¹å¼ï¼‰ï¼Œè¯¥å­ç±»ä¼šå°†å¤šä¸ª <code>NSData</code> å¯¹è±¡è§†ä½œä¸€ä¸ªè¿ç»­çš„ <code>NSData</code>ã€‚å®Œæˆåˆ›å»ºä»¥åï¼Œæˆ‘ä»¬å°±åšå¥½æ‰€æœ‰å‡†å¤‡æ¥è§£å†³è¿™ä¸ªé—®é¢˜å•¦ã€‚</p><p>é€šè¿‡æŸ¥çœ‹ <code>NSData</code> æ‰€æœ‰åŸç”Ÿæ–¹æ³•ï¼Œå¯ä»¥å‘ç°ï¼Œéœ€è¦å®ç°çš„æ˜¯ <code>-count</code> å’Œ <code>-bytes</code>ã€‚å®ç° <code>-count</code> å¹¶ä¸éš¾ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠæ‰€æœ‰ <code>NSData</code> å¯¹è±¡çš„å¤§å°ç›¸åŠ å¾—åˆ°ï¼›ä½†åœ¨å®ç° <code>-bytes</code> æ—¶åˆ™ä¼šæœ‰ä¸ªé—®é¢˜ã€‚ <code>-bytes</code> éœ€è¦è¿”å›ä¸€ä¸ªæŒ‡å‘ä¸€æ®µè¿ç»­ç¼“å†²åŒºçš„æŒ‡é’ˆï¼Œè€Œç›®å‰æˆ‘ä»¬å¹¶æ²¡æœ‰è¿™ä¸ªæŒ‡é’ˆã€‚</p><p>åœ¨åŸºç¡€åº“ä¸­ï¼Œæä¾›äº† <code>NSInputStream</code> ç±»ç”¨äºå¤„ç†ä¸è¿ç»­çš„æ•°æ®ã€‚éå¸¸å¹¸è¿ï¼Œ<code>NSInputStream</code> åŒæ ·æ˜¯ä¸€ä¸ªç±»ç°‡ã€‚æˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªå­ç±»ï¼Œå°†å¤šæ¡æµåˆå¹¶ã€‚åœ¨ä½¿ç”¨å­ç±»æ—¶ï¼Œæ„Ÿè§‰ä¸Šå°±åƒæ˜¯ä¸€æ¡æµã€‚é€šè¿‡ä½¿ç”¨ <code>+inputStreamWithData:</code> å’Œ <code>+inputStreamWithURL:</code> æ–¹æ³•ï¼Œå¯ä»¥è½»æ˜“åœ°åˆ›å»ºä¸€æ¡è¾“å…¥æµï¼Œç”¨æ¥ä»£è¡¨ç¡¬ç›˜ä¸­çš„æ–‡ä»¶å’Œå†…å­˜ä¸­çš„æ•°æ®ï¼ˆæ¯”å¦‚ boundariesï¼‰ã€‚</p><p>é€šè¿‡é˜…è¯»æœ€å¥½çš„ç¬¬ä¸‰æ–¹ç½‘ç»œåº“æºä»£ç ï¼Œä½ ä¼šå‘ç° <a href="https://github.com/AFNetworking/AFNetworking" target="_blank" rel="noopener">AFNetworking</a> é‡‡ç”¨äº†<a href="https://github.com/AFNetworking/AFNetworking/blob/009e3bb6673edc183c4f2baf552ad7cccba94d58/AFNetworking/AFURLRequestSerialization.m#L896-L927" target="_blank" rel="noopener">è¿™ç§æ–¹æ³•</a>ã€‚ï¼ˆ<a href="https://github.com/Alamofire/Alamofire" target="_blank" rel="noopener">Alamofire</a>ï¼ŒSwift ç‰ˆæœ¬çš„ AFNetworkingï¼Œåˆ™é‡‡ç”¨äº†ç¬¬ä¸€ç§æ–¹æ³•ï¼Œ<a href="https://github.com/Alamofire/Alamofire/blob/ff16ce9e87aeb0ee1f30b28789db1fff01e8fb02/Source/MultipartFormData.swift#L432-L455" target="_blank" rel="noopener">å°†æ•°æ®å…¨éƒ¨åŠ è½½åˆ°å†…å­˜ä¸­</a>ï¼Œä½†å¦‚æœæ•°æ®é‡å¤ªå¤§ï¼Œå°±ä¼šå†™åˆ°ç¡¬ç›˜çš„ä¸€ä¸ªæ–‡ä»¶ä¸­ã€‚ï¼‰</p><h2 id="å°†æ‰€æœ‰éƒ¨åˆ†æ‹¼æ¥èµ·æ¥"><a href="#å°†æ‰€æœ‰éƒ¨åˆ†æ‹¼æ¥èµ·æ¥" class="headerlink" title="å°†æ‰€æœ‰éƒ¨åˆ†æ‹¼æ¥èµ·æ¥"></a>å°†æ‰€æœ‰éƒ¨åˆ†æ‹¼æ¥èµ·æ¥</h2><p>ä½ å¯ä»¥åœ¨ <a href="https://gist.github.com/khanlou/8cc2e3cb23ec8d03b1fc187f5922e244" target="_blank" rel="noopener">è¿™é‡Œ</a> çœ‹çœ‹æˆ‘çš„ä¸²è¡Œè¾“å…¥æµçš„å®ç°ï¼ˆæ˜¯ç”¨ Objective-C å®ç°çš„ï¼Œä»¥åæˆ‘å¯èƒ½è¿˜ä¼šå†™ä¸€ä¸ª Swift ç‰ˆæœ¬çš„ï¼‰ã€‚</p><p>é€šè¿‡ <code>SKSerialInputStream</code> ç±»ï¼Œå¯ä»¥å°†æµç»„åˆåœ¨ä¸€èµ·ã€‚ä¸‹é¢å±•ç¤ºäº†å‰ç¼€å’Œåç¼€å±æ€§ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">MultipartComponent</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> prefixData: <span class="type">Data</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> string = <span class="string">""</span><span class="string">"</span></span><br><span class="line"><span class="string">        <span class="subst">\(<span class="keyword">self</span>.boundary)</span></span></span><br><span class="line"><span class="string">        Content-Disposition: form-data; name="</span>\(<span class="keyword">self</span>.name); filename=<span class="string">"<span class="subst">\(<span class="keyword">self</span>.filename)</span>"</span></span><br><span class="line">        <span class="string">""</span><span class="string">"</span></span><br><span class="line"><span class="string">        return string.data(using: .utf8)</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    var postfixData: Data &#123;</span></span><br><span class="line"><span class="string">        return "</span>\r\n<span class="string">".data(using: .utf8)</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure><p>å°†å…ƒæ•°æ®å’Œæ–‡ä»¶çš„ <code>dataStream</code> ç»„åˆåœ¨ä¸€èµ·ï¼Œå¾—åˆ°ä¸€æ¡è¾“å…¥æµï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">MultipartComponent</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> inputStream: <span class="type">NSInputStream</span> &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">let</span> streams = [</span><br><span class="line">            <span class="type">NSInputStream</span>(data: prefixData),</span><br><span class="line">            <span class="keyword">self</span>.fileDataStream,</span><br><span class="line">            <span class="type">NSInputStream</span>(data: postfixData),</span><br><span class="line">        ]</span><br><span class="line">    </span><br><span class="line">        <span class="keyword">return</span> <span class="type">SKSerialInputStream</span>(inputStreams: streams)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ›å»ºå¥½æ¯ä¸€éƒ¨åˆ†è¾“å…¥æµä¹‹åï¼Œå°±å¯ä»¥æŠŠæ‰€æœ‰æµç»„åˆåœ¨ä¸€èµ·ï¼Œå¾—åˆ°ä¸€æ¡å®Œæ•´è¾“å…¥æµã€‚æ­¤å¤–ï¼Œåœ¨è¯·æ±‚ç»“å°¾è¿˜éœ€è¦æ·»åŠ ä¸€ä¸ª boundaryï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">RequestBuilder</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> bodyInputStream: <span class="type">NSInputStream</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> stream = parts</span><br><span class="line">            .<span class="built_in">map</span>(&#123; $<span class="number">0</span>.inputStream &#125;)</span><br><span class="line">            + [<span class="type">NSInputStream</span>(data: <span class="string">"--<span class="subst">\(<span class="keyword">self</span>.boundary)</span>--"</span>.data(using: .utf8))]</span><br><span class="line">    </span><br><span class="line">        <span class="keyword">return</span> <span class="type">SKSerialInputStream</span>(inputStreams: streams)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ€åï¼Œå°† <code>bodyInputStream</code> èµ‹å€¼ç»™ URL è¯·æ±‚çš„ <code>httpBodyStream</code> å±æ€§ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> urlRequest = <span class="type">URLRequest</span>(url: url)</span><br><span class="line"></span><br><span class="line">urlRequest.httpBodyStream = requestBuilder.bodyInputStream;</span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼Œ<code>httpBodyStream</code> å’Œ <code>httpBody</code> ä¸¤ä¸ªå±æ€§æ˜¯äº’æ–¥çš„â€”â€”ä¸¤ä¸ªå±æ€§ä¸ä¼šåŒæ—¶ç”Ÿæ•ˆã€‚è®¾ç½® <code>httpBodyStream</code> ä¼šä½¿å¾— <code>Data</code> ç‰ˆæœ¬ <code>httpBody</code> å¤±æ•ˆï¼Œåä¹‹äº¦ç„¶ã€‚</p><p>æµæ–‡ä»¶ä¸Šä¼ çš„å…³é”®æ˜¯èƒ½å¤Ÿå°†å¤šæ¡è¾“å…¥æµåˆå¹¶æˆä¸€æ¡æµã€‚<code>SKSerialInputStream</code> ç±»å®Œæˆäº†æ•´ä¸ªå·¥ä½œã€‚å°½ç®¡è¯´å­ç±»åŒ– <code>NSInputStream</code> æœ‰ä¸€äº›å›°éš¾ï¼Œå¯ä¸€æ—¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å°±ç¦»æˆåŠŸä¸è¿œå•¦ã€‚</p><h2 id="å­ç±»åŒ–è¿‡ç¨‹ä¸­éœ€è¦æ³¨æ„çš„é—®é¢˜"><a href="#å­ç±»åŒ–è¿‡ç¨‹ä¸­éœ€è¦æ³¨æ„çš„é—®é¢˜" class="headerlink" title="å­ç±»åŒ–è¿‡ç¨‹ä¸­éœ€è¦æ³¨æ„çš„é—®é¢˜"></a>å­ç±»åŒ–è¿‡ç¨‹ä¸­éœ€è¦æ³¨æ„çš„é—®é¢˜</h2><p>å­ç±»åŒ– <code>NSInputStream</code> çš„è¿‡ç¨‹ä¸ä¼šå¤ªè½»æ¾ï¼Œç”šè‡³å¯ä»¥è¯´å¾ˆå›°éš¾ã€‚ä½ å¿…é¡»å®ç° 9 ä¸ªæ–¹æ³•ã€‚å…¶ä¸­çš„ 7 ä¸ªæ–¹æ³•ï¼Œçˆ¶ç±»åªæœ‰ä¸€äº›å¾®ä¸è¶³é“çš„é»˜è®¤å®ç°ã€‚è€Œåœ¨æ–‡æ¡£ä¸­åªæåˆ°äº† 9 ä¸ªæ–¹æ³•ä¸­çš„ 3 ä¸ªï¼Œæ‰€ä»¥ä½ è¿˜å¾—å®ç° 6 ä¸ª <code>NSStream</code> ï¼ˆ<code>NSInputStream</code> çš„çˆ¶ç±»ï¼‰çš„æ–¹æ³•ï¼Œå…¶ä¸­æœ‰ 2 ä¸ªæ˜¯ run loop æ–¹æ³•ï¼Œå¹¶å…è®¸ç©ºå®ç°ã€‚åœ¨è¿™ä¹‹å‰ï¼Œä½ è¿˜éœ€è¦é¢å¤– <a href="http://blog.bjhomer.com/2011/04/subclassing-nsinputstream.html" target="_blank" rel="noopener">å®ç° 3 ä¸ªç§æœ‰æ–¹æ³•</a>ï¼Œä¸è¿‡ç°åœ¨ä¸å¿…å®ç°äº†ã€‚æ­¤å¤–ï¼Œè¿˜éœ€è¦å®šä¹‰ 3 ä¸ª<code>åªè¯»</code>å±æ€§ï¼š<code>streamStatus</code>ï¼Œ<code>streamError</code>ï¼Œ<code>delegate</code>ã€‚</p><p>åœ¨å¤„ç†å®Œä¸Šè¿°å­ç±»åŒ–ç›¸å…³çš„ç»†èŠ‚åï¼Œæ¥ä¸‹æ¥çš„æŒ‘æˆ˜æ˜¯åˆ›å»ºä¸€ä¸ª <code>NSInputStream</code> å­ç±»ï¼Œå…¶è¡Œä¸ºåº”è¯¥å’Œ API ä½¿ç”¨è€…æ‰€æœŸæœ›çš„ä¿æŒä¸€è‡´ã€‚ç„¶è€Œï¼Œè¿™ä¸ªç±»çŠ¶æ€çš„é‡åº¦è€¦åˆæ˜¯ä¸å®¹æ˜“è¢«äººå‘ç°çš„ã€‚</p><p>æœ‰ä¸€äº›çŠ¶æ€éœ€è¦ä¿è¯è¡Œä¸ºä¸€è‡´ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œ<code>hasBytesAvailable</code> æ˜¯ä¸åŒäºå…¶å®ƒçŠ¶æ€çš„ï¼Œä½†è¿˜æ˜¯å­˜åœ¨ç»†å¾®çš„è”ç³»ã€‚åœ¨æˆ‘æœ€è¿‘å‘ç°çš„ä¸€ä¸ª bug é‡Œï¼Œ<code>hasBytesAvailable</code> å±æ€§ä¼šè¿”å› <code>self.currentIndex != self.inputStreams.count</code>ï¼Œä½†æ˜¯è¿™ä¼šé€ æˆä¸€ä¸ª bugï¼Œæµä¼šä¸€ç›´å¤„äºå¼€å¯çš„çŠ¶æ€ï¼Œå¹¶æœ€ç»ˆé€ æˆè¯·æ±‚è¶…æ—¶ã€‚ä¿®å¤è¿™ä¸ª bug çš„åŠæ³•æ˜¯æ”¹ä¸ºè¿”å› <code>YES</code>ï¼Œä½†æˆ‘ä¸€ç›´æ²¡æœ‰æ‰¾åˆ°è¿™ä¸ª bug çš„æ ¹æºæ‰€åœ¨ã€‚</p><p>å¦å¤–ä¸€ä¸ªçŠ¶æ€ <code>streamStatus</code>ï¼Œå­˜åœ¨è®¸å¤šå¯èƒ½çš„å€¼ï¼Œå…¶ä¸­æ¯”è¾ƒé‡è¦çš„ä¸¤ä¸ªå€¼æ˜¯ <code>NSStreamStatusOpen</code> å’Œ <code>NSStreamStatusClosed</code>ã€‚</p><p>æœ€åä¸€ä¸ªæ¯”è¾ƒæœ‰æ„æ€çš„çŠ¶æ€æ˜¯å­—èŠ‚æ•°ï¼Œä» <code>read</code> æ–¹æ³•ä¸­è¿”å›å€¼ã€‚è¿™ä¸ªå±æ€§é™¤äº†ä¼šè¿”å›æ­£æ•´å‹æ•°ä¹‹å¤–ï¼Œè¿˜ä¼šè¿”å› -1ï¼Œ-1 ä»£è¡¨æœ‰é”™è¯¯äº§ç”Ÿï¼Œéœ€è¦è¿›ä¸€æ­¥æ£€æŸ¥éç©ºå±æ€§ <code>streamError</code> æ¥è·å–æ›´å¤šä¿¡æ¯ã€‚å­—èŠ‚æ•°è¿˜å¯ä»¥è¿”å› 0ï¼Œæ ¹æ®æ–‡æ¡£æè¿°ï¼Œè¿™æ˜¯æ ‡æ˜æµç»“å°¾çš„å¦å¤–ä¸€ç§æ–¹å¼ã€‚</p><p>æ–‡æ¡£å¹¶ä¸ä¼šå‘Šè¯‰ä½ å“ªäº›çŠ¶æ€çš„ç»„åˆæ˜¯æœ‰æ„ä¹‰çš„ã€‚æ¯”å¦‚è¯´æµäº§ç”Ÿä¸€ä¸ª <code>streamError</code>ï¼Œä½†çŠ¶æ€å´æ˜¯ <code>NSStreamStatusClosed</code>ï¼Œè€Œä¸æ˜¯ <code>NSStreamStatusError</code>ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹æ˜¯å¦ä¼šæœ‰é—®é¢˜ï¼Ÿæƒ³è¦ç®¡ç†å¥½æ‰€æœ‰çš„çŠ¶æ€éå¸¸éš¾ï¼Œä¸è¿‡åˆ°æœ€åç»ˆç©¶è¿˜æ˜¯èƒ½è§£å†³çš„ã€‚</p><p>å¯¹äº <code>SKSerialStream</code> ç±»ï¼Œæ˜¯å¦å¯ä»¥åœ¨æ‰€æœ‰æƒ…å†µä¸‹éƒ½èƒ½æ­£å¸¸å·¥ä½œï¼Œæˆ‘è¿˜ä¸æ˜¯ç‰¹åˆ«æœ‰ä¿¡å¿ƒã€‚ä½†çœ‹èµ·æ¥ï¼Œ<code>SKSerialStream</code> é€šè¿‡ä½¿ç”¨ URLSession èƒ½å¾ˆå¥½åœ°æ”¯æŒä¸Šä¼  multipart æ•°æ®ã€‚å¦‚æœä½ åœ¨ä½¿ç”¨è¿™ä»½ä»£ç çš„æ—¶å€™å‘ç°ä»»ä½•é—®é¢˜ï¼Œè¯·åŠ¡å¿…è”ç³»æˆ‘ï¼Œæˆ‘ä»¬å¯ä»¥ä¸€èµ·ä¸æ–­ä¼˜åŒ–è¿™ä¸ªç±»ã€‚</p><blockquote><p>æœ¬æ–‡ç”± SwiftGG ç¿»è¯‘ç»„ç¿»è¯‘ï¼Œå·²ç»è·å¾—ä½œè€…ç¿»è¯‘æˆæƒï¼Œæœ€æ–°æ–‡ç« è¯·è®¿é—® <a href="http://swift.gg">http://swift.gg</a>ã€‚</p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;ä½œè€…ï¼šSoroush Khanlouï¼Œ&lt;a href=&quot;http://khanlou.com/2018/11/streaming-multipart-requests/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;åŸæ–‡é“¾æ¥&lt;/a&gt;ï¼ŒåŸæ–‡æ—¥æœŸï¼š2018-11-14&lt;br&gt;è¯‘è€…ï¼š&lt;a href=&quot;https://www.jianshu.com/u/076cc5e18bb8&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;éƒ‘ä¸€ä¸€&lt;/a&gt;ï¼›æ ¡å¯¹ï¼š&lt;a href=&quot;http://numbbbbb.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;numbbbbb&lt;/a&gt;ï¼Œ&lt;a href=&quot;http://www.jianshu.com/users/596f2ba91ce9/latest_articles&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;pmst&lt;/a&gt;ï¼›å®šç¨¿ï¼š&lt;a href=&quot;http://forelax.space&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Forelax&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;!--æ­¤å¤„å¼€å§‹æ­£æ–‡--&gt;
&lt;p&gt;Foundation æ¡†æ¶ä¸­çš„ URL ç±»æä¾›äº†éå¸¸å…¨é¢çš„åŠŸèƒ½ï¼Œæ­¤åè¿˜åœ¨ iOS 7 ä¸­æ–°å¢äº† URLSession ç±»ã€‚å°½ç®¡å¦‚æ­¤ï¼ŒåŸºç¡€åº“ä¸­ä»ç„¶ç¼ºå°‘ multipart æ–‡ä»¶ä¸Šä¼ çš„åŠŸèƒ½ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="Khanlou" scheme="https://swift.gg/categories/Khanlou/"/>
    
    
      <category term="iOS å¼€å‘" scheme="https://swift.gg/tags/iOS-%E5%BC%80%E5%8F%91/"/>
    
      <category term="Swift" scheme="https://swift.gg/tags/Swift/"/>
    
      <category term="Objective-C" scheme="https://swift.gg/tags/Objective-C/"/>
    
  </entry>
  
  <entry>
    <title>Language Server Protocol</title>
    <link href="https://swift.gg/2019/01/15/nshipster-language-server-protocol/"/>
    <id>https://swift.gg/2019/01/15/nshipster-language-server-protocol/</id>
    <published>2019-01-15T00:00:00.000Z</published>
    <updated>2019-02-18T08:52:32.961Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ä½œè€…ï¼šMatttï¼Œ<a href="https://nshipster.com/language-server-protocol/" target="_blank" rel="noopener">åŸæ–‡é“¾æ¥</a>ï¼ŒåŸæ–‡æ—¥æœŸï¼š2018-11-19<br>è¯‘è€…ï¼š<a href="https://github.com/mobilefellow" target="_blank" rel="noopener">é›¨è°¨</a>ï¼›æ ¡å¯¹ï¼š<a href="http://numbbbbb.com/" target="_blank" rel="noopener">numbbbbb</a>ï¼Œ<a href="http://www.jianshu.com/users/596f2ba91ce9/latest_articles" target="_blank" rel="noopener">pmst</a>ï¼›å®šç¨¿ï¼š<a href="http://forelax.space" target="_blank" rel="noopener">Forelax</a></p></blockquote><!--æ­¤å¤„å¼€å§‹æ­£æ–‡--><p>ä¸Šä¸ªæœˆï¼Œè‹¹æœå…¬å¸ <a href="https://forums.swift.org/t/new-lsp-language-service-supporting-swift-and-c-family-languages-for-any-editor-and-platform/17024" target="_blank" rel="noopener">åœ¨ Swift.org è®ºå›ä¸Šå®£å¸ƒ</a>ï¼Œæ­£åœ¨ç€æ‰‹ä¸º Swift å’Œ C è¯­è¨€æ”¯æŒ <a href="https://microsoft.github.io/language-server-protocol/" target="_blank" rel="noopener">Language Server Protocol</a>ï¼ˆè¯­è¨€æœåŠ¡å™¨åè®®ï¼ŒLSPï¼‰ã€‚</p><blockquote><p>å¯¹äºè‹¹æœå…¬å¸è€Œè¨€ï¼Œä¸ºæ‰€æœ‰ Swift å¼€å‘è€… â€”â€” åŒ…æ‹¬éè‹¹æœå¹³å°ä¸Šçš„ â€”â€” æä¾›é«˜è´¨é‡çš„å·¥å…·æ”¯æŒéå¸¸é‡è¦ã€‚æˆ‘ä»¬å¸Œæœ›ä¸å¼€æºç¤¾åŒºåˆä½œï¼Œå°†ç²¾åŠ›é›†ä¸­åœ¨æ„å»º Xcode å’Œå…¶ä»–ç¼–è¾‘å™¨ã€å…¶ä»–å¹³å°å¯ä»¥å…±äº«çš„å…¬å…±åŸºç¡€è®¾æ–½ä¸Šã€‚ä¸ºå®ç°è¿™ä¸€ç›®æ ‡ï¼Œ[â€¦â€¦]ï¼Œæˆ‘ä»¬å†³å®šæ”¯æŒ LSPã€‚</p><p><em>Argyrios Kyrtzidisï¼Œ2018 å¹´ 10 æœˆ 15 æ—¥</em></p></blockquote><p><strong>è¿™å¯èƒ½æ˜¯è‹¹æœè‡ª 2014 å¹´å°† Swift ä½œä¸ºå¼€æºè½¯ä»¶å‘å¸ƒä»¥æ¥ï¼Œä¸º Swift åšå‡ºçš„æœ€é‡è¦çš„å†³å®šã€‚</strong> è¿™å¯¹äº APP å¼€å‘è€…æ¥è¯´æ˜¯ä¸€ä»¶å¤§äº‹ï¼Œå¯¹äºå…¶ä»–å¹³å°ä¸Šçš„ Swift å¼€å‘è€…æ¥è¯´æ›´æ˜¯ä¸€ä»¶å¤§äº‹ã€‚</p><p>ä¸ºäº†ç†è§£å…¶ä¸­çš„åŸå› ï¼Œæœ¬å‘¨çš„æ–‡ç« å°†ç ”ç©¶ Language Server Protocol è§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Œå®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Œä»¥åŠå®ƒçš„é•¿æœŸå½±å“å¯èƒ½æ˜¯ä»€ä¹ˆã€‚</p><a id="more"></a><blockquote><p><strong>æ›´æ–°</strong>ï¼šsourcekit-lsp é¡¹ç›®ç°åœ¨å·²ç»å¯ä»¥ <a href="https://github.com/apple/sourcekit-lsp" target="_blank" rel="noopener">åœ¨ GitHub ä¸Šè®¿é—®</a> äº†ã€‚</p></blockquote><hr><p>æƒ³è±¡è¿™æ ·ä¸€ä¸ªçŸ©é˜µï¼Œæ¯ä¸€è¡Œè¡¨ç¤ºä¸åŒçš„ç¼–ç¨‹è¯­è¨€ï¼ˆSwiftã€JavaScriptã€Rubyã€Python ç­‰ï¼‰ï¼Œæ¯ä¸€åˆ—è¡¨ç¤ºä¸åŒçš„ä»£ç ç¼–è¾‘å™¨ï¼ˆXcodeã€Visual Studioã€Vimã€Atom ç­‰ï¼‰ï¼Œè¿™æ ·æ¯ä¸ªå•å…ƒæ ¼è¡¨ç¤ºç‰¹å®šç¼–è¾‘å™¨å¯¹ä¸€ç§è¯­è¨€çš„æ”¯æŒçº§åˆ«ã€‚</p><p><img src="https://nshipster.com/assets/lsp-languages-times-editors-b9a398af0dea85f2ad6dcf5412fbcb451a43bc90091d5e3ab3b1140da9926b3e.svg" alt="lsp-languages-times-editors.svg"></p><p>ç„¶åï¼Œä½ å°±å‘ç°å„ç§ç»„åˆå½¢æˆäº†ä¸€ç§æ”¯ç¦»ç ´ç¢çš„å…¼å®¹ã€‚æœ‰äº›ç¼–è¾‘å™¨å’Œéƒ¨åˆ†è¯­è¨€æ·±åº¦é›†æˆï¼Œä½†é™¤æ­¤ä¹‹å¤–å‡ ä¹ä»€ä¹ˆéƒ½å¹²ä¸äº†ï¼›å…¶ä»–ç¼–è¾‘å™¨åˆ™æ¯”è¾ƒé€šç”¨ï¼Œå¯¹å¾ˆå¤šè¯­è¨€éƒ½æä¾›äº†åŸºæœ¬çš„æ”¯æŒã€‚ï¼ˆIDE è¿™ä¸ªæœ¯è¯­é€šå¸¸ç”¨æ¥æè¿°å‰è€…ã€‚)</p><p>ä¸¾ä¸ªå¥‡è‘©çš„ä¾‹å­ï¼š<em>ä½ ä¸ç”¨ Xcode æ¥å¼€å‘ APPï¼Œå´åç”¨æ¥å¹²å…¶ä»–äº‹æƒ…ã€‚</em></p><p>ä¸ºäº†æ›´å¥½åœ°æ”¯æŒæŸä¸€ç‰¹å®šçš„è¯­è¨€ï¼Œç¼–è¾‘å™¨å¿…é¡»ç¼–å†™ä¸€äº›é›†æˆä»£ç ï¼ˆintegration codeï¼‰â€”â€” è¦ä¹ˆç›´æ¥å†™åœ¨é¡¹ç›®é‡Œï¼Œè¦ä¹ˆé€šè¿‡æ’ä»¶ã€‚ç”±äºä¸åŒè¯­è¨€å’Œç¼–è¾‘å™¨çš„å®ç°æœºåˆ¶ä¸ä¸€æ ·ï¼Œå› æ­¤æ¯”æ–¹è¯´ Vim æ”¹è¿›äº†å¯¹ Ruby æ”¯æŒï¼Œä½†è¿™å¹¶ä¸èƒ½è®©å®ƒæ›´å¥½åœ°æ”¯æŒ Pythonï¼Œä¹Ÿä¸èƒ½è®© Ruby åœ¨ Atom ä¸Šè¿è¡Œåœ°æ›´å¥½ã€‚æœ€ç»ˆçš„ç»“æœæ˜¯ï¼šå¤§é‡ç²¾åŠ›æµªè´¹åœ¨äº†ä¸åŒæŠ€æœ¯çš„å…¼å®¹ä¸Šã€‚</p><p>æˆ‘ä»¬ä¸Šé¢æè¿°çš„æƒ…å†µé€šå¸¸è¢«ç§°ä¸º <em>M Ã— N é—®é¢˜</em>ï¼Œå³æœ€ç»ˆçš„é›†æˆæ–¹æ¡ˆæ•°é‡ä¸ºç¼–è¯‘å™¨æ•°é‡ M ä¸è¯­è¨€æ•°é‡ N çš„ä¹˜ç§¯ã€‚Language Server Protocol æ‰€åšçš„äº‹æƒ…å°±æ˜¯å°† M Ã— N é—®é¢˜å˜æˆ <em>M + N é—®é¢˜</em>ã€‚</p><p>ç¼–è¾‘å™¨ä¸å¿…å®ç°å¯¹æ¯ç§è¯­è¨€çš„æ”¯æŒï¼Œåªéœ€æ”¯æŒ LSP å³å¯ã€‚ä¹‹åï¼Œå®ƒå°±èƒ½åŒç­‰ç¨‹åº¦åœ°æ”¯æŒæ‰€æœ‰æ”¯æŒ LSP çš„è¯­è¨€ã€‚</p><p><img src="https://nshipster.com/assets/lsp-languages-plus-editors-904f780fa4a21e89b5b00bfe5fca39795dd54c1c4c67acf3f0fe095aaf09064d.svg" alt="lsp-languages-plus-editors.svg"></p><blockquote><p>Tomohiro Matsuyama åœ¨ 2010 å¹´å†™çš„ <a href="https://tkf.github.io/2013/06/04/Emacs-is-dead.html" target="_blank" rel="noopener">â€œEmacs ã¯æ­»ã‚“ã â€ (<em>â€œEmacs å·²æ­»â€</em>)</a> è¿™ç¯‡æ–‡ç« å°±å¯¹è¿™ç§é—®é¢˜åšå‡ºäº†ä¸€ä¸ªå¾ˆå¥½çš„è®ºè¿°ã€‚Matsuyama æè¿°äº† Emacs è„šæœ¬è¯­è¨€çš„å±€é™æ€§ï¼ˆä¸æ”¯æŒå¤šçº¿ç¨‹ã€åº•å±‚ API è¿‡å°‘ã€ç”¨æˆ·åŸºæ•°å¤ªå°ï¼‰ï¼Œä»–è®¤ä¸ºç¼–å†™æ’ä»¶çš„é¦–é€‰æ–¹æ³•åº”è¯¥æ˜¯ä¸å¤–éƒ¨ç¨‹åºè¿›è¡Œäº¤äº’ï¼Œè€Œä¸æ˜¯åŸç”Ÿå®ç°ã€‚</p></blockquote><p>Language Server Protocol ä¸ºæ”¯æŒçš„è¯­è¨€æä¾›äº†ä¸€å¥—é€šç”¨çš„åŠŸèƒ½é›†ï¼ŒåŒ…æ‹¬ï¼š</p><ul><li>è¯­æ³•é«˜äº®ï¼ˆSyntax Highlightingï¼‰</li><li>è‡ªåŠ¨æ ¼å¼åŒ–ï¼ˆAutomatic Formattingï¼‰</li><li>è‡ªåŠ¨è¡¥å…¨ï¼ˆAutocompleteï¼‰</li><li>è¯­æ³•ï¼ˆSyntaxï¼‰</li><li>å·¥å…·æç¤ºï¼ˆTooltipsï¼‰</li><li>å†…è”è¯Šæ–­ï¼ˆInline Diagnosticsï¼‰</li><li>è·³è½¬åˆ°å®šä¹‰ï¼ˆJump to Definitionï¼‰</li><li>é¡¹ç›®å†…æŸ¥æ‰¾å¼•ç”¨ï¼ˆFind References in Projectï¼‰</li><li>é«˜çº§æ–‡æœ¬å’Œç¬¦å·æœç´¢ï¼ˆAdvanced Text and Symbol Searchï¼‰</li></ul><p>å„ç§å·¥å…·å’Œç¼–è¾‘å™¨å¯ä»¥å°†ç²¾åŠ›ç”¨äºæå‡å¯ç”¨æ€§å’Œæä¾›æ›´é«˜çº§çš„åŠŸèƒ½ï¼Œè€Œä¸æ˜¯ä¸ºæ¯ç§æ–°æŠ€æœ¯å†é€ ä¸ªè½®å­ã€‚</p><h2 id="Language-Server-Protocol-çš„å·¥ä½œåŸç†"><a href="#Language-Server-Protocol-çš„å·¥ä½œåŸç†" class="headerlink" title="Language Server Protocol çš„å·¥ä½œåŸç†"></a>Language Server Protocol çš„å·¥ä½œåŸç†</h2><p>å¦‚æœä½ æ˜¯ä¸€ä¸ª iOS ç¨‹åºå‘˜ï¼Œé‚£ä¹ˆä¸€å®šå¾ˆç†Ÿæ‚‰ <em>server</em> å’Œ <em>protocol</em> è¿™ä¸¤ä¸ªæœ¯è¯­åœ¨ Web åº”ç”¨ç¨‹åºçš„ HTTP + JSON é€šä¿¡åœºæ™¯ä¸‹çš„å«ä¹‰ã€‚å®é™…ä¸Š Language Server Protocol å·®ä¸å¤šä¹Ÿæ˜¯è¿™ä¹ˆå·¥ä½œçš„ã€‚</p><p>å¯¹äº LSPï¼Œ<em>client</em> æ˜¯æŒ‡ç¼–è¾‘å™¨ â€”â€” æˆ–è€…æ›´å®½æ³›ä¸€ç‚¹ï¼Œæ˜¯æŒ‡å·¥å…·ï¼Œ<em>server</em> æ˜¯æŒ‡æœ¬åœ°ç‹¬ç«‹è¿›ç¨‹é‡Œè¿è¡Œçš„ä¸€ä¸ªå¤–éƒ¨ç¨‹åºã€‚</p><p>è‡³äºåå­—ä¸­åŒ…å« <em>protocol</em>ï¼Œæ˜¯å› ä¸º LSP ç±»ä¼¼äºä¸€ä¸ªç²¾ç®€ç‰ˆçš„ HTTPï¼š</p><ul><li>æ¯ä¸ªæ¶ˆæ¯éƒ½ç”±æŠ¥å¤´éƒ¨åˆ†å’Œå†…å®¹éƒ¨åˆ†ç»„æˆã€‚</li><li>æŠ¥å¤´éƒ¨åˆ†åŒ…å«ä¸€ä¸ªå¿…å¡«çš„ <code>Content-Length</code> å­—æ®µï¼Œç”¨äºè¯´æ˜å†…å®¹éƒ¨åˆ†çš„å¤§å°ï¼ˆä»¥å­—èŠ‚ä¸ºå•ä½ï¼‰ï¼Œä»¥åŠä¸€ä¸ªå¯é€‰çš„ <code>Content-Type</code> å­—æ®µï¼ˆé»˜è®¤å€¼ä¸º <code>application/vscode-jsonrpc; charset=utf-8</code>ï¼‰ã€‚</li><li>å†…å®¹éƒ¨åˆ†ä½¿ç”¨ <a href="https://www.jsonrpc.org/specification" target="_blank" rel="noopener">JSON-RPC</a> æè¿°è¯·æ±‚ã€å“åº”å’Œé€šçŸ¥çš„ç»“æ„ã€‚</li></ul><p>æ¯å½“å·¥å…·ä¸­å‘ç”Ÿäº†ä»€ä¹ˆäº‹æƒ…ï¼Œæ¯”å¦‚ç”¨æˆ·éœ€è¦è·³è½¬åˆ°ç¬¦å·çš„å®šä¹‰ï¼Œå·¥å…·å°±ä¼šå‘ server å‘é€ä¸€ä¸ªè¯·æ±‚ã€‚server æ¥æ”¶åˆ°è¯¥è¯·æ±‚ï¼Œç„¶åè¿”å›é€‚å½“çš„å“åº”ã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Parent</span> </span>&#123;&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Child</span>: <span class="title">Parent</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure><p><img src="https://nshipster.com/assets/lsp-jump-to-definition-f76ae15d897ab30706c101e7300cd299ad97f6b910ed79ce4890351c2805ae56.gif" alt="lsp-jump-to-definition.gif"></p><p>ä»¥ä¸‹æ˜¯ LSP å¦‚ä½•åœ¨å¹•åå®ç°è¿™ç§äº¤äº’ï¼š</p><p>é¦–å…ˆï¼Œå½“ç”¨æˆ·æ‰“å¼€ Swift ä»£ç æ—¶ï¼Œè‹¥ Swift language server å¹¶æœªè¿è¡Œï¼Œç¼–è¾‘å™¨å°†åœ¨ä¸€ä¸ªç‹¬ç«‹è¿›ç¨‹ä¸­å¯åŠ¨å®ƒï¼Œå¹¶æ‰§è¡Œä¸€äº›é¢å¤–çš„é…ç½®ã€‚</p><p>å½“ç”¨æˆ·æ‰§è¡Œ â€œè·³è½¬åˆ°å®šä¹‰ï¼ˆjump to definitionï¼‰â€ æŒ‡ä»¤æ—¶ï¼Œç¼–è¾‘å™¨å‘ Swift language server å‘é€ä»¥ä¸‹è¯·æ±‚ï¼š</p><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"jsonrpc"</span>: <span class="string">"2.0"</span>,</span><br><span class="line">  <span class="attr">"id"</span>: <span class="number">1</span>,</span><br><span class="line">  <span class="attr">"method"</span>: <span class="string">"textDocument/definition"</span>,</span><br><span class="line">  <span class="attr">"params"</span>: &#123;</span><br><span class="line">    <span class="attr">"textDocument"</span>: &#123;</span><br><span class="line">      <span class="attr">"uri"</span>: <span class="string">"file:///Users/NSHipster/Example.swift"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"position"</span>: &#123;</span><br><span class="line">      <span class="attr">"line"</span>: <span class="number">1</span>,</span><br><span class="line">      <span class="attr">"character"</span>: <span class="number">13</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ”¶åˆ°è¿™ä¸ªè¯·æ±‚åï¼ŒSwift language server ä½¿ç”¨ <a href="https://github.com/apple/swift/tree/master/tools/SourceKit" target="_blank" rel="noopener">SourceKit</a> ç­‰ç¼–è¯‘å™¨å·¥å…·æ¥æ ‡è¯†ç›¸åº”çš„ä»£ç å®ä½“ï¼Œå¹¶åœ¨ä»£ç çš„ä¸Šä¸€è¡Œæ‰¾åˆ°å…¶å£°æ˜çš„ä½ç½®ã€‚ç„¶å language server ç”¨ä»¥ä¸‹æ¶ˆæ¯è¿›è¡Œå“åº”:</p><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"jsonrpc"</span>: <span class="string">"2.0"</span>,</span><br><span class="line">  <span class="attr">"id"</span>: <span class="number">1</span>,</span><br><span class="line">  <span class="attr">"result"</span>: &#123;</span><br><span class="line">    <span class="attr">"uri"</span>: <span class="string">"file:///Users/NSHipster/Example.swift"</span>,</span><br><span class="line">    <span class="attr">"range"</span>: &#123;</span><br><span class="line">      <span class="attr">"start"</span>: &#123;</span><br><span class="line">        <span class="attr">"line"</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">"character"</span>: <span class="number">6</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">"end"</span>: &#123;</span><br><span class="line">        <span class="attr">"line"</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">"character"</span>: <span class="number">12</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ€åï¼Œç¼–è¾‘å™¨å¯¼èˆªåˆ°æ–‡ä»¶(åœ¨æœ¬ä¾‹ä¸­ï¼Œè¯¥æ–‡ä»¶å·²ç»æ‰“å¼€)ï¼Œå°†å…‰æ ‡ç§»åŠ¨åˆ°è¯¥èŒƒå›´ï¼Œå¹¶é«˜äº®æ˜¾ç¤ºå‡ºæ¥ã€‚</p><p>è¿™ç§æ–¹æ³•çš„ç¾å¦™ä¹‹å¤„åœ¨äºï¼Œç¼–è¾‘å™¨å®Œæˆæ‰€æœ‰è¿™äº›æ“ä½œæ—¶ï¼Œé™¤äº† .swift æ–‡ä»¶ä¸ Swift ä»£ç ç›¸å…³ä»¥å¤–ï¼Œå¯¹ Swift ç¼–ç¨‹è¯­è¨€ä¸€æ— æ‰€çŸ¥ã€‚ç¼–è¾‘å™¨éœ€è¦åšçš„å°±æ˜¯ä¸ language server å¯¹è¯å¹¶æ›´æ–° UIã€‚è€Œä¸”ç¼–è¾‘å™¨çŸ¥é“å¦‚ä½•åšåˆ°è¿™ä¸€ç‚¹åï¼Œå°±å¯ä»¥éµå¾ªç›¸åŒçš„è¿‡ç¨‹ï¼Œä¸ä»»ä½•å¸¦æœ‰ language server çš„è¯­è¨€æ‰€ç¼–å†™çš„ä»£ç è¿›è¡Œäº¤äº’ã€‚</p><h2 id="Clang-LLVM-é‡Œçš„-Language-Server-Protocol"><a href="#Clang-LLVM-é‡Œçš„-Language-Server-Protocol" class="headerlink" title="Clang / LLVM é‡Œçš„ Language Server Protocol"></a>Clang / LLVM é‡Œçš„ Language Server Protocol</h2><p>å¦‚æœä½ è§‰å¾—ä¹‹å‰çš„ <em>M + N</em> å›¾æœ‰ç‚¹çœ¼ç†Ÿï¼Œé‚£å¯èƒ½æ˜¯å› ä¸º LLVM ä¹Ÿé‡‡ç”¨äº†åŒæ ·çš„æ–¹æ³•ã€‚</p><p>LLVM çš„æ ¸å¿ƒæ˜¯ä¸­é—´è¡¨ç¤ºï¼ˆintermediate representationï¼ŒIRï¼‰ã€‚LLVM æ‰€æ”¯æŒçš„è¯­è¨€ä½¿ç”¨ <em>ç¼–è¯‘å™¨å‰ç«¯ï¼ˆcompiler frontendï¼‰</em> ç”Ÿæˆ IRï¼Œå†ä½¿ç”¨ <em>ç¼–è¯‘å™¨åç«¯ï¼ˆcompiler backendï¼‰</em> å°† IR ç”Ÿæˆæ‰€æ”¯æŒå¹³å°çš„æœºå™¨ç ã€‚</p><p><img src="https://nshipster.com/assets/lsp-llvm-ir-34a10847cbe6519370c1b5e92def8f82b2ebde71aa2440c88880283bd5cbaf0a.svg" alt="lsp-llvm-ir.svg"></p><blockquote><p>å¦‚æœä½ æƒ³äº†è§£ Swift ä»£ç ç¼–è¯‘çš„æ›´å¤šç»†èŠ‚ï¼Œè¯·æŸ¥çœ‹ <a href="https://nshipster.com/swiftsyntax/" target="_blank" rel="noopener">æˆ‘ä»¬å…³äº SwiftSyntax çš„æ–‡ç« </a>ã€‚</p></blockquote><p><a href="https://clang.llvm.org" target="_blank" rel="noopener">Clang</a> æ˜¯ C è¯­è¨€çš„ LLVM ç¼–è¯‘å™¨å‰ç«¯ã€‚Swift ä¸ Objective-C çš„äº’æ“ä½œæ€§ï¼ˆinter-operabilityï¼‰å°±æ˜¯é å®ƒå®ç°çš„ã€‚åœ¨æœ€è¿‘çš„ 5.0.0 ç‰ˆæœ¬ä¸­ï¼ŒClang æ·»åŠ äº†ä¸€ä¸ªåä¸º <a href="https://clang.llvm.org/extra/clangd.html" target="_blank" rel="noopener">Clangd</a> çš„æ–°å·¥å…·ï¼Œå®ƒæ˜¯ LLVM å¯¹ Language Server Protocol çš„å®ç°ã€‚</p><p>2018 å¹´ 4 æœˆï¼Œ<a href="http://lists.llvm.org/pipermail/cfe-dev/2018-April/057668.html" target="_blank" rel="noopener">è‹¹æœå…¬å¸å‘ LLVM é‚®ä»¶ç»„å®£å¸ƒ</a>ï¼Œå°†æŠŠå¼€å‘çš„é‡å¿ƒä» <a href="https://clang.llvm.org/doxygen/group__CINDEX.html" target="_blank" rel="noopener">libclang</a> è½¬å‘ Clangdï¼Œä»¥å…¶ä½œä¸ºåˆ›å»ºäº¤äº’å·¥å…·çš„ä¸»è¦æ–¹å¼ã€‚</p><p>ç°åœ¨ä½ å¯èƒ½ä¼šæƒ³ï¼Œ<em>â€œé‚£åˆæ€æ ·ï¼Ÿâ€</em> è‹¹æœå…¬å¸æ˜¯ LLVM é¡¹ç›®æœ€é‡è¦çš„æ”¯æŒè€…ä¹‹ä¸€ï¼Œè¯¥é¡¹ç›®åˆ›å§‹äºº Chris Lattner å·²ç»åœ¨è‹¹æœå…¬å¸å·¥ä½œäº†åå¤šå¹´ã€‚è‹¹æœå…¬å¸å†³å®šä»ä¸é€æ˜çš„ Clang å·¥å…·åˆ‡æ¢åˆ°å¦ä¸€ä¸ªï¼Œä¼¼ä¹æ˜¯ä¸€ä¸ªå®ç°ç»†èŠ‚äº†(å¯ä»¥è¿™ä¹ˆè¯´)ã€‚</p><p>è¿™ä¸ªå®˜å®£å¾ˆæœ‰è¶£çš„ä¸€ç‚¹æ˜¯ï¼ŒClangd ä¼¼ä¹å®Œå…¨æ˜¯åœ¨è‹¹æœä»¥å¤–å¼€å‘çš„ï¼Œè°·æ­Œå’Œå…¶ä»–å…¬å¸ä¹Ÿåšå‡ºäº†é‡å¤§è´¡çŒ®ã€‚è¿™ä¸ªå®˜å®£æ ‡å¿—ç€æœªæ¥å·¥å…·å¼€å‘æ–¹å‘çš„é‡å¤§è½¬å˜ â€”â€” å…­ä¸ªæœˆå Swift.org è®ºå›å°†è¯å®è¿™ä¸€ç‚¹ã€‚</p><h2 id="è‹¹æœæ”¯æŒ-Language-Server-Protocol-çš„æ½œåœ¨å½±å“"><a href="#è‹¹æœæ”¯æŒ-Language-Server-Protocol-çš„æ½œåœ¨å½±å“" class="headerlink" title="è‹¹æœæ”¯æŒ Language Server Protocol çš„æ½œåœ¨å½±å“"></a>è‹¹æœæ”¯æŒ Language Server Protocol çš„æ½œåœ¨å½±å“</h2><p>æ ¹æ®è‹¹æœå…¬å¸ 10 æœˆä»½å‘å¸ƒçš„ LSP å…¬å‘Šï¼Œæˆ‘ä»¬é¢„è®¡åœ¨æœªæ¥å‡ å‘¨å†…ï¼ˆæ’°å†™æœ¬æ–‡æ—¶ï¼Œæœ€æ—© 11 æœˆä¸­æ—¬ï¼‰å°†çœ‹åˆ°è¯¥é¡¹ç›®çš„é¦–æ‰¹ä»£ç ã€‚</p><p>è¦æ„Ÿå—è¿™äº›å‘å±•çš„å…¨éƒ¨å½±å“è¿˜éœ€è¦ä¸€äº›æ—¶é—´ï¼Œä½†è¯·ç›¸ä¿¡æˆ‘ï¼šä½ çš„è€å¿ƒæ˜¯å€¼å¾—çš„ã€‚æˆ‘ç›¸ä¿¡ä»¥ä¸‹æ˜¯ LSP åœ¨æœªæ¥å‡ ä¸ªæœˆå’Œå‡ å¹´å°†ä¼šå‘ç”Ÿçš„ä¸€äº›äº‹æƒ…ã€‚</p><h3 id="Swift-å˜æˆä¸€ç§æ›´åŠ é€šç”¨çš„ç¼–ç¨‹è¯­è¨€"><a href="#Swift-å˜æˆä¸€ç§æ›´åŠ é€šç”¨çš„ç¼–ç¨‹è¯­è¨€" class="headerlink" title="Swift å˜æˆä¸€ç§æ›´åŠ é€šç”¨çš„ç¼–ç¨‹è¯­è¨€"></a>Swift å˜æˆä¸€ç§æ›´åŠ é€šç”¨çš„ç¼–ç¨‹è¯­è¨€</h3><p>è™½ç„¶ Swift ä¸»è¦ç”¨äº APP å¼€å‘ï¼Œä½†å®ƒä»ä¸€å¼€å§‹å°±è¢«è®¾è®¡æˆä¸€ç§åŠŸèƒ½å¼ºå¤§çš„é€šç”¨ç¼–ç¨‹è¯­è¨€ã€‚åœ¨ <a href="https://www.tensorflow.org/swift/" target="_blank" rel="noopener">Swift for TensorFlow</a>ã€<br><a href="https://github.com/apple/swift-nio" target="_blank" rel="noopener">SwiftNIO</a> å’Œå…¶ä»–é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬æ­£å¼€å§‹çœ‹åˆ° Swift æ‰¿è¯ºçš„åœ¨ App Store ä¹‹å¤–çš„ä½¿ç”¨ã€‚</p><p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œé˜»ç¢ Swift è¢«ä¸»æµé‡‡ç”¨çš„æœ€å¤§å› ç´ ä¹‹ä¸€æ˜¯å®ƒå¯¹ Xcode çš„ä¾èµ–ã€‚</p><p>äººä»¬ä¼šæœ‰å¾ˆå¤šè´¨ç–‘ï¼Œå½“æœ‰é‚£ä¹ˆå¤šä¼˜ç§€çš„ã€é—¨æ§›ä½å¾ˆå¤šçš„æ›¿ä»£æ–¹æ¡ˆå¯é€‰çš„æƒ…å†µä¸‹ï¼Œä¸ºä»€ä¹ˆè¿˜è¦è®© Web å¼€å‘è€…æˆ–æœºå™¨å­¦ä¹ å·¥ç¨‹å¸ˆä»…ä»…ä¸ºäº†å°è¯• Swift è€Œå»ä¸‹è½½ Xcodeï¼Ÿæ”¯æŒ Language Server Protocol å¯ä»¥è®©è‹¹æœç”Ÿæ€åœˆä»¥å¤–çš„äººæ›´å®¹æ˜“åœ°ä½¿ç”¨ä»–ä»¬ç†Ÿæ‚‰å·¥å…·å»æ„Ÿå— Swiftã€‚</p><h3 id="Xcode-å˜å¾—æ›´å¥½"><a href="#Xcode-å˜å¾—æ›´å¥½" class="headerlink" title="Xcode å˜å¾—æ›´å¥½"></a>Xcode å˜å¾—æ›´å¥½</h3><p>æ”¯æŒ LSP ä¸ä»…ä»…æ˜¯è®© Swift åœ¨å…¶ä»–ç¼–è¾‘å™¨ä¸­è¿è¡Œåœ°æ›´å¥½ï¼ŒXcode ä¹Ÿå°†å—ç›ŠåŒªæµ…ã€‚</p><p>çœ‹çœ‹è‹¹æœ Swift é¡¹ç›®è´Ÿè´£äºº Ted Kremenek çš„ <a href="https://forums.swift.org/t/new-lsp-language-service-supporting-swift-and-c-family-languages-for-any-editor-and-platform/17024/29" target="_blank" rel="noopener">è¿™ç¯‡è®ºå›å¸–å­</a>:</p><blockquote><p>@akyrtzi æ‰€æè¿°çš„ LSP æœåŠ¡å°†æ¯”ä»Šå¤©çš„ SourceKit æ›´å¼ºå¤§ã€‚</p></blockquote><p>LSP å¯¹ Xcode å›¢é˜Ÿæ¥è¯´æ˜¯ä¸€ä¸ªæœºé‡ï¼Œè®©ä»–ä»¬ä½¿ç”¨ä¸€ç§æ–°çš„æ–¹æ³•å®ç° Swift é›†æˆï¼Œå¹¶å¯ä»¥å°†å…¶åº”ç”¨åœ¨è¯­è¨€å’Œå·¥å…·è‡ª 1.0 ç‰ˆæœ¬å‘å¸ƒä»¥æ¥å››å¹´ä¸­çš„æ‰€æœ‰æ”¹è¿›ä¸Šã€‚</p><h3 id="Xcodeï¼ˆæœ€ç»ˆï¼‰å˜å¾—æ›´å¼ºå¤§"><a href="#Xcodeï¼ˆæœ€ç»ˆï¼‰å˜å¾—æ›´å¼ºå¤§" class="headerlink" title="Xcodeï¼ˆæœ€ç»ˆï¼‰å˜å¾—æ›´å¼ºå¤§"></a>Xcodeï¼ˆæœ€ç»ˆï¼‰å˜å¾—æ›´å¼ºå¤§</h3><p>LSP çš„å¥½å¤„å¹¶ä¸é™äº Swift å’Œ Objective-Cï¼Œ<a href="https://forums.swift.org/t/new-lsp-language-service-supporting-swift-and-c-family-languages-for-any-editor-and-platform/17024/33" target="_blank" rel="noopener">Argyrios åœ¨é‚£ä¸ªå¸–å­çš„å¦ä¸€ä¸ªç•™è¨€ä¸­æŒ‡å‡º</a>ï¼š</p><blockquote><p>Xcode ä½¿ç”¨æˆ‘ä»¬æ–°çš„ LSP æœåŠ¡ï¼Œè¿™æ„å‘³ç€å®ƒä¹Ÿå¯ä»¥ä½¿ç”¨å…¶ä»– LSP æœåŠ¡ï¼Œæˆ‘ä»¬å¯¹æ­¤å¾ˆæ„Ÿå…´è¶£ï¼Œä¸è¿‡ç›®å‰æš‚æ— å…·ä½“è®¡åˆ’ã€‚</p></blockquote><p>ç›®å‰çš„å·¥ä½œé‡ç‚¹æ˜¯æ”¹è¿› Swiftã€‚ä½†æ˜¯ï¼Œä¸€æ—¦å®ç°äº†è¿™ä¸€ç‚¹ï¼Œå°±åº”è¯¥èƒ½ç›¸å¯¹ç®€å•åœ°å°†è¿™äº›ä¼˜åŒ–è½¬ç§»åˆ°æ”¯æŒ LSP çš„å…¶ä»–è¯­è¨€ä¸­ã€‚</p><hr><p>è½¯ä»¶çš„æ¶æ„åæ˜ äº†åˆ›å»ºå®ƒçš„ç»„ç»‡çš„ç»“æ„å’Œä»·å€¼ã€‚åœ¨æŸç§ç¨‹åº¦ä¸Šï¼Œåä¹‹äº¦ç„¶ã€‚</p><p>é€šè¿‡è®© Xcode æ”¯æŒå¼€æ”¾çš„ Language Server Protocol æ ‡å‡†ï¼Œè‹¹æœæ­£åœ¨å±¥è¡Œå…¶åœ¨è‹¹æœç”Ÿæ€ç³»ç»Ÿä¹‹å¤–çš„å¹³å°ä¸Šå®ç° Swift æˆåŠŸçš„æ‰¿è¯ºã€‚æˆ‘è®¤ä¸ºè¿™æ˜¯å¯è¡Œçš„ï¼šå·¥å…·ï¼ˆæˆ–ç¼ºå°‘å·¥å…·ï¼‰é€šå¸¸æ˜¯æŠ€æœ¯è·å¾—äººå¿ƒçš„å…³é”®å†³å®šå› ç´ ã€‚ä½†æˆ–è®¸æ›´é‡è¦çš„æ˜¯ï¼Œæˆ‘è®¤ä¸ºè¿™ä¸€å†³å®šè¡¨æ˜ï¼Œå…¬å¸å†…éƒ¨ï¼ˆè‡³å°‘æ˜¯ä¸€å°éƒ¨åˆ†ï¼‰å¯¹åˆä½œå’Œé€æ˜åº¦çš„æ„æ„¿æœ‰æ‰€å¢å¼ºã€‚</p><blockquote><p>æœ¬æ–‡ç”± SwiftGG ç¿»è¯‘ç»„ç¿»è¯‘ï¼Œå·²ç»è·å¾—ä½œè€…ç¿»è¯‘æˆæƒï¼Œæœ€æ–°æ–‡ç« è¯·è®¿é—® <a href="http://swift.gg">http://swift.gg</a>ã€‚</p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;ä½œè€…ï¼šMatttï¼Œ&lt;a href=&quot;https://nshipster.com/language-server-protocol/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;åŸæ–‡é“¾æ¥&lt;/a&gt;ï¼ŒåŸæ–‡æ—¥æœŸï¼š2018-11-19&lt;br&gt;è¯‘è€…ï¼š&lt;a href=&quot;https://github.com/mobilefellow&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;é›¨è°¨&lt;/a&gt;ï¼›æ ¡å¯¹ï¼š&lt;a href=&quot;http://numbbbbb.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;numbbbbb&lt;/a&gt;ï¼Œ&lt;a href=&quot;http://www.jianshu.com/users/596f2ba91ce9/latest_articles&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;pmst&lt;/a&gt;ï¼›å®šç¨¿ï¼š&lt;a href=&quot;http://forelax.space&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Forelax&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;!--æ­¤å¤„å¼€å§‹æ­£æ–‡--&gt;
&lt;p&gt;ä¸Šä¸ªæœˆï¼Œè‹¹æœå…¬å¸ &lt;a href=&quot;https://forums.swift.org/t/new-lsp-language-service-supporting-swift-and-c-family-languages-for-any-editor-and-platform/17024&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;åœ¨ Swift.org è®ºå›ä¸Šå®£å¸ƒ&lt;/a&gt;ï¼Œæ­£åœ¨ç€æ‰‹ä¸º Swift å’Œ C è¯­è¨€æ”¯æŒ &lt;a href=&quot;https://microsoft.github.io/language-server-protocol/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Language Server Protocol&lt;/a&gt;ï¼ˆè¯­è¨€æœåŠ¡å™¨åè®®ï¼ŒLSPï¼‰ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;å¯¹äºè‹¹æœå…¬å¸è€Œè¨€ï¼Œä¸ºæ‰€æœ‰ Swift å¼€å‘è€… â€”â€” åŒ…æ‹¬éè‹¹æœå¹³å°ä¸Šçš„ â€”â€” æä¾›é«˜è´¨é‡çš„å·¥å…·æ”¯æŒéå¸¸é‡è¦ã€‚æˆ‘ä»¬å¸Œæœ›ä¸å¼€æºç¤¾åŒºåˆä½œï¼Œå°†ç²¾åŠ›é›†ä¸­åœ¨æ„å»º Xcode å’Œå…¶ä»–ç¼–è¾‘å™¨ã€å…¶ä»–å¹³å°å¯ä»¥å…±äº«çš„å…¬å…±åŸºç¡€è®¾æ–½ä¸Šã€‚ä¸ºå®ç°è¿™ä¸€ç›®æ ‡ï¼Œ[â€¦â€¦]ï¼Œæˆ‘ä»¬å†³å®šæ”¯æŒ LSPã€‚&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Argyrios Kyrtzidisï¼Œ2018 å¹´ 10 æœˆ 15 æ—¥&lt;/em&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;è¿™å¯èƒ½æ˜¯è‹¹æœè‡ª 2014 å¹´å°† Swift ä½œä¸ºå¼€æºè½¯ä»¶å‘å¸ƒä»¥æ¥ï¼Œä¸º Swift åšå‡ºçš„æœ€é‡è¦çš„å†³å®šã€‚&lt;/strong&gt; è¿™å¯¹äº APP å¼€å‘è€…æ¥è¯´æ˜¯ä¸€ä»¶å¤§äº‹ï¼Œå¯¹äºå…¶ä»–å¹³å°ä¸Šçš„ Swift å¼€å‘è€…æ¥è¯´æ›´æ˜¯ä¸€ä»¶å¤§äº‹ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†ç†è§£å…¶ä¸­çš„åŸå› ï¼Œæœ¬å‘¨çš„æ–‡ç« å°†ç ”ç©¶ Language Server Protocol è§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Œå®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Œä»¥åŠå®ƒçš„é•¿æœŸå½±å“å¯èƒ½æ˜¯ä»€ä¹ˆã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="Swift" scheme="https://swift.gg/categories/Swift/"/>
    
      <category term="NSHipster" scheme="https://swift.gg/categories/Swift/NSHipster/"/>
    
    
      <category term="Swift" scheme="https://swift.gg/tags/Swift/"/>
    
      <category term="NSHipster" scheme="https://swift.gg/tags/NSHipster/"/>
    
  </entry>
  
  <entry>
    <title>Swift å‚»ç“œæŠ€å·§ #6ï¼šæœ‰åŠ¨ç”»æˆ–æ— åŠ¨ç”»</title>
    <link href="https://swift.gg/2019/01/07/stupid-swift-tricks-6-animations/"/>
    <id>https://swift.gg/2019/01/07/stupid-swift-tricks-6-animations/</id>
    <published>2019-01-07T00:00:00.000Z</published>
    <updated>2019-02-18T08:52:32.961Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ä½œè€…ï¼šWooji Juiceï¼Œ<a href="http://www.wooji-juice.com/blog/stupid-swift-tricks-6-animations.html" target="_blank" rel="noopener">åŸæ–‡é“¾æ¥</a>ï¼ŒåŸæ–‡æ—¥æœŸï¼š2018-11-14<br>è¯‘è€…ï¼š<a href="https://github.com/alejx" target="_blank" rel="noopener">çŸ³æ¦´</a>ï¼›æ ¡å¯¹ï¼š<a href="http://numbbbbb.com/" target="_blank" rel="noopener">numbbbbb</a>ï¼Œ<a href="https://github.com/Cee" target="_blank" rel="noopener">Cee</a>ï¼›å®šç¨¿ï¼š<a href="http://forelax.space" target="_blank" rel="noopener">Forelax</a></p></blockquote><!--æ­¤å¤„å¼€å§‹æ­£æ–‡--><p>æµç•…çš„åŠ¨ç”»ä¸€å¼€å§‹å°±è¢«è®¤ä¸ºæ˜¯ iOS åº”ç”¨çš„ç‰¹ç‚¹ä¹‹ä¸€ã€‚è¿™ä¸ä»…å½’åŠŸäº iOS ç³»ç»Ÿå¼ºå¤§çš„åŠ¨ç”»å¼•æ“ï¼ˆä»è€Œä½¿å¾— App èƒ½å¤Ÿä¸€è¾¹å±•ç¤ºæµç•…çš„åŠ¨ç”»ä¸€è¾¹åšç€å…¶ä»–çš„äº‹æƒ…ï¼‰ï¼Œè¿˜å½’åŠŸäºç³»ç»Ÿæä¾›çš„éå¸¸æ–¹ä¾¿çš„åŠ¨ç”» APIï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æ— åŠ¨ç”»</span></span><br><span class="line">doStuff()</span><br><span class="line"><span class="comment">// æœ‰åŠ¨ç”»</span></span><br><span class="line"><span class="type">UIView</span>.animate(withDuration: <span class="number">1</span>) &#123; doStuff() &#125;</span><br></pre></td></tr></table></figure><p>åªéœ€è¦å°†ä½ çš„ä»£ç æ”¾è¿› blockï¼ˆé—­åŒ…ï¼‰ä¸­ï¼Œå°±å¯ä»¥è®©å®ƒä»¬æ‹¥æœ‰æµç•…çš„ç¼“å…¥ç¼“å‡ºçš„åŠ¨ç”»æ•ˆæœã€‚</p><p>ç„¶è€Œï¼Œå¦‚æœä½ ä½¿ç”¨è¿‡è¿™å¥—ç³»ç»Ÿï¼Œä½ å¯èƒ½ä¼šé‡åˆ°ä¸€äº›é—®é¢˜ã€‚è¿™ä¸ªç³»ç»Ÿå¯ä»¥å®Œç¾åœ°å¤„ç†ç®€å•çš„æƒ…å†µï¼Œæ¯”å¦‚è®©ä¸€ä¸ªä¸œè¥¿æ·¡å…¥ã€æ·¡å‡ºï¼Œæˆ–æ”¹å˜å®ƒçš„é¢œè‰²ï¼Œä½†åœ¨æ›´å¤æ‚çš„æƒ…å†µä¸‹ï¼Œè¿™ç§æ–¹æ³•å°±ä¼šå¼€å§‹å‡ºç°é—®é¢˜ã€‚</p><a id="more"></a><p>ä¾‹å¦‚ä¸‹é¢è¿™ä¸ªä¾‹å­ï¼Œä½ æƒ³è¦æ·¡å‡ºä¸€ä¸ªå…ƒç´ ï¼Œç„¶ååˆ é™¤å®ƒã€‚<code>UIView</code> æ”¯æŒè¿™ç§æ“ä½œï¼š<br><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="type">UIView</span>.animate(withDuration: <span class="number">1</span>, animations:</span><br><span class="line">&#123;</span><br><span class="line">someting.alpha = <span class="number">0</span></span><br><span class="line">&#125;, completion:</span><br><span class="line">&#123;</span><br><span class="line">something.removeFormSuperView()</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p><p>ä½†ä½ åªèƒ½æŠŠæ‰€æœ‰ä¸œè¥¿éƒ½å†™åœ¨ <code>completion</code> block é‡Œæ—¶æ‰ä¼šå·¥ä½œã€‚åœ¨å¤§å‹é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬éœ€è¦æŠŠå¤æ‚çš„ä»»åŠ¡æ‹†è§£æˆå°çš„æ–¹æ³•ã€‚ä½†é—®é¢˜å°±åœ¨è¿™äº›æ–¹æ³•ä¸­ï¼Œåƒåœ¨ä¸Šä¸ªä¾‹å­ä¸­çš„ <code>doStuff()</code>ï¼Œæˆ‘ä»¬æ— æ³•åœ¨ <code>completion</code> block ä¸­æ·»åŠ ä»£ç ã€‚</p><p>æˆ‘ä»¬ä¹Ÿæ— æ³•å¾—çŸ¥åŠ¨ç”»æœ‰å¤šé•¿ï¼ˆç”šè‡³éƒ½ä¸çŸ¥é“æœ‰æ²¡æœ‰åŠ¨ç”»ï¼‰ï¼Œæ‰€ä»¥å¦‚æœæˆ‘ä»¬æ²¡æœ‰åŠæ³•ç®€å•åœ°å’ŒåŠ¨ç”»æ—¶é—´ä¹‹é—´åŒæ­¥ï¼ˆå¦‚åœ¨ <a href="http://www.wooji-juice.com/products/ferrite/" target="_blank" rel="noopener">ä¸€ä¸ªéŸ³é¢‘ç¼–è¾‘è½¯ä»¶</a> ä¸­è®©è¿›åº¦æ¡åŒæ­¥å‰è¿›ï¼‰ã€‚</p><p>æ€»çš„æ¥è¯´ï¼Œæˆ‘ä»¬æ— æ³•è·çŸ¥å…³äºåŠ¨ç”»çš„<em>ä¿¡æ¯</em>ï¼Œä»–ä»¬ä»…ä»…æ˜¯æ‰§è¡Œä»£ç ï¼Œè¿›è¡Œæˆ–ä¸è¿›è¡ŒåŠ¨ç”»ï¼Œå¹¶ä¸ä¼šå—æˆ‘ä»¬æ§åˆ¶ã€‚</p><p>å¦‚æœæˆ‘ä»¬åœ¨è§†å›¾ä¸­æ·»åŠ å¸¦æœ‰ Auto Layout çš„æ–°å…ƒç´ ï¼Œäº‹æƒ…å°±ä¼šå˜å¾—æ›´å¤æ‚ï¼šä½ éœ€è¦å°å¿ƒåœ°è°ƒç”¨ <code>UIView.performWithoutAnimation { }</code>ï¼Œå¦åˆ™æ–°å‡ºç°çš„è§†å›¾å°±ä¼šä» <code>(x: 0, y: 0, w: 0, h: 0)</code> ç¬ç§»åˆ°å®ƒä»¬çš„ç›®æ ‡ä½ç½®ã€‚</p><h2 id="è§†å›¾å±æ€§-Animator"><a href="#è§†å›¾å±æ€§-Animator" class="headerlink" title="è§†å›¾å±æ€§ Animator"></a>è§†å›¾å±æ€§ Animator</h2><p>å¾ˆé•¿æ—¶é—´ä»¥æ¥ï¼Œæˆ‘ä¸€ç›´åœ¨æ”¹å˜ä»£ç ä¸­åŠ¨ç”»çš„å†™æ³•ã€‚æœ€å¼€å§‹æˆ‘å†™äº†æˆ‘è‡ªå·±çš„ <code>AnimationContext</code> ç±»æ¥ååŠ©ï¼Œåæ¥è‹¹æœæä¾›äº†ä»–ä»¬åŠŸèƒ½ç›¸åŒçš„ <code>UIViewPropertyAnimator</code>ï¼Œç°åœ¨æˆ‘ä¼šåœ¨æ‰€æœ‰å¯èƒ½çš„åœ°æ–¹ä½¿ç”¨å®ƒã€‚</p><p>ä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘å‘ç°æœ€æœ‰æ•ˆçš„æ–¹æ³•æ˜¯å†™ä¸€ä¸ªã€Œå¯åŠ¨ç”»ã€çš„æ–¹æ³•å¹¶æ˜¾å¼æ¥å—ä¸€ä¸ª animator å‚æ•°ï¼š<br><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">doStuff</span><span class="params">(with animator: UIViewPropertyAnimator? = <span class="literal">nil</span>)</span></span></span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ä¹‹åæˆ‘å°±å¯ä»¥ç›´æ¥è°ƒç”¨ <code>doStuff()</code> ä¸æ·»åŠ åŠ¨ç”»å¹¶å®Œæˆä»»åŠ¡ï¼Œæˆ–è°ƒç”¨ <code>doStuff(with: UIViewPropertyAnimator(duration: 1, curve: .easeInOut))</code> æˆ–åŠ å…¶ä»–çš„å‚æ•°å»å®Œæˆä»»åŠ¡å¹¶æ·»åŠ åŠ¨ç”»ã€‚</p><p>ï¼ˆå®é™…æƒ…å†µä¸­ï¼Œä¸Šè¿°æ–¹æ³•é€šå¸¸ä¼šè¢«ç§°ä½œ <code>reflectCurrentState()</code> æˆ–å…¶ä»–ç‰¹å®šé¢†åŸŸçš„åå­—ï¼›è¯¥æ–¹æ³•æ‰§è¡Œæ‰€æœ‰å¿…è¦çš„ä¿®æ”¹ï¼Œå¹¶å°†è§†å›¾ä¸æœ€æ–°çš„æ•°æ®åŒæ­¥ã€‚è¯¥æ–¹æ³•ä¸€èˆ¬ä¸ä¼šè¢«æœ¬è§†å›¾ä»¥å¤–çš„ä»£ç è°ƒç”¨ï¼Œè€Œæ˜¯è¢«è§†å›¾è‡ªå·±è°ƒç”¨ï¼Œç„¶åä¼šæ ¹æ®éœ€è¦ç»§ç»­è°ƒç”¨å…¶ä»–å†…éƒ¨æ–¹æ³•ï¼Œæˆ–å°† animator ä¼ ç»™å…¶ä»–å†…éƒ¨æ–¹æ³•ã€‚ä¸è¿‡è¿™ä¸åœ¨æœ¬æ–‡çš„è®¨è®ºèŒƒå›´å†…ã€‚ï¼‰</p><p><code>doStuff()</code> å¯ä»¥åƒä¹‹å‰ä¸€æ ·ï¼Œå¸¦æœ‰æˆ–ä¸å¸¦æœ‰åŠ¨ç”»æ‰§è¡Œä¸€ä¸ªä»»åŠ¡ã€‚ä½†ç°åœ¨å®ƒå¸¦æœ‰äº†æ›´å¤šä¿¡æ¯ï¼šå®ƒçŸ¥é“è‡ªå·±æ˜¯å¦æ‰§è¡ŒåŠ¨ç”»ï¼›å®ƒå¯ä»¥è¯»å– animator çš„ <code>duration</code> å±æ€§ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰ã€‚ä»–å¯ä»¥è°ƒç”¨ animator çš„ <code>addAnimation</code> æ¥æ˜ç¡®åœ°æŒ‡å®šå“ªäº›ä»£ç éœ€è¦åŠ¨ç”»ï¼Œå¹¶ç›´æ¥æ‰§è¡Œä¸éœ€è¦åŠ¨ç”»çš„ä»£ç ï¼›ä»–å¯ä»¥è°ƒç”¨ <code>addCompletion</code> æ¥å¤„ç† <code>removeFromSuperView()</code> æˆ–å…¶ä»–æ–¹æ³•ã€‚</p><p>ä»¥ä¸Šéƒ½æ˜¯ç›¸æ¯”äºä¹‹å‰æ”¹è¿›çš„åœ°æ–¹ï¼Œä½†ä¹Ÿä¸æ˜¯æ²¡æœ‰é—®é¢˜ã€‚å°¤å…¶æ˜¯å®ƒå¼€å§‹å˜å¾—æœ‰ç‚¹å•°å—¦ï¼š</p><ol><li><code>doStuff(with: ...)</code> éœ€è¦å†™å…¥ä¸€ä¸ªå¾ˆé•¿çš„ <code>UIViewPropertyAnimator</code> æ„é€ å‡½æ•°ã€‚ä¸æ˜¯å¾ˆç†æƒ³ï¼Œä¸è¿‡è·Ÿä¸‹é¢æ¯”èµ·æ¥ä¸ç®—ä»€ä¹ˆï¼š</li><li>åœ¨ <code>doStuff()</code> å†…éƒ¨ï¼Œéœ€è¦æ£€æŸ¥ <code>UIViewPropertyAnimator</code> æ˜¯å¦å­˜åœ¨å¹¶è°ƒæ•´ä»£ç ã€‚</li></ol><p>æˆ‘ä»¬ä¸èƒ½ç®€å•çš„ä¾èµ– optional chainingï¼ˆå¯é€‰é“¾å¼è°ƒç”¨)ï¼ˆå¦‚ <code>animator?.addcompletion { something.removeFromSuperview() }</code>ï¼‰ï¼Œå› ä¸ºå¦‚æœ animator æ˜¯ <code>nil</code> ä¼šå¯¼è‡´ block ä¸­çš„ä»£ç è¢«ç›´æ¥è·³è¿‡ï¼Œç„¶è€Œæ— è®ºæœ‰æ²¡æœ‰åŠ¨ç”»ï¼Œæˆ‘ä»¬éƒ½å¸Œæœ›è¯¥è§†å›¾åœ¨çˆ¶è§†å›¾ä¸­è¢«ç§»é™¤ã€‚</p><p>ä¸ºäº†ä¿è¯æ­£ç¡®çš„è¡Œä¸ºï¼Œä½ çš„ä»£ç ä¼šç±»ä¼¼è¿™ä¸ªæ ·å­ï¼š<br><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">doStuff</span><span class="params">(with animator: UIViewPropertyAnimator? = <span class="literal">nil</span>)</span></span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> <span class="keyword">let</span> animator = animator</span><br><span class="line">&#123;</span><br><span class="line"><span class="number">_</span> <span class="keyword">in</span> something.removeFromSuperview()</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">something.removeFromSuperview()</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>Objective-C çˆ±å¥½è€…å³ä½¿ç§ä¸èµ· Optionalï¼ˆå¯é€‰ï¼‰ä¹Ÿç¬‘ä¸å‡ºæ¥ â€“ ä½¿ç”¨ Objective-C ä¹Ÿä¸ä¼šæ”¹å–„è¿™ç§æƒ…å†µï¼š<br><figure class="highlight objc"><table><tr><td class="code"><pre><span class="line">- (<span class="keyword">void</span>) doStuffWithAnimator: (<span class="keyword">nullable</span> <span class="built_in">UIViewPropertyAnimator</span> *) animator</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (animator != <span class="literal">nil</span>)</span><br><span class="line">&#123;</span><br><span class="line">[animator addCompletion: ^(<span class="built_in">UIViewAnimatingPosition</span> position)</span><br><span class="line">&#123;</span><br><span class="line">[something removeFromSuperview];</span><br><span class="line">&#125;];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">[something removeFromSuperView];</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ä¸€æ—¦ä½ åœ¨ç”Ÿäº§ç¯å¢ƒä¸­æƒ³ä½¿ç”¨è¿™æ ·çš„ä»£ç ï¼Œä½ æœ€ç»ˆä¼šå†™å‡ºæ›´æ‚ä¹±ã€æ›´éš¾äºé˜…è¯»å’Œç»´æŠ¤çš„ä»£ç ã€‚</p><p>å¹¸è¿çš„æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥è¿›ä¸€æ­¥çš„æ”¹è¿›è¿™æ®µä»£ç ã€‚</p><h2 id="Optional-ä¸æ˜¯-Nil-çš„å¦ä¸€ä¸ªå«æ³•"><a href="#Optional-ä¸æ˜¯-Nil-çš„å¦ä¸€ä¸ªå«æ³•" class="headerlink" title="Optional ä¸æ˜¯ Nil çš„å¦ä¸€ä¸ªå«æ³•"></a>Optional ä¸æ˜¯ <code>Nil</code> çš„å¦ä¸€ä¸ªå«æ³•</h2><p>æ”¹è¿›è¿™æ®µä»£ç çš„è¯€çªå°±åœ¨äºï¼Œ<code>UIViewPropertyAnimator</code> åœ¨è¿™é‡Œæ˜¯ Optionalï¼Œå…³é”®ç‚¹å°±åœ¨äº Optional åœ¨ Swift ä¸­çš„æ„ä¹‰ã€‚</p><p>æœ‰çš„æ—¶å€™äººä»¬ä¼šæŠ±æ€¨ Swift çš„ Optional éå¸¸çƒ¦äººï¼Œå› ä¸ºåœ¨ Objective-C ä¸­ï¼ˆObjective-C ä¸­ä½¿ç”¨ <code>nil</code> æŒ‡é’ˆæ¥æ›¿ä»£ Swift ä¸­çš„ Optionalï¼‰ä½ å¯ä»¥ç›´æ¥å¯¹æŒ‡é’ˆè°ƒç”¨æ–¹æ³•ã€‚</p><p>Objective-C ä¸ä¼šæŠ±æ€¨æŒ‡é’ˆæ˜¯ä¸æ˜¯ <code>nil</code>ï¼šå¦‚æœæŒ‡é’ˆéç©ºï¼Œæ–¹æ³•ä¼šç›´æ¥è¢«è°ƒç”¨ï¼›å¦‚æœæ˜¯ç©ºæŒ‡é’ˆï¼Œè°ƒç”¨ä¼šè¢«æ— å£°åœ°å¿½ç•¥æ‰ï¼Œä¸ç”¨ç¨‹åºå‘˜åšå…¶ä»–çš„äº‹æƒ…ã€‚</p><p>æˆ‘ä¸åŒæ„è¿™ä¸ªæ„è§ã€‚åœ¨ Swift ä¸­ï¼Œåœ¨ä½ çŸ¥é“ä½ åœ¨åšä»€ä¹ˆçš„æƒ…å†µä¸‹ï¼Œä½ åªéœ€è¦åŠ ä¸€ä¸ª <code>?</code>ï¼Œå¹¶ä¸æ˜¯ä¸€ä¸ªå¾ˆå¤§çš„è´Ÿæ‹…ã€‚ä½†æ˜¯ç”±äºæœ‰äº† Swift çš„ Optionalï¼Œæˆ‘ä»¬å¯ä»¥åšæ›´å¤šäº‹æƒ…ã€‚</p><p>å› ä¸ºåœ¨ Swift ä¸­ï¼ŒOptional æ˜¯ä¸€ä¸ªâ€œçœŸå®çš„ä¸œè¥¿â€ï¼Œè€Œä¸æ˜¯â€œç¼ºå°‘çš„ä¸œè¥¿â€ã€‚æ— è®ºä¸€ä¸ª Optional çš„å€¼æ˜¯ä»€ä¹ˆï¼Œå°±ç®—æ˜¯ <code>nil</code>ï¼Œå®ƒä¹Ÿæ˜¯ä¸€ä¸ªæšä¸¾å€¼ï¼Œä½ å¯ä»¥å¯¹å®ƒè°ƒç”¨æ–¹æ³•ï¼Œè°ƒç”¨çš„æ–¹æ³•ä¹Ÿä¼šè¢«æ‰§è¡Œã€‚<a href="http://www.wooji-juice.com/blog/stupid-swift-tricks-5-enums" target="_blank" rel="noopener">è®²çœŸçš„ï¼ŒSwift çš„æšä¸¾è¶…çº§å¥½ç”¨ï¼</a></p><p>ï¼ˆæœ‰è¶£çš„æ˜¯ï¼Œåœ¨ Objective-C ç±»ä¸­å¯¹ Swift çš„ <code>nil</code> çš„åº•å±‚è¡¨ç¤º<em>å°±æ˜¯</em>ç©ºæŒ‡é’ˆï¼Œæ‰€ä»¥å®ƒä»¬çš„æ•ˆç‡è¿˜æ˜¯å¾ˆé«˜çš„ã€‚ä½†æ˜¯è¯­æ³•å±‚é¢ï¼Œå®ƒä»¬éå¸¸çš„ä¸åŒã€‚æˆ‘ä»¬ä¼šåœ¨æ¥ä¸‹æ¥åˆ©ç”¨è¿™ä¸ªæ€§è´¨ã€‚ï¼‰</p><p>å› ä¸ºåœ¨ Swift ä¸­ï¼Œä½ å¯ä»¥å¯¹å‡ ä¹æ‰€æœ‰ç±»å‹æ·»åŠ æ‹“å±•ï¼Œä¸ä»…ä»…æ˜¯ Objective-C ç±»ã€‚ä½ å¯ä»¥ï¼š<br><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Optional</span> <span class="title">where</span> <span class="title">Wrapped</span> == <span class="title">UIViewPropertyAnimator</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    @discardableResult</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">addCompletion</span><span class="params">(<span class="number">_</span> block: @escaping <span class="params">(UIViewAnimatingPosition)</span></span></span>-&gt;()) -&gt; <span class="type">Optional</span>&lt;<span class="type">UIViewPropertyAnimator</span>&gt;</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> animator = <span class="keyword">self</span></span><br><span class="line">        &#123;</span><br><span class="line">            animator.addCompletion(block)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            block(.end)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">self</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>è¿™æ®µä»£ç å°†éš¾çœ‹çš„ä»£ç ç§»åŠ¨åˆ°äº† Optional çš„åº“ä¸­ï¼ˆä½†åªé’ˆå¯¹ <code>UIViewPropertyAnimator</code>ï¼‰ã€‚ç°åœ¨ï¼Œä½ çš„è§†å›¾å¯ä»¥ï¼š<br><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">doStuff</span><span class="params">(with animator: UIViewPropertyAnimator? = <span class="literal">nil</span>)</span></span></span><br><span class="line">&#123;</span><br><span class="line">animator.addCompletion &#123; <span class="number">_</span> <span class="keyword">in</span> something.removeFromSuperview() &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ç°åœ¨å›è°ƒå‡½æ•°æ€»ä¼šè¢«æ‰§è¡Œï¼Œæ— è®ºæœ‰æ²¡æœ‰ animatorã€‚</p><p>ï¼ˆæ³¨æ„ <code>animator</code> å’Œ <code>addCompletion</code> ä¹‹é—´æ²¡æœ‰ <code>?</code>ï¼‰</p><p>å¦‚æœæœ‰ animatorï¼Œblock ä¸­çš„ä»£ç ä¼šåœ¨åŠ¨ç”»å®Œæˆæ—¶è¢«è°ƒç”¨ï¼›å¦‚æœæ²¡æœ‰ animatorï¼Œblock ä¸­çš„ä»£ç ä¼šè¢«ç«‹å³è°ƒç”¨ï¼Œå› ä¸º <code>nil</code> Optional ä»ç„¶æ˜¯ Optionalï¼Œæ‹¥æœ‰æ‰€æœ‰ Optional çš„æ–¹æ³•ï¼Œå½“ç„¶ä¹ŸåŒ…æ‹¬æˆ‘ä»¬åˆšåˆšæ·»åŠ çš„æ–¹æ³• â€“ è€Œä¸æ˜¯ä¸€ä¸ªåä¸‹æ‰€æœ‰çš„æ»šè½åˆ°å®ƒè¡¨é¢çš„æ–¹æ³•è°ƒç”¨çš„é»‘æ´ã€‚</p><p>æˆ‘è¿˜æœ‰ç±»ä¼¼çš„æ‹“å±•æ–¹æ³•æ¥æ‰§è¡Œæ€»æ˜¯éœ€è¦è¢«æ‰§è¡Œçš„ä»»åŠ¡ï¼Œæœ‰äº›æ˜¯åŠ¨ç”»çš„ä¸€éƒ¨åˆ†ï¼Œæˆ–å…¶ä»–çš„ç«‹å³æ‰§è¡Œçš„ä»£ç ï¼šå¦‚æœæˆ‘æƒ³è®©ä¸€ä¸ªå…ƒç´ ç¼“å…¥ï¼Œæˆ‘ä¼šåœ¨æŠŠå…ƒç´ æ”¾å…¥è§†å›¾ä¹‹å‰å°† alpha å€¼è®¾ç½®æˆ 0ï¼Œç„¶åè°ƒç”¨ <code>animator.perform { something.alpha = 1 }</code> æ¥ä¿è¯å®ƒæ— è®ºæœ‰æ²¡æœ‰åŠ¨ç”»éƒ½ä¼šå˜å¾—å¯è§ã€‚</p><p>ä¸ Optional æ— å…³ï¼Œæˆ‘è¿˜åœ¨ <code>UIViewPropertyAnimator</code> ä¸­æ·»åŠ äº†ä¸€äº›é™æ€æ–¹æ³•æ¥ç”Ÿæˆä¸€äº›å¸¸è§çš„åŠ¨ç”»ï¼Œå¦‚ï¼š<code>static func spring(...)</code>ã€<code>static func linear(...)</code>ã€‚Swift çš„åç§°è§£ææ–¹æ³•å†³å®šäº†ä½ å¯ä»¥å†™å‡ºæ›´ç®€æ´çš„ä»£ç ï¼Œå¦‚ï¼š<code>doStuff(with: .spring(duration: 1))</code>ã€‚</p><p>å½“ç„¶ï¼Œä»¥ä¸Šåªæ˜¯ä¸€äº›å°çš„ä»£ç æŠ€å·§ï¼Œè€Œä¸æ˜¯é‡æ–°æ„æƒ³ä»£ç æˆ–åº”ç”¨ç»“æ„ã€‚ä½†æ˜¯éšç€é¡¹ç›®çš„å¤æ‚åº¦å¢åŠ ï¼Œåƒè¿™ç§å°çš„æ”¹è¿›ä¹Ÿä¼šå åŠ èµ·æ¥ï¼Œå¸®åŠ©æˆ‘ä»¬å¯¹æŠ—ä¸æ–­å¢åŠ çš„å¤æ‚åº¦ï¼Œç»´æŒå¤§å‹é¡¹ç›®çš„å¯æ§æ€§ã€‚è°¢è°¢ä½ ï¼ŒSwiftã€‚<a href="https://www.youtube.com/watch?v=9jtU9BbReQk" target="_blank" rel="noopener">Thwift</a>.</p><blockquote><p>æœ¬æ–‡ç”± SwiftGG ç¿»è¯‘ç»„ç¿»è¯‘ï¼Œå·²ç»è·å¾—ä½œè€…ç¿»è¯‘æˆæƒï¼Œæœ€æ–°æ–‡ç« è¯·è®¿é—® <a href="http://swift.gg">http://swift.gg</a>ã€‚</p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;ä½œè€…ï¼šWooji Juiceï¼Œ&lt;a href=&quot;http://www.wooji-juice.com/blog/stupid-swift-tricks-6-animations.html&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;åŸæ–‡é“¾æ¥&lt;/a&gt;ï¼ŒåŸæ–‡æ—¥æœŸï¼š2018-11-14&lt;br&gt;è¯‘è€…ï¼š&lt;a href=&quot;https://github.com/alejx&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;çŸ³æ¦´&lt;/a&gt;ï¼›æ ¡å¯¹ï¼š&lt;a href=&quot;http://numbbbbb.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;numbbbbb&lt;/a&gt;ï¼Œ&lt;a href=&quot;https://github.com/Cee&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Cee&lt;/a&gt;ï¼›å®šç¨¿ï¼š&lt;a href=&quot;http://forelax.space&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Forelax&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;!--æ­¤å¤„å¼€å§‹æ­£æ–‡--&gt;
&lt;p&gt;æµç•…çš„åŠ¨ç”»ä¸€å¼€å§‹å°±è¢«è®¤ä¸ºæ˜¯ iOS åº”ç”¨çš„ç‰¹ç‚¹ä¹‹ä¸€ã€‚è¿™ä¸ä»…å½’åŠŸäº iOS ç³»ç»Ÿå¼ºå¤§çš„åŠ¨ç”»å¼•æ“ï¼ˆä»è€Œä½¿å¾— App èƒ½å¤Ÿä¸€è¾¹å±•ç¤ºæµç•…çš„åŠ¨ç”»ä¸€è¾¹åšç€å…¶ä»–çš„äº‹æƒ…ï¼‰ï¼Œè¿˜å½’åŠŸäºç³»ç»Ÿæä¾›çš„éå¸¸æ–¹ä¾¿çš„åŠ¨ç”» APIï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight swift&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// æ— åŠ¨ç”»&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;doStuff()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// æœ‰åŠ¨ç”»&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;type&quot;&gt;UIView&lt;/span&gt;.animate(withDuration: &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;) &amp;#123; doStuff() &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;åªéœ€è¦å°†ä½ çš„ä»£ç æ”¾è¿› blockï¼ˆé—­åŒ…ï¼‰ä¸­ï¼Œå°±å¯ä»¥è®©å®ƒä»¬æ‹¥æœ‰æµç•…çš„ç¼“å…¥ç¼“å‡ºçš„åŠ¨ç”»æ•ˆæœã€‚&lt;/p&gt;
&lt;p&gt;ç„¶è€Œï¼Œå¦‚æœä½ ä½¿ç”¨è¿‡è¿™å¥—ç³»ç»Ÿï¼Œä½ å¯èƒ½ä¼šé‡åˆ°ä¸€äº›é—®é¢˜ã€‚è¿™ä¸ªç³»ç»Ÿå¯ä»¥å®Œç¾åœ°å¤„ç†ç®€å•çš„æƒ…å†µï¼Œæ¯”å¦‚è®©ä¸€ä¸ªä¸œè¥¿æ·¡å…¥ã€æ·¡å‡ºï¼Œæˆ–æ”¹å˜å®ƒçš„é¢œè‰²ï¼Œä½†åœ¨æ›´å¤æ‚çš„æƒ…å†µä¸‹ï¼Œè¿™ç§æ–¹æ³•å°±ä¼šå¼€å§‹å‡ºç°é—®é¢˜ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="Wooji Juice" scheme="https://swift.gg/categories/Wooji-Juice/"/>
    
    
      <category term="Swift" scheme="https://swift.gg/tags/Swift/"/>
    
      <category term="æ•™ç¨‹" scheme="https://swift.gg/tags/%E6%95%99%E7%A8%8B/"/>
    
  </entry>
  
  <entry>
    <title>Swift ç±»å‹æ“¦é™¤</title>
    <link href="https://swift.gg/2018/10/11/friday-qa-2017-12-08-type-erasure-in-swift/"/>
    <id>https://swift.gg/2018/10/11/friday-qa-2017-12-08-type-erasure-in-swift/</id>
    <published>2018-10-11T00:00:00.000Z</published>
    <updated>2019-02-18T08:52:03.568Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ä½œè€…ï¼š<a href="https://www.mikeash.com" target="_blank" rel="noopener">Mike Ash</a>ï¼Œ<a href="https://www.mikeash.com/pyblog/friday-qa-2017-12-08-type-erasure-in-swift.html" target="_blank" rel="noopener">åŸæ–‡é“¾æ¥</a>ï¼ŒåŸæ–‡æ—¥æœŸï¼š2017-12-18<br>è¯‘è€…ï¼š<a href="https://github.com/rsenjoyer" target="_blank" rel="noopener">rsenjoyer</a>ï¼›æ ¡å¯¹ï¼š<a href="http://blog.yousanflics.com.cn" target="_blank" rel="noopener">Yousanflics</a>ï¼Œ<a href="http://numbbbbb.com/" target="_blank" rel="noopener">numbbbbb</a>ï¼›å®šç¨¿ï¼š<a href="http://forelax.space" target="_blank" rel="noopener">Forelax</a></p></blockquote><!--æ­¤å¤„å¼€å§‹æ­£æ–‡--><p>ä½ ä¹Ÿè®¸æ›¾å¬è¿‡<strong>ç±»å‹æ“¦é™¤</strong>ï¼Œç”šè‡³ä¹Ÿä½¿ç”¨è¿‡æ ‡å‡†åº“æä¾›çš„ç±»å‹æ“¦é™¤ç±»å‹å¦‚ <code>AnySequence</code>ã€‚ä½†åˆ°åº•ä»€ä¹ˆæ˜¯ç±»å‹æ“¦é™¤? å¦‚ä½•è‡ªå®šä¹‰ç±»å‹æ“¦é™¤? åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å°†è®¨è®ºå¦‚ä½•ä½¿ç”¨ç±»å‹æ“¦é™¤ä»¥åŠå¦‚ä½•è‡ªå®šä¹‰ã€‚åœ¨æ­¤æ„Ÿè°¢ Lorenzo Boaro æå‡ºè¿™ä¸ªä¸»é¢˜ã€‚</p><a id="more"></a><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æœ‰æ—¶ä½ æƒ³å¯¹å¤–éƒ¨è°ƒç”¨è€…éšè—æŸä¸ªç±»çš„å…·ä½“ç±»å‹ï¼Œæˆ–æ˜¯ä¸€äº›å®ç°ç»†èŠ‚ã€‚åœ¨ä¸€äº›æƒ…å†µä¸‹ï¼Œè¿™æ ·åšèƒ½é˜²æ­¢é™æ€ç±»å‹åœ¨é¡¹ç›®ä¸­æ»¥ç”¨ï¼Œæˆ–è€…ä¿è¯äº†ç±»å‹é—´çš„äº¤äº’ã€‚ç±»å‹æ“¦é™¤å°±æ˜¯ç§»é™¤æŸä¸ªç±»çš„å…·ä½“ç±»å‹ä½¿å…¶å˜å¾—æ›´é€šç”¨çš„è¿‡ç¨‹ã€‚</p><p>åè®®æˆ–æŠ½è±¡çˆ¶ç±»å¯ä½œä¸ºç±»å‹æ“¦é™¤ç®€å•çš„å®ç°æ–¹å¼ä¹‹ä¸€ã€‚ä¾‹å¦‚ <code>NSString</code> å°±æ˜¯ä¸€ä¸ªä¾‹å­ï¼Œæ¯æ¬¡åˆ›å»ºä¸€ä¸ª <code>NSString</code> å®ä¾‹æ—¶ï¼Œè¿™ä¸ªå¯¹è±¡å¹¶ä¸æ˜¯ä¸€ä¸ªæ™®é€šçš„ <code>NSString</code> å¯¹è±¡ï¼Œå®ƒé€šå¸¸æ˜¯æŸä¸ªå…·ä½“çš„å­ç±»çš„å®ä¾‹ï¼Œè¿™ä¸ªå­ç±»ä¸€èˆ¬æ˜¯ç§æœ‰çš„ï¼ŒåŒæ—¶è¿™äº›ç»†èŠ‚é€šå¸¸æ˜¯è¢«éšè—èµ·æ¥çš„ã€‚ä½ å¯ä»¥ä½¿ç”¨å­ç±»æä¾›çš„åŠŸèƒ½è€Œä¸ç”¨çŸ¥é“å®ƒå…·ä½“çš„ç±»å‹ï¼Œä½ ä¹Ÿæ²¡å¿…è¦å°†ä½ çš„ä»£ç ä¸å®ƒä»¬çš„å…·ä½“ç±»å‹è”ç³»èµ·æ¥ã€‚</p><p>åœ¨å¤„ç† Swift æ³›å‹ä»¥åŠå…³è”ç±»å‹åè®®çš„æ—¶å€™ï¼Œå¯èƒ½éœ€è¦ä½¿ç”¨ä¸€äº›é«˜çº§çš„å†…å®¹ã€‚Swift ä¸å…è®¸æŠŠåè®®å½“åšå…·ä½“çš„ç±»å‹æ¥ä½¿ç”¨ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ æƒ³ç¼–å†™ä¸€ä¸ªæ–¹æ³•ï¼Œå®ƒçš„å‚æ•°æ˜¯ä¸€ä¸ªåŒ…å«äº† <code>Int</code> çš„åºåˆ—ï¼Œé‚£ä¹ˆä¸‹é¢è¿™ç§åšæ³•æ˜¯ä¸æ­£ç¡®çš„ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">f</span><span class="params">(seq: Sequence&lt;Int&gt;)</span></span> &#123; ...</span><br></pre></td></tr></table></figure><p>ä½ ä¸èƒ½è¿™æ ·ä½¿ç”¨åè®®ç±»å‹ï¼Œè¿™æ ·ä¼šåœ¨ç¼–è¯‘æ—¶æŠ¥é”™ã€‚ä½†ä½ å¯ä»¥ä½¿ç”¨æ³›å‹æ¥æ›¿ä»£åè®®ï¼Œè§£å†³è¿™ä¸ªé—®é¢˜ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">f</span>&lt;S: Sequence&gt;<span class="params">(seq: S)</span></span> <span class="keyword">where</span> <span class="type">S</span>.<span class="type">Element</span> == <span class="type">Int</span> &#123; ...</span><br></pre></td></tr></table></figure><p>æœ‰æ—¶å€™è¿™æ ·å†™å®Œå…¨å¯ä»¥ï¼Œä½†æœ‰äº›åœ°æ–¹è¿˜å­˜åœ¨ä¸€äº›æ¯”è¾ƒéº»çƒ¦çš„æƒ…å†µï¼Œé€šå¸¸ä½ ä¸å¯èƒ½åªåœ¨ä¸€ä¸ªåœ°æ–¹æ·»åŠ æ³›å‹: ä¸€ä¸ªæ³›å‹å‡½æ•°å¯¹å…¶ä»–æ³›å‹è¦æ±‚æ›´å¤šâ€¦ æ›´ç³Ÿç³•çš„æ˜¯ï¼Œä½ ä¸èƒ½å°†æ³›å‹ä½œä¸ºè¿”å›å€¼æˆ–è€…å±æ€§ã€‚è¿™å°±è·Ÿæˆ‘ä»¬æƒ³çš„æœ‰ç‚¹ä¸ä¸€æ ·äº†ã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">g</span>&lt;S: Sequence&gt;<span class="params">()</span></span> -&gt; <span class="type">S</span> <span class="keyword">where</span> <span class="type">S</span>.<span class="type">Element</span> == <span class="type">Int</span> &#123; ...</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¸Œæœ›å‡½æ•° <code>g</code> èƒ½è¿”å›ä»»ä½•ç¬¦åˆçš„ç±»å‹ï¼Œä½†ä¸Šé¢è¿™ä¸ªä¸åŒï¼Œå®ƒå…è®¸è°ƒç”¨è€…é€‰æ‹©ä»–æ‰€éœ€è¦çš„ç±»å‹ï¼Œç„¶åå‡½æ•° <code>g</code> æ¥æä¾›ä¸€ä¸ªåˆé€‚çš„å€¼ã€‚</p><p>Swift æ ‡å‡†åº“ä¸­æä¾›äº† <code>AnySequence</code> æ¥å¸®åŠ©æˆ‘ä»¬è§£å†³è¿™ä¸ªé—®é¢˜ã€‚<code>AnySequence</code> åŒ…è£…äº†ä¸€ä¸ªä»»æ„ç±»å‹çš„åºåˆ—ï¼Œå¹¶æ“¦é™¤äº†å®ƒçš„ç±»å‹ã€‚ä½¿ç”¨ <code>AnySequence</code> æ¥è®¿é—®è¿™ä¸ªåºåˆ—ï¼Œæˆ‘ä»¬æ¥é‡å†™ä¸€ä¸‹å‡½æ•° <code>f</code> ä¸ å‡½æ•° <code>g</code>ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">f</span><span class="params">(seq: AnySequence&lt;Int&gt;)</span></span> &#123; ...</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">g</span><span class="params">()</span></span> -&gt; <span class="type">AnySequence</span>&lt;<span class="type">Int</span>&gt; &#123; ...</span><br></pre></td></tr></table></figure><p>æ³›å‹éƒ¨åˆ†ä¸è§äº†ï¼ŒåŒæ—¶å…·ä½“çš„ç±»å‹ä¹Ÿè¢«éšè—èµ·æ¥äº†ã€‚ç”±äºä½¿ç”¨äº† <code>AnySequence</code> åŒ…è£…å…·ä½“çš„å€¼ï¼Œå®ƒå¸¦æ¥äº†ä¸€å®šçš„ä»£ç å¤æ‚æ€§ä»¥åŠè¿è¡Œæ—¶é—´æˆæœ¬ã€‚ä½†æ˜¯ä»£ç å´æ›´ç®€æ´äº†ã€‚</p><p>Swift æ ‡å‡†åº“ä¸­æä¾›äº†å¾ˆå¤šè¿™æ ·çš„ç±»å‹ï¼Œå¦‚ <code>AnyCollection</code>ã€<code>AnyHashable</code> åŠ <code>AnyIndex</code>ã€‚è¿™äº›ç±»å‹åœ¨ä½ è‡ªå®šä¹‰æ³›å‹æˆ–åè®®çš„æ—¶å€™éå¸¸çš„ç®¡ç”¨ï¼Œä½ ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨è¿™äº›ç±»å‹æ¥ç®€åŒ–ä½ çš„ä»£ç ã€‚æ¥ä¸‹æ¥è®©æˆ‘ä»¬æ¢ç´¢å®ç°ç±»å‹æ“¦é™¤çš„å¤šç§æ–¹å¼å§ã€‚</p><h2 id="åŸºäºç±»çš„ç±»å‹æ“¦é™¤"><a href="#åŸºäºç±»çš„ç±»å‹æ“¦é™¤" class="headerlink" title="åŸºäºç±»çš„ç±»å‹æ“¦é™¤"></a>åŸºäºç±»çš„ç±»å‹æ“¦é™¤</h2><p>æœ‰æ—¶æˆ‘ä»¬éœ€è¦åœ¨ä¸æš´éœ²ç±»å‹ä¿¡æ¯çš„æƒ…å†µä¸‹ä»å¤šä¸ªç±»å‹ä¸­åŒ…è£…ä¸€äº›å…¬å…±çš„åŠŸèƒ½ï¼Œè¿™å¬èµ·æ¥å°±åƒæ˜¯çˆ¶ç±»-å­ç±»çš„å…³ç³»ã€‚äº‹å®ä¸Šæˆ‘ä»¬çš„ç¡®å¯ä»¥ä½¿ç”¨æŠ½è±¡çˆ¶ç±»æ¥å®ç°ç±»å‹æ“¦é™¤ã€‚çˆ¶ç±»æä¾› API æ¥å£ï¼Œä¸ç”¨å»ç®¡è°æ¥å®ç°ã€‚è€Œå­ç±»æ ¹æ®å…·ä½“çš„ç±»å‹ä¿¡æ¯å®ç°ç›¸åº”çš„åŠŸèƒ½ã€‚</p><p>æ¥ä¸‹æ¥æˆ‘ä»¬å°†ä½¿ç”¨è¿™ç§æ–¹å¼æ¥è‡ªå®šä¹‰ <code>AnySequence</code>ï¼Œæˆ‘ä»¬å°†å…¶å‘½åä¸º <code>MAnySequence</code>ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MAnySequence</span>&lt;<span class="title">Element</span>&gt;: <span class="title">Sequence</span> </span>&#123;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªç±»éœ€è¦ä¸€ä¸ª <code>iterator</code> ç±»å‹ä½œä¸º <code>makeIterator</code> è¿”å›ç±»å‹ã€‚æˆ‘ä»¬å¿…é¡»è¦åšä¸¤æ¬¡ç±»å‹æ“¦é™¤æ¥éšè—åº•å±‚çš„åºåˆ—ç±»å‹ä»¥åŠè¿­ä»£å™¨çš„ç±»å‹ã€‚æˆ‘ä»¬åœ¨ <code>MAnySequence</code> å†…éƒ¨å®šä¹‰äº†ä¸€ä¸ª <code>Iterator</code> ç±»ï¼Œè¯¥ç±»éµå¾ªç€ <code>IteratorProtocol</code> åè®®ï¼Œå¹¶åœ¨  <code>next()</code> æ–¹æ³•ä¸­ä½¿ç”¨ <code>fatalError</code> æŠ›å‡ºå¼‚å¸¸ã€‚Swift æœ¬èº«ä¸æ”¯æŒæŠ½è±¡ç±»å‹ï¼Œä½†è¿™æ ·ä¹Ÿå¤Ÿäº†:</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Iterator</span>: <span class="title">IteratorProtocol</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">next</span><span class="params">()</span></span> -&gt; <span class="type">Element</span>? &#123;</span><br><span class="line">        <span class="built_in">fatalError</span>(<span class="string">"Must override next()"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>MAnySequence</code> å¯¹ <code>makeIterator</code> æ–¹æ³•å®ç°ä¹Ÿå·®ä¸å¤šã€‚ç›´æ¥è°ƒç”¨å°†æŠ›å‡ºå¼‚å¸¸ï¼Œè¿™ç”¨æ¥æç¤ºå­ç±»éœ€è¦é‡å†™è¿™ä¸ªæ–¹æ³•:</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">makeIterator</span><span class="params">()</span></span> -&gt; <span class="type">Iterator</span> &#123;</span><br><span class="line">        <span class="built_in">fatalError</span>(<span class="string">"Must override makeIterator()"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·å°±å®šä¹‰äº†ä¸€ä¸ªåŸºäºç±»çš„ç±»å‹æ“¦é™¤çš„APIï¼Œç§æœ‰çš„å­ç±»å°†æ¥å®ç°è¿™äº›APIã€‚å…¬å…±ç±»é€šè¿‡å…ƒç´ ç±»å‹å‚æ•°åŒ–ï¼Œä½†ç§æœ‰å®ç°ç±»ç”±å®ƒåŒ…è£…çš„åºåˆ—ç±»å‹è¿›è¡Œå‚æ•°åŒ–:</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">MAnySequenceImpl</span>&lt;<span class="title">Seq</span>: <span class="title">Sequence</span>&gt;: <span class="title">MAnySequence</span>&lt;<span class="title">Seq</span>.<span class="title">Element</span>&gt; </span>&#123;</span><br></pre></td></tr></table></figure><p><code>MAnySequenceImpl</code> éœ€è¦ä¸€ä¸ªç»§æ‰¿äº <code>Iterator</code> çš„å­ç±»:</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">IteratorImpl</span>: <span class="title">Iterator</span> </span>&#123;</span><br></pre></td></tr></table></figure><p><code>IteratorImpl</code> åŒ…è£…äº†åºåˆ—çš„è¿­ä»£å™¨:</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> wrapped: <span class="type">Seq</span>.<span class="type">Iterator</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">init</span>(<span class="number">_</span> wrapped: <span class="type">Seq</span>.<span class="type">Iterator</span>) &#123;</span><br><span class="line">    <span class="keyword">self</span>.wrapped = wrapped</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ <code>next</code> æ–¹æ³•ä¸­è°ƒç”¨è¢«åŒ…è£…çš„åºåˆ—è¿­ä»£å™¨ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">next</span><span class="params">()</span></span> -&gt; <span class="type">Seq</span>.<span class="type">Element</span>? &#123;</span><br><span class="line">        <span class="keyword">return</span> wrapped.next()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç›¸ä¼¼åœ°ï¼Œ<code>MAnySequenceImpl</code> åŒ…è£…ä¸€ä¸ªåºåˆ—ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> seq: <span class="type">Seq</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">init</span>(<span class="number">_</span> seq: <span class="type">Seq</span>) &#123;</span><br><span class="line">    <span class="keyword">self</span>.seq = seq</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»åºåˆ—ä¸­è·å–è¿­ä»£å™¨ï¼Œç„¶åå°†è¿­ä»£å™¨åŒ…è£…æˆ <code>IteratorImpl</code> å¯¹è±¡è¿”å›ï¼Œè¿™æ ·å°±å®ç°äº† <code>makeIterator</code> çš„åŠŸèƒ½ã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">makeIterator</span><span class="params">()</span></span> -&gt; <span class="type">IteratorImpl</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="type">IteratorImpl</span>(seq.makeIterator())</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬éœ€è¦ä¸€ç§æ–¹æ³•æ¥å®é™…åˆ›å»ºè¿™äº›ä¸œè¥¿ï¼šå¯¹ <code>MAnySequence</code> æ·»åŠ ä¸€ä¸ªé™æ€æ–¹æ³•ï¼Œè¯¥æ–¹æ³•åˆ›å»ºä¸€ä¸ª <code>MAnySequenceImpl</code> å®ä¾‹ï¼Œå¹¶å°†å…¶ä½œä¸º <code>MAnySequence</code> ç±»å‹è¿”å›ç»™è°ƒç”¨è€…ã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">MAnySequence</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">make</span>&lt;Seq: Sequence&gt;<span class="params">(<span class="number">_</span> seq: Seq)</span></span> -&gt; <span class="type">MAnySequence</span>&lt;<span class="type">Element</span>&gt; <span class="keyword">where</span> <span class="type">Seq</span>.<span class="type">Element</span> == <span class="type">Element</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="type">MAnySequenceImpl</span>&lt;<span class="type">Seq</span>&gt;(seq)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨å®é™…å¼€å‘ä¸­ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šåšä¸€äº›é¢å¤–çš„æ“ä½œæ¥è®© <code>MAnySequence</code> æä¾›ä¸€ä¸ªåˆå§‹åŒ–æ–¹æ³•ã€‚</p><p>æˆ‘ä»¬æ¥è¯•è¯• <code>MAnySequence</code>ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">printInts</span><span class="params">(<span class="number">_</span> seq: MAnySequence&lt;Int&gt;)</span></span> &#123;</span><br><span class="line">    <span class="keyword">for</span> elt <span class="keyword">in</span> seq &#123;</span><br><span class="line">        <span class="built_in">print</span>(elt)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> array = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]</span><br><span class="line">printInts(<span class="type">MAnySequence</span>.make(array))</span><br><span class="line">printInts(<span class="type">MAnySequence</span>.make(array[<span class="number">1</span> ..&lt; <span class="number">4</span>]))</span><br></pre></td></tr></table></figure><p>å®Œç¾!</p><h2 id="åŸºäºå‡½æ•°çš„ç±»å‹æ“¦é™¤"><a href="#åŸºäºå‡½æ•°çš„ç±»å‹æ“¦é™¤" class="headerlink" title="åŸºäºå‡½æ•°çš„ç±»å‹æ“¦é™¤"></a>åŸºäºå‡½æ•°çš„ç±»å‹æ“¦é™¤</h2><p>æœ‰æ—¶æˆ‘ä»¬å¸Œæœ›å¯¹å¤–æš´éœ²æ”¯æŒå¤šç§ç±»å‹çš„æ–¹æ³•ï¼Œä½†åˆä¸æƒ³æŒ‡å®šå…·ä½“çš„ç±»å‹ã€‚ä¸€ä¸ªç®€å•çš„åŠæ³•å°±æ˜¯ï¼Œå­˜å‚¨é‚£äº›ç­¾åä»…æ¶‰åŠåˆ°æˆ‘ä»¬æƒ³å…¬å¼€çš„ç±»å‹çš„å‡½æ•°ï¼Œå‡½æ•°ä¸»ä½“åœ¨åº•å±‚å·²çŸ¥å…·ä½“å®ç°ç±»å‹çš„ä¸Šä¸‹æ–‡ä¸­åˆ›å»ºã€‚</p><p>æˆ‘ä»¬ä¸€èµ·çœ‹çœ‹å¦‚ä½•è¿ç”¨è¿™ç§æ–¹æ³•æ¥è®¾è®¡ <code>MAnySequence</code>ï¼Œä¸å‰é¢çš„å®ç°å¾ˆç±»ä¼¼ã€‚å®ƒæ˜¯ä¸€ä¸ªç»“æ„ä½“è€Œéç±»ï¼Œè¿™æ˜¯å› ä¸ºå®ƒä»…ä»…ä½œä¸ºå®¹å™¨ä½¿ç”¨ï¼Œä¸éœ€è¦æœ‰ä»»ä½•çš„ç»§æ‰¿å…³ç³»ã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">MAnySequence</span>&lt;<span class="title">Element</span>&gt;: <span class="title">Sequence</span> </span>&#123;</span><br></pre></td></tr></table></figure><p>è·Ÿä¹‹å‰ä¸€æ ·ï¼Œ<code>MAnySequence</code> ä¹Ÿéœ€è¦ä¸€ä¸ªå¯è¿”å›çš„è¿­ä»£å™¨ï¼ˆIteratorï¼‰ã€‚è¿­ä»£å™¨åŒæ ·è¢«è®¾è®¡ä¸ºç»“æ„ä½“ï¼Œå¹¶æŒæœ‰ä¸€ä¸ªå‚æ•°ä¸ºç©ºå¹¶è¿”å› <code>Element?</code> çš„å­˜å‚¨å‹å±æ€§ï¼Œå®é™…ä¸Šè¿™ä¸ªå±æ€§æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œè¢«ç”¨äº <code>IteratorProtocol</code> åè®®çš„ <code>next</code> æ–¹æ³•ä¸­ã€‚æ¥ä¸‹æ¥ <code>Iterator</code> éµå¾ª <code>IteratorProtocol</code> åè®®ï¼Œå¹¶åœ¨ <code>next</code> æ–¹æ³•ä¸­è°ƒç”¨å‡½æ•°:</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Iterator</span>: <span class="title">IteratorProtocol</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> _next: () -&gt; <span class="type">Element</span>?</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">next</span><span class="params">()</span></span> -&gt; <span class="type">Element</span>? &#123;</span><br><span class="line">        <span class="keyword">return</span> _next()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>MAnySequence</code> ä¸ <code>Iterator</code> å¾ˆç›¸ä¼¼ï¼šæŒæœ‰ä¸€ä¸ªå‚æ•°ä¸ºç©ºè¿”å› <code>Iterator</code> ç±»å‹çš„å­˜å‚¨å‹å±æ€§ã€‚éµå¾ª <code>Sequence</code> åè®®å¹¶åœ¨ <code>makeIterator</code> æ–¹æ³•ä¸­è°ƒç”¨è¿™ä¸ªå±æ€§ã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> _makeIterator: () -&gt; <span class="type">Iterator</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">makeIterator</span><span class="params">()</span></span> -&gt; <span class="type">Iterator</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> _makeIterator()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>MAnySequence</code> çš„æ„é€ å‡½æ•°æ­£æ˜¯é­”æ³•èµ·ä½œç”¨çš„åœ°æ–¹ï¼Œå®ƒæ¥æ”¶ä»»æ„åºåˆ—ä½œä¸ºå‚æ•°: </p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">init</span>&lt;<span class="type">Seq</span>: <span class="type">Sequence</span>&gt;(<span class="number">_</span> seq: <span class="type">Seq</span>) <span class="keyword">where</span> <span class="type">Seq</span>.<span class="type">Element</span> == <span class="type">Element</span> &#123;</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥éœ€è¦åœ¨æ„é€ å‡½æ•°ä¸­åŒ…è£…æ­¤åºåˆ—çš„åŠŸèƒ½:</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">_makeIterator = &#123;</span><br></pre></td></tr></table></figure><p>å¦‚ä½•ç”Ÿæˆè¿­ä»£å™¨ï¼Ÿè¯·æ±‚ <code>Seq</code> åºåˆ—ç”Ÿæˆï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> iterator = seq.makeIterator()</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥æˆ‘ä»¬åˆ©ç”¨è‡ªå®šä¹‰çš„è¿­ä»£ç»“æ„ä½“åŒ…è£…åºåˆ—ç”Ÿæˆçš„è¿­ä»£å™¨ï¼ŒåŒ…è£…åçš„ <code>_next</code> å±æ€§å°†ä¼šåœ¨è¿­ä»£å™¨åè®®çš„ <code>next()</code> æ–¹æ³•ä¸­è¢«è°ƒç”¨:</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">            <span class="keyword">return</span> <span class="type">Iterator</span>(_next: &#123; iterator.next() &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥å±•ç¤ºå¦‚ä½•ä½¿ç”¨ <code>MAnySequence</code>ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">printInts</span><span class="params">(<span class="number">_</span> seq: MAnySequence&lt;Int&gt;)</span></span> &#123;</span><br><span class="line">    <span class="keyword">for</span> elt <span class="keyword">in</span> seq &#123;</span><br><span class="line">        <span class="built_in">print</span>(elt)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> array = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]</span><br><span class="line">printInts(<span class="type">MAnySequence</span>(array))</span><br><span class="line">printInts(<span class="type">MAnySequence</span>(array[<span class="number">1</span> ..&lt; <span class="number">4</span>]))</span><br></pre></td></tr></table></figure><p>æ­£ç¡®è¿è¡Œï¼Œå¤ªæ£’äº†ï¼</p><p>å½“éœ€è¦å°†å°éƒ¨åˆ†åŠŸèƒ½åŒ…è£…ä¸ºæ›´å¤§ç±»å‹çš„ä¸€éƒ¨åˆ†æ—¶ï¼Œè¿™ç§åŸºäºå‡½æ•°çš„ç±»å‹æ“¦é™¤æ–¹æ³•ç‰¹åˆ«å®ç”¨ï¼Œè¿™æ ·åšå°±ä¸éœ€è¦æœ‰å•ç‹¬çš„ç±»æ¥å®ç°è¢«æ“¦é™¤ç±»å‹çš„è¿™éƒ¨åˆ†åŠŸèƒ½äº†ã€‚</p><p>æ¯”æ–¹è¯´ä½ ç°åœ¨æƒ³è¦ç¼–å†™ä¸€äº›é€‚ç”¨äºå„ç§é›†åˆç±»å‹çš„ä»£ç ï¼Œä½†å®ƒçœŸæ­£éœ€è¦èƒ½å¤Ÿå¯¹è¿™äº›é›†åˆæ‰§è¡Œçš„æ“ä½œæ˜¯è·å–è®¡æ•°å¹¶æ‰§è¡Œä»é›¶å¼€å§‹çš„æ•´æ•°ä¸‹æ ‡ã€‚å¦‚è®¿é—® <code>tableView</code> æ•°æ®æºã€‚å®ƒå¯èƒ½çœ‹èµ·æ¥åƒè¿™æ ·ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">GenericDataSource</span>&lt;<span class="title">Element</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="built_in">count</span>: () -&gt; <span class="type">Int</span></span><br><span class="line">    <span class="keyword">let</span> getElement: (<span class="type">Int</span>) -&gt; <span class="type">Element</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">init</span>&lt;<span class="type">C</span>: <span class="type">Collection</span>&gt;(<span class="number">_</span> <span class="built_in">c</span>: <span class="type">C</span>) <span class="keyword">where</span> <span class="type">C</span>.<span class="type">Element</span> == <span class="type">Element</span>ï¼Œ<span class="type">C</span>.<span class="type">Index</span> == <span class="type">Int</span> &#123;</span><br><span class="line">        <span class="built_in">count</span> = &#123; <span class="built_in">c</span>.<span class="built_in">count</span> &#125;</span><br><span class="line">        getElement = &#123; <span class="built_in">c</span>[$<span class="number">0</span> - <span class="built_in">c</span>.startIndex] &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>GenericDataSource</code> å…¶ä»–ä»£ç å¯é€šè¿‡è°ƒç”¨ <code>count()</code> æˆ– <code>getElement()</code> æ¥æ“ä½œä¼ å…¥çš„é›†åˆã€‚ä¸”ä¸ä¼šè®©é›†åˆç±»å‹ç ´å <code>GenericDataSource</code> æ³›å‹å‚æ•°ã€‚</p><h2 id="ç»“æŸè¯­"><a href="#ç»“æŸè¯­" class="headerlink" title="ç»“æŸè¯­"></a>ç»“æŸè¯­</h2><p>ç±»å‹æ“¦é™¤æ˜¯ä¸€ç§éå¸¸æœ‰ç”¨çš„æŠ€æœ¯ï¼Œå®ƒå¯ç”¨æ¥é˜»æ­¢æ³›å‹å¯¹ä»£ç çš„ä¾µå…¥ï¼Œä¹Ÿå¯ç”¨æ¥ä¿è¯æ¥å£ç®€å•æ˜äº†ã€‚é€šè¿‡å°†åº•å±‚ç±»å‹åŒ…è£…èµ·æ¥ï¼Œå°†APIä¸å…·ä½“çš„åŠŸèƒ½è¿›è¡Œæ‹†åˆ†ã€‚è¿™å¯ä»¥é€šè¿‡ä½¿ç”¨æŠ½è±¡çš„å…¬å…±è¶…ç±»å’Œç§æœ‰å­ç±»æˆ–å°† API åŒ…è£…åœ¨å‡½æ•°ä¸­æ¥å®ç°ã€‚å¯¹äºåªéœ€è¦ä¸€äº›åŠŸèƒ½çš„ç®€å•æƒ…å†µï¼ŒåŸºäºå‡½æ•°ç±»å‹æ“¦é™¤æå…¶æœ‰æ•ˆã€‚</p><p>Swift æ ‡å‡†åº“æä¾›äº†å‡ ç§å¯ç›´æ¥åˆ©ç”¨çš„ç±»å‹æ“¦é™¤ç±»å‹ã€‚å¦‚ <code>AnySequence</code> åŒ…è£…ä¸€ä¸ª <code>Sequence</code>ï¼Œæ­£å¦‚å…¶åï¼Œ<code>AnySequence</code> å…è®¸ä½ å¯¹åºåˆ—è¿­ä»£è€Œæ— éœ€çŸ¥é“åºåˆ—å…·ä½“çš„ç±»å‹ã€‚<code>AnyIterator</code> ä¹Ÿæ˜¯ç±»å‹æ“¦é™¤çš„ç±»å‹ï¼Œå®ƒæä¾›ä¸€ä¸ªç±»å‹æ“¦é™¤çš„è¿­ä»£å™¨ã€‚<code>AnyHashable</code> ä¹ŸåŒæ ·æ˜¯ç±»å‹æ“¦é™¤çš„ç±»å‹ï¼Œå®ƒæä¾›äº†å¯¹Hashableç±»å‹è®¿é—®åŠŸèƒ½ã€‚Swift è¿˜æœ‰å¾ˆå¤šåŸºäºé›†åˆçš„æ“¦é™¤ç±»å‹ï¼Œä½ å¯ä»¥é€šè¿‡æœç´¢ <code>Any</code> æ¥æŸ¥é˜…ã€‚æ ‡å‡†åº“ä¸­ä¹Ÿä¸º <code>Codable</code> API è®¾è®¡äº†ç±»å‹æ“¦é™¤ç±»å‹: <code>KeyedEncodingContainer</code> å’Œ <code>KeyedDecodingContainer</code>ã€‚å®ƒä»¬éƒ½æ˜¯å®¹å™¨åè®®ç±»å‹åŒ…è£…å™¨ï¼Œå¯ç”¨æ¥åœ¨ä¸çŸ¥é“åº•å±‚å…·ä½“ç±»å‹ä¿¡æ¯çš„æƒ…å†µä¸‹å®ç° <code>Encode</code> å’Œ <code>Decode</code>ã€‚</p><p>è¿™å°±æ˜¯ä»Šå¤©å…¨éƒ¨çš„å†…å®¹äº†ï¼Œä¸‹æ¬¡å†è§ã€‚ä½ ä»¬çš„å»ºè®®å¯¹ Friday Q&amp;A æ˜¯æœ€å¥½çš„é¼“åŠ±ï¼Œæ‰€ä»¥å¦‚æœä½ å…³äºè¿™ä¸ªä¸»é¢˜æœ‰ä»€ä¹ˆå¥½çš„æƒ³æ³•ï¼Œè¯· <a href="mailto:mike@mikeash.com" target="_blank" rel="noopener">å‘é‚®ä»¶åˆ°è¿™é‡Œ</a>ã€‚</p><blockquote><p>æœ¬æ–‡ç”± SwiftGG ç¿»è¯‘ç»„ç¿»è¯‘ï¼Œå·²ç»è·å¾—ä½œè€…ç¿»è¯‘æˆæƒï¼Œæœ€æ–°æ–‡ç« è¯·è®¿é—® <a href="http://swift.gg">http://swift.gg</a>ã€‚</p></blockquote>]]></content>
    
    <summary type="html">
    
      è¯¦ç»†è¯´æ˜ Swift ç±»å‹æ“¦é™¤
    
    </summary>
    
      <category term="iOS" scheme="https://swift.gg/categories/iOS/"/>
    
      <category term="iOS å¼€å‘" scheme="https://swift.gg/categories/iOS/iOS-%E5%BC%80%E5%8F%91/"/>
    
    
      <category term="Swift" scheme="https://swift.gg/tags/Swift/"/>
    
      <category term="æ•™ç¨‹" scheme="https://swift.gg/tags/%E6%95%99%E7%A8%8B/"/>
    
  </entry>
  
  <entry>
    <title>Tagged Pointer å­—ç¬¦ä¸²</title>
    <link href="https://swift.gg/2018/10/08/tagged-pointer-strings/"/>
    <id>https://swift.gg/2018/10/08/tagged-pointer-strings/</id>
    <published>2018-10-08T00:00:00.000Z</published>
    <updated>2019-02-18T08:52:03.568Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ä½œè€…ï¼šMike Ashï¼Œ<a href="https://www.mikeash.com/pyblog/friday-qa-2015-07-31-tagged-pointer-strings.html" target="_blank" rel="noopener">åŸæ–‡é“¾æ¥</a>ï¼ŒåŸæ–‡æ—¥æœŸï¼š2015-07-31<br>è¯‘è€…ï¼š<a href="https://dingtz.com/" target="_blank" rel="noopener">jojotov</a>ï¼›æ ¡å¯¹ï¼š<a href="http://forelax.space" target="_blank" rel="noopener">Forelax</a>ï¼Œ<a href="http://www.desgard.com/" target="_blank" rel="noopener">å†¬ç“œ</a>ï¼›å®šç¨¿ï¼š<a href="http://forelax.space" target="_blank" rel="noopener">Forelax</a></p></blockquote><!--æ­¤å¤„å¼€å§‹æ­£æ–‡--><p>Tagged pointer æ˜¯ä¸€é¡¹ç”¨äºæé«˜æ€§èƒ½å¹¶å‡å°‘å†…å­˜ä½¿ç”¨çš„æœ‰è¶£æŠ€æœ¯ã€‚åœ¨ OS X 10.10 ä¸­ï¼Œ<code>NSString</code> ä¹Ÿå¼€å§‹ä½¿ç”¨äº† tagged pointer æŠ€æœ¯ï¼Œä»Šå¤©æˆ‘ä¼šåœ¨ Ken Ferry çš„æè®®ä¸‹ï¼Œçª¥æ¢å…¶å·¥ä½œåŸç†ã€‚</p><a id="more"></a><h2 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><p>å¯¹è±¡å­˜å‚¨åœ¨å†…å­˜ä¸­çš„æ—¶å€™æ˜¯å†…å­˜å¯¹é½çš„ï¼Œå› æ­¤ä»–ä»¬çš„åœ°å€æ€»æ˜¯å•ä¸ªæŒ‡é’ˆå¤§å°çš„å€æ•°ï¼Œåœ¨å®é™…ä¸­é€šå¸¸æ˜¯ 16 çš„å€æ•°ã€‚å¯¹è±¡çš„æŒ‡é’ˆé€šå¸¸æ˜¯ä»¥ä¸€ä¸ªå®Œæ•´çš„ 64 ä½æ•´å‹çš„ç»“æ„è¿›è¡Œå­˜å‚¨ï¼Œä¸è¿‡ç”±äºå†…å­˜å¯¹é½çš„ï¼ŒæŒ‡é’ˆä¸­ä¸€äº›ä½æ€»ä¼šä¸ºé›¶ã€‚</p><p>Tagged pointer æŠ€æœ¯å—ç›Šäºæ­¤ï¼Œé€šè¿‡è®©è¿™äº›ä½ä¸å†ä¸º 0ï¼Œèµ‹äºˆäº†å¯¹è±¡æŒ‡é’ˆä¸€äº›ç‰¹æ®Šæ„ä¹‰ã€‚åœ¨è‹¹æœçš„ 64 ä½ Objective-C å®ç°å½“ä¸­ï¼Œå¯¹è±¡æŒ‡é’ˆçš„æœ€ä½æœ‰æ•ˆä½è®¾ç½®ä¸º 1 çš„æ—¶å€™ (ä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒæ˜¯ä¸€ä¸ªå¥‡æ•°) ï¼Œæ­¤æŒ‡é’ˆè¢«è®¤ä¸ºæ˜¯ tagged pointerã€‚æ­¤æ—¶ï¼Œæœ€ä½æœ‰æ•ˆä½å‰é¢çš„ 3 ä½ä¸å†è¢«å½“ä½œ isa æŒ‡é’ˆçš„åœ°å€ï¼Œè€Œæ˜¯ç”¨äºè¡¨ç¤ºä¸€ä¸ªç‰¹æ®Šçš„ tagged class è¡¨çš„ç´¢å¼•å€¼ã€‚è¿™ä¸ªç´¢å¼•å€¼å¯ä»¥ç”¨æ¥æŸ¥æ‰¾ tagged pointer æ‰€å¯¹åº”çš„ç±»ã€‚å‰©ä½™çš„ 60 ä½åˆ™ä¼šè¢«ç›´æ¥ä½¿ç”¨ã€‚</p><p>æ¥çœ‹ä¸€ä¸ªå¯¹ä¸Šè¿°ç†è®ºçš„ç®€å•åº”ç”¨ï¼šå½“æˆ‘ä»¬åˆ›å»ºä¸€ä¸ª <code>NSNumber</code> å¯¹è±¡æ—¶ï¼Œå¦‚æœå®ƒé€‚åˆäº tagged pointer æŠ€æœ¯ï¼Œé‚£ä¹ˆè¿™ä¸ªå¯¹è±¡å°†ä¸å†æ˜¯ä¸€ä¸ªçœŸæ­£çš„ <code>NSNumber</code> å¯¹è±¡â€”â€”å®ƒçš„æŒ‡é’ˆä¼šè‡ªåŠ¨è½¬æ¢ä¸º tagged pointer æŒ‡é’ˆï¼Œå¹¶ä¸”æœ€ä½ä½ä¼šè¢«è®¾ç½®ä¸º 1ï¼›æ¥ä¸‹æ¥çš„ 3 ä½ä¼šè®¾ä¸º <code>NSNumber</code> æ‰€å¯¹åº”çš„ tagged class åœ¨ä¸€ä¸ªå…¨å±€è¡¨ä¸­çš„ç´¢å¼•ï¼›è€Œå‰©ä½™çš„ 60 ä½ä¼šç”¨ä½œä¿å­˜å…¶æ•°å€¼ â€”â€” æ¯”å¦‚ä¸€ä¸ªèƒ½ç”¨ 60 ä½è¡¨ç¤ºçš„æ•´å‹å€¼ã€‚</p><p>å¯¹äºå¤–éƒ¨è€Œè¨€ï¼Œè¿™æ ·çš„ä¸€ä¸ªæŒ‡é’ˆä¸å…¶ä»–ä»»ä½•å¯¹è±¡çš„æŒ‡é’ˆçœ‹èµ·æ¥éƒ½æ˜¯ä¸€æ ·çš„ã€‚å®ƒèƒ½åƒå…¶ä»–å¯¹è±¡ä¸€æ ·å“åº”æ¶ˆæ¯ï¼Œå› ä¸º <code>objc_msgSend</code> çŸ¥é“å®ƒæ˜¯ä¸€ä¸ª tagged pointer ç±»å‹çš„æŒ‡é’ˆã€‚å‡å¦‚ä½ è¦å‘å®ƒå‘é€ <code>integerValue</code> çš„æ¶ˆæ¯ï¼ŒOC è¿è¡Œæ—¶ä¼šå¸®åŠ©æˆ‘ä»¬ä»å®ƒå­˜å‚¨æ•°æ®çš„ 60 ä½ä¸­æ‹¿å‡ºæ•°æ®å¹¶è¿”å›ã€‚</p><p>å°½ç®¡ä¸ºäº†å¯¹å¤–ç»Ÿä¸€ï¼Œè¿è¡Œæ—¶åšäº†å¾ˆå¤šé¢å¤–å·¥ä½œï¼Œä½†æœ€ç»ˆä½ èŠ‚çœäº†ä¸€æ¬¡å†…å­˜çš„åˆå§‹åŒ–ï¼Œä¸€æ¬¡æŒ‡é’ˆçš„é—´æ¥è®¿é—®ï¼Œå¹¶ä¸”ä¹Ÿä¸ä¼šæœ‰ä»»ä½•å…³äºå¼•ç”¨è®¡æ•°çš„æ“ä½œ â€”â€” å› ä¸ºæ²¡æœ‰å†…å­˜éœ€è¦è¢«é‡Šæ”¾ã€‚å¯¹äºä¸€äº›ç»å¸¸ä½¿ç”¨çš„ç±»æ¥è¯´ï¼Œè¿™èƒ½å¸¦æ¥æ˜¾è‘—çš„æ€§èƒ½æå‡ã€‚</p><p><code>NSString</code> çœ‹èµ·æ¥ä¸å¤ªé€‚ç”¨äº tagged pointer æŠ€æœ¯ï¼Œå› ä¸ºå®ƒçš„é•¿åº¦æ˜¯å¯å˜çš„ï¼Œè€Œä¸”å¯èƒ½ä¼šè¿œè¿œè¶…å‡º tagged pointer æ‰€èƒ½å­˜å‚¨çš„èŒƒå›´ã€‚ä½†è¯è™½å¦‚æ­¤ï¼Œä¸€ä¸ª tagged pointer çš„ç±»æ˜¯å¯ä»¥å’Œæ™®é€šçš„ç±»å…±å­˜çš„ â€”â€” æŸäº›å€¼ä½¿ç”¨ tagged pointerï¼Œå¦å¤–ä¸€äº›å€¼ä½¿ç”¨æ™®é€šæŒ‡é’ˆã€‚ä¾‹å¦‚ï¼Œå¯¹äº <code>NSNumber</code> æ¥è¯´ï¼Œä¸€ä¸ªå¤§äº 2^60 - 1 çš„æ•´å‹è¶…å‡ºäº† tagged pointer æ‰€èƒ½å­˜å‚¨çš„èŒƒå›´ï¼Œé‚£ä¹ˆå®ƒå°±éœ€è¦å­˜å‚¨ä¸ºä¸€ä¸ªåœ¨å†…å­˜ä¸­åˆå§‹åŒ–çš„æ™®é€š <code>NSNumber</code> å¯¹è±¡ã€‚</p><p><code>NSString</code> äº¦æ˜¯å¦‚æ­¤ã€‚å‡å¦‚æŸäº›å­—ç¬¦ä¸²å¯ä»¥ä¿å­˜ä¸º 60 ä½ä»¥å†…çš„äºŒè¿›åˆ¶æ•°æ®ï¼Œå®ƒä¼šåˆ›å»ºä¸º tagged pointerï¼Œè€Œå…¶ä»–å­—ç¬¦ä¸²ä¼šä¿å­˜ä¸ºæ™®é€šçš„å¯¹è±¡ã€‚æ®æ­¤æˆ‘ä»¬å¯ä»¥å‡è®¾ï¼Œå¦‚æœå°çš„å­—ç¬¦ä¸²ç»å¸¸è¢«ä½¿ç”¨ä¸”è¾¾åˆ°ä¸€å®šçš„ä½¿ç”¨é‡æ—¶ï¼Œå®ƒä¼šè·å¾—å¯è§‚çš„æ€§èƒ½ã€‚åœ¨çœŸå®çš„ä»£ç ä¸­ä¼šæœ‰å¦‚æ­¤æ•ˆæœå—ï¼Ÿæ˜¾ç„¶è‹¹æœç»™å‡ºäº†è‚¯å®šçš„ç­”æ¡ˆ â€”â€” å¦‚æœæ²¡æœ‰å®é™…æ•ˆæœï¼Œä»–ä»¬ä¸ä¼šå°è¯•å»å®ç°å®ƒã€‚</p><h2 id="å¯èƒ½çš„å®ç°"><a href="#å¯èƒ½çš„å®ç°" class="headerlink" title="å¯èƒ½çš„å®ç°"></a>å¯èƒ½çš„å®ç°</h2><p>åœ¨çª¥æ¢è‹¹æœçš„å®ç°ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆèŠ±ç‚¹æ—¶é—´æ€è€ƒä¸€ä¸‹å¯èƒ½çš„å®ç°æ–¹æ¡ˆã€‚åŸºæœ¬å‡†åˆ™å¾ˆç®€å•ï¼šæŠŠæœ€ä½ä½è®¾ä¸º 1ï¼Œç„¶åæŠŠåé¢çš„å‡ ä½è®¾ä¸ºåˆé€‚çš„ tagged class ç´¢å¼•ï¼Œæœ€åæŠŠå‰©ä¸‹çš„ä½è®¾ä¸ºä»»æ„å€¼ã€‚æ­¤æ—¶æœ€å¤§çš„é—®é¢˜æ˜¯å¦‚ä½•åˆ©ç”¨å‰©ä½™çš„ 60 ä½ â€”â€” æˆ‘ä»¬è¦å°½å¯èƒ½æœ€å¤§åŒ–è¿™ 60 ä½çš„ä»·å€¼ã€‚</p><p>Cocoa æ¡†æ¶ä¸­çš„å­—ç¬¦ä¸²åœ¨æŸç§æ¦‚å¿µä¸Šå…¶å®æ˜¯ä¸€ä¸ª Unicode ç ä½çš„åºåˆ—ã€‚Unicode åŒ…å«äº† 1,112,064 ä¸ªæœ‰æ•ˆç ä½ï¼Œæ‰€ä»¥ä¸€ä¸ªç ä½éœ€è¦ç”¨ 21 ä½æ¥è¡¨ç¤ºã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ 60 ä½çš„é•¿åº¦ä¸­æ”¾å…¥ä¸¤ä¸ª Unicode ç ä½ï¼Œè¿™æ ·è¿˜å‰©ä¸‹ 18 ä½æ²¡æœ‰ä½¿ç”¨ã€‚æˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ 18 ä½ä¸­å…¶ä¸­å‡ ä½æ¥è¡¨ç¤ºå­—ç¬¦ä¸²çš„é•¿åº¦ã€‚å› æ­¤ï¼Œè¿™æ ·çš„ä¸€ä¸ª tagged pointer  å­—ç¬¦ä¸²å¯èƒ½ä¼šåŒ…å«é›¶ä¸ªã€ä¸€ä¸ªæˆ–è€…ä¸¤ä¸ª Unicode ç ä½ã€‚ä½†é—®é¢˜æ˜¯ï¼Œæœ€å¤šåªèƒ½åŒ…å«ä¸¤ä¸ªç ä½å¥½åƒå¹¶ä¸å¤ªå®ç”¨ã€‚</p><p>å®é™…ä¸Šï¼Œ<code>NSString</code> API ä½¿ç”¨äº† UTF-16 å®ç°ï¼Œå¹¶éåŸå§‹çš„ Unicode ç ä½ã€‚UTF-16 æŠŠ Unicode è¡¨ç¤ºä¸ºä¸€ä¸ªåŒ…å«å¤šä¸ª 16 ä½æ•°å€¼çš„åºåˆ—ã€‚åœ¨åŸºæœ¬å¤šè¯­è¨€å¹³é¢ï¼ˆBasic Multilingual Planeï¼ŒBMPï¼‰ä¸­çš„å­—ç¬¦ï¼Œä¹Ÿå°±æ˜¯é‚£äº›æœ€å¸¸ç”¨çš„å­—ç¬¦ï¼Œä¼šä½¿ç”¨ä¸€ä¸ª 16 ä½çš„å€¼è¡¨ç¤ºã€‚åŒæ—¶ï¼Œé‚£äº›è¶…è¿‡ 65,535 çš„ç ä½ä¼šä½¿ç”¨ä¸¤ä¸ª 16 ä½ (ä¹Ÿå°±æ˜¯ 32 ä½) çš„å€¼æ¥è¡¨ç¤ºã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ 60 ä½çš„é•¿åº¦ä¸­æ”¾å…¥ä¸‰ä¸ª 16 ä½çš„å€¼ï¼Œå‰©ä½™çš„ 12 ä½åŒæ ·ç”¨äºè¡¨ç¤ºé•¿åº¦ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬å¯ä»¥æ”¾å…¥ 0 è‡³ 3 ä¸ª UTF-16 ç¼–ç çš„å­—ç¬¦ â€”â€” ä¸¥æ ¼æ¥è¯´æ˜¯æœ€å¤šä¸‰ä¸ª BMP ä¸­çš„å­—ç¬¦ï¼Œæˆ–è€…æœ€å¤šä¸€ä¸ª BMP ä¹‹ä¸Šå¹³é¢çš„å­—ç¬¦åŠ ä¸€ä¸ª BMP å¹³é¢ä¹‹ä¸‹çš„å­—ç¬¦ã€‚ä¸è¿‡æœ€å¤šä¸‰ä¸ªå­—ç¬¦ï¼Œæˆ‘ä»¬è¿˜æ˜¯ä¼šå¾ˆå—é™ã€‚</p><p>åœ¨åº”ç”¨ä¸­çš„å¤§å¤šæ•°å­—ç¬¦ä¸²éƒ½æ˜¯ ASCIIã€‚å³ä½¿è¿™ä¸ªåº”ç”¨æœ¬åœ°åŒ–ä¸ºä¸€ç§é ASCII çš„è¯­è¨€ï¼Œå­—ç¬¦ä¸²ä¹Ÿä¸åªæ˜¯å•çº¯åœ°åœ¨ UI å±‚ç”¨ä½œå±•ç¤º â€”â€” å­—ç¬¦ä¸²ä¼šç”¨äº URL çš„ç»„æˆã€æ–‡ä»¶æ‰©å±•åã€å¯¹è±¡çš„é”®ã€å±æ€§åˆ—è¡¨çš„å€¼ç­‰ç­‰ã€‚UTF-8 æ˜¯ä¸€ç§å…¼å®¹ ASCII çš„ç¼–ç ï¼Œå®ƒä¼šæŠŠæ¯ä¸ª ASCII å­—ç¬¦ç¼–ç ä¸ºå•ä¸ªå­—èŠ‚ï¼Œå¹¶ä¸”å¯¹å…¶ä»– Unicode ç ä½ä½¿ç”¨æœ€å¤šå››ä¸ªå­—èŠ‚è¿›è¡Œç¼–ç ã€‚è¿™æ ·ï¼Œæˆ‘ä»¬èƒ½åœ¨ 60 ä½ä¸­æ”¾å…¥æœ€å¤š 7 ä¸ªå­—èŠ‚ï¼Œå‰©ä¸‹ 4 ä½è¡¨ç¤ºé•¿åº¦ã€‚å› æ­¤ï¼Œæ ¹æ®ä¸åŒçš„å­—ç¬¦æ ¼å¼ï¼Œæˆ‘ä»¬çš„ tagged pointer å­—ç¬¦ä¸²å¯ä»¥åŒ…å«æœ€å¤š 7 ä¸ª ASCII å­—ç¬¦ï¼Œæˆ–è€…æ›´å°‘é‡çš„é ASCII å­—ç¬¦ã€‚</p><p>å¦‚æœæˆ‘ä»¬é’ˆå¯¹ ASCII ä¼˜åŒ–ä¸€ä¸‹ï¼Œæˆ–è®¸æˆ‘ä»¬èƒ½å®Œå…¨æŠ›å¼ƒå¯¹æ‰€æœ‰ Unicode éƒ½æ”¯æŒçš„æƒ³æ³• â€”â€” é‚£äº›é ASCII çš„å­—ç¬¦éƒ½ä½¿ç”¨çœŸæ­£çš„å­—ç¬¦ä¸²å¯¹è±¡æ¥ä¿å­˜ã€‚ASCII æ˜¯ä¸€ç§ 7 ä½çš„ç¼–ç æ–¹å¼ã€‚å› æ­¤ï¼Œå‡è®¾æˆ‘ä»¬åªç»™æ¯ä¸ªå­—ç¬¦åˆ†é… 7 ä½çš„ç©ºé—´å‘¢ï¼Ÿé‚£ä¹ˆæˆ‘ä»¬èƒ½åœ¨å¯åˆ©ç”¨çš„ 60 ä½ç©ºé—´ä¸­ä¿å­˜æœ€å¤š 8 ä¸ª ASCII å­—ç¬¦ï¼Œå‰©ä½™ 4 ä½è¡¨ç¤ºé•¿åº¦ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬çš„æ–¹æ¡ˆå¬ä¸Šå»å¼€å§‹å…·æœ‰ä¸€å®šçš„å¯è¡Œæ€§äº† â€”â€” åœ¨åº”ç”¨ä¸­åº”è¯¥æœ‰ä¸å°‘å­—ç¬¦ä¸²æ˜¯çº¯æ­£çš„ ASCII å¹¶ä¸”ä»…åŒ…å« 8 ä¸ªæˆ–æ›´å°‘çš„å­—ç¬¦ã€‚</p><p>è®©æˆ‘ä»¬çš„æ€ç»´æ”¾é£ä¸€ç‚¹ï¼Œå®Œæ•´çš„ ASCII èŒƒå›´ä¸­åŒ…å«äº†è®¸å¤šå¹¶ä¸å¸¸ç”¨çš„ä¸œè¥¿ã€‚æ¯”å¦‚å…¶ä¸­æœ‰ä¸€å¤§å †æ§åˆ¶å­—ç¬¦å’Œéå¸¸ç”¨ç¬¦å·ã€‚è€Œå­—æ¯å’Œæ•°å­—æ‰æ˜¯æˆ‘ä»¬æœ€å¸¸ç”¨çš„ã€‚æˆ‘ä»¬èƒ½æŠŠå®ƒå‹ç¼©æˆåªæœ‰ 6 ä½å—ï¼Ÿ</p><p>6 ä½å¯ä»¥è¡¨ç¤º 64 ä¸ªå¯èƒ½çš„å€¼ã€‚ASCII å­—æ¯è¡¨ä¸­æœ‰ 26 ä¸ªè‹±æ–‡å­—æ¯ã€‚å¦‚æœæŠŠå¤§å†™å­—æ¯ä¹Ÿç®—ä¸Šçš„è¯ä¸€å…±æœ‰ 52 ä¸ªå­—æ¯ã€‚å†åŠ ä¸Š 0-9 çš„æ•°å­—ï¼Œä¸€å…±æœ‰ 62 ä¸ªã€‚ç°åœ¨è¿˜æœ‰ä¸¤ä¸ªç©ºä½™çš„ä½ç½®ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠå®ƒä»¬ç•™ç»™ç©ºæ ¼å’Œå¥å·ã€‚è¿™æ ·åº”è¯¥ä¼šæœ‰å¾ˆå¤šçš„å­—ç¬¦ä¸²åªåŒ…å«ä¸Šè¿°çš„å­—ç¬¦ã€‚å¦‚æœä¸€ä¸ªå­—ç¬¦åªéœ€è¦ 6 ä½ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥åœ¨ 60 ä½ç©ºé—´ä¸­ä¿å­˜æœ€å¤š 10 ä¸ªå­—ç¬¦ï¼ä¸è¿‡åˆ«é«˜å…´å¤ªæ—©ï¼Œæˆ‘ä»¬ç°åœ¨æ²¡æœ‰å¤šä½™çš„ä½ç½®æ¥è¡¨ç¤ºé•¿åº¦äº†ï¼å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©è¿™ 60 ä½ä¿å­˜ 9 ä¸ªå­—ç¬¦å’Œ 1 ä¸ªé•¿åº¦ï¼Œæˆ–è€…æˆ‘ä»¬å»æ‰ä¸Šé¢çš„ 64 ä¸ªå€¼ä¹‹ä¸€ (æˆ‘æŠ•ç¥¨ç»™ç©ºæ ¼)ï¼Œç„¶åç”¨ä¸€ä¸ª 6 ä½çš„ <code>0</code> è¡¨ç¤ºå°‘äº 10 ä¸ªå­—ç¬¦çš„å­—ç¬¦ä¸²çš„ç»“æŸä½ã€‚(è¯‘è€…æ³¨ï¼šå»æ‰ 64 ä¸ªå­—ç¬¦é›†åˆä¸­çš„ä¸€ä¸ªï¼Œç„¶ååŠ å…¥ä¸€ä¸ªç»“æŸç¬¦ï¼Œå½“é‡åˆ°ç»“æŸç¬¦çš„æ—¶å€™å°±è¡¨ç¤ºå­—ç¬¦ä¸²ç»“æŸï¼Œé•¿åº¦ä¸ºç»“æŸç¬¦çš„ä½ç½®ï¼Œå¦åˆ™é•¿åº¦åˆšå¥½ä¸º 10ã€‚)</p><p>å¦‚æœåªä½¿ç”¨ 5 ä½å‘¢ï¼Ÿè¿™å¥½åƒæœ‰ç‚¹å¤©æ–¹å¤œè°­ã€‚ä½†å®é™…ä¸Šï¼Œåº”è¯¥æœ‰å¾ˆå¤§ä¸€éƒ¨åˆ†çš„å­—ç¬¦ä¸²åªåŒ…å«å°å†™å­—æ¯ã€‚5 ä½å¯ä»¥è¡¨ç¤º 32 ä¸ªå¯èƒ½çš„å€¼ã€‚å¦‚æœæˆ‘ä»¬æŠŠæ•´ä¸ªå°å†™å­—æ¯è¡¨è€ƒè™‘è¿›æ¥ï¼Œé‚£ä¹ˆè¿˜å‰©ä¸‹ 6 ä¸ªä½ç½®ï¼Œå¯ä»¥åˆ†é…ç»™ä¸€äº›å¸¸ç”¨çš„å¤§å†™å­—æ¯ã€ç¬¦å·å’Œæ•°å­—ã€‚å¦‚æœä½ è§‰å¾—è¿™äº›é™¤å°å†™å­—æ¯å¤–çš„æƒ…å†µæ›´ä¸ºå¸¸è§ï¼Œä½ ç”šè‡³å¯ä»¥å»æ‰ä¸€äº›ä¸å¸¸ç”¨çš„å°å†™å­—æ¯ï¼Œæ¯”å¦‚å­—æ¯ <code>q</code>ã€‚æ¯ä¸ªå­—ç¬¦åªä½¿ç”¨ 5 ä½çš„è¯ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥å­˜æ”¾ 11 ä¸ªå­—ç¬¦å¹¶ä¸”è¿˜èƒ½æœ‰å­˜æ”¾é•¿åº¦çš„ç©ºé—´ï¼Œæˆ–è€…æˆ‘ä»¬ä¿å­˜ 12 ä¸ªå­—ç¬¦ï¼Œå¹¶é‡‡ç”¨ç»“æŸç¬¦çš„æ–¹æ¡ˆè¡¨ç¤ºé•¿åº¦ã€‚</p><p>è®©æˆ‘ä»¬çš„æ€ç»´å†é£è¿œä¸€ç‚¹ã€‚æ¯ä¸ªå­—ç¬¦åªä½¿ç”¨ 5 ä½ä¼¼ä¹å·²ç»æ˜¯åœ¨å­—æ¯è¡¨é•¿åº¦å›ºå®šçš„å‰æä¸‹çš„æœ€ä¼˜è§£äº†ã€‚ä¸è¿‡ä½ å¯ä»¥ä½¿ç”¨ä¸€äº›å˜é•¿çš„ç¼–ç ï¼Œä¾‹å¦‚ Huffman ç¼–ç ã€‚è¿™æ ·çš„è¯ï¼Œå¯¹äºä¸€ä¸ªå¸¸è§çš„å­—æ¯ <code>e</code>ï¼Œå¯ä»¥ä½¿ç”¨æ¯”å­—æ¯ <code>q</code> æ›´å°‘çš„ä½è¡¨ç¤ºã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå‡è®¾ä½ çš„å­—ç¬¦ä¸²å…¨éƒ½æ˜¯ <code>e</code>ï¼Œé‚£å­—ç¬¦ä¸²çš„æ¯ä¸ªå­—ç¬¦æœ€å°‘å¯ä»¥åªç”¨ 1 ä½è¡¨ç¤ºã€‚ä½†è¿™æ ·çš„ä»£ä»·æ˜¯ä½ çš„ä»£ç ä¼šå˜å¾—æ›´åŠ å¤æ‚ï¼Œä¸”æ€§èƒ½æˆ–è®¸è¾ƒå·®ã€‚</p><p>è‹¹æœåˆ°åº•æ˜¯é‡‡ç”¨å“ªç§æ–¹æ¡ˆçš„å‘¢ï¼Ÿæˆ‘ä»¬ç°åœ¨æ¥ä¸€æ¢ç©¶ç«Ÿã€‚</p><h2 id="Tagged-Pointer-å­—ç¬¦ä¸²å®è·µ"><a href="#Tagged-Pointer-å­—ç¬¦ä¸²å®è·µ" class="headerlink" title="Tagged Pointer å­—ç¬¦ä¸²å®è·µ"></a>Tagged Pointer å­—ç¬¦ä¸²å®è·µ</h2><p>ä¸‹é¢çš„ä»£ç åˆ›å»ºäº†ä¸€ä¸ª tagged pointer å­—ç¬¦ä¸²å¹¶æ‰“å°äº†å®ƒçš„æŒ‡é’ˆï¼š</p><figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="built_in">NSString</span> *a = <span class="string">@"a"</span>;</span><br><span class="line"><span class="built_in">NSString</span> *b = [[a mutableCopy] <span class="keyword">copy</span>];</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"%p %p %@"</span>, a, b, object_getClass(b));</span><br></pre></td></tr></table></figure><p>è¿™é‡Œ <code>mutableCopy</code> å’Œ <code>copy</code> çš„æ“ä½œå¯èƒ½ä¼šè®©äººè´¹è§£ï¼Œä½†å®ƒå´æ˜¯å¿…é¡»çš„ã€‚å…¶ä¸­æœ‰ä¸¤ä¸ªåŸå› ï¼šé¦–å…ˆï¼Œå°½ç®¡ä¸€ä¸ªåƒ <code>@&quot;a&quot;</code> è¿™æ ·çš„å­—ç¬¦ä¸²å¯ä»¥è¢«å­˜å‚¨ä¸º tagged pointer å­—ç¬¦ä¸²ï¼Œä½†å¦‚æœæ˜¯å¸¸é‡å­—ç¬¦ä¸²çš„è¯ï¼Œé‚£ä¹ˆå®ƒæ°¸è¿œä¸ä¼šå­˜å‚¨ä¸º tagged pointer å­—ç¬¦ä¸²ã€‚å¸¸é‡å­—ç¬¦ä¸²å¿…é¡»ä¿è¯èƒ½å¤Ÿå…¼å®¹ä¸åŒçš„æ“ä½œç³»ç»Ÿç‰ˆæœ¬ï¼Œä½† tagged pointer å­—ç¬¦ä¸²çš„å†…éƒ¨ç»†èŠ‚å´ä¸ä¿è¯èƒ½å…¼å®¹ã€‚å¦‚æœåªæ˜¯è‹¹æœçš„è¿è¡Œæ—¶ä»£ç æ‰€ç”Ÿæˆçš„ tagged pointerï¼Œå®ƒä¸ä¼šæœ‰ä»»ä½•é—®é¢˜ã€‚ä½†å¦‚æœåƒå¸¸é‡å­—ç¬¦ä¸²ä¸€æ ·ï¼Œç¼–è¯‘å™¨æŠŠå®ƒä»¬åµŒå…¥åœ¨äºŒè¿›åˆ¶æ–‡ä»¶ä¸­æ—¶ï¼Œå°±å¯èƒ½ä¼šå‘ç”Ÿå´©æºƒçš„é—®é¢˜ã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦å¯¹å¸¸é‡å­—ç¬¦ä¸²è¿›è¡Œ <code>copy</code> æ“ä½œæ¥æ‹¿åˆ°ä¸€ä¸ª tagged pointerã€‚</p><p>å¿…é¡»è¿›è¡Œ <code>mutableCopy</code> æ“ä½œçš„åŸå› æ˜¯ï¼Œ<code>NSString</code> å¯¹æˆ‘ä»¬æ¥è¯´ååˆ†çš„ â€œèªæ˜â€ ï¼Œå®ƒèƒ½çŸ¥é“ä¸€ä¸ªå¯¹ä¸å¯å˜å­—ç¬¦ä¸²çš„ <code>copy</code> å…¶å®æ˜¯ä¸€ä¸ªæ¯«æ— æ„ä¹‰çš„æ“ä½œï¼Œå¹¶è¿”å›åŸæ¥çš„å­—ç¬¦ä¸²ä½œä¸º <code>copy</code> æ“ä½œåçš„å€¼ã€‚å› ä¸ºå¸¸é‡å­—ç¬¦ä¸²æ˜¯ä¸å¯å˜çš„ï¼Œæ‰€ä»¥ <code>[a copy]</code> çš„è¿”å›å€¼å…¶å®ä¸ <code>a</code> æ˜¯ä¸€æ ·çš„ã€‚ä¸è¿‡ï¼Œ<code>mutableCopy</code> ä¼šå¼ºåˆ¶è¿›è¡ŒçœŸæ­£çš„æ‹·è´æ“ä½œï¼ˆæ·±æ‹·è´ï¼‰ï¼Œç„¶åå¯¹è¿™æ ·ä¸€ä¸ªæ·±æ‹·è´åçš„ç»“æœå†è¿›è¡Œä¸€æ¬¡ä¸å¯å˜æ‹·è´æ“ä½œåï¼Œè¶³ä»¥è®©ç³»ç»Ÿè¿”å›ç»™æˆ‘ä»¬ä¸€ä¸ª tagger pointer å­—ç¬¦ä¸²ã€‚</p><blockquote><p>è¯‘è€…æ³¨ï¼š<code>[a mutableCopy]</code> ä¼šåœ¨è¿è¡Œæ—¶åˆ›å»ºä¸€ä¸ªå¯å˜å­—ç¬¦ä¸²ï¼ˆæ·±æ‹·è´ï¼‰ï¼Œå› æ­¤é¿å…äº†ä¸Šé¢åŸå› ä¸€ä¸­å…³äºå¸¸é‡å­—ç¬¦ä¸²çš„æƒ…å†µã€‚ä½†ç”±äº <code>mutableCopy</code> åçš„å¯¹è±¡æ˜¯ä¸€ä¸ªå¯å˜å¯¹è±¡ï¼Œä¸å¯èƒ½ä¸º tagged pointerï¼Œå› æ­¤éœ€è¦å†å¯¹æ­¤å¯å˜å‰¯æœ¬è¿›è¡Œä¸€æ¬¡ <code>copy</code> æ“ä½œã€‚è¿™æ¬¡ <code>copy</code> ä¼šåœ¨è¿è¡Œæ—¶è¿”å›ä¸€ä¸ªæ–°çš„ä¸å¯å˜å‰¯æœ¬ï¼ˆæ·±æ‹·è´ï¼‰ï¼Œé¿å…äº†ä¸Šé¢åŸå› äºŒä¸­å¯¹å¸¸é‡å­—ç¬¦ä¸²æ‹·è´è¿”å›åŸå€¼çš„æƒ…å†µï¼ˆæµ…æ‹·è´ï¼‰ï¼Œè¿›è€Œä¿è¯äº†æœ€åè¿”å›çš„å¯¹è±¡æ˜¯ç»è¿‡è¿è¡Œæ—¶åˆ›å»ºå‡ºæ¥çš„ï¼ˆtagged pointer å¯¹è±¡åªä¼šåœ¨è¿è¡Œæ—¶åˆ›å»ºï¼‰ã€‚</p></blockquote><p>æ³¨æ„ï¼Œä½ ä¸€å®šä¸å¯ä»¥åœ¨è‡ªå·±çš„ä»£ç ä¸­ä¾èµ–è¿™äº›ç»†èŠ‚ï¼<code>NSString</code> çš„ä»£ç è¿”å›ä¸€ä¸ª tagged pointer ç»™ä½ çš„æƒ…å†µå¹¶ä¸æ˜¯ä¸€æˆä¸å˜çš„ï¼Œå¦‚æœä½ ç¼–å†™çš„ä»£ç ä¸çŸ¥æ€ä¹ˆåœ°ä¾èµ–äºæ­¤ï¼Œé‚£å®ƒæœ€ç»ˆå¯èƒ½ä¼šå¯¼è‡´å´©æºƒã€‚å¹¸å¥½ï¼Œæ­£å¸¸ä¸”åˆç†çš„ä»£ç ä¸ä¼šæœ‰ä»»ä½•é—®é¢˜ â€”â€” è®©ä½ å¯ä»¥å¹¸ç¦åœ°å¿½ç•¥æ‰€æœ‰ tagged ç›¸å…³çš„ä¸œè¥¿ã€‚</p><p>ä¸Šé¢çš„ä»£ç åœ¨æˆ‘çš„ç”µè„‘ä¸Šæ‰“å°å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">0x10ba41038 0x6115 NSTaggedPointerString</span><br></pre></td></tr></table></figure><p>é¦–å…ˆï¼Œä½ å¯ä»¥çœ‹åˆ°åŸå§‹çš„æŒ‡é’ˆ â€”â€” ä¸€ä¸ªç”¨æ¥è¡¨ç¤ºå¯¹è±¡æŒ‡é’ˆçš„æ•´æ•°ã€‚ç¬¬äºŒä¸ªå€¼ä¸º <code>copy</code> åçš„æŒ‡é’ˆï¼Œå®ƒéå¸¸æ¸…æ™°åœ°è¡¨ç¤ºå‡º tagged pointer çš„ç‰¹æ€§ï¼šé¦–å…ˆï¼Œå®ƒæ˜¯ä¸€ä¸ªå¥‡æ•°ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒä¸ä¼šæ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„å¯¹è±¡æŒ‡é’ˆï¼ˆå†…å­˜å¯¹é½çš„å…³ç³»ï¼‰ã€‚åŒæ—¶ï¼Œå®ƒæ˜¯ä¸€ä¸ªå¾ˆå°çš„æ•°ã€‚åœ¨ 64 ä½ Mac ç³»ç»Ÿçš„åœ°å€ç©ºé—´ä¸­ï¼Œä¸€å¼€å§‹çš„ 4GB æ˜¯æ²¡æœ‰ä»»ä½•æ˜ å°„ä¸”ä¸èƒ½å»ºç«‹æ˜ å°„çš„ç©ºé¡µã€‚å› æ­¤ï¼Œè¿™ä¸ªå±äºç©ºé¡µçš„åœ°å€ä¹Ÿå¾ˆå¥½åœ°è¯æ˜äº†å®ƒä¸å¯èƒ½æ˜¯ä¸€ä¸ªå¯¹è±¡æŒ‡é’ˆã€‚</p><p>æˆ‘ä»¬å¯ä»¥ä» <code>0x6115</code> è¿™ä¸ªå€¼æ¨æ–­å‡ºä»€ä¹ˆå‘¢ï¼Ÿé¦–å…ˆæˆ‘ä»¬å¯ä»¥çŸ¥é“æœ€ä½çš„ 4 ä½æ˜¯ tagged pointer æœºåˆ¶æœ¬èº«çš„ä¸€éƒ¨åˆ†ã€‚æœ€ä½çš„åå…­è¿›åˆ¶æ•°å­— <code>5</code> åœ¨äºŒè¿›åˆ¶ä¸­ä¸º <code>0101</code>ã€‚æœ€ä½ä½çš„ <code>1</code> è¡¨æ˜äº†å®ƒæ˜¯ä¸€ä¸ª tagged pointerã€‚å‰©ä¸‹çš„ 3 ä½è¡¨æ˜äº†å®ƒçš„ tagged class â€”â€” åœ¨è¿™ä¸ªä¾‹å­ä¸­æ˜¯ <code>010</code>ï¼Œè¡¨æ˜äº† tagged pointer å­—ç¬¦ä¸²ç±»çš„ç´¢å¼•å€¼ä¸º <code>2</code>ã€‚ä¸è¿‡è¿™äº›ä¿¡æ¯å¹¶ä¸èƒ½æä¾›ç»™æˆ‘ä»¬ä»€ä¹ˆæœ‰ç”¨çš„ä¸œè¥¿ã€‚</p><p>è€Œä¸Šé¢ä¾‹å­ä¸­åå…­è¿›åˆ¶åœ°å€çš„ <code>61</code> åˆ™å¾ˆå€¼å¾—æˆ‘ä»¬æ¢è®¨ä¸€ç•ªã€‚åœ¨åå…­è¿›åˆ¶ä¸­ï¼Œ<code>61</code> åˆšå¥½ä¸ºå­—æ¯ a çš„ ASCII ç¼–ç ã€‚è¿˜è®°å¾—è¿™ä¸ªæŒ‡é’ˆæ‰€æŒ‡å‘çš„å€¼å— â€”â€” æ­£å¥½å°±æ˜¯å­—æ¯ aï¼çœ‹èµ·æ¥è¿™é‡Œç›´æ¥ä½¿ç”¨äº† ASCII ç¼–ç çš„å€¼ï¼ŒçœŸæ˜¯ä¸ªæ–¹ä¾¿è€Œåˆåˆé€‚çš„é€‰æ‹©ï¼</p><p>æ¥ä¸‹æ¥æ‰“å°å‡ºçš„ç±»åæ˜æ˜¾åœ°è¡¨æ˜äº†å®ƒçš„ç±»æ˜¯ä»€ä¹ˆï¼Œå¹¶ä¸”ä¹Ÿæä¾›äº†ä¸€ä¸ªéå¸¸ä¸é”™çš„åˆ‡å…¥ç‚¹ï¼Œæ¥è®©æˆ‘ä»¬æ·±å…¥å…¶çœŸå®æºç ä¸€æ¢æ­¤ç‰¹æ€§çš„æœ¬è´¨å®ç°ã€‚æˆ‘ä»¬å¾ˆå¿«ä¼šè¿›å…¥è¿™ä¸€é˜¶æ®µï¼Œä¸è¿‡åœ¨æ­¤ä¹‹å‰å…ˆåšç‚¹é¢å¤–çš„æ£€æŸ¥ã€‚</p><p>è¿™é‡Œé€šè¿‡ä¸€ä¸ªå¾ªç¯æ„é€ å‡º <code>abcdef...</code> çš„å­—ç¬¦ä¸²ï¼ŒåŒæ—¶æŠŠå±äº tagged pointer çš„å­—ç¬¦ä¸²æŒ‡é’ˆä¸€ä¸ªæ¥ä¸€ä¸ªåœ°æ‰“å°å‡ºæ¥ã€‚</p><figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="built_in">NSMutableString</span> *<span class="keyword">mutable</span> = [<span class="built_in">NSMutableString</span> string];</span><br><span class="line"><span class="built_in">NSString</span> *immutable;</span><br><span class="line"><span class="keyword">char</span> c = <span class="string">'a'</span>;</span><br><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line">    [<span class="keyword">mutable</span> appendFormat: <span class="string">@"%c"</span>, c++];</span><br><span class="line">    immutable = [<span class="keyword">mutable</span> <span class="keyword">copy</span>];</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"0x%016lx %@ %@"</span>, immutable, immutable, object_getClass(immutable));</span><br><span class="line">&#125; <span class="keyword">while</span>(((uintptr_t)immutable &amp; <span class="number">1</span>) == <span class="number">1</span>);</span><br></pre></td></tr></table></figure><p>ç¬¬ä¸€æ¬¡è¿­ä»£çš„æ‰“å°ç»“æœä¸ºï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">0x0000000000006115 a NSTaggedPointerString</span><br></pre></td></tr></table></figure><p>è¿™éªŒè¯äº†ä¸Šæ–‡çš„æ‰€å†™çš„ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç°åœ¨æˆ‘ä»¬æŠŠåŒ…å«ç©ºä½ 0 çš„æŒ‡é’ˆå®Œæ•´åœ°æ‰“å°å‡ºæ¥ï¼Œå¯ä»¥è®©æ¯æ¬¡è¿­ä»£çš„æ‰“å°ç»“æœå¯¹æ¯”æ›´åŠ æ¸…æ™°ã€‚</p><p>ç°åœ¨å¯¹æ¯”ä¸€ä¸‹ç¬¬äºŒæ¬¡è¿­ä»£çš„æ‰“å°ç»“æœï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">0x0000000000626125 ab NSTaggedPointerString</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°æœ€ä½ 4 ä½æ²¡æœ‰å‘ç”Ÿä»»ä½•å˜åŒ–ï¼Œè¿™ä¹Ÿåœ¨æˆ‘ä»¬æ„æ–™ä¹‹ä¸­ã€‚è¿™ä¸ªåå…­è¿›åˆ¶çš„æ•°å­— <code>5</code> ä¼šä¸€ç›´ä¿æŒä¸å˜ï¼Œæ€»æ˜¯è¡¨æ˜å®ƒæ˜¯ä¸€ä¸ª <code>NSTaggedPointerString</code> ç±»å‹çš„ tagged pointerã€‚</p><p>è€ŒåŸæ¥çš„ <code>61</code> ä¹Ÿä¿æŒåŸæ¥çš„ä½ç½®ï¼Œä¸è¿‡ç°åœ¨å®ƒå‰é¢å‡ºç°äº† <code>62</code>ã€‚æ˜¾è€Œæ˜“è§ï¼Œ<code>62</code> æ˜¯å­—æ¯ b çš„ ASCII ç¼–ç ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥çŸ¥é“å½“å‰çš„ç¼–ç æ–¹å¼æ˜¯ä½¿ç”¨ ASCII çš„ 8 ä½ç¼–ç ã€‚è€Œåœ¨æœ€ä½ä½ä¹‹å‰çš„ 4 ä½ç”± <code>1</code> å˜æˆäº† <code>2</code>ï¼Œç”±æ­¤æˆ‘ä»¬å¯ä»¥æƒ³åˆ°å®ƒæˆ–è®¸è¡¨ç¤ºäº†å­—ç¬¦ä¸²çš„é•¿åº¦ã€‚æ¥ä¸‹æ¥çš„è¿­ä»£ç¡®è®¤äº†è¿™ä¸ªçŒœæƒ³ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">0x0000000063626135 abc NSTaggedPointerString</span><br><span class="line">0x0000006463626145 abcd NSTaggedPointerString</span><br><span class="line">0x0000656463626155 abcde NSTaggedPointerString</span><br><span class="line">0x0066656463626165 abcdef NSTaggedPointerString</span><br><span class="line">0x6766656463626175 abcdefg NSTaggedPointerString</span><br></pre></td></tr></table></figure><p>æŒ‰ç†æ¥è¯´ï¼Œç”±äº tagged pointer çš„ç©ºä½å·²ç»å¡«æ»¡äº†ï¼Œè¿­ä»£åº”è¯¥ä¹Ÿåˆ°æ­¤ä¸ºæ­¢ã€‚å¯äº‹å®çš„ç¡®å¦‚æ­¤å—ï¼Ÿå¹¶ä¸æ˜¯ï¼</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">0x0022038a01169585 abcdefgh NSTaggedPointerString</span><br><span class="line">0x0880e28045a54195 abcdefghi NSTaggedPointerString</span><br><span class="line">0x00007fd275800030 abcdefghij __NSCFString</span><br></pre></td></tr></table></figure><p>å¾ªç¯ä¸­çš„ä»£ç ç»§ç»­æ‰§è¡Œä¸‹å»ï¼Œç›´åˆ°ä¸¤æ¬¡è¿­ä»£åæ‰ç»ˆæ­¢ã€‚è¡¨ç¤ºé•¿åº¦çš„åŒºé—´ç»§ç»­ä¿æŒå¢é•¿ï¼Œä½†æŒ‡é’ˆå‰©ä½™çš„éƒ¨åˆ†å´æ˜¾å¾—æ‚ä¹±æ— ç« ã€‚åˆ°åº•æ˜¯å‘ç”Ÿäº†ä»€ä¹ˆå‘¢ï¼Ÿè®©æˆ‘ä»¬æ·±å…¥å…¶å®ç°ä»£ç æ¥ä¸€æ¢ç©¶ç«Ÿã€‚</p><h2 id="åˆ¨æ ¹é—®åº•"><a href="#åˆ¨æ ¹é—®åº•" class="headerlink" title="åˆ¨æ ¹é—®åº•"></a>åˆ¨æ ¹é—®åº•</h2><p><code>NSTaggedPointer</code> ç±»å­˜åœ¨äº CoreFoundation åº“ä¸­ã€‚ä¼¼ä¹æŠŠå®ƒæ”¾åœ¨ Foundation ä¸­ä¼šæ›´åŠ åˆç†ä¸€ç‚¹ï¼Œä½†å®é™…ä¸Šç°åœ¨è‹¹æœè®¸å¤šæ ¸å¿ƒçš„ Objective-C ç±»éƒ½è¢«ç§»åˆ°äº† CoreFoundation å½“ä¸­ï¼Œå› ä¸ºè‹¹æœæ…¢æ…¢åœ°æ”¾å¼ƒäº†æŠŠ  CoreFoundation å˜æˆä¸€ä¸ªç‹¬ç«‹å®ä½“çš„æƒ³æ³•ã€‚</p><p>å…ˆæ¥çœ‹çœ‹ <code>-[NSTaggedPointerString length]</code> çš„å®ç°ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">push       rbp</span><br><span class="line">mov        rbp, rsp</span><br><span class="line">shr        rdi, 0x4</span><br><span class="line">and        rdi, 0xf</span><br><span class="line">mov        rax, rdi</span><br><span class="line">pop        rbp</span><br><span class="line">ret</span><br></pre></td></tr></table></figure><p>Hopper å·¥å…·ä¸ºæˆ‘ä»¬æä¾›äº†è¿™ä¸ªç®€æ˜“çš„åç¼–è¯‘ç‰ˆæœ¬ï¼š</p><figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="keyword">long</span> -[<span class="built_in">NSTaggedPointerString</span> length](<span class="keyword">void</span> * <span class="keyword">self</span>, <span class="keyword">void</span> * _cmd) &#123;</span><br><span class="line">    rax = <span class="keyword">self</span> &gt;&gt; <span class="number">0x4</span> &amp; <span class="number">0xf</span>;</span><br><span class="line">    <span class="keyword">return</span> rax;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç®€å•æ¥è¯´ï¼Œæå–å‡º 4 è‡³ 7 ä½çš„å€¼å¹¶è¿”å›å®ƒä»¬ä¾¿å¯ä»¥å¾—åˆ°å­—ç¬¦ä¸²çš„é•¿åº¦ã€‚è¿™è¯å®äº†æˆ‘ä»¬ä¸Šæ–‡ä¸­æ‰€è§‚å¯Ÿåˆ°çš„ â€”â€” åœ¨æœ€ä½ä½çš„åå…­è¿›åˆ¶ <code>5</code> å‰é¢çš„ 4 ä½è¡¨ç¤ºäº†å­—ç¬¦ä¸²çš„é•¿åº¦ã€‚ </p><p><code>NSString</code> å­ç±»ä¸­å¦ä¸€ä¸ªåŸå§‹æ–¹æ³•æ˜¯ <code>characterAtIndex:</code>ã€‚ç”±äºå…¶æ±‡ç¼–ä»£ç å¤ªé•¿ï¼Œæˆ‘ä¼šç›´æ¥è·³è¿‡å¹¶ç»™å‡º Hopper åç¼–è¯‘å‡ºçš„å¯è¯»æ€§è¾ƒé«˜çš„ç‰ˆæœ¬ï¼š</p><figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="keyword">unsigned</span> <span class="keyword">short</span> -[<span class="built_in">NSTaggedPointerString</span> characterAtIndex:](<span class="keyword">void</span> * <span class="keyword">self</span>, <span class="keyword">void</span> * _cmd, <span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="keyword">long</span> arg2) &#123;</span><br><span class="line">     rsi = _cmd;</span><br><span class="line">     rdi = <span class="keyword">self</span>;</span><br><span class="line">     r13 = arg2</span><br><span class="line">     r8 = ___stack_chk_guard;</span><br><span class="line">     var_30 = *r8;</span><br><span class="line">     r12 = rdi &gt;&gt; <span class="number">0x4</span> &amp; <span class="number">0xf</span>;</span><br><span class="line">     <span class="keyword">if</span> (r12 &gt;= <span class="number">0x8</span>) &#123;</span><br><span class="line">             rbx = rdi &gt;&gt; <span class="number">0x8</span>;</span><br><span class="line">             rcx = <span class="string">"eilotrm.apdnsIc ufkMShjTRxgC4013bDNvwyUL2O856P-B79AFKEWV_zGJ/HYX"</span>;</span><br><span class="line">             rdx = r12;</span><br><span class="line">             <span class="keyword">if</span> (r12 &lt; <span class="number">0xa</span>) &#123;</span><br><span class="line">                     <span class="keyword">do</span> &#123;</span><br><span class="line">                             *(int8_t *)(rbp + rdx + <span class="number">0xffffffffffffffbf</span>) = *(int8_t *)((rbx &amp; <span class="number">0x3f</span>) + rcx);</span><br><span class="line">                             rdx = rdx - <span class="number">0x1</span>;</span><br><span class="line">                             rbx = rbx &gt;&gt; <span class="number">0x6</span>;</span><br><span class="line">                     &#125; <span class="keyword">while</span> (rdx != <span class="number">0x0</span>);</span><br><span class="line">             &#125;</span><br><span class="line">             <span class="keyword">else</span> &#123;</span><br><span class="line">                     <span class="keyword">do</span> &#123;</span><br><span class="line">                             *(int8_t *)(rbp + rdx + <span class="number">0xffffffffffffffbf</span>) = *(int8_t *)((rbx &amp; <span class="number">0x1f</span>) + rcx);</span><br><span class="line">                             rdx = rdx - <span class="number">0x1</span>;</span><br><span class="line">                             rbx = rbx &gt;&gt; <span class="number">0x5</span>;</span><br><span class="line">                     &#125; <span class="keyword">while</span> (rdx != <span class="number">0x0</span>);</span><br><span class="line">             &#125;</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">if</span> (r12 &lt;= r13) &#123;</span><br><span class="line">             rbx = r8;</span><br><span class="line">             ___CFExceptionProem(rdi, rsi);</span><br><span class="line">             [<span class="built_in">NSException</span> raise:<span class="string">@"NSRangeException"</span> format:<span class="string">@"%@: Index %lu out of bounds; string length %lu"</span>];</span><br><span class="line">             r8 = rbx;</span><br><span class="line">     &#125;</span><br><span class="line">     rax = *(int8_t *)(rbp + r13 + <span class="number">0xffffffffffffffc0</span>) &amp; <span class="number">0xff</span>;</span><br><span class="line">     <span class="keyword">if</span> (*r8 != var_30) &#123;</span><br><span class="line">             rax = __stack_chk_fail();</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">return</span> rax;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬ç¨å¾®æ•´ç†ä¸€ä¸‹ï¼šå‰ä¸‰è¡Œä¸­ï¼ŒHopper è®©æˆ‘ä»¬çŸ¥é“äº†å¯„å­˜å™¨åˆ†åˆ«å­˜æ”¾äº†å“ªäº›å‚æ•°ã€‚æˆ‘ä»¬é©¬ä¸Šç€æ‰‹æŠŠ <code>rsi</code> æ›¿æ¢æˆ <code>_cmd</code>ï¼Œç„¶åæŠŠ <code>rdi</code> æ›¿æ¢æˆ <code>self</code>ã€‚<code>arg2</code> å®é™…ä¸Šæ˜¯ <code>index</code> å‚æ•°ï¼Œå› æ­¤æˆ‘ä»¬æŠŠæ‰€æœ‰ <code>r13</code> çš„è°ƒç”¨æ›¿æ¢æˆ <code>index</code>ã€‚æ¥ä¸‹æ¥ï¼Œç”±äº <code>__stack_chk</code> å…¶å®æ˜¯ä¸€ä¸ªç”¨æ¥åŠ å¼ºé˜²å¾¡æ€§çš„ä¸œè¥¿ï¼Œä¸”å®ƒä¸å‡½æ•°çš„å®é™…ä½œç”¨æ²¡æœ‰å¤šå¤§å…³è”ï¼Œæˆ‘ä»¬å¯ä»¥æš‚æ—¶å¿½ç•¥æ‰å®ƒã€‚ç°åœ¨æ•´ç†è¿‡åçš„ä»£ç çœ‹èµ·æ¥å¤§æ¦‚æ˜¯è¿™ä¸ªæ ·å­çš„ï¼š</p><figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="keyword">unsigned</span> <span class="keyword">short</span> -[<span class="built_in">NSTaggedPointerString</span> characterAtIndex:](<span class="keyword">void</span> * <span class="keyword">self</span>, <span class="keyword">void</span> * _cmd, <span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="keyword">long</span> index) &#123;</span><br><span class="line">    r12 = <span class="keyword">self</span> &gt;&gt; <span class="number">0x4</span> &amp; <span class="number">0xf</span>;</span><br><span class="line">    <span class="keyword">if</span> (r12 &gt;= <span class="number">0x8</span>) &#123;</span><br><span class="line">            rbx = <span class="keyword">self</span> &gt;&gt; <span class="number">0x8</span>;</span><br><span class="line">            rcx = <span class="string">"eilotrm.apdnsIc ufkMShjTRxgC4013bDNvwyUL2O856P-B79AFKEWV_zGJ/HYX"</span>;</span><br><span class="line">            rdx = r12;</span><br><span class="line">            <span class="keyword">if</span> (r12 &lt; <span class="number">0xa</span>) &#123;</span><br><span class="line">                    <span class="keyword">do</span> &#123;</span><br><span class="line">                            *(int8_t *)(rbp + rdx + <span class="number">0xffffffffffffffbf</span>) = *(int8_t *)((rbx &amp; <span class="number">0x3f</span>) + rcx);</span><br><span class="line">                            rdx = rdx - <span class="number">0x1</span>;</span><br><span class="line">                            rbx = rbx &gt;&gt; <span class="number">0x6</span>;</span><br><span class="line">                    &#125; <span class="keyword">while</span> (rdx != <span class="number">0x0</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">do</span> &#123;</span><br><span class="line">                            *(int8_t *)(rbp + rdx + <span class="number">0xffffffffffffffbf</span>) = *(int8_t *)((rbx &amp; <span class="number">0x1f</span>) + rcx);</span><br><span class="line">                            rdx = rdx - <span class="number">0x1</span>;</span><br><span class="line">                            rbx = rbx &gt;&gt; <span class="number">0x5</span>;</span><br><span class="line">                    &#125; <span class="keyword">while</span> (rdx != <span class="number">0x0</span>);</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (r12 &lt;= index) &#123;</span><br><span class="line">            rbx = r8;</span><br><span class="line">            ___CFExceptionProem(<span class="keyword">self</span>, _cmd);</span><br><span class="line">            [<span class="built_in">NSException</span> raise:<span class="string">@"NSRangeException"</span> format:<span class="string">@"%@: Index %lu out of bounds; string length %lu"</span>];</span><br><span class="line">            r8 = rbx;</span><br><span class="line">    &#125;</span><br><span class="line">    rax = *(int8_t *)(rbp + index + <span class="number">0xffffffffffffffc0</span>) &amp; <span class="number">0xff</span>;</span><br><span class="line">    <span class="keyword">return</span> rax;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨æ„ç¬¬ä¸€ä¸ª <code>if</code> è¯­å¥ä¹‹å‰çš„è¿™è¡Œä»£ç ï¼š</p><figure class="highlight objc"><table><tr><td class="code"><pre><span class="line">r12 = <span class="keyword">self</span> &gt;&gt; <span class="number">0x4</span> &amp; <span class="number">0xf</span></span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œè¿™æ­£æ˜¯æˆ‘ä»¬å‰é¢æ‰€çœ‹åˆ°çš„ <code>-length</code> å®ç°ä»£ç ã€‚æ—¢ç„¶å¦‚æ­¤ï¼Œé‚£æˆ‘ä»¬å°±æŠŠ <code>r12</code> å…¨éƒ¨æ›¿æ¢æˆ <code>length</code>ï¼š</p><figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="keyword">unsigned</span> <span class="keyword">short</span> -[<span class="built_in">NSTaggedPointerString</span> characterAtIndex:](<span class="keyword">void</span> * <span class="keyword">self</span>, <span class="keyword">void</span> * _cmd, <span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="keyword">long</span> index) &#123;</span><br><span class="line">    length = <span class="keyword">self</span> &gt;&gt; <span class="number">0x4</span> &amp; <span class="number">0xf</span>;</span><br><span class="line">    <span class="keyword">if</span> (length &gt;= <span class="number">0x8</span>) &#123;</span><br><span class="line">            rbx = <span class="keyword">self</span> &gt;&gt; <span class="number">0x8</span>;</span><br><span class="line">            rcx = <span class="string">"eilotrm.apdnsIc ufkMShjTRxgC4013bDNvwyUL2O856P-B79AFKEWV_zGJ/HYX"</span>;</span><br><span class="line">            rdx = length;</span><br><span class="line">            <span class="keyword">if</span> (length &lt; <span class="number">0xa</span>) &#123;</span><br><span class="line">                    <span class="keyword">do</span> &#123;</span><br><span class="line">                            *(int8_t *)(rbp + rdx + <span class="number">0xffffffffffffffbf</span>) = *(int8_t *)((rbx &amp; <span class="number">0x3f</span>) + rcx);</span><br><span class="line">                            rdx = rdx - <span class="number">0x1</span>;</span><br><span class="line">                            rbx = rbx &gt;&gt; <span class="number">0x6</span>;</span><br><span class="line">                    &#125; <span class="keyword">while</span> (rdx != <span class="number">0x0</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">do</span> &#123;</span><br><span class="line">                            *(int8_t *)(rbp + rdx + <span class="number">0xffffffffffffffbf</span>) = *(int8_t *)((rbx &amp; <span class="number">0x1f</span>) + rcx);</span><br><span class="line">                            rdx = rdx - <span class="number">0x1</span>;</span><br><span class="line">                            rbx = rbx &gt;&gt; <span class="number">0x5</span>;</span><br><span class="line">                    &#125; <span class="keyword">while</span> (rdx != <span class="number">0x0</span>);</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (length &lt;= index) &#123;</span><br><span class="line">            rbx = r8;</span><br><span class="line">            ___CFExceptionProem(<span class="keyword">self</span>, _cmd);</span><br><span class="line">            [<span class="built_in">NSException</span> raise:<span class="string">@"NSRangeException"</span> format:<span class="string">@"%@: Index %lu out of bounds; string length %lu"</span>];</span><br><span class="line">            r8 = rbx;</span><br><span class="line">    &#125;</span><br><span class="line">    rax = *(int8_t *)(rbp + index + <span class="number">0xffffffffffffffc0</span>) &amp; <span class="number">0xff</span>;</span><br><span class="line">    <span class="keyword">return</span> rax;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç°åœ¨æ¥çœ‹ <code>if</code> è¯­å¥å†…éƒ¨çš„ä»£ç ï¼Œç¬¬ä¸€è¡ŒæŠŠ <code>self</code> å³ç§»äº† 8 ä½ã€‚è¿™ 8 ä½æ˜¯ä¿å­˜äº† tagged pointer çš„æŒ‡ç¤ºç¬¦ä»¥åŠå­—ç¬¦ä¸²é•¿åº¦ã€‚è€Œå³ç§»æ“ä½œåå¾—åˆ°çš„å€¼ï¼Œæˆ‘ä»¬å¯ä»¥æ¨æµ‹å®ƒå°±æ˜¯å…¶çœŸæ­£çš„æ•°æ®ã€‚å› æ­¤æˆ‘ä»¬æŠŠ <code>rbx</code> æ›¿æ¢ä¸º <code>stringData</code> æ¥è®©ä»£ç æ›´åŠ æ¸…æ™°å¯è¯»ä¸€ç‚¹ã€‚ä¸‹ä¸€è¡ŒæŠŠä¸€ä¸ªç±»ä¼¼æŸ¥æ‰¾è¡¨çš„ä¸œè¥¿èµ‹å€¼ç»™ <code>rcx</code>ï¼Œå› æ­¤æˆ‘ä»¬ä¹ŸæŠŠ <code>rcx</code> æ›¿æ¢æˆ <code>table</code>ã€‚æœ€åï¼Œ<code>rdx</code> æ‹¿åˆ°äº†å€¼çš„é•¿åº¦çš„ä¸€ä»½æ‹·è´ã€‚çœ‹èµ·æ¥å®ƒåé¢ä¼šä½œä¸ºå…‰æ ‡æ¥ä½¿ç”¨ï¼Œå› æ­¤æˆ‘ä»¬å†æŠŠ <code>rdx</code> æ›¿æ¢ä¸º <code>cursor</code>ã€‚ç°åœ¨æˆ‘ä»¬çš„ä»£ç æ˜¯è¿™æ ·çš„ï¼š</p><figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="keyword">unsigned</span> <span class="keyword">short</span> -[<span class="built_in">NSTaggedPointerString</span> characterAtIndex:](<span class="keyword">void</span> * <span class="keyword">self</span>, <span class="keyword">void</span> * _cmd, <span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="keyword">long</span> index) &#123;</span><br><span class="line">    length = <span class="keyword">self</span> &gt;&gt; <span class="number">0x4</span> &amp; <span class="number">0xf</span>;</span><br><span class="line">    <span class="keyword">if</span> (length &gt;= <span class="number">0x8</span>) &#123;</span><br><span class="line">            stringData = <span class="keyword">self</span> &gt;&gt; <span class="number">0x8</span>;</span><br><span class="line">            table = <span class="string">"eilotrm.apdnsIc ufkMShjTRxgC4013bDNvwyUL2O856P-B79AFKEWV_zGJ/HYX"</span>;</span><br><span class="line">            cursor = length;</span><br><span class="line">            <span class="keyword">if</span> (length &lt; <span class="number">0xa</span>) &#123;</span><br><span class="line">                    <span class="keyword">do</span> &#123;</span><br><span class="line">                            *(int8_t *)(rbp + cursor + <span class="number">0xffffffffffffffbf</span>) = *(int8_t *)((stringData &amp; <span class="number">0x3f</span>) + table);</span><br><span class="line">                            cursor = cursor - <span class="number">0x1</span>;</span><br><span class="line">                            stringData = stringData &gt;&gt; <span class="number">0x6</span>;</span><br><span class="line">                    &#125; <span class="keyword">while</span> (cursor != <span class="number">0x0</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">do</span> &#123;</span><br><span class="line">                            *(int8_t *)(rbp + cursor + <span class="number">0xffffffffffffffbf</span>) = *(int8_t *)((stringData &amp; <span class="number">0x1f</span>) + table);</span><br><span class="line">                            cursor = cursor - <span class="number">0x1</span>;</span><br><span class="line">                            stringData = stringData &gt;&gt; <span class="number">0x5</span>;</span><br><span class="line">                    &#125; <span class="keyword">while</span> (cursor != <span class="number">0x0</span>);</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (length &lt;= index) &#123;</span><br><span class="line">            rbx = r8;</span><br><span class="line">            ___CFExceptionProem(<span class="keyword">self</span>, _cmd);</span><br><span class="line">            [<span class="built_in">NSException</span> raise:<span class="string">@"NSRangeException"</span> format:<span class="string">@"%@: Index %lu out of bounds; string length %lu"</span>];</span><br><span class="line">            r8 = rbx;</span><br><span class="line">    &#125;</span><br><span class="line">    rax = *(int8_t *)(rbp + index + <span class="number">0xffffffffffffffc0</span>) &amp; <span class="number">0xff</span>;</span><br><span class="line">    <span class="keyword">return</span> rax;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç°åœ¨ï¼Œä»£ç åŸºæœ¬ä¸Šå·²ç»å®Œå…¨ç¬¦å·åŒ–äº†ï¼Œä¸è¿‡è¿˜æœ‰ä¸€ä¸ªå¯„å­˜å™¨åç§°ä»ç„¶å­˜åœ¨ï¼š<code>rbp</code>ã€‚å®ƒå®é™…ä¸Šæ˜¯å¸§æŒ‡é’ˆã€‚å› æ­¤ï¼Œç¼–è¯‘å™¨å…¶å®åšäº†ä¸€äº›å¾ˆ tricky çš„äº‹æƒ… â€”â€” ç›´æ¥é€šè¿‡å¸§æŒ‡é’ˆè¿›è¡Œäº†ç´¢å¼•æ“ä½œã€‚äºŒè¿›åˆ¶è¡¥ç ä¸­æœ‰ä¸€æ¡åŸç†ï¼š â€œæ‰€æœ‰ä¸œè¥¿æœ€ç»ˆéƒ½æ˜¯æ— ç¬¦å·æ•´å‹â€ ï¼Œå› æ­¤ä¸ºäº†è®©å˜é‡å‡å» 65ï¼Œæˆ‘ä»¬å¯ä»¥å°†å…¶ä¸ <code>0xffffffffffffffbf</code> å¸¸é‡ç›¸åŠ ã€‚æ¥ä¸‹æ¥ï¼Œå®ƒåˆå‡å»äº† 64ï¼ˆå€’æ•°ç¬¬äºŒè¡Œä»£ç ï¼‰ã€‚è¿™ä¸¤ä¸ªå€¼å¤§æ¦‚éƒ½æ˜¯åˆ†é…åœ¨æ ˆä¸Šçš„å±€éƒ¨å˜é‡ã€‚ä»”ç»†çœ‹çš„è¯ï¼Œä½ ä¼šå‘ç°è¿™æ®µä»£ç éå¸¸å¥‡æ€ª â€”â€” æœ‰ä¸€æ¡è·¯å¾„æ˜¯åªè¿›è¡Œäº†è¯»æ“ä½œè€Œæ²¡æœ‰è¿›è¡Œä»»ä½•çš„å†™æ“ä½œã€‚è¿™åˆ°åº•æ˜¯æ€ä¹ˆå›äº‹å‘¢ï¼Ÿ</p><p>åŸå› å…¶å®æ˜¯ Hopper å¿˜è®°äº†å¯¹å¦ä¸€ä¸ª if æ¡ä»¶åˆ¤æ–­çš„ <code>else</code> åˆ†æ”¯è¿›è¡Œåç¼–è¯‘ã€‚ç›¸å¯¹åº”çš„æ±‡ç¼–ä»£ç çœ‹èµ·æ¥æ˜¯è¿™æ ·çš„ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mov        rax, rdi</span><br><span class="line">shr        rax, 0x8</span><br><span class="line">mov        qword [ss:rbp+var_40], rax</span><br></pre></td></tr></table></figure><p><code>var_40</code> ä¾¿æ˜¯åœ¨ Hopper åç¼–è¯‘ç‰ˆæœ¬ä¸­çš„åç§»é‡ <code>64</code>ï¼ˆ<code>40</code> åˆšå¥½æ˜¯ <code>64</code> çš„åå…­è¿›åˆ¶è¡¨ç¤ºï¼‰ã€‚æˆ‘ä»¬æš‚ä¸”æŠŠè¿™ä¸ªä½ç½®çš„æŒ‡é’ˆç§°ä¸º <code>buffer</code>ã€‚è¿™æ ·ä¸€æ¥ï¼Œä¸Šé¢ä»£ç ä¸­é—æ¼åˆ†æ”¯çš„ C è¯­è¨€ä»£ç çœ‹èµ·æ¥æ˜¯è¿™æ ·çš„ï¼š</p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line">*(<span class="keyword">uint64_t</span> *)buffer = self &gt;&gt; <span class="number">8</span></span><br></pre></td></tr></table></figure><p>ç°åœ¨æŠŠè¿™æ®µä»£ç æ’å…¥åŸæœ¬çš„ä»£ç ä¸­ï¼Œå¹¶æ›¿æ¢æ‰å…¶ä»–ä½ç½®çš„ <code>rbp</code> ä¸º <code>buffer</code>ã€‚æœ€åï¼Œä¸ºäº†èƒ½æé†’è‡ªå·±ï¼Œæˆ‘ä»¬åœ¨å‡½æ•°å¼€å§‹çš„ä½ç½®å†è¡¥ä¸Šä¸€è¡Œ <code>buffer</code> çš„å£°æ˜è¯­å¥ï¼š</p><figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="keyword">unsigned</span> <span class="keyword">short</span> -[<span class="built_in">NSTaggedPointerString</span> characterAtIndex:](<span class="keyword">void</span> * <span class="keyword">self</span>, <span class="keyword">void</span> * _cmd, <span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="keyword">long</span> index) &#123;</span><br><span class="line">    int8_t buffer[<span class="number">11</span>];</span><br><span class="line">    length = <span class="keyword">self</span> &gt;&gt; <span class="number">0x4</span> &amp; <span class="number">0xf</span>;</span><br><span class="line">    <span class="keyword">if</span> (length &gt;= <span class="number">0x8</span>) &#123;</span><br><span class="line">            stringData = <span class="keyword">self</span> &gt;&gt; <span class="number">0x8</span>;</span><br><span class="line">            table = <span class="string">"eilotrm.apdnsIc ufkMShjTRxgC4013bDNvwyUL2O856P-B79AFKEWV_zGJ/HYX"</span>;</span><br><span class="line">            cursor = length;</span><br><span class="line">            <span class="keyword">if</span> (length &lt; <span class="number">0xa</span>) &#123;</span><br><span class="line">                    <span class="keyword">do</span> &#123;</span><br><span class="line">                            *(int8_t *)(buffer + cursor - <span class="number">1</span>) = *(int8_t *)((stringData &amp; <span class="number">0x3f</span>) + table);</span><br><span class="line">                            cursor = cursor - <span class="number">0x1</span>;</span><br><span class="line">                            stringData = stringData &gt;&gt; <span class="number">0x6</span>;</span><br><span class="line">                    &#125; <span class="keyword">while</span> (cursor != <span class="number">0x0</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">do</span> &#123;</span><br><span class="line">                            *(int8_t *)(buffer + cursor - <span class="number">1</span>) = *(int8_t *)((stringData &amp; <span class="number">0x1f</span>) + table);</span><br><span class="line">                            cursor = cursor - <span class="number">0x1</span>;</span><br><span class="line">                            stringData = stringData &gt;&gt; <span class="number">0x5</span>;</span><br><span class="line">                    &#125; <span class="keyword">while</span> (cursor != <span class="number">0x0</span>);</span><br><span class="line">            &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        *(uint64_t *)buffer = <span class="keyword">self</span> &gt;&gt; <span class="number">8</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (length &lt;= index) &#123;</span><br><span class="line">            rbx = r8;</span><br><span class="line">            ___CFExceptionProem(<span class="keyword">self</span>, _cmd);</span><br><span class="line">            [<span class="built_in">NSException</span> raise:<span class="string">@"NSRangeException"</span> format:<span class="string">@"%@: Index %lu out of bounds; string length %lu"</span>];</span><br><span class="line">            r8 = rbx;</span><br><span class="line">    &#125;</span><br><span class="line">    rax = *(int8_t *)(buffer + index) &amp; <span class="number">0xff</span>;</span><br><span class="line">    <span class="keyword">return</span> rax;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç°åœ¨ä»£ç çœ‹èµ·æ¥å¥½äº†å¾ˆå¤šã€‚ä¸è¿‡é‚£äº›ç–¯ç‹‚çš„æŒ‡é’ˆæ“ä½œè¯­å¥å®åœ¨æ˜¯å¤ªéš¾çœ‹æ‡‚äº†ï¼Œè€Œå®ƒä»¬ä»…ä»…æ˜¯ä¸€äº›æ•°ç»„çš„ç´¢å¼•æ“ä½œã€‚æˆ‘ä»¬æ¥ç®€åŒ–ä¸€ä¸‹ï¼š</p><figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="keyword">unsigned</span> <span class="keyword">short</span> -[<span class="built_in">NSTaggedPointerString</span> characterAtIndex:](<span class="keyword">void</span> * <span class="keyword">self</span>, <span class="keyword">void</span> * _cmd, <span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="keyword">long</span> index) &#123;</span><br><span class="line">     int8_t buffer[<span class="number">11</span>];</span><br><span class="line">     length = <span class="keyword">self</span> &gt;&gt; <span class="number">0x4</span> &amp; <span class="number">0xf</span>;</span><br><span class="line">     <span class="keyword">if</span> (length &gt;= <span class="number">0x8</span>) &#123;</span><br><span class="line">             stringData = <span class="keyword">self</span> &gt;&gt; <span class="number">0x8</span>;</span><br><span class="line">             table = <span class="string">"eilotrm.apdnsIc ufkMShjTRxgC4013bDNvwyUL2O856P-B79AFKEWV_zGJ/HYX"</span>;</span><br><span class="line">             cursor = length;</span><br><span class="line">             <span class="keyword">if</span> (length &lt; <span class="number">0xa</span>) &#123;</span><br><span class="line">                     <span class="keyword">do</span> &#123;</span><br><span class="line">                             buffer[cursor - <span class="number">1</span>] = table[stringData &amp; <span class="number">0x3f</span>];</span><br><span class="line">                             cursor = cursor - <span class="number">0x1</span>;</span><br><span class="line">                             stringData = stringData &gt;&gt; <span class="number">0x6</span>;</span><br><span class="line">                     &#125; <span class="keyword">while</span> (cursor != <span class="number">0x0</span>);</span><br><span class="line">             &#125;</span><br><span class="line">             <span class="keyword">else</span> &#123;</span><br><span class="line">                     <span class="keyword">do</span> &#123;</span><br><span class="line">                             buffer[cursor - <span class="number">1</span>] = table[stringData &amp; <span class="number">0x1f</span>];</span><br><span class="line">                             cursor = cursor - <span class="number">0x1</span>;</span><br><span class="line">                             stringData = stringData &gt;&gt; <span class="number">0x5</span>;</span><br><span class="line">                     &#125; <span class="keyword">while</span> (cursor != <span class="number">0x0</span>);</span><br><span class="line">             &#125;</span><br><span class="line">     &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">         *(uint64_t *)buffer = <span class="keyword">self</span> &gt;&gt; <span class="number">8</span>;</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">if</span> (length &lt;= index) &#123;</span><br><span class="line">             rbx = r8;</span><br><span class="line">             ___CFExceptionProem(<span class="keyword">self</span>, _cmd);</span><br><span class="line">             [<span class="built_in">NSException</span> raise:<span class="string">@"NSRangeException"</span> format:<span class="string">@"%@: Index %lu out of bounds; string length %lu"</span>];</span><br><span class="line">             r8 = rbx;</span><br><span class="line">     &#125;</span><br><span class="line">     rax = buffer[index];</span><br><span class="line">     <span class="keyword">return</span> rax;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p>ç°åœ¨ï¼Œæˆ‘ä»¬èƒ½çœ‹å‡ºäº›ç«¯å€ªäº†ã€‚</p><p>é¦–å…ˆå¯ä»¥çœ‹åˆ°åŸºäºé•¿åº¦çš„ä¸åŒï¼Œä¼šæœ‰ä¸‰ç§ä¸åŒçš„æƒ…å†µã€‚é•¿åº¦å°äº 8 çš„æƒ…å†µä¸‹ï¼Œä¼šæ‰§è¡Œåˆ°åˆšåˆšæˆ‘ä»¬è¡¥å……çš„é—æ¼åˆ†æ”¯ â€”â€” å•çº¯åœ°æŠŠ <code>self</code> çš„å€¼æŒ‰ä½ç§»åŠ¨åèµ‹ç»™ <code>buffer</code>ã€‚è¿™æ˜¯ç®€å• ASCII çš„æƒ…å†µã€‚åœ¨æ­¤æƒ…å†µä¸‹ï¼Œ<code>index</code> åªä½œä¸º <code>self</code> çš„ç´¢å¼•å€¼æ¥å–å‡ºç»™å®šå­—èŠ‚ï¼Œå¹¶éšåè¿”å›ç»™è°ƒç”¨æ–¹ã€‚ç”±äº ASCII å­—ç¬¦çš„å€¼åœ¨æŒ‡å®šèŒƒå›´å†…å¯ä»¥åŒ¹é… Unicode ç ä½ã€‚å› æ­¤ä¸éœ€è¦é¢å¤–çš„æ“ä½œä¾¿å¯ä»¥è¿”å›æ­£ç¡®ç»“æœã€‚æˆ‘ä»¬åœ¨ä¸Šæ–‡æ›¾çŒœæµ‹è¿™ç§æƒ…å†µä¸‹ï¼ˆé•¿åº¦å°äº 8ï¼‰ä¼šç›´æ¥å­˜æ”¾ ASCII ç ï¼Œè¿™ä¹ŸéªŒè¯äº†æˆ‘ä»¬çš„çŒœæƒ³ã€‚</p><p>é‚£ä¹ˆåœ¨é•¿åº¦å¤§äºæˆ–ç­‰äº 8 çš„æƒ…å†µä¸‹ä¼šæ€ä¹ˆæ ·å‘¢ï¼Ÿå¦‚æœå­—ç¬¦ä¸²é•¿åº¦ç­‰äº 8 æˆ–å¤§äº 8 ä¸”å°äº 10ï¼Œé‚£ä¹ˆä¼šæ‰§è¡Œä¸€æ®µå¾ªç¯ä»£ç ï¼šé¦–å…ˆå–å‡º <code>stringData</code> çš„æœ€ä½ 6 ä½ï¼Œç„¶åä½œä¸º <code>table</code> çš„ç´¢å¼•å¹¶å–å‡ºç›¸åº”çš„å€¼ï¼Œå†æ‹·è´åˆ° <code>buffer</code> ä¸­ã€‚æ¥ä¸‹æ¥ï¼Œä¼šæŠŠ <code>stringData</code> å³ç§» 6 ä½ç„¶åé‡å¤ä¸Šé¢çš„æ“ä½œç›´åˆ°éå†å®Œæ•´ä¸ªå­—ç¬¦ä¸²ã€‚è¿™æ®µä»£ç å…¶å®æ˜¯ä¸€ç§ 6 ä½ç¼–ç æ–¹å¼ â€”â€” é€šè¿‡åŸå§‹ 6 ä½æ•°æ®åœ¨ <code>table</code> ä¸­çš„ç´¢å¼•è¿›è¡Œç¼–ç ã€‚<code>buffer</code> ä¸­ä¼šæ„å»ºå‡ºä¸€ä¸ªä¸´æ—¶çš„å­—ç¬¦ä¸²ï¼Œç„¶åæœ€åçš„ç´¢å¼•æ“ä½œï¼ˆä¸Šé¢å‡½æ•°ä¸­å€’æ•°ç¬¬äºŒè¡Œï¼‰ä¼šå–å‡ºå…¶éœ€è¦çš„å­—ç¬¦ã€‚</p><p>å½“å¦‚æœé•¿åº¦å¤§äº 10 å‘¢ï¼Ÿå¯ä»¥çœ‹åˆ°å…¶ä»£ç å’Œé•¿åº¦åœ¨ 8 åˆ° 10 çš„æƒ…å†µä¸‹åŸºæœ¬ä¸€è‡´ï¼Œé™¤äº†ç°åœ¨ä¸€æ¬¡åªå¤„ç† 5 ä½è€Œä¸æ˜¯ 6 ä½æ•°æ®ã€‚è¿™æ˜¯ä¸€ç§æ›´åŠ ç´§å‡‘çš„ç¼–ç æ–¹å¼ï¼Œå¯ä»¥è®© tagged pointer å­—ç¬¦ä¸²æœ€å¤šèƒ½å¤Ÿä¿å­˜ 11 ä¸ªå­—ç¬¦ï¼Œä¸è¿‡å®ƒä½¿ç”¨çš„å­—æ¯è¡¨ä»…åŒ…å« 32 ä¸ªå€¼ï¼ˆä»…ä½¿ç”¨äº† <code>table</code> çš„å‰åŠéƒ¨åˆ†ï¼‰ã€‚</p><p>å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ° tagged pointer å­—ç¬¦ä¸²çš„ç»“æ„å¤§è‡´ä¸ºï¼š</p><ol><li>é•¿åº¦åœ¨ 0 åˆ° 7 èŒƒå›´å†…æ—¶ï¼Œç›´æ¥ä¿å­˜åŸå§‹çš„ 8 ä½å­—ç¬¦ã€‚</li><li>é•¿åº¦ä¸º 8 æˆ–è€… 9æ—¶ï¼Œ ä¿å­˜ 6 ä½ç¼–ç åçš„å­—ç¬¦ï¼Œç¼–ç ä½¿ç”¨çš„å­—æ¯è¡¨ä¸º <code>&quot;eilotrm.apdnsIc ufkMShjTRxgC4013bDNvwyUL2O856P-B79AFKEWV_zGJ/HYX&quot;</code>ã€‚ </li><li>é•¿åº¦å¤§äº 10 æ—¶ï¼Œä¿å­˜ 5 ä½ç¼–ç åçš„å­—ç¬¦ï¼Œç¼–ç ä½¿ç”¨çš„å­—æ¯è¡¨ä¸º <code>&quot;eilotrm.apdnsIc ufkMShjTRxgC4013&quot;</code>ã€‚ </li></ol><p>ç°åœ¨æˆ‘ä»¬æ¥å¯¹æ¯”ä¸€ä¸‹å‰é¢ç”Ÿæˆçš„æ•°æ®ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">0x0000000000006115 a NSTaggedPointerString</span><br><span class="line">0x0000000000626125 ab NSTaggedPointerString</span><br><span class="line">0x0000000063626135 abc NSTaggedPointerString</span><br><span class="line">0x0000006463626145 abcd NSTaggedPointerString</span><br><span class="line">0x0000656463626155 abcde NSTaggedPointerString</span><br><span class="line">0x0066656463626165 abcdef NSTaggedPointerString</span><br><span class="line">0x6766656463626175 abcdefg NSTaggedPointerString</span><br><span class="line">0x0022038a01169585 abcdefgh NSTaggedPointerString</span><br><span class="line">0x0880e28045a54195 abcdefghi NSTaggedPointerString</span><br><span class="line">0x00007fbad9512010 abcdefghij __NSCFString</span><br></pre></td></tr></table></figure><p><code>0x0022038a01169585</code> çš„äºŒè¿›åˆ¶è¡¨è¾¾å¼å»æ‰äº†å­—ç¬¦ä¸²åé¢çš„ 8 ä½ï¼Œå¹¶æŠŠå‰©ä½™çš„ä½åˆ†æˆäº† 6 ä½ä¸ºå•ä½çš„å—ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">001000 100000 001110 001010 000000 010001 011010 010101</span><br></pre></td></tr></table></figure><p>ä»¥è¿™äº›æ•°å€¼ä½œä¸º <code>table</code> çš„ç´¢å¼•ï¼Œæˆ‘ä»¬çš„ç¡®å¯ä»¥æ‹¼å‡º <code>&quot;abcdefgh&quot;</code>ã€‚åŒæ ·çš„ï¼Œ<code>0x0880e28045a54195</code> çš„äºŒè¿›åˆ¶è¡¨è¾¾å¼ä¹Ÿæœ‰ç±»ä¼¼çš„è§„åˆ™ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">001000 100000 001110 001010 000000 010001 011010 010101 000001</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°å®ƒä¸ä¸Šé¢çš„å­—ç¬¦ä¸²åŸºæœ¬ä¸€è‡´ï¼Œåªæ˜¯åœ¨æœ€åå¤šå‡ºäº†å­—ç¬¦ <code>i</code>ã€‚</p><p>ä½†æ˜¯åé¢çš„å­—ç¬¦ä¸²å´ä¸ç¬¦åˆæˆ‘ä»¬çš„é¢„æµ‹ã€‚åœ¨è¿™ä¹‹åï¼ŒæŒ‰ç†æ¥è¯´æœ¬åº”ä¼šåˆ‡æ¢ä¸º 5 ä½ç¼–ç æ–¹å¼è¿›è¡Œå­˜å‚¨ï¼Œä¸”åœ¨ä¸¤ä¸ªå­—ç¬¦ä¸²ä¹‹åæ‰ä¼šç»ˆæ­¢ã€‚ä½†äº‹å®å´æ˜¯ï¼Œåœ¨é•¿åº¦ç­‰äº 10 çš„æ—¶å€™ tagged pointer å­—ç¬¦ä¸²å°±å·²ç»åœæ­¢äº†å·¥ä½œï¼Œå¹¶è½¬ä¸ºåˆ›å»ºçœŸæ­£çš„å­—ç¬¦ä¸²å¯¹è±¡ï¼Œä¸ºä»€ä¹ˆä¼šè¿™æ ·ï¼Ÿ</p><p>åŸå› æ˜¯ 5 ä½ç¼–ç æ–¹å¼ä¸­ä½¿ç”¨çš„å­—æ¯è¡¨è¿‡äºå—é™ï¼Œå› æ­¤æ²¡æœ‰åŒ…å«å­—æ¯ <code>b</code>ï¼ç›¸å¯¹äº 5 ä½ç¼–ç æ–¹å¼ä½¿ç”¨çš„å­—æ¯è¡¨ä¸­ 32 ä¸ª â€œç¥åœ£â€ çš„å­—ç¬¦è€Œè¨€ï¼Œ<code>b</code> è¿™ä¸ªå­—æ¯çš„æ™®éç¨‹åº¦è‚¯å®šè¿˜ä¸å¤Ÿï¼Œä»¥è‡³äºæœªèƒ½å–å¾—å…¶ä¸­çš„ä¸€å¸­ä¹‹åœ°ã€‚æ—¢ç„¶å¦‚æ­¤ï¼Œæˆ‘ä»¬æ¢æˆä» <code>c</code> å¼€å§‹çš„å­—ç¬¦ä¸²å†å°è¯•ä¸€æ¬¡ï¼Œæ‰“å°ç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">0x0000000000006315 c NSTaggedPointerString</span><br><span class="line">0x0000000000646325 cd NSTaggedPointerString</span><br><span class="line">0x0000000065646335 cde NSTaggedPointerString</span><br><span class="line">0x0000006665646345 cdef NSTaggedPointerString</span><br><span class="line">0x0000676665646355 cdefg NSTaggedPointerString</span><br><span class="line">0x0068676665646365 cdefgh NSTaggedPointerString</span><br><span class="line">0x6968676665646375 cdefghi NSTaggedPointerString</span><br><span class="line">0x0038a01169505685 cdefghij NSTaggedPointerString</span><br><span class="line">0x0e28045a54159295 cdefghijk NSTaggedPointerString</span><br><span class="line">0x01ca047550da42a5 cdefghijkl NSTaggedPointerString</span><br><span class="line">0x39408eaa1b4846b5 cdefghijklm NSTaggedPointerString</span><br><span class="line">0x00007fbd6a511760 cdefghijklmn __NSCFString</span><br></pre></td></tr></table></figure><p>ç°åœ¨ï¼Œæˆ‘ä»¬è·å¾—äº†ä¸€ç›´åˆ°é•¿åº¦ä¸º 11 çš„æ‰€æœ‰ tagged pointer å­—ç¬¦ä¸²ã€‚æœ€åä¸¤ä¸ª tagged pointer å­—ç¬¦ä¸²çš„äºŒè¿›åˆ¶è¡¨ç¤ºå¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">01110 01010 00000 10001 11010 10101 00001 10110 10010 00010</span><br><span class="line">01110 01010 00000 10001 11010 10101 00001 10110 10010 00010 00110</span><br></pre></td></tr></table></figure><p>æ­£æ˜¯æˆ‘ä»¬é¢„æœŸçš„ 5 ä½ç¼–ç ã€‚</p><h2 id="æ„é€ -Tagged-Pointer-å­—ç¬¦ä¸²"><a href="#æ„é€ -Tagged-Pointer-å­—ç¬¦ä¸²" class="headerlink" title="æ„é€  Tagged Pointer å­—ç¬¦ä¸²"></a>æ„é€  Tagged Pointer å­—ç¬¦ä¸²</h2><p>æ—¢ç„¶æˆ‘ä»¬ç°åœ¨çŸ¥é“äº† tagged pointer å­—ç¬¦ä¸²æ˜¯å¦‚ä½•ç¼–ç çš„ï¼Œé‚£ä¹ˆæˆ‘å°±ä¸å†æ·±å…¥åœ°æ¢ç©¶å…¶æ„é€ æ–¹æ³•çš„å®ç°äº†ã€‚æ„é€ çš„ä»£ç åœ¨ä¸€ä¸ªåä¸º <code>__CFStringCreateImmutableFunnel3</code> çš„ç§æœ‰å‡½æ•°å†…ã€‚è¿™ä¸ªå·¨å¤§çš„å‡½æ•°åŒ…å«äº†æ‰€æœ‰å¯èƒ½çš„æƒ…å†µã€‚ä½ å¯ä»¥åœ¨ <a href="https://opensource.apple.com" target="_blank" rel="noopener">opensource.apple.com</a> ä¸­æä¾›çš„ CoreFoundation å¼€æºç‰ˆæœ¬ä¸­æ‰¾åˆ°æ­¤å‡½æ•°ï¼Œä¸è¿‡åˆ«é«˜å…´å¤ªæ—©ï¼šå¼€æºç‰ˆæœ¬å¹¶æ²¡æœ‰åŒ…å«å…³äº tagged pointer å­—ç¬¦ä¸²çš„ä»£ç å®ç°ã€‚</p><p>æ„é€  tagged pointer å­—ç¬¦ä¸²çš„ä»£ç å®é™…ä¸Šæ˜¯æˆ‘ä»¬ä¸Šé¢çœ‹åˆ°çš„ä»£ç çš„ç›¸åç‰ˆæœ¬ã€‚å¦‚æœ tagged pointer å­—ç¬¦ä¸²èƒ½å¤Ÿå®¹ä¸‹åŸå§‹å­—ç¬¦ä¸²çš„é•¿åº¦å’Œå†…å®¹ï¼Œé‚£ä¹ˆå°±ä¼šå¼€å§‹ä¸€ç‚¹ä¸€ç‚¹åœ°æ„é€  â€”â€” åŒ…å« ASCII å­—ç¬¦ã€6 ä½æˆ–è€… 5 ä½ç¼–ç çš„å­—ç¬¦ã€‚å…¶ä¸­ä¼šæœ‰ä¸€ä¸ªç›¸åçš„æŸ¥æ‰¾è¡¨ã€‚ä¸Šæ–‡ä»£ç ä¸­çœ‹åˆ°çš„å­—ç¬¦å¸¸é‡çš„æŸ¥æ‰¾è¡¨æ˜¯ä¸€ä¸ªåä¸º <code>sixBitToCharLookup</code> çš„å…¨å±€å˜é‡ï¼Œåœ¨ <code>Funnel3</code> å‡½æ•°ä¸­æœ‰ä¸€ä¸ªä¸ä¹‹ç›¸å¯¹åº”çš„ <code>sixBitToCharLookup</code> å˜é‡ã€‚</p><h2 id="å¥‡æ€ªçš„æŸ¥æ‰¾è¡¨"><a href="#å¥‡æ€ªçš„æŸ¥æ‰¾è¡¨" class="headerlink" title="å¥‡æ€ªçš„æŸ¥æ‰¾è¡¨"></a>å¥‡æ€ªçš„æŸ¥æ‰¾è¡¨</h2><p>å®Œæ•´çš„ 6 ä½ç¼–ç æŸ¥æ‰¾è¡¨å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">eilotrm.apdnsIc ufkMShjTRxgC4013bDNvwyUL2O856P-B79AFKEWV_zGJ/HYX</span><br></pre></td></tr></table></figure><p>å¯èƒ½å¤§å®¶éƒ½ä¼šå¾ˆè‡ªç„¶åœ°é—®ä¸€ä¸ªé—®é¢˜ï¼šä¸ºä»€ä¹ˆå®ƒçš„é¡ºåºå¦‚æ­¤å¥‡æ€ªï¼Ÿ</p><p>å› ä¸ºè¿™ä¸ªè¡¨åŒæ—¶æä¾›ç»™ 6 ä½ç¼–ç å’Œ 5 ä½ç¼–ç ä½¿ç”¨ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆå®ƒå’Œæ™®é€šçš„è‹±è¯­å­—æ¯è¡¨æœ‰åŒæ ·çš„é¡ºåºã€‚é‚£äº›ä½¿ç”¨é¢‘ç‡éå¸¸é«˜çš„å­—ç¬¦ä½äºè¡¨çš„å‰åŠæ®µï¼Œè€Œé‚£äº›ä½¿ç”¨é¢‘ç‡æ²¡é‚£ä¹ˆé«˜çš„å­—ç¬¦ä¸²å°±ä¼šæ”¾åœ¨ååŠæ®µã€‚è¿™åœ¨æœ€å¤§ç¨‹åº¦ä¸Šä¿è¯äº†ç¨é•¿çš„å­—ç¬¦ä¸²èƒ½å¤Ÿä½¿ç”¨ 5 ä½ç¼–ç ã€‚</p><p>è™½ç„¶å¦‚æ­¤ï¼Œå‡å¦‚æˆ‘ä»¬æŠŠæŸ¥æ‰¾è¡¨å¯¹åŠåˆ†ï¼Œæ¯ä¸€åŠä¸­çš„é¡ºåºä»¿ä½›æ˜¾å¾—æ— å…³ç´§è¦ã€‚å¯¹åŠåˆ†åçš„è¡¨æŒ‰ç†æ¥è¯´å¯ä»¥æŒ‰ç…§è‹±è¯­å­—æ¯è¡¨çš„é¡ºåºè¿›è¡Œæ’åºï¼Œä½†äº‹å®å´å¹¶éå¦‚æ­¤ã€‚</p><p>æŸ¥æ‰¾è¡¨å¼€å¤´ä½ç½®çš„å‡ ä¸ªå­—æ¯ä¼¼ä¹æ˜¯æŒ‰ç…§å…¶åœ¨è‹±è¯­ä¸­å‡ºç°çš„é¢‘ç‡æ’åºçš„ã€‚è‹±è¯­ä¸­æœ€å¸¸è§çš„å­—æ¯æ˜¯ Eï¼Œå…¶å®æ˜¯ Tï¼Œæ¥ä¸‹æ¥ä¾æ¬¡ä¸º Aã€Oã€Iã€N å’Œ Sã€‚E ç¡®å®ä½äºè¡¨çš„å¼€å¤´ï¼Œä¸”å‰©ä¸‹çš„å‡ ä¸ªå­—æ¯ä¹Ÿçš„ç¡®éƒ½ä½äºé è¿‘å¼€å¤´çš„ä½ç½®ã€‚çœ‹èµ·æ¥è¿™å¼ æŸ¥æ‰¾è¡¨çš„ç¡®æ˜¯æŒ‰ç…§ä½¿ç”¨é¢‘ç‡è¿›è¡Œæ’åºçš„ã€‚è‡³äºå…¶ä¸ºä»€ä¹ˆä½“ç°å‡ºå’Œè‹±è¯­çš„å·®å¼‚æ€§ï¼Œå¤§æ¦‚æ˜¯å› ä¸ºåœ¨ Cocoa åº”ç”¨ä¸­çš„çŸ­å­—ç¬¦ä¸²å¹¶ä¸æ˜¯éšæœºé€‰è‡ªè‹±æ–‡æ•£æ–‡ï¼Œè€Œæ˜¯ä¸€äº›è¾ƒä¸ºç‰¹åˆ«çš„è¯­è¨€ã€‚</p><p>æˆ‘çŒœæµ‹è‹¹æœåŸæœ¬æ‰“ç®—ä½¿ç”¨ä¸€ç§æ›´ä¸ºå·§å¦™çš„å˜é•¿ç¼–ç æ–¹å¼ï¼Œæˆ–è®¸ä¼šåŸºäºä¸€ç§ <a href="https://en.wikipedia.org/wiki/Huffman_coding" target="_blank" rel="noopener">Huffman ç¼–ç </a>ã€‚ä½†æœ€åå‘ç°å…¶å®ç°éš¾åº¦å¤ªå¤§ï¼Œæˆ–è€…æ€§ä»·æ¯”å¹¶æ²¡æœ‰æƒ³è±¡ä¸­é«˜ï¼Œç”šè‡³æ˜¯å› ä¸ºæ—¶é—´ä¸å…è®¸çš„åŸå› ã€‚å› æ­¤ä»–ä»¬å†³å®šé€€è€Œæ±‚å…¶æ¬¡ï¼Œä½¿ç”¨ä¸€ç§æ›´å®¹æ˜“å®ç°çš„ç‰ˆæœ¬ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬ä¸Šæ–‡ä¸­æ‰€çœ‹åˆ°çš„ç¼–ç æ–¹å¼ â€”â€” é’ˆå¯¹ä¸åŒé•¿åº¦çš„å­—ç¬¦ä¸²ä½¿ç”¨ä¸åŒçš„å®šé•¿ç¼–ç æ–¹å¼ï¼ˆæ¯ä¸ªå­—ç¬¦ 8 ä½ã€6 ä½æˆ– 5 ä½ï¼‰ã€‚è¿™ä¸ªå¥‡æ€ªçš„æŸ¥æ‰¾è¡¨ä¹Ÿè®¸æ˜¯åŸºäºè¢«é—å¼ƒçš„å˜é•¿ç¼–ç æ–¹å¼è€Œæ„å»ºçš„ï¼ŒåŒæ—¶ä¹Ÿä¾¿äºæ—¥åå†³å®šå†æ¬¡å¯ç”¨å˜é•¿ç¼–ç æ–¹å¼ã€‚è™½ç„¶è¿™äº›çº¯å±çŒœæµ‹ï¼Œä½†è‡³å°‘æˆ‘æ„Ÿè§‰äº‹å®ä¾¿æ˜¯å¦‚æ­¤ã€‚</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>Tagged pointer æ˜¯ä¸€ç§éå¸¸é…·çš„æŠ€æœ¯ã€‚è™½ç„¶åº”ç”¨åˆ°å­—ç¬¦ä¸²ä¸Šé¢å¹¶ä¸å¸¸è§ï¼Œä½†å¾ˆæ¸…æ¥šçš„æ˜¯ï¼Œè‹¹æœè‚¯å®šä»ä¸­å—ç›Šè‰¯å¤šï¼Œä¸ç„¶ä¹Ÿä¸ä¼šå¯¹å®ƒå€¾æ³¨å¦‚æ­¤å¤šç²¾åŠ›å’Œæƒ³æ³•ã€‚èƒ½å¤Ÿçœ‹åˆ°è¿™ä¸¤ç§æŠ€æœ¯èåˆåœ¨ä¸€èµ·çš„æ•ˆæœï¼Œä»¥åŠå®ƒä»¬å¦‚ä½•å¯¹æœ‰é™çš„å­˜å‚¨ç©ºé—´ç‰©å°½å…¶ç”¨ï¼Œå®åœ¨æ˜¯æœ‰è¶£è‡³æã€‚</p><blockquote><p>æœ¬æ–‡ç”± SwiftGG ç¿»è¯‘ç»„ç¿»è¯‘ï¼Œå·²ç»è·å¾—ä½œè€…ç¿»è¯‘æˆæƒï¼Œæœ€æ–°æ–‡ç« è¯·è®¿é—® <a href="http://swift.gg">http://swift.gg</a>ã€‚</p></blockquote>]]></content>
    
    <summary type="html">
    
      Tagged pointer æ˜¯ä¸€é¡¹ç”¨äºæé«˜æ€§èƒ½å¹¶å‡å°‘å†…å­˜ä½¿ç”¨çš„æœ‰è¶£æŠ€æœ¯ï¼Œæœ¬æ–‡æ¢è®¨äº† NSString ä¸­åº”ç”¨ tagged pointer çš„å®ç°åŸç†ã€‚
    
    </summary>
    
      <category term="Mike Ash" scheme="https://swift.gg/categories/Mike-Ash/"/>
    
    
      <category term="iOS å¼€å‘" scheme="https://swift.gg/tags/iOS-%E5%BC%80%E5%8F%91/"/>
    
      <category term="Objective-C" scheme="https://swift.gg/tags/Objective-C/"/>
    
  </entry>
  
  <entry>
    <title>æ‹“å±• Swift åº”ç”¨é¢†åŸŸ</title>
    <link href="https://swift.gg/2018/10/04/expanding-swifts-reach/"/>
    <id>https://swift.gg/2018/10/04/expanding-swifts-reach/</id>
    <published>2018-10-04T00:00:00.000Z</published>
    <updated>2019-02-18T08:52:03.568Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ä½œè€…ï¼šterhechteï¼Œ<a href="http://appventure.me/2018/05/03/expanding-swifts-reach/" target="_blank" rel="noopener">åŸæ–‡é“¾æ¥</a>ï¼ŒåŸæ–‡æ—¥æœŸï¼š2018-05-03<br>è¯‘è€…ï¼š<a href="https://github.com/Adolf-L" target="_blank" rel="noopener">BigLuo</a>ï¼›æ ¡å¯¹ï¼š<a href="https://github.com/Cee" target="_blank" rel="noopener">Cee</a>ï¼Œ<a href="http://numbbbbb.com/" target="_blank" rel="noopener">numbbbbb</a>ï¼›å®šç¨¿ï¼š<a href="http://forelax.space" target="_blank" rel="noopener">Forelax</a></p></blockquote><!--æ­¤å¤„å¼€å§‹æ­£æ–‡--><p>æˆ‘æƒ³å¤§å®¶åº”è¯¥éƒ½ä¼šåŒæ„ Swift æ˜¯ä¸€é—¨ä¼˜ç§€çš„è¯­è¨€ï¼Œå¾ˆå¥½çš„å¤„ç†äº†é‚£äº›ç®€å•ä¸å¤æ‚çš„é—®é¢˜ã€‚ç†è®ºä¸Šè®²ï¼Œå®ƒå°†ä¼šæˆä¸ºé‡è¦çš„ç¼–ç¨‹è¯­è¨€ä¹‹ä¸€ã€‚ç›®å‰ï¼ŒSwift çš„ä½¿ç”¨ä»…é™äºè‹¹æœå¼€å‘é¢†åŸŸï¼ˆå¤–åŠ å°‘é‡æœåŠ¡ç«¯ Swift ä»¥åŠè¿‘æœŸå®£å¸ƒçš„ <a href="https://www.tensorflow.org/community/swift" target="_blank" rel="noopener">Swift ç‰ˆæœ¬çš„ Tensorflow</a>ï¼‰ã€‚</p><blockquote><p>â€œMy goal for Swift has always been and still is total world domination. Itâ€™s a modest goalâ€</p><p>â€œæˆ‘ä¸€ç›´æœŸå¾…ç€ Swift ç»Ÿæ²»ä¸–ç•Œï¼Œè¿™æ˜¯ä¸€ä¸ªè°¦è™šçš„ç›®æ ‡ã€‚â€</p><ul><li>Chris Lattner</li></ul></blockquote><p>éšç€æ–°çš„æ³›å‹ç‰¹æ€§åœ¨ Swift 4.1 ä¸­æ¨å‡ºä»¥åŠ <a href="https://swift.org/abi-stability/" target="_blank" rel="noopener">ABI åœ¨ Swift 5 ä¸­é€æ¸ç¨³å®š</a>ï¼ŒSwift ä¼¼ä¹é€æ¸å…·å¤‡äº†è·³å‡ºè‹¹æœå¼€å‘é¢†åŸŸçš„æ¡ä»¶ã€‚æœ¬æ–‡æˆ‘ä¼šè®¨è®ºä¸€ä¸ªæˆ‘çŸ¥é“çš„é—®é¢˜ï¼Œå®ƒé˜»ç¢ç€ Swift å¹¿æ³›çš„åº”ç”¨ï¼Œå‡†ç¡®çš„è®²ï¼Œä¸å…¶å®ƒé—®é¢˜ä¸€æ ·ï¼Œè¯¥é—®é¢˜ä¹Ÿæ­£åœ¨è¢«å¼€å‘ç¤¾åŒºç€æ‰‹è§£å†³ã€‚</p><a id="more"></a><p>æˆ‘ä¼šç®€å•ä»‹ç» Swift åœ¨è¿™ä¸ªé¢†åŸŸçš„<strong>ç«äº‰åŠ›</strong>ã€‚å°±åƒ C++ ä¸€æ ·ï¼Œå…¶å®ƒç¼–ç¨‹è¯­è¨€ä¹Ÿæ¸´æœ›æˆä¸ºä¸€ä¸ªè·¨å¹³å°çš„é€šç”¨çš„è¯­è¨€ã€‚é€šè¿‡æ¯”è¾ƒ Swift å’Œå…¶ä»–è¯­è¨€å¤„ç†ç›¸åŒé—®é¢˜ä¸Šçš„æ–¹å¼ï¼Œå¯ä»¥è®©æˆ‘ä»¬è¯¥å¦‚ä½•æ”¹è¿› Swiftã€‚</p><h2 id="ç³»ç»ŸåŒ…ç®¡ç†"><a href="#ç³»ç»ŸåŒ…ç®¡ç†" class="headerlink" title="ç³»ç»ŸåŒ…ç®¡ç†"></a>ç³»ç»ŸåŒ…ç®¡ç†</h2><p>Swift æ‹¥æœ‰ä¸€ä¸ªéå¸¸å¥åº·çš„å¼€æºç¤¾åŒºï¼Œæ‹¥æœ‰å¤§é‡æ°å‡ºã€ç²¾å¿ƒç¼–å†™ä¸”å®ç”¨çš„å¼€å‘æ¡†æ¶ã€‚ä½†æ˜¯ï¼Œè¿™äº›å¼€å‘æ¡†æ¶å¤šä¸º iOSï¼ˆmacOS ç›¸å¯¹å°‘å¾ˆå¤šï¼‰UI åº“ï¼Œè¿™è®© Swift å—é™åœ¨è¿™ä¸ªå¼€å‘é¢†åŸŸã€‚è¿™é‡Œæœ‰å¾ˆå¤š UI åŠ¨ç”»åº“ã€UI å¸ƒå±€åº“ã€å«æœ‰ UI å…ƒç´ çš„æ¡†æ¶ã€UI åä½œåº“å’Œ JSON è§£æåº“ã€‚å› ä¸ºç¼ºå°‘ UIKit/AppKitï¼Œå®ƒä»¬ä¸­çš„å¤§éƒ¨åˆ†æ— æ³•åœ¨ Linux ä¸Šè¿è¡Œã€‚å½“ç„¶ï¼Œè¿™é‡Œä¹Ÿæœ‰ä¸€äº›ç±»ä¼¼äº <a href="https://vapor.codes/" target="_blank" rel="noopener">Vapor</a> æˆ– <a href="http://kitura.io/" target="_blank" rel="noopener">Kitura</a> çš„ Web æ¡†æ¶ï¼Œè‡´åŠ›äºåœ¨ Web å¼€å‘é¢†åŸŸæ¨å¹¿ä½¿ç”¨ Swift è¯­è¨€ã€‚</p><p>ç„¶è€Œï¼Œä¸å¤§ä¼—è§‚ç‚¹ä¸åŒï¼Œåœ¨ Linux å¹³å°ä¸Šï¼Œå¾ˆå¤šå…¬å¸ä¸ä»…åœ¨ Web æœåŠ¡ç«¯ï¼Œä¹Ÿåœ¨ Linux çš„å…¶å®ƒæ–¹é¢åšäº†å¤§é‡çš„å·¥ä½œã€‚å…ˆç®€å•ä¸¾ä¸ªä¾‹å­ï¼Œæœ‰äº›ç¼–ç¨‹è¯­è¨€å¯ä»¥ç®¡ç†ç³»ç»Ÿï¼ŒæŒæ§ç³»ç»Ÿæƒé™ï¼Œå¹¶ä¸”æä¾›ç›¸åº”çš„å¼€å‘å·¥å…·å’Œåº“ã€‚è¿™äº›å†…å®¹è™½ç„¶å’Œ iOS æˆ–è€… macOS åº”ç”¨å¼€å‘æ²¡æœ‰ç›¸å…³è”ï¼Œä½†æ˜¯å¯¹äºç³»ç»Ÿæˆ–è€… Web å¼€å‘æ¥è¯´æå…¶é‡è¦ã€‚æ¯”å¦‚ï¼Œæ•°æ®åº“æƒé™ã€ç³»ç»Ÿæ–‡ä»¶ç®¡ç†ã€è¿›ç¨‹ç®¡ç†ã€æ—¥å¿—åˆ†æä¸æ”¶é›†ã€å®¹å™¨ç®¡ç†ã€éƒ¨ç½²å·¥å…·ã€ç”šè‡³åŒºå—é“¾å·¥å…·ã€‚</p><p>éšç€ Swift 4.1 çš„å‘å¸ƒï¼Œåœ¨ <a href="https://news.ycombinator.com/item?id=16710895" target="_blank" rel="noopener">Hacker News ä¸Šæœ‰ä¸€ä¸ªè®¨è®ºè¿™é—¨è¯­è¨€çš„å¸–å­</a>ã€‚æˆ‘å®Œæ•´é€šè¯»å¤šæ¬¡åï¼Œè§‰å¾—å›å¤å¾ˆæœ‰è¶£ã€‚è®©æˆ‘æ„Ÿè§¦æœ€æ·±çš„æ˜¯ä¸‹é¢çš„è¯„è®ºï¼š</p><blockquote><p>â€œç›¸æ¯” Go å’Œ Rust åœ¨ç³»ç»Ÿæ”¯æŒå’Œåº“çš„é‡çº§æ–¹é¢ï¼ŒSwift çš„ç³»åˆ—åº“åªæœ‰ä¸€å°ç‚¹å„¿â€¦â€¦å¦‚æœæˆ‘ä»¬åˆ—å‡ºå…¶å®ƒç¼–ç¨‹è¯­è¨€åœ¨å·²å‘å¸ƒçš„åº”ç”¨ã€æ•°æ®åº“åç«¯æ–¹é¢åº“çš„è´¡çŒ®ï¼ŒSwift çš„æ•°é‡åŸºæœ¬å¯ä»¥å¿½ç•¥ä¸è®¡â€</p></blockquote><p>è®©æˆ‘ä»¬æ¥çœ‹çœ‹è¿™äº›ç«äº‰å¯¹æ‰‹ã€‚</p><h2 id="ç«äº‰è€…"><a href="#ç«äº‰è€…" class="headerlink" title="ç«äº‰è€…"></a>ç«äº‰è€…</h2><p>åœ¨æœ€è¿‘å‡ å¹´ï¼Œç¼–ç¨‹è¯­è¨€é¢†åŸŸå‡ºç°äº†å‡ ä¸ªæ–°çš„æœ‰åŠ›çš„ç«äº‰è€…ã€‚å½“ç„¶ï¼Œä½ ä¹Ÿè®¸å¹¶ä¸åŒæ„è¿™äº›è¯­è¨€æ˜¯ Swift çš„åˆæ ¼ç«äº‰è€…ã€‚è¿™é‡Œä»…æ ¹æ®æˆ‘ä¸ªäººçš„æ„Ÿè§‰åˆ—ä¸¾å‡ºå‡ ä¸ªç¼–ç¨‹è¯­è¨€ï¼Œæ’åä¸åˆ†å…ˆåã€‚</p><p>è¿™äº›çœ‹æ³•å¯èƒ½å¹¶ä¸å‡†ç¡®ã€‚è¯·ä¸è¦å› ä¸ºä½ æ˜¯æŸä¸ªè¯­è¨€çš„ç²‰ä¸ï¼Œå¹¶è®¤ä¸ºæˆ‘çš„è¯´æ³•å­˜åœ¨é”™è¯¯ï¼Œå°±æŠŠä»–ä»¬åˆ†äº«åˆ° Twitterã€‚æˆ‘åªæ˜¯ä¸€ä¸ªæœ‰ç€æŸäº›è§‚ç‚¹çš„æ™®é€šäººï¼Œè€Œè¿™äº›è§‚ç‚¹ç¡®å®å«æœ‰ä¸€äº›é”™è¯¯ã€‚ç›¸åï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™äº›ç²¾åŠ›æ¥è¿½é—®é—®é¢˜åŸç”±ï¼Œå¹¶æ”¹å–„æˆ–è§£å†³é—®é¢˜æœ¬èº«ã€‚</p><h3 id="Go"><a href="#Go" class="headerlink" title="Go"></a>Go</h3><p>Go çš„å‘å¸ƒæ—¶é—´æ¯” Swift æ—©å¾ˆå¤šï¼Œå®ƒå¤šç”¨äºå¼€å‘ç³»ç»Ÿå·¥å…·ï¼Œå´å¾ˆå°‘åœ¨å›¾å½¢ç•Œé¢ä¸­ä½¿ç”¨ã€‚Go ä¸æ”¯æŒç°ä»£è¯­è¨€ç‰¹æ€§ï¼Œå¦‚æ ‡ç­¾è”åˆã€æ³›å‹ï¼Œæˆ–å‡½æ•°å¼ç¼–ç¨‹ã€‚ä½†å®ƒæ˜“ä¸Šæ‰‹ï¼Œé€Ÿåº¦å¿«ï¼Œå¹¶ä½¿ç”¨äº†åƒåœ¾å›æ”¶å™¨ï¼Œç”Ÿæˆçš„äºŒè¿›åˆ¶æ–‡ä»¶ä½¿å¾—å…¶å†…å­˜æ¶ˆè€—éå¸¸ä½ã€‚å½“ç„¶ï¼Œåƒåœ¾å›æ”¶å™¨ä¹Ÿä½¿å¾— Go åœ¨åµŒå…¥å¼å¼€å‘å’Œä½¿ç”¨ Webassembly å˜å¾—æœ‰ç‚¹æ£˜æ‰‹ã€‚</p><p>Go è‰¯å¥½çš„æ€§èƒ½ï¼Œè¯­è¨€çš„ç®€å•æ€§å’Œä½å†…å­˜å ç”¨ç‡å‚¬ç”Ÿå‡ºäº†å¤§é‡çš„ç³»ç»Ÿå·¥å…·å’Œåº“ã€‚å¦‚ï¼šGrafanaã€Kubernetesã€CoreOS-etcdã€Go-Ethereumã€CockroachDBã€Hubã€Terraform ç­‰ç­‰ã€‚<a href="https://github.com/avelino/awesome-go" target="_blank" rel="noopener">é€šè¿‡è¿™ä¸ªåˆ—è¡¨ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸€ä¸ªé—®é¢˜çš„å¤šç§è§£æ³•</a>ã€‚</p><p>ç®€è¨€ä¹‹ï¼Œå¦‚æœä½ æƒ³åšåŸºäºç³»ç»Ÿå±‚é¢çš„å¼€å‘ï¼Œä½ èƒ½æ‰¾åˆ°å‡ ä¹æ‰€æœ‰ä½ æƒ³è¦çš„ä¾èµ–åŒ…ã€‚</p><h3 id="Kotlin"><a href="#Kotlin" class="headerlink" title="Kotlin"></a>Kotlin</h3><p>Kotlin åƒæ˜¯ Android ç‰ˆæœ¬ä¸‹çš„ Swiftï¼Œä½†å…¶åº•å±‚å´å®Œå…¨ä¸åŒã€‚åŸºäº JVM çš„ Kotlin ä½¿å¾—å®ƒå¿…é¡»å¤§é‡ä½¿ç”¨å¼•ç”¨ç±»å‹ï¼Œå°±åƒ Go çš„åƒåœ¾å›æ”¶å™¨ä½¿å…¶åœ¨åµŒå…¥å¼ç³»ç»Ÿçš„å¼€å‘æˆä¸ºä¸€ä¸ªæŒ‘æˆ˜ã€‚ç„¶è€Œï¼Œ<a href="https://kotlinlang.org/docs/reference/native-overview.html" target="_blank" rel="noopener">Kotlin-Native çš„å‡ºç°è®©å®ƒåœ¨æœªæ¥æœ‰äº†æ›´å¤šçš„å¯èƒ½æ€§</a>ã€‚Kotlin-Native æ˜¯åŸºäº LLVM æ„å»ºçš„ï¼Œæ”¯æŒåµŒå…¥å¼å¹³å°å¼€å‘ã€Webassembly ç­‰ã€‚Kotlin ä¹Ÿèƒ½è¢«ç¼–è¯‘æˆ Javascriptï¼ŒKotlin-Native ç”šè‡³å¯ç”¨äºæ„å»º iOS åº”ç”¨çš„æ¡†æ¶ã€‚</p><p>Kotlin ä¹Ÿå¯èƒ½ä¼šæˆä¸ºæœªæ¥çš„ä¸€ä¸ªä¸»æµè¯­è¨€ï¼Œä½†å’Œæœ‰ç€ç›¸åŒé—®é¢˜çš„ Swift ä¸€æ ·ï¼Œå…¶å‘å±•é‡åˆ°äº†ç±»ä¼¼çš„é˜»ç¢ã€‚å‡ ä¹æ‰€æœ‰å¯ç”¨çš„å¼€æºåº“é›†ä¸­åœ¨ Android å¼€å‘é¢†åŸŸã€‚è€Œ Kotlin-Native è§£å†³çš„æ˜¯ä¸€ä¸ªçº¯ç²¹ JVM è¯­è¨€æ‰€é¢ä¸´çš„é—®é¢˜ã€‚æˆ‘ä¸çŸ¥é“ä¸€ä¸ªæ˜“äºæ‰§è¡Œä¸”è½»é‡çº§çš„ Kotlin-Native è¦å¦‚ä½•å®ç°ï¼ˆç›¸æ¯”äº C++ æˆ– Swiftï¼Œå°¤å…¶æ˜¯åœ¨åµŒå…¥å¼å¼€å‘ã€å¤æ‚ç³»ç»Ÿå¼€å‘ã€æˆ– Webassemblyï¼‰ã€‚</p><h3 id="Rust"><a href="#Rust" class="headerlink" title="Rust"></a>Rust</h3><p>Rust æ˜¯ä¸€ä¸ªæœ‰è¶£çš„è¯­è¨€ã€‚äº‹å®ä¸Šå®ƒæ˜¯å¦‚æ­¤çš„æœ‰è¶£ï¼Œæˆ‘èŠ±äº†å‡ ä¸ªæœˆçš„æ—¶é—´æ…¢æ…¢çš„å­¦ä¹ å®ƒã€‚è¿™é—¨è¯­è¨€çš„å¾ˆå¤šæ–¹é¢ä¸ Swift ç›¸ä¼¼ï¼Œä½†æ¯” Swift æ›´éš¾ï¼ˆè¿™é‡Œæˆ‘ä»¬æš‚ä¸åšè®¨è®ºï¼Œè¯¥éƒ¨åˆ†å†…å®¹å°†ä»¥ä¸»é¢˜çš„å½¢å¼å‘å¸ƒåœ¨åšå®¢ï¼‰ã€‚ä¼¼ä¹è¿™ä¸¤ç§è¯­è¨€ä¸€å¼€å§‹å°±æ˜¯é‡‡ç”¨å®Œå…¨ç›¸åçš„è®¾è®¡æ€è·¯ï¼›Swift ä½œä¸ºä¸€ä¸ªæ˜“å­¦çš„è¯­è¨€èµ·åˆæ˜¯ä¸€äº›å®¹æ˜“ä¸Šæ‰‹çš„ç‰¹æ€§ï¼Œæ…¢æ…¢çš„æ·»åŠ å¤æ‚çš„ç‰¹æ€§ã€‚Rust èµ·åˆä½œä¸ºä¸€é—¨å¤æ‚çš„è¯­è¨€ï¼Œå®ƒæ­£åœ¨æ…¢æ…¢çš„å¢æ·»ä¸€äº›æ›´ç®€å•çš„æŠ½è±¡å¯¹è±¡æˆ–æ›´å¥½çš„é”™è¯¯è°ƒè¯•ä¿¡æ¯æ¥è®©åˆå­¦è€…å®¹æ˜“ä¸Šæ‰‹ã€‚ä¸¤ç§è¯­è¨€è¯­æ³•ç±»ä¼¼ï¼Œè¿™ç‚¹æˆ‘å¹¶ä¸æƒŠè®¶ï¼Œç›´åˆ°æœªæ¥çš„çªç„¶æŸå¤©ï¼Œæˆ‘æ„è¯†åˆ°ä¸¤é—¨è¯­è¨€åœ¨æŸäº›ç®€å•å’Œå¤æ‚ç‰¹æ€§ä¸Šæœ‰ç€é«˜åº¦çš„ç›¸ä¼¼æ€§ã€‚ç„¶è€Œï¼Œç›®å‰è€Œè¨€ï¼Œåœ¨ä½ ç»å†ä¸€æ®µå¤æ‚å­¦ä¹ ä½“éªŒçš„åï¼Œä¾¿ä¼šå‘ç° Rust èƒŒåæœ‰æä¾›äº†ä¸€äº›éå¸¸è¯±äººçš„ç‰¹æ€§ã€‚</p><p>ç›¸å¯¹äº Swiftï¼ŒRust æä¾›äº†æ›´å¥½çš„è·¨å¹³å°ç‰¹æ€§å’Œä¸€ä¸ªè™½éš¾äºå¤„ç†ä½†æ›´é«˜æ•ˆçš„å†…å­˜ç®¡ç†ç­–ç•¥ï¼ˆæ¯”å¦‚åœ¨å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸå’Œæ‰€æœ‰æƒæ–¹é¢ï¼‰ï¼Œ<a href="https://github.com/apple/swift/blob/master/docs/OwnershipManifesto.md" target="_blank" rel="noopener">å¹¸è¿çš„æ˜¯ï¼ŒRust çš„ä¸€éƒ¨åˆ†å†…å­˜ç®¡ç†çš„ä¼˜ç‚¹æœªæ¥ä¹Ÿä¼šåœ¨ Swift ä¸Šå‡ºç°</a>ï¼ŒåŒæ—¶å®ƒä¹Ÿæ”¯æŒ <a href="https://rust-lang-nursery.github.io/rust-wasm/" target="_blank" rel="noopener">Webassembly</a>ï¼ˆä½ å¯ä»¥ç”¨ Rust å†™ä¸€ä¸ªå‰ç«¯ Appï¼‰ï¼Œä¹Ÿæä¾›äº†å¾ˆå¥½çš„åŸºç¡€åº“è®©å¼€å‘è€…èƒ½å¤Ÿå¿«é€Ÿçš„æ„å»ºæ–°é¡¹ç›®ï¼Œè™½ç„¶å®ƒæ²¡æœ‰æä¾›åƒ Go ä¸€æ ·æ•°é‡çº§çš„é«˜è´¨é‡é¡¹ç›®ï¼Œä½†å®ƒä¹Ÿæä¾›äº†ä¸€äº›æœ‰æ½œåŠ›çš„é¡¹ç›®ï¼ˆCoreUtilsï¼ŒRedoxOSï¼ŒTikVï¼ŒVaggaï¼ŒServoï¼ŒParityï¼‰ã€‚ä½†æ›´é‡è¦çš„ï¼Œç°åœ¨å·²ç»æœ‰å¤§é‡çš„ Rust ç¬¬ä¸‰æ–¹åº“ä¾›ä½ é€‰æ‹©ã€‚<a href="https://github.com/rust-unofficial/awesome-rust" target="_blank" rel="noopener">ä½ å¯ä»¥æ¥çœ‹çœ‹çœ‹ä¸‹è¿™ä¸ªåˆ—è¡¨ã€‚</a></p><h3 id="å…¶ä»–è¯­è¨€"><a href="#å…¶ä»–è¯­è¨€" class="headerlink" title="å…¶ä»–è¯­è¨€"></a>å…¶ä»–è¯­è¨€</h3><p>è¿™é‡Œè¿˜æœ‰åƒ Dï¼ŒNimã€Chrystalã€Elixirã€TypeScript ç­‰è¯­è¨€ï¼Œå½“ç„¶ä¹ŸåŒ…æ‹¬ C++ è‡ªèº«ã€‚</p><h2 id="æˆ‘ä»¬çœ‹åˆ°äº†ä»€ä¹ˆ"><a href="#æˆ‘ä»¬çœ‹åˆ°äº†ä»€ä¹ˆ" class="headerlink" title="æˆ‘ä»¬çœ‹åˆ°äº†ä»€ä¹ˆ"></a>æˆ‘ä»¬çœ‹åˆ°äº†ä»€ä¹ˆ</h2><p>ç›®å‰ Swift åœ¨ç³»ç»ŸåŒ…ç®¡ç†é¢†åŸŸæœ‰çŸ­æ¿ï¼Œè¿™ä¹Ÿæ˜¯ä¸€ä¸ªå…ˆæœ‰é¸¡è¿˜æœ‰å…ˆæœ‰è›‹çš„é—®é¢˜ã€‚</p><blockquote><p>â€œå› ä¸ºæ²¡æœ‰è¶³å¤Ÿå¤šçš„ç³»ç»ŸåŒ…ï¼Œå¯¼è‡´é‚£äº›å¯¹ Swift æ„Ÿå…´è¶£çš„å¼€å‘è€…åœ¨å¼€å‘ç®€å• Demo åº”ç”¨æ—¶æ•°æ®åº“å¤„ç†ä¸æ–¹ä¾¿ï¼Œä»è€Œå¯¹ Swift å¤±å»å…´è¶£ï¼Œå¯¹ Swift å¤±å»å…´è¶£çš„å¼€å‘è€…æ›´ä¸æ„¿æ„å»æ”¹å–„åŒ…ç®¡ç†äº†ã€‚â€</p></blockquote><p>å¯¹æˆ‘è€Œè¨€ï¼Œæˆ‘ä»¬éœ€è¦æ”¹è¿›æˆ‘ä»¬çš„ç³»ç»ŸåŒ…/åº“ã€‚å¦‚æœæˆ‘ä»¬èƒ½ç”¨ Swift å†™å‡º Kubernets ä¹‹ç±»çš„ä¸œè¥¿ï¼Œé‚£ä¸€å®šå¾ˆæ£’ã€‚ä¸ºäº†å®ç°è¿™ä¸ªé¡¹ç›®ï¼Œæˆ‘ä»¬éœ€è¦ä¸€å¥—å¥½çš„åŸºç¡€åº“ç”¨äºä¸€èˆ¬æ€§çš„ç³»ç»Ÿå¼€å‘ã€‚ä¸‹é¢æˆ‘åˆ—å‡ºäº†åŸºç¡€çš„åŠŸèƒ½åº“å’Œç›¸å…³ä¸‰æ–¹æœåŠ¡ï¼ˆæ­¤å¤–ï¼Œä¸‹é¢åˆ—å‡ºçš„åŠŸèƒ½ï¼Œå·²ç»å­˜åœ¨éƒ¨åˆ†ï¼Œä¸éœ€è¦æˆ‘ä»¬é‡å¤é€ è½®å­ï¼‰ã€‚</p><ul><li>è®¤è¯</li><li>ç¼“å­˜</li><li>å¹¶å‘</li><li>äº‘æœåŠ¡</li><li>å‘½ä»¤è¡Œå‚æ•°è§£æ</li><li>å‘½ä»¤è¡Œ UI</li><li>å‘½ä»¤è¡Œç¼–è¾‘å™¨</li><li>å‹ç¼©</li><li>è®¡ç®—ï¼ˆä¾‹å¦‚ï¼šBLASï¼‰</li><li>åŠ å¯†</li><li>æ•°æ®åº“</li><li>æ•°æ®å¤„ç†</li><li>æ•°æ®ç»“æ„</li><li>æ•°æ®å¯è§†åŒ–</li><li>æ—¥æœŸå’Œæ—¶é—´</li><li>åˆ†å¸ƒå¼ç³»ç»Ÿ</li><li>ç”µå­é‚®ä»¶</li><li>ç¼–ç å’Œè§£ç </li><li>æ–‡ä»¶ç³»ç»Ÿ</li><li>å›¾åƒå¤„ç†</li><li>æœºå™¨å­¦ä¹ </li><li>è§£æ</li><li>æ–‡æœ¬å¤„ç†</li><li>è™šæ‹ŸåŒ–</li></ul><p>æˆ‘è®¤ä¸ºï¼Œè®© Swift æˆä¸ºä¸€é—¨é€šç”¨çš„è¯­è¨€ï¼Œèƒ½å¤Ÿåœ¨éè‹¹æœæ“ä½œç³»ç»Ÿä¸Šè¿è¡Œï¼ŒSwift éœ€è¦æä¾›ä¸€ä¸ªå¥å£®çš„ã€è·¨å¹³å°çš„åŒ…ç®¡ç†ç³»ç»Ÿã€‚</p><h2 id="ä½ èƒ½åšäº›ä»€ä¹ˆï¼Ÿ"><a href="#ä½ èƒ½åšäº›ä»€ä¹ˆï¼Ÿ" class="headerlink" title="ä½ èƒ½åšäº›ä»€ä¹ˆï¼Ÿ"></a>ä½ èƒ½åšäº›ä»€ä¹ˆï¼Ÿ</h2><h3 id="å†™åº“"><a href="#å†™åº“" class="headerlink" title="å†™åº“"></a>å†™åº“</h3><p>åœ¨ä½ å†³å®šå†™ JSON è§£æå™¨ï¼ŒåŠ¨ç”»åº“ã€è‡ªå®šä¹‰çš„å¼€å…³æŒ‰é’®ï¼Œæˆ–è€…æŠ½è±¡çš„é›†åˆè§†å›¾/è¡¨æ ¼è§†å›¾çš„ä»£ç ä¹‹å‰ï¼Œè€ƒè™‘å†™ä¸€ä¸ªè·¨å¹³å°çš„ç³»ç»Ÿåº“ã€‚å¦‚æœä½ ä¸çŸ¥é“æ€ä¹ˆåšï¼Œä½ å¯ä»¥å»çœ‹çœ‹ Go å’Œ Rust æä¾›çš„é‚£äº›å·²æœ‰çš„åº“ã€‚</p><h3 id="é‡å†™ç°æœ‰-C-åº“"><a href="#é‡å†™ç°æœ‰-C-åº“" class="headerlink" title="é‡å†™ç°æœ‰ C åº“"></a>é‡å†™ç°æœ‰ C åº“</h3><p>å¯¹äºæŸäº›åœºæ™¯ï¼ŒSwift çš„ç¡®æä¾›äº†åº“ï¼Œä½†é‚£äº›åº“åº•å±‚ä»ç„¶æ˜¯ C çš„å®ç°ã€‚è™½ç„¶é‚£æ ·ä¹Ÿæå®šäº†é—®é¢˜ï¼Œä½†åœ¨æ··åˆçš„è¿‡ç¨‹ä¸­å¼•å…¥äº† C è¿™é—¨ä¸å®‰å…¨çš„è¯­è¨€ï¼Œåœ¨é‚£äº›è¦æ±‚ç»å¯¹å®‰å…¨çš„æ‰§è¡Œæ¡ˆä¾‹ä¸­ï¼Œæˆ‘ä»¬å¿…é¡»è¦ä¸ºæ­¤åšç‰¹åˆ«å¤„ç†ã€‚å½“ç„¶ï¼Œå¦‚æœä½ æƒ³ä¸åˆ°ä½ æƒ³è¦å†™ä»€ä¹ˆï¼Œå¯ä»¥ç”¨çº¯ Swift å®ç°ä¸€ä¸ªä½ ä½¿ç”¨è¿‡çš„ä¸œè¥¿ã€‚è¿™ä¹Ÿæ˜¯ä¸€ä¸ªå¥½æœºä¼šï¼Œå­¦ä¹ æ›´å¤šçš„ C çš„åŒæ—¶è¿›è€Œçˆ±ä¸Š Swiftã€‚</p><h3 id="å…³å¿ƒ-Linux"><a href="#å…³å¿ƒ-Linux" class="headerlink" title="å…³å¿ƒ Linux"></a>å…³å¿ƒ Linux</h3><p>æˆ‘æœ€è¿‘ç”¨ Vapor å†™äº†ä¸€ä¸ªå°åº”ç”¨ï¼Œéœ€è¦ä¸ºå®ƒæ·»åŠ å‡ ä¸ªä¾èµ–åº“ï¼ˆæ¯”å¦‚ï¼šæ—¶é—´è®¡æ•°å™¨ï¼‰ä½†å¤§éƒ¨åˆ†çš„ç°æœ‰çš„åº“åªæ”¯æŒ iOS/macOSã€‚ å‡å¦‚ä½ æœ‰å¤„ç†è·¨å¹³å°ï¼ˆç”±äºæ²¡æœ‰ UIKit/AppKit çš„ä¾èµ–ï¼‰çš„ç»éªŒï¼Œå¯ä»¥å°è¯•åœ¨ Linux ä¸Šæµ‹è¯•ç¼–è¯‘ Swiftã€‚</p><p>è¿™æ¯”å¬ä¸Šå»æ›´ç®€å•ã€‚è¿™é‡Œæœ‰ä¸€ä¸ªå¯ç”¨çš„ <a href="https://hub.docker.com/r/ibmcom/swift-ubuntu/tags/" target="_blank" rel="noopener">Swift 4.1 ç‰ˆæœ¬çš„ docker é•œåƒ</a>ï¼Œä½ å¯ä»¥ç›´æ¥è¿è¡Œå®ƒæ¥æµ‹è¯•ä½ çš„ä»£ç ï¼Œæˆ–è€…é€‰æ‹©é€šè¿‡ <a href="https://www.virtualbox.org/" target="_blank" rel="noopener">Virtualbox</a> è™šæ‹Ÿæœºæ¥è¿è¡Œå®ƒã€‚</p><h3 id="Swift-åŒ…ç®¡ç†çš„æ”¯æŒ"><a href="#Swift-åŒ…ç®¡ç†çš„æ”¯æŒ" class="headerlink" title="Swift åŒ…ç®¡ç†çš„æ”¯æŒ"></a>Swift åŒ…ç®¡ç†çš„æ”¯æŒ</h3><p>å¦‚æœä½ å·²ç»æœ‰äº†ä¸€ä¸ªåº“ï¼Œé™¤äº†æ”¯æŒ CocoaPods å’Œ Carthage å¤–ï¼Œè¯·å°è¯•æ”¯æŒ Swift Package Managerã€‚</p><h3 id="è¿è¡Œåœ¨-Foundation-åº“ä¸Š"><a href="#è¿è¡Œåœ¨-Foundation-åº“ä¸Š" class="headerlink" title="è¿è¡Œåœ¨ Foundation åº“ä¸Š"></a>è¿è¡Œåœ¨ Foundation åº“ä¸Š</h3><p>å¦ä¸€ä»¶ä¾æ—§å›°éš¾çš„äº‹æƒ…æ˜¯ Swift åœ¨ Linux çš„ <a href="https://github.com/apple/swift-corelibs-foundation" target="_blank" rel="noopener">Foundation åº“</a> æ˜¯åŸºäº iOS/macOS Foundation åº“çš„äºŒæ¬¡å®ç°ï¼Œå› æ­¤ä¾æ—§å­˜åœ¨äº›æ²¡æœ‰å®ç°çš„ç‰¹æ€§å’Œï¼ˆç‰¹åˆ«æ£˜æ‰‹ï¼‰bugsã€‚è¿™æ„å‘³ç€ä¹Ÿè®¸ä½ å†™åœ¨ Mac ä¸Šé¢çš„ä»£ç åœ¨ Xcode ä¸­è·‘çš„å¾ˆå¥½ï¼Œä½†ç”±äº Linux Foundation åº“çš„ bugï¼Œå®ƒè¿è¡Œåœ¨ Linux ä¸Šæ—¶å¯èƒ½ä¼šå´©æºƒã€‚ä¸ºäº†æ‹“å±• Swift çš„åº”ç”¨é¢†åŸŸï¼Œè®© Linux ä¸Šé¢çš„ Fundation åº“ä»£ç å˜å¾—æ›´åŠ å¥å£®æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ç›®æ ‡ã€‚</p><p>æœ€ç®€å•çš„å¼€å§‹æ–¹å¼æ˜¯å» <a href="https://bugs.swift.org/secure/Dashboard.jspa" target="_blank" rel="noopener">Swift Jira</a> çš„é¦–é¡µæœç´¢ Foundation bugsã€‚</p><h3 id="å¸®åŠ©æ”¹è¿›-Foundation-åº“"><a href="#å¸®åŠ©æ”¹è¿›-Foundation-åº“" class="headerlink" title="å¸®åŠ©æ”¹è¿› Foundation åº“"></a>å¸®åŠ©æ”¹è¿› Foundation åº“</h3><p>å¦‚æœä½ æ²¡æœ‰æ—¶é—´æˆ–è€…å¯¹åœ¨ Swift Foundation ä¸Šçš„å·¥ä½œå†…å®¹ä¸æ„Ÿå…´è¶£ã€‚ä½ ä¹Ÿå¯ä»¥åœ¨ Linux ä¸Šä½¿ç”¨æˆ–è€…æµ‹è¯• Foundation åº“ï¼Œå¹¶ä¸”æäº¤ bug æŠ¥å‘Šã€‚åªè¦æœ‰è¶Šæ¥è¶Šå¤šçš„äººä½¿ç”¨å®ƒï¼Œå®ƒä¹Ÿå°†å˜å¾—æ›´åŠ ç¨³å®šã€‚</p><h3 id="å¸®åŠ©æ”¹å–„-Linux-ç¼–è¾‘ä½“éªŒ"><a href="#å¸®åŠ©æ”¹å–„-Linux-ç¼–è¾‘ä½“éªŒ" class="headerlink" title="å¸®åŠ©æ”¹å–„ Linux ç¼–è¾‘ä½“éªŒ"></a>å¸®åŠ©æ”¹å–„ Linux ç¼–è¾‘ä½“éªŒ</h3><p>Linux ç”¨æˆ·æ²¡æœ‰ Xcodeï¼Œæ‰€ä»¥ä»–ä»¬ä½¿ç”¨ Atomã€Emacsã€Vim æˆ– VSCodeã€‚è¿™é‡Œå·²ç»æœ‰å¤šä¸ªé¡¹ç›®æ¥è®©è¿™äº›ç¼–è¾‘å™¨æ”¯æŒ Swift è¯­è¨€ç¼–è¾‘ã€‚ä½†æˆ‘ä»¬ä¹Ÿè®¸èƒ½å¤Ÿæ”¹è¿›å®ƒä»¬ã€‚å¦‚æœä½ æœ‰ç©ºé—²æ—¶é—´ï¼Œç”¨ä½ å–œæ¬¢çš„ç¼–è¾‘å™¨å‚ä¸åˆ°è¿™äº›é¡¹ç›®ä¸­æ¥ï¼Œè¿›è¡Œæµ‹è¯•æäº¤é—®é¢˜æˆ–è§£å†³è¿™äº›é—®é¢˜ã€‚</p><h3 id="å‚åŠ åœ¨-San-Jose-ä¸¾åŠçš„-Try-Swift-å¤§ä¼š"><a href="#å‚åŠ åœ¨-San-Jose-ä¸¾åŠçš„-Try-Swift-å¤§ä¼š" class="headerlink" title="å‚åŠ åœ¨ San Jose ä¸¾åŠçš„ Try Swift å¤§ä¼š"></a>å‚åŠ åœ¨ San Jose ä¸¾åŠçš„ Try Swift å¤§ä¼š</h3><p>å¦‚æœä½ æ°å¥½åœ¨ San Jose å‚åŠ ä»Šå¹´çš„ WWDCã€‚è¿™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„å­¦ä¹ æœºä¼šã€‚ ä½ ä¼šé‡è§ä¸€äº›æœ‰è¶£çš„äººï¼Œ<a href="https://www.tryswift.co/events/2018/sanjose/" target="_blank" rel="noopener">å°è¯•å‚åŠ åœ¨ San Jose ä¸¾åŠçš„ Try Swift å¤§ä¼š</a>ã€‚ </p><blockquote><p>â€œä½ æœ‰æœºä¼šä¸º Swift åšå‡ºè´¡çŒ®ã€‚åŠ å…¥ä¸€ä¸ª Swift å¼€æºè´¡çŒ®è€…å°ç»„ï¼Œè®¨è®ºæœ‰å…³ Swift å¼€æºé¡¹ç›®çš„æœ€æ–°æ¶ˆæ¯ï¼Œç„¶ååœ¨ç¤¾åŒºå¯¼å¸ˆçš„å¸®åŠ©ä¸‹ä¸º Swift Evolution åšå‡ºè‡ªå·±è´¡çŒ®ï¼â€</p></blockquote><p><a href="https://www.tryswift.co/events/2018/sanjose/" target="_blank" rel="noopener">ä½ å¯ä»¥æŸ¥é˜…è¿™ä¸ªé“¾æ¥</a></p><h3 id="ä¸¾æ‰‹ä¹‹åŠ³"><a href="#ä¸¾æ‰‹ä¹‹åŠ³" class="headerlink" title="ä¸¾æ‰‹ä¹‹åŠ³"></a>ä¸¾æ‰‹ä¹‹åŠ³</h3><p>åœ¨è¿‡å»çš„ä¸€å¹´åŠé‡Œï¼Œæˆ‘æ²¡æœ‰å¤ªå¤šæ—¶é—´åšä»»ä½•å…³äºå¼€æºçš„å·¥ä½œï¼Œå› ä¸ºæˆ‘ä¸€ç›´å¿™äºè‡ªå·±çš„ï¼ˆé—­æºï¼‰é¡¹ç›®ï¼Œä½†æˆ‘çœŸæƒ³å†æ¬¡ä¸º Swift å¼€æºä»£ç è´¡çŒ®ã€‚æˆ‘çœŸçš„å¾ˆå–œæ¬¢ Swiftï¼Œè¿™æ˜¯ä¸€ä¸ªå¾ˆæ£’çš„è¯­è¨€ï¼Œå¸®åŠ©å®ƒæˆåŠŸçš„é‚£äº›æ—¥å­ï¼Œæ˜¯æˆ‘æ›¾æ„Ÿåˆ°æœ€ç¾å¦™çš„æ—¶å…‰ï¼Œå¦‚æœä½ æœ‰åŒæ ·çš„æ„Ÿè§‰ï¼Œè¯·åˆ†äº«è¿™ç¯‡æ–‡ç« ã€‚</p><p><a href="https://twitter.com/terhechte" target="_blank" rel="noopener">å¦‚æœå¯¹æ–‡ç« å†…å®¹æœ‰æƒ³æ³•çš„è¯ï¼Œæ¬¢è¿æ¥ Twitter ä¸Šä¸€èµ·è®¨è®º</a></p><blockquote><p>æœ¬æ–‡ç”± SwiftGG ç¿»è¯‘ç»„ç¿»è¯‘ï¼Œå·²ç»è·å¾—ä½œè€…ç¿»è¯‘æˆæƒï¼Œæœ€æ–°æ–‡ç« è¯·è®¿é—® <a href="http://swift.gg">http://swift.gg</a>ã€‚</p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;ä½œè€…ï¼šterhechteï¼Œ&lt;a href=&quot;http://appventure.me/2018/05/03/expanding-swifts-reach/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;åŸæ–‡é“¾æ¥&lt;/a&gt;ï¼ŒåŸæ–‡æ—¥æœŸï¼š2018-05-03&lt;br&gt;è¯‘è€…ï¼š&lt;a href=&quot;https://github.com/Adolf-L&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;BigLuo&lt;/a&gt;ï¼›æ ¡å¯¹ï¼š&lt;a href=&quot;https://github.com/Cee&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Cee&lt;/a&gt;ï¼Œ&lt;a href=&quot;http://numbbbbb.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;numbbbbb&lt;/a&gt;ï¼›å®šç¨¿ï¼š&lt;a href=&quot;http://forelax.space&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Forelax&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;!--æ­¤å¤„å¼€å§‹æ­£æ–‡--&gt;
&lt;p&gt;æˆ‘æƒ³å¤§å®¶åº”è¯¥éƒ½ä¼šåŒæ„ Swift æ˜¯ä¸€é—¨ä¼˜ç§€çš„è¯­è¨€ï¼Œå¾ˆå¥½çš„å¤„ç†äº†é‚£äº›ç®€å•ä¸å¤æ‚çš„é—®é¢˜ã€‚ç†è®ºä¸Šè®²ï¼Œå®ƒå°†ä¼šæˆä¸ºé‡è¦çš„ç¼–ç¨‹è¯­è¨€ä¹‹ä¸€ã€‚ç›®å‰ï¼ŒSwift çš„ä½¿ç”¨ä»…é™äºè‹¹æœå¼€å‘é¢†åŸŸï¼ˆå¤–åŠ å°‘é‡æœåŠ¡ç«¯ Swift ä»¥åŠè¿‘æœŸå®£å¸ƒçš„ &lt;a href=&quot;https://www.tensorflow.org/community/swift&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Swift ç‰ˆæœ¬çš„ Tensorflow&lt;/a&gt;ï¼‰ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;â€œMy goal for Swift has always been and still is total world domination. Itâ€™s a modest goalâ€&lt;/p&gt;
&lt;p&gt;â€œæˆ‘ä¸€ç›´æœŸå¾…ç€ Swift ç»Ÿæ²»ä¸–ç•Œï¼Œè¿™æ˜¯ä¸€ä¸ªè°¦è™šçš„ç›®æ ‡ã€‚â€&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Chris Lattner&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;p&gt;éšç€æ–°çš„æ³›å‹ç‰¹æ€§åœ¨ Swift 4.1 ä¸­æ¨å‡ºä»¥åŠ &lt;a href=&quot;https://swift.org/abi-stability/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;ABI åœ¨ Swift 5 ä¸­é€æ¸ç¨³å®š&lt;/a&gt;ï¼ŒSwift ä¼¼ä¹é€æ¸å…·å¤‡äº†è·³å‡ºè‹¹æœå¼€å‘é¢†åŸŸçš„æ¡ä»¶ã€‚æœ¬æ–‡æˆ‘ä¼šè®¨è®ºä¸€ä¸ªæˆ‘çŸ¥é“çš„é—®é¢˜ï¼Œå®ƒé˜»ç¢ç€ Swift å¹¿æ³›çš„åº”ç”¨ï¼Œå‡†ç¡®çš„è®²ï¼Œä¸å…¶å®ƒé—®é¢˜ä¸€æ ·ï¼Œè¯¥é—®é¢˜ä¹Ÿæ­£åœ¨è¢«å¼€å‘ç¤¾åŒºç€æ‰‹è§£å†³ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="Swift" scheme="https://swift.gg/categories/Swift/"/>
    
    
      <category term="Swift" scheme="https://swift.gg/tags/Swift/"/>
    
  </entry>
  
  <entry>
    <title>Hashable / Hasher</title>
    <link href="https://swift.gg/2018/10/01/hashable_hahser/"/>
    <id>https://swift.gg/2018/10/01/hashable_hahser/</id>
    <published>2018-10-01T00:00:00.000Z</published>
    <updated>2019-02-18T08:52:03.568Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ä½œè€…ï¼šMatttï¼Œ<a href="https://nshipster.com/hashable/" target="_blank" rel="noopener">åŸæ–‡é“¾æ¥</a>ï¼ŒåŸæ–‡æ—¥æœŸï¼š2018-08-13<br>è¯‘è€…ï¼š<a href="https://github.com/Damonvvong" target="_blank" rel="noopener">Damonwong</a>ï¼›æ ¡å¯¹ï¼š<a href="https://lision.me/" target="_blank" rel="noopener">Lision</a>ï¼Œ<a href="http://blog.yousanflics.com.cn" target="_blank" rel="noopener">Yousanflics</a>ï¼›å®šç¨¿ï¼š<a href="http://forelax.space" target="_blank" rel="noopener">Forelax</a></p></blockquote><!--æ­¤å¤„å¼€å§‹æ­£æ–‡--><p>å½“ä½ åœ¨è‹¹æœå•†åº—é¢„çº¦å¤©æ‰å§æœåŠ¡åï¼Œç›¸å…³å·¥ä½œäººå‘˜ä¼šå¸®ä½ ç™»è®°å¹¶ä¸”å®‰æ’ç‰¹å®šçš„æœåŠ¡æ—¶é—´ï¼Œåœ¨è¢«å¸¦åˆ°åº§ä½ä¸Šä¹‹åï¼Œå·¥ä½œäººå‘˜ä¼šè®°å½•ä½ çš„èº«ä»½ä¿¡æ¯å¹¶æ·»åŠ åˆ°æœåŠ¡é˜Ÿåˆ—å½“ä¸­ã€‚</p><p>æ ¹æ®ä¸€ä»½æ¥è‡ªé›¶å”®åº—æŸä½å‰å‘˜å·¥çš„æŠ¥å‘Šè¡¨ç¤ºï¼Œå¯¹äºé¡¾å®¢çš„æè¿°æœ‰ç€ä¸¥æ ¼çš„æŒ‡å¯¼æ–¹é’ˆã€‚ä»–ä»¬çš„å¤–è²Œç‰¹å¾å¦‚ï¼šå¹´é¾„ã€æ€§åˆ«ã€ç§æ—ã€èº«é«˜éƒ½æ²¡æœ‰è¢«ä½¿ç”¨ â€”â€” ç”šè‡³è¿å¤´å‘çš„é¢œè‰²éƒ½æ²¡æœ‰è¢«ä½¿ç”¨ã€‚è€Œæ˜¯é€šè¿‡é¡¾å®¢çš„ç€è£…æ¥æè¿°ï¼Œä¾‹å¦‚â€œé»‘è‰²çš„é«˜é¢†æ¯›è¡£ï¼Œç‰›ä»”è£¤å’Œçœ¼é•œâ€ã€‚</p><p>è¿™ç§æè¿°é¡¾å®¢çš„æ–¹å¼å’Œç¼–ç¨‹ä¸­çš„å“ˆå¸Œå‡½æ•°æœ‰å¾ˆå¤šå…±åŒä¹‹å¤„ã€‚åŒè®¸å¤šä¼˜ç§€çš„å“ˆå¸Œå‡½æ•°ä¸€æ ·ï¼Œå®ƒæ˜¯è¿ç»­å’Œæ˜“è®¡ç®—çš„ï¼Œå¯ç”¨äºå¿«é€Ÿæ‰¾åˆ°ä½ æ­£åœ¨å¯»æ‰¾çš„å†…å®¹ï¼ˆæˆ–è€…äººï¼‰ã€‚æˆ‘æƒ³ä½ è‚¯å®šä¹Ÿè§‰å¾—è¿™æ ·æ¯”é˜Ÿåˆ—è¦å¥½ç”¨å¤šäº†ã€‚</p><p>è¿™å‘¨æˆ‘ä»¬çš„ä¸»é¢˜æ˜¯ <code>Hashable</code> å’Œç›¸å…³çš„æ–°ç±»å‹ <code>Hasher</code>ã€‚å®ƒä»¬å…±åŒç»„æˆäº† Swift æœ€å—å–œçˆ±çš„ä¸¤ä¸ªé›†åˆç±» <code>Dictionary</code> å’Œ <code>Set</code> çš„åŸºç¡€åŠŸèƒ½ã€‚</p><a id="more"></a><p>å‡è®¾ä½ æœ‰ä¸€ä¸ªå¯ä»¥æ¯”è¾ƒç›¸ç­‰æ€§çš„å¯¹è±¡<strong><a href="https://zh.wikipedia.org/wiki/%E4%B8%B2%E5%88%97_(%E6%8A%BD%E8%B1%A1%E8%B3%87%E6%96%99%E5%9E%8B%E5%88%A5" target="_blank" rel="noopener">åˆ—è¡¨</a>)</strong>ã€‚è¦åœ¨è¿™ä¸ªåˆ—è¡¨ä¸­æ‰¾åˆ°ä¸€ä¸ªç‰¹å®šçš„å¯¹è±¡ï¼Œä½ éœ€è¦éå†è¿™ä¸ªåˆ—è¡¨çš„å…ƒç´ ï¼Œç›´åˆ°æ‰¾åˆ°åŒ¹é…é¡¹ä¸ºæ­¢ã€‚éšç€ä½ å‘åˆ—è¡¨ä¸­æ·»åŠ æ›´å¤šçš„å…ƒç´ æ—¶ï¼Œéœ€è¦æ‰¾åˆ°å…¶ä¸­ä»»ä½•ä¸€ä¸ªå…ƒç´ æ‰€éœ€çš„å¹³å‡æ—¶é—´æ˜¯çº¿æ€§çº§çš„(<code>O(n)</code>)ã€‚</p><p>å¦‚æœå°†è¿™äº›å¯¹è±¡å­˜å‚¨åœ¨ä¸€ä¸ª<strong><a href="https://zh.wikipedia.org/wiki/%E9%9B%86%E5%90%88_(%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6" target="_blank" rel="noopener">é›†åˆ</a>)</strong>ä¸­ï¼Œç†è®ºä¸Šå¯ä»¥åœ¨å¸¸é‡çº§æ—¶é—´(<code>O(1)</code>)å†…æ‰¾åˆ°å®ƒä»¬ä¸­çš„ä»»ä½•ä¸€ä¸ª - ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨ä¸€ä¸ªåŒ…å« 10 ä¸ªå…ƒç´ çš„é›†åˆä¸­æŸ¥æ‰¾æˆ–åœ¨ä¸€ä¸ªåŒ…å« 10000<sup>*</sup> ä¸ªå…ƒç´ çš„é›†åˆä¸­æŸ¥æ‰¾æ‰€éœ€çš„æ—¶é—´æ˜¯ä¸€æ ·çš„ã€‚è¿™æ˜¯æ€ä¹ˆå›äº‹å‘¢ï¼Ÿå› ä¸ºé›†åˆä¸æ˜¯æŒ‰é¡ºåºå­˜å‚¨å¯¹è±¡çš„ï¼Œè€Œæ˜¯å°†å¯¹è±¡å†…å®¹è®¡ç®—çš„<dfn>å“ˆå¸Œå€¼</dfn>ä½œä¸ºç´¢å¼•å­˜å‚¨ã€‚å½“åœ¨é›†åˆä¸­æŸ¥æ‰¾å¯¹è±¡æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ç›¸åŒçš„å“ˆå¸Œå‡½æ•°è®¡ç®—æ–°çš„å“ˆå¸Œå€¼ç„¶åæŸ¥æ‰¾å¯¹è±¡å­˜å‚¨ä½ç½®ã€‚</p><p><sup>*</sup> å¦‚æœä¸¤ä¸ªä¸åŒçš„å¯¹è±¡å…·æœ‰ç›¸åŒçš„å“ˆå¸Œå€¼æ—¶ï¼Œä¼šäº§ç”Ÿ<dfn>å“ˆå¸Œå†²çª</dfn>ã€‚å½“å‘ç”Ÿå“ˆå¸Œå†²çªæ—¶ï¼Œå®ƒä»¬å°†å­˜å‚¨åœ¨è¯¥åœ°å€å¯¹åº”çš„åˆ—è¡¨ä¸­ã€‚å¯¹è±¡ä¹‹é—´å‘ç”Ÿå†²çªçš„æ¦‚ç‡è¶Šé«˜ï¼Œå“ˆå¸Œé›†åˆçš„æ€§èƒ½å°±ä¼šæ›´åŠ çº¿æ€§å¢é•¿ã€‚</p><h2 id="Hashable"><a href="#Hashable" class="headerlink" title="Hashable"></a>Hashable</h2><p>åœ¨ Swift ä¸­ï¼Œ<code>Array</code> ä¸ºï¦œè¡¨æä¾›äº†æ ‡å‡†çš„æ¥â¼ï¼Œ<code>Set</code> ä¸ºé›†åˆæä¾›äº†æ ‡å‡†çš„æ¥â¼ã€‚å¦‚æœè¦å°†å¯¹è±¡å­˜å‚¨åˆ° <code>Set</code> ä¸­ï¼Œå°±è¦éµå¾ª <code>Hashable</code> åè®®åŠå…¶æ‰©å±•åè®® <code>Equatable</code>ã€‚Swift çš„æ ‡å‡†æ˜ å°„æ¥å£ <code>Dictionary</code> å¯¹å®ƒçš„å…³è”ç±»å‹ <code>Key</code> ä¹Ÿéœ€è¦éµå¾ª <code>Hashable</code> åè®®åŠå…¶æ‰©å±•åè®®ã€‚</p><p>åœ¨ Swift ä¹‹å‰çš„ç‰ˆæœ¬ä¸­ï¼Œä¸ºäº†è®©è‡ªå®šä¹‰ç±»å‹èƒ½æ”¯æŒ <code>Set</code> æˆ– <code>Dictionary</code> å­˜å‚¨éœ€è¦å†™â¼¤é‡çš„ <a href="https://nshipster.cn/swift-gyb/" target="_blank" rel="noopener">æ ·æ¿ä»£ç </a>ã€‚</p><p>ä»¥ä¸‹é¢çš„ <code>Color</code> ç±»å‹ä¸ºä¾‹ï¼Œ<code>Color</code> ä½¿â½¤äº† 8 ä½æ•´å‹å€¼æ¥è¡¨ç¤ºçº¢ï¼Œç»¿ï¼Œè“è‰²å€¼:</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Color</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> red: <span class="type">UInt8</span></span><br><span class="line">    <span class="keyword">let</span> green: <span class="type">UInt8</span></span><br><span class="line">    <span class="keyword">let</span> blue: <span class="type">UInt8</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¦ç¬¦åˆ <code>Equatable</code> çš„è¦æ±‚ï¼Œä½ éœ€è¦æä¾›ä¸€ä¸ª == æ“ä½œç¬¦çš„å®ç°ã€‚è¦ç¬¦åˆ <code>Hashable</code> çš„è¦æ±‚ï¼Œä½ éœ€è¦æä¾›â¼€ä¸ªåä¸º <code>hashValue</code> çš„è®¡ç®—å±æ€§:</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Swift &lt; 4.1</span></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Color</span>: <span class="title">Equatable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> ==<span class="params">(lhs: Color, rhs: Color)</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> lhs.red == rhs.red &amp;&amp;</span><br><span class="line">               lhs.green == rhs.green &amp;&amp;</span><br><span class="line">               lhs.blue == rhs.blue</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Color</span>: <span class="title">Hashable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> hashValue: <span class="type">Int</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">self</span>.red.hashValue ^</span><br><span class="line">               <span class="keyword">self</span>.green.hashValue ^</span><br><span class="line">               <span class="keyword">self</span>.blue.hashValue</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯¹äºå¤§å¤šæ•°å¼€å‘è€…â½½â¾”ï¼Œå®ç° <code>Hashable</code> åªæ˜¯ä¸ºï¦ºèƒ½å°½å¿«è®©è¦åšçš„äº‹æƒ…æ­¥å…¥æ­£è½¨ï¼Œå› æ­¤ä»–ä»¬ä¼šå¯¹æ‰€æœ‰çš„å­˜å‚¨å±æ€§ä½¿â½¤<a href="https://zh.wikipedia.org/wiki/%E9%80%BB%E8%BE%91%E5%BC%82%E6%88%96" target="_blank" rel="noopener">é€»è¾‘å¼‚æˆ–</a>æ“ä½œï¼Œå¹¶åœ¨æŸä¸€å¤©è°ƒç”¨å®ƒã€‚</p><p>ç„¶â½½è¿™ç§å®ç°çš„ä¸€ä¸ªç¼ºé™·æ˜¯é«˜å“ˆå¸Œå†²çªç‡ã€‚ç”±äºé€»è¾‘å¼‚æˆ–æ»¡â¾œ<a href="https://zh.wikipedia.org/wiki/%E4%BA%A4%E6%8F%9B%E5%BE%8B" target="_blank" rel="noopener">äº¤æ¢ç‡</a>ï¼Œåƒâ»˜è‰²å’Œâ»©è‰²è¿™æ ·ï¥§åŒçš„é¢œè‰²ä¹Ÿä¼šå‘â½£å“ˆå¸Œå†²çª:</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Swift &lt; 4.2</span></span><br><span class="line"><span class="keyword">let</span> cyan = <span class="type">Color</span>(red: <span class="number">0x00</span>, green: <span class="number">0xFF</span>, blue: <span class="number">0xFF</span>)</span><br><span class="line"><span class="keyword">let</span> yellow = <span class="type">Color</span>(red: <span class="number">0xFF</span>, green: <span class="number">0xFF</span>, blue: <span class="number">0x00</span>)</span><br><span class="line"></span><br><span class="line">cyan.hashValue == yellow.hashValue <span class="comment">// true, collision</span></span><br></pre></td></tr></table></figure><p>å¤§å¤šæ•°æ—¶å€™è¿™æ ·åšï¥§ä¼šå‡ºé—®é¢˜ï¼›ç°ä»£è®¡ç®—æœºå·²ç»è¶³å¤Ÿå¼ºå¤§ä»¥è‡³äºä½ å¾ˆéš¾æ„è¯†åˆ°æ€§èƒ½çš„è¡°å‡ï¼Œé™¤â¾®ä½ çš„å®ç°ç»†èŠ‚å­˜åœ¨â¼¤ï¥¾é—®é¢˜ã€‚</p><p>ä½†è¿™å¹¶ï¥§æ˜¯è¯´è¿™äº›ç»†èŠ‚â½†å…³ç´§è¦ â€”â€” å®ƒä»¬å¾€å¾€æå…¶é‡è¦ã€‚ç¨åä¼šè¯¦ç»†ä»‹ç»ã€‚</p><h2 id="è‡ªåŠ¨åˆæˆ-Hashable-å®ç°"><a href="#è‡ªåŠ¨åˆæˆ-Hashable-å®ç°" class="headerlink" title="è‡ªåŠ¨åˆæˆ Hashable å®ç°"></a>è‡ªåŠ¨åˆæˆ Hashable å®ç°</h2><p>ä» Swift 4.1 å¼€å§‹ï¼Œå¦‚æœæŸä¸ªç±»å‹åœ¨å£°æ˜æ—¶éµå¾ªäº† <code>Equatable</code> å’Œ <code>Hashable</code> åè®®å¹¶ä¸”å®ƒçš„æˆå‘˜å˜é‡åŒæ—¶ä¹Ÿæ»¡è¶³äº†è¿™äº›åè®®ï¼Œç¼–è¯‘å™¨ä¼šä¸ºå…¶è‡ªåŠ¨åˆæˆ <code>Equatable</code> å’Œ <code>Hashable</code> çš„å®ç°ã€‚</p><p>é™¤äº†å¤§å¤§çš„æé«˜äº†å¼€å‘äººå‘˜çš„å¼€å‘æ•ˆç‡ä»¥å¤–ï¼Œè¿˜å¯ä»¥å¤§å¹…å‡å°‘ä»£ç çš„æ•°é‡ã€‚æ¯”å¦‚ï¼Œæˆ‘ä»¬ä¹‹å‰ <code>Color</code> çš„ä¾‹å­ â€”â€” ç°åœ¨æ˜¯æœ€å¼€å§‹ä»£ç é‡çš„ 1/3 :</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Swift &gt;= 4.1</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Color</span>: <span class="title">Hashable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> red: <span class="type">UInt8</span></span><br><span class="line">    <span class="keyword">let</span> green: <span class="type">UInt8</span></span><br><span class="line">    <span class="keyword">let</span> blue: <span class="type">UInt8</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å°½ç®¡å¯¹è¯­è¨€è¿›è¡Œäº†æ˜æ˜¾çš„æ”¹è¿›ï¼Œä½†è¿˜æ˜¯æœ‰ä¸€äº›å®ç°ç»†èŠ‚æœ‰ç€æ— æ³•å¿½è§†çš„é—®é¢˜ã€‚</p><p>åœ¨ Swift Evolution ææ¡ˆ <a href="https://github.com/apple/swift-evolution/blob/master/proposals/0185-synthesize-equatable-hashable.md" target="_blank" rel="noopener">SE-0185: åˆæˆ <code>Equatable</code> å’Œ <code>Hashable</code> çš„å®ç°</a> ä¸­ï¼Œ <a href="https://github.com/allevato" target="_blank" rel="noopener">Tony Allevato</a> ç»™å“ˆå¸Œå‡½æ•°æä¾›äº†è¿™ä¸ªæ³¨é‡Š: </p><blockquote><p>å“ˆå¸Œå‡½æ•°çš„é€‰æ‹©åº”è¯¥ä½œä¸ºå®ç°ç»†èŠ‚ï¼Œè€Œä¸æ˜¯è®¾è®¡ä¸­çš„å›ºå®šéƒ¨åˆ†ï¼›å› æ­¤ï¼Œä½¿ç”¨è€…ä¸åº”è¯¥ä¾èµ–äºç¼–è¯‘å™¨è‡ªåŠ¨ç”Ÿæˆçš„ Hashable å‡½æ•°çš„å…·ä½“ç‰¹å¾ã€‚æœ€å¯èƒ½çš„å®ç°æ˜¯åœ¨æ¯ä¸ªæˆå‘˜çš„å“ˆå¸Œå€¼ä¸Šè°ƒç”¨æ ‡å‡†åº“ä¸­çš„ <code>_mixInt</code> å‡½æ•°ï¼Œç„¶åå°†ä»–ä»¬é€»è¾‘å¼‚æˆ–ï¼ˆ^ï¼‰ï¼Œå¦‚åŒç›®å‰ <code>Collection</code> ç±»å‹çš„å“ˆå¸Œæ–¹å¼ä¸€æ ·ã€‚</p></blockquote><p>å¹¸è¿çš„æ˜¯ï¼ŒSwift ä¸éœ€è¦å¤šä¹…å°±èƒ½è§£å†³è¿™ä¸ªé—®é¢˜ã€‚æˆ‘ä»¬å°†åœ¨ä¸‹ä¸€ä¸ªç‰ˆæœ¬å¾—åˆ°ç­”æ¡ˆ:</p><h2 id="Hasher"><a href="#Hasher" class="headerlink" title="Hasher"></a>Hasher</h2><p>Swift 4.2 é€šè¿‡å¼•å…¥ <code>Hasher</code> ç±»å‹å¹¶é‡‡ç”¨æ–°çš„é€šç”¨å“ˆå¸Œå‡½æ•°è¿›ä¸€æ­¥ä¼˜åŒ– <code>Hashable</code></p><p>åœ¨ Swift Evolution ææ¡ˆ <a href="https://github.com/apple/swift-evolution/blob/master/proposals/0206-hashable-enhancements.md" target="_blank" rel="noopener">SE-0206: Hashable å¢å¼º</a> ä¸­ï¼š</p><blockquote><p>ä½¿ç”¨ä¸€ä¸ªå¥½çš„å“ˆå¸Œå‡½æ•°æ—¶ï¼Œç®€å•çš„æŸ¥æ‰¾ï¼Œæ’å…¥ï¼Œåˆ é™¤æ“ä½œéƒ½åªéœ€è¦å¸¸é‡çº§æ—¶é—´å³å¯å®Œæˆã€‚ç„¶è€Œï¼Œå¦‚æœæ²¡æœ‰ä¸ºå½“å‰æ•°æ®é€‰æ‹©ä¸€ä¸ªåˆé€‚çš„å“ˆå¸Œå‡½æ•°ï¼Œè¿™äº›æ“ä½œçš„é¢„æœŸæ—¶é—´å°±ä¼šå’Œå“ˆå¸Œè¡¨ä¸­å­˜å‚¨çš„æ•°æ®æ•°é‡æˆæ­£æ¯”ã€‚</p></blockquote><p>æ­£å¦‚ <a href="https://github.com/lorentey" target="_blank" rel="noopener">Karoy Lorentey</a> å’Œ <a href="https://github.com/regexident" target="_blank" rel="noopener">Vincent Esche</a> æ‰€æŒ‡å‡ºçš„é‚£æ ·ï¼Œ<code>Set</code> å’Œ <code>Dictionary</code> ç­‰åŸºäºå“ˆå¸Œçš„é›†åˆä¸»è¦ç‰¹ç‚¹æ˜¯å®ƒä»¬èƒ½å¤Ÿåœ¨å¸¸é‡çº§æ—¶é—´å†…æŸ¥æ‰¾å€¼ã€‚å¦‚æœå“ˆå¸Œå‡½æ•°ä¸èƒ½äº§ç”Ÿä¸€ä¸ªå‡åŒ€çš„å€¼åˆ†å¸ƒï¼Œè¿™äº›é›†åˆå®é™…ä¸Šå°±å˜æˆäº†é“¾è¡¨ã€‚</p><p>Swift 4.2 ä¸­çš„å“ˆå¸Œå‡½æ•°æ˜¯åŸºäºä¼ªéšæœºå‡½æ•°æ— <a href="https://en.wikipedia.org/wiki/SipHash" target="_blank" rel="noopener">SipHash</a> å®ç°çš„ï¼Œæ¯”å¦‚ <a href="https://github.com/apple/swift/blob/master/stdlib/public/core/SipHash.swift" target="_blank" rel="noopener">SipHash-1-3 and SipHash-2-4</a>ï¼Œåˆ†åˆ«åœ¨æ¯ä¸ªæ¶ˆæ¯å—å¼‚æˆ–å“ˆå¸Œä¹‹åæ‰§è¡Œä¸€æ¬¡ round + ä¸‰æ¬¡ final roundï¼Œæˆ–ä¸¤æ¬¡ round + å››æ¬¡ final roundã€‚(è¯‘è€…æ³¨ï¼šè¿™é‡Œçš„ round æŒ‡çš„æ˜¯ä¼ªéšæœºæ•°å˜åŒ–ã€‚å…·ä½“å®ç°çœ‹ <a href="https://github.com/apple/swift/blob/4967393618f89370269518cf3b5ad5247cb0a2c0/stdlib/public/core/SipHash.swift#L47" target="_blank" rel="noopener"><code>_round</code></a>)</p><p>ç°åœ¨ï¼Œå¦‚æœä½ è¦è‡ªå®šä¹‰ç±»å‹å®ç° <code>Hashable</code> çš„æ–¹å¼ï¼Œå¯ä»¥é‡å†™ <code>hash(into:)</code> æ–¹æ³•è€Œä¸æ˜¯ <code>hashValue</code>ã€‚<code>hash(into:)</code> é€šè¿‡ä¼ é€’äº†ä¸€ä¸ª <code>Hasher</code> å¼•ç”¨å¯¹è±¡ï¼Œç„¶åé€šè¿‡è¿™ä¸ªå¯¹è±¡è°ƒç”¨ <code>combine(_:)</code> æ¥æ·»åŠ ç±»å‹çš„å¿…è¦çŠ¶æ€ä¿¡æ¯ã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Swift &gt;= 4.2</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Color</span>: <span class="title">Hashable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> red: <span class="type">UInt8</span></span><br><span class="line">    <span class="keyword">let</span> green: <span class="type">UInt8</span></span><br><span class="line">    <span class="keyword">let</span> blue: <span class="type">UInt8</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// Synthesized by compiler</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">hash</span><span class="params">(into hasher: <span class="keyword">inout</span> Hasher)</span></span> &#123;</span><br><span class="line">        hasher.combine(<span class="keyword">self</span>.red)</span><br><span class="line">        hasher.combine(<span class="keyword">self</span>.green)</span><br><span class="line">        hasher.combine(<span class="keyword">self</span>.blue)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Default implementation from protocol extension</span></span><br><span class="line">    <span class="keyword">var</span> hashValue: <span class="type">Int</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> hasher = <span class="type">Hasher</span>()</span><br><span class="line">        <span class="keyword">self</span>.hash(into: &amp;hasher)</span><br><span class="line">        <span class="keyword">return</span> hasher.finalize()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€šè¿‡æŠ½è±¡éš”ç¦»åº•å±‚çš„ä½æ“ä½œç»†èŠ‚ï¼Œå¼€å‘äººå‘˜å¯ä»¥åˆ©ç”¨ Swift å†…ç½®çš„å“ˆå¸Œå‡½æ•°ï¼Œè¿™æ ·å¯ä»¥é¿å…å†ç°æˆ‘ä»¬åŸæœ‰çš„åŸºäºé€»è¾‘å¼‚æˆ–å®ç°çš„å†²çªï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Swift &gt;= 4.2</span></span><br><span class="line"><span class="keyword">let</span> cyan = <span class="type">Color</span>(red: <span class="number">0x00</span>, green: <span class="number">0xFF</span>, blue: <span class="number">0xFF</span>)</span><br><span class="line"><span class="keyword">let</span> yellow = <span class="type">Color</span>(red: <span class="number">0xFF</span>, green: <span class="number">0xFF</span>, blue: <span class="number">0x00</span>)</span><br><span class="line"></span><br><span class="line">cyan.hashValue == yellow.hashValue <span class="comment">// false, no collision</span></span><br></pre></td></tr></table></figure><h3 id="è‡ªå®šä¹‰å“ˆå¸Œå‡½æ•°"><a href="#è‡ªå®šä¹‰å“ˆå¸Œå‡½æ•°" class="headerlink" title="è‡ªå®šä¹‰å“ˆå¸Œå‡½æ•°"></a>è‡ªå®šä¹‰å“ˆå¸Œå‡½æ•°</h3><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒSwift ä½¿ç”¨é€šç”¨çš„å“ˆå¸Œå‡½æ•°å°†å­—èŠ‚åºåˆ—ç¼©å‡ä¸ºä¸€ä¸ªæ•´æ•°ã€‚</p><p>ä½†æ˜¯ï¼Œä½ å¯ä»¥ä½¿ç”¨ä½ é¡¹ç›®ä¸­è‡ªå®šä¹‰çš„å“ˆå¸Œå‡½æ•°æ¥æ”¹è¿›è¿™ä¸ªç¼©å‡çš„é—®é¢˜ã€‚æ¯”å¦‚ï¼Œå¦‚æœä½ æ­£åœ¨ç¼–å†™ä¸€ä¸ªç¨‹åºæ¥ç©å›½é™…è±¡æ£‹æˆ–è€…æ£‹ç›˜æ¸¸æˆï¼Œä½ å¯ä»¥ä½¿ç”¨ <a href="https://en.wikipedia.org/wiki/Zobrist_hashing" target="_blank" rel="noopener">Zobrist hashing</a> æ¥å¿«é€Ÿçš„å­˜å‚¨æ¸¸æˆçš„çŠ¶æ€ã€‚</p><h3 id="é¿å…å“ˆå¸Œæ³›æ»¥-Hash-Flooding"><a href="#é¿å…å“ˆå¸Œæ³›æ»¥-Hash-Flooding" class="headerlink" title="é¿å…å“ˆå¸Œæ³›æ»¥(Hash-Flooding)"></a>é¿å…å“ˆå¸Œæ³›æ»¥(Hash-Flooding)</h3><p>é€‰æ‹©åƒ SipHash è¿™æ ·çš„åŠ å¯†ç®—æ³•æœ‰åŠ©äºé˜²æ­¢å“ˆå¸Œæ³›æ»¥çš„ DoS æ”»å‡»ï¼Œè¿™ç§æ”»å‡»ä¼šå°è¯•ç”Ÿæˆå“ˆå¸Œå†²çªï¼Œå¹¶è¯•å›¾å¼ºåˆ¶å®æ–½å“ˆå¸Œæ•°æ®ç»“æ„æœ€åçš„æƒ…å†µï¼Œæœ€ç»ˆå¯¼è‡´ç¨‹åºæ…¢ä¸‹æ¥ã€‚<a href="https://arstechnica.com/information-technology/2011/12/huge-portions-of-web-vulnerable-to-hashing-denial-of-service-attack/" target="_blank" rel="noopener">è¿™åœ¨ 2010 å¹´åˆå¼•å‘äº†ä¸€ç³»åˆ—çš„ç½‘ç»œé—®é¢˜</a>ã€‚</p><p>ä¸ºäº†ä½¿äº‹æƒ…å˜çš„æ›´åŠ å®‰å…¨ï¼Œ<code>Hasher</code> ä¼šåœ¨æ¯æ¬¡å¯åŠ¨åº”ç”¨ç¨‹åºæ—¶ç”Ÿæˆä¸€ä¸ªéšæœºç§å­å€¼ï¼Œä½¿å¾—å“ˆå¸Œå€¼æ›´éš¾ä»¥é¢„æµ‹ã€‚</p><blockquote><p>ä½ ä¸åº”è¯¥ä¾èµ–ç‰¹å®šçš„å“ˆå¸Œå€¼ï¼Œä¹Ÿä¸åº”è¯¥åœ¨ç¨‹åºæ‰§è¡Œä¸­ä¿å­˜ç‰¹å®šçš„å“ˆå¸Œå€¼ã€‚åœ¨æå°‘æ•°æƒ…å†µä¸‹ï¼Œä½ ç¡®å®šè¦è¿™ä¹ˆåšçš„è¯ï¼Œå¯ä»¥è®¾ç½® SWIFT_DETERMINISTIC_HASHING æ ‡è¯†ç¬¦æ¥ç¦ç”¨éšæœºå“ˆå¸Œç§å­ã€‚</p></blockquote><p>ç¼–ç¨‹ç±»æ¯”çš„æŒ‘æˆ˜åœ¨äºå®ƒä»¬é€šè¿‡è¾¹ç•Œæƒ…å†µè§„èŒƒåç¤¾ä¼šè¡Œä¸ºã€‚</p><p>å½“æˆ‘ä»¬èƒ½å¤Ÿè€ƒè™‘åˆ°æ”»å‡»è€…æ‰€æœ‰å¯èƒ½åˆ©ç”¨æ¥è¾¾åˆ°æŸç§é™©æ¶ç›®çš„çš„æƒ…å†µæ—¶ï¼Œè¿™æ—¶èƒ½ä½“ç°å‡ºæˆ‘ä»¬ä¼˜ç§€å·¥ç¨‹å¸ˆçš„å“è´¨ â€”â€” æ¯”å¦‚å“ˆå¸Œæ³›æ»¥çš„ DoS æ”»å‡»ã€‚åœ¨ç°å®ç”Ÿæ´»ä¸­ï¼Œè¿™ä¹ˆåšæˆ‘ä»¬éœ€è¦å†’ç€å¤±è´¥çš„é£é™©å»åº”ç”¨è¿™äº› AFKï¼ˆAway From Keyboardï¼‰çŸ¥è¯†ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´â€¦äº²çˆ±çš„è¯»è€…ï¼Œæˆ‘ä¸å¸Œæœ›ä½ å’Œä½ çš„æœ‹å‹ä¸‹æ¬¡ç©¿ä¸€æ ·çš„è¡£æœå»å½“åœ°è‹¹æœå•†åº—çš„å¤©æ‰å§ä¸­åˆ¶é€ æ··ä¹±å’Œä¸å’Œè°ã€‚</p><p>è¯·ä¸è¦è¿™ä¹ˆåšã€‚</p><p>ç›¸åçš„ï¼Œå¸Œæœ›ä½ æœ‰ä¸‹é¢çš„æ”¶è·ï¼š</p><p>å½“ä½ åœ¨å¤©æ‰å§ç­‰å€™çš„æ—¶å€™ï¼Œå’Œç©¿åŒæ ·é¢œè‰²è¡£æœçš„äººç«™å¾—è¿œä¸€ç‚¹ã€‚è¿™ä¼šè®©æ¯ä¸ªäººåšäº‹éƒ½å˜å¾—å®¹æ˜“å¾—å¤šã€‚</p><blockquote><p>æœ¬æ–‡ç”± SwiftGG ç¿»è¯‘ç»„ç¿»è¯‘ï¼Œå·²ç»è·å¾—ä½œè€…ç¿»è¯‘æˆæƒï¼Œæœ€æ–°æ–‡ç« è¯·è®¿é—® <a href="http://swift.gg">http://swift.gg</a>ã€‚</p></blockquote>]]></content>
    
    <summary type="html">
    
      æœ¬æ–‡ä»‹ç»äº† Hashable å’Œç›¸å…³çš„æ–°ç±»å‹ Hasher
    
    </summary>
    
      <category term="Swift" scheme="https://swift.gg/categories/Swift/"/>
    
      <category term="NSHipster" scheme="https://swift.gg/categories/Swift/NSHipster/"/>
    
    
      <category term="Swift" scheme="https://swift.gg/tags/Swift/"/>
    
      <category term="NSHipster" scheme="https://swift.gg/tags/NSHipster/"/>
    
  </entry>
  
  <entry>
    <title>ä½¿ç”¨ C-Reduce è¿›è¡Œè°ƒè¯•</title>
    <link href="https://swift.gg/2018/09/27/debugging-with-c-reduce/"/>
    <id>https://swift.gg/2018/09/27/debugging-with-c-reduce/</id>
    <published>2018-09-27T00:00:00.000Z</published>
    <updated>2019-02-18T08:52:03.568Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ä½œè€…ï¼šMike Ashï¼Œ<a href="https://www.mikeash.com/pyblog/friday-qa-2018-06-29-debugging-with-c-reduce.html" target="_blank" rel="noopener">åŸæ–‡é“¾æ¥</a>ï¼ŒåŸæ–‡æ—¥æœŸï¼š2018-06-29<br>è¯‘è€…ï¼š<a href="https://bignerdcoding.com/" target="_blank" rel="noopener">BigNerdCoding</a>ï¼›æ ¡å¯¹ï¼š<a href="http://www.jianshu.com/users/596f2ba91ce9/latest_articles" target="_blank" rel="noopener">pmst</a>ï¼Œ<a href="http://numbbbbb.com/" target="_blank" rel="noopener">numbbbbb</a>ï¼›å®šç¨¿ï¼š<a href="http://forelax.space" target="_blank" rel="noopener">Forelax</a></p></blockquote><!--æ­¤å¤„å¼€å§‹æ­£æ–‡--><p>è°ƒè¯•å¤æ‚é—®é¢˜æœ¬èº«å°±å¹¶ä¸è½»æ¾ï¼Œå¦‚æœè¿˜æ²¡æœ‰è¶³å¤Ÿçš„ä¸Šä¸‹æ–‡å’Œå¤§è‡´æ–¹å‘çš„è¯é‚£å°±æ˜¯ä¸€ä»¶éå¸¸å›°éš¾çš„äº‹ã€‚æ‰€ä»¥å¯¹ä»£ç è¿›è¡Œç²¾ç®€ç¼©å°è°ƒè¯•èŒƒå›´ä¹Ÿå°±å˜æˆäº†ä¸€ç§å¸¸è§çš„è¡Œä¸ºã€‚ä¸è¿‡ä¸ç¹æ‚çš„æ‰‹åŠ¨ç®€åŒ–ç›¸æ¯”ï¼Œæ‰§è¡Œè‡ªåŠ¨åŒ–å¤„ç†ç¨‹åºæ˜æ˜¾æ›´å®¹æ˜“å‘æŒ¥è®¡ç®—æœºè‡ªèº«çš„ä¼˜åŠ¿ã€‚C-Reduce æ­£æ˜¯ä¸ºæ­¤è€Œç”Ÿï¼Œå®ƒèƒ½è‡ªåŠ¨å¯¹åŸå§‹ä»£ç è¿›è¡Œç®€åŒ–æ“ä½œè¾“å‡ºä¸€ä¸ªç®€åŒ–çš„è°ƒè¯•å‹å¥½ç‰ˆæœ¬ã€‚ä¸‹é¢æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•ä½¿ç”¨è¯¥è‡ªåŠ¨åŒ–ç¨‹åºã€‚</p><a id="more"></a><h2 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><p>C-Reduce ä»£ç åŸºäºä¸¤ä¸ªä¸»è¦æ€æƒ³ã€‚</p><p>é¦–å…ˆï¼ŒC-Reduce é€šè¿‡åˆ é™¤ç›¸å…³ä»£ç è¡Œæˆ–è€…å°† token é‡å‘½åä¸ºæ›´çŸ­çš„ç‰ˆæœ¬ç­‰æ‰‹æ®µï¼Œå°†æŸäº›åŸå§‹ä»£ç è½¬åŒ–ä¸ºä¸€ä¸ªç®€åŒ–ç‰ˆæœ¬ã€‚</p><p>å…¶æ¬¡ï¼Œå¯¹ç®€åŒ–ç»“æœè¿›è¡Œæ£€éªŒæµ‹è¯•ã€‚ä¸Šé¢çš„ä»£ç ç®€åŒ–æ“ä½œæ˜¯ç›²ç›®çš„ï¼Œå› æ­¤ç»å¸¸äº§ç”Ÿä¸å«å¾…è·Ÿè¸ªé”™è¯¯ç”šè‡³æ˜¯æ ¹æœ¬æ— æ³•ç¼–è¯‘çš„ç®€åŒ–ç‰ˆæœ¬ã€‚æ‰€ä»¥åœ¨ä½¿ç”¨ C-Reduce æ—¶ï¼Œé™¤åŸå§‹ä»£ç å¤–è¿˜éœ€è¦ä¸€ä¸ªç”¨æ¥æµ‹è¯•ç®€åŒ–æ“ä½œæ˜¯å¦ç¬¦åˆç‰¹å®šâ€œé¢„æœŸâ€çš„è„šæœ¬ç¨‹åºã€‚è€Œâ€œé¢„æœŸâ€çš„æ ‡å‡†åˆ™ç”±æˆ‘ä»¬æ ¹æ®å®é™…æƒ…å†µè¿›è¡Œè®¾å®šã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ æƒ³å®šä½åˆ°æŸä¸ª bug é‚£ä¹ˆâ€œé¢„æœŸâ€å°±æ„å‘³ç€ç®€åŒ–ç‰ˆæœ¬åŒ…å«ä¸åŸå§‹ä»£ç ä¸€è‡´çš„é”™è¯¯ã€‚ä½ å¯ä»¥åˆ©ç”¨è„šæœ¬ç¨‹åºå†™å‡ºä»»ä½•ä½ æƒ³è¦çš„â€œé¢„æœŸâ€æ ‡å‡†ï¼ŒC-Reduce ä¼šä¾æ®è¯¥è„šæœ¬ç¨‹åºç¡®ä¿ç®€åŒ–ç‰ˆæœ¬ç¬¦åˆé¢„å…ˆå®šä¹‰çš„è¡Œä¸ºã€‚</p><h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><p>C-Reduce ç¨‹åºçš„ä¾èµ–é¡¹éå¸¸å¤šï¼Œå®‰è£…ä¹Ÿå¾ˆå¤æ‚ã€‚å¥½åœ¨æœ‰ Homebrew çš„åŠ æŒï¼Œæˆ‘ä»¬åªéœ€è¾“å…¥ä»¥ä¸‹å‘½ä»¤å³å¯ï¼š</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">brew install creduce</span><br></pre></td></tr></table></figure><p>å¦‚æœä½ æƒ³æ‰‹åŠ¨å®‰è£…çš„è¯ï¼Œå¯ä»¥å‚ç…§è¯¥å®‰è£… <a href="https://github.com/csmith-project/creduce/blob/master/INSTALL" target="_blank" rel="noopener">æŒ‡å—</a>ã€‚</p><h2 id="ç®€æ˜“ç¤ºä¾‹"><a href="#ç®€æ˜“ç¤ºä¾‹" class="headerlink" title="ç®€æ˜“ç¤ºä¾‹"></a>ç®€æ˜“ç¤ºä¾‹</h2><p>æƒ³å‡ºä¸€ä¸ªå°çš„ç¤ºä¾‹ä»£ç è§£é‡Š C-Reduce æ˜¯å¾ˆå›°éš¾çš„ï¼Œå› ä¸ºå®ƒçš„ä¸»è¦ç›®çš„æ˜¯ä»ä¸€ä¸ªå¤§çš„ç¨‹åºç®€åŒ–å‡ºä¸€ä¸ªå°å‹ç¤ºä¾‹ã€‚ä¸‹é¢æ˜¯æˆ‘ç«­å°½å…¨åŠ›æƒ³å‡ºæ¥çš„ä¸€ä¸ªç®€å• C ç¨‹åºä»£ç ï¼Œå®ƒä¼šäº§ç”Ÿä¸€äº›éš¾ä»¥ç†è§£çš„ç¼–è¯‘è­¦å‘Šã€‚</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ cat test.c</span><br><span class="line"><span class="comment">#include &lt;stdio.h&gt;</span></span><br><span class="line"></span><br><span class="line">struct Stuff &#123;</span><br><span class="line">    char *name;</span><br><span class="line">    int age;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">main(int argc, char **argv) &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"Hello, world!\n"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$ clang test.c</span><br><span class="line">test.c:3:1: warning: <span class="built_in">return</span> <span class="built_in">type</span> of <span class="string">'main'</span> is not <span class="string">'int'</span> [-Wmain-return-type]</span><br><span class="line">struct Stuff &#123;</span><br><span class="line">^</span><br><span class="line">test.c:3:1: note: change <span class="built_in">return</span> <span class="built_in">type</span> to <span class="string">'int'</span></span><br><span class="line">struct Stuff &#123;</span><br><span class="line">^~~~~~~~~~~~</span><br><span class="line">int</span><br><span class="line">test.c:10:1: warning: control reaches end of non-void <span class="keyword">function</span> [-Wreturn-type]</span><br><span class="line">&#125;</span><br><span class="line">^</span><br><span class="line">2 warnings generated.</span><br></pre></td></tr></table></figure><p>ä»è­¦å‘Šä¸­æˆ‘ä»¬çŸ¥é“ <code>struct</code> å’Œ <code>main</code> ä»£ç å­˜åœ¨æŸç§é—®é¢˜ï¼è‡³äºå…·ä½“é—®é¢˜æ˜¯ä»€ä¹ˆï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ç®€åŒ–ç‰ˆæœ¬ä¸­ä»”ç»†åˆ†æã€‚</p><p>C-Reduce èƒ½è½»æ¾çš„å°†ç¨‹åºç²¾ç®€åˆ°è¿œè¶…æˆ‘ä»¬æƒ³è±¡çš„ç¨‹åº¦ã€‚æ‰€ä»¥ä¸ºäº†æ§åˆ¶ C-Reduce çš„ç²¾ç®€è¡Œä¸ºç¡®ä¿ç®€åŒ–æ“ä½œç¬¦åˆç‰¹å®šé¢„æœŸï¼Œæˆ‘ä»¬å°†ç¼–å†™ä¸€ä¸ªå°çš„ shell è„šæœ¬ï¼Œç¼–è¯‘è¯¥æ®µä»£ç å¹¶æ£€æŸ¥è­¦å‘Šä¿¡æ¯ã€‚åœ¨è¯¥è„šæœ¬ä¸­æˆ‘ä»¬éœ€è¦åŒ¹é…ç¼–è¯‘è­¦å‘Šå¹¶æ‹’ç»ä»»ä½•å½¢å¼ç¼–è¯‘é”™è¯¯ï¼ŒåŒæ—¶æˆ‘ä»¬è¿˜éœ€è¦ç¡®ä¿è¾“å‡ºæ–‡ä»¶åŒ…å« <code>struct Stuff</code>ï¼Œè¯¦ç»†è„šæœ¬ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">clang test.c &amp;&gt; output.txt</span><br><span class="line">grep error output.txt &amp;&amp; <span class="built_in">exit</span> 1</span><br><span class="line">grep <span class="string">"warning: return type of 'main' is not 'int'"</span> output.txt &amp;&amp;</span><br><span class="line">grep <span class="string">"struct Stuff"</span> output.txt</span><br></pre></td></tr></table></figure><p>é¦–å…ˆï¼Œæˆ‘ä»¬å¯¹ç®€åŒ–ä»£ç è¿›è¡Œç¼–è¯‘å¹¶å°†è¾“å‡ºé‡å®šå‘åˆ° <code>output.txt</code>ã€‚å¦‚æœè¾“å‡ºæ–‡ä»¶åŒ…å«ä»»ä½• â€œerrorâ€ å­—çœ¼åˆ™ç«‹å³é€€å‡ºå¹¶è¿”å›çŠ¶æ€ç  1ã€‚å¦åˆ™è„šæœ¬å°†ä¼šç»§ç»­æ£€æŸ¥è¾“å‡ºæ–‡æœ¬æ˜¯å¦åŒ…å«ç‰¹å®šè­¦å‘Šä¿¡æ¯å’Œæ–‡æœ¬ <code>struct Stuff</code>ã€‚å½“ <code>grep</code> åŒæ—¶æˆåŠŸåŒ¹é…ä¸Šè¿°ä¸¤ä¸ªæ¡ä»¶æ—¶ï¼Œä¼šè¿”å›çŠ¶æ€ç  0ï¼›å¦åˆ™å°±é€€å‡ºå¹¶è¿”å›çŠ¶æ€ç  1ã€‚çŠ¶æ€ç  0 è¡¨ç¤ºç¬¦åˆé¢„æœŸè€ŒçŠ¶æ€ç  1 åˆ™è¡¨ç¤ºç®€åŒ–çš„ä»£ç ä¸ç¬¦åˆé¢„æœŸéœ€è¦é‡æ–°ç®€åŒ–ã€‚</p><p>æ¥ä¸‹æ¥æˆ‘ä»¬è¿è¡Œ C-Reduce çœ‹çœ‹æ•ˆæœï¼š</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ creduce interestingness.sh test.c </span><br><span class="line">===&lt; 4907 &gt;===</span><br><span class="line">running 3 interestingness tests <span class="keyword">in</span> parallel</span><br><span class="line">===&lt; pass_includes :: 0 &gt;===</span><br><span class="line">(14.6 %, 111 bytes)</span><br><span class="line"></span><br><span class="line">...lots of output...</span><br><span class="line"></span><br><span class="line">===&lt; pass_clex :: rename-toks &gt;===</span><br><span class="line">===&lt; pass_clex :: delete-string &gt;===</span><br><span class="line">===&lt; pass_indent :: final &gt;===</span><br><span class="line">(78.5 %, 28 bytes)</span><br><span class="line">===================== <span class="keyword">done</span> ====================</span><br><span class="line"></span><br><span class="line">pass statistics:</span><br><span class="line">  method pass_balanced :: parens-inside worked 1 <span class="built_in">times</span> and failed 0 <span class="built_in">times</span></span><br><span class="line">  method pass_includes :: 0 worked 1 <span class="built_in">times</span> and failed 0 <span class="built_in">times</span></span><br><span class="line">  method pass_blank :: 0 worked 1 <span class="built_in">times</span> and failed 0 <span class="built_in">times</span></span><br><span class="line">  method pass_indent :: final worked 1 <span class="built_in">times</span> and failed 0 <span class="built_in">times</span></span><br><span class="line">  method pass_indent :: regular worked 2 <span class="built_in">times</span> and failed 0 <span class="built_in">times</span></span><br><span class="line">  method pass_lines :: 3 worked 3 <span class="built_in">times</span> and failed 30 <span class="built_in">times</span></span><br><span class="line">  method pass_lines :: 8 worked 3 <span class="built_in">times</span> and failed 30 <span class="built_in">times</span></span><br><span class="line">  method pass_lines :: 10 worked 3 <span class="built_in">times</span> and failed 30 <span class="built_in">times</span></span><br><span class="line">  method pass_lines :: 6 worked 3 <span class="built_in">times</span> and failed 30 <span class="built_in">times</span></span><br><span class="line">  method pass_lines :: 2 worked 3 <span class="built_in">times</span> and failed 30 <span class="built_in">times</span></span><br><span class="line">  method pass_lines :: 4 worked 3 <span class="built_in">times</span> and failed 30 <span class="built_in">times</span></span><br><span class="line">  method pass_lines :: 0 worked 4 <span class="built_in">times</span> and failed 20 <span class="built_in">times</span></span><br><span class="line">  method pass_balanced :: curly-inside worked 4 <span class="built_in">times</span> and failed 0 <span class="built_in">times</span></span><br><span class="line">  method pass_lines :: 1 worked 6 <span class="built_in">times</span> and failed 33 <span class="built_in">times</span></span><br><span class="line"></span><br><span class="line"> ******** .../test.c ********</span><br><span class="line"></span><br><span class="line">struct Stuff &#123;</span><br><span class="line">&#125; <span class="function"><span class="title">main</span></span>() &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ€ç»ˆæˆ‘ä»¬å¾—åˆ°ä¸€ä¸ªç¬¦åˆé¢„æœŸçš„ç®€åŒ–ç‰ˆæœ¬ï¼Œå¹¶ä¸”ä¼šè¦†ç›–åŸå§‹ä»£ç æ–‡ä»¶ã€‚æ‰€ä»¥åœ¨ä½¿ç”¨ C-Reduce æ—¶éœ€è¦æ³¨æ„è¿™ä¸€ç‚¹ï¼ä¸€å®šè¦åœ¨ä»£ç çš„å‰¯æœ¬ä¸­è¿è¡Œ C-Reduce è¿›è¡Œç®€åŒ–æ“ä½œï¼Œå¦åˆ™å¯èƒ½å¯¹åŸå§‹ä»£ç é€ æˆä¸å¯é€†æ›´æ”¹ã€‚</p><p>è¯¥ç®€åŒ–ç‰ˆæœ¬ä½¿ä»£ç é—®é¢˜æˆåŠŸæš´éœ²äº†å‡ºæ¥ï¼šåœ¨ <code>struct Stuff</code> ç±»å‹å£°æ˜æœ«å°¾å¿˜è®°åŠ åˆ†å·ï¼Œå¦å¤– <code>main</code> å‡½æ•°æ²¡æœ‰æ˜ç¡®è¿”å›ç±»å‹ã€‚è¿™å¯¼è‡´ç¼–è¯‘å™¨å°† <code>struct Stuff</code> é”™è¯¯çš„å½“ä½œäº†è¿”å›ç±»å‹ã€‚è€Œ <code>main</code> å‡½æ•°å¿…é¡»è¿”å› <code>int</code> ç±»å‹ï¼Œæ‰€ä»¥ç¼–è¯‘å™¨å‘å‡ºäº†è­¦å‘Šã€‚</p><h2 id="Xcode-å·¥ç¨‹"><a href="#Xcode-å·¥ç¨‹" class="headerlink" title="Xcode å·¥ç¨‹"></a>Xcode å·¥ç¨‹</h2><p>å¯¹äºå•ä¸ªæ–‡ä»¶çš„ç®€åŒ–æ¥è¯´ C-Reduce éå¸¸æ£’ï¼Œä½†æ˜¯æ›´å¤æ‚åœºæ™¯ä¸‹æ•ˆæœå¦‚ä½•å‘¢ï¼Ÿæˆ‘ä»¬å¤§å¤šæ•°äººéƒ½æœ‰å¤šä¸ª Xcode å·¥ç¨‹ï¼Œé‚£ä¹ˆå¦‚ä½•ç®€åŒ–æŸä¸ª Xcode å·¥ç¨‹å‘¢ï¼Ÿ</p><p>è€ƒè™‘åˆ° C-Reduce çš„å·¥ä½œæ–¹å¼ï¼Œç®€åŒ– Xcode å·¥ç¨‹å¹¶ä¸ç®€å•ã€‚å®ƒä¼šå°†éœ€è¦ç®€åŒ–çš„æ–‡ä»¶æ‹·è´åˆ°ä¸€ä¸ªç›®å½•ä¸­ï¼Œç„¶åè¿è¡Œè„šæœ¬ã€‚è¿™æ ·è™½ç„¶èƒ½å¤ŸåŒæ—¶è¿è¡Œå¤šä¸ªç®€åŒ–ä»»åŠ¡ï¼Œä½†å¦‚æœéœ€è¦å…¶ä»–ä¾èµ–æ‰èƒ½è®©å®ƒå·¥ä½œï¼Œé‚£ä¹ˆå°±å¯èƒ½æ— æ³•ç®€åŒ–ã€‚å¥½åœ¨å¯ä»¥åœ¨è„šæœ¬ä¸­è¿è¡Œå„ç§å‘½ä»¤ï¼Œæ‰€ä»¥å¯ä»¥å°†é¡¹ç›®çš„å…¶ä½™éƒ¨åˆ†å¤åˆ¶åˆ°ä¸´æ—¶ç›®å½•æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p><p>æˆ‘ä½¿ç”¨ Xcode åˆ›å»ºäº†ä¸€ä¸ªæ ‡å‡†çš„ Objective-C è¯­è¨€çš„ Cocoa åº”ç”¨ï¼Œç„¶åå¯¹ <code>AppDelegate.m</code> è¿›è¡Œå¦‚ä¸‹ä¿®æ”¹ï¼š</p><figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"AppDelegate.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">AppDelegate</span> () </span>&#123;</span><br><span class="line">    <span class="built_in">NSWindow</span> *win;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">weak</span>) <span class="keyword">IBOutlet</span> <span class="built_in">NSWindow</span> *window;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">AppDelegate</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)applicationDidFinishLaunching: (<span class="built_in">NSRect</span>)visibleRect &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"Starting up"</span>);</span><br><span class="line">    visibleRect = <span class="built_in">NSInsetRect</span>(visibleRect, <span class="number">10</span>, <span class="number">10</span>);</span><br><span class="line">    visibleRect.size.height *= <span class="number">2.0</span>/<span class="number">3.0</span>;</span><br><span class="line">    win = [[<span class="built_in">NSWindow</span> alloc] initWithContentRect: <span class="built_in">NSMakeRect</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">100</span>, <span class="number">100</span>) styleMask:<span class="built_in">NSWindowStyleMaskTitled</span> backing:<span class="built_in">NSBackingStoreBuffered</span> defer:<span class="literal">NO</span>];</span><br><span class="line"></span><br><span class="line">    [win makeKeyAndOrderFront: <span class="literal">nil</span>];</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"Off we go"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure><p>è¿™æ®µä»£ç ä¼šè®©åº”ç”¨åœ¨å¯åŠ¨æ—¶å´©æºƒï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">* thread #1, queue = &apos;com.apple.main-thread&apos;, stop reason = EXC_BAD_ACCESS (code=EXC_I386_GPFLT)</span><br><span class="line">  * frame #0: 0x00007fff3ab3bf2d CoreFoundation`__CFNOTIFICATIONCENTER_IS_CALLING_OUT_TO_AN_OBSERVER__ + 13</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„å†…å®¹å¹¶ä¸æ˜¯ä¸€ä¸ªéå¸¸æœ‰ç”¨çš„è°ƒç”¨æ ˆä¿¡æ¯ã€‚è™½ç„¶æˆ‘ä»¬å¯ä»¥é€šè¿‡è°ƒè¯•è¿½æº¯é—®é¢˜ï¼Œä½†æ˜¯è¿™é‡Œæˆ‘ä»¬å°è¯•ä½¿ç”¨ C-Reduce æ¥è¿›è¡Œé—®é¢˜å®šä½ã€‚</p><p>è¿™é‡Œçš„ C-Reduce é¢„æœŸå®šä¹‰å°†åŒ…å«æ›´å¤šçš„å†…å®¹ã€‚é¦–å…ˆæˆ‘ä»¬éœ€è¦ç»™åº”ç”¨è®¾ç½®è¿è¡Œçš„è¶…æ—¶æ—¶é—´ã€‚æˆ‘ä»¬ä¼šåœ¨è¿è¡Œæ—¶è¿›è¡Œå´©æºƒæ•è·æ“ä½œï¼Œå¦‚æœæ²¡æœ‰å‘ç”Ÿå´©æºƒåˆ™ä¿æŒåº”ç”¨æ­£å¸¸è¿è¡Œç›´åˆ°è§¦å‘è¶…æ—¶å¤„ç†è€Œé€€å‡ºã€‚ä¸‹é¢æ˜¯ä¸€æ®µç½‘ä¸Šéšå¤„å¯è§çš„ <code>perl</code> è„šæœ¬ä»£ç ï¼š</p><figure class="highlight perl"><table><tr><td class="code"><pre><span class="line">function timeout() &#123; perl -e <span class="string">'alarm shift; exec @ARGV'</span> <span class="string">"$@"</span>; &#125;</span><br></pre></td></tr></table></figure><p>ç´§æ¥ç€æˆ‘ä»¬éœ€è¦æ‹·è´è¯¥å·¥ç¨‹æ–‡ä»¶ï¼š</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">cp -a ~/Development/creduce-examples/Crasher .</span><br></pre></td></tr></table></figure><p>ç„¶åå°†ä¿®æ”¹åçš„ <code>AppDelegate.m</code> æ–‡ä»¶æ‹·è´åˆ°åˆé€‚çš„è·¯å¾„ä¸‹ã€‚ï¼ˆæ³¨æ„ï¼šå¦‚æœæ–‡ä»¶å‘ç°åˆé€‚ç®€åŒ–ç‰ˆæœ¬ï¼ŒC-Reduce ä¼šå°†æ–‡ä»¶å¤åˆ¶å›æ¥ï¼Œæ‰€ä»¥ä¸€å®šè¦åœ¨è¿™é‡Œä½¿ç”¨ <code>cp</code> è€Œä¸æ˜¯ <code>mv</code>ã€‚ä½¿ç”¨ <code>mv</code> ä¼šå¯¼è‡´ä¸€ä¸ªå¥‡æ€ªçš„è‡´å‘½é”™è¯¯ã€‚ï¼‰</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">cp AppDelegate.m Crasher/Crasher</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥æˆ‘ä»¬åˆ‡æ¢åˆ° <code>Crasher</code> ç›®å½•æ‰§è¡Œç¼–è¯‘å‘½ä»¤ï¼Œå¹¶åœ¨å‘ç”Ÿé”™è¯¯æ—¶é€€å‡ºã€‚</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> Crasher</span><br><span class="line">xcodebuild || <span class="built_in">exit</span> 1</span><br></pre></td></tr></table></figure><p>å¦‚æœç¼–è¯‘æˆåŠŸï¼Œåˆ™è¿è¡Œåº”ç”¨å¹¶ä¸”è®¾ç½®è¶…æ—¶æ—¶é—´ã€‚æˆ‘çš„ç³»ç»Ÿå¯¹ç¼–è¯‘é¡¹è¿›è¡Œäº†è®¾ç½®ï¼Œæ‰€ä»¥ <code>xcodebuild</code> å‘½ä»¤ä¼šå°†ç¼–è¯‘ç»“æœå­˜æ”¾ç€æœ¬åœ° <code>build</code> ç›®å½•ä¸‹ã€‚å› ä¸ºé…ç½®å¯èƒ½å­˜åœ¨å·®å¼‚ï¼Œæ‰€ä»¥ä½ é¦–å…ˆéœ€è¦è‡ªè¡Œæ£€æŸ¥ã€‚å¦‚æœä½ å°†é…ç½®è®¾ä¸ºå…±äº«æ„å»ºç›®å½•çš„è¯ï¼Œé‚£ä¹ˆéœ€è¦åœ¨å‘½ä»¤è¡Œä¸­å¢åŠ  <code>â€”n 1</code> æ¥ç¦ç”¨ C-Reduce çš„å¹¶å‘æ„å»ºæ“ä½œã€‚</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">timeout 5 ./build/Release/Crasher.app/Contents/MacOS/Crasher</span><br></pre></td></tr></table></figure><p>å¦‚æœåº”ç”¨å‘ç”Ÿå´©æºƒçš„è¯ï¼Œé‚£ä¹ˆä¼šè¿”å›ç‰¹å®šçŠ¶æ€ç  139 ã€‚æ­¤æ—¶æˆ‘ä»¬éœ€è¦å°†å…¶è½¬åŒ–ä¸ºçŠ¶æ€ç  0 ï¼Œå…¶å®ƒæƒ…å½¢ç»Ÿç»Ÿè¿”å›çŠ¶æ€ç  1ã€‚</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> [ $? -eq 139 ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">exit</span> 0</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure><p>ç´§æ¥ç€ï¼Œæˆ‘ä»¬è¿è¡Œ C-Reduceï¼š</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ creduce interestingness.sh Crasher/AppDelegate.m</span><br><span class="line">...</span><br><span class="line">(78.1 %, 151 bytes)</span><br><span class="line">===================== <span class="keyword">done</span> ====================</span><br><span class="line"></span><br><span class="line">pass statistics:</span><br><span class="line">  method pass_ints :: a worked 1 <span class="built_in">times</span> and failed 2 <span class="built_in">times</span></span><br><span class="line">  method pass_balanced :: curly worked 1 <span class="built_in">times</span> and failed 3 <span class="built_in">times</span></span><br><span class="line">  method pass_clex :: rm-toks-7 worked 1 <span class="built_in">times</span> and failed 74 <span class="built_in">times</span></span><br><span class="line">  method pass_clex :: rename-toks worked 1 <span class="built_in">times</span> and failed 24 <span class="built_in">times</span></span><br><span class="line">  method pass_clex :: delete-string worked 1 <span class="built_in">times</span> and failed 3 <span class="built_in">times</span></span><br><span class="line">  method pass_blank :: 0 worked 1 <span class="built_in">times</span> and failed 1 <span class="built_in">times</span></span><br><span class="line">  method pass_comments :: 0 worked 1 <span class="built_in">times</span> and failed 0 <span class="built_in">times</span></span><br><span class="line">  method pass_indent :: final worked 1 <span class="built_in">times</span> and failed 0 <span class="built_in">times</span></span><br><span class="line">  method pass_indent :: regular worked 2 <span class="built_in">times</span> and failed 0 <span class="built_in">times</span></span><br><span class="line">  method pass_lines :: 8 worked 3 <span class="built_in">times</span> and failed 43 <span class="built_in">times</span></span><br><span class="line">  method pass_lines :: 2 worked 3 <span class="built_in">times</span> and failed 43 <span class="built_in">times</span></span><br><span class="line">  method pass_lines :: 6 worked 3 <span class="built_in">times</span> and failed 43 <span class="built_in">times</span></span><br><span class="line">  method pass_lines :: 10 worked 3 <span class="built_in">times</span> and failed 43 <span class="built_in">times</span></span><br><span class="line">  method pass_lines :: 4 worked 3 <span class="built_in">times</span> and failed 43 <span class="built_in">times</span></span><br><span class="line">  method pass_lines :: 3 worked 3 <span class="built_in">times</span> and failed 43 <span class="built_in">times</span></span><br><span class="line">  method pass_lines :: 0 worked 4 <span class="built_in">times</span> and failed 23 <span class="built_in">times</span></span><br><span class="line">  method pass_lines :: 1 worked 6 <span class="built_in">times</span> and failed 45 <span class="built_in">times</span></span><br><span class="line"></span><br><span class="line">******** /Users/mikeash/Development/creduce-examples/Crasher/Crasher/AppDelegate.m ********</span><br><span class="line"></span><br><span class="line"><span class="comment">#import "AppDelegate.h"</span></span><br><span class="line">@implementation AppDelegate</span><br><span class="line">- (void)applicationDidFinishLaunching:(NSRect)a &#123;</span><br><span class="line">    a = NSInsetRect(a, 0, 10);</span><br><span class="line">    NSLog(@<span class="string">""</span>);</span><br><span class="line">&#125;</span><br><span class="line">@end</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¾—åˆ°ä¸€ä¸ªæå…¶ç²¾ç®€çš„ä»£ç ã€‚è™½ç„¶ C-Reduce æ²¡æœ‰ç§»é™¤ <code>NSLog</code> é‚£è¡Œä»£ç ï¼Œä½†æ˜¯å´©æºƒçœ‹èµ·æ¥å¹¶ä¸æ˜¯å®ƒå¼•èµ·çš„ã€‚æ‰€ä»¥æ­¤å¤„å¯¼è‡´å´©æºƒçš„ä»£ç åªèƒ½æ˜¯ <code>a = NSInsetRect(a, 0, 10);</code> è¿™è¡Œä»£ç ã€‚é€šè¿‡æ£€æŸ¥è¯¥è¡Œä»£ç çš„åŠŸèƒ½å’Œä½¿ç”¨åˆ°çš„å˜é‡ï¼Œæˆ‘ä»¬èƒ½å‘ç°å®ƒä½¿ç”¨äº†ä¸€ä¸ª <code>NSRect</code> ç±»å‹çš„å˜é‡è€Œ <code>applicationDidFinishLaunching</code> å‡½æ•°çš„å…¥å‚å®é™…ä¸Šå¹¶ä¸æ˜¯è¯¥ç±»å‹ã€‚</p><figure class="highlight objc"><table><tr><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)applicationDidFinishLaunching:(<span class="built_in">NSNotification</span> *)notification;</span><br></pre></td></tr></table></figure><p>å› æ­¤è¯¥å´©æºƒåº”è¯¥æ˜¯ç”±äºç±»å‹ä¸åŒ¹é…å¯¼è‡´çš„é”™è¯¯å¼•èµ·çš„ã€‚</p><p>å› ä¸ºç¼–è¯‘å·¥ç¨‹çš„è€—æ—¶è¿œè¶…è¿‡å•æ–‡ä»¶è€Œä¸”å¾ˆå¤šæµ‹è¯•ç¤ºä¾‹éƒ½ä¼šè§¦å‘è¶…æ—¶å¤„ç†ï¼Œæ‰€ä»¥æ­¤ä¾‹ä¸­çš„ C-Reduce è¿è¡Œæ—¶é—´ä¼šæ¯”è¾ƒé•¿ã€‚C-Reduce ä¼šåœ¨æ¯æ¬¡è¿è¡ŒæˆåŠŸåå°†ç²¾ç®€çš„æ–‡ä»¶å†™å›åŸå§‹æ–‡ä»¶ï¼Œæ‰€ä»¥ä½ å¯ä»¥ä½¿ç”¨æ–‡æœ¬ç¼–è¾‘å™¨ä¿æŒæ–‡ä»¶çš„æ‰“å¼€çŠ¶æ€å¹¶æŸ¥çœ‹æ›´æ”¹ç»“æœã€‚å¦å¤–ä½ å¯ä»¥åœ¨åˆé€‚æ—¶æ—¶æœºè¿è¡Œ <code>^C</code> å‘½ä»¤ç»“æŸ C-Reduce æ‰§è¡Œï¼Œæ­¤æ—¶ä¼šå¾—åˆ°éƒ¨åˆ†ç²¾ç®€è¿‡çš„æ–‡ä»¶ã€‚å¦‚æœæœ‰å¿…è¦ä½ åç»­å¯ä»¥åœ¨æ­¤åŸºç¡€ä¸Šç»§ç»­è¿›è¡Œç²¾ç®€å·¥ä½œã€‚</p><h2 id="Swift"><a href="#Swift" class="headerlink" title="Swift"></a>Swift</h2><p>å¦‚æœæ‚¨ä½¿ç”¨ Swift å¹¶ä¸”ä¹Ÿæœ‰ç²¾ç®€éœ€æ±‚æ—¶è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿä»åå­—ä¸Šæ¥çœ‹ï¼Œæˆ‘åŸæœ¬ä»¥ä¸º C-Reduce åªé€‚ç”¨äº Cï¼ˆä¹Ÿè®¸è¿˜åŒ…æ‹¬ C++ï¼Œå› ä¸ºå¾ˆå¤šå·¥å…·éƒ½æ˜¯å¦‚æ­¤ï¼‰ã€‚</p><p>ä¸è¿‡å¥½åœ¨ï¼Œè¿™æ¬¡æˆ‘çš„ç›´è§‰é”™äº†ã€‚C-Reduce ç¡®å®æœ‰ä¸€äº›ä¸ C ç›¸å…³çš„ç‰¹å®šéªŒè¯æµ‹è¯•ï¼Œä½†å¤§éƒ¨åˆ†è¿˜æ˜¯å’Œè¯­è¨€æ— å…³çš„ã€‚æ— è®ºä½ ä½¿ç”¨ä½•ç§è¯­è¨€åªè¦ä½ èƒ½å†™å‡ºç›¸å…³çš„éªŒè¯æµ‹è¯•ï¼ŒC-Reduce éƒ½èƒ½æ´¾ä¸Šç”¨åœºï¼Œè™½ç„¶æ•ˆç‡å¯èƒ½ä¸æ˜¯å¾ˆç†æƒ³ã€‚</p><p>ä¸‹é¢æˆ‘ä»¬å°±æ¥è¯•ä¸€è¯•ã€‚æˆ‘åœ¨ bugs.swift.org ä¸Šé¢æ‰¾åˆ°äº†ä¸€ä¸ªå¾ˆå¥½çš„æµ‹è¯• <a href="https://bugs.swift.org/browse/SR-7354" target="_blank" rel="noopener">ç”¨ä¾‹</a>ã€‚ä¸è¿‡è¯¥å´©æºƒåªå‡ºç°åœ¨ Xcode9.3 ç‰ˆæœ¬ä¸Šï¼Œè€Œæˆ‘æ­£å¥½å°±å®‰è£…äº†è¯¥ç‰ˆæœ¬ã€‚ä¸‹é¢æ˜¯è¯¥ bug ç¤ºä¾‹çš„ç®€æ˜“ä¿®æ”¹ç‰ˆï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Foundation</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">crash</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">let</span> blah = <span class="type">ProblematicEnum</span>.problematicCase.problematicMethod()</span><br><span class="line">    <span class="type">NSLog</span>(<span class="string">"<span class="subst">\(blah)</span>"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">ProblematicEnum</span> </span>&#123;</span><br><span class="line">    <span class="keyword">case</span> first, second, problematicCase</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">problematicMethod</span><span class="params">()</span></span> -&gt; <span class="type">SomeClass</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> someVariable: <span class="type">SomeClass</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">switch</span> <span class="keyword">self</span> &#123;</span><br><span class="line">    <span class="keyword">case</span> .first:</span><br><span class="line">        someVariable = <span class="type">SomeClass</span>()</span><br><span class="line">    <span class="keyword">case</span> .second:</span><br><span class="line">        someVariable = <span class="type">SomeClass</span>()</span><br><span class="line">    <span class="keyword">case</span> .problematicCase:</span><br><span class="line">        someVariable = <span class="type">SomeClass</span>(someParameter: <span class="type">NSObject</span>())</span><br><span class="line">        <span class="number">_</span> = <span class="type">NSObject</span>().description</span><br><span class="line">        <span class="keyword">return</span> someVariable <span class="comment">// EXC_BAD_ACCESS (simulator: EXC_I386_GPFLT, device: code=1)</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="number">_</span> = [someVariable]</span><br><span class="line">    <span class="keyword">return</span> <span class="type">SomeClass</span>(someParameter: <span class="type">NSObject</span>())</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SomeClass</span>: <span class="title">NSObject</span> </span>&#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">init</span>() &#123;&#125;</span><br><span class="line">    <span class="keyword">init</span>(someParameter: <span class="type">NSObject</span>) &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">crash()</span><br></pre></td></tr></table></figure><p>å½“æˆ‘ä»¬å°è¯•åœ¨å¯ç”¨ä¼˜åŒ–çš„æƒ…å†µä¸‹è¿è¡Œä»£ç æ—¶ï¼Œä¼šå‡ºç°å¦‚ä¸‹ç»“æœï¼š</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ swift -O test.swift </span><br><span class="line">&lt;unknown&gt;:0: error: fatal error encountered during compilation; please file a bug report with your project and the crash <span class="built_in">log</span></span><br><span class="line">&lt;unknown&gt;:0: note: Program used external <span class="keyword">function</span> <span class="string">'__T04test15ProblematicEnumON'</span> <span class="built_in">which</span> could not be resolved!</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>ä¸ä¹‹å¯¹åº”çš„éªŒè¯è„šæœ¬ä¸ºï¼š</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">swift -O test.swift</span><br><span class="line"><span class="keyword">if</span> [ $? -eq 134 ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">exit</span> 0</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure><p>è¿è¡Œ C-Reduce ç¨‹åºæˆ‘ä»¬å¯ä»¥è¾¾åˆ°å¦‚ä¸‹çš„ç®€åŒ–ç‰ˆæœ¬ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">a</span> </span>&#123;</span><br><span class="line">    <span class="keyword">case</span> b, <span class="built_in">c</span>, d</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">e</span><span class="params">()</span></span> -&gt; f &#123;</span><br><span class="line">    <span class="keyword">switch</span> <span class="keyword">self</span> &#123;</span><br><span class="line">    <span class="keyword">case</span> .b:</span><br><span class="line">        <span class="number">0</span></span><br><span class="line">    <span class="keyword">case</span> .<span class="built_in">c</span>:</span><br><span class="line">        <span class="number">0</span></span><br><span class="line">    <span class="keyword">case</span> .d:</span><br><span class="line">        <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> f()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">f</span></span>&#123;&#125;</span><br></pre></td></tr></table></figure><p>æ·±å…¥è§£æè¯¥ç¼–è¯‘é”™è¯¯è¶…å‡ºäº†æœ¬æ–‡çš„èŒƒå›´ï¼Œä½†å¦‚æœæˆ‘ä»¬éœ€è¦å¯¹å…¶è¿›è¡Œä¿®å¤æ—¶ï¼Œè¯¥ç®€åŒ–ç‰ˆæœ¬æ˜¾ç„¶æ›´æ–¹ä¾¿ã€‚æˆ‘ä»¬å¾—åˆ°äº†ä¸€ä¸ªç›¸å½“ç®€å•çš„æµ‹è¯•ç”¨ä¾‹ã€‚ æˆ‘ä»¬è¿˜å¯ä»¥æ¨æ–­å‡º Swift è¯­å¥å’Œç±»çš„å®ä¾‹åŒ–ä¹‹é—´å­˜åœ¨ä¸€äº›äº¤äº’ï¼Œå¦åˆ™ C-Reduce å¯èƒ½ä¼šåˆ é™¤å…¶ä¸­ä¸€ä¸ªã€‚è¿™ä¸ºç¼–è¯‘å™¨å¯¼è‡´è¯¥å´©æºƒçš„åŸå› æä¾›äº†ä¸€äº›éå¸¸å¥½çš„æç¤ºã€‚</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>æµ‹è¯•ç¤ºä¾‹çš„ç›²çº¦ç²¾ç®€å¹¶ä¸æ˜¯ä¸€ç§å¤šå¤æ‚çš„è°ƒè¯•æŠ€æœ¯ï¼Œä½†æ˜¯è‡ªåŠ¨åŒ–è®©å…¶å˜çš„æ›´ä¸ºæœ‰ç”¨é«˜æ•ˆã€‚C-Reduce å¯ä»¥ä½œä¸ºä½ è°ƒè¯•å·¥å…·ç®±çš„ä¸€ä¸ªå¾ˆå¥½è¡¥å……ã€‚å®ƒå¹¶ä¸é€‚ç”¨æ‰€æœ‰åœºæ™¯ï¼Œä½†æ˜¯å®ƒåœ¨é¢å¯¹æœ‰äº›é—®é¢˜æ—¶èƒ½å¤Ÿå¸¦æ¥ä¸å°çš„å¸®åŠ©ã€‚è™½ç„¶åœ¨éœ€è¦ä¸å¤šæ–‡ä»¶æµ‹è¯•ç”¨ä¾‹ä¸€èµ·å·¥ä½œæ—¶å¯èƒ½å­˜åœ¨ä¸€äº›å›°éš¾ï¼Œä½†æ£€éªŒè„šæœ¬èƒ½å¤Ÿè§£å†³äº†è¯¥é—®é¢˜ã€‚å¦å¤–ï¼Œå¯¹äº Swift è¿™ç±»å…¶ä»–è¯­è¨€æ¥è¯´ C-Reduce ä¹Ÿæ˜¯å¼€ç®±å³ç”¨çš„ï¼Œè€Œä¸ä»…ä»…åªèƒ½åœ¨ C è¯­è¨€ä¸­å‘æŒ¥åŠŸæ•ˆï¼Œæ‰€ä»¥ä¸è¦å› ä¸ºä½ ä½¿ç”¨çš„è¯­è¨€ä¸æ˜¯ C è€Œæ”¾å¼ƒå®ƒã€‚</p><p>ä»Šå¤©å†…å®¹åˆ°æ­¤ä¸ºæ­¢ã€‚ä¸‹æ¬¡æˆ‘è¿˜ä¼šå¸¦æ¥ä¸ç¼–ç¨‹å’Œä»£ç ç›¸å…³çš„æ–°å†…å®¹ã€‚å½“ç„¶ä½ ä¹Ÿå¯ä»¥å°†ä½ æ„Ÿå…´è¶£çš„è¯é¢˜ <a href="mailto:mike@mikeash.com" target="_blank" rel="noopener">å‘é€ç»™æˆ‘</a>ã€‚</p><blockquote><p>æœ¬æ–‡ç”± SwiftGG ç¿»è¯‘ç»„ç¿»è¯‘ï¼Œå·²ç»è·å¾—ä½œè€…ç¿»è¯‘æˆæƒï¼Œæœ€æ–°æ–‡ç« è¯·è®¿é—® <a href="http://swift.gg">http://swift.gg</a>ã€‚</p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;ä½œè€…ï¼šMike Ashï¼Œ&lt;a href=&quot;https://www.mikeash.com/pyblog/friday-qa-2018-06-29-debugging-with-c-reduce.html&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;åŸæ–‡é“¾æ¥&lt;/a&gt;ï¼ŒåŸæ–‡æ—¥æœŸï¼š2018-06-29&lt;br&gt;è¯‘è€…ï¼š&lt;a href=&quot;https://bignerdcoding.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;BigNerdCoding&lt;/a&gt;ï¼›æ ¡å¯¹ï¼š&lt;a href=&quot;http://www.jianshu.com/users/596f2ba91ce9/latest_articles&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;pmst&lt;/a&gt;ï¼Œ&lt;a href=&quot;http://numbbbbb.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;numbbbbb&lt;/a&gt;ï¼›å®šç¨¿ï¼š&lt;a href=&quot;http://forelax.space&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Forelax&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;!--æ­¤å¤„å¼€å§‹æ­£æ–‡--&gt;
&lt;p&gt;è°ƒè¯•å¤æ‚é—®é¢˜æœ¬èº«å°±å¹¶ä¸è½»æ¾ï¼Œå¦‚æœè¿˜æ²¡æœ‰è¶³å¤Ÿçš„ä¸Šä¸‹æ–‡å’Œå¤§è‡´æ–¹å‘çš„è¯é‚£å°±æ˜¯ä¸€ä»¶éå¸¸å›°éš¾çš„äº‹ã€‚æ‰€ä»¥å¯¹ä»£ç è¿›è¡Œç²¾ç®€ç¼©å°è°ƒè¯•èŒƒå›´ä¹Ÿå°±å˜æˆäº†ä¸€ç§å¸¸è§çš„è¡Œä¸ºã€‚ä¸è¿‡ä¸ç¹æ‚çš„æ‰‹åŠ¨ç®€åŒ–ç›¸æ¯”ï¼Œæ‰§è¡Œè‡ªåŠ¨åŒ–å¤„ç†ç¨‹åºæ˜æ˜¾æ›´å®¹æ˜“å‘æŒ¥è®¡ç®—æœºè‡ªèº«çš„ä¼˜åŠ¿ã€‚C-Reduce æ­£æ˜¯ä¸ºæ­¤è€Œç”Ÿï¼Œå®ƒèƒ½è‡ªåŠ¨å¯¹åŸå§‹ä»£ç è¿›è¡Œç®€åŒ–æ“ä½œè¾“å‡ºä¸€ä¸ªç®€åŒ–çš„è°ƒè¯•å‹å¥½ç‰ˆæœ¬ã€‚ä¸‹é¢æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•ä½¿ç”¨è¯¥è‡ªåŠ¨åŒ–ç¨‹åºã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="Mike Ash" scheme="https://swift.gg/categories/Mike-Ash/"/>
    
    
      <category term="Debug" scheme="https://swift.gg/tags/Debug/"/>
    
      <category term="C-Reduce" scheme="https://swift.gg/tags/C-Reduce/"/>
    
  </entry>
  
  <entry>
    <title>iOS 12 ä¸­çš„ Siri Shortcuts ç®€ä»‹</title>
    <link href="https://swift.gg/2018/09/20/siri-shortcuts/"/>
    <id>https://swift.gg/2018/09/20/siri-shortcuts/</id>
    <published>2018-09-20T00:00:00.000Z</published>
    <updated>2019-02-18T08:52:03.568Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ä½œè€…ï¼šAppCodaï¼Œ<a href="https://appcoda.com/siri-shortcuts/" target="_blank" rel="noopener">åŸæ–‡é“¾æ¥</a>ï¼ŒåŸæ–‡æ—¥æœŸï¼š2018-07-11<br>è¯‘è€…ï¼š<a href="http://wuqiuhao.github.io" target="_blank" rel="noopener">Hale</a>ï¼›æ ¡å¯¹ï¼š<a href="http://xiaolu520.com/" target="_blank" rel="noopener">liberalisman</a>ï¼Œ<a href="http://numbbbbb.com/" target="_blank" rel="noopener">numbbbbb</a>ï¼Œ<a href="http://blog.yousanflics.com.cn" target="_blank" rel="noopener">Yousanflics</a>ï¼›å®šç¨¿ï¼š<a href="http://forelax.space" target="_blank" rel="noopener">Forelax</a></p></blockquote><!--æ­¤å¤„å¼€å§‹æ­£æ–‡--><p>åœ¨ç¾å›½åœ£ä½•å¡ä¸¾åŠçš„ 2018 å¼€å‘è€…å¤§ä¼šä¸Šï¼Œè‹¹æœå…¬å¸ƒäº† Siri Shortcutsï¼Œè¿™æ˜¯ä¸€ä¸ªä»¤äººæœŸå¾…å·²ä¹…çš„åŠŸèƒ½ï¼Œå¼€å‘äººå‘˜èƒ½å¤Ÿåœ¨è‡ªå·±çš„åº”ç”¨ç¨‹åºä¸­æ‰©å±•å’Œå¢å¼º Siri çš„åŠŸèƒ½ã€‚åœ¨è¿™ä¹‹å‰ï¼ŒSiriKit SDK çš„åŠŸèƒ½éå¸¸æœ‰é™ã€‚éšç€ Siri Shortcuts çš„å‡ºç°ï¼Œå¼€å‘äººå‘˜å¯ä»¥æ‰©å±• Siri çš„åŠŸèƒ½å¹¶é€šè¿‡æ„å»ºè‡ªå®šä¹‰è¯­éŸ³æ“ä½œæ¥å”¤èµ·åº”ç”¨ç¨‹åºã€‚</p><a id="more"></a><h2 id="Siri-Shortcuts-ç®€å²"><a href="#Siri-Shortcuts-ç®€å²" class="headerlink" title="Siri Shortcuts ç®€å²"></a>Siri Shortcuts ç®€å²</h2><p>Siri Shortcuts çš„æ ¸å¿ƒæ˜¯è‡ªåŠ¨åŒ–ã€‚Siri Shortcuts æ˜¯ç”±å‰ WWDC å¥–å­¦é‡‘è·å¾—è€…å¼€å‘çš„ iOS è‡ªåŠ¨åŒ–åº”ç”¨ç¨‹åº Workflow æ¼”å˜è€Œæ¥çš„ã€‚è‹¹æœåœ¨2017å¹´æ”¶è´­äº† Workflowï¼Œä½†å‡ºä¹æ„æ–™çš„æ˜¯ï¼Œå³ä¾¿åœ¨æ”¶è´­ä¹‹åï¼Œè¯¥åº”ç”¨ä¾ç„¶ç‹¬ç«‹çš„åœ¨ App Store ä¸Šçº¿ã€‚</p><p><img src="https://appcoda.com/wp-content/uploads/2018/07/workflow-app.jpg" alt=""></p><blockquote><p>Shortcuts è®©ä½ å¯ä»¥å°†åº”ç”¨ç¨‹åºçš„åŠŸèƒ½æš´éœ²ç»™ Siriã€‚</p></blockquote><p>Apple å…¨æ–°çš„ Siri Shortcuts å¤§é‡å€Ÿé‰´äº† Workflowã€‚ä½†æ˜¯åŒºåˆ†è¯­éŸ³ Shortcuts çŸ­å¥ä¸ Shortcuts åº”ç”¨æœ¬èº«è¿˜æ˜¯å¾ˆé‡è¦çš„ã€‚Shortcuts åº”ç”¨å…è®¸ç”¨æˆ·åŸºäºè¯­éŸ³çŸ­å¥åˆ›å»ºå¸¸è§çš„æ—¥å¸¸ä»»åŠ¡ï¼ŒSiri Shortcuts ä½¿å¼€å‘äººå‘˜èƒ½å¤Ÿåœ¨è‡ªå·±çš„åŸç”Ÿåº”ç”¨ç¨‹åºä¸­æ‰©å±• Siri çš„åŠŸèƒ½ã€‚</p><p>åœ¨æ’°å†™æœ¬æ–‡æ—¶ï¼ŒShortcuts åº”ç”¨ç¨‹åº æ— æ³•åœ¨ iOS 12 Beta 2 Build ä¸­è¿›è¡Œæµ‹è¯•ã€‚é‚£ä¹ˆï¼Œæˆ‘ä»¬å°†åœ¨è‡ªå·±æ„å»ºçš„è‡ªå®šä¹‰åº”ç”¨ç¨‹åºä¸­æ¢ç´¢ Siri Shortcuts çš„å®ç”¨åŠŸèƒ½ã€‚</p><h2 id="æˆ‘ä»¬çš„ç¤ºä¾‹å·¥ç¨‹"><a href="#æˆ‘ä»¬çš„ç¤ºä¾‹å·¥ç¨‹" class="headerlink" title="æˆ‘ä»¬çš„ç¤ºä¾‹å·¥ç¨‹"></a>æˆ‘ä»¬çš„ç¤ºä¾‹å·¥ç¨‹</h2><blockquote><p>æ³¨æ„ï¼šæœ¬æ•™ç¨‹å‡å®šä½ åŸºæœ¬ç†Ÿæ‚‰ NSUserActivity APIã€‚å¦‚æœä½ ä¸ç†Ÿæ‚‰ï¼Œè¯·å‚é˜…æˆ‘ä»¬å…³äºæ­¤ä¸»é¢˜çš„ <a href="https://www.appcoda.com/core-spotlight-framework/" target="_blank" rel="noopener">ä¼˜ç§€æ•™ç¨‹</a>ã€‚</p></blockquote><p>åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†æ¢ç©¶å¦‚ä½•åœ¨ä¸€ä¸ªç®€å•çš„é¡¹ç›®ä¸­åˆ©ç”¨ Siri Shortcutsï¼Œåœ¨ç”¨æˆ·è¯´å‡º â€œSay Hiâ€ ä¹‹ç±»çš„çŸ­è¯­æ—¶å¯åŠ¨æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºå¹¶å±•ç¤ºå‡ºä¸€ä¸ª UIAlertViewã€‚</p><p>æ­¤åº”ç”¨ç¨‹åºç®€å•æ¦‚è¿°äº†å¦‚ä½•åœ¨ä¸€ä¸ªå¤§å‹é¡¹ç›®ä¸­ä¸å¢åŠ å¤æ‚ä»£ç çš„å‰æä¸‹é›†æˆ Siri Shortcutsã€‚åœ¨æœ¬æ•™ç¨‹ç»“æŸæ—¶ï¼Œä½ åº”è¯¥æ‰å®æŒæ¡ Siri Shortcuts èƒŒåçš„ç”¨ä¾‹å’ŒæŠ€æœ¯ï¼Œå¹¶äº†è§£å¦‚ä½•å°†å®ƒä»¬ä¸ä½ çš„åº”ç”¨ç¨‹åºé›†æˆï¼</p><h2 id="åœ¨æ–°é¡¹ç›®ä¸­å®šä¹‰ä½ çš„-Shortcuts"><a href="#åœ¨æ–°é¡¹ç›®ä¸­å®šä¹‰ä½ çš„-Shortcuts" class="headerlink" title="åœ¨æ–°é¡¹ç›®ä¸­å®šä¹‰ä½ çš„ Shortcuts"></a>åœ¨æ–°é¡¹ç›®ä¸­å®šä¹‰ä½ çš„ Shortcuts</h2><p>å½“æˆ‘ä»¬åœ¨åˆ›å»ºä»»æ„æ–°é¡¹ç›®æ—¶ï¼ŒèŠ±ä¸€äº›æ—¶é—´æ¥å»ºç«‹åŸºæœ¬çš„é¡¹ç›®ç»“æ„æ˜¯å¾ˆé‡è¦çš„ã€‚é¦–å…ˆæˆ‘ä»¬éœ€è¦æœ‰ iOS 12ï¼ŒmacOS Mojave å’Œ Xcode 10 çš„æœ€æ–°å¼€å‘äººå‘˜é¢„è§ˆç‰ˆã€‚å¦‚æœä½ è¿˜æ²¡æœ‰å®‰è£…è¿™äº›ï¼Œä½ å¯ä»¥ä» <a href="https://developer.apple.com/" target="_blank" rel="noopener">å¼€å‘è€…ç½‘ç«™</a> ä¸‹è½½å®‰è£…ã€‚</p><p>åœ¨ Xcode åˆ›å»ºä¸€ä¸ªåä¸º <em>SiriShortcuts</em> çš„åº”ç”¨ç¨‹åºã€‚å°†ç»„ç»‡ ID è®¾ç½®ä¸º <code>com.appcoda</code>ï¼Œè¿™äº›åæœŸå¯ä»¥æŒ‰éœ€ä¿®æ”¹ã€‚</p><p><img src="https://appcoda.com/wp-content/uploads/2018/07/2-1240x793.png" alt=""></p><p>å¦‚ä¸‹æ‰€ç¤ºï¼Œåœ¨é¡¹ç›®çš„ <em>Project Settings</em> ä¸­é€‰æ‹© <em>Capabilities</em>ï¼Œå¯ç”¨ Siriã€‚æ¥ä¸‹æ¥æˆ‘ä»¬å°±å¯ä»¥åœ¨åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨ Siri SDKï¼Œå¹¶å°† .entitlements æ–‡ä»¶æ·»åŠ åˆ°é¡¹ç›®ä¸­ã€‚</p><p><img src="https://appcoda.com/wp-content/uploads/2018/07/4-1240x793.png" alt=""></p><p>å¯ç”¨ Sâ€‹â€‹iri åï¼ŒXcode ä¼šå°† <code>.entitlements</code> æ–‡ä»¶æ·»åŠ åˆ°é¡¹ç›®é‡Œã€‚ç„¶åå°† <code>Intents.framework</code> è¿™ä¸ªå…¨æ–°çš„æ¡†æ¶åŠ å…¥åˆ°é¡¹ç›®ä¸­ã€‚</p><p><img src="https://appcoda.com/wp-content/uploads/2018/07/7-1240x793.png" alt=""></p><p>æœ€åï¼Œåœ¨ <code>Info.plist</code> ä¸­æ·»åŠ  <code>NSUserActivityTypes</code>ã€‚è¯¥é¡¹çš„å€¼åº”è¯¥åŒ…å«ä½ çš„ Bundle ID ä»¥åŠå”¤é†’ Siri çš„è¡Œä¸º ï¼Œä¾‹å¦‚ â€œsayHiâ€ã€‚</p><p><img src="https://appcoda.com/wp-content/uploads/2018/07/8-1240x775.png" alt=""></p><h2 id="é›†æˆ-Shortcut"><a href="#é›†æˆ-Shortcut" class="headerlink" title="é›†æˆ Shortcut"></a>é›†æˆ Shortcut</h2><blockquote><p>è¦åˆ›å»ºä¸€ä¸ª Shortcut åº”ç”¨ï¼Œæˆ‘ä»¬é¦–å…ˆé…ç½® Shortcutï¼Œç„¶åå°† Shortcut é›†æˆåˆ°é¡¹ç›®ä¸­</p></blockquote><p>ç°åœ¨æˆ‘ä»¬çš„é¡¹ç›®å·²ç»å®Œæˆäº†æ‰€æœ‰ Shortcut çš„é…ç½®å·¥ä½œï¼Œæ˜¯æ—¶å€™å°† Shortcut é›†æˆåˆ°é¡¹ç›®ä¸­äº†ã€‚</p><p>æ ¹æ® Apple å¼€å‘è€…æ–‡æ¡£ï¼Œ</p><blockquote><p>æ¯æ¬¡ç”¨æˆ·åœ¨ä½ çš„åº”ç”¨ä¸­æ‰§è¡Œæ“ä½œæ—¶ï¼Œä½ éƒ½åº”è¯¥è¿›è¡Œä¸€æ¬¡ Shortcut é›†æˆã€‚ä¾‹å¦‚ï¼Œç”¨æˆ·å¯ä»¥ä½¿ç”¨ä½ çš„åº”ç”¨ä»é¤å…è®¢è´­æ±¤ï¼Œè¯·åœ¨ç”¨æˆ·ä¸‹è®¢å•åä¸ºæ”¯ä»˜æ“ä½œè¿›è¡Œ Shortcut é›†æˆã€‚å¦‚æœç”¨æˆ·æœªåœ¨ä½ çš„åº”ç”¨ä¸­æ‰§è¡Œæ“ä½œï¼Œåˆ™ä¸éœ€è¦è¿›è¡Œé›†æˆæ“ä½œã€‚</p></blockquote><p>æ˜¾ç„¶ï¼Œåªæœ‰åœ¨æä¾›æœ‰æ„ä¹‰çš„ç”¨ä¾‹æ—¶æˆ‘ä»¬æ‰éœ€è¦é›†æˆ Shortcutï¼Œä»è€Œå¢å¼ºåº”ç”¨ç¨‹åºçš„æ•´ä½“åŠŸèƒ½ã€‚</p><p>å›åˆ°ä»£ç ä¸­ï¼Œé¦–å…ˆæˆ‘ä»¬å‰å¾€ <code>ViewController.swift</code> æ–‡ä»¶ã€‚åœ¨ <code>viewDidLoad</code> æ–¹æ³•ä¹‹åï¼Œåˆ›å»ºä¸€ä¸ªåä¸º <code>setupIntents</code> çš„æ–°æ–¹æ³•ã€‚åœ¨æ­¤æ–¹æ³•ä¸­ï¼Œå®ç°æˆ‘ä»¬çš„ Siri Shortcuts ä»£ç ã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">setupIntents</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">let</span> activity = <span class="type">NSUserActivity</span>(activityType: <span class="string">"com.AppCoda.SiriSortcuts.sayHi"</span>) <span class="comment">// 1</span></span><br><span class="line">        activity.title = <span class="string">"Say Hi"</span> <span class="comment">// 2</span></span><br><span class="line">        activity.userInfo = [<span class="string">"speech"</span> : <span class="string">"hi"</span>] <span class="comment">// 3</span></span><br><span class="line">        activity.isEligibleForSearch = <span class="literal">true</span> <span class="comment">// 4</span></span><br><span class="line">        activity.isEligibleForPrediction = <span class="literal">true</span> <span class="comment">// 5</span></span><br><span class="line">        activity.persistentIdentifier = <span class="type">NSUserActivityPersistentIdentifier</span>(rawValue: <span class="string">"com.AppCoda.SiriSortcuts.sayHi"</span>) <span class="comment">// 6</span></span><br><span class="line">        view.userActivity = activity <span class="comment">// 7</span></span><br><span class="line">        activity.becomeCurrent() <span class="comment">// 8</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>è®©æˆ‘ä»¬æ¥çœ‹çœ‹è¿™æ®µä»£ç åšäº†ä»€ä¹ˆã€‚</p><ul><li><p>ç¬¬ä¸€è¡Œï¼Œæˆ‘ä»¬åˆ›å»ºäº† NSUserActivity å®ä¾‹å¹¶å°†æˆ‘ä»¬åœ¨ <code>Info.plist</code> æ–‡ä»¶ä¸­å®šä¹‰çš„æ ‡è¯†ç¬¦èµ‹å€¼ç»™ activityTypeã€‚</p></li><li><p>ç¬¬äºŒè¡Œï¼Œæˆ‘ä»¬å®šä¹‰äº† Activity çš„æ ‡é¢˜ã€‚ï¼ˆä¼šåº”ç”¨åœ¨è®¾ç½®ä¸­å¿ƒå’Œ Spotlight çš„æœç´¢ä¸­ã€‚å¦‚æœä½ å¯¹ NSUserActivity ä»¥åŠ spotlight æœç´¢ç´¢å¼•çš„å·¥ä½œæ–¹å¼ä¸æ˜¯å¾ˆç†Ÿæ‚‰ï¼Œæˆ‘å»ºè®®ä½ é˜…è¯»æˆ‘ä»¬å…³äºè¿™ä¸ªä¸»é¢˜çš„å…¶ä»–æ•™ç¨‹ã€‚ï¼‰</p></li><li><p>ç¬¬ä¸‰è¡Œï¼Œæˆ‘ä»¬æ·»åŠ äº†ä¸€ä¸ª <code>userInfo</code> å­—å…¸ã€‚æ ¹æ® Apple çš„è¯´æ³•ï¼Œ userInfo å­—å…¸åŒ…å«äº†åœ¨å¦ä¸€å°è®¾å¤‡ä¸Šç»§ç»­æ´»åŠ¨æ‰€éœ€çš„ä¸åº”ç”¨ç¨‹åºç›¸å…³çš„çŠ¶æ€ä¿¡æ¯ã€‚</p></li><li><p>ä¸‹ä¸€æ­¥ï¼Œæˆ‘ä»¬è®¾ç½® <code>.isEligibleForSearch</code> å‚æ•°ä¸º <code>true</code> ç„¶ååœ¨ä¸‹ä¸€è¡Œå¯ç”¨ <code>isEligibleForPrediction</code>ã€‚è¿™ä¸¤ä¸ªå±æ€§å…è®¸ iOS åœ¨è®¾å¤‡ä¸Šä¸ºæˆ‘ä»¬çš„ NSUserActivity æä¾›æœç´¢å’Œå»ºè®®ã€‚</p></li><li><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°† <code>persistentIdentifier</code> å±æ€§è®¾ç½®ä¸º NSUserActivityPersistentIdentifier çš„å®ä¾‹ï¼Œæ­¤å®ä¾‹ç”¨ä¸ç¬¬ä¸€è¡Œç›¸åŒçš„æ ‡è¯†ç¬¦è¿›è¡Œæ„é€ ã€‚</p></li><li><p>æœ€åï¼Œæˆ‘ä»¬å°†ä¸Šé¢åˆ›å»ºçš„ activity å®ä¾‹èµ‹å€¼ç»™è§†å›¾çš„ <code>userActivity</code> å±æ€§ï¼Œå¹¶è°ƒç”¨ <code>becomeCurrent()</code> æ–¹æ³•æ¥æ¿€æ´»æˆ‘ä»¬çš„ Activityã€‚</p></li></ul><p>æˆ‘ä»¬å†åˆ›å»ºå¦ä¸€ä¸ªåä¸º <code>sayHi()</code> çš„æ–¹æ³•å¹¶ç²˜è´´ä»¥ä¸‹ä»£ç ã€‚æ­¤ä»£ç åˆ›å»ºä¸€ä¸ª UIAlertController ä»¥æ˜¾ç¤ºæ¶ˆæ¯ã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">sayHi</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">let</span> alert = <span class="type">UIAlertController</span>(title: <span class="string">"Hi There!"</span>, message: <span class="string">"Hey there! Glad to see you got this working!"</span>, preferredStyle: <span class="type">UIAlertController</span>.<span class="type">Style</span>.alert)</span><br><span class="line">        alert.addAction(<span class="type">UIAlertAction</span>(title: <span class="string">"OK"</span>, style: <span class="type">UIAlertAction</span>.<span class="type">Style</span>.<span class="keyword">default</span>, handler: <span class="literal">nil</span>))</span><br><span class="line">        <span class="keyword">self</span>.present(alert, animated: <span class="literal">true</span>, completion: <span class="literal">nil</span>)</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>ä¸Šè¿°æ–¹æ³•å¾ˆç®€å•ï¼Œä¸»è¦ç”¨äºè¯´æ˜ Siri Shortcuts æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚å¦å¤–éœ€è¦æ³¨æ„è¿™æ˜¯ä¸€ä¸ª <strong>public</strong> å‡½æ•°ï¼Œå› ä¸ºæˆ‘ä»¬éœ€è¦åœ¨è§†å›¾æ§åˆ¶å™¨çš„ä½œç”¨åŸŸä¹‹å¤–ä½¿ç”¨å®ƒã€‚</p><h2 id="å…¬å¼€-Activity"><a href="#å…¬å¼€-Activity" class="headerlink" title="å…¬å¼€ Activity"></a>å…¬å¼€ Activity</h2><p>ç°åœ¨ï¼Œä½ å·²ç»åœ¨ <code>ViewController.swift</code> è®¾ç½®äº†åŸºæœ¬åŠŸèƒ½ï¼Œåˆ‡æ¢åˆ° <code>AppDelegate.swift</code> æ–‡ä»¶å¹¶æ·»åŠ  <code>application(_:continueUserActivity:restorationHandler)</code> æ–¹æ³•ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">application</span><span class="params">(<span class="number">_</span> application: UIApplication, <span class="keyword">continue</span> userActivity: NSUserActivity, restorationHandler: @escaping <span class="params">([UIUserActivityRestoring]?)</span></span></span> -&gt; <span class="type">Void</span>) -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> viewController = window?.rootViewController <span class="keyword">as</span>! <span class="type">ViewController</span></span><br><span class="line">  viewController.sayHi()</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šè¿°ä»£ç å°†æˆ‘ä»¬æ–°åˆ›å»ºçš„ Activity å…¬å¼€åœ¨åº”ç”¨å§”æ‰˜æ–¹æ³•ä¸­å¹¶å…è®¸ Siri å¯¹æ­¤ Activity è¿›è¡Œæ“ä½œå”¤èµ·åº”ç”¨ã€‚</p><p>ç°åœ¨è®©æˆ‘ä»¬è¯•è¯•çœ‹ï¼å¯¼èˆªåˆ°â€œè®¾ç½®â€åº”ç”¨å¹¶é€‰æ‹© Siriã€‚ä½ åº”è¯¥çœ‹åˆ°ä¸€ä¸ªåä¸º â€Say Hiâ€ çš„æ–°å¿«æ·æ–¹å¼ã€‚å•å‡» <code>+</code> æŒ‰é’®æ·»åŠ å®ƒï¼Œç„¶åæŒ‰ç…§å±å¹•ä¸Šçš„æç¤ºåˆ›å»ºè‡ªå®šä¹‰è¯­éŸ³çŸ­è¯­ä»¥åˆ›å»ºæ­¤å¿«æ·æ–¹å¼ã€‚</p><p>ç°åœ¨ä½ å¯ä»¥å”¤èµ· Siri å¹¶è¯´å‡ºä½ çš„çŸ­è¯­ï¼Œä½“éªŒ Shortcutï¼</p><p><img src="/img/articles/siri-shortcuts/006tNbRwgy1fvfvhpdhd4j31kw0jr1kx.jpg1537423351.9367192" alt=""></p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>æ­£å¦‚ä½ æ‰€è§ï¼Œåœ¨é¡¹ç›®ä¸­ä½¿ç”¨ NSUserActivity å¯ä»¥å¾ˆå®¹æ˜“åœ°å®ç° Siri Shortcuts çš„å¼ºå¤§åŠŸèƒ½ã€‚åœ¨æœ¬æ•™ç¨‹ä¸­,æˆ‘åˆ›å»ºäº†ä¸€ä¸ªåŸºç¡€çš„åº”ç”¨ï¼ŒåŒæ ·çš„ä½ ä¹Ÿå¯ä»¥å°†è¿™äº›æŠ€æœ¯åº”ç”¨åˆ°ä½ è‡ªå·±çš„åº”ç”¨ä¸­ã€‚Siri Shortcuts çš„ä½¿ç”¨åœºæ™¯è¿˜æœ‰å¾ˆå¤šï¼Œç›¸ä¿¡å¼€å‘è€…ä»¬ä¼šä»¥æ›´åˆ›æ–°å’Œç‹¬ç‰¹çš„æ–¹å¼æ¥ä½¿ç”¨è¿™é¡¹æ–°æŠ€æœ¯ã€‚</p><blockquote><p>æœ¬æ–‡ç”± SwiftGG ç¿»è¯‘ç»„ç¿»è¯‘ï¼Œå·²ç»è·å¾—ä½œè€…ç¿»è¯‘æˆæƒï¼Œæœ€æ–°æ–‡ç« è¯·è®¿é—® <a href="http://swift.gg">http://swift.gg</a>ã€‚</p></blockquote>]]></content>
    
    <summary type="html">
    
      æœ¬æ–‡ä»‹ç»äº†åŸºäº iOS12 å’Œ XCode10 åˆ›å»º NSUserActivity å°†ç¤ºä¾‹åº”ç”¨æ”¯æŒ Siri Shortcutsï¼Œå¹¶åœ¨è®¾ç½®ä¸­è‡ªå®šä¹‰ Siri çŸ­è¯­ä»¥å”¤èµ·åº”ç”¨è§¦å‘äº‹ä»¶ã€‚
    
    </summary>
    
      <category term="AppCoda" scheme="https://swift.gg/categories/AppCoda/"/>
    
    
      <category term="Swift" scheme="https://swift.gg/tags/Swift/"/>
    
  </entry>
  
  <entry>
    <title>Swift ä¸­çš„å±æ€§</title>
    <link href="https://swift.gg/2018/09/18/properties-in-swift/"/>
    <id>https://swift.gg/2018/09/18/properties-in-swift/</id>
    <published>2018-09-18T00:00:00.000Z</published>
    <updated>2019-02-18T08:52:03.568Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ä½œè€…ï¼šThomas Hanningï¼Œ<a href="http://www.thomashanning.com/properties-in-swift/" target="_blank" rel="noopener">åŸæ–‡é“¾æ¥</a>ï¼ŒåŸæ–‡æ—¥æœŸï¼š2018-03-15<br>è¯‘è€…ï¼š<a href="https://www.sunnyyoung.net/" target="_blank" rel="noopener">Sunnyyoung</a>ï¼›æ ¡å¯¹ï¼š<a href="http://linusling.com" target="_blank" rel="noopener">å°é“åŒ Linus</a>ï¼Œ<a href="http://numbbbbb.com/" target="_blank" rel="noopener">numbbbbb</a>ï¼›å®šç¨¿ï¼š<a href="http://forelax.space" target="_blank" rel="noopener">Forelax</a></p></blockquote><!--æ­¤å¤„å¼€å§‹æ­£æ–‡--><p>Swift ä¸­æœ‰ä¸¤ç§ç±»å‹çš„å±æ€§ï¼šå­˜å‚¨å±æ€§ä¸è®¡ç®—å±æ€§ã€‚å­˜å‚¨å±æ€§å°†å€¼ï¼ˆå¸¸é‡æˆ–è€…å˜é‡ï¼‰ä¿å­˜ä¸ºå®ä¾‹æˆ–ç±»å‹çš„ä¸€éƒ¨åˆ†ï¼Œè€Œè®¡ç®—å±æ€§æ²¡æœ‰å­˜å‚¨å€¼ã€‚</p><p>æç¤ºï¼šè¿™ç¯‡æ–‡ç« å·²ç»æ›´æ–°è‡³ Swift 4ã€‚</p><a id="more"></a><h2 id="å­˜å‚¨å±æ€§"><a href="#å­˜å‚¨å±æ€§" class="headerlink" title="å­˜å‚¨å±æ€§"></a>å­˜å‚¨å±æ€§</h2><p>è®©æˆ‘ä»¬ä»å­˜å‚¨å±æ€§å¼€å§‹çœ‹èµ·ã€‚æƒ³è±¡ä¸€ä¸‹ä½ æœ‰ä¸€ä¸ªåä¸º Circle çš„ç±»ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Circle</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> radius: <span class="type">Double</span> = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> circle = <span class="type">Circle</span>()</span><br><span class="line">circle.radius = <span class="number">10</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">"radius: <span class="subst">\(circle.radius)</span>"</span>) <span class="comment">//radius: 10.0</span></span><br></pre></td></tr></table></figure><p>Circle æ‹¥æœ‰åä¸º <code>radius</code> çš„å®ä¾‹å˜é‡ï¼Œé»˜è®¤å€¼ä¸º 0ã€‚åœ¨ Swift ä¸­ï¼Œæ¯ä¸ªå®ä¾‹å˜é‡éƒ½ä¸ºä¸€ä¸ªå±æ€§ã€‚å› æ­¤ä½ å¯ä»¥æ·»åŠ æ‰€è°“çš„å±æ€§è§‚å¯Ÿè€…ã€‚åœ¨ Swift ä¸­æœ‰ä¸¤ç§ç±»å‹çš„å±æ€§è§‚å¯Ÿè€…ï¼šä¸€ç§åœ¨èµ‹å€¼ä¹‹å‰è°ƒç”¨ï¼Œå¦ä¸€ç§åœ¨èµ‹å€¼ä¹‹åè°ƒç”¨ã€‚</p><p>åœ¨èµ‹å€¼åè°ƒç”¨çš„å±æ€§è§‚å¯Ÿè€…é‡‡ç”¨ <code>didSet</code> å…³é”®å­—æ ‡è®°ã€‚åœ¨æˆ‘ä»¬çš„ç¤ºä¾‹ä¸­ï¼Œä½ å¯ä»¥ä½¿ç”¨å®ƒæ¥ç›‘æµ‹æ–°è®¾ç½®çš„å€¼ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Circle</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> radius: <span class="type">Double</span> = <span class="number">0</span> &#123;</span><br><span class="line">        <span class="keyword">didSet</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> radius &lt; <span class="number">0</span> &#123;</span><br><span class="line">                radius = oldValue</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">let</span> circle = <span class="type">Circle</span>()</span><br><span class="line"> </span><br><span class="line">circle.radius = -<span class="number">10</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">"radius: <span class="subst">\(circle.radius)</span>"</span>) <span class="comment">//radius: 0.0</span></span><br><span class="line"> </span><br><span class="line">circle.radius = <span class="number">10</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">"radius: <span class="subst">\(circle.radius)</span>"</span>) <span class="comment">//radius: 10.0</span></span><br></pre></td></tr></table></figure><p>åœ¨å±æ€§è§‚å¯Ÿè€…ä¸­ä½ å¯ä»¥é€šè¿‡å˜é‡ <code>oldValue</code> æ¥è®¿é—®å±æ€§çš„æ—§å€¼ã€‚</p><p>ä½ è¿˜å¯ä»¥ä½¿ç”¨ <code>willSet</code> å±æ€§è§‚å¯Ÿè€…ï¼Œå®ƒåœ¨èµ‹å€¼ä¹‹å‰ä¼šè¢«è°ƒç”¨ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Circle</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> radius: <span class="type">Double</span> = <span class="number">0</span> &#123;</span><br><span class="line">        <span class="keyword">willSet</span> &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"About to assign the new value <span class="subst">\(newValue)</span>"</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">didSet</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> radius &lt; <span class="number">0</span> &#123;</span><br><span class="line">                radius = oldValue</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">let</span> circle = <span class="type">Circle</span>()</span><br><span class="line"> </span><br><span class="line">circle.radius = <span class="number">10</span> <span class="comment">//è®¾ç½®æ–°å€¼ 10.0</span></span><br></pre></td></tr></table></figure><p>åœ¨ <code>willSet</code> ä¸­ï¼Œä½ å¯ä»¥é€šè¿‡å˜é‡ <code>newValue</code> æ¥è®¿é—®å±æ€§çš„æ–°å€¼ã€‚</p><h2 id="è®¡ç®—å±æ€§"><a href="#è®¡ç®—å±æ€§" class="headerlink" title="è®¡ç®—å±æ€§"></a>è®¡ç®—å±æ€§</h2><p>ä¸å­˜å‚¨å±æ€§ä¸åŒçš„æ˜¯ï¼Œè®¡ç®—å±æ€§å¹¶ä¸ä¼šå­˜å‚¨å±æ€§çš„å€¼ã€‚å› æ­¤åœ¨æ¯æ¬¡è°ƒç”¨è®¡ç®—å±æ€§æ—¶ï¼Œéƒ½è¦è®¡ç®—è¯¥å€¼ã€‚åœ¨ <code>Circle</code> ç±»ä¸­ï¼Œä½ å¯ä»¥å°†å±æ€§ <code>area</code> å®šä¹‰ä¸ºè®¡ç®—å±æ€§ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Circle</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> radius: <span class="type">Double</span> = <span class="number">0</span> &#123;</span><br><span class="line">        <span class="keyword">didSet</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> radius &lt; <span class="number">0</span> &#123;</span><br><span class="line">                radius = oldValue</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> area: <span class="type">Double</span> &#123;</span><br><span class="line">        <span class="keyword">get</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> radius * radius * <span class="type">Double</span>.pi</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> circle = <span class="type">Circle</span>()</span><br><span class="line">circle.radius = <span class="number">5</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">"area: <span class="subst">\(circle.area)</span>"</span>) <span class="comment">//area: 78.5398163397448</span></span><br></pre></td></tr></table></figure><p>è®¡ç®—å±æ€§æ€»æ˜¯éœ€è¦ä¸€ä¸ª <code>getter</code>ã€‚å¦‚æœç¼ºå°‘ <code>setter</code>ï¼Œåˆ™è¯¥å±æ€§è¢«ç§°ä¸ºåªè¯»å±æ€§ã€‚ä¸‹é¢è¿™ä¸ªä¾‹å­å¾ˆå¥½åœ°è¯´æ˜äº† <code>setter</code> çš„ä½œç”¨ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Foundation</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Circle</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> radius: <span class="type">Double</span> = <span class="number">0</span> &#123;</span><br><span class="line">        <span class="keyword">didSet</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> radius &lt; <span class="number">0</span> &#123;</span><br><span class="line">                radius = oldValue</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> area: <span class="type">Double</span> &#123;</span><br><span class="line">        <span class="keyword">get</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> radius * radius * <span class="type">Double</span>.pi</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">set</span>(newArea) &#123;</span><br><span class="line">            radius = sqrt(newArea / <span class="type">Double</span>.pi)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> circle = <span class="type">Circle</span>()</span><br><span class="line"></span><br><span class="line">circle.area = <span class="number">25</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">"radius: <span class="subst">\(circle.radius)</span>"</span>) <span class="comment">//radius: 2.82094791773878</span></span><br></pre></td></tr></table></figure><p>è‡³æ­¤ï¼Œæ¯æ¬¡å¯¹ area è®¾ç½®äº†æ–°çš„å€¼ä¹‹åï¼Œradius éƒ½ä¼šè¢«é‡æ–°è®¡ç®—ã€‚</p><h2 id="å­˜å‚¨å±æ€§çš„åˆå§‹åŒ–"><a href="#å­˜å‚¨å±æ€§çš„åˆå§‹åŒ–" class="headerlink" title="å­˜å‚¨å±æ€§çš„åˆå§‹åŒ–"></a>å­˜å‚¨å±æ€§çš„åˆå§‹åŒ–</h2><p>æ¯ä¸ªå­˜å‚¨å±æ€§åœ¨å®ƒçš„å¯¹è±¡å®ä¾‹åŒ–ä¹‹åéƒ½å¿…é¡»æœ‰å€¼ã€‚å±æ€§åˆå§‹åŒ–æœ‰ä¸¤ç§æ–¹æ³•ï¼š</p><ul><li>åœ¨ <code>init</code> æ–¹æ³•ä¸­åˆå§‹åŒ–å€¼</li><li>ç»™å±æ€§è®¾ç½®é»˜è®¤çš„å€¼</li></ul><p>ä¸‹é¢çš„ä¾‹å­åŒæ—¶ä½¿ç”¨äº†è¿™ä¸¤ç§æ–¹æ³•ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Circle</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> radius: <span class="type">Double</span></span><br><span class="line">    <span class="keyword">var</span> identifier: <span class="type">Int</span> = <span class="number">0</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">init</span>(radius: <span class="type">Double</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.radius = radius</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> circle = <span class="type">Circle</span>(radius: <span class="number">5</span>)</span><br></pre></td></tr></table></figure><p>å¦‚æœå­˜å‚¨å±æ€§åœ¨å¯¹è±¡å®ä¾‹åŒ–ä¹‹åæ²¡æœ‰å€¼ï¼Œä»£ç æ— æ³•é€šè¿‡ç¼–è¯‘ã€‚</p><h2 id="æ‡’åŠ è½½å±æ€§"><a href="#æ‡’åŠ è½½å±æ€§" class="headerlink" title="æ‡’åŠ è½½å±æ€§"></a>æ‡’åŠ è½½å±æ€§</h2><p>å¦‚æœå…·æœ‰é»˜è®¤å€¼çš„å­˜å‚¨å±æ€§ä½¿ç”¨äº†å…³é”®å­— <code>lazy</code> æ ‡è®°ï¼Œåˆ™å…¶é»˜è®¤å€¼ä¸ä¼šç«‹å³åˆå§‹åŒ–ï¼Œè€Œæ˜¯åœ¨ç¬¬ä¸€æ¬¡è®¿é—®è¯¥å±æ€§æ—¶åˆå§‹åŒ–ã€‚</p><p>å› æ­¤ï¼Œå¦‚æœè¯¥å±æ€§ä»æœªè¢«è®¿é—®ï¼Œå®ƒå°†æ°¸è¿œä¸ä¼šè¢«åˆå§‹åŒ–ã€‚ä½ å¯ä»¥å°†è¿™ç§ç‰¹æ€§åº”ç”¨äºä¸€äº›ç‰¹åˆ«è€—è´¹ CPU æˆ–å†…å­˜çš„åˆå§‹åŒ–ä¸Šã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestClass</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">lazy</span> <span class="keyword">var</span> testString: <span class="type">String</span> = <span class="string">"TestString"</span></span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">let</span> testClass = <span class="type">TestClass</span>()</span><br><span class="line"><span class="built_in">print</span>(testClass.testString) <span class="comment">//TestString</span></span><br></pre></td></tr></table></figure><p>è¯¥å±æ€§åœ¨è¢«è®¿é—®ä¹‹å‰ä¸ä¼šè¿›è¡Œåˆå§‹åŒ–ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­å¹¶ä¸å®¹æ˜“çœ‹å‡ºæ¥ã€‚ä½†ç”±äºåˆå§‹åŒ–ä¹Ÿå¯ä»¥åœ¨ block é‡Œé¢å®ç°ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿å®ƒæ›´æ˜æ˜¾ä¸€äº›ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestClass</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">lazy</span> <span class="keyword">var</span> testString: <span class="type">String</span> = &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"about to initialize the property"</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"TestString"</span></span><br><span class="line">    &#125;()</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> testClass = <span class="type">TestClass</span>()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">"before first call"</span>)</span><br><span class="line"><span class="built_in">print</span>(testClass.testString)</span><br><span class="line"><span class="built_in">print</span>(testClass.testString)</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªä¾‹å­çš„è¾“å‡ºï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">before first call</span><br><span class="line">about to initialize the property</span><br><span class="line">TestString</span><br><span class="line">TestString</span><br></pre></td></tr></table></figure><p>è¿™æ„å‘³ç€è¯¥ block ä»…è¢«è°ƒç”¨ä¸€æ¬¡ - ç¬¬ä¸€æ¬¡è®¿é—®è¯¥å±æ€§çš„æ—¶å€™ã€‚ç”±äºå­˜å‚¨å±æ€§æ˜¯å¯å˜çš„ï¼Œå› æ­¤å¯ä»¥æ›´æ”¹åˆå§‹å€¼ã€‚</p><h2 id="ç±»å‹å±æ€§"><a href="#ç±»å‹å±æ€§" class="headerlink" title="ç±»å‹å±æ€§"></a>ç±»å‹å±æ€§</h2><p>ç±»å‹å±æ€§æ˜¯ç±»çš„ä¸€éƒ¨åˆ†ï¼Œä½†ä¸æ˜¯å®ä¾‹çš„ä¸€éƒ¨åˆ†ï¼Œç±»å‹å±æ€§ä¹Ÿè¢«ç§°ä¸ºé™æ€å±æ€§ã€‚å­˜å‚¨å±æ€§å’Œè®¡ç®—å±æ€§éƒ½å¯ä»¥æ˜¯ç±»å‹å±æ€§ã€‚ç±»å‹å±æ€§çš„å…³é”®å­—æ˜¯ <code>static</code>ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestClass</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> testString: <span class="type">String</span> = <span class="string">"TestString"</span></span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="built_in">print</span>(<span class="string">"<span class="subst">\(TestClass.testString)</span>"</span>) <span class="comment">//TestString</span></span><br></pre></td></tr></table></figure><p>å¦‚ä½ æ‰€è§ï¼Œå®ƒä»¬ä½¿ç”¨ç±»åè€Œä¸æ˜¯å®ä¾‹å¯¹è±¡æ¥è®¿é—®å®ƒä»¬ã€‚æ­¤å¤–ï¼Œç”±äºç±»å‹å±æ€§æ²¡æœ‰åˆå§‹åŒ–æ–¹æ³•ï¼Œå®ƒæ€»æ˜¯éœ€è¦ä¸€ä¸ªé»˜è®¤å€¼ã€‚</p><h2 id="æ‹¥æœ‰ç§æœ‰-Setter-çš„å…¬å…±å±æ€§"><a href="#æ‹¥æœ‰ç§æœ‰-Setter-çš„å…¬å…±å±æ€§" class="headerlink" title="æ‹¥æœ‰ç§æœ‰ Setter çš„å…¬å…±å±æ€§"></a>æ‹¥æœ‰ç§æœ‰ Setter çš„å…¬å…±å±æ€§</h2><p>æ­£å¦‚æˆ‘åœ¨ <a href="http://www.thomashanning.com/public-properties-with-private-setters/" target="_blank" rel="noopener">å¦ä¸€ç¯‡æ–‡ç« </a> ä¸­ä»‹ç»çš„é‚£æ ·ï¼Œè¿™æ˜¯ä¸€ç§å¸¸è§çš„æƒ…å†µï¼Œä½ ä¸æƒ³æä¾›ä¸€ä¸ªå…¬å…±çš„ setterï¼Œè€Œæ˜¯æä¾›ä¸€ä¸ªç§æœ‰çš„ setterã€‚è¿™æ˜¯å°è£…çš„åŸºæœ¬åŸåˆ™ã€‚è¿™æ ·åªæœ‰ç±»æœ¬èº«å¯ä»¥æ“ä½œè¯¥å±æ€§ï¼Œä½†ä»å¯ä»ç±»å¤–éƒ¨è®¿é—®è¯»å–å®ƒã€‚</p><p>æ¥çœ‹ä¸‹é¢çš„ä¾‹å­ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Circle</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">private</span>(<span class="keyword">set</span>) <span class="keyword">var</span> area: <span class="type">Double</span> = <span class="number">0</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">private</span>(<span class="keyword">set</span>) <span class="keyword">var</span> diameter: <span class="type">Double</span> = <span class="number">0</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">var</span> radius: <span class="type">Double</span> &#123;</span><br><span class="line">        <span class="keyword">didSet</span> &#123;</span><br><span class="line">            calculateFigures()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">init</span>(radius:<span class="type">Double</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.radius = radius</span><br><span class="line">        calculateFigures()</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">calculateFigures</span><span class="params">()</span></span> &#123;</span><br><span class="line">        area = <span class="type">Double</span>.pi * radius * radius</span><br><span class="line">        diameter = <span class="number">2</span> * <span class="type">Double</span>.pi * radius</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> circle = <span class="type">Circle</span>(radius: <span class="number">5</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">"area: <span class="subst">\(circle.area)</span>"</span>) <span class="comment">//area: 78.5398163397448</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">"diameter: <span class="subst">\(circle.diameter)</span>"</span>) <span class="comment">//diameter: 31.4159265358979</span></span><br><span class="line"></span><br><span class="line">circle.area = <span class="number">10</span> <span class="comment">//ç¼–è¯‘é”™è¯¯ï¼šæ— æ³•å¯¹ 'area' å±æ€§è¿›è¡Œèµ‹å€¼ï¼Œå› ä¸º setter æ–¹æ³•ä¸å¯è®¿é—®</span></span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„å±æ€§ <code>area</code> å’Œ <code>diameter</code> å¯ä»¥ä»ç±»çš„å¤–éƒ¨è®¿é—®ï¼Œä½†åªèƒ½åœ¨ç±»å†…éƒ¨èµ‹å€¼ã€‚ä¸ºæ­¤ä½ å¿…é¡»ä½¿ç”¨ <code>public private(set)</code> çš„ç»„åˆã€‚æ ¹æ®æœ¬äººçš„ç»éªŒï¼Œè¿™ä¸ªç‰¹æ€§åœ¨ iOS å¼€å‘ä¸­å¾ˆå°‘ä½¿ç”¨ï¼Œä½†å®ƒå¯¹å†™å‡ºæ›´å°‘ bug çš„ä»£ç å¾ˆæœ‰å¸®åŠ©ã€‚</p><blockquote><p>æœ¬æ–‡ç”± SwiftGG ç¿»è¯‘ç»„ç¿»è¯‘ï¼Œå·²ç»è·å¾—ä½œè€…ç¿»è¯‘æˆæƒï¼Œæœ€æ–°æ–‡ç« è¯·è®¿é—® <a href="http://swift.gg">http://swift.gg</a>ã€‚</p></blockquote>]]></content>
    
    <summary type="html">
    
      æœ¬æ–‡ç®€å•ä»‹ç»äº† Swift ä¸­çš„å±æ€§
    
    </summary>
    
      <category term="Thomas Hanning" scheme="https://swift.gg/categories/Thomas-Hanning/"/>
    
    
      <category term="Swift" scheme="https://swift.gg/tags/Swift/"/>
    
  </entry>
  
  <entry>
    <title>åœ¨åºåˆ—çš„é“¾å¼æ“ä½œä¸­æ³¨å…¥å‰¯ä½œç”¨</title>
    <link href="https://swift.gg/2018/09/13/chained-foreach/"/>
    <id>https://swift.gg/2018/09/13/chained-foreach/</id>
    <published>2018-09-13T00:00:00.000Z</published>
    <updated>2019-02-18T08:52:03.568Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ä½œè€…ï¼šArthur Knopperï¼Œ<a href="https://oleb.net/blog/2017/10/chained-foreach/" target="_blank" rel="noopener">åŸæ–‡é“¾æ¥</a>ï¼ŒåŸæ–‡æ—¥æœŸï¼š2017/10/30<br>è¯‘è€…ï¼š<a href="https://dingtz.com/" target="_blank" rel="noopener">jojotov</a>ï¼›æ ¡å¯¹ï¼š<a href="http://forelax.space" target="_blank" rel="noopener">Forelax</a>ï¼Œ<a href="https://github.com/Cee" target="_blank" rel="noopener">Cee</a>ï¼›å®šç¨¿ï¼š<a href="http://forelax.space" target="_blank" rel="noopener">Forelax</a></p></blockquote><!--æ­¤å¤„å¼€å§‹æ­£æ–‡--><p>å‡ å‘¨å‰ï¼Œä¸€ä½è¯»è€…æŒ‡å‡ºäº† <a href="https://oleb.net/advanced-swift/" target="_blank" rel="noopener"><em>Advanced Swift</em></a> ä¸­çš„<a href="https://twitter.com/jasonalexzurita/status/915972380685516800" target="_blank" rel="noopener">ä¸€å¤„é”™è¯¯</a>ã€‚æˆ‘ä»¬å½“æ—¶è¿™æ ·æè¿° Swift ä¸­çš„ <code>forEach</code> æ–¹æ³•ï¼š</p><blockquote><p><code>forEach</code> ä½œä¸ºä¸€ç³»åˆ—é“¾å¼è°ƒç”¨ä¸­çš„ä¸€éƒ¨åˆ†æ—¶ç¡®å®å¯ä»¥å¤§æ”¾å¼‚å½©ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œè¯•æƒ³ä¸€ä¸‹ä½ åœ¨ä¸€ä¸ªè¯­å¥ä¸­é€šè¿‡é“¾å¼è°ƒç”¨çš„æ–¹å¼è°ƒç”¨äº†å‡ æ¬¡ <code>map</code> å’Œ <code>filter</code> æ–¹æ³•ã€‚åœ¨è°ƒè¯•è¿™æ®µä»£ç æ—¶ï¼Œä½ å¸Œæœ›èƒ½å¤Ÿæ‰“å°å‡ºæŸå‡ æ­¥æ“ä½œä¸­é—´çš„å€¼ã€‚è¦è¾¾æˆè¿™ä¸€ç›®çš„ï¼Œåœ¨ä½ æœŸæœ›çš„ä½ç½®æ’å…¥ä¸€ä¸ª <code>forEach</code> æˆ–è®¸æ˜¯æœ€å¿«é€Ÿçš„è§£å†³æ–¹å¼ã€‚</p></blockquote><p>å½“æˆ‘å†™ä¸‹è¿™æ®µæè¿°æ—¶ï¼Œä¼—å¤šç¾å¦™çš„æƒ³æ³•æ¶Œç°åœ¨æˆ‘è„‘ä¸­ï¼Œå› ä¸ºè¿™å¬èµ·æ¥æ˜¯ä¸ªéå¸¸å®ç”¨çš„ç‰¹æ€§<a href="#foot1" id="1"><sup>[1]</sup></a>ï¼ˆä½ å¹¶ä¸èƒ½é€šè¿‡ <code>for-in</code> å¾ªç¯è¾¾åˆ°è¿™ç§æ•ˆæœï¼‰ã€‚å¯äº‹å®å´å¦‚æ­¤çš„æ®‹é…· â€”â€” ä½ ä¸èƒ½åœ¨ä¸€ç³»åˆ—é“¾å¼è°ƒç”¨ä¸­é—´æ’å…¥ <code>forEach</code>ï¼</p><a id="more"></a><h2 id="ç†æƒ³ä¸­çš„å½¢å¼"><a href="#ç†æƒ³ä¸­çš„å½¢å¼" class="headerlink" title="ç†æƒ³ä¸­çš„å½¢å¼"></a>ç†æƒ³ä¸­çš„å½¢å¼</h2><p>ä¸ºäº†ä»¥ä»£ç çš„å½¢å¼æ›´å¥½åœ°é˜è¿°æˆ‘çš„æƒ³æ³•ï¼Œå…ˆè®©æˆ‘ä»¬è®¾æƒ³æœ‰å¦‚ä¸‹ä¸€ç³»åˆ—çš„é“¾å¼è°ƒç”¨ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> numbers = <span class="number">1</span>...<span class="number">10</span></span><br><span class="line"><span class="keyword">let</span> sumOfSquaredEvenNumbers = numbers</span><br><span class="line">    .<span class="built_in">filter</span> &#123; $<span class="number">0</span> % <span class="number">2</span> == <span class="number">0</span>&#125;</span><br><span class="line">    .<span class="built_in">map</span> &#123; $<span class="number">0</span> * $<span class="number">0</span> &#125;</span><br><span class="line">    .<span class="built_in">reduce</span>(<span class="number">0</span>, +)</span><br><span class="line"><span class="comment">// â†’ 220</span></span><br></pre></td></tr></table></figure><p>ç°åœ¨å‡è®¾æˆ‘ä»¬å¸Œæœ›ç¡®è®¤ä¸€ä¸‹æ¯ä¸ªé“¾å¼æ“ä½œæ˜¯å¦è¾¾åˆ°äº†é¢„æœŸçš„æ•ˆæœ â€”â€” ä¾‹å¦‚ <code>filter</code> å’Œï¼ˆæˆ–ï¼‰ <code>map</code> æ“ä½œåçš„è¿”å›å€¼æ˜¯å¦æ­£ç¡®ï¼Œæœ€ç®€æ´çš„æ–¹å¼å½“ç„¶æ˜¯åœ¨ä¸¤ä¸ªæ“ä½œä¸­é—´æ’å…¥ç±»ä¼¼ <code>.forEach { print($0) }</code> çš„è°ƒç”¨ã€‚</p><p>ä½†ä¸ºä»€ä¹ˆ <code>forEach</code> å¹¶ä¸æ”¯æŒç±»ä¼¼è¿™æ ·çš„ä½¿ç”¨æ–¹å¼å‘¢ï¼ŸåŸå› åœ¨äºï¼Œåœ¨ä¸€ç³»åˆ—é“¾å¼è°ƒç”¨ä¸­é—´çš„ä»»ä½•æ“ä½œï¼Œéƒ½å¿…é¡»è¿”å›ä¸€ä¸ªéµå¾ª <a href="https://developer.apple.com/documentation/swift/sequence" target="_blank" rel="noopener"><code>Sequence</code></a> åè®®çš„å¯¹è±¡ï¼Œè¿™æ ·ä¸‹ä¸€ä¸ªé“¾å¼æ“ä½œæ‰èƒ½æ­£å¸¸æ‰§è¡Œã€‚è€Œ <code>forEach</code> çš„è¿”å›å€¼ä¸º <code>()</code>ï¼Œå› æ­¤å®ƒåªèƒ½åœ¨ä¸€ç³»åˆ—é“¾å¼æ“ä½œçš„ç»“å°¾å¤„è°ƒç”¨ã€‚</p><h2 id="å®ç°ä¸€ä¸ªè¿”å›-Self-çš„-forEach"><a href="#å®ç°ä¸€ä¸ªè¿”å›-Self-çš„-forEach" class="headerlink" title="å®ç°ä¸€ä¸ªè¿”å› Self çš„ forEach"></a>å®ç°ä¸€ä¸ªè¿”å› <code>Self</code> çš„ <code>forEach</code></h2><p>å€¼å¾—åº†å¹¸çš„ä¸€ç‚¹æ˜¯ï¼Œå®ç°è¿™ä¸ªåŠŸèƒ½å¹¶ä¸å›°éš¾ã€‚æˆ‘ä»¬æ‰€éœ€è¦åšçš„äº‹æƒ…åªæ˜¯å®ç°ä¸€ä¸ªæ–¹æ³• â€”â€” å®ƒèƒ½å¤Ÿéå†åºåˆ—ï¼Œå¹¶å¯¹æ¯ä¸ªå…ƒç´ æ‰§è¡Œä¸€æ¬¡ä¼ å…¥çš„å‡½æ•°ï¼ˆå°±åƒ <code>forEach</code> ä¸€æ ·ï¼‰ï¼Œæœ€åè¿”å›è‡ªå·±ï¼ˆè¿™æ ·é“¾å¼æ“ä½œå°±èƒ½å¤Ÿæ— æ„ŸçŸ¥åœ°ç»§ç»­è¿›è¡Œï¼‰ã€‚æ¢å¥è¯æ¥è¯´ï¼Œè¿™ä¸ªæ–¹æ³•çš„è¿”å›å€¼ç±»å‹åº”ä¸º <code>Self</code>ã€‚ä¸ºäº†é¿å…åœ¨ç±»å‹æ£€æŸ¥çš„æ—¶å€™è¿™ä¸ªæ–¹æ³•ä¸åŸç”Ÿçš„ <code>forEach</code> å‘ç”Ÿæ··æ·†ï¼Œæˆ‘æŠŠå®ƒå‘½åä¸º <code>forEachPerform</code>ã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Sequence</span> </span>&#123;</span><br><span class="line">    <span class="comment">/// Perform a side effect for each element in `self`.</span></span><br><span class="line">    @discardableResult</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">forEachPerform</span><span class="params">(<span class="number">_</span> body: <span class="params">(Element)</span></span></span> <span class="keyword">throws</span> -&gt; ())</span><br><span class="line">        <span class="keyword">rethrows</span> -&gt; <span class="type">Self</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">try</span> forEach(body)</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">self</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸ <code>forEach</code> ä¸åŒï¼Œæˆ‘ä»¬å¯ä»¥æ’å…¥è¿™ä¸ªæ–¹æ³•åˆ°ä¸€ç³»åˆ—é“¾å¼æ“ä½œä¸­ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> sumOfSquaredEvenNumbers = numbers</span><br><span class="line">    .<span class="built_in">filter</span> &#123; $<span class="number">0</span> % <span class="number">2</span> == <span class="number">0</span>&#125;</span><br><span class="line">    .forEachPerform &#123; <span class="built_in">print</span>($<span class="number">0</span>) &#125;</span><br><span class="line">    .<span class="built_in">map</span> &#123; $<span class="number">0</span> * $<span class="number">0</span> &#125;</span><br><span class="line">    .<span class="built_in">reduce</span>(<span class="number">0</span>, +)</span><br><span class="line"><span class="comment">/* Prints:</span></span><br><span class="line"><span class="comment">2</span></span><br><span class="line"><span class="comment">4</span></span><br><span class="line"><span class="comment">6</span></span><br><span class="line"><span class="comment">8</span></span><br><span class="line"><span class="comment">10</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><p>é™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘è¿˜æ·»åŠ äº†å¦ä¸€ä¸ªéå¸¸æœ‰ç”¨çš„æ–¹æ³•ã€‚è¿™ä¸ªæ–¹æ³•åªä¼šå¯¹æ•´ä¸ªåºåˆ—è°ƒç”¨ä¼ å…¥å‚æ•°ä¸­çš„å‡½æ•°ä¸€æ¬¡ï¼Œè€Œä¸ä¼šéå†åºåˆ—å¹¶å¯¹æ¯ä¸€ä¸ªå…ƒç´ éƒ½è°ƒç”¨ä¸€æ¬¡ã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Sequence</span> </span>&#123;</span><br><span class="line">    <span class="comment">/// Perform a side effect.</span></span><br><span class="line">    @discardableResult</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">perform</span><span class="params">(<span class="number">_</span> body: <span class="params">(<span class="keyword">Self</span>)</span></span></span> <span class="keyword">throws</span> -&gt; ())</span><br><span class="line">        <span class="keyword">rethrows</span> -&gt; <span class="type">Self</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">try</span> body(<span class="keyword">self</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">self</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€šè¿‡è¿™ä¸ªæ–¹æ³•å¯ä»¥å®Œç¾åœ°æ‰“å°æ¯ä¸€æ­¥é“¾å¼æ“ä½œçš„ä¸­é—´å€¼ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> sumOfSquaredEvenNumbers = numbers</span><br><span class="line">    .<span class="built_in">filter</span> &#123; $<span class="number">0</span> % <span class="number">2</span> == <span class="number">0</span>&#125;</span><br><span class="line">    .perform &#123; <span class="built_in">print</span>(<span class="string">"After filter: <span class="subst">\($<span class="number">0</span>)</span>"</span>) &#125;</span><br><span class="line">    .<span class="built_in">map</span> &#123; $<span class="number">0</span> * $<span class="number">0</span> &#125;</span><br><span class="line">    .perform &#123; <span class="built_in">print</span>(<span class="string">"After map: <span class="subst">\($<span class="number">0</span>)</span>"</span>) &#125;</span><br><span class="line">    .<span class="built_in">reduce</span>(<span class="number">0</span>, +)</span><br><span class="line"><span class="comment">/* Prints:</span></span><br><span class="line"><span class="comment">After filter: [2, 4, 6, 8, 10]</span></span><br><span class="line"><span class="comment">After map: [4, 16, 36, 64, 100]</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><h2 id="è‡ªæ¯åºåˆ—"><a href="#è‡ªæ¯åºåˆ—" class="headerlink" title="è‡ªæ¯åºåˆ—"></a>è‡ªæ¯åºåˆ—</h2><p>æˆ‘ä»¬æ–°æ·»åŠ çš„æ–¹æ³•è¿”å›äº†ä¸€ä¸ªæœªä¿®æ”¹è¿‡çš„ <code>self</code>ï¼Œå› æ­¤æŠŠå®ƒæ’å…¥ä¸€ç³»åˆ—é“¾å¼è°ƒç”¨ä¸­æ˜¯å®Œå…¨æ²¡æœ‰å½±å“çš„ã€‚ä½†æˆ‘ä»¬éœ€è¦æ³¨æ„ï¼Œ <code>Sequence</code> åè®®ç›®å‰çš„ä»£ç å®ç°ä¸­å¹¶æ²¡æœ‰ä¿è¯å¤šæ¬¡çš„è¿­ä»£è¿”å›å®Œå…¨ç›¸åŒçš„åºåˆ—ã€‚</p><blockquote><p>è¯‘è€…æ³¨:</p><p>è‹¹æœå®˜æ–¹ <code>Sequence</code> çš„æ–‡æ¡£ä¸­æœ‰ä¸€æ®µå…³ä¸ <a href="https://developer.apple.com/documentation/swift/sequence#Repeated%20Access" target="_blank" rel="noopener">Repeated Access</a> çš„æè¿°ï¼š</p><p>The <code>Sequence</code> protocol makes no requirement on conforming types regarding whether they will be destructively consumed by iteration. As a consequence, donâ€™t assume that multiple <code>for</code>-<code>in</code> loops on a sequence will either resume iteration or restart from the beginning:</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">&gt; <span class="keyword">for</span> element <span class="keyword">in</span> sequence &#123;</span><br><span class="line">&gt;     <span class="keyword">if</span> ... some condition &#123; <span class="keyword">break</span> &#125;</span><br><span class="line">&gt; &#125;</span><br><span class="line">&gt; </span><br><span class="line">&gt; <span class="keyword">for</span> element <span class="keyword">in</span> sequence &#123;</span><br><span class="line">&gt;     <span class="comment">// No defined behavior</span></span><br><span class="line">&gt; &#125; </span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure></blockquote><p>å¤§å¤šæ•°éµå¾ª <code>Sequence</code> çš„ç±»å‹ä¼šç¡®ä¿ä¸Šé¢çš„è¿™ç§æƒ…å†µä¸ä¼šå‘ç”Ÿï¼ˆä¾‹å¦‚ <a href="https://developer.apple.com/documentation/swift/array" target="_blank" rel="noopener"><code>Array</code></a>ï¼‰ï¼Œä½†å‡è®¾ä½ æœ‰ä¸€ä¸ªå¯ä»¥ç”¨äºæ¥æ”¶æ¥è‡ªç½‘ç»œ socket çš„å­—èŠ‚æµçš„ <code>Sequence</code> ç±»å‹â€”â€”è°ƒç”¨ <code>forEachPerform</code> æˆ–è€… <code>perform</code> ä¼šæ‰“ä¹±å…¶é¡ºåºï¼Œå¯¼è‡´éšåæ“ä½œä¸­çš„æ•°æ®ä¸èƒ½è¢«æ­£ç¡®å¤„ç†ã€‚</p><p>å¦‚æœä½ çš„ä»£ç ä¸­å­˜åœ¨ä¸Šè¿°é—®é¢˜ï¼Œä½ å¯ä»¥é€‰æ‹©è®© <code>forEachPerform</code> å’Œ <code>perform</code> æ–¹æ³•è¿”å›ä¸€ä¸ª <code>Array&lt;Element&gt;</code> ç±»å‹ï¼ˆè¿™æ ·å¯ä»¥æŠŠå¯ç ´åçš„åºåˆ—éšå¼è½¬æ¢ä¸ºå¯é‡å¤çš„åºåˆ—ï¼‰ï¼Œæˆ–è€…å¯ä»¥æŠŠè¿™äº›æ–¹æ³•åŠ åˆ°  <a href="https://developer.apple.com/documentation/swift/collection" target="_blank" rel="noopener"><code>Collection</code></a> ä¸­ï¼ˆ<code>Collection</code> ç±»å‹ä¿è¯äº†è¿­ä»£ä¸ä¼šç ´åé¡ºåºï¼‰ã€‚</p><h2 id="è®©å®ƒå˜â€œæ‡’â€"><a href="#è®©å®ƒå˜â€œæ‡’â€" class="headerlink" title="è®©å®ƒå˜â€œæ‡’â€"></a>è®©å®ƒå˜â€œæ‡’â€</h2><p><code>forEachPerform</code> æœ‰ä¸ªä¸å¤ªå®¹æ˜“å‘ç°çš„é—®é¢˜ï¼šå¦‚æœæˆ‘ä»¬æŠŠå®ƒæ”¾åœ¨ <strong><em>æƒ°æ€§é˜Ÿåˆ— (lazy sequences)</em></strong> çš„é“¾å¼è°ƒç”¨ä¹‹é—´ï¼Œæƒ°æ€§é˜Ÿåˆ—ä¼šå¤±å»å…¶åŸæœ¬çš„æƒ°æ€§ã€‚</p><p>æƒ°æ€§é˜Ÿåˆ—çš„è®¾è®¡åˆè¡·æ˜¯ä¸ºäº†æŠŠæ‰€æœ‰éœ€è¦å¯¹ä¸‹ä¸€ä¸ªå…ƒç´ æ‰€åšçš„å·¥ä½œéƒ½å°½å¯èƒ½åœ°å»¶è¿Ÿè¿›è¡Œ â€”â€” ä¹Ÿå°±æ˜¯è¯´ï¼Œå½“ä¸€ä¸ªæƒ°æ€§åºåˆ—çš„é“¾å¼è°ƒç”¨çš„æœ€ç»ˆè¿”å›å€¼éœ€è¦è¢«è·å–æ—¶ï¼Œé‚£äº›è¢« â€å»¶è¿Ÿâ€œ çš„å·¥ä½œæ‰ä¼šçœŸæ­£æ‰§è¡Œã€‚ç”±äº <code>forEachPerform</code> çš„å®ç°ä¸­éå†äº†åºåˆ—çš„æ¯ä¸ªå…ƒç´ ï¼Œæˆ‘ä»¬è®©è¿™ä¸ªé˜Ÿåˆ—çš„ä»»ä½•æƒ°æ€§éƒ½è¢«ç ´åäº†ã€‚</p><p>ä¸ºäº†ä¿è¯åºåˆ—çš„æƒ°æ€§ï¼Œæˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸€ä¸ªè‡ªå·±çš„æƒ°æ€§è¿­ä»£å™¨ä»¥åŠåºåˆ—ç±»å‹ï¼Œåˆ†åˆ«å‘½åä¸º <code>LazyForEachIterator</code> å’Œ <code>LazyForEachSequence</code>ã€‚å®ƒä»¬çš„å·¥ä½œä¸æ ‡å‡†åº“ä¸­ç±»ä¼¼çš„ç±»å‹ç›¸å·®æ— å‡ ï¼šå®ƒä»¬ä¼šæŠŠä¼ å…¥çš„å‡½æ•°ä»¥åŠåºåˆ— <em>ä¿å­˜</em> èµ·æ¥ï¼Œè€Œä¸æ˜¯ç«‹å³æ‰§è¡Œä¼ å…¥çš„å‡½æ•°ã€‚<em>ç›´åˆ°</em> æŸä¸ªæ“ä½œè®¿é—®åˆ°ä¸‹ä¸ªå…ƒç´ æ—¶ï¼Œå®ƒä»¬æ‰ä¼šè½®æµå°è¯•è·å–åŸæœ¬åºåˆ—çš„ä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œå¹¶æ‰§è¡Œç›¸åº”çš„æ“ä½œã€‚</p><p>å®ç°ä»£ç å¤§æ¦‚å¦‚æ­¤ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">LazyForEachIterator</span>&lt;<span class="title">Base</span>: <span class="title">IteratorProtocol</span>&gt;</span></span><br><span class="line"><span class="class">    : <span class="title">IteratorProtocol</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">mutating</span> <span class="function"><span class="keyword">func</span> <span class="title">next</span><span class="params">()</span></span> -&gt; <span class="type">Base</span>.<span class="type">Element</span>? &#123;</span><br><span class="line">        <span class="keyword">guard</span> <span class="keyword">let</span> nextElement = base.next() <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">        &#125;</span><br><span class="line">        perform(nextElement)</span><br><span class="line">        <span class="keyword">return</span> nextElement</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> base: <span class="type">Base</span></span><br><span class="line">    <span class="keyword">let</span> perform: (<span class="type">Base</span>.<span class="type">Element</span>) -&gt; ()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">LazyForEachSequence</span>&lt;<span class="title">Base</span>: <span class="title">Sequence</span>&gt;</span></span><br><span class="line"><span class="class">    : <span class="title">LazySequenceProtocol</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">makeIterator</span><span class="params">()</span></span></span><br><span class="line">        -&gt; <span class="type">LazyForEachIterator</span>&lt;<span class="type">Base</span>.<span class="type">Iterator</span>&gt;</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="type">LazyForEachIterator</span>(</span><br><span class="line">            base: base.makeIterator(),</span><br><span class="line">            perform: perform)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">let</span> base: <span class="type">Base</span></span><br><span class="line">    <span class="keyword">let</span> perform: (<span class="type">Base</span>.<span class="type">Element</span>) -&gt; ()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¸ªåºåˆ—éµå¾ª <a href="https://developer.apple.com/documentation/swift/lazysequenceprotocol" target="_blank" rel="noopener"><code>LazySequenceProtocol</code></a> åè®®ã€‚æ­¤åè®®ç»§æ‰¿äº <code>Sequence</code>ã€‚è¿™ä¸ªåè®®çš„èŒè´£æ˜¯ä¸ºä¸€äº›å³åˆ»å“åº”çš„æ“ä½œï¼ˆè¯‘è€…æ³¨ï¼šä¾‹å¦‚ <code>map</code> å’Œ <code>filter</code>ï¼‰æä¾›äº†æƒ°æ€§å®ç°ã€‚</p><blockquote><p>è¯‘è€…æ³¨:</p><p>å…³äºâ€œå³åˆ»å“åº”çš„æ“ä½œâ€ï¼ˆåŸæ–‡ä¸­ä¸º <em>normally-eager operations</em>ï¼‰ï¼Œ<code>LazySequenceProtocol</code> çš„<a href="https://developer.apple.com/documentation/swift/lazysequenceprotocol" target="_blank" rel="noopener">å®˜æ–¹æ–‡æ¡£</a>ä¸­æœ‰è¿™æ ·ä¸€æ®µè§£é‡Šï¼š</p><p>Sequence operations taking closure arguments, such as <code>map</code> and <code>filter</code>, are normally eager: they use the closure immediately and return a new array. </p><p>åŒæ—¶ï¼Œæ–‡æ¡£ç´§è·Ÿç€è§£é‡Šäº† <code>lazy</code> æ˜¯å¦‚ä½•è®©è¿™ç§ <em>normally-eager operations</em> å˜æˆæƒ°æ€§æ“ä½œçš„ï¼š</p><p>Using the <code>lazy</code> property gives the standard library explicit permission to store the closure and the sequence in the result, and defer computation until it is needed.</p></blockquote><p>Swift çš„ç±»å‹æ¨æ–­æœºåˆ¶å…¶ä¸­ä¸€æ¡è§„åˆ™æ˜¯ï¼šåœ¨ç»™å®šçš„çº¦æŸçš„å‰æä¸‹ï¼ŒSwift ç¼–è¯‘å™¨ä¼šè‡ªåŠ¨é€‰æ‹©ä¸€ä¸ªæœ€æ˜ç¡®ä¸”å¯å·¥ä½œçš„é‡è½½ï¼ˆè¯‘è€…æ³¨ï¼šå¯æŸ¥çœ‹å®˜æ–¹æ–‡æ¡£ <a href="https://docs.swift.org/swift-book/LanguageGuide/TheBasics.html#ID322" target="_blank" rel="noopener">Type Safety and Type Inference</a> ï¼‰ã€‚å› æ­¤ï¼Œå½“ä½ å¯¹ä¸€ä¸ªéµå¾ªäº† <code>LazySequenceProtocol</code> åè®®çš„å€¼è°ƒç”¨è¯¸å¦‚ <code>map</code> çš„æ–¹æ³•æ—¶ï¼Œç¼–è¯‘å™¨ä¼šå€¾å‘äº <code>map</code> æ–¹æ³•çš„æƒ°æ€§å˜ä½“è€Œéé»˜è®¤ç‰ˆæœ¬å®ç°ã€‚</p><p>ä¸ºäº†åœ¨æˆ‘ä»¬çš„æ–¹æ³•ä¸­å®ç°åŒæ ·çš„æ•ˆæœï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ <code>LazySequenceProtocol</code> çš„æ‰©å±•ä¸­åŠ å…¥ä¸€ä¸ª <code>forEachPerform</code> çš„å˜ä½“ï¼ŒåŒæ—¶è®©å®ƒè¿”å›ä¸€ä¸ªæƒ°æ€§åºåˆ—ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">LazySequenceProtocol</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">forEachPerform</span><span class="params">(<span class="number">_</span> body: @escaping <span class="params">(Element)</span></span></span> -&gt; ())</span><br><span class="line">        -&gt; <span class="type">LazyForEachSequence</span>&lt;<span class="type">Self</span>&gt;</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="type">LazyForEachSequence</span>(base: <span class="keyword">self</span>,</span><br><span class="line">            perform: body)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ–¹æ³•åœ¨ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ä¸Šä¸ä¸éæƒ°æ€§ç‰ˆæœ¬ç•¥æœ‰ä¸åŒï¼š</p><ul><li>å› ä¸ºæˆ‘ä»¬éœ€è¦æŠŠä¼ å…¥çš„é—­åŒ…æš‚å­˜èµ·æ¥ï¼Œæ‰€ä»¥å®ƒå¿…é¡»æ˜¯ <code>@escaping</code>ï¼Œä¹Ÿå°±æ˜¯é€ƒé€¸é—­åŒ…ã€‚</li><li>ç”±äºå…¶æƒ°æ€§æ€§è´¨ï¼Œè¿™ä¸ªæ–¹æ³•å¹¶ä¸æ”¯æŒä¼šæŠ›å‡ºå¼‚å¸¸çš„æ–¹æ³•ã€‚</li><li>ä¸€èˆ¬æ¥è¯´ï¼Œä¸€ä¸ªæƒ°æ€§æ“ä½œå®Œæˆåå¿…å®šä¼šæœ‰åç»­çš„æ“ä½œï¼Œå› æ­¤å…¶è¿”å›å€¼å¹¶æ²¡æœ‰æ ‡è®°ä¸º <code>descardable</code>ã€‚</li></ul><p>ä½†è¿™ä¸ªæ–¹æ³•æœ€é‡è¦çš„ç‰¹æ€§æ˜¯æˆ‘ä»¬ä¸Šé¢è®¨è®ºè¿‡çš„ï¼šé™¤äº†æŠŠåŸæœ¬çš„åºåˆ—å’Œä¼ å…¥çš„å‡½æ•°è¿›è¡Œå­˜å‚¨ä¹‹å¤–ï¼Œå®ƒä¸ä¼šæ‰§è¡Œä»»ä½•æ“ä½œã€‚</p><p>å½“è¿™ä¸€åˆ‡å‡†å¤‡å®Œæˆåï¼Œ<code>forEachPerform</code> ä¾¿å¯ä»¥æˆåŠŸç»´æŒä¸€ä¸ªåºåˆ—çš„æƒ°æ€§æ€§è´¨ï¼ˆæ³¨æ„ <code>.lazy</code> çš„è°ƒç”¨ï¼‰ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> largeNumbersSquared = numbers</span><br><span class="line">    .<span class="built_in">lazy</span></span><br><span class="line">    .<span class="built_in">filter</span> &#123; $<span class="number">0</span> &gt;= <span class="number">5</span> &#125;</span><br><span class="line">    .forEachPerform &#123; <span class="built_in">print</span>(<span class="string">"After filter: <span class="subst">\($<span class="number">0</span>)</span>"</span>) &#125;</span><br><span class="line">    .<span class="built_in">map</span> &#123; $<span class="number">0</span> * $<span class="number">0</span> &#125;</span><br><span class="line"><span class="comment">// Prints nothing</span></span><br></pre></td></tr></table></figure><p><em>æ³¨æ„ï¼šå…¶å®è¿™æ®µä»£ç åœ¨ Swift 4.0 ä¸­ä¼šç¼–è¯‘å¤±è´¥ï¼šâ€ambiguous use of â€˜forEachPerformâ€™â€ã€‚åªæœ‰å½“æˆ‘æŠŠ Sequence.forEachPerform çš„è¿”å›ç±»å‹ç”± Self æ”¹ä¸º [Element] åè¿™æ®µä»£ç æ‰èƒ½æ­£å¸¸è¿è¡Œã€‚è¯´å®è¯æˆ‘ä¹Ÿä¸å¤ªæ˜ç™½è¿™æ˜¯ä¸ºä»€ä¹ˆã€‚ä¸è¿‡ä½ ä¹Ÿå¯ä»¥é€šè¿‡ä¿®æ”¹ LazySequenceProtocol.forEachPerform æ–¹æ³•çš„å‘½åæš‚æ—¶è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</em></p><p>è¿™æ ·ä¸€æ¥ï¼Œåªæœ‰å½“æˆ‘ä»¬è®¿é—®åˆ°æƒ°æ€§åºåˆ—çš„å…ƒç´ æ—¶ï¼Œè¿™äº›å…ƒç´ çš„å‰¯ä½œç”¨æ‰ä¼šè¢«æ‰“å°å‡ºæ¥ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Access the first two elements</span></span><br><span class="line"><span class="type">Array</span>(largeNumbersSquared.<span class="keyword">prefix</span>(<span class="number">2</span>))</span><br><span class="line"><span class="comment">/* Prints:</span></span><br><span class="line"><span class="comment">After filter: 5</span></span><br><span class="line"><span class="comment">After filter: 6</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// â†’ [25, 36]</span></span><br></pre></td></tr></table></figure><h2 id="ç»“è®º"><a href="#ç»“è®º" class="headerlink" title="ç»“è®º"></a>ç»“è®º</h2><p>æˆ‘çœŸçš„å¾ˆå–œæ¬¢è¿™ç§å¾€é“¾å¼æ“ä½œä¸­æ³¨å…¥å‰¯ä½œç”¨çš„åŠŸèƒ½ï¼Œå³ä¾¿æˆ‘å‡ ä¹æ²¡æœ‰åœ¨è°ƒè¯•ä¹‹å¤–çš„æ—¶å€™ä½¿ç”¨è¿‡ã€‚æ’å¥é¢˜å¤–è¯ï¼Œè™½ç„¶åŸºäº <code>print</code> çš„è°ƒè¯•æ–¹æ³•ä¸€ç›´åœ¨è¢«äº‰è®ºæ˜¯å¦å·²ç» â€œè¿‡æ—¶â€ äº†ï¼Œä½†æˆ‘è¿˜æ˜¯ä¸€ç›´åœ¨ç”¨ã€‚</p><hr><p><a id="foot1" href="#1"><sup>[1]</sup></a>RxSwift ä¸­æœ‰ä¸€ä¸ªç±»ä¼¼çš„æ“ä½œç¬¦ <a href="https://github.com/ReactiveX/RxSwift/blob/master/RxSwift/Observables/Debug.swift" target="_blank" rel="noopener">debug</a> </p><blockquote><p>æœ¬æ–‡ç”± SwiftGG ç¿»è¯‘ç»„ç¿»è¯‘ï¼Œå·²ç»è·å¾—ä½œè€…ç¿»è¯‘æˆæƒï¼Œæœ€æ–°æ–‡ç« è¯·è®¿é—® <a href="http://swift.gg">http://swift.gg</a>ã€‚</p></blockquote>]]></content>
    
    <summary type="html">
    
      æœ¬æ–‡ä»‹ç»äº†å¦‚ä½•åœ¨ Swift çš„é“¾å¼è°ƒç”¨ä¸­é€šè¿‡ä½¿ç”¨åˆ›å»ºçš„è‡ªå®šä¹‰å‡½æ•°æ¥å®ç°è°ƒè¯•çš„ç›®çš„
    
    </summary>
    
      <category term="Ole Begemann" scheme="https://swift.gg/categories/Ole-Begemann/"/>
    
    
      <category term="Swift" scheme="https://swift.gg/tags/Swift/"/>
    
  </entry>
  
  <entry>
    <title>Swift ä¸­çš„è®¾è®¡æ¨¡å¼ #1 å·¥å‚æ–¹æ³•ä¸å•ä¾‹æ–¹æ³•</title>
    <link href="https://swift.gg/2018/09/10/design-pattern-creational/"/>
    <id>https://swift.gg/2018/09/10/design-pattern-creational/</id>
    <published>2018-09-10T00:00:00.000Z</published>
    <updated>2019-02-18T08:52:03.568Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ä½œè€…ï¼šAndrew Jaffeeï¼Œ<a href="https://www.appcoda.com/design-pattern-creational/" target="_blank" rel="noopener">åŸæ–‡é“¾æ¥</a>ï¼ŒåŸæ–‡æ—¥æœŸï¼š2018-07-24<br>è¯‘è€…ï¼š<a href="https://github.com/Adolf-L" target="_blank" rel="noopener">BigLuo</a>ï¼›æ ¡å¯¹ï¼š<a href="http://www.jianshu.com/users/596f2ba91ce9/latest_articles" target="_blank" rel="noopener">pmst</a>ï¼Œ<a href="http://numbbbbb.com/" target="_blank" rel="noopener">numbbbbb</a>ï¼›å®šç¨¿ï¼š<a href="http://forelax.space" target="_blank" rel="noopener">Forelax</a></p></blockquote><!--æ­¤å¤„å¼€å§‹æ­£æ–‡--><p>â€œGang of Fourâ€ (â€œGoFâ€) Erich Gammaï¼ŒRichard Helmï¼ŒRalph Johonsonï¼Œå’Œ John Vlissides åœ¨ä»–ä»¬â€œ<a href="https://smile.amazon.com/Design-Patterns-Object-Oriented-Addison-Wesley-Professional-ebook/dp/B000SEIBB8/" target="_blank" rel="noopener">è®¾è®¡æ¨¡å¼ï¼šé¢å‘å¯¹è±¡è½¯ä»¶è®¾è®¡å¤ç”¨çš„åŸºæœ¬åŸç†</a>â€ çš„é‡è¦è‘—ä½œé‡Œæ•´ç†äº†å¤§æ¦‚ 23 ç§ç»å…¸çš„è®¾è®¡æ¨¡å¼ ã€‚æœ¬æ–‡ä¼šä»‹ç» GoF æ€»ç»“çš„ä¸¤ç§åˆ›å»ºå‹ï¼ˆcreationalï¼‰æ¨¡å¼ï¼š<em>å·¥å‚æ–¹æ³•</em>å’Œ<em>å•ä¾‹æ–¹æ³•</em>ã€‚</p><a id="more"></a><p>è½¯ä»¶å¼€å‘ä¸€ç›´åœ¨åŠªåŠ›åœ°æ¨¡æ‹ŸçœŸå®ä¸–ç•Œçš„åœºæ™¯ï¼Œå¸Œæœ›é€šè¿‡åˆ›å»ºå·¥å…·çš„æ–¹å¼æ¥åŠ å¼ºäººç±»çš„åœºæ™¯ä½“éªŒã€‚è´¢å¯Œç®¡ç†å·¥å…·ï¼Œä¾‹å¦‚ï¼šåƒäºšé©¬é€Šæˆ–è€… eBay è¿™æ ·çš„é“¶è¡Œ App å’Œè´­ç‰©è¾…åŠ©å·¥å…·ï¼Œç›¸æ¯”åå¹´å‰ç¡®å®ç»™æ¶ˆè´¹è€…å¸¦æ¥äº†æ›´å¤§çš„ç”Ÿæ´»ä¾¿åˆ©ã€‚å›é¡¾æˆ‘ä»¬çš„å‘å±•è·¯ç¨‹ã€‚å½“åº”ç”¨å˜çš„æ›´åŠ å¼ºå¤§æ˜“ç”¨æ—¶ï¼Œåº”ç”¨çš„å¼€å‘ä¹Ÿå·²å˜çš„<a href="http://iosbrain.com/blog/2018/04/29/controlling-chaos-why-you-should-care-about-adding-error-checking-to-your-ios-apps/#chaos" target="_blank" rel="noopener"><strong>æ›´åŠ å¤æ‚</strong></a>ã€‚</p><p>æ‰€ä»¥å¼€å‘è€…ä¹Ÿå¼€åˆ›å‡ºäº†ä¸€ç³»åˆ—æœ€ä½³å®è·µã€‚ä¸€äº›å¾ˆæµè¡Œçš„åå­—ï¼Œåƒ<a href="http://iosbrain.com/blog/2017/02/26/intro-to-object-oriented-principles-in-swift-3-via-a-message-box-class-hierarchy/" target="_blank" rel="noopener"><strong>é¢å‘å¯¹è±¡ç¼–ç¨‹</strong></a>ï¼Œ<a href="https://www.appcoda.com/pop-vs-oop/" target="_blank" rel="noopener"><strong>é¢å‘åè®®ç¼–ç¨‹</strong></a>ï¼Œ<a href="http://iosbrain.com/blog/2018/03/28/protocol-oriented-programming-in-swift-is-it-better-than-object-oriented-programming/#value_semantics" target="_blank" rel="noopener"><strong>å€¼è¯­ä¹‰ ï¼ˆvalue semanticsï¼‰</strong></a>ï¼Œ<a href="http://iosbrain.com/blog/2018/03/28/protocol-oriented-programming-in-swift-is-it-better-than-object-oriented-programming/#local_reasoning" target="_blank" rel="noopener"><strong>å±€éƒ¨æ¨æ–­ ï¼ˆlocal reasoningï¼‰</strong></a>å°†å¤§å—ä»£ç åˆ†è§£æˆå…·æœ‰è‰¯å¥½æ¥å£å®šä¹‰çš„å°æ®µä»£ç ï¼ˆæ¯”å¦‚ä½¿ç”¨ <a href="http://iosbrain.com/blog/2017/01/28/swift-extensions-managing-complexity-improving-readability-extensibility-protocols-delegates-uicollectionview/" target="_blank" rel="noopener"><strong>Swift çš„æ‰©å±•</strong></a>ï¼‰ï¼Œä»¥åŠ <a href="http://iosbrain.com/blog/2018/01/27/writing-expressive-meaningful-and-readable-code-in-swift-4/" target="_blank" rel="noopener"><strong>è¯­æ³•ç³–</strong></a>ã€‚è¿˜æœ‰æˆ‘æ²¡æåŠï¼Œä½†å´æ˜¯æœ€é‡è¦çš„ã€å€¼å¾—é‡è§†çš„å®è·µä¹‹ä¸€ï¼Œè®¾è®¡æ¨¡å¼çš„ä½¿ç”¨ã€‚</p><h2 id="è®¾è®¡æ¨¡å¼"><a href="#è®¾è®¡æ¨¡å¼" class="headerlink" title="è®¾è®¡æ¨¡å¼"></a>è®¾è®¡æ¨¡å¼</h2><p>è®¾è®¡æ¨¡å¼æ˜¯å¼€å‘è€…ç®¡ç†è½¯ä»¶å¤æ‚æ€§çš„é‡è¦å·¥å…·ã€‚ä½œä¸ºå¸¸è§çš„æ¨¡æ¿æŠ€æœ¯ï¼Œå®ƒå¾ˆå¥½åœ°å¯¹è½¯ä»¶ä¸­ç±»ä¼¼çš„ã€å¤ç°çš„ã€å®¹æ˜“è¯†åˆ«çš„é—®é¢˜è¿›è¡Œäº†æ¦‚å¿µåŒ–æŠ½è±¡ã€‚å°†å®ƒå½“ä½œä¸€ä¸ªæœ€ä½³å®è·µåº”ç”¨åˆ°ä½ æ—¥å¸¸ä¼šé‡åˆ°çš„é‚£äº›ç¼–ç¨‹åœºæ™¯ä¸­ï¼Œä¾‹å¦‚ï¼Œåœ¨ä¸äº†è§£ç±»ç°‡å®ç°ç»†èŠ‚çš„æƒ…å†µä¸‹åˆ›å»ºä¸€ä¸ªç±»ç°‡ç›¸å…³çš„å¯¹è±¡ã€‚è®¾è®¡æ¨¡å¼ä¸»è¦æ˜¯ç”¨äºç»å¸¸å‘ç”Ÿçš„é‚£äº›é—®é¢˜åœºæ™¯ä¸­ã€‚å®ƒä»¬é¢‘ç¹è¢«ä½¿ç”¨æ˜¯å› ä¸ºè¿™äº›é—®é¢˜å¾ˆæ™®éï¼Œè®©æˆ‘ç”¨ä¸€ä¸ªå…·ä½“çš„ä¾‹å­æ¥å¸®åŠ©ä½ ä»¬ç†è§£å§ã€‚</p><p>è®¾è®¡æ¨¡å¼è®¨è®ºçš„å¹¶ä¸æ˜¯æŸäº›å…·ä½“çš„é—®é¢˜ï¼Œæ¯”å¦‚â€å¦‚ä½•è¿­ä»£åŒ…å« 11 ä¸ªæ•´æ•°ï¼ˆIntï¼‰çš„ Swift æ•°ç»„â€œã€‚é’ˆå¯¹è¿™ç±»é—®é¢˜ï¼ŒGoF å®šä¹‰äº†è¿­ä»£å™¨æ¨¡å¼ï¼ˆIterator Patternï¼‰ï¼Œè¿™æ˜¯ä¸€ä¸ªé€šç”¨çš„æ¨¡å¼ï¼Œæè¿°å¦‚ä½•åœ¨ä¸ç¡®å®šæ•°æ®ç±»å‹çš„æƒ…å†µä¸‹éå†ä¸€ä¸ªæ•°æ®åˆ—è¡¨ã€‚è®¾è®¡æ¨¡å¼ä¸æ˜¯è¯­è¨€ç¼–ç ã€‚å®ƒæ˜¯ç”¨äºè§£å†³ç›¸åŒè½¯ä»¶åœºæ™¯é—®é¢˜çš„ä¸€å¥—å®ç”¨çš„æŒ‡å¯¼è§„åˆ™ã€‚</p><p>è¿˜è®°å¾—å—ï¼Œä¹‹å‰æˆ‘åœ¨ AppCoda ä»‹ç»è¿‡ <a href="https://www.appcoda.com/mvvm-vs-mvc/" target="_blank" rel="noopener">â€œModel-View-ViewModelâ€ or â€œMVVMâ€</a> ä¸éå¸¸è‘—åçš„ <a href="https://www.appcoda.com/mvvm-vs-mvc/" target="_blank" rel="noopener">â€œModel-View-Controllerâ€ or â€œMVCâ€</a> è®¾è®¡æ¨¡å¼ï¼Œè¿™ä¸¤ä¸ªæ¨¡å¼æ·±å— Apple å’Œ iOS å¼€å‘è€…å–œçˆ±ã€‚</p><p>è¿™ä¸¤ç§æ¨¡å¼ä¸€èˆ¬ç”¨åœ¨<em>æ•´ä¸ªåº”ç”¨</em>ä¸­ã€‚MVVM å’Œ MVC æ˜¯<em>æ¶æ„ï¼ˆarchitecturalï¼‰</em>è®¾è®¡æ¨¡å¼ï¼Œç”¨äºå°† UI ä»åº”ç”¨æ•°æ®ä»£ç å’Œå±•ç¤ºé€»è¾‘ä¸­åˆ†ç¦»å‡ºæ¥ï¼ˆå¦‚ï¼šMVCï¼‰ï¼Œä»¥åŠå°†åº”ç”¨çš„æ•°æ®ä»æ ¸å¿ƒæ•°æ®æµç¨‹æˆ–è€…ä¸šåŠ¡é€»è¾‘ä¸­åˆ†ç¦»ï¼ˆå¦‚ï¼šMVVMï¼‰ã€‚ è€Œ GoF è®¾è®¡æ¨¡å¼æœ¬è´¨ä¸Šæ›´å…·ä½“ï¼Œæ—¨åœ¨è§£å†³åŸºäºç¨‹åºä»£ç ä¸­çš„å…·ä½“é—®é¢˜ã€‚åœ¨ä¸€ä¸ªåº”ç”¨é‡Œé¢ä½ ä¹Ÿè®¸ä¼šç”¨åˆ° 3 ç§ã€7 ç§æˆ–è€… 12 ç§ GoF è®¾è®¡æ¨¡å¼ã€‚é™¤äº†<em>è¿­ä»£å™¨</em>ä¾‹å­ï¼Œä»£ç†æ¨¡å¼ä¹Ÿæ˜¯è®¾è®¡æ¨¡å¼ä¸­å¦ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­ï¼Œ å°½ç®¡å®ƒåœ¨ GoF åˆ—å‡ºçš„ 23 ç§è®¾è®¡æ¨¡å¼ä¸­å¹¶æœªè¢«å…·ä½“ä»‹ç»ã€‚</p><p>å½“ GoF çš„è¿™æœ¬ä¹¦ä½œä¸ºå¤§é‡å¼€å‘è€…çš„åœ£ç»è€Œå­˜åœ¨æ—¶ï¼Œä¹Ÿä¸ä¹æœ‰å®ƒçš„è¯‹æ¯è€…ï¼Œæˆ‘ä»¬åœ¨æ–‡ç« çš„ç»“å°¾å¤„è®¨è®ºè¿™ä¸ªè¯é¢˜ã€‚</p><h2 id="è®¾è®¡æ¨¡å¼çš„ç±»åˆ«"><a href="#è®¾è®¡æ¨¡å¼çš„ç±»åˆ«" class="headerlink" title="è®¾è®¡æ¨¡å¼çš„ç±»åˆ«"></a>è®¾è®¡æ¨¡å¼çš„ç±»åˆ«</h2><p>GoF å°† 23 ç§è®¾è®¡æ¨¡å¼æ•´ç†åˆ†ä¸º 3 ç±»ï¼Œâ€œåˆ›å»ºå‹â€ã€â€œç»“æ„å‹â€å’Œâ€œè¡Œä¸ºå‹â€ã€‚æœ¬æ•™ç¨‹è®¨è®ºåˆ›å»ºå‹æ¨¡å¼ç±»åˆ«ä¸­çš„ä¸¤ç§ï¼ˆå·¥å‚æ¨¡å¼ä¸å•ä¾‹ï¼‰ã€‚å¦‚åŒå®ä¾‹å¯¹è±¡å’Œç±»çš„å®ç°ï¼Œæ¨¡å¼çš„ä½œç”¨æ˜¯è®©å¤æ‚å¯¹è±¡çš„åˆ›å»ºå˜å¾—ç®€å•ã€æ˜“äºç†è§£ã€æ˜“äºç»´æŠ¤ï¼Œéšè—ç»†èŠ‚ã€‚</p><p><strong>éšè—å¤æ‚åº¦ï¼ˆå°è£…ï¼‰</strong>æ˜¯èªæ˜çš„ç¨‹åºå‘˜æœ€ä¸»è¦çš„ç›®æ ‡ä¹‹ä¸€ã€‚ä¾‹å¦‚ï¼Œé¢å‘å¯¹è±¡ï¼ˆOOPï¼‰ç±»èƒ½æä¾›éå¸¸å¤æ‚çš„ï¼Œå¼ºå¤§ä¸”æˆç†Ÿçš„å‡½æ•°è€Œä¸éœ€è¦çŸ¥é“ä»»ä½•å…³äºç±»å†…éƒ¨é—´çš„å·¥ä½œæ–¹å¼ã€‚åœ¨åˆ›å»ºå‹æ¨¡å¼ä¸­ï¼Œå¼€å‘è€…ç”šè‡³ä¸éœ€è¦çŸ¥é“ç±»çš„å±æ€§å’Œæ–¹æ³•ï¼Œä½†å¦‚æœéœ€è¦ï¼Œç¨‹åºå‘˜å¯ä»¥çœ‹åˆ°å…¶æ¥å£ - åœ¨ Swift ä¸­çš„åè®®ä¸­ - æˆ–å¯¹é‚£äº›æ„Ÿå…´è¶£çš„ç±»è¿›è¡Œæ‰©å±•ã€‚ä½ ä¼šåœ¨æˆ‘çš„ç¬¬ä¸€ä¸ªâ€œå·¥å‚æ–¹æ³•â€çš„ä¾‹å­ä¸­æ˜ç™½æˆ‘çš„æ„æ€ã€‚</p><h2 id="å·¥å‚æ–¹æ³•è®¾è®¡æ¨¡å¼"><a href="#å·¥å‚æ–¹æ³•è®¾è®¡æ¨¡å¼" class="headerlink" title="å·¥å‚æ–¹æ³•è®¾è®¡æ¨¡å¼"></a>å·¥å‚æ–¹æ³•è®¾è®¡æ¨¡å¼</h2><p>å¦‚æœä½ å·²ç»æ¢ç´¢è¿‡ GoF è®¾è®¡æ¨¡å¼æˆ–åœ¨ OOP çš„ä¸–ç•Œé‡ŒèŠ±è´¹äº†å¾ˆå¤šæ—¶é—´ï¼Œä½ å¤§æ¦‚è‡³å°‘å¬è¯´è¿‡â€œæŠ½è±¡å·¥å‚â€ã€â€œå·¥å‚â€ï¼Œæˆ–è€…â€œå·¥å‚æ–¹æ³•â€æ¨¡å¼ã€‚â€œç¡®åˆ‡â€çš„å‘½åå¯èƒ½æœ‰å¾ˆå¤šäº‰è®®ï¼Œä¸è¿‡ä¸‹é¢æˆ‘è¦ä»‹ç»çš„è¿™ä¸ªä¾‹å­æœ€æ¥è¿‘çš„å‘½åæ˜¯å·¥å‚æ¨¡å¼ã€‚</p><p>åœ¨è¿™ä¸ªèŒƒä¾‹ä¸­ï¼Œä½ é€šè¿‡å·¥å‚æ–¹æ³•åˆ›å»ºå¯¹è±¡ï¼Œè€Œ<em>ä¸éœ€è¦</em>çŸ¥é“ç±»çš„æ„é€ å™¨å’Œå…³äºç±»å’Œç±»å±‚æ¬¡ç»“æ„çš„ä»»ä½•ä¿¡æ¯ã€‚è¿™å¸¦æ¥äº†å¾ˆå¤§çš„æ–¹ä¾¿ã€‚å¯ä»¥ç”¨å°‘é‡çš„ä»£ç åˆ›å»º UI å’Œå®ƒçš„ç›¸å…³åŠŸèƒ½ã€‚æˆ‘çš„å·¥å‚æ–¹æ³•é¡¹ç›®æ¡ˆä¾‹ï¼Œåœ¨ <a href="https://github.com/appcoda/FactoryMethodInSwift" target="_blank" rel="noopener"><strong>GitHub</strong></a> å¯ä¸‹è½½ï¼Œå±•ç¤ºäº†åœ¨å¤æ‚ç±»å±‚æ¬¡ç»“æ„ä¸­ï¼Œå¦‚ä½•è½»æ¾çš„ä½¿ç”¨å¯¹è±¡ã€‚<br><img src="https://www.appcoda.com/wp-content/uploads/2018/07/Factory_Method.gif" alt=""></p><p>å¤§å¤šæ•°æˆåŠŸçš„åº”ç”¨éƒ½æœ‰é£æ ¼ä¸€è‡´çš„ä¸»é¢˜ ã€‚ä¸ºä¿è¯åº”ç”¨ä¸»é¢˜é£æ ¼ç»Ÿä¸€ï¼Œå‡è®¾åº”ç”¨ä¸­æ‰€æœ‰çš„ shapes æœ‰ç€ç›¸åŒçš„é¢œè‰²å’Œå°ºå¯¸ï¼Œè¿™æ ·å°±å¯ä»¥å’Œä¸»é¢˜ä¿æŒä¸€è‡´â€”â€”ä¹Ÿå°±æ˜¯å¡‘é€ å“ç‰Œã€‚è¿™äº›å›¾å½¢ç”¨åœ¨è‡ªå®šä¹‰æŒ‰é’®ä¸Šï¼Œæˆ–è€…ä½œä¸ºç™»å½•æµç¨‹çš„ç•Œé¢èƒŒæ™¯å›¾éƒ½æ˜¯ä¸é”™çš„ã€‚</p><p>å‡è®¾è®¾è®¡å›¢é˜ŸåŒæ„ä½¿ç”¨æˆ‘çš„ä»£ç ä½œä¸ºåº”ç”¨çš„ä¸»é¢˜èƒŒæ™¯å›¾ç‰‡ã€‚ä¸‹é¢æ¥çœ‹çœ‹æˆ‘çš„å…·ä½“ä»£ç ï¼ŒåŒ…æ‹¬åè®®ã€ç±»ç»“æ„å’Œï¼ˆUI å¼€å‘äººå‘˜ä¸éœ€è¦å…³å¿ƒçš„ï¼‰å·¥å‚æ–¹æ³•ã€‚</p><p> <code>ShapeFactory.swift</code> æ–‡ä»¶æ˜¯ä¸€ä¸ªç”¨äºåœ¨è§†å›¾æ§åˆ¶å™¨å†…ç»˜åˆ¶å½¢çŠ¶çš„åè®®ã€‚å› ä¸ºå¯ç”¨äºå„ç§ç›®çš„ï¼Œæ‰€ä»¥å®ƒçš„è®¿é—®çº§åˆ«æ˜¯ publicï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// è¿™äº›å€¼è¢«å›¾å½¢è®¾è®¡å›¢é˜Ÿé¢„å…ˆé€‰å®š</span></span><br><span class="line"><span class="keyword">let</span> defaultHeight = <span class="number">200</span></span><br><span class="line"><span class="keyword">let</span> defaultColor = <span class="type">UIColor</span>.blue</span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">HelperViewFactoryProtocol</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">configure</span><span class="params">()</span></span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">position</span><span class="params">()</span></span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">display</span><span class="params">()</span></span></span><br><span class="line">    <span class="keyword">var</span> height: <span class="type">Int</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">    <span class="keyword">var</span> view: <span class="type">UIView</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">    <span class="keyword">var</span> parentView: <span class="type">UIView</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿˜è®°å¾—å—ï¼Ÿ <code>UIView</code> ç±»æœ‰ä¸€ä¸ªé»˜è®¤çš„çŸ©å½¢å±æ€§ <code>frame</code>  ï¼Œæ‰€ä»¥æˆ‘å¯ä»¥è½»æ¾çš„åˆ›å»ºå‡ºå½¢çŠ¶åŸºç±» <code>Square</code>: </p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">fileprivate</span> <span class="class"><span class="keyword">class</span> <span class="title">Square</span>: <span class="title">HelperViewFactoryProtocol</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">let</span> height: <span class="type">Int</span></span><br><span class="line">    <span class="keyword">let</span> parentView: <span class="type">UIView</span></span><br><span class="line">    <span class="keyword">var</span> view: <span class="type">UIView</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">init</span>(height: <span class="type">Int</span> = defaultHeight, parentView: <span class="type">UIView</span>) &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">self</span>.height = height</span><br><span class="line">        <span class="keyword">self</span>.parentView = parentView</span><br><span class="line">        view = <span class="type">UIView</span>()</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">configure</span><span class="params">()</span></span> &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">let</span> frame = <span class="type">CGRect</span>(x: <span class="number">0</span>, y: <span class="number">0</span>, width: height, height: height)</span><br><span class="line">        view.frame = frame</span><br><span class="line">        view.backgroundColor = defaultColor</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">position</span><span class="params">()</span></span> &#123;</span><br><span class="line">        </span><br><span class="line">        view.center = parentView.center</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">display</span><span class="params">()</span></span> &#123;</span><br><span class="line">        </span><br><span class="line">        configure()</span><br><span class="line">        position()</span><br><span class="line">        parentView.addSubview(view)</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨æ„åˆ°æˆ‘æ ¹æ® OOP çš„è®¾è®¡æ€æƒ³æ¥æ„å»ºå¤ç”¨ä»£ç ï¼Œè¿™æ ·èƒ½è®© shape å±‚çº§æ›´åŠ ç®€åŒ–å’Œå¯ç»´æŠ¤ã€‚<code>Circle</code> å’Œ <code>Rectangle</code> ç±»æ˜¯ <code>Square</code> ç±»çš„ç‰¹åŒ– ï¼ˆå¦å¤–ä½ å¯ä»¥çœ‹åˆ°ï¼Œä»æ­£æ–¹å½¢å‡ºå‘ç»˜åˆ¶åœ†å½¢æ˜¯å¤šä¹ˆç®€å•ã€‚ï¼‰<br><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">fileprivate</span> <span class="class"><span class="keyword">class</span> <span class="title">Circle</span> : <span class="title">Square</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">configure</span><span class="params">()</span></span> &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">super</span>.configure()</span><br><span class="line">        </span><br><span class="line">        view.layer.cornerRadius = view.frame.width / <span class="number">2</span></span><br><span class="line">        view.layer.masksToBounds = <span class="literal">true</span></span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125; </span><br><span class="line"> </span><br><span class="line"><span class="keyword">fileprivate</span> <span class="class"><span class="keyword">class</span> <span class="title">Rectangle</span> : <span class="title">Square</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">configure</span><span class="params">()</span></span> &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">let</span> frame = <span class="type">CGRect</span>(x: <span class="number">0</span>, y: <span class="number">0</span>, width: height + height/<span class="number">2</span>, height: height)</span><br><span class="line">        view.frame = frame</span><br><span class="line">        view.backgroundColor = <span class="type">UIColor</span>.blue</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>æˆ‘ä½¿ç”¨ <code>fileprivate</code> æ¥å¼ºè°ƒå·¥å‚æ–¹æ³•æ¨¡å¼èƒŒåçš„ä¸€ä¸ªç›®çš„ï¼š<em>å°è£…</em>ã€‚ä½ å¯ä»¥çœ‹åˆ°ä¸ç”¨æ”¹å˜ä¸‹é¢å·¥å‚æ–¹æ³•çš„å‰æä¸‹ï¼Œå¯¹ <code>shape</code> ç±»çš„å±‚çº§ç»“æ„è¿›è¡Œä¿®æ”¹å’Œæ‰©å±•æ˜¯å¾ˆå®¹æ˜“çš„ã€‚è¿™æ˜¯å·¥å‚æ–¹æ³•çš„ä»£ç ï¼Œå®ƒä»¬è®©å¯¹è±¡çš„åˆ›å»ºå¦‚æ­¤ç®€å•ä¸”æŠ½è±¡ã€‚<br><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">Shapes</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">case</span> square</span><br><span class="line">    <span class="keyword">case</span> circle</span><br><span class="line">    <span class="keyword">case</span> rectangle</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ShapeFactory</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">let</span> parentView: <span class="type">UIView</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">init</span>(parentView: <span class="type">UIView</span>) &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">self</span>.parentView = parentView</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">create</span><span class="params">(<span class="keyword">as</span> shape: Shapes)</span></span> -&gt; <span class="type">HelperViewFactoryProtocol</span> &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">switch</span> shape &#123;</span><br><span class="line">            </span><br><span class="line">        <span class="keyword">case</span> .square:</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">let</span> square = <span class="type">Square</span>(parentView: parentView)</span><br><span class="line">            <span class="keyword">return</span> square</span><br><span class="line">            </span><br><span class="line">        <span class="keyword">case</span> .circle:</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">let</span> circle = <span class="type">Circle</span>(parentView: parentView)</span><br><span class="line">            <span class="keyword">return</span> circle</span><br><span class="line">            </span><br><span class="line">        <span class="keyword">case</span> .rectangle:</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">let</span> rectangle = <span class="type">Rectangle</span>(parentView: parentView)</span><br><span class="line">            <span class="keyword">return</span> rectangle</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125; </span><br><span class="line">    </span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="comment">// å…¬å…±çš„å·¥å‚æ–¹æ³•æ¥å±•ç¤ºå½¢çŠ¶</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">createShape</span><span class="params">(<span class="number">_</span> shape: Shapes, on view: UIView)</span></span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">let</span> shapeFactory = <span class="type">ShapeFactory</span>(parentView: view)</span><br><span class="line">    shapeFactory.create(<span class="keyword">as</span>: shape).display()</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// é€‰æ‹©å…¬å…±çš„å·¥å‚æ–¹æ³•æ¥å±•ç¤ºå½¢çŠ¶</span></span><br><span class="line"><span class="comment">// ä¸¥æ ¼æ¥è¯´ï¼Œå·¥å‚æ–¹æ³•åº”è¯¥è¿”å›ç›¸å…³ç±»ä¸­çš„ä¸€ä¸ªã€‚</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">getShape</span><span class="params">(<span class="number">_</span> shape: Shapes, on view: UIView)</span></span> -&gt; <span class="type">HelperViewFactoryProtocol</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">let</span> shapeFactory = <span class="type">ShapeFactory</span>(parentView: view)</span><br><span class="line">    <span class="keyword">return</span> shapeFactory.create(<span class="keyword">as</span>: shape)</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>æ³¨æ„åˆ°ï¼šæˆ‘å·²ç»å†™ä¸‹ä¸€ä¸ªç±»å·¥å‚å’Œä¸¤ä¸ªå·¥å‚æ–¹æ³•æ¥è®©ä½ æ€è€ƒã€‚ä¸¥æ ¼è¯´ï¼Œä¸€ä¸ªå·¥å‚æ–¹æ³•åº”è¯¥è¿”å›å¯¹åº”ç±»çš„å¯¹è±¡ï¼Œè¿™äº›ç±»æœ‰ç€å…±åŒçš„åŸºç±»æˆ–è€…åè®®ã€‚æˆ‘çš„ç›®çš„æ˜¯åœ¨è§†å›¾ä¸Šç»˜åˆ¶ä¸€ä¸ªå½¢çŠ¶ï¼Œæ‰€ä»¥æˆ‘æ›´å€¾å¿ƒä½¿ç”¨ <code>createShape(_:view:)</code> è¿™ä¸ªæ–¹æ³•ã€‚æä¾›è¿™ç§å¯é€‰æ–¹å¼ï¼ˆè¯¥æ–¹æ³•ï¼‰ï¼Œåœ¨éœ€è¦æ—¶å¯ç”¨äºè¯•éªŒå’Œæ¢ç´¢æ–°çš„å¯èƒ½æ€§ã€‚</p><p>æœ€åï¼Œæˆ‘å±•ç¤ºäº†ä¸¤ä¸ªå·¥å‚æ–¹æ³•ç»˜åˆ¶å½¢çŠ¶çš„ä½¿ç”¨æ–¹å¼ã€‚UI å¼€å‘è€…ä¸ç”¨çŸ¥é“å½¢çŠ¶ç±»æ˜¯å¦‚ä½•è¢«ç¼–ç å‡ºæ¥çš„ã€‚å°¤å…¶æ˜¯ä»–/å¥¹ä¸å¿…ä¸ºå½¢çŠ¶ç±»å¦‚ä½•è¢«åˆå§‹åŒ–è€Œæ‹…å¿§ã€‚<code>ViewController.swift</code> æ–‡ä»¶ä¸­çš„ä»£ç å¾ˆå®¹æ˜“é˜…è¯»ã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewController</span>: <span class="title">UIViewController</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.viewDidLoad()</span><br><span class="line">        <span class="comment">//åœ¨åŠ è½½è§†å›¾åè¿›è¡Œæ·»åŠ è®¾ç½®ï¼Œä¸€èˆ¬æ˜¯ä»nib</span></span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">didReceiveMemoryWarning</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.didReceiveMemoryWarning()</span><br><span class="line">        <span class="comment">// åºŸå¼ƒæ‰é‚£äº›å¯ä»¥è¢«é‡æ–°åˆ›å»ºçš„èµ„æº</span></span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@IBAction</span> <span class="function"><span class="keyword">func</span> <span class="title">drawCircle</span><span class="params">(<span class="number">_</span> sender: Any)</span></span> &#123;</span><br><span class="line">        </span><br><span class="line"><span class="comment">// ä»…ä»…ç”¨äºç»˜åˆ¶å½¢çŠ¶</span></span><br><span class="line">        createShape(.circle, on: view)</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@IBAction</span> <span class="function"><span class="keyword">func</span> <span class="title">drawSquare</span><span class="params">(<span class="number">_</span> sender: Any)</span></span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç»˜åˆ¶å›¾å½¢</span></span><br><span class="line">        createShape(.square, on: view)</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@IBAction</span> <span class="function"><span class="keyword">func</span> <span class="title">drawRectangle</span><span class="params">(<span class="number">_</span> sender: Any)</span></span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä»å·¥å‚è·å–ä¸€ä¸ªå¯¹è±¡å¹¶ä½¿ç”¨å®ƒæ¥ç»˜åˆ¶ä¸€ä¸ªå½¢çŠ¶</span></span><br><span class="line">        <span class="keyword">let</span> rectangle = getShape(.rectangle, on: view)</span><br><span class="line">        rectangle.display()</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å•ä¾‹è®¾è®¡æ¨¡å¼"><a href="#å•ä¾‹è®¾è®¡æ¨¡å¼" class="headerlink" title="å•ä¾‹è®¾è®¡æ¨¡å¼"></a>å•ä¾‹è®¾è®¡æ¨¡å¼</h2><p>å¤§éƒ¨åˆ† iOS å¼€å‘è€…ç†Ÿæ‚‰å•ä¾‹æ¨¡å¼ã€‚å›æƒ³ä¸€ä¸‹ <code>UNUserNotificationCenter.current()</code>ï¼Œ<code>UIApplication.shared</code> æˆ– <code>FileManager.default</code> å¦‚æœä½ æƒ³è¦å‘é€é€šçŸ¥ï¼Œæˆ–è€…åœ¨ Safari é‡Œé¢æ‰“å¼€ä¸€ä¸ª URLï¼Œæˆ–è€…æ“ä½œ iOS æ–‡ä»¶ï¼Œä½ å¿…é¡»åˆ†åˆ«ä½¿ç”¨å®ƒä»¬å„è‡ªçš„å•ä¾‹ã€‚å•ä¾‹å¯ä»¥å¾ˆå¥½çš„ç”¨äºä¿æŠ¤å…±äº«èµ„æºï¼Œæä¾›æœ‰ä¸”ä»…æœ‰ä¸€ä¸ªå¯¹è±¡å®ä¾‹è¿›å…¥ä¸€äº›ç³»ç»Ÿï¼Œå¹¶ä¸”æ”¯æŒå¯¹è±¡æ‰§è¡Œä¸€äº›åº”ç”¨çº§ç±»å‹çš„åä½œã€‚æ­£å¦‚æˆ‘ä»¬å°†è¦çœ‹åˆ°çš„ï¼Œå•ä¾‹ä¹Ÿå¯ä»¥ç”¨æ¥å°è£… iOS å†…å»ºçš„å…¶å®ƒå•ä¾‹ï¼Œæ·»åŠ ä¸€äº›å€¼æ“ä½œåŠŸèƒ½ã€‚</p><p>ä½œä¸ºä¸€ä¸ªå•ä¾‹ï¼Œæˆ‘ä»¬éœ€è¦ç¡®ä¿è¿™ä¸ªç±»ï¼š</p><ul><li>å£°æ˜å’Œåˆå§‹åŒ–ä¸€ä¸ª static çš„ç±»çš„å¸¸é‡å±æ€§ï¼Œç„¶åå‘½åé‚£ä¸ªå±æ€§ä¸º <code>shared</code> æ¥è¡¨æ˜è¿™ä¸ªç±»çš„å®ä¾‹æ˜¯ä¸€ä¸ªå•ä¾‹ï¼ˆé»˜è®¤æ˜¯å…±æœ‰çš„ï¼‰ï¼›</li><li>ä¸ºæˆ‘ä»¬æƒ³è¦æ§åˆ¶å’Œä¿æŠ¤çš„ä¸€äº›èµ„æºå£°æ˜ä¸€ä¸ª<em>ç§æœ‰çš„</em>å±æ€§ã€‚ä¸”åªèƒ½é€šè¿‡ <code>shared</code> å…±äº«ï¼›</li><li>å£°æ˜ä¸€ä¸ªç§æœ‰åˆå§‹åŒ–æ–¹æ³•ï¼Œåªæœ‰æˆ‘ä»¬çš„å•ä¾‹ç±»èƒ½å¤Ÿåˆå§‹åŒ–å®ƒï¼Œåœ¨ <code>init</code> çš„å†…éƒ¨ï¼Œåˆå§‹åŒ–æˆ‘ä»¬æƒ³è¦ç”¨äºæ§åˆ¶çš„å…±äº«èµ„æºï¼›</li></ul><p>é€šè¿‡å®šä¹‰ä¸€ä¸ª <code>shared</code> é™æ€å¸¸é‡æ¥åˆ›å»ºä¸€ä¸ªç±»çš„ <code>private</code> åˆå§‹åŒ–æ–¹æ³•ã€‚æˆ‘ä»¬è¦ç¡®ä¿è¿™ä¸ªç±»åªæœ‰ä¸€ä¸ªå®ä¾‹ï¼Œè¯¥ç±»åªèƒ½åˆå§‹åŒ–ä¸€æ¬¡ï¼Œå¹¶ä¸”å…±äº«çš„å®ä¾‹åœ¨åº”ç”¨çš„ä»»ä½•åœ°æ–¹éƒ½èƒ½è·å–ã€‚å°±è¿™æ ·æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª<em>å•ä¾‹</em>ï¼</p><p>è¿™ä¸ªå•ä¾‹é¡¹ç›®çš„ä»£ç ï¼Œåœ¨ <a href="https://github.com/appcoda/SingletonInSwift" target="_blank" rel="noopener"><strong>GitHub</strong></a> å¯ä¸‹è½½ï¼Œå±•ç¤ºäº†ä¸€ä¸ªå¼€å‘è€…å¦‚ä½•å®‰å…¨çš„ã€é«˜æ•ˆçš„å­˜å‚¨ç”¨æˆ·çš„åå¥½ã€‚è¿™æ˜¯ä¸ªç®€å•çš„ Demoï¼Œè¯¥ Demo èƒ½å¤Ÿè®°å½•ç”¨æˆ·çš„å¯†ç æ–‡æœ¬ï¼Œåå¥½è®¾ç½®å¯è®¾ç½®ä¸ºå¯è§æˆ–éšè—ã€‚ä¸è¿‡äº‹åå‘ç°ï¼Œè¿™ä¸ªåŠŸèƒ½å¹¶ä¸æ˜¯ä¸ªå¥½æƒ³æ³•ï¼Œæˆ‘åªæ˜¯éœ€è¦ä¸€ä¸ªä¾‹å­æ¥å‘ä½ å±•ç¤ºæˆ‘ä»£ç çš„å·¥ä½œæœºåˆ¶ã€‚è¿™æ®µä»£ç <em>å®Œå…¨æ˜¯</em>å‡ºäºæ•™å­¦çš„ç›®çš„ã€‚æˆ‘å»ºè®®ä½ <strong>æ°¸è¿œä¸è¦</strong>è®©ä½ çš„å¯†ç æš´éœ²ã€‚ä½ å¯ä»¥çœ‹åˆ°ç”¨æˆ·å¯ä»¥è®¾ç½®ä»–ä»¬çš„çš„å¯†ç åå¥½ â€” ä¸”å¯†ç åå¥½è¢«å­˜å‚¨åœ¨ <code>UserDefaults</code>:</p><p><img src="https://www.appcoda.com/wp-content/uploads/2018/07/Show_Pwd.gif" alt=""></p><p>å½“ç”¨æˆ·å…³é—­åº”ç”¨å¹¶ä¸”å†æ¬¡æ‰“å¼€åï¼Œæ³¨æ„åˆ°ä»–/å¥¹çš„å¯†ç åå¥½è¢«è®°å½•äº†ï¼š</p><p><img src="https://www.appcoda.com/wp-content/uploads/2018/07/Remember_Pwd_Setting.gif" alt=""></p><p>è®©æˆ‘å‘ä½ å±•ç¤º <code>PreferencesSingleton.swift</code> æ–‡ä»¶ä¸­çš„ä»£ç ç‰‡æ®µï¼Œåœ¨è¡Œå†…æ³¨é‡Šé‡Œï¼Œä½ å°†ä¼šçœ‹åˆ°æˆ‘æƒ³å‡†ç¡®è¡¨è¾¾çš„æ„æ€ã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserPreferences</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç”¨ç±»çš„åˆå§‹åŒ–æ–¹æ³•åˆ›å»ºä¸€ä¸ªé™æ€çš„ï¼Œå¸¸é‡å®ä¾‹ã€‚</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">let</span> shared = <span class="type">UserPreferences</span>()</span><br><span class="line">    </span><br><span class="line"><span class="comment">// è¿™æ˜¯ä¸€ä¸ªç§æœ‰çš„ï¼Œæ”¶æˆ‘ä»¬ä¿æŠ¤çš„èµ„æºå…±äº«çš„ã€‚</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">let</span> userPreferences: <span class="type">UserDefaults</span></span><br><span class="line">    </span><br><span class="line"><span class="comment">// ä¸€ä¸ªç§æœ‰çš„åˆå§‹åŒ–æ–¹æ³•åªèƒ½è¢«ç±»æœ¬èº«è°ƒç”¨ã€‚</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">init</span>() &#123;</span><br><span class="line">        </span><br><span class="line"><span class="comment">// è·å– iOS å…±äº«å•ä¾‹ã€‚æˆ‘ä»¬åœ¨è¿™é‡ŒåŒ…è£…äº†å®ƒã€‚</span></span><br><span class="line">        userPreferences = <span class="type">UserDefaults</span>.standard</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125; <span class="comment">// end class UserPreferences</span></span><br></pre></td></tr></table></figure><p>åº”ç”¨å¯åŠ¨çš„æ—¶å€™éœ€è¦åˆå§‹åŒ–é™æ€å±æ€§ï¼Œä½†æ˜¯å…¨å±€å˜é‡é»˜è®¤æ˜¯æ‡’åŠ è½½ã€‚ä½ å¯èƒ½ä¼šæ‹…å¿ƒä¸Šé¢è¿™æ®µä»£ç åœ¨æ‰§è¡Œçš„æ—¶å€™å‡ºé”™ï¼Œä¸è¿‡å°±æˆ‘å¯¹ Swift çš„äº†è§£æ¥è¯´ï¼Œè¿™æ®µä»£ç å®Œå…¨æ²¡é—®é¢˜ã€‚</p><p>ä½ ä¹Ÿè®¸ä¼šé—®ï¼Œâ€œä¸ºä»€ä¹ˆè¦é€šè¿‡åŒ…è£…å¦ä¸€ä¸ª<code>UserDefaults</code> å•ä¾‹çš„æ–¹å¼æ¥åˆ›å»ºä¸€ä¸ªå•ä¾‹ï¼Ÿâ€ é¦–å…ˆï¼Œæˆ‘ä¸»è¦ç›®çš„æ˜¯è¦å‘ä½ å±•ç¤ºåœ¨ Swift ä¸­åˆ›å»ºå’Œä½¿ç”¨å•ä¾‹çš„æœ€ä½³åšæ³•ã€‚ ç”¨æˆ·åå¥½æ˜¯ä¸€ä¸ªèµ„æºç±»å‹ï¼Œåº”è¯¥æœ‰ä¸€ä¸ªå•ä¸€çš„å…¥å£ã€‚æ‰€ä»¥åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå¾ˆæ˜æ˜¾æˆ‘ä»¬åº”è¯¥ä½¿ç”¨ <code>UserDefaults</code>ã€‚å…¶æ¬¡ï¼Œæƒ³ä¸€ä¸‹ä½ æ›¾å¤šå°‘æ¬¡çœ‹åˆ°åœ¨åº”ç”¨ä¸­ <code>UserDefaults</code> è¢«æ»¥ç”¨ã€‚</p><p>åœ¨ä¸€äº›é¡¹ç›®åº”ç”¨ä»£ç ä¸­ï¼Œæˆ‘çœ‹åˆ° <code>UserDefaults</code>(æˆ–è€…ä¹‹å‰çš„ <code>NSUserDefaults</code>)çš„ä½¿ç”¨ç¼ºä¹æ¡ç†å’ŒåŸç”±ã€‚ç”¨æˆ·åå¥½å±æ€§å¯¹åº”çš„æ¯ä¸ªé”®éƒ½æ˜¯å­—ç¬¦ä¸²å¼•ç”¨ã€‚åˆšæ‰ï¼Œæˆ‘åœ¨ä»£ç ä¸­å‘ç°äº†ä¸€ä¸ª bugã€‚æˆ‘æŠŠâ€œswitchâ€æ‹¼å†™æˆäº†â€œswithcâ€ï¼Œç”±äºæˆ‘å¯¹ä»£ç è¿›è¡Œäº†å¤åˆ¶å’Œç²˜è´´ï¼Œåœ¨å‘ç°é—®é¢˜å‰ï¼Œæˆ‘å·²ç»åˆ›å»ºäº†ä¸å°‘â€œswithcâ€çš„å®ä¾‹ã€‚ å¦‚æœå…¶ä»–å¼€å‘è€…åœ¨è¿™ä¸ªåº”ç”¨å¼€å§‹æˆ–è€…ç»§ç»­ä½¿ç”¨â€œswitchâ€ä½œä¸ºä¸€ä¸ªé”®æ¥å­˜å‚¨å¯¹åº”çš„å€¼å‘¢ï¼Ÿåº”ç”¨çš„å½“å‰çŠ¶æ€æ˜¯æ— æ³•è¢«æ­£ç¡®ä¿å­˜çš„ã€‚ æˆ‘ä»¬ç»å¸¸ä½¿ç”¨ <code>UserDefaults</code> çš„ strings ä»¥é”®å€¼æ˜ å°„çš„æ–¹å¼ä¿å­˜åº”ç”¨çš„çŠ¶æ€ã€‚è¿™æ˜¯ä¸€ä¸ªå¥½çš„å†™æ³•ã€‚è¿™å¯ä»¥è®©å€¼çš„æ„æ€æ¸…æ™°æ˜ç¡®ã€ç®€å•æ˜“æ‡‚ï¼Œè¿˜ä¾¿äºè®°å¿†ã€‚ä½†ä¹Ÿä¸æ˜¯è¯´é€šè¿‡ strings æ¥æè¿°æ˜¯æ²¡æœ‰ä»»ä½•é£é™©çš„ã€‚</p><p>åœ¨æˆ‘è®¨è®ºçš„â€œswithcâ€ä¸â€œswitchâ€ä¸­ã€‚å¤§å¤šæ•°äººå¯èƒ½å·²ç»æ˜ç™½äº†è¢«ç§°ä¸ºâ€œstringly-typedâ€çš„é‚£äº›ä»£ç , ç”¨ strings ä½œä¸ºå”¯ä¸€çš„æ ‡è¯†ç¬¦ä¼šäº§ç”Ÿç»†å¾®çš„ä¸åŒï¼Œæœ€ç»ˆä¼šå› ä¸ºæ‹¼å†™é”™è¯¯å¸¦æ¥ç¾éš¾æ€§çš„é”™è¯¯ã€‚Swift ç¼–è¯‘å™¨ä¸èƒ½å¸®åŠ©æˆ‘ä»¬é¿å…â€œstringly-typedâ€è¿™ç±»çš„é”™è¯¯ã€‚</p><p>è§£å†³â€œstringly-typedâ€é”™è¯¯çš„æ–¹å¼åœ¨äºæŠŠ Swift <code>enum</code> è®¾ç½®æˆ string ç±»å‹ã€‚è¿™ä¹ˆåšä¸ä»…å¯ä»¥è®©æˆ‘ä»¬æ ‡å‡†åŒ–å­—ç¬¦ä¸²çš„ä½¿ç”¨ï¼Œè€Œä¸”å¯è®©æˆ‘ä»¬å¯¹å…¶è¿›è¡Œåˆ†ç±»ç®¡ç†ã€‚è®©æˆ‘ä»¬å†æ¬¡å›åˆ° <code>PreferencesSingleton.swift</code>:<br><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserPreferences</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="class"><span class="keyword">enum</span> <span class="title">Preferences</span> </span>&#123;</span><br><span class="line">        </span><br><span class="line">        <span class="class"><span class="keyword">enum</span> <span class="title">UserCredentials</span>: <span class="title">String</span> </span>&#123;</span><br><span class="line">            <span class="keyword">case</span> passwordVisibile</span><br><span class="line">            <span class="keyword">case</span> password</span><br><span class="line">            <span class="keyword">case</span> username</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="class"><span class="keyword">enum</span> <span class="title">AppState</span>: <span class="title">String</span> </span>&#123;</span><br><span class="line">            <span class="keyword">case</span> appFirstRun</span><br><span class="line">            <span class="keyword">case</span> dateLastRun</span><br><span class="line">            <span class="keyword">case</span> currentVersion</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">    &#125; <span class="comment">// end enum Preferences</span></span><br></pre></td></tr></table></figure></p><p>æˆ‘ä»¬ä»å•ä¾‹æ¨¡å¼çš„å®šä¹‰å¼€å§‹ï¼Œå‘ä½ ä»‹ç»æ¸…æ¥šåœ¨æˆ‘çš„åº”ç”¨ä¸­ï¼Œä¸ºä»€ä¹ˆä½¿ç”¨ä¸€ä¸ªå•ä¾‹æ¥å°è£… <code>UserDefaults</code>ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡æ·»åŠ å€¼çš„æ–¹å¼æ¥å¢æ·»æ–°çš„åŠŸèƒ½ï¼Œä½†é€šè¿‡ç®€å•çš„å¯¹ <code>UserDefaults</code> çš„åŒ…è£…å´èƒ½å¢å¼ºä»£ç çš„å¥å£®æ€§ã€‚åœ¨è·å–å’Œè®¾ç½®ç”¨æˆ·åå¥½æ—¶ï¼Œä½ è„‘ä¸­åº”è¯¥è¦é©¬ä¸Šæƒ³åˆ°è¿›è¡Œé”™è¯¯æ ¡éªŒã€‚åœ¨è¿™é‡Œï¼Œæˆ‘æƒ³å®ç°ä¸€ä¸ªå…³äºç”¨æˆ·åå¥½çš„åŠŸèƒ½ï¼Œè®¾ç½®å¯†ç çš„å¯è§æ€§ã€‚çœ‹åˆ°ä¸‹é¢çš„ä»£ç ã€‚å†…å®¹éƒ½åœ¨ <code>PreferencesSingleton.swift</code> æ–‡ä»¶ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Foundation</span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserPreferences</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="class"><span class="keyword">enum</span> <span class="title">Preferences</span> </span>&#123;</span><br><span class="line">        </span><br><span class="line">        <span class="class"><span class="keyword">enum</span> <span class="title">UserCredentials</span>: <span class="title">String</span> </span>&#123;</span><br><span class="line">            <span class="keyword">case</span> passwordVisibile</span><br><span class="line">            <span class="keyword">case</span> password</span><br><span class="line">            <span class="keyword">case</span> username</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="class"><span class="keyword">enum</span> <span class="title">AppState</span>: <span class="title">String</span> </span>&#123;</span><br><span class="line">            <span class="keyword">case</span> appFirstRun</span><br><span class="line">            <span class="keyword">case</span> dateLastRun</span><br><span class="line">            <span class="keyword">case</span> currentVersion</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">    &#125; <span class="comment">// end enum Preferences</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åˆ›å»ºä¸€ä¸ªé™æ€ã€å¸¸é‡å®ä¾‹å¹¶åˆå§‹åŒ–</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">let</span> shared = <span class="type">UserPreferences</span>()</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è¿™æ˜¯ä¸€ä¸ªç§æœ‰çš„ï¼Œè¢«ä¿æŠ¤çš„å…±äº«èµ„æº</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">let</span> userPreferences: <span class="type">UserDefaults</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åªæœ‰ç±»æœ¬èº«èƒ½è°ƒç”¨çš„ä¸€ä¸ªç§æœ‰åˆå§‹åŒ–æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">init</span>() &#123;</span><br><span class="line">        <span class="comment">// è·å– iOS å…±äº«å•ä¾‹ã€‚æˆ‘ä»¬åœ¨è¿™é‡ŒåŒ…è£…å®ƒ</span></span><br><span class="line">        userPreferences = <span class="type">UserDefaults</span>.standard</span><br><span class="line"> </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">setBooleanForKey</span><span class="params">(<span class="number">_</span> boolean:Bool, key:String)</span></span> &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> key != <span class="string">""</span> &#123;</span><br><span class="line">            userPreferences.<span class="keyword">set</span>(boolean, forKey: key)</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">getBooleanForKey</span><span class="params">(<span class="number">_</span> key:String)</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> isBooleanValue = userPreferences.value(forKey: key) <span class="keyword">as</span>! <span class="type">Bool</span>? &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"Key <span class="subst">\(key)</span> is <span class="subst">\(isBooleanValue)</span>"</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"Key <span class="subst">\(key)</span> is false"</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">isPasswordVisible</span><span class="params">()</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">let</span> isVisible = userPreferences.bool(forKey: <span class="type">Preferences</span>.<span class="type">UserCredentials</span>.passwordVisibile.rawValue)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> isVisible &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>æ¥åˆ° <code>ViewController.swift</code> æ–‡ä»¶ï¼Œä½ å°†çœ‹åˆ°ï¼Œè®¿é—®å¹¶ä½¿ç”¨ç»“æ„è‰¯å¥½çš„å•ä¾‹æ˜¯å¤šä¹ˆçš„å®¹æ˜“ï¼š<br><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewController</span>: <span class="title">UIViewController</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@IBOutlet</span> <span class="keyword">weak</span> <span class="keyword">var</span> passwordTextField: <span class="type">UITextField</span>!</span><br><span class="line">    <span class="meta">@IBOutlet</span> <span class="keyword">weak</span> <span class="keyword">var</span> passwordVisibleSwitch: <span class="type">UISwitch</span>!</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.viewDidLoad()</span><br><span class="line"><span class="comment">// åœ¨åŠ è½½è§†å›¾åï¼ˆä¸€èˆ¬é€šè¿‡ nib æ¥è¿›è¡Œï¼‰è¿›è¡Œå…¶å®ƒçš„é¢å¤–è®¾ç½®ã€‚</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> <span class="type">UserPreferences</span>.shared.isPasswordVisible() &#123;</span><br><span class="line">            passwordVisibleSwitch.isOn = <span class="literal">true</span></span><br><span class="line">            passwordTextField.isSecureTextEntry = <span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            passwordVisibleSwitch.isOn = <span class="literal">false</span></span><br><span class="line">            passwordTextField.isSecureTextEntry = <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125; </span><br><span class="line"> </span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">didReceiveMemoryWarning</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.didReceiveMemoryWarning()</span><br><span class="line"><span class="comment">// å¯ä»¥é”€æ¯é‚£äº›èƒ½è¢«é‡æ–°åˆ›å»ºçš„èµ„æº</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@IBAction</span> <span class="function"><span class="keyword">func</span> <span class="title">passwordVisibleSwitched</span><span class="params">(<span class="number">_</span> sender: Any)</span></span> &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">let</span> pwdSwitch:<span class="type">UISwitch</span> = sender <span class="keyword">as</span>! <span class="type">UISwitch</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> pwdSwitch.isOn &#123;</span><br><span class="line">            passwordTextField.isSecureTextEntry = <span class="literal">false</span></span><br><span class="line">            <span class="type">UserPreferences</span>.shared.setPasswordVisibity(<span class="literal">true</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            passwordTextField.isSecureTextEntry = <span class="literal">true</span></span><br><span class="line">            <span class="type">UserPreferences</span>.shared.setPasswordVisibity(<span class="literal">false</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p><h2 id="ç»“è®º"><a href="#ç»“è®º" class="headerlink" title="ç»“è®º"></a>ç»“è®º</h2><p>æœ‰äº›è¯„è®ºå®¶å£°ç§°è®¾è®¡æ¨¡å¼åœ¨ä¸€äº›ç¼–ç¨‹è¯­è¨€ä¸­çš„ä½¿ç”¨ç¼ºä¹è¯æ˜ï¼Œç›¸åŒçš„è®¾è®¡æ¨¡å¼åœ¨ä»£ç ä¸­åå¤å‡ºç°æ˜¯å¾ˆæ§½ç³•çš„ä¸€ä»¶äº‹æƒ…ã€‚æˆ‘å¹¶ä¸åŒæ„è¿™ä¸ªè¯´æ³•ã€‚æœŸæœ›ä¸€ä¸ªç¼–ç¨‹è¯­è¨€å¯¹<em>æ¯ä»¶äº‹æƒ…</em>çš„å¤„ç†éƒ½æœ‰å…¶å¯¹åº”çš„ç‰¹æ€§æ˜¯å¾ˆæ„šè ¢çš„ã€‚è¿™å¾ˆå¯èƒ½ä¼šå¯¼è‡´ä¸€ä¸ªè‡ƒè‚¿çš„è¯­è¨€ï¼Œåƒ C++ ä¸€æ ·æ­£åœ¨å˜å¾—æ›´å¤§ã€æ›´å¤æ‚ï¼Œä»¥è‡´å¾ˆéš¾è¢«å­¦ä¹ ã€ä½¿ç”¨ä¸ç»´æŠ¤ã€‚è®¤è¯†å¹¶è§£å†³åå¤å‡ºç°çš„é—®é¢˜æ˜¯äººçš„ä¸€ç§ç§¯ææ€§æ ¼å¹¶ä¸”è¿™ç¡®å®å€¼å¾—æˆ‘ä»¬å¼ºåŒ–ã€‚æœ‰ä¸€äº›äº‹æƒ…ï¼Œäººä»¬å°è¯•å´å¤±è´¥äº†å¾ˆå¤šæ¬¡ï¼Œé€šè¿‡å­¦ä¹ æ€»ç»“å‰äººç»éªŒï¼Œå¯¹ä¸€äº›ç›¸åŒçš„é—®é¢˜è¿›è¡ŒæŠ½è±¡å’Œæ ‡å‡†åŒ–ï¼Œè®©è¿™äº›å¥½çš„è§£å†³æ–¹æ¡ˆæ•£æ’­å‡ºå»çš„æ–¹é¢ï¼Œè®¾è®¡æ¨¡å¼æˆä¸ºäº†ä¸€ä¸ªæˆåŠŸæ¡ˆä¾‹ã€‚</p><p>åƒ Swift è¿™æ ·çš„ç®€å•ç´§å‡‘çš„è¯­è¨€å’Œè®¾è®¡æ¨¡å¼è¿™æ ·ä¸€ç³»åˆ—æœ€ä½³å®è·µçš„ç»„åˆæ˜¯ä¸€ä¸ªç†æƒ³ä¸­çš„ã€ä»¤äººå¼€å¿ƒçš„æ–¹æ³•ã€‚é£æ ¼ç»Ÿä¸€çš„ä»£ç ä¸€èˆ¬æ¥è¯´éƒ½å…·æœ‰è¾ƒå¥½çš„å¯è¯»æ€§å’Œæ˜“ç»´æŠ¤æ€§ã€‚ä¸è¿‡ä¹Ÿè¦è®°ä½ï¼Œåœ¨æ•°ä»¥ç™¾ä¸‡çš„å¼€å‘è€…ä¸æ–­åœ°è®¨è®ºå’Œåˆ†äº«ä¸‹ï¼Œè®¾è®¡æ¨¡å¼ä¹Ÿåœ¨ä¸æ–­çš„å‘å±•å˜åŒ–ï¼Œè¿™äº›ç¾å¥½äº‹ç‰©è¢«ä¸‡ç»´ç½‘è”ç³»åœ¨ä¸€èµ·ï¼Œè¿™ç§å¼€å‘äººå‘˜çš„è®¨è®ºæŒç»­çš„å¼•é¢†ç€é›†ä½“æ™ºæ…§çš„è‡ªæˆ‘è°ƒèŠ‚ã€‚</p><blockquote><p>æœ¬æ–‡ç”± SwiftGG ç¿»è¯‘ç»„ç¿»è¯‘ï¼Œå·²ç»è·å¾—ä½œè€…ç¿»è¯‘æˆæƒï¼Œæœ€æ–°æ–‡ç« è¯·è®¿é—® <a href="http://swift.gg">http://swift.gg</a>ã€‚</p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;ä½œè€…ï¼šAndrew Jaffeeï¼Œ&lt;a href=&quot;https://www.appcoda.com/design-pattern-creational/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;åŸæ–‡é“¾æ¥&lt;/a&gt;ï¼ŒåŸæ–‡æ—¥æœŸï¼š2018-07-24&lt;br&gt;è¯‘è€…ï¼š&lt;a href=&quot;https://github.com/Adolf-L&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;BigLuo&lt;/a&gt;ï¼›æ ¡å¯¹ï¼š&lt;a href=&quot;http://www.jianshu.com/users/596f2ba91ce9/latest_articles&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;pmst&lt;/a&gt;ï¼Œ&lt;a href=&quot;http://numbbbbb.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;numbbbbb&lt;/a&gt;ï¼›å®šç¨¿ï¼š&lt;a href=&quot;http://forelax.space&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Forelax&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;!--æ­¤å¤„å¼€å§‹æ­£æ–‡--&gt;
&lt;p&gt;â€œGang of Fourâ€ (â€œGoFâ€) Erich Gammaï¼ŒRichard Helmï¼ŒRalph Johonsonï¼Œå’Œ John Vlissides åœ¨ä»–ä»¬â€œ&lt;a href=&quot;https://smile.amazon.com/Design-Patterns-Object-Oriented-Addison-Wesley-Professional-ebook/dp/B000SEIBB8/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;è®¾è®¡æ¨¡å¼ï¼šé¢å‘å¯¹è±¡è½¯ä»¶è®¾è®¡å¤ç”¨çš„åŸºæœ¬åŸç†&lt;/a&gt;â€ çš„é‡è¦è‘—ä½œé‡Œæ•´ç†äº†å¤§æ¦‚ 23 ç§ç»å…¸çš„è®¾è®¡æ¨¡å¼ ã€‚æœ¬æ–‡ä¼šä»‹ç» GoF æ€»ç»“çš„ä¸¤ç§åˆ›å»ºå‹ï¼ˆcreationalï¼‰æ¨¡å¼ï¼š&lt;em&gt;å·¥å‚æ–¹æ³•&lt;/em&gt;å’Œ&lt;em&gt;å•ä¾‹æ–¹æ³•&lt;/em&gt;ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="Swift" scheme="https://swift.gg/categories/Swift/"/>
    
    
      <category term="Design Patterns" scheme="https://swift.gg/tags/Design-Patterns/"/>
    
  </entry>
  
  <entry>
    <title>Never</title>
    <link href="https://swift.gg/2018/08/30/never/"/>
    <id>https://swift.gg/2018/08/30/never/</id>
    <published>2018-08-30T00:00:00.000Z</published>
    <updated>2019-02-18T08:52:03.568Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ä½œè€…ï¼šMatttï¼Œ<a href="https://nshipster.com/never/" target="_blank" rel="noopener">åŸæ–‡é“¾æ¥</a>ï¼ŒåŸæ–‡æ—¥æœŸï¼š2018-07-30<br>è¯‘è€…ï¼š<a href="https://github.com/mobilefellow" target="_blank" rel="noopener">é›¨è°¨</a>ï¼›æ ¡å¯¹ï¼š<a href="http://numbbbbb.com/" target="_blank" rel="noopener">numbbbbb</a>ï¼Œ<a href="undefined">wongzigii</a>ï¼Œ<a href="undefined">Firecrest</a>ï¼›å®šç¨¿ï¼š<a href="https://github.com/chenmingbiao" target="_blank" rel="noopener">CMB</a></p></blockquote><!--æ­¤å¤„å¼€å§‹æ­£æ–‡--><p><code>Never</code> æ˜¯ä¸€ä¸ªçº¦å®šï¼Œè¡¨ç¤ºä¸€ä»¶äº‹åœ¨è¿‡å»æˆ–æœªæ¥çš„ä»»ä½•æ—¶æ®µéƒ½ä¸ä¼šå‘ç”Ÿã€‚å®ƒæ˜¯æ—¶é—´è½´ä¸Šçš„ä¸€ç§é€»è¾‘ä¸Šçš„ä¸å¯èƒ½ï¼Œåœ¨ä»»ä½•æ–¹å‘å»¶å±•å¼€å»éƒ½æ²¡æœ‰å¯èƒ½ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆåœ¨ä»£ç ä¸­çœ‹åˆ° <a href="https://github.com/search?q=%22this+will+never+happen%22&amp;type=Code" target="_blank" rel="noopener">è¿™æ ·çš„æ³¨é‡Š</a> ä¼šç‰¹åˆ«è®©äººä¸å®‰ã€‚</p><a id="more"></a><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// è¿™ä¸ªä¸ä¼šå‘ç”Ÿ</span></span><br></pre></td></tr></table></figure><p>æ‰€æœ‰ç¼–è¯‘å™¨çš„æ•™ç§‘ä¹¦éƒ½ä¼šå‘Šè¯‰ä½ ï¼Œè¿™æ ·ä¸€å¥æ³¨é‡Šä¸èƒ½ä¹Ÿä¸ä¼šå¯¹ç¼–è¯‘å‡ºçš„ä»£ç äº§ç”Ÿä»»ä½•å½±å“ã€‚<a href="https://en.wikipedia.org/wiki/Murphy%27s_law" target="_blank" rel="noopener">å¢¨è²å®šç†</a> å‘Šè¯‰ä½ å¹¶éå¦‚æ­¤ï¼Œæ³¨é‡Šä»¥ä¸‹çš„ä»£ç ä¸€å®šä¼šè¢«è§¦å‘ã€‚</p><p>é‚£ Swift æ˜¯å¦‚ä½•åœ¨è¿™ç§æ— æ³•é¢„æµ‹çš„ã€æ··ä¹±çš„å¼€å‘è¿‡ç¨‹ä¸­ä¿è¯å®‰å…¨å‘¢ï¼Ÿç­”æ¡ˆéš¾ä»¥ç½®ä¿¡ï¼šâ€œ<strong>ä»€ä¹ˆéƒ½ä¸åš</strong>â€ï¼Œä»¥åŠâ€œ<strong>å´©æºƒ</strong>â€ã€‚</p><hr><p>ä½¿ç”¨ <code>Never</code> æ›¿æ¢ <code>@noreturn</code> ä¿®é¥°ç¬¦ï¼Œæ˜¯ç”± <a href="https://github.com/jckarter" target="_blank" rel="noopener">Joe Groff</a> åœ¨ <a href="https://github.com/apple/swift-evolution/blob/master/proposals/0102-noreturn-bottom-type.md" target="_blank" rel="noopener">SE-0102: â€œRemove @noreturn attribute and introduce an empty Never typeâ€</a> ä¸­æå‡ºçš„ã€‚</p><p>åœ¨ Swift 3 ä¹‹å‰ï¼Œé‚£äº›è¦ä¸­æ–­æ‰§è¡Œçš„å‡½æ•°ï¼Œæ¯”å¦‚ <code>fatalError(_:file:line:)</code>ï¼Œ<code>abort()</code> å’Œ <code>exit(_:)</code>ï¼Œéœ€è¦ä½¿ç”¨ <code>@noreturn</code> ä¿®é¥°ç¬¦æ¥å£°æ˜ï¼Œè¿™ä¼šå‘Šè¯‰ç¼–è¯‘å™¨ï¼Œæ‰§è¡Œå®Œæˆåä¸ç”¨è¿”å›è°ƒç”¨è¿™ä¸ªå‡½æ•°çš„ä½ç½®ã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Swift &lt; 3.0</span></span><br><span class="line"><span class="meta">@noreturn</span> <span class="function"><span class="keyword">func</span> <span class="title">fatalError</span><span class="params">(<span class="number">_</span> message: <span class="params">()</span></span></span> -&gt; <span class="type">String</span> = <span class="type">String</span>(),</span><br><span class="line">                               file: <span class="type">StaticString</span> = #file,</span><br><span class="line">                               line: <span class="type">UInt</span> = #line)</span><br></pre></td></tr></table></figure><p>ä» Swift 3 å¼€å§‹ï¼Œ<code>fatalError</code> å’Œå®ƒçš„ç›¸å…³å‡½æ•°éƒ½è¢«å£°æ˜ä¸ºè¿”å› <code>Never</code> ç±»å‹ã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Swift &gt;= 3.0</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">fatalError</span><span class="params">(<span class="number">_</span> message: @autoclosure <span class="params">()</span></span></span> -&gt; <span class="type">String</span> = <span class="type">String</span>(),</span><br><span class="line">                     file: <span class="type">StaticString</span> = #file,</span><br><span class="line">                     line: <span class="type">UInt</span> = #line) -&gt; <span class="type">Never</span></span><br></pre></td></tr></table></figure><p>ä½œä¸ºä¸€ä¸ªæ³¨é‡Šçš„æ›¿ä»£å“ï¼Œå®ƒè‚¯å®šæ˜¯å¾ˆå¤æ‚çš„ï¼Œå¯¹å—ï¼ŸNOï¼äº‹å®ä¸Šï¼Œæ°æ°ç›¸åï¼Œ<code>Never</code> å¯ä»¥è¯´æ˜¯æ•´ä¸ª Swift æ ‡å‡†åº“ä¸­æœ€ç®€å•çš„ä¸€ä¸ªç±»å‹ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">Never</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure><h2 id="æ— å®ä¾‹ç±»å‹ï¼ˆUninhabited-Typesï¼‰"><a href="#æ— å®ä¾‹ç±»å‹ï¼ˆUninhabited-Typesï¼‰" class="headerlink" title="æ— å®ä¾‹ç±»å‹ï¼ˆUninhabited Typesï¼‰"></a>æ— å®ä¾‹ç±»å‹ï¼ˆ<code>Uninhabited Types</code>ï¼‰</h2><p><code>Never</code> æ˜¯ä¸€ä¸ª<em>æ— å®ä¾‹</em>ï¼ˆ<em>Uninhabited</em>ï¼‰ç±»å‹ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒæ²¡æœ‰ä»»ä½•å€¼ã€‚æˆ–è€…æ¢å¥è¯è¯´ï¼Œæ— å®ä¾‹ç±»å‹æ˜¯æ— æ³•è¢«æ„å»ºçš„ã€‚</p><p>åœ¨ Swift ä¸­ï¼Œæ²¡æœ‰å®šä¹‰ä»»ä½• <code>case</code> çš„æšä¸¾æ˜¯æœ€å¸¸è§çš„ä¸€ç§æ— å®ä¾‹ç±»å‹ã€‚è·Ÿç»“æ„ä½“å’Œç±»ä¸åŒï¼Œæšä¸¾æ²¡æœ‰åˆå§‹åŒ–æ–¹æ³•ã€‚è·Ÿåè®®ä¹Ÿä¸åŒï¼Œæšä¸¾æ˜¯ä¸€ä¸ªå…·ä½“çš„ç±»å‹ï¼Œå¯ä»¥åŒ…å«å±æ€§ã€æ–¹æ³•ã€æ³›å‹çº¦æŸå’ŒåµŒå¥—ç±»å‹ã€‚æ­£å› å¦‚æ­¤ï¼ŒSwift æ ‡å‡†åº“å¹¿æ³›ä½¿ç”¨æ— å®ä¾‹çš„æšä¸¾ç±»å‹æ¥åšè¯¸å¦‚ <a href="https://github.com/apple/swift/blob/a4230ab2ad37e37edc9ed86cd1510b7c016a769d/stdlib/public/core/Unicode.swift#L918" target="_blank" rel="noopener">å®šä¹‰å‘½åç©ºé—´</a> ä»¥åŠ <a href="https://github.com/apple/swift/blob/a6952decab6f918a9df3c6fa342153a9f9204f8e/stdlib/public/core/MemoryLayout.swift#L43" target="_blank" rel="noopener">æ ‡è¯†ç±»å‹çš„å«ä¹‰</a> ä¹‹ç±»çš„äº‹æƒ…ã€‚</p><p>ä½† <code>Never</code> å¹¶ä¸è¿™æ ·ã€‚å®ƒæ²¡æœ‰ä»€ä¹ˆèŠ±å“¨çš„ä¸œè¥¿ï¼Œå®ƒçš„ç‰¹åˆ«ä¹‹å¤„å°±åœ¨äºï¼Œå®ƒå°±æ˜¯å®ƒè‡ªå·±ï¼ˆæˆ–è€…è¯´ï¼Œå®ƒä»€ä¹ˆéƒ½ä¸æ˜¯ï¼‰ã€‚</p><p>è¯•æƒ³ä¸€ä¸ªè¿”å›å€¼ä¸ºæ— å®ä¾‹ç±»å‹çš„å‡½æ•°ï¼šå› ä¸ºæ— å®ä¾‹ç±»å‹æ²¡æœ‰ä»»ä½•å€¼ï¼Œæ‰€ä»¥è¿™ä¸ªå‡½æ•°æ— æ³•æ­£å¸¸çš„è¿”å›ã€‚ï¼ˆå®ƒè¦å¦‚ä½•ç”Ÿæˆè¿™ä¸ªè¿”å›å€¼å‘¢ï¼Ÿï¼‰æ‰€ä»¥ï¼Œè¿™ä¸ªå‡½æ•°è¦ä¹ˆåœæ­¢è¿è¡Œï¼Œè¦ä¹ˆæ— ä¼‘æ­¢çš„ä¸€ç›´è¿è¡Œä¸‹å»ã€‚</p><h2 id="æ¶ˆé™¤æ³›å‹ä¸­çš„ä¸å¯èƒ½çŠ¶æ€"><a href="#æ¶ˆé™¤æ³›å‹ä¸­çš„ä¸å¯èƒ½çŠ¶æ€" class="headerlink" title="æ¶ˆé™¤æ³›å‹ä¸­çš„ä¸å¯èƒ½çŠ¶æ€"></a>æ¶ˆé™¤æ³›å‹ä¸­çš„ä¸å¯èƒ½çŠ¶æ€</h2><p>ä»ç†è®ºè§’åº¦ä¸Šè¯´ï¼Œ<code>Never</code> ç¡®å®å¾ˆæœ‰æ„æ€ï¼Œä½†å®ƒåœ¨å®é™…åº”ç”¨ä¸­åˆèƒ½å¸®æˆ‘ä»¬åšä»€ä¹ˆå‘¢ï¼Ÿ</p><p>åšä¸äº†ä»€ä¹ˆï¼Œæˆ–è€…è¯´åœ¨ <a href="https://github.com/apple/swift-evolution/blob/master/proposals/0215-conform-never-to-hashable-and-equatable.md#conform-never-to-equatable-and-hashable" target="_blank" rel="noopener">SE-0215: Conform Never to Equatable and Hashable</a> æ¨å‡ºä»¥å‰ï¼Œåšä¸äº†ä»€ä¹ˆã€‚</p><p><a href="https://github.com/mdiep" target="_blank" rel="noopener">Matt Diephouse</a> åœ¨ææ¡ˆä¸­è§£é‡Šäº†ä¸ºä»€ä¹ˆè®©è¿™ä¸ªä»¤äººè´¹è§£çš„ç±»å‹å»éµå®ˆ <code>Equatable</code> å’Œå…¶ä»–åè®®ï¼š</p><blockquote><p><code>Never</code> åœ¨è¡¨ç¤ºä¸å¯èƒ½æ‰§è¡Œçš„ä»£ç æ–¹é¢éå¸¸æœ‰ç”¨ã€‚å¤§éƒ¨åˆ†äººç†Ÿæ‚‰å®ƒï¼Œæ˜¯å› ä¸ºå®ƒæ˜¯ <code>fatalError</code> ç­‰æ–¹æ³•çš„è¿”å›å€¼ï¼Œä½† <code>Never</code> åœ¨æ³›å‹æ–¹é¢ä¹Ÿéå¸¸æœ‰ç”¨ã€‚æ¯”å¦‚è¯´ï¼Œä¸€ä¸ª <code>Result</code> ç±»å‹å¯èƒ½ä½¿ç”¨ <code>Never</code> ä½œä¸ºå®ƒçš„ <code>Value</code>ï¼Œè¡¨ç¤ºæŸç§ä¸œè¥¿ä¸€ç›´æ˜¯é”™è¯¯çš„ï¼Œæˆ–è€…ä½¿ç”¨ <code>Never</code> ä½œä¸ºå®ƒçš„ <code>Error</code>ï¼Œè¡¨ç¤ºæŸç§ä¸œè¥¿ä¸€ç›´ä¸æ˜¯é”™è¯¯çš„ã€‚</p></blockquote><p>Swift æ²¡æœ‰æ ‡å‡†çš„ <code>Result</code> ç±»å‹ï¼Œå¤§éƒ¨åˆ†æƒ…å†µä¸‹å®ƒä»¬æ˜¯è¿™ä¸ªæ ·å­çš„ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">Result</span>&lt;<span class="title">Value</span>, <span class="title">Error</span>: <span class="title">Swift</span>.<span class="title">Error</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">case</span> success(<span class="type">Value</span>)</span><br><span class="line">    <span class="keyword">case</span> failure(<span class="type">Error</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>Result</code> ç±»å‹è¢«ç”¨æ¥å°è£…å¼‚æ­¥æ“ä½œç”Ÿæˆçš„è¿”å›å€¼å’Œå¼‚å¸¸ï¼ˆåŒæ­¥æ“ä½œå¯ä»¥ä½¿ç”¨ <code>throw</code> æ¥è¿”å›å¼‚å¸¸ï¼‰ã€‚</p><p>æ¯”å¦‚è¯´ï¼Œä¸€ä¸ªå‘é€å¼‚æ­¥ HTTP è¯·æ±‚çš„å‡½æ•°å¯èƒ½ä½¿ç”¨ <code>Result</code> ç±»å‹æ¥å­˜å‚¨å“åº”æˆ–é”™è¯¯ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">fetch</span><span class="params">(<span class="number">_</span> request: Request, completion: <span class="params">(Result&lt;Response, Error&gt;)</span></span></span> -&gt; <span class="type">Void</span>) &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è°ƒç”¨è¿™ä¸ªæ–¹æ³•åï¼Œä½ å¯ä»¥ä½¿ç”¨ <code>switch</code> æ¥åˆ†åˆ«å¤„ç†å®ƒçš„ <code>.success</code> å’Œ <code>.failure</code>ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">fetch(request) &#123; result <span class="keyword">in</span></span><br><span class="line">    <span class="keyword">switch</span> result &#123;</span><br><span class="line">    <span class="keyword">case</span> .success(<span class="keyword">let</span> value):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"Success: <span class="subst">\(value)</span>"</span>)</span><br><span class="line">    <span class="keyword">case</span> .failure(<span class="keyword">let</span> error):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"Failure: <span class="subst">\(error)</span>"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç°åœ¨å‡è®¾æœ‰ä¸€ä¸ªå‡½æ•°ä¼šåœ¨å®ƒçš„ <code>completion</code> ä¸­æ°¸è¿œè¿”å›æˆåŠŸç»“æœï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">alwaysSucceeds</span><span class="params">(<span class="number">_</span> completion: <span class="params">(Result&lt;String, Never&gt;)</span></span></span> -&gt; <span class="type">Void</span>) &#123;</span><br><span class="line">    completion(.success(<span class="string">"yes!"</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å°† <code>Result</code> çš„ <code>Error</code> ç±»å‹æŒ‡å®šä¸º <code>Never</code> åï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç±»å‹æ£€æµ‹ä½“ç³»æ¥è¡¨æ˜å¤±è´¥æ˜¯æ°¸è¿œä¸å¯èƒ½å‘ç”Ÿçš„ã€‚è¿™æ ·åšçš„å¥½å¤„åœ¨äºï¼Œä½ ä¸éœ€è¦å¤„ç† <code>.failure</code>ï¼ŒSwift å¯ä»¥æ¨æ–­å‡ºè¿™ä¸ª <code>switch</code> è¯­å¥å·²ç»å¤„ç†äº†æ‰€æœ‰æƒ…å†µã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">alwaysSucceeds &#123; (result) <span class="keyword">in</span></span><br><span class="line">    <span class="keyword">switch</span> result &#123;</span><br><span class="line">    <span class="keyword">case</span> .success(<span class="keyword">let</span> string):</span><br><span class="line">        <span class="built_in">print</span>(string)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸‹é¢è¿™ä¸ªä¾‹å­æ˜¯è®© <code>Never</code> éµå¾ª <code>Comparable</code> åè®®ï¼Œè¿™æ®µä»£ç æŠŠ <code>Never</code> ç”¨åˆ°äº†æè‡´ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Never</span>: <span class="title">Comparable</span> </span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> &lt; (lhs: Never, rhs: Never) -&gt; <span class="title">Bool</span> </span>&#123;</span><br><span class="line">    <span class="keyword">switch</span> (lhs, rhs) &#123;&#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å› ä¸º <code>Never</code> æ˜¯ä¸€ä¸ªæ— å®ä¾‹ç±»å‹ï¼Œæ‰€ä»¥å®ƒæ²¡æœ‰ä»»ä½•å¯èƒ½çš„å€¼ã€‚æ‰€ä»¥å½“æˆ‘ä»¬ä½¿ç”¨ <code>switch</code> éå†å®ƒçš„ <code>lhs</code> å’Œ <code>rhs</code> æ—¶ï¼ŒSwift å¯ä»¥ç¡®å®šæ‰€æœ‰çš„å¯èƒ½æ€§éƒ½éå†äº†ã€‚æ—¢ç„¶æ‰€æœ‰çš„å¯èƒ½æ€§ â€” å®é™…ä¸Šè¿™é‡Œä¸å­˜åœ¨ä»»ä½•å€¼ â€” éƒ½è¿”å›äº† <code>Bool</code>ï¼Œé‚£ä¹ˆè¿™ä¸ªæ–¹æ³•å°±å¯ä»¥æ­£å¸¸ç¼–è¯‘ã€‚</p><p><em>å·¥æ•´ï¼</em></p><h2 id="ä½¿ç”¨-Never-ä½œä¸ºå…œåº•ç±»å‹"><a href="#ä½¿ç”¨-Never-ä½œä¸ºå…œåº•ç±»å‹" class="headerlink" title="ä½¿ç”¨ Never ä½œä¸ºå…œåº•ç±»å‹"></a>ä½¿ç”¨ <code>Never</code> ä½œä¸ºå…œåº•ç±»å‹</h2><p><strong>å®é™…ä¸Šï¼Œå…³äº <code>Never</code> çš„ Swift Evolution ææ¡ˆä¸­å·²ç»æš—ç¤ºäº†è¿™ä¸ªç±»å‹åœ¨æœªæ¥å¯èƒ½æœ‰æ›´å¤šç”¨å¤„ï¼š</strong></p><blockquote><p>ä¸€ä¸ªæ— å®ä¾‹ç±»å‹å¯ä»¥ä½œä¸ºå…¶ä»–ä»»æ„ç±»å‹çš„å­ç±»å‹ â€” å¦‚æœæŸä¸ªè¡¨è¾¾å¼æ ¹æœ¬ä¸å¯èƒ½äº§ç”Ÿä»»ä½•ç»“æœï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±ä¸éœ€è¦å…³å¿ƒè¿™ä¸ªè¡¨è¾¾å¼çš„ç±»å‹åˆ°åº•æ˜¯ä»€ä¹ˆã€‚å¦‚æœç¼–è¯‘å™¨æ”¯æŒè¿™ä¸€ç‰¹æ€§ï¼Œå°±å¯ä»¥å®ç°å¾ˆå¤šæœ‰ç”¨çš„åŠŸèƒ½â€¦â€¦</p></blockquote><h3 id="è§£åŒ…æˆ–è€…æ­»äº¡"><a href="#è§£åŒ…æˆ–è€…æ­»äº¡" class="headerlink" title="è§£åŒ…æˆ–è€…æ­»äº¡"></a>è§£åŒ…æˆ–è€…æ­»äº¡</h3><p>å¼ºåˆ¶è§£åŒ…æ“ä½œï¼ˆ<code>!</code>ï¼‰æ˜¯ Swift ä¸­æœ€å…·äº‰è®®çš„éƒ¨åˆ†ä¹‹ä¸€ã€‚ï¼ˆåœ¨ä»£ç ä¸­ä½¿ç”¨è¿™ä¸ªæ“ä½œç¬¦ï¼‰å¾€å¥½äº†è¯´ï¼Œæ˜¯æœ‰æ„ä¸ºä¹‹ï¼ˆåœ¨å¼‚å¸¸æ—¶æ•…æ„è®©ç¨‹åºå´©æºƒï¼‰ï¼›å¾€åäº†è¯´ï¼Œå¯èƒ½è¡¨ç¤ºä½¿ç”¨è€…æ²¡æœ‰è®¤çœŸæ€è€ƒã€‚åœ¨ç¼ºä¹å…¶ä»–ä¿¡æ¯çš„æƒ…å†µä¸‹ï¼Œå¾ˆéš¾çœ‹å‡ºè¿™ä¸¤è€…çš„åŒºåˆ«ã€‚</p><p>æ¯”å¦‚ï¼Œä¸‹é¢çš„ä»£ç å‡å®šæ•°ç»„ä¸€å®šä¸ä¸ºç©ºï¼Œ</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> array: [<span class="type">Int</span>]</span><br><span class="line"><span class="keyword">let</span> firstIem = array.first!</span><br></pre></td></tr></table></figure><p>ä¸ºäº†é¿å…å¼ºåˆ¶è§£åŒ…ï¼Œä½ å¯ä»¥ä½¿ç”¨å¸¦æ¡ä»¶èµ‹å€¼çš„ <code>guard</code> è¯­å¥ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> array: [<span class="type">Int</span>]</span><br><span class="line"><span class="keyword">guard</span> <span class="keyword">let</span> firstItem = array.first <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">fatalError</span>(<span class="string">"array cannot be empty"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœªæ¥ï¼Œå¦‚æœ <code>Never</code> æˆä¸ºå…œåº•ç±»å‹ï¼Œå®ƒå°±å¯ä»¥ç”¨åœ¨ <code>nil-coalescing operator</code> è¡¨è¾¾å¼çš„å³è¾¹ã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æœªæ¥çš„ Swift å†™æ³•? ğŸ”®</span></span><br><span class="line"><span class="keyword">let</span> firstItem = array.first ?? <span class="built_in">fatalError</span>(<span class="string">"array cannot be empty"</span>)</span><br></pre></td></tr></table></figure><p>å¦‚æœä½ æƒ³ç°åœ¨å°±ä½¿ç”¨è¿™ç§æ¨¡å¼ï¼Œå¯ä»¥æ‰‹åŠ¨é‡è½½ <code>??</code> è¿ç®—ç¬¦ï¼ˆä½†æ˜¯â€¦â€¦ï¼‰ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> ?? &lt;T&gt;<span class="params">(lhs: T?, rhs: @autoclosure <span class="params">()</span></span></span> -&gt; <span class="type">Never</span>) -&gt; <span class="type">T</span> &#123;</span><br><span class="line">    <span class="keyword">switch</span> lhs &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="keyword">let</span> value?:</span><br><span class="line">        <span class="keyword">return</span> value</span><br><span class="line">    <span class="keyword">case</span> <span class="literal">nil</span>:</span><br><span class="line">        rhs()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>åœ¨æ‹’ç» <a href="https://github.com/apple/swift-evolution/blob/master/proposals/0217-bangbang.md#on-forced-unwraps" target="_blank" rel="noopener">SE-0217: Introducing the !! â€œUnwrap or Dieâ€ operator to the Swift Standard Library</a> çš„<a href="https://forums.swift.org/t/se-0217-the-unwrap-or-die-operator/14107/222" target="_blank" rel="noopener">åŸå› è¯´æ˜</a>ä¸­, <a href="https://github.com/jckarter" target="_blank" rel="noopener">Joe Groff</a> æåˆ°ï¼Œâ€œæˆ‘ä»¬å‘ç°é‡è½½ [?? for Never] ä¼šå¯¹ç±»å‹æ£€æµ‹çš„æ€§èƒ½äº§ç”Ÿéš¾ä»¥æ¥å—çš„å½±å“â€ã€‚æ‰€ä»¥ï¼Œä¸å»ºè®®ä½ åœ¨è‡ªå·±çš„ä»£ç ä¸­æ·»åŠ ä¸Šé¢çš„ä»£ç ã€‚</p></blockquote><h3 id="è¡¨è¾¾å¼é£æ ¼çš„-Throw"><a href="#è¡¨è¾¾å¼é£æ ¼çš„-Throw" class="headerlink" title="è¡¨è¾¾å¼é£æ ¼çš„ Throw"></a>è¡¨è¾¾å¼é£æ ¼çš„ Throw</h3><p>ç±»ä¼¼çš„ï¼Œå¦‚æœ <code>throw</code> å¯ä»¥ä»è¯­å¥å˜æˆä¸€ä¸ªè¿”å› <code>Never</code>çš„è¡¨è¾¾å¼ï¼Œä½ å°±å¯ä»¥åœ¨ <code>??</code> å³è¾¹ä½¿ç”¨ <code>throw</code>ã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æœªæ¥çš„ Swift å†™æ³•? ğŸ”®</span></span><br><span class="line"><span class="keyword">let</span> firstItem = array.first ?? <span class="keyword">throw</span> <span class="type">Error</span>.empty</span><br></pre></td></tr></table></figure><h3 id="å¸¦ç±»å‹çš„-Throw"><a href="#å¸¦ç±»å‹çš„-Throw" class="headerlink" title="å¸¦ç±»å‹çš„ Throw"></a>å¸¦ç±»å‹çš„ <code>Throw</code></h3><p>ç»§ç»­ç ”ç©¶ä¸‹å»ï¼šå¦‚æœå‡½æ•°å£°æ˜çš„ <code>throw</code> å…³é”®å­—æ”¯æŒç±»å‹çº¦æŸï¼Œé‚£ä¹ˆ <code>Never</code> å¯ä»¥ç”¨æ¥è¡¨æ˜æŸä¸ªå‡½æ•°ç»å¯¹ä¸ä¼šæŠ›å‡ºå¼‚å¸¸ï¼ˆç±»ä¼¼äºåœ¨ä¸Šé¢çš„ <code>Result</code> ä¾‹å­ï¼‰ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æœªæ¥çš„ Swift å†™æ³•? ğŸ”®</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">neverThrows</span><span class="params">()</span></span> <span class="keyword">throws</span>&lt;<span class="type">Never</span>&gt; &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">neverThrows() <span class="comment">// æ— éœ€ä½¿ç”¨ `try` ï¼Œå› ä¸ºç¼–è¯‘å™¨ä¿è¯å®ƒä¸€å®šæˆåŠŸï¼ˆå¯èƒ½ï¼‰</span></span><br></pre></td></tr></table></figure><hr><p>å£°ç§°æŸä¸ªäº‹æƒ…æ°¸è¿œä¸å¯èƒ½å‘ç”Ÿï¼Œå°±åƒæ˜¯å‘æ•´ä¸ªå®‡å®™å‘å‡ºé‚€è¯·ï¼Œæ¥è¯æ˜å®ƒæ˜¯é”™çš„ä¸€æ ·ã€‚æƒ…æ€é€»è¾‘ï¼ˆmodal logicï¼‰æˆ–è€…ä¿¡å¿µé€»è¾‘ï¼ˆdoxastic logicï¼‰å…è®¸ä¿é¢å­å¼çš„å¦¥åï¼ˆâ€œ<em>å®ƒå½“æ—¶æ˜¯å¯¹çš„ï¼Œæˆ–è€…æˆ‘æ˜¯è¿™ä¹ˆè®¤ä¸ºçš„ï¼</em>â€ï¼‰ï¼Œä½†æ—¶æ€é€»è¾‘ï¼ˆtemporal logicï¼‰ä¼¼ä¹å°†è¿™ä¸ªçº¦å®šæåˆ°äº†æ›´é«˜çš„ä¸€ä¸ªæ ‡å‡†ã€‚</p><p>å¹¸è¿çš„æ˜¯ï¼Œå¾—ç›Šäºæœ€ä¸åƒç±»å‹çš„ <code>Never</code>ï¼ŒSwift åˆ°è¾¾äº†è¿™ä¸ªé«˜æ ‡å‡†ã€‚</p><blockquote><p>æœ¬æ–‡ç”± SwiftGG ç¿»è¯‘ç»„ç¿»è¯‘ï¼Œå·²ç»è·å¾—ä½œè€…ç¿»è¯‘æˆæƒï¼Œæœ€æ–°æ–‡ç« è¯·è®¿é—® <a href="http://swift.gg">http://swift.gg</a>ã€‚</p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;ä½œè€…ï¼šMatttï¼Œ&lt;a href=&quot;https://nshipster.com/never/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;åŸæ–‡é“¾æ¥&lt;/a&gt;ï¼ŒåŸæ–‡æ—¥æœŸï¼š2018-07-30&lt;br&gt;è¯‘è€…ï¼š&lt;a href=&quot;https://github.com/mobilefellow&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;é›¨è°¨&lt;/a&gt;ï¼›æ ¡å¯¹ï¼š&lt;a href=&quot;http://numbbbbb.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;numbbbbb&lt;/a&gt;ï¼Œ&lt;a href=&quot;undefined&quot;&gt;wongzigii&lt;/a&gt;ï¼Œ&lt;a href=&quot;undefined&quot;&gt;Firecrest&lt;/a&gt;ï¼›å®šç¨¿ï¼š&lt;a href=&quot;https://github.com/chenmingbiao&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;CMB&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;!--æ­¤å¤„å¼€å§‹æ­£æ–‡--&gt;
&lt;p&gt;&lt;code&gt;Never&lt;/code&gt; æ˜¯ä¸€ä¸ªçº¦å®šï¼Œè¡¨ç¤ºä¸€ä»¶äº‹åœ¨è¿‡å»æˆ–æœªæ¥çš„ä»»ä½•æ—¶æ®µéƒ½ä¸ä¼šå‘ç”Ÿã€‚å®ƒæ˜¯æ—¶é—´è½´ä¸Šçš„ä¸€ç§é€»è¾‘ä¸Šçš„ä¸å¯èƒ½ï¼Œåœ¨ä»»ä½•æ–¹å‘å»¶å±•å¼€å»éƒ½æ²¡æœ‰å¯èƒ½ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆåœ¨ä»£ç ä¸­çœ‹åˆ° &lt;a href=&quot;https://github.com/search?q=%22this+will+never+happen%22&amp;amp;type=Code&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;è¿™æ ·çš„æ³¨é‡Š&lt;/a&gt; ä¼šç‰¹åˆ«è®©äººä¸å®‰ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="NSHipster" scheme="https://swift.gg/categories/NSHipster/"/>
    
    
      <category term="Swift" scheme="https://swift.gg/tags/Swift/"/>
    
  </entry>
  
  <entry>
    <title>Swift 4 æ³›å‹ï¼šå¦‚ä½•åœ¨ä½ çš„ä»£ç æˆ–Appé‡Œåº”ç”¨æ³›å‹</title>
    <link href="https://swift.gg/2018/08/28/swift-generics/"/>
    <id>https://swift.gg/2018/08/28/swift-generics/</id>
    <published>2018-08-28T00:00:00.000Z</published>
    <updated>2019-02-18T08:52:03.568Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ä½œè€…ï¼šAndrew Jaffeeï¼Œ<a href="https://appcoda.com/swift-generics" target="_blank" rel="noopener">åŸæ–‡é“¾æ¥</a>ï¼ŒåŸæ–‡æ—¥æœŸï¼š2018-02-14<br>è¯‘è€…ï¼š<a href="https://github.com/Adolf-L" target="_blank" rel="noopener">BigLuo</a>ï¼›æ ¡å¯¹ï¼š<a href="http://numbbbbb.com/" target="_blank" rel="noopener">numbbbbb</a>ï¼Œ<a href="http://muhlenxi.com/" target="_blank" rel="noopener">muhlenXi</a>ï¼›å®šç¨¿ï¼š<a href="https://github.com/chenmingbiao" target="_blank" rel="noopener">CMB</a></p></blockquote><!--æ­¤å¤„å¼€å§‹æ­£æ–‡--><p>é—®é¢˜ 1ï¼šæˆ‘èƒ½å¦å†™ä¸€ä¸ª Swift å‡½æ•°ç”¨äºæŸ¥æ‰¾åœ¨<strong>ä»»æ„æ•°ç»„</strong>ä¸­å­˜å‚¨çš„<strong>ä»»æ„ç±»å‹</strong>çš„<strong>ä»»ä½•å®ä¾‹å¯¹è±¡</strong>çš„ä½ç½®\ç´¢å¼•ã€‚</p><p>é—®é¢˜ 2ï¼šæˆ‘èƒ½å¦å†™ä¸€ä¸ª Swift å‡½æ•°ç”¨äºç¡®å®šåœ¨<strong>ä»»æ„æ•°ç»„</strong>ä¸­å­˜å‚¨çš„<strong>ä»»æ„ç±»å‹</strong>çš„<strong>ä»»ä½•å®ä¾‹å¯¹è±¡</strong>çš„ç±»å‹ã€‚</p><p>æˆ‘æ‰€è¯´çš„ â€œä»»ä½•ç±»å‹â€ï¼ŒåŒ…æ‹¬è‡ªå®šä¹‰ç±»å‹ï¼Œæ¯”å¦‚æˆ‘ä»¬è‡ªå·±å®šä¹‰çš„ Class ç±»å‹ã€‚æç¤ºï¼šæˆ‘çŸ¥é“æˆ‘èƒ½å¤Ÿç”¨ Swift <code>Array</code> ç±»å‹çš„å†…ç½®æ–¹æ³•ï¼Œå¦‚ <code>index</code> å’Œ <code>contains</code>ï¼Œä½†ä»Šå¤©æˆ‘å°†ä¼šç”¨ç®€å•ä»£ç å®ä¾‹æ¥è¯´æ˜ Swift æ³›å‹ä¸­çš„ä¸€äº›ç‰¹æ€§ã€‚</p><a id="more"></a><p>ä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘å°†<strong>æ³›å‹ç¼–ç¨‹</strong>ä½œå¦‚ä¸‹å®šä¹‰ï¼š</p><blockquote><p>â€¦ a style of computer programming in which algorithms are written in terms of types to-be-specified-later that are then instantiated when needed for specific types provided as parameters. This approach, pioneered by ML in 1973, permits writing common functions or types that differ only in the set of types on which they operate when used, thus reducing duplication.</p></blockquote><blockquote><p>æ˜¯ä¸€ç§ç®—æ³•æœºåˆ¶ä¸º types to-be-specified-later (ç±»å‹ç¡®å®šæ»å)çš„è®¡ç®—æœºç¼–ç¨‹é£æ ¼ï¼Œå½“å…·ä½“çš„ç±»å‹ä½œä¸ºå‚æ•°ä¼ å…¥åï¼Œè¯¥ç®—æ³•æœºåˆ¶ä¼šå¯¹ç±»å‹è¿›è¡Œå®ä¾‹åŒ–ã€‚è¿™ä¸ªæ–¹æ³•ç”± â€œMLâ€ åœ¨ 1973 å¹´å¼€åˆ›ã€‚å¯ä»¥ç”¨å…±æœ‰çš„å‡½æ•°å’Œç±»å‹æ¥è¡¨ç¤ºä¸€ä¸ªç±»å‹é›†åˆä»è€Œæ¥å‡å°‘å‡½æ•°æ“ä½œçš„é‡å¤ã€‚</p></blockquote><p>ç‰¹åˆ«çš„æŒ‡å‡ºï¼Œæ¥è‡ª<a href="https://developer.apple.com/library/content/documentation/Swift/Conceptual/SwiftProgrammingLanguage/Generics.html" target="_blank" rel="noopener">è‹¹æœSwiftæ–‡æ¡£</a> å…³äºâ€æ³›å‹â€è¯é¢˜çš„è¯´æ˜ï¼š</p><blockquote><p>Generic code enables you to write flexible, reusable functions and types that can work with any type, subject to requirements that you define. You can write code that avoids duplication and expresses its intent in a clear, abstracted manner.</p><p>Generics are one of the most powerful features of  Swift , and much of the Swift standard library is built with generic code. â€¦ For example,  Swift â€™s Array and Dictionary types are both generic collections. You can create an array that holds Int values, or an array that holds String values, or indeed an array for any other type that can be created in  Swift . Similarly, you can create a dictionary to store values of any specified type, and there are no limitations on what that type can be. â€¦</p></blockquote><blockquote><p>æ³›å‹ç¼–ç èƒ½è®©ä½ å†™å‡ºç¬¦åˆéœ€æ±‚ã€æ”¯æŒä»»æ„ç±»å‹ï¼Œçµæ´»ã€å¯é‡ç”¨çš„å‡½æ•°ã€‚ä½ èƒ½å¤Ÿç¼–å†™é¿å…é‡å¤å’Œç¼–ç¨‹é£æ ¼æŠ½è±¡ã€æ¸…æ™°ã€ä¼˜é›…çš„ä»£ç ã€‚</p><p>æ³›å‹æ˜¯ Swift ä¸­æœ€å¼ºå¤§çš„ç‰¹æ€§ä¹‹ä¸€ï¼Œå¤§é‡çš„ Swift æ ‡å‡†åº“ä½¿ç”¨äº†æ³›å‹ç¼–ç ã€‚ä¾‹å¦‚ï¼Œ Swift çš„æ•°ç»„å’Œå­—å…¸éƒ½æ˜¯æ³›å‹é›†åˆã€‚ä½ å¯ä»¥åˆ›å»ºä¸€ä¸ªå­˜æœ‰æ•´å‹å€¼æˆ–è€…å­—ç¬¦ä¸²å€¼çš„æ•°ç»„ï¼Œæœ‰å¿…è¦çš„è¯ï¼Œè¿˜å¯ä»¥åˆ›å»ºä¸€ä¸ªä»»ä½• Swift æ”¯æŒç±»å‹çš„æ•°ç»„ã€‚ç±»ä¼¼çš„ï¼Œä½ ä¹Ÿå¯ä»¥åˆ›å»ºä¸€ä¸ªå­—å…¸ç”¨äºå­˜å‚¨ä»»æ„æŒ‡å®šç±»å‹çš„å€¼ã€‚</p></blockquote><p>æˆ‘ä¸€ç›´æå€¡æ„å»ºå¯å¤ç”¨ï¼Œç®€æ´ï¼Œå¯ç»´æŠ¤çš„ä»£ç ï¼Œå¯¹äº Swift ä¸­çš„æ³›å‹ï¼Œå¦‚æœè¿ç”¨æ°å½“ï¼Œèƒ½æŸç§ç¨‹åº¦ä¸Šå¸®åŠ©æˆ‘å®ç°ä¸Šé¢æåˆ°çš„æ•ˆæœã€‚æ‰€ä»¥å¯¹äºä¸Šé¢ä¸¤ä¸ªé—®é¢˜ï¼Œæˆ‘çš„ç­”æ¡ˆæ˜¯ â€œYESâ€ã€‚</p><h2 id="ç”Ÿæ´»åœ¨ä¸€ä¸ªç‰¹å®šç±»å‹ç¼–ç çš„ä¸–ç•Œ"><a href="#ç”Ÿæ´»åœ¨ä¸€ä¸ªç‰¹å®šç±»å‹ç¼–ç çš„ä¸–ç•Œ" class="headerlink" title="ç”Ÿæ´»åœ¨ä¸€ä¸ªç‰¹å®šç±»å‹ç¼–ç çš„ä¸–ç•Œ"></a>ç”Ÿæ´»åœ¨ä¸€ä¸ªç‰¹å®šç±»å‹ç¼–ç çš„ä¸–ç•Œ</h2><p>è®©æˆ‘ä»¬å†™ä¸€ä¸ª Swift çš„æ–¹æ³•æ¥è¯´æ˜åœ¨ä¸€ä¸ªå­—ç¬¦ä¸²æ•°ç»„ä¸­æ˜¯å¦å­˜åœ¨ç‰¹å®šçš„ä¸€ä¸ªå­—ç¬¦ä¸²ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">existsManual</span><span class="params">(item:String, inArray:[String])</span></span> -&gt; <span class="type">Bool</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">var</span> index:<span class="type">Int</span> = <span class="number">0</span></span><br><span class="line">    <span class="keyword">var</span> found = <span class="literal">false</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">while</span> (index &lt; inArray.<span class="built_in">count</span> &amp;&amp; found == <span class="literal">false</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> item == inArray[index]</span><br><span class="line">        &#123;</span><br><span class="line">            found = <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            index = index + <span class="number">1</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> found</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è®©æˆ‘ä»¬æµ‹è¯•è¿™ä¸ªæ–¹æ³•ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> strings = [<span class="string">"Ishmael"</span>, <span class="string">"Jacob"</span>, <span class="string">"Ezekiel"</span>]</span><br><span class="line"> </span><br><span class="line"><span class="keyword">let</span> nameExistsInArray = existsManual(item: <span class="string">"Ishmael"</span>, inArray: strings)</span><br><span class="line"><span class="comment">// returns true</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">let</span> nameExistsInArray1 = existsManual(item: <span class="string">"Bubba"</span>, inArray: strings)</span><br><span class="line"><span class="comment">// returns false</span></span><br></pre></td></tr></table></figure><p>åœ¨åˆ›å»ºäº†ç”¨äºæŸ¥æ‰¾ <code>String</code> æ•°ç»„çš„ <code>existsManual</code> å‡½æ•°åã€‚å‡å¦‚æˆ‘å†³å®šæƒ³è¦ä¸€äº›ç±»ä¼¼çš„å‡½æ•°ç”¨äºæœç´¢ <code>Integer</code>ï¼Œ<code>Float</code>ï¼Œå’Œ  <code>Double</code> æ•°ç»„ â€” ç”šè‡³ç”¨äºæŸ¥æ‰¾æ•°ç»„ä¸­è‡ªå®šä¹‰ç±»å‘¢ï¼Ÿæˆ‘æœ€ç»ˆèŠ±è´¹äº†å®è´µçš„æ—¶é—´å†™äº†å¾ˆå¤šåšåŒæ ·äº‹æƒ…çš„å‡½æ•°ã€‚æˆ‘éœ€è¦å†™å¾ˆå¤šä»£ç æ¥å®ç°ã€‚å¦‚æœæˆ‘å‘ç°äº†ä¸€ä¸ªæ–°çš„/æ›´å¿«çš„æœç´¢ç®—æ³•å‘¢ï¼Ÿåˆå¦‚æœåœ¨æˆ‘çš„æœç´¢ç®—æ³•æœ‰ä¸€ä¸ª bug å‘¢ï¼Ÿæˆ‘ä¸å¾—ä¸æ”¹å˜æˆ‘æ‰€æœ‰çš„æŸ¥æ‰¾æ–¹æ³•çš„ç‰ˆæœ¬ã€‚æˆ‘å‘ç°è¿™ç®€ç›´æ˜¯ä¸ªå¤ç”¨åœ°ç‹±ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">existsManual</span><span class="params">(item:String, inArray:[String])</span></span> -&gt; <span class="type">Bool</span></span><br><span class="line">...</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">existsManual</span><span class="params">(item:Int, inArray:[Int])</span></span> -&gt; <span class="type">Bool</span></span><br><span class="line">...</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">existsManual</span><span class="params">(item:Float, inArray:[Float])</span></span> -&gt; <span class="type">Bool</span></span><br><span class="line">...</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">existsManual</span><span class="params">(item:Double, inArray:[Double])</span></span> -&gt; <span class="type">Bool</span></span><br><span class="line">...</span><br><span class="line"><span class="comment">//  "Person"  is a custom class we'll create</span></span><br><span class="line"><span class="comment">//  "Person" æ˜¯æˆ‘ä»¬å°†è¦åˆ›å»ºçš„è‡ªå®šä¹‰çš„ç±»</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">existsManual</span><span class="params">(item:Person, inArray:[Person])</span></span> -&gt; <span class="type">Bool</span></span><br></pre></td></tr></table></figure><h2 id="é—®é¢˜"><a href="#é—®é¢˜" class="headerlink" title="é—®é¢˜"></a>é—®é¢˜</h2><p>æˆ‘ä»¬å·²ç»åŒçƒ¦äº†æ´»åœ¨ä¸€ä¸ªå¤„ç†ç±»å‹çš„ä¸–ç•Œé‡Œï¼Œä¸å¾—ä¸ä¸ºæ¯ä¸ªæˆ‘ä»¬æƒ³è¦æŸ¥æ‰¾çš„æ•°ç»„ç±»å‹åˆ›å»ºæ–°çš„æ–¹æ³•ã€‚ç»ˆç©¶è¿™ç»™æˆ‘ä»¬å¸¦æ¥äº†å¤§é‡çš„æŠ€æœ¯è´Ÿå€ºã€‚ç”±äºç°ä»£è½¯ä»¶éš¾ä»¥ç½®ä¿¡çš„å¤æ‚æ€§ï¼Œåƒä½ æˆ‘è¿™æ ·çš„å¼€å‘è€…éœ€è¦ä½¿ç”¨æ›´å¥½åœ°å®è·µï¼Œæ›´å¥½çš„æŠ€æœ¯ï¼Œæ›´å¥½çš„æ–¹æ³•ï¼Œç”¨æˆ‘ä»¬çš„ç¥ç»å…ƒæœ€å¤§ç¨‹åº¦çš„æ§åˆ¶è¿™ç§æ··ä¹±ã€‚æ®ä¼°è®¡ Window 7 åŒ…å«å¤§çº¦ 4 åƒä¸‡è¡Œä»£ç è€Œ macOS 10.4 (Tiger) åŒ…å«å¤§çº¦ 8.5 åƒä¸‡è¡Œä»£ç ï¼Œé¢„ä¼°åƒè¿™æ ·çš„ç³»ç»Ÿæ½œåœ¨è¡Œä¸ºæ¬¡æ•°éƒ½æ˜¯ä¸å¯èƒ½çš„ã€‚</p><h2 id="æ³›å‹çš„è§£å†³ä¹‹é“"><a href="#æ³›å‹çš„è§£å†³ä¹‹é“" class="headerlink" title="æ³›å‹çš„è§£å†³ä¹‹é“"></a>æ³›å‹çš„è§£å†³ä¹‹é“</h2><p>ï¼ˆå†æ¬¡ç´§è®°å­¦ä¹ æ³›å‹çš„ç›®çš„ï¼Œæˆ‘ä»¬ä¾æ—§å‡è®¾ Swift çš„æ•°ç»„ç±»å‹çš„å†…ç½®çš„å‡½æ•°ï¼Œ<code>index</code> å’Œ  <code>contains</code> ï¼Œä¸å­˜åœ¨ã€‚ï¼‰</p><p>è®©æˆ‘ä»¬å…ˆå°è¯•å†™è¿™æ ·ä¸€ä¸ª Swift å‡½æ•°ï¼Œåˆ¤æ–­ Swift çš„æ ‡å‡†ç±»å‹ï¼ˆä¾‹å¦‚ <code>String</code>ï¼Œ<code>Integer</code>ï¼Œ<code>Float</code> æˆ– <code>Double</code>ï¼‰çš„ä¸€ä¸ªç‰¹å®šå®ä¾‹æ˜¯å¦å­˜åœ¨äºè¿™ä¸ª Swift æ ‡å‡†ç±»å‹çš„æ•°ç»„ä¸­ã€‚æ€ä¹ˆåšå‘¢ï¼Ÿ</p><p>è®©æˆ‘ä»¬åˆ‡æ¢åˆ° Swift æ³›å‹ï¼Œç‰¹åˆ«æ˜¯æ³›å‹å‡½æ•°ï¼Œç±»å‹å‚æ•°ï¼Œç±»å‹çº¦æŸä»¥åŠ <code>Equatable</code> åè®®ã€‚åœ¨æ²¡æœ‰å®šä¹‰ä»»ä½•æœ¯è¯­å‰ï¼Œæˆ‘å†™äº†ä¸€äº›ä»£ç ï¼Œæ€è€ƒä¸€ä¸‹ä½ çœ‹åˆ°çš„ã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">exists</span>&lt;T: Equatable&gt;<span class="params">(item: T, inArray: [T])</span></span> -&gt; <span class="type">Bool</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">var</span> index:<span class="type">Int</span> = <span class="number">0</span></span><br><span class="line">    <span class="keyword">var</span> found = <span class="literal">false</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">while</span> (index &lt; inArray.<span class="built_in">count</span> &amp;&amp; found == <span class="literal">false</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> item == inArray[index]</span><br><span class="line">        &#123;</span><br><span class="line">            found = <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            index = index + <span class="number">1</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> found</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è®©æˆ‘ä»¬æµ‹è¯•ä¸‹æˆ‘æ–°å†™çš„æ³›å‹æ–¹æ³•</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> myFriends:[<span class="type">String</span>] = [<span class="string">"John"</span>, <span class="string">"Dave"</span>, <span class="string">"Jim"</span>]</span><br><span class="line"> </span><br><span class="line"><span class="keyword">let</span> isOneOfMyFriends = exists(item: <span class="string">"Dave"</span>, inArray: myFriends)</span><br><span class="line"><span class="comment">// returns true</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">let</span> isOneOfMyFriends1 = exists(item: <span class="string">"Laura"</span>, inArray: myFriends)</span><br><span class="line"><span class="comment">// returns false</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">let</span> myNumbers:[<span class="type">Int</span>] = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>]</span><br><span class="line"> </span><br><span class="line"><span class="keyword">let</span> isOneOfMyNumbers = exists(item: <span class="number">3</span>, inArray: myNumbers)</span><br><span class="line"><span class="comment">// returns true</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">let</span> isOneOfMyNumbers1 = exists(item: <span class="number">0</span>, inArray: myNumbers)</span><br><span class="line"><span class="comment">// returns false</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">let</span> myNumbersFloat:[<span class="type">Float</span>] = [<span class="number">1.0</span>,<span class="number">2.0</span>,<span class="number">3.0</span>,<span class="number">4.0</span>,<span class="number">5.0</span>,<span class="number">6.0</span>,]</span><br><span class="line"> </span><br><span class="line"><span class="keyword">let</span> isOneOfMyFloatNumbers = exists(item: <span class="number">3.0000</span>, inArray: myNumbersFloat)</span><br><span class="line"><span class="comment">// returns true</span></span><br></pre></td></tr></table></figure><p>æˆ‘æ–°å†™ exists æ–¹æ³•æ˜¯ä¸€ä¸ªæ³›å‹å‡½æ•°ï¼Œè¿™ä¸ªæ–¹æ³•â€œèƒ½æ­£å¸¸å·¥ä½œåœ¨ä»»ä½•å‚æ•°ç±»å‹ä¸Šâ€ï¼Œæ­¤å¤–ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹å®ƒçš„å‡½æ•°ç­¾åã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">exists</span>&lt;T: Equatable &gt;<span class="params">(item: T, inArray: [T])</span></span> -&gt; <span class="type">Bool</span></span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬çœ‹åˆ° <strong><a href="https://docs.Swift.org/Swift-book/LanguageGuide/Generics.html" target="_blank" rel="noopener">é‚£ä¸ª</a></strong> å‡½æ•°ä½¿ç”¨ä¸€ä¸ªå ä½ç¬¦ç±»å‹åå­—(åå« <code>T</code>, åœ¨è¿™ä¸ªæ¡ˆä¾‹)è€Œä¸æ˜¯çœŸæ­£çš„ç±»å‹åï¼ˆæ¯”å¦‚ï¼š<code>Int</code>ï¼Œ<code>Stirng</code>ï¼Œæˆ– <code>Double</code>ï¼‰å ä½ç¬¦ç±»å‹åæ²¡æœ‰æŒ‡å®š <code>T</code> å¿…é¡»æ˜¯ä»€ä¹ˆï¼Œä½†ä»–è¯´æ˜äº† <code>[item]</code> å’Œ <code>[inArray]</code> å¿…é¡»æ˜¯ç›¸åŒçš„ç±»å‹ <code>T</code> æ— è®º <code>T</code> ä»£è¡¨ä»€ä¹ˆï¼Œæ¯å½“ [<code>exists(_:_:)</code>] å‡½æ•°è¢«è°ƒç”¨æ—¶ï¼ŒçœŸå®çš„ç±»å‹ç”¨äºæ›¿ä»£ <code>T</code> è¢«ç¡®å®šä¸‹æ¥ã€‚</p><p><strong>è¿™ä¸ª exists å‡½æ•°ä¸­çš„å ä½ç¬¦ç±»å‹ <code>T</code> è¢«ç§°ä¸ºç±»å‹å‚æ•°</strong>ï¼š</p><blockquote><p><a href="https://developer.apple.com/library/content/documentation/Swift/Conceptual/SwiftProgrammingLanguage/Generics.html" target="_blank" rel="noopener">å®ƒ</a>æŒ‡å®šå’Œå‘½åäº†å ä½ç¬¦çš„ç±»å‹ï¼Œç›´æ¥å†™åœ¨å‡½æ•°åç§°çš„åé¢ï¼Œåœ¨ä¸€å¯¹å°–æ‹¬å·ä¹‹é—´(æ¯”å¦‚ <t>)ã€‚</t></p><p>ä¸€æ—¦ä½ æŒ‡å®šä¸€ä¸ªç±»å‹å‚æ•°ä½ å¯ä»¥ç”¨å®ƒæ¥å®šä¹‰å‡½æ•°å‚æ•°çš„ç±»å‹(æ¯”å¦‚ï¼š[<code>item</code>] and [<code>inArray</code>] [<code>exists(_:_:)</code> å‡½æ•°)æˆ–è€…ä½œä¸ºå‡½æ•°è¿”å›å€¼çš„ç±»å‹ï¼Œåœ¨ä»»ä½•æ¡ä»¶ä¸‹ï¼Œå½“å‡½æ•°è¢«è°ƒç”¨çš„æ—¶å€™ç±»å‹å‚æ•°ä¼šè¢«çœŸå®ç±»å‹æ›¿ä»£ã€‚</p></blockquote><p>ä¸ºäº†å¼ºåŒ–æˆ‘ä»¬ç›®å‰å·²ç»å­¦åˆ°çš„ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ª Swift å‡½æ•°ï¼Œè¯¥å‡½æ•°èƒ½å¤Ÿæ‰¾åˆ°å­˜å‚¨åœ¨æ•°ç»„ä¸­ä»»ä½•ç±»å‹å®ä¾‹çš„ç´¢å¼•ã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">find</span>&lt;T: Equatable&gt;<span class="params">(item: T, inArray: [T])</span></span> -&gt; <span class="type">Int</span>?</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">var</span> index:<span class="type">Int</span> = <span class="number">0</span></span><br><span class="line">    <span class="keyword">var</span> found = <span class="literal">false</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">while</span> (index &lt; inArray.<span class="built_in">count</span> &amp;&amp; found == <span class="literal">false</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> item == inArray[index]</span><br><span class="line">        &#123;</span><br><span class="line">            found = <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            index = index + <span class="number">1</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> found</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> index</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è®©æˆ‘ä»¬æµ‹è¯•ä¸‹å®ƒ</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> myFriends:[<span class="type">String</span>] = [<span class="string">"John"</span>, <span class="string">"Dave"</span>, <span class="string">"Jim"</span>, <span class="string">"Arthur"</span>, <span class="string">"Lancelot"</span>]</span><br><span class="line"> </span><br><span class="line"><span class="keyword">let</span> findIndexOfFriend = <span class="built_in">find</span>(item: <span class="string">"John"</span>, inArray: myFriends)</span><br><span class="line"><span class="comment">// returns 0</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">let</span> findIndexOfFriend1 = <span class="built_in">find</span>(item: <span class="string">"Arthur"</span>, inArray: myFriends)</span><br><span class="line"><span class="comment">// returns 3</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">let</span> findIndexOfFriend2 = <span class="built_in">find</span>(item: <span class="string">"Guinevere"</span>, inArray: myFriends)</span><br><span class="line"><span class="comment">// returns nil</span></span><br></pre></td></tr></table></figure><h2 id="å…³äº-Equatable-åè®®"><a href="#å…³äº-Equatable-åè®®" class="headerlink" title="å…³äº Equatable åè®®"></a>å…³äº <code>Equatable</code> åè®®</h2><p>exists å‡½æ•°ä¸­ <code>&lt;T: Equatable &gt;</code> æ ‡æ³¨æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿå®ƒå«åšç±»å‹çº¦æŸï¼Œå®ƒè§„å®šäº†â€é‚£ä¸ªç±»å‹å‚æ•°å¿…é¡»ç»§æ‰¿è‡ªä¸€ä¸ªå…·ä½“çš„ç±»ï¼Œæˆ–è€…éµå®ˆä¸€ä¸ªç‰¹å®šçš„åè®®æˆ–æ˜¯åè®®ç»„åˆã€‚æˆ‘æŒ‡å®šäº† exists å‡½æ•°å‚æ•°ï¼Œ<code>item: T</code> å’Œ <code>inArray: [T]</code>, å¿…é¡»æ˜¯ç±»å‹ <code>T</code>, è€Œç±»å‹ <code>T</code> å¿…é¡»éµå®ˆåè®® <code>Equatable</code> åè®®ï¼Œä¸ºä»€ä¹ˆæ˜¯è¿™æ ·çš„å‘¢?</p><p>æ‰€æœ‰çš„ Swift å†…ç½®ç±»å‹å·²ç»è¢«æ„å»ºæ”¯æŒ <code>Equatable</code> åè®®ã€‚æ¥è‡ª <a href="https://developer.apple.com/documentation/ Swift / Equatable" target="_blank" rel="noopener">Apple docs</a>:  â€œéµå®ˆ <code>Equatable</code> åè®®çš„ç±»å‹è¿›è¡Œç›¸ç­‰æ¯”è¾ƒï¼Œä½¿ç”¨ç­‰äºè¿ç®—ç¬¦(<code>==</code>)åˆ¤æ–­ç›¸ç­‰ï¼Œæˆ–è€…ä½¿ç”¨ä¸ç­‰è¿ç®—ç¬¦(<code>!=</code>)åˆ¤æ–­ä¸ç­‰â€ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘çš„æ³›å‹å‡½æ•° â€œexistsâ€ èƒ½å¤Ÿåœ¨ Swift çš„ç±»å‹ï¼ˆå¦‚ <code>String</code>ï¼Œ<code>Integer</code>ï¼Œ<code>Float</code> å’Œ <code>Double</code>ï¼‰ä¸Šæ­£å¸¸å·¥ä½œã€‚æ‰€æœ‰è¿™äº›ç±»å‹éƒ½å®šä¹‰äº† <code>==</code> å’Œ <code>!=</code> è¿ç®—ç¬¦ã€‚ </p><h2 id="è‡ªå®šä¹‰ç±»å‹å’Œæ³›å‹"><a href="#è‡ªå®šä¹‰ç±»å‹å’Œæ³›å‹" class="headerlink" title="è‡ªå®šä¹‰ç±»å‹å’Œæ³›å‹"></a>è‡ªå®šä¹‰ç±»å‹å’Œæ³›å‹</h2><p>å‡å¦‚æˆ‘å£°æ˜äº†ä¸€ä¸ªæ–°çš„ç±»å«åš â€œBasicPersonâ€ å¦‚ä¸‹æ‰€ç¤ºã€‚æˆ‘èƒ½ç”¨æˆ‘çš„ existsâ€ å‡½æ•°æ¥æ‰¾å‡ºåœ¨æ•°ç»„ä¸­æ˜¯å¦æœ‰ â€œBasicPersonâ€ ç±»çš„ä¸€ä¸ªå®ä¾‹çš„ç±»å‹ä¹ˆï¼Ÿä¸è¡Œï¼ä¸ºä»€ä¹ˆä¸è¡Œï¼Ÿçœ‹çœ‹ä¸‹é¢è¿™ä¸ªä»£ç ï¼Œæˆ‘ä»¬æ¥ä¸‹æ¥è®¨è®ºå®ƒï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BasicPerson</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">var</span> name: <span class="type">String</span></span><br><span class="line">    <span class="keyword">var</span> weight: <span class="type">Int</span></span><br><span class="line">    <span class="keyword">var</span> sex: <span class="type">String</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">init</span>(weight: <span class="type">Int</span>, name: <span class="type">String</span>, sex: <span class="type">String</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">self</span>.name = name</span><br><span class="line">        <span class="keyword">self</span>.weight = weight</span><br><span class="line">        <span class="keyword">self</span>.sex = sex</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">let</span> <span class="type">Jim</span> = <span class="type">BasicPerson</span>(weight: <span class="number">180</span>, name: <span class="string">"Jim Patterson"</span>, sex: <span class="string">"M"</span>)</span><br><span class="line"><span class="keyword">let</span> <span class="type">Sam</span> = <span class="type">BasicPerson</span>(weight: <span class="number">120</span>, name: <span class="string">"Sam Patterson"</span>, sex: <span class="string">"F"</span>)</span><br><span class="line"><span class="keyword">let</span> <span class="type">Sara</span> = <span class="type">BasicPerson</span>(weight: <span class="number">115</span>, name: <span class="string">"Sara Lewis"</span>, sex: <span class="string">"F"</span>)</span><br><span class="line"> </span><br><span class="line"><span class="keyword">let</span> basicPersons = [<span class="type">Jim</span>, <span class="type">Sam</span>, <span class="type">Sara</span>]</span><br><span class="line"> </span><br><span class="line"><span class="keyword">let</span> isSamABasicPerson = exists(item: <span class="type">Sam</span>, inArray: basicPersons)</span><br></pre></td></tr></table></figure><p>çœ‹åˆ°æœ€åä¸€è¡Œï¼Œå› ä¸ºå®ƒæœ‰ä¸€ä¸ªç¼–è¯‘é”™è¯¯ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">error: <span class="keyword">in</span> argument type '[<span class="type">BasicPerson</span>]', '<span class="type">BasicPerson'</span> does not conform to expected type '<span class="type">Equatable'</span></span><br><span class="line"><span class="keyword">let</span> isSamABasicPerson = exists(item: <span class="type">Sam</span>, inArray: basicPersons)</span><br></pre></td></tr></table></figure><p><img src="/img/articles/swift-generics/68747470733a2f2f617070636f64612e636f6d2f77702d636f6e74656e742f75706c6f6164732f323031382f30322f73776966742d342d67656e65726963732d312e706e671535431541.3460808" alt=""></p><p>è¿™å¾ˆç³Ÿç³•äº†ï¼Œ åœ¨ â€œBasicPersonâ€ ç±»å‹çš„æ•°ç»„é‡Œé¢ï¼Œä½ ä¸èƒ½ä½¿ç”¨ Swift æ•°ç»„çš„å†…å»ºå‡½æ•° <code>index</code> å’Œ <code>contains</code>ã€‚(ä½ å¿…é¡»å®šä¹‰ä¸€ä¸ªé—­åŒ…ï¼Œæ¯å½“ä½ æƒ³ä½¿ç”¨é‚£ä¸¤ä¸ªæ–¹æ³• blah,blah,blahâ€¦ è¿™ä¸ªæˆ‘å°±ä¸æäº†ã€‚)</p><p>å†æ¬¡å›åˆ°é—®é¢˜ï¼Œä¸ºä»€ä¹ˆæŠ¥é”™ï¼Ÿ</p><p>å› ä¸º â€œBasicPersonâ€ ç±»æ²¡æœ‰éµå®ˆ <code>Equeatable</code> åè®®(è¿™æ˜¯ä¸€ä¸ªæç¤ºï¼Œè¯·çœ‹ä¸‹æ–‡å’¯)</p><h2 id="éµå®ˆ-Equatable-åè®®"><a href="#éµå®ˆ-Equatable-åè®®" class="headerlink" title="éµå®ˆ Equatable åè®®"></a>éµå®ˆ <code>Equatable</code> åè®®</h2><p>ä¸ºäº†å…è®¸æˆ‘çš„ â€œBasicPersonâ€ ç±»æ˜¯å¯ä»¥ä½¿ç”¨æˆ‘çš„ â€œexistsâ€ å’Œ â€œfindâ€ æ³›å‹æ–¹æ³•ï¼Œæ‰€æœ‰æˆ‘éœ€è¦åšçš„æ˜¯ï¼š</p><ul><li>è®©ç±»éµå®ˆ <code>Equatable</code> åè®®</li><li>é‡è½½ç±»å®ä¾‹çš„ <code>==</code> æ“ä½œç¬¦</li></ul><p>æ³¨æ„<a href="https://developer.apple.com/documentation/ Swift / Equatable" target="_blank" rel="noopener">è¿™ä¸ª</a>â€œSwift æ ‡å‡†åº“ä¸ºæ‰€æœ‰éµå¾ª <code>Euqatable</code> åè®®çš„ç±»å‹æä¾›äº†ä¸ç­‰äº(!=) æ“ä½œç¬¦çš„å®ç°ã€‚é€šè¿‡è°ƒç”¨è‡ªå®šä¹‰çš„ <code>==</code> å‡½æ•°è·å–å®ƒçš„å–åç»“æœã€‚</p><p>å¦‚æœä½ å¯¹æ“ä½œç¬¦é‡è½½ä¸ç†Ÿæ‚‰ï¼Œæˆ‘å»ºè®®ä½ é˜…è¯»è¿™äº›ä¸»é¢˜ï¼Œé“¾æ¥åœ¨<a href="https://developer.apple.com/library/content/documentation/Swift/Conceptual/SwiftProgrammingLanguage/AdvancedOperators.html" target="_blank" rel="noopener">è¿™é‡Œ</a>å’Œ<a href="https://www.appcoda.com/operator-overloading-Swift" target="_blank" rel="noopener">è¿™é‡Œçš„</a>.ç›¸ä¿¡æˆ‘ï¼Œä½ ä¼šæƒ³çŸ¥é“æ“ä½œç¬¦é‡è½½çš„ã€‚</p><blockquote><p>æç¤ºï¼šæˆ‘é‡å‘½å â€œBasicPersonâ€ ç±»ä¸º â€œPersonâ€ è®©ä»–ä»¬åœ¨ç›¸åŒçš„ Swift Playground æ–‡ä»¶èƒ½å…±å­˜ï¼Œæ¥ç€æˆ‘ä»¬æ¥åˆ° â€œPersonâ€ ç±»ã€‚</p></blockquote><p>æˆ‘å°†å®ç° <code>==</code> æ“ä½œç¬¦ï¼Œæ‰€ä»¥å®ƒèƒ½æ¯”è¾ƒ â€œPersonâ€ ç±»ä¸åŒå®ä¾‹é—´çš„ â€œnameâ€, â€œweightâ€, å’Œ â€œsexâ€ å±æ€§ã€‚å¦‚æœä¸¤ä¸ª â€œPersonâ€ ç±»çš„å®ä¾‹æœ‰ç›¸åŒçš„çš„ä¸‰ä¸ªå±æ€§ã€‚åˆ™ä»–ä»¬æ˜¯ç›¸ç­‰çš„ã€‚å¦‚æœæœ‰ä¸€ä¸ªå±æ€§ä¸åŒï¼Œåˆ™ä»–ä»¬æ˜¯ä¸ç›¸ç­‰çš„(!=)ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘çš„ â€œPersonâ€ ç±»éµå®ˆäº† <code>Equatable</code> åè®®ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">lass <span class="type">Person</span>: <span class="type">Equatable</span> </span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">var</span> name:<span class="type">String</span></span><br><span class="line">    <span class="keyword">var</span> weight:<span class="type">Int</span></span><br><span class="line">    <span class="keyword">var</span> sex:<span class="type">String</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">init</span>(weight: <span class="type">Int</span>, name: <span class="type">String</span>, sex: <span class="type">String</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">self</span>.name = name</span><br><span class="line">        <span class="keyword">self</span>.weight = weight</span><br><span class="line">        <span class="keyword">self</span>.sex = sex</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> == <span class="params">(lhs: Person, rhs: Person)</span></span> -&gt; <span class="type">Bool</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> lhs.weight == rhs.weight &amp;&amp;</span><br><span class="line">            lhs.name == rhs.name &amp;&amp;</span><br><span class="line">            lhs.sex == rhs.sex</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨æ„ä¸Šé¢çš„ <code>==</code> é‡è½½æ–¹æ³•ï¼Œè¿™éœ€è¦è®© â€œPersonâ€ éµå®ˆ <code>Equatable</code> åè®®ã€‚æ³¨æ„ <code>==</code> é‡è½½æ–¹æ³•ä¸­çš„ <code>lhs</code> å’Œ <code>rhs</code> å‚æ•°ã€‚è¿™æ˜¯é€šç”¨çš„ï¼Œå½“é‡è½½æ“ä½œç¬¦æ—¶ï¼Œä»£ç ä¸­ç­‰å·ä¸¤è¾¹çš„å¯¹è±¡åº”è¯¥ä¸å‚æ•°ä¸­çš„ç‰©ç†ä½ç½®ä¸€è‡´ï¼Œå¦‚ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">lhs == rhs</span><br><span class="line"><span class="keyword">left</span>-hand side == <span class="keyword">right</span>-hand side</span><br></pre></td></tr></table></figure><h2 id="å®ƒå®ç”¨å—ï¼Ÿ"><a href="#å®ƒå®ç”¨å—ï¼Ÿ" class="headerlink" title="å®ƒå®ç”¨å—ï¼Ÿ"></a>å®ƒå®ç”¨å—ï¼Ÿ</h2><p>å¦‚æœä½ è·Ÿéšç€æˆ‘çš„æŒ‡å—ï¼Œä½ èƒ½åˆ›å»ºåƒæˆ‘å†™çš„ â€œexistsâ€ å’Œ â€œfindâ€ æ³›å‹å‡½æ•°ç”¨äºä»»ä½•ä½ åˆ›å»ºçš„æ–°ç±»å‹ï¼Œå¦‚ç±»æˆ–è€…ç»“æ„ä½“ã€‚è®©ä½ è‡ªå®šä¹‰çš„ç±»å’Œç»“æ„ä½“é›†åˆç±»å‹éµå®ˆ <code>Equatable</code> åè®®ï¼Œåƒ Swift é‡Œé¢ <code>Array</code> ä¸­çš„å†…ç½®å‡½æ•° <code>index</code> å’Œ <code>contains</code>ã€‚ä»–ä»¬ç¡®å®æœ‰ç”¨ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="type">Joe</span> = <span class="type">Person</span>(weight: <span class="number">180</span>, name: <span class="string">"Joe Patterson"</span>, sex: <span class="string">"M"</span>)</span><br><span class="line"><span class="keyword">let</span> <span class="type">Pam</span> = <span class="type">Person</span>(weight: <span class="number">120</span>, name: <span class="string">"Pam Patterson"</span>, sex: <span class="string">"F"</span>)</span><br><span class="line"><span class="keyword">let</span> <span class="type">Sue</span> = <span class="type">Person</span>(weight: <span class="number">115</span>, name: <span class="string">"Sue Lewis"</span>, sex: <span class="string">"F"</span>)</span><br><span class="line"><span class="keyword">let</span> <span class="type">Jeb</span> = <span class="type">Person</span>(weight: <span class="number">180</span>, name: <span class="string">"Jeb Patterson"</span>, sex: <span class="string">"M"</span>)</span><br><span class="line"><span class="keyword">let</span> <span class="type">Bob</span> = <span class="type">Person</span>(weight: <span class="number">200</span>, name: <span class="string">"Bob Smith"</span>, sex: <span class="string">"M"</span>)</span><br><span class="line"> </span><br><span class="line"><span class="keyword">let</span> myPeople:<span class="type">Array</span> = [<span class="type">Joe</span>, <span class="type">Pam</span>, <span class="type">Sue</span>, <span class="type">Jeb</span>]</span><br><span class="line"> </span><br><span class="line"><span class="keyword">let</span> indexOfOneOfMyPeople = <span class="built_in">find</span>(item: <span class="type">Jeb</span>, inArray: myPeople)</span><br><span class="line"><span class="comment">// returns 3 from custom generic function</span></span><br><span class="line"><span class="comment">// è¿”å› 3 æºè‡ªè‡ªå®šä¹‰æ³›å‹å‡½æ•°</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">let</span> indexOfOneOfMyPeople1 = myPeople.index(of: <span class="type">Jeb</span>)</span><br><span class="line"><span class="comment">// returns 3 from built-in Swift member function</span></span><br><span class="line"><span class="comment">// è¿”å› 3 æºè‡ª Swift å†…å»ºæˆå‘˜å‡½æ•°</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">let</span> isSueOneOfMyPeople = exists(item: <span class="type">Sue</span>, inArray: myPeople)</span><br><span class="line"><span class="comment">// returns true from custom generic function</span></span><br><span class="line"><span class="comment">// è¿”å› true æºè‡ªè‡ªå®šä¹‰æ³›å‹å‡½æ•°</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">let</span> isSueOneOfMyPeople1 = myPeople.<span class="built_in">contains</span>(<span class="type">Sue</span>)</span><br><span class="line"><span class="comment">// returns true from built-in Swift member function</span></span><br><span class="line"><span class="comment">// è¿”å› true æºè‡ª Swift å†…å»ºæˆå‘˜å‡½æ•°</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">let</span> indexOfBob = <span class="built_in">find</span>(item: <span class="type">Bob</span>, inArray: myPeople)</span><br><span class="line"><span class="comment">// returns nil from custom generic function</span></span><br><span class="line"><span class="comment">// è¿”å› nil æºè‡ªè‡ªå®šä¹‰æ³›å‹å‡½æ•°</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">let</span> indexOfBob1 = myPeople.index(of: <span class="type">Bob</span>)</span><br><span class="line"><span class="comment">// returns nil from built-in Swift member function</span></span><br><span class="line"><span class="comment">// è¿”å› nil æºè‡ª Swift å†…å»ºæˆå‘˜å‡½æ•°</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">let</span> isBobOneOfMyPeople1 = exists(item: <span class="type">Bob</span>, inArray: myPeople)</span><br><span class="line"><span class="comment">// returns false from custom generic function</span></span><br><span class="line"><span class="comment">// è¿”å› false æºè‡ªè‡ªå®šä¹‰æ³›å‹å‡½æ•°</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">let</span> isBobOneOfMyPeople2 = myPeople.<span class="built_in">contains</span>(<span class="type">Bob</span>)</span><br><span class="line"><span class="comment">// returns false from built-in Swift member function</span></span><br><span class="line"><span class="comment">// è¿”å› false æºè‡ª Swift å†…å»ºæˆå‘˜å‡½æ•°</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> <span class="type">Joe</span> == <span class="type">Pam</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"they're equal"</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"they're not equal"</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// returns "they're not equal"</span></span><br></pre></td></tr></table></figure><h2 id="æ‰©å±•é˜…è¯»"><a href="#æ‰©å±•é˜…è¯»" class="headerlink" title="æ‰©å±•é˜…è¯»"></a>æ‰©å±•é˜…è¯»</h2><p>è‹¹æœæç¤ºå…³äº <code>Equatable</code> åè®®çš„æ›´å¤šå¥½å¤„ï¼š</p><blockquote><p>Adding  Equatable  conformance to your custom types means that you can use more convenient APIs when searching for particular instances in a collection.  Equatable  is also the base protocol for the Hashable and Comparable protocols, which allow more uses of your custom type, such as constructing sets or sorting the elements of a collection.</p></blockquote><blockquote><p>è®©ä½ çš„è‡ªå®šä¹‰ç±»å‹éµå¾ª Equatable åè®®æ„å‘³ç€ä½ å¯ä»¥ä½¿ç”¨è®¸å¤šç³»ç»Ÿæä¾›çš„ API æ¥è®©ä½ åœ¨ä¸€ä¸ªé›†åˆé‡Œé¢æŸ¥æ‰¾ç‰¹å®šä¸€ä¸ªå®ä¾‹å˜å¾—æ›´åŠ æ–¹ä¾¿ã€‚</p><p>Equatable åè®®ä¹Ÿæ˜¯ Hashable åè®®å’Œ Comparable åè®®çš„åŸºç¡€åè®®ã€‚è¿™å…è®¸ä½ ä½¿ç”¨æ›´å¤šçš„è‡ªå®šä¹‰ç±»å‹ï¼Œæ¯”å¦‚æ„å»ºé›†åˆæˆ–è€…æ’åºé›†åˆä¸­çš„å…ƒç´ ã€‚</p></blockquote><p>æ¯”å¦‚ï¼Œå¦‚æœä½ éµå®ˆäº† <code>comparable</code> åè®®ï¼Œä½ èƒ½é‡è½½å’Œä½¿ç”¨ <code>&lt;</code>ï¼Œ<code>&gt;</code>ï¼Œ<code>&lt;=</code> å’Œ <code>&gt;=</code> æ“ä½œç¬¦ï¼Œè¿™çœŸçš„å¾ˆ Coolã€‚</p><h2 id="é¡»çŸ¥"><a href="#é¡»çŸ¥" class="headerlink" title="é¡»çŸ¥"></a>é¡»çŸ¥</h2><p>æƒ³ä¸€ä¸‹æˆ‘ä»¬çš„ â€œPersonâ€ ç±»ï¼Œå‡å¦‚æˆ‘ä»¬æœ‰ä¸€äº›ç±»ä¼¼ä¸‹æ–‡æ‰€ç¤ºçš„å®ä¾‹ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="type">Joe</span> = <span class="type">Person</span>(weight: <span class="number">180</span>, name: <span class="string">"Joe Patterson"</span>, sex: <span class="string">"M"</span>)</span><br><span class="line"><span class="keyword">let</span> <span class="type">Pam</span> = <span class="type">Person</span>(weight: <span class="number">120</span>, name: <span class="string">"Pam Patterson"</span>, sex: <span class="string">"F"</span>)</span><br><span class="line"><span class="keyword">let</span> <span class="type">Sue</span> = <span class="type">Person</span>(weight: <span class="number">115</span>, name: <span class="string">"Sue Lewis"</span>, sex: <span class="string">"F"</span>)</span><br><span class="line"><span class="keyword">let</span> <span class="type">Jeb</span> = <span class="type">Person</span>(weight: <span class="number">180</span>, name: <span class="string">"Jeb Patterson"</span>, sex: <span class="string">"M"</span>)</span><br><span class="line"><span class="keyword">let</span> <span class="type">Bob</span> = <span class="type">Person</span>(weight: <span class="number">200</span>, name: <span class="string">"Bob Smith"</span>, sex: <span class="string">"M"</span>)</span><br><span class="line"><span class="keyword">let</span> <span class="type">Jan</span> = <span class="type">Person</span>(weight: <span class="number">115</span>, name: <span class="string">"Sue Lewis"</span>, sex: <span class="string">"F"</span>)</span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> <span class="type">Jan</span> == <span class="type">Sue</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"they're equal"</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"they're not equal"</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// returns "they're equal" for 2 different objects</span></span><br><span class="line"><span class="comment">// è¿”å› "they're equal" å¯¹äºä¸¤ä¸ªä¸åŒçš„å¯¹è±¡</span></span><br></pre></td></tr></table></figure><p>çœ‹æœ€åä¸€è¡Œï¼Œå› ä¸ºè¿™äº› â€œPersonâ€ å¯¹è±¡ä¸­ â€œJanâ€ å’Œ â€œSueâ€ å¯¹è±¡æ˜¯ç»å¯¹ç›¸ç­‰çš„ã€‚å³ä½¿ä»–ä»¬æ˜¯ä¸¤ä¸ªä¸åŒçš„å®ä¾‹å¯¹è±¡ã€‚ä½ çš„è½¯ä»¶å¥½åä»…ä»…å–å†³äºä½ çš„è®¾è®¡ã€‚åœ¨æ•°æ®åº“çš„æœ¯è¯­ä½“ç³»é‡Œï¼Œ â€œPersonâ€ ç±»é›†åˆä¸­ï¼Œä½ ä¼šéœ€è¦ä¸€ä¸ªâ€ä¸»é”®â€ â€” æˆ–è®¸åœ¨ç±»çš„è®¾è®¡ä¸­ï¼Œå¯ä»¥æ·»åŠ ä¸€ä¸ªç´¢å¼•å˜é‡ã€‚æ¯”å¦‚ä¸€ä¸ªç¤¾ä¼šå®‰å…¨ç ã€æˆ–è€…ä½ ç†ŸçŸ¥çš„å…¶ä»–çš„å”¯ä¸€å€¼æ¥ä¿è¯ â€œPersonâ€ ç±»å®ä¾‹åœ¨é›†åˆ (<code>Array</code>) ä¸­çš„å”¯ä¸€æ€§ï¼Œå½“ç„¶å•¦ï¼Œä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ <code>===</code> æ“ä½œç¬¦ã€‚</p><p>äº«ç”¨å§ï¼</p><blockquote><p>æœ¬æ–‡ç”± SwiftGG ç¿»è¯‘ç»„ç¿»è¯‘ï¼Œå·²ç»è·å¾—ä½œè€…ç¿»è¯‘æˆæƒï¼Œæœ€æ–°æ–‡ç« è¯·è®¿é—® <a href="http://swift.gg">http://swift.gg</a>ã€‚</p></blockquote>]]></content>
    
    <summary type="html">
    
      æœ¬æ–‡è¯¦ç»†è®²è§£äº† Swift ä¸­çš„æ³›å‹æ˜¯ä»€ä¹ˆï¼Ÿ å¦‚ä½•ä½¿ç”¨æ³›å‹ï¼Ÿ
    
    </summary>
    
      <category term="AppCoda" scheme="https://swift.gg/categories/AppCoda/"/>
    
    
      <category term="Swift" scheme="https://swift.gg/tags/Swift/"/>
    
  </entry>
  
  <entry>
    <title>æ„å»ºç¬¬ä¸€ä¸ª Swift åŒºå—é“¾åº”ç”¨</title>
    <link href="https://swift.gg/2018/08/21/blockchain-introduction/"/>
    <id>https://swift.gg/2018/08/21/blockchain-introduction/</id>
    <published>2018-08-21T00:00:00.000Z</published>
    <updated>2019-02-18T08:52:03.568Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ä½œè€…ï¼šSai Kambampatiï¼Œ<a href="https://appcoda.com/blockchain-introduction/" target="_blank" rel="noopener">åŸæ–‡é“¾æ¥</a>ï¼ŒåŸæ–‡æ—¥æœŸï¼š2018-05-31<br>è¯‘è€…ï¼š<a href="http://daizi.me" target="_blank" rel="noopener">å°è¢‹å­</a>ï¼›æ ¡å¯¹ï¼š<a href="https://weibo.com/1743643682/profile?topnav=1&amp;wvr=6" target="_blank" rel="noopener">liberalism</a>ï¼Œ<a href="http://numbbbbb.com/" target="_blank" rel="noopener">numbbbbb</a>ï¼›å®šç¨¿ï¼š<a href="https://github.com/chenmingbiao" target="_blank" rel="noopener">CMB</a></p></blockquote><!--æ­¤å¤„å¼€å§‹æ­£æ–‡--><p>åŒºå—é“¾ä½œä¸ºä¸€é¡¹é©å‘½æ€§çš„æŠ€æœ¯ï¼Œå¼€å§‹å—åˆ°è¶Šæ¥è¶Šå¤šè¿½æ§ã€‚ä¸ºä»€ä¹ˆå‘¢ï¼Ÿå› ä¸ºåŒºå—é“¾æ˜¯è®¸å¤šåŠ å¯†æ•°å­—è´§å¸çš„åº•å±‚æŠ€æœ¯ï¼Œæ¯”å¦‚ï¼šæ¯”ç‰¹å¸ï¼ˆBTCï¼‰ï¼Œä»¥å¤ªåŠï¼ˆETHï¼‰ä»¥åŠè±ç‰¹å¸ï¼ˆLTCï¼‰ã€‚åŒºå—é“¾å…·ä½“æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿæœ¬ç¯‡æ•™ç¨‹ä¼šæ¶µç›–æ‰€æœ‰åŒºå—é“¾ç›¸å…³çš„çŸ¥è¯†ï¼Œè¿˜ä¼šæ•™ä½ å¦‚ä½•æ„å»º Swift åŒºå—é“¾ã€‚ä¸‹é¢è®©æˆ‘ä»¬å¼€å§‹å§ï¼</p><a id="more"></a><h3 id="åŒºå—é“¾çš„å·¥ä½œåŸç†"><a href="#åŒºå—é“¾çš„å·¥ä½œåŸç†" class="headerlink" title="åŒºå—é“¾çš„å·¥ä½œåŸç†"></a>åŒºå—é“¾çš„å·¥ä½œåŸç†</h3><p>é¡¾åæ€ä¹‰ï¼ŒåŒºå—é“¾æ˜¯ä¸€æ¡ç”±ä¸åŒåŒºå—è¿æ¥ç»„æˆçš„é“¾ã€‚æ¯ä¸€ä¸ªå—åŒ…å«ä¸‰ä¸ªä¿¡æ¯ï¼šæ•°æ®ã€å“ˆå¸Œï¼ˆhashï¼‰ã€ä»¥åŠå‰ç½®åŒºå—çš„å“ˆå¸Œã€‚</p><p><strong>1ã€æ•°æ®</strong> â€“ ç”±äºåº”ç”¨åœºæ™¯ä¸åŒï¼Œå­˜å‚¨åœ¨åŒºå—ä¸­çš„æ•°æ®ç”±åŒºå—é“¾çš„ç±»å‹å†³å®šã€‚ä¾‹å¦‚ï¼Œåœ¨æ¯”ç‰¹å¸åŒºå—é“¾ä¸­ï¼Œå­˜å‚¨çš„æ•°æ®æ˜¯äº¤æ˜“ä¿¡æ¯ï¼šè½¬è´¦é‡‘é¢å’Œäº¤æ˜“åŒæ–¹çš„ä¿¡æ¯ã€‚</p><p><strong>2ã€å“ˆå¸Œ</strong> â€“ ä½ å¯ä»¥å°†å“ˆå¸Œçœ‹åšæ•°å­—æŒ‡çº¹ï¼Œç”¨æ¥å”¯ä¸€æ ‡è¯†ä¸€ä¸ªåŒºå—åŠå…¶æ•°æ®ã€‚å“ˆå¸Œçš„é‡è¦ä¹‹å¤„åœ¨äºå®ƒæ˜¯ä¸€ä¸ªç‹¬ç‰¹çš„å­—æ¯æ•°å­—ä»£ç ï¼Œé€šå¸¸æ˜¯ 64 ä¸ªå­—ç¬¦ã€‚å½“ä¸€ä¸ªåŒºå—è¢«åˆ›å»ºæ—¶ï¼Œå“ˆå¸Œä¹Ÿéšä¹‹åˆ›å»ºã€‚å½“ä¸€ä¸ªåŒºå—è¢«ä¿®æ”¹ï¼Œå“ˆå¸Œä¹Ÿéšä¹‹ä¿®æ”¹ã€‚å› æ­¤ï¼Œå½“ä½ æƒ³è¦æŸ¥çœ‹åœ¨åŒºå—ä¸Šæ‰€åšçš„ä»»ä½•å˜æ›´æ—¶ï¼Œå“ˆå¸Œå°±æ˜¾å¾—éå¸¸é‡è¦ã€‚</p><p><strong>3ã€å‰ç½®åŒºå—çš„å“ˆå¸Œ</strong> â€“ é€šè¿‡å­˜å‚¨å‰ç½®åŒºå—çš„å“ˆå¸Œï¼Œä½ å¯ä»¥è¿˜åŸæ¯ä¸ªåŒºå—è¿æ¥æˆåŒºå—é“¾çš„è¿‡ç¨‹ï¼è¿™ä½¿å¾—åŒºå—é“¾å®‰å…¨æ€§ç‰¹åˆ«é«˜ã€‚</p><p>æˆ‘ä»¬æ¥çœ‹ä¸‹è¿™å¼ å›¾ç‰‡ï¼š</p><p><img src="https://appcoda.com/wp-content/uploads/2018/05/blockchain-explained.png" alt="åŒºå—é“¾"></p><p>ä½ å¯ä»¥çœ‹åˆ°ï¼Œæ¯ä¸€ä¸ªåŒºå—åŒ…å«æ•°æ®ï¼ˆå›¾ç‰‡ä¸­æ²¡æœ‰æŒ‡æ˜ï¼‰ã€å“ˆå¸Œä»¥åŠå‰ç½®åŒºå—çš„å“ˆå¸Œã€‚ä¾‹å¦‚ï¼Œé»„è‰²åŒºå—åŒ…å«è‡ªèº«çš„å“ˆå¸Œï¼šH7s6ï¼Œä»¥åŠçº¢è‰²åŒºå—çš„å“ˆå¸Œï¼š8SD9ã€‚è¿™æ ·å®ƒä»¬å°±æ„æˆäº†ä¸€æ¡ç›¸äº’è¿æ¥çš„é“¾ã€‚ç°åœ¨ï¼Œå‡å¦‚æœ‰ä¸€ä¸ªé»‘å®¢å‡†å¤‡æ¶æ„ç¯¡æ”¹çº¢è‰²çš„åŒºå—ã€‚è¯·è®°ä½ï¼Œæ¯å½“å—ä»¥ä»»ä½•æ–¹å¼è¢«ç¯¡æ”¹æ—¶ï¼Œè¯¥åŒºå—çš„å“ˆå¸Œéƒ½ä¼šæ”¹å˜ï¼å½“ä¸‹ä¸€ä¸ªåŒºå—æ£€æŸ¥å¹¶å‘ç°å‰ç½®å“ˆå¸Œä¸ä¸€è‡´æ—¶ï¼Œé»‘å®¢å°†æ— æ³•è®¿é—®å®ƒï¼Œå› ä¸ºä»–ä¸å‰ç½®åŒºå—çš„è”ç³»è¢«åˆ‡æ–­äº†ï¼ˆè¯‘è€…æ³¨ï¼šå³å¦‚æœé»‘å®¢æƒ³è¦è¦ç¯¡æ”¹ä¸€ä¸ªåŒºå—çš„è¯ï¼Œå°±éœ€è¦æŠŠè¿™ä¸ªåŒºå—åé¢çš„æ‰€æœ‰åŒºå—éƒ½è¦æ”¹æ‰ï¼Œè€Œè¿™ä¸ªå·¥ä½œé‡æ˜¯å¾ˆéš¾å®ç°çš„ï¼‰ã€‚</p><p>è¿™ä½¿å¾—åŒºå—é“¾ç‰¹åˆ«å®‰å…¨ï¼Œå‡ ä¹ä¸å¯èƒ½å›æ»šæˆ–è€…ç¯¡æ”¹ä»»ä½•æ•°æ®ã€‚è™½ç„¶å“ˆå¸Œä¸ºä¿å¯†å’Œéšç§æä¾›äº†å·¨å¤§çš„ä¿éšœï¼Œä½†æ˜¯è¿˜æœ‰ä¸¤ä¸ªæ›´åŠ å®‰å…¨å¦¥å½“çš„æªæ–½è®©åŒºå—é“¾æ›´åŠ å®‰å…¨ï¼šå·¥ä½œé‡è¯æ˜ï¼ˆProof-of-Workï¼‰ä»¥åŠæ™ºèƒ½åˆçº¦ï¼ˆSmart Contractsï¼‰ã€‚æœ¬æ–‡æˆ‘ä¸ä¼šæ·±å…¥è®²è§£ï¼Œä½ å¯ä»¥<a href="https://hackernoon.com/what-on-earth-is-a-smart-contract-2c82e5d89d26" target="_blank" rel="noopener">åœ¨è¿™é‡Œ</a>äº†è§£æ›´å¤šç›¸å…³çŸ¥è¯†ã€‚</p><p>åŒºå—é“¾æœ€åä¸€ä¸ªä¿è¯è‡ªèº«å®‰å…¨æ€§çš„æ–¹å¼æ˜¯åŸºäºå…¶å®šä½ã€‚å’Œå¤§å¤šæ•°å­˜å‚¨åœ¨æœåŠ¡å™¨å’Œæ•°æ®åº“çš„æ•°æ®ä¸åŒï¼ŒåŒºå—é“¾ä½¿ç”¨çš„æ˜¯ç‚¹å¯¹ç‚¹ï¼ˆP2Pï¼‰ç½‘ç»œã€‚P2P æ˜¯ä¸€ç§å…è®¸ä»»ä½•äººåŠ å…¥çš„ç½‘ç»œï¼Œå¹¶ä¸”è¯¥ç½‘ç»œä¸Šçš„æ•°æ®ä¼šåˆ†å‘ç»™æ¯ä¸€ä¸ªæ¥æ”¶è€…ã€‚</p><p>æ¯å½“æœ‰äººåŠ å…¥è¿™ä¸ªç½‘ç»œï¼Œä»–ä»¬å°±ä¼šè·å¾—ä¸€ä»½åŒºå—é“¾çš„å®Œæ•´æ‹·è´ã€‚æ¯å½“æœ‰äººæ–°å»ºä¸€ä¸ªåŒºå—ï¼Œå°±ä¼šå¹¿æ’­ç»™å…¨ç½‘ã€‚åœ¨å°†è¯¥å—æ·»åŠ åˆ°é“¾ä¹‹å‰ï¼ŒèŠ‚ç‚¹ä¼šé€šè¿‡å‡ ä¸ªå¤æ‚çš„ç¨‹åºç¡®å®šè¯¥å—æ˜¯å¦è¢«ç¯¡æ”¹ã€‚è¿™æ ·ï¼Œæ‰€æœ‰äººã€æ‰€æœ‰åœ°æ–¹éƒ½å¯ä»¥ä½¿ç”¨è¿™ä¸ªä¿¡æ¯ã€‚å¦‚æœä½ æ˜¯ <em>HBO ç¾å‰§ç¡…è°·</em> çš„ç²‰ä¸ï¼Œå¯¹æ­¤åº”è¯¥ä¸ä¼šæ„Ÿåˆ°é™Œç”Ÿã€‚åœ¨è¯¥å‰§ä¸­ï¼Œä¸»æ¼”ï¼ˆRichardï¼‰ä½¿ç”¨ä¸€ç§ç›¸ä¼¼çš„æŠ€æœ¯åˆ›é€ äº†æ–°å‹äº’è”ç½‘ï¼ˆè¯‘è€…æ³¨ï¼šæœ‰è¶£çš„æ˜¯å‰§ä¸­è¿˜å‘è¡Œäº†åŒºå—é“¾æ•°å­—è´§å¸ PiedPaperCoinï¼Œæ„Ÿå…´è¶£çš„ç«¥é‹å¯ä»¥åˆ·ä¸€ä¸‹è¿™éƒ¨å‰§ï¼‰ã€‚</p><p>å› ä¸ºæ¯ä¸ªäººéƒ½æœ‰åŒºå—é“¾æˆ–è€…èŠ‚ç‚¹çš„ä¸€ä»½æ‹·è´ï¼Œä»–ä»¬å¯ä»¥è¾¾æˆä¸€ç§å…±è¯†å¹¶å†³å®šå“ªéƒ¨åˆ†åŒºå—æ˜¯æœ‰æ•ˆçš„ã€‚å› æ­¤ï¼Œå¦‚æœä½ æƒ³è¦æ”»å‡»æŸä¸ªåŒºå—ï¼Œä½ å¿…é¡»åŒæ—¶æ”»å‡»ç½‘ç»œä¸Š 50% ä»¥ä¸Šçš„åŒºå—ï¼ˆè¯‘è€…ï¼š51% æ”»å‡»ï¼‰ï¼Œä½¿å¾—ä½ çš„åŒºå—å¯ä»¥è¿½ä¸Šå¹¶æ›¿æ¢åŸåŒºå—é“¾ã€‚æ‰€ä»¥åŒºå—é“¾æˆ–è®¸æ˜¯è¿‡å»åå¹´æ‰€åˆ›é€ çš„æœ€å®‰å…¨çš„æŠ€æœ¯ä¹‹ä¸€ã€‚</p><h3 id="å…³äºç¤ºä¾‹ç¨‹åº"><a href="#å…³äºç¤ºä¾‹ç¨‹åº" class="headerlink" title="å…³äºç¤ºä¾‹ç¨‹åº"></a>å…³äºç¤ºä¾‹ç¨‹åº</h3><p>ç°åœ¨ä½ å·²ç»å¯¹åŒºå—é“¾çš„åŸç†æœ‰äº†åˆæ­¥çš„è®¤è¯†ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¼€å§‹å†™ç¤ºä¾‹ç¨‹åºå§ï¼ä½ å¯ä»¥åœ¨è¿™é‡Œä¸‹è½½<a href="https://github.com/appcoda/BlockchainDemo/raw/master/BlockchainStarter.zip" target="_blank" rel="noopener">åŸå§‹é¡¹ç›®</a>ã€‚</p><p>å¦‚ä½ æ‰€è§ï¼Œæˆ‘ä»¬æœ‰ä¸¤ä¸ªæ¯”ç‰¹å¸é’±åŒ…ã€‚ç¬¬ä¸€ä¸ªè´¦æˆ· 1065 æœ‰ 500 BTCï¼Œè€Œç¬¬äºŒä¸ªè´¦æˆ· 0217 æ²¡æœ‰ BTCã€‚æˆ‘ä»¬é€šè¿‡ send æŒ‰é’®å¯ä»¥å‘é€æ¯”ç‰¹å¸åˆ°å¦å¤–çš„è´¦æˆ·ã€‚ä¸ºäº†èµšå– BTCï¼Œæˆ‘ä»¬å¯ä»¥ç‚¹å‡» Mine æŒ‰é’®ï¼Œå¯ä»¥è·å¾— 50 BTC çš„å¥–åŠ±ã€‚æˆ‘ä»¬ä¸»è¦å·¥ä½œæ˜¯æŸ¥çœ‹æ§åˆ¶å°è¾“å‡ºï¼Œè§‚å¯Ÿä¸¤ä¸ªè´¦æˆ·é—´çš„äº¤æ˜“è¿‡ç¨‹ã€‚</p><p><img src="https://appcoda.com/wp-content/uploads/2018/05/blockchain-2.png" alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°"></p><p>åœ¨å·¦ä¾§å¯¼èˆªæ å¯ä»¥çœ‹åˆ°ä¸¤ä¸ªå¾ˆé‡è¦çš„ç±»ï¼š<code>Block</code> å’Œ <code>Blockchain</code>ã€‚ç›®å‰è¿™ä¸¤ä¸ªç±»éƒ½æ˜¯ç©ºå®ç°ï¼Œæˆ‘ä¼šå¸¦ç€ä½ ä»¬åœ¨è¿™ä¸¤ä¸ªç±»ä¸­å†™å…¥ç›¸å…³é€»è¾‘ã€‚ä¸‹é¢è®©æˆ‘ä»¬å¼€å§‹å§ï¼</p><p><img src="https://appcoda.com/wp-content/uploads/2018/05/blockchain-3.png" alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°"></p><h3 id="åœ¨-Swift-ä¸­å®šä¹‰åŒºå—"><a href="#åœ¨-Swift-ä¸­å®šä¹‰åŒºå—" class="headerlink" title="åœ¨ Swift ä¸­å®šä¹‰åŒºå—"></a>åœ¨ Swift ä¸­å®šä¹‰åŒºå—</h3><p>é¦–å…ˆæ‰“å¼€ <code>Block.swift</code> å¹¶æ·»åŠ å®šä¹‰åŒºå—çš„ä»£ç ã€‚åœ¨æ­¤ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å®šä¹‰åŒºå—æ˜¯ä»€ä¹ˆã€‚å‰é¢æˆ‘ä»¬æ›¾å®šä¹‰è¿‡ï¼ŒåŒºå—æ˜¯ç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼šå“ˆå¸Œã€å®é™…è®°å½•çš„æ•°æ®ä»¥åŠå‰ç½®åŒºå—çš„å“ˆå¸Œã€‚å½“æˆ‘ä»¬æƒ³è¦æ„å»ºæˆ‘ä»¬çš„åŒºå—é“¾æ—¶ï¼Œæˆ‘ä»¬å¿…é¡»çŸ¥é“è¯¥åŒºå—æ˜¯ç¬¬ä¸€ä¸ªè¿˜æ˜¯ç¬¬äºŒä¸ªã€‚æˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“åœ°åœ¨ Swift çš„ç±»ä¸­åšå¦‚ä¸‹å®šä¹‰ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> hash: <span class="type">String</span>!</span><br><span class="line"><span class="keyword">var</span> data: <span class="type">String</span>!</span><br><span class="line"><span class="keyword">var</span> previousHash: <span class="type">String</span>!</span><br><span class="line"><span class="keyword">var</span> index: <span class="type">Int</span>!</span><br></pre></td></tr></table></figure><p>ç°åœ¨éœ€è¦æ·»åŠ æœ€é‡è¦çš„ä»£ç ã€‚æˆ‘æ›¾æè¿‡åŒºå—åœ¨è¢«ä¿®æ”¹çš„æƒ…å†µä¸‹ï¼Œå“ˆå¸Œä¹Ÿä¼šéšä¹‹å˜åŒ–ï¼Œè¿™æ˜¯åŒºå—é“¾å¦‚æ­¤å®‰å…¨çš„ç‰¹æ€§ä¹‹ä¸€ã€‚å› æ­¤æˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªå‡½æ•°å»ç”Ÿæˆå“ˆå¸Œï¼Œè¯¥å“ˆå¸Œç”±éšæœºå­—æ¯å’Œæ•°å­—ç»„æˆã€‚è¿™ä¸ªå‡½æ•°åªéœ€è¦å‡ è¡Œä»£ç ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">generateHash</span><span class="params">()</span></span> -&gt; <span class="type">String</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="type">NSUUID</span>().uuidString.replacingOccurrences(of: <span class="string">"-"</span>, with: <span class="string">""</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>NSUUID</code> æ˜¯ä¸€ä¸ªä»£è¡¨é€šç”¨å”¯ä¸€å€¼çš„å¯¹è±¡ï¼Œå¹¶ä¸”å¯ä»¥æ¡¥æ¥æˆ UUIDã€‚å®ƒå¯ä»¥å¿«é€Ÿåœ°ç”Ÿæˆ 32 ä¸ªå­—ç¬¦ä¸²ã€‚æœ¬å‡½æ•°ç”Ÿæˆä¸€ä¸ª UUIDï¼Œåˆ é™¤å…¶ä¸­çš„è¿æ¥ç¬¦ï¼Œç„¶åè¿”å›ä¸€ä¸ª <code>String</code>ï¼Œæœ€åå°†ç»“æœä½œä¸ºåŒºå—çš„å“ˆå¸Œã€‚<code>Block.swift</code> ç°åœ¨å°±åƒä¸‹é¢ï¼š</p><p><img src="https://appcoda.com/wp-content/uploads/2018/05/blockchain-4.png" alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°"></p><p>ç°åœ¨æˆ‘ä»¬å·²ç»å®šä¹‰å¥½äº† <code>Block</code> ç±»ï¼Œä¸‹é¢æ¥å®šä¹‰ Blockchain ç±»ï¼Œé¦–å…ˆåˆ‡æ¢åˆ° <code>Blockchain.swift</code> ã€‚</p><h3 id="åœ¨-Swift-ä¸­å®šä¹‰åŒºå—é“¾"><a href="#åœ¨-Swift-ä¸­å®šä¹‰åŒºå—é“¾" class="headerlink" title="åœ¨ Swift ä¸­å®šä¹‰åŒºå—é“¾"></a>åœ¨ Swift ä¸­å®šä¹‰åŒºå—é“¾</h3><p>å’Œä¹‹å‰ä¸€æ ·ï¼Œé¦–å…ˆåˆ†æåŒºå—é“¾çš„åŸºæœ¬åŸç†ã€‚ç”¨éå¸¸åŸºç¡€çš„æœ¯è¯­æ¥è¯´ï¼ŒåŒºå—é“¾åªæ˜¯ç”±ä¸€è¿ä¸²çš„åŒºå—è¿æ¥è€Œæˆï¼Œä¹Ÿå¯ä»¥è¯´æ˜¯ä¸€ä¸ªç”±å¤šä¸ªæ¡ç›®ç»„æˆçš„åˆ—è¡¨ã€‚è¿™æ˜¯ä¸æ˜¯å¬èµ·æ¥å¾ˆç†Ÿæ‚‰å‘¢ï¼Ÿå…¶å®è¿™å°±æ˜¯æ•°ç»„çš„å®šä¹‰ï¼è€Œä¸”è¿™ä¸ªæ•°ç»„æ˜¯ç”±åŒºå—ç»„æˆçš„ï¼æ¥ä¸‹æ¥æ·»åŠ ä»¥ä¸‹ä»£ç ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> chain = [<span class="type">Block</span>]()</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">å¿«é€Ÿæç¤ºï¼š è¿™ä¸ªæ–¹æ³•å¯ä»¥åº”ç”¨äºè®¡ç®—æœºç§‘å­¦ä¸–ç•Œé‡Œçš„ä»»ä½•äº‹ç‰©ã€‚å¦‚æœä½ é‡åˆ°å¤§éš¾é¢˜ï¼Œå¯ä»¥å°è¯•æŠŠå®ƒåˆ†è§£æˆè‹¥å¹²ä¸ªå°é—®é¢˜ï¼Œä»¥æ­¤æ¥å»ºç«‹èµ·è§£å†³é—®é¢˜çš„æ–¹æ³•ï¼Œæ­£å¦‚æˆ‘ä»¬è§£å†³åœ¨ Swift ä¸­å¦‚ä½•æ·»åŠ åŒºå—å’ŒåŒºå—é“¾çš„é—®é¢˜ã€‚</span><br></pre></td></tr></table></figure><p>ä½ ä¼šæ³¨æ„åˆ°æ•°ç»„é‡Œé¢æ˜¯æˆ‘ä»¬å‰é¢å®šä¹‰çš„ <code>Block</code> ç±»ï¼Œè¿™å°±æ˜¯åŒºå—é“¾æ‰€éœ€è¦çš„æ‰€æœ‰å˜é‡ã€‚ä¸ºäº†å®ŒæˆåŠŸèƒ½ï¼Œæˆ‘ä»¬è¿˜éœ€è¦åœ¨ç±»ä¸­æ·»åŠ ä¸¤ä¸ªå‡½æ•°ã€‚è¯·å°è¯•ç€æ ¹æ®æˆ‘ä¹‹å‰æ•™è¿‡çš„æ–¹æ³•è§£ç­”è¿™ä¸ªé—®é¢˜ã€‚</p><blockquote><p>åŒºå—é“¾ä¸­çš„ä¸¤ä¸ªä¸»è¦å‡½æ•°æ˜¯ä»€ä¹ˆï¼Ÿ</p></blockquote><p>æˆ‘å¸Œæœ›ä½ èƒ½è®¤çœŸæ€è€ƒå¹¶å›ç­”è¿™ä¸ªé—®é¢˜ï¼å®é™…ä¸Šï¼ŒåŒºå—é“¾çš„ä¸¤ä¸ªä¸»è¦åŠŸèƒ½æ˜¯åˆ›å»ºåˆ›ä¸–åŒºå—ï¼ˆæœ€åˆçš„å§‹å—ï¼‰ï¼Œä»¥åŠåœ¨å…¶ç»“å°¾æ·»åŠ æ–°çš„åŒºå—ã€‚å½“ç„¶ç°åœ¨æˆ‘ä¸æ‰“ç®—å®ç°åˆ†å‰åŒºå—é“¾å’Œæ·»åŠ æ™ºèƒ½åˆçº¦çš„åŠŸèƒ½ï¼Œä½†ä½ å¿…é¡»äº†è§£è¿™ä¸¤ä¸ªæ˜¯åŸºæœ¬åŠŸèƒ½ï¼å°†ä»¥ä¸‹ä»£ç æ·»åŠ åˆ° <code>Blockchain.swift</code>ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">createGenesisBlock</span><span class="params">(data:String)</span></span> &#123;</span><br><span class="line">    <span class="keyword">let</span> genesisBlock = <span class="type">Block</span>()</span><br><span class="line">    genesisBlock.hash = genesisBlock.generateHash()</span><br><span class="line">    genesisBlock.data = data</span><br><span class="line">    genesisBlock.previousHash = <span class="string">"0000"</span></span><br><span class="line">    genesisBlock.index = <span class="number">0</span></span><br><span class="line">    chain.append(genesisBlock)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">createBlock</span><span class="params">(data:String)</span></span> &#123;</span><br><span class="line">    <span class="keyword">let</span> newBlock = <span class="type">Block</span>()</span><br><span class="line">    newBlock.hash = newBlock.generateHash()</span><br><span class="line">    newBlock.data = data</span><br><span class="line">    newBlock.previousHash = chain[chain.<span class="built_in">count</span>-<span class="number">1</span>].hash</span><br><span class="line">    newBlock.index = chain.<span class="built_in">count</span></span><br><span class="line">    chain.append(newBlock)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>1ã€æˆ‘ä»¬æ·»åŠ çš„ç¬¬ä¸€ä¸ªå‡½æ•°çš„ä½œç”¨æ˜¯åˆ›å»ºåˆ›ä¸–åŒºå—ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªä»¥åŒºå—æ•°æ®ä¸ºå…¥å‚çš„å‡½æ•°ã€‚ç„¶åå®šä¹‰äº†ä¸€ä¸ªç±»å‹ä¸º <code>Block</code> çš„å˜é‡ <code>genesisBlock</code>ï¼Œå®ƒæ‹¥æœ‰æ­¤å‰åœ¨ <code>Block.swift</code> ä¸­å®šä¹‰çš„æ‰€æœ‰å˜é‡å’Œå‡½æ•°ã€‚æˆ‘ä»¬å°† <code>generateHash()</code> èµ‹å€¼ç»™å“ˆå¸Œï¼Œå°†è¾“å…¥çš„ <code>data</code> å‚æ•°èµ‹å€¼ç»™æ•°æ®ã€‚ç”±äºè¿™æ˜¯ç¬¬ä¸€ä¸ªåŒºå—ï¼Œæˆ‘ä»¬å°†å‰ç½®åŒºå—çš„å“ˆå¸Œè®¾ä¸º 0000ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥çŸ¥é“è¿™æ˜¯èµ·å§‹åŒºå—ã€‚æœ€åæˆ‘ä»¬å°† <code>index</code> è®¾ä¸º 0ï¼Œå¹¶å°†è¿™ä¸ªåŒºå—åŠ å…¥åˆ°åŒºå—é“¾ä¸­ã€‚</p><p>2ã€æˆ‘ä»¬åˆ›å»ºçš„ç¬¬äºŒä¸ªå‡½æ•°é€‚ç”¨äº <code>genesisBlock</code> ä¹‹åçš„æ‰€æœ‰åŒºå—ï¼Œå¹¶ä¸”èƒ½åˆ›å»ºå‰©ä½™çš„åŒºå—ã€‚ä½ ä¼šæ³¨æ„åˆ°å®ƒä¸ç¬¬ä¸€ä¸ªå‡½æ•°éå¸¸ç›¸ä¼¼ã€‚å”¯ä¸€çš„åŒºåˆ«æ˜¯ï¼Œæˆ‘ä»¬å°† <code>previousHash</code> çš„å€¼è®¾ç½®ä¸ºå‰ä¸€ä¸ªåŒºå—çš„å“ˆå¸Œå€¼ï¼Œå¹¶å°† <code>index</code> è®¾ç½®ä¸ºå®ƒåœ¨åŒºå—é“¾ä¸­çš„ä½ç½®ã€‚å°±è¿™æ ·ï¼ŒåŒºå—é“¾å·²ç»å®šä¹‰å¥½äº†ï¼ä½ çš„ä»£ç åº”è¯¥çœ‹èµ·æ¥è·Ÿä¸‹å›¾ä¸€æ ·ï¼</p><p><img src="https://appcoda.com/wp-content/uploads/2018/05/blockchain-5.png" alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°"></p><h3 id="é’±åŒ…åç«¯"><a href="#é’±åŒ…åç«¯" class="headerlink" title="é’±åŒ…åç«¯"></a>é’±åŒ…åç«¯</h3><p>ç°åœ¨åˆ‡æ¢åˆ° <code>ViewController.swift</code>ï¼Œæˆ‘ä»¬ä¼šå‘ç°æ‰€æœ‰çš„ outlet éƒ½å·²ç»è¿æ¥å¥½äº†ã€‚æˆ‘ä»¬åªéœ€è¦å¤„ç†äº¤æ˜“ï¼Œå¹¶å°†å…¶è¾“å‡ºåˆ°æ§åˆ¶å°ã€‚</p><p>ç„¶è€Œåœ¨æ­¤ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦ç¨å¾®ç ”ç©¶ä¸€ä¸‹æ¯”ç‰¹å¸çš„åŒºå—é“¾ã€‚æ¯”ç‰¹å¸æ˜¯ç”±ä¸€ä¸ªæ€»è´¦æˆ·äº§ç”Ÿçš„ï¼Œæˆ‘ä»¬å°†è¿™ä¸ªè´¦å·çš„ç¼–å·ç§°ä¸º 0000ã€‚å½“ä½ æŒ–åˆ°ä¸€ä¸ª BTCï¼Œæ„å‘³ç€ä½ è§£å†³äº†æ•°å­¦é—®é¢˜ï¼Œå› æ­¤ä¼šå‘è¡Œä¸€å®šæ•°é‡çš„æ¯”ç‰¹å¸ä½œä¸ºå¥–åŠ±ã€‚è¿™æä¾›äº†ä¸€ä¸ªå‘å¸çš„é«˜æ˜æ–¹æ³•ï¼Œå¹¶ä¸”å¯ä»¥æ¿€åŠ±æ›´å¤šäººå»æŒ–çŸ¿ã€‚åœ¨æˆ‘ä»¬çš„åº”ç”¨ï¼Œè®©æˆ‘ä»¬æŠŠæŒ–çŸ¿å¥–åŠ±è®¾ä¸º 100 BTCã€‚é¦–å…ˆï¼Œåœ¨è§†å›¾æ§åˆ¶å™¨ä¸­æ·»åŠ æ‰€éœ€çš„å˜é‡ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> firstAccount = <span class="number">1065</span></span><br><span class="line"><span class="keyword">let</span> secondAccount = <span class="number">0217</span></span><br><span class="line"><span class="keyword">let</span> bitcoinChain = <span class="type">Blockchain</span>()</span><br><span class="line"><span class="keyword">let</span> reward = <span class="number">100</span></span><br><span class="line"><span class="keyword">var</span> accounts: [<span class="type">String</span>: <span class="type">Int</span>] = [<span class="string">"0000"</span>: <span class="number">10000000</span>]</span><br><span class="line"><span class="keyword">let</span> invalidAlert = <span class="type">UIAlertController</span>(title: <span class="string">"Invalid Transaction"</span>, message: <span class="string">"Please check the details of your transaction as we were unable to process this."</span>, preferredStyle: .alert)</span><br></pre></td></tr></table></figure><p>é¦–å…ˆå®šä¹‰å·ç ä¸º 1065 å’Œ 0217 çš„ä¸¤ä¸ªè´¦å·ã€‚ç„¶åæ·»åŠ ä¸€ä¸ªåä¸º <code>bitcoinChain</code> çš„å˜é‡ä½œä¸ºæˆ‘ä»¬çš„åŒºå—é“¾ï¼Œå¹¶å°† <code>reward</code> è®¾ä¸º 100ã€‚æˆ‘ä»¬éœ€è¦ä¸€ä¸ªä¸»å¸æˆ·ä½œä¸ºæ‰€æœ‰æ¯”ç‰¹å¸çš„æ¥æºï¼šå³åˆ›ä¸–å¸æˆ· 0000ã€‚é‡Œé¢æœ‰ 1000 ä¸‡ä¸ªæ¯”ç‰¹å¸ã€‚ä½ å¯ä»¥æŠŠè¿™ä¸ªè´¦æˆ·æƒ³è±¡æˆä¸€ä¸ªé“¶è¡Œï¼Œæ‰€æœ‰å› å¥–åŠ±äº§ç”Ÿçš„ 100 ä¸ªæ¯”ç‰¹å¸éƒ½ç»æ­¤å‘æ”¾åˆ°åˆæ³•è´¦æˆ·ä¸­ã€‚æˆ‘ä»¬è¿˜å®šä¹‰äº†ä¸€ä¸ªæé†’å¼¹çª—ï¼Œæ¯å½“äº¤æ˜“æ— æ³•å®Œæˆæ—¶å°±ä¼šå¼¹å‡ºã€‚</p><p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬æ¥ç¼–å†™å‡ ä¸ªè¿è¡Œæ—¶éœ€è¦çš„é€šç”¨å‡½æ•°ã€‚ä½ èƒ½çŒœå‡ºæ˜¯ä»€ä¹ˆå‡½æ•°å—ï¼Ÿ</p><p>1ã€ç¬¬ä¸€ä¸ªå‡½æ•°æ˜¯ç”¨æ¥å¤„ç†äº¤æ˜“çš„ã€‚æˆ‘ä»¬éœ€è¦ç¡®ä¿äº¤æ˜“åŒæ–¹çš„è´¦æˆ·ï¼Œèƒ½å¤Ÿæ¥æ”¶æˆ–æ‰£é™¤æ­£ç¡®çš„é‡‘é¢ï¼Œå¹¶å°†è¿™äº›ä¿¡æ¯è®°å½•åˆ°æˆ‘ä»¬çš„åŒºå—é“¾ä¸­ã€‚</p><p>2ã€ä¸‹ä¸€ä¸ªå‡½æ•°æ˜¯åœ¨æ§åˆ¶å°ä¸­æ‰“å°æ•´ä¸ªè®°å½• â€”â€” å®ƒå°†æ˜¾ç¤ºæ¯ä¸ªåŒºå—åŠå…¶ä¸­çš„æ•°æ®ã€‚</p><p>3ã€æœ€åä¸€ä¸ªæ˜¯ç”¨äºéªŒè¯åŒºå—é“¾æ˜¯å¦æœ‰æ•ˆçš„å‡½æ•°ï¼Œé€šè¿‡æ ¡éªŒä¸‹ä¸€ä¸ªåŒºå—çš„ <code>previousHash</code> å’Œä¸Šä¸€ä¸ªåŒºå— <code>hash</code> æ˜¯å¦åŒ¹é…ã€‚ç”±äºæˆ‘ä»¬ä¸ä¼šæ¼”ç¤ºä»»ä½•é»‘å®¢æ–¹æ³•ï¼Œå› æ­¤åœ¨æˆ‘ä»¬çš„ç¤ºä¾‹ç¨‹åºä¸­ï¼ŒåŒºå—é“¾æ˜¯æ°¸è¿œæœ‰æ•ˆçš„ã€‚</p><h3 id="äº¤æ˜“å‡½æ•°"><a href="#äº¤æ˜“å‡½æ•°" class="headerlink" title="äº¤æ˜“å‡½æ•°"></a>äº¤æ˜“å‡½æ•°</h3><p>ä¸‹é¢æ˜¯ä¸€ä¸ªé€šç”¨çš„äº¤æ˜“å‡½æ•°ï¼Œè¯·åœ¨æˆ‘ä»¬å®šä¹‰çš„å˜é‡ä¸‹æ–¹è¾“å…¥ä»¥ä¸‹ä»£ç ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">transaction</span><span class="params">(from: String, to: String, amount: Int, type: String)</span></span> &#123;</span><br><span class="line">    <span class="comment">// 1</span></span><br><span class="line">    <span class="keyword">if</span> accounts[from] == <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.present(invalidAlert, animated: <span class="literal">true</span>, completion: <span class="literal">nil</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> accounts[from]!-amount &lt; <span class="number">0</span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.present(invalidAlert, animated: <span class="literal">true</span>, completion: <span class="literal">nil</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        accounts.updateValue(accounts[from]!-amount, forKey: from)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2</span></span><br><span class="line">    <span class="keyword">if</span> accounts[to] == <span class="literal">nil</span> &#123;</span><br><span class="line">        accounts.updateValue(amount, forKey: to)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        accounts.updateValue(accounts[to]!+amount, forKey: to)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 3</span></span><br><span class="line">    <span class="keyword">if</span> type == <span class="string">"genesis"</span> &#123;</span><br><span class="line">        bitcoinChain.createGenesisBlock(data: <span class="string">"From: <span class="subst">\(from)</span>; To: <span class="subst">\(to)</span>; Amount: <span class="subst">\(amount)</span>BTC"</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> type == <span class="string">"normal"</span> &#123;</span><br><span class="line">        bitcoinChain.createBlock(data: <span class="string">"From: <span class="subst">\(from)</span>; To: <span class="subst">\(to)</span>; Amount: <span class="subst">\(amount)</span>BTC"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»£ç é‡çœ‹èµ·æ¥å¥½åƒå¾ˆå¤§ï¼Œä½†ä¸»è¦æ˜¯å®šä¹‰äº†æ¯ä¸ªäº¤æ˜“éœ€è¦éµå¾ªçš„ä¸€äº›è§„åˆ™ã€‚ä¸€å¼€å§‹æ˜¯å‡½æ•°çš„å››ä¸ªå‚æ•°ï¼š<br><code>to</code>ï¼Œ<code>from</code>ï¼Œ<code>amount</code>ï¼Œ<code>type</code>ã€‚å‰ä¸‰ä¸ªå‚æ•°ä¸éœ€è¦å†è§£é‡Šäº†ï¼Œè€Œ <code>Type</code> ä¸»è¦ç”¨äºå®šä¹‰äº¤æ˜“çš„ç±»å‹ã€‚æ€»å…±æœ‰ä¸¤ä¸ªç±»å‹ï¼šæ­£å¸¸ç±»å‹ï¼ˆnormalï¼‰ å’Œåˆ›ä¸–ç±»å‹ï¼ˆgenesisï¼‰ã€‚æ­£å¸¸ç±»å‹çš„äº¤æ˜“ä¼šå‘ç”Ÿåœ¨è´¦æˆ· 1065 å’Œ 2017 ä¹‹é—´ï¼Œè€Œåˆ›ä¸–ç±»å‹å°†ä¼šæ¶‰åŠåˆ°è´¦æˆ· 0000ã€‚</p><p>1ã€ç¬¬ä¸€ä¸ª <code>if-else</code> æ¡ä»¶è¯­å¥å¤„ç†è½¬å‡ºè´¦æˆ·çš„ä¿¡æ¯ã€‚å¦‚æœè´¦æˆ·ä¸å­˜åœ¨æˆ–è€…ä½™é¢ä¸è¶³ï¼Œå°†ä¼šæç¤ºäº¤æ˜“ä¸åˆæ³•å¹¶è¿”å›ã€‚</p><p>2ã€ç¬¬äºŒä¸ª <code>if-else</code> æ¡ä»¶è¯­å¥å¤„ç†è½¬å…¥è´¦æˆ·çš„ä¿¡æ¯ã€‚å¦‚æœè´¦æˆ·ä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºæ–°è´¦æˆ·å¹¶è½¬å…¥ç›¸åº”çš„æ¯”ç‰¹å¸ã€‚åä¹‹ï¼Œåˆ™å‘è¯¥è´¦æˆ·è½¬å…¥æ­£ç¡®æ•°é‡çš„æ¯”ç‰¹å¸ã€‚</p><p>3ã€æœ€åä¸€ä¸ª <code>if-else</code> æ¡ä»¶è¯­å¥å¤„ç†äº¤æ˜“ç±»å‹ã€‚å¦‚æœç±»å‹æ˜¯åˆ›ä¸–ç±»å‹ï¼Œåˆ™æ·»åŠ ä¸€ä¸ªåˆ›ä¸–åŒºå—ï¼Œå¦åˆ™åˆ›å»ºä¸€ä¸ªæ–°çš„åŒºå—å­˜å‚¨æ•°æ®ã€‚</p><h3 id="æ‰“å°å‡½æ•°"><a href="#æ‰“å°å‡½æ•°" class="headerlink" title="æ‰“å°å‡½æ•°"></a>æ‰“å°å‡½æ•°</h3><p>ä¸ºäº†ç¡®ä¿äº¤æ˜“æ­£ç¡®æ‰§è¡Œï¼Œåœ¨æ¯ä¸ªäº¤æ˜“ç»“æŸåï¼Œæˆ‘ä»¬å¸Œæœ›æ‹¿åˆ°æ‰€æœ‰äº¤æ˜“çš„æ¸…å•ã€‚ä»¥ä¸‹æ˜¯æˆ‘ä»¬åœ¨äº¤æ˜“å‡½æ•°ä¸‹æ–¹çš„ä»£ç ï¼Œç”¨æ¥æ‰“å°ç›¸å…³ä¿¡æ¯ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">chainState</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="number">0</span>...bitcoinChain.chain.<span class="built_in">count</span>-<span class="number">1</span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"\tBlock: <span class="subst">\(bitcoinChain.chain[i].index!)</span>\n\tHash: <span class="subst">\(bitcoinChain.chain[i].hash!)</span>\n\tPreviousHash: <span class="subst">\(bitcoinChain.chain[i].previousHash!)</span>\n\tData: <span class="subst">\(bitcoinChain.chain[i].data!)</span>"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    redLabel.text = <span class="string">"Balance: <span class="subst">\(accounts[String(describing: firstAccount)</span>]!) BTC"</span></span><br><span class="line">    blueLabel.text = <span class="string">"Balance: <span class="subst">\(accounts[String(describing: secondAccount)</span>]!) BTC"</span></span><br><span class="line">    <span class="built_in">print</span>(accounts)</span><br><span class="line">    <span class="built_in">print</span>(chainValidity())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ˜¯ä¸€ä¸ªç®€å•çš„å¾ªç¯è¯­å¥ï¼Œéå† <code>bitcoinChain</code> ä¸­çš„æ‰€æœ‰åŒºå—ï¼Œå¹¶æ‰“å°åŒºå—å·ç ï¼Œå“ˆå¸Œï¼Œå‰ç½®å“ˆå¸Œï¼Œä»¥åŠå­˜å‚¨çš„æ•°æ®ã€‚åŒæ—¶æˆ‘ä»¬æ›´æ–°äº†ç•Œé¢ä¸­çš„æ ‡ç­¾ï¼ˆlabelï¼‰ï¼Œè¿™æ ·å°±å¯ä»¥æ˜¾ç¤ºè´¦æˆ·ä¸­æ­£ç¡®çš„ BTC æ•°é‡ã€‚æœ€åï¼Œæ‰“å°æ‰€æœ‰çš„è´¦æˆ·ï¼ˆåº”è¯¥æ˜¯ 3 ä¸ªï¼‰ï¼Œå¹¶æ ¡éªŒåŒºå—é“¾çš„æœ‰æ•ˆæ€§ã€‚</p><p>ç°åœ¨ä½ åº”è¯¥ä¼šåœ¨å‡½æ•°çš„æœ€åä¸€è¡Œå‘ç°ä¸€ä¸ªé”™è¯¯ã€‚è¿™æ˜¯ç”±äºæˆ‘ä»¬è¿˜æ²¡æœ‰å®ç° <code>chainValidity()</code> å‡½æ•°ï¼Œè®©æˆ‘ä»¬é©¬ä¸Šå¼€å§‹å§ã€‚</p><h3 id="æœ‰æ•ˆæ€§å‡½æ•°"><a href="#æœ‰æ•ˆæ€§å‡½æ•°" class="headerlink" title="æœ‰æ•ˆæ€§å‡½æ•°"></a>æœ‰æ•ˆæ€§å‡½æ•°</h3><p>åˆ¤æ–­ä¸€ä¸ªé“¾æ˜¯å¦æœ‰æ•ˆçš„æ ‡å‡†æ˜¯ï¼šå‰ç½®åŒºå—çš„å“ˆå¸Œä¸å½“å‰åŒºå—æ‰€è¡¨ç¤ºçš„æ˜¯å¦åŒ¹é…ã€‚æˆ‘ä»¬å¯ä»¥å†æ¬¡ç”¨å¾ªç¯è¯­å¥æ¥éå†æ‰€æœ‰çš„åŒºå—ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">chainValidity</span><span class="params">()</span></span> -&gt; <span class="type">String</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> isChainValid = <span class="literal">true</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="number">1</span>...bitcoinChain.chain.<span class="built_in">count</span>-<span class="number">1</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> bitcoinChain.chain[i].previousHash != bitcoinChain.chain[i-<span class="number">1</span>].hash &#123;</span><br><span class="line">            isChainValid = <span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"Chain is valid: <span class="subst">\(isChainValid)</span>\n"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å’Œä¹‹å‰ä¸€æ ·ï¼Œæˆ‘ä»¬éå†äº† <code>bitcoinChain</code> ä¸­çš„æ‰€æœ‰åŒºå—ï¼Œå¹¶æ£€æŸ¥äº†å‰ç½®åŒºå—çš„ <code>hash</code> æ˜¯å¦ä¸å½“å‰åŒºå—çš„ <code>previousHash</code> ä¸€è‡´ã€‚</p><p>å°±é…±ï¼æˆ‘ä»¬å·²ç»å°†å®šä¹‰äº†æ‰€æœ‰éœ€è¦çš„å‡½æ•°ï¼ä½ çš„ <code>ViewController.swift</code> åº”è¯¥å¦‚ä¸‹å›¾ä¸€æ ·ï¼š</p><p><img src="https://appcoda.com/wp-content/uploads/2018/05/blockchain-6.png" alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°"></p><p>æ”¶å°¾å·¥ä½œå°±æ˜¯è¿æ¥æŒ‰é’®å’Œå‡½æ•°å•¦ã€‚è®©æˆ‘ä»¬é©¬ä¸Šå¼€å§‹æœ€åçš„éƒ¨åˆ†å§ï¼</p><h3 id="è®©ä¸€åˆ‡å…³è”èµ·æ¥"><a href="#è®©ä¸€åˆ‡å…³è”èµ·æ¥" class="headerlink" title="è®©ä¸€åˆ‡å…³è”èµ·æ¥"></a>è®©ä¸€åˆ‡å…³è”èµ·æ¥</h3><p>å½“æˆ‘ä»¬çš„åº”ç”¨ç¬¬ä¸€æ¬¡å¯åŠ¨æ—¶ï¼Œéœ€è¦åˆ›ä¸–è´¦æˆ· 0000 å‘é€ 50 BTC åˆ°æˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªè´¦æˆ·ã€‚å†ä»ç¬¬ä¸€ä¸ªè´¦æˆ·è½¬è´¦ 10 BTC åˆ°ç¬¬äºŒä¸ªè´¦æˆ·ï¼Œè¿™åªéœ€è¦å¯¥å¯¥ä¸‰è¡Œä»£ç ã€‚æœ€å <code>viewDidLoad</code> ä¸­çš„ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">super</span>.viewDidLoad()</span><br><span class="line">    transaction(from: <span class="string">"0000"</span>, to: <span class="string">"<span class="subst">\(firstAccount)</span>"</span>, amount: <span class="number">50</span>, type: <span class="string">"genesis"</span>)</span><br><span class="line">    transaction(from: <span class="string">"<span class="subst">\(firstAccount)</span>"</span>, to: <span class="string">"<span class="subst">\(secondAccount)</span>"</span>, amount: <span class="number">10</span>, type: <span class="string">"normal"</span>)</span><br><span class="line">    chainState()</span><br><span class="line">    <span class="keyword">self</span>.invalidAlert.addAction(<span class="type">UIAlertAction</span>(title: <span class="string">"OK"</span>, style: .<span class="keyword">default</span>, handler: <span class="literal">nil</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬ä½¿ç”¨å·²å®šä¹‰å¥½çš„å‡½æ•°è½¬è´¦ï¼Œå¹¶è°ƒç”¨ <code>chainState()</code> å‡½æ•°ã€‚æœ€åï¼Œæˆ‘ä»¬è¿˜åœ¨ <code>invalidAlert</code> ä¸­æ·»åŠ äº†ä¸€ä¸ªæ ‡é¢˜ä¸º OK çš„ <code>UIAlertAction</code>ã€‚</p><p>ç°åœ¨è®©æˆ‘ä»¬æ¥å®ç°å‰©ä¸‹çš„å››ä¸ªå‡½æ•°ï¼š<code>ReMeNe()</code>ã€<code>BrimeMeNe()</code>ã€<code>ReSdEnter()</code>å’Œ<code>BuLeScript()</code>ã€‚</p><h3 id="æŒ–çŸ¿å‡½æ•°"><a href="#æŒ–çŸ¿å‡½æ•°" class="headerlink" title="æŒ–çŸ¿å‡½æ•°"></a>æŒ–çŸ¿å‡½æ•°</h3><p>æŒ–çŸ¿å‡½æ•°ç‰¹åˆ«ç®€å•ï¼Œåªéœ€è¦ä¸‰è¡Œä»£ç ã€‚æ·»åŠ ä»¥ä¸‹ä»£ç ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="meta">@IBAction</span> <span class="function"><span class="keyword">func</span> <span class="title">redMine</span><span class="params">(<span class="number">_</span> sender: Any)</span></span> &#123;</span><br><span class="line">    transaction(from: <span class="string">"0000"</span>, to: <span class="string">"<span class="subst">\(firstAccount)</span>"</span>, amount: <span class="number">100</span>, type: <span class="string">"normal"</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"New block mined by: <span class="subst">\(firstAccount)</span>"</span>)</span><br><span class="line">    chainState()</span><br><span class="line">&#125;</span><br><span class="line">    </span><br><span class="line"><span class="meta">@IBAction</span> <span class="function"><span class="keyword">func</span> <span class="title">blueMine</span><span class="params">(<span class="number">_</span> sender: Any)</span></span> &#123;</span><br><span class="line">    transaction(from: <span class="string">"0000"</span>, to: <span class="string">"<span class="subst">\(secondAccount)</span>"</span>, amount: <span class="number">100</span>, type: <span class="string">"normal"</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"New block mined by: <span class="subst">\(secondAccount)</span>"</span>)</span><br><span class="line">    chainState()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ç¬¬ä¸€ä¸ªæŒ–çŸ¿å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº¤æ˜“å‡½æ•°ä»åˆ›ä¸–è´¦æˆ·å‘é€äº† 100 BTC åˆ°ç¬¬ä¸€ä¸ªè´¦æˆ·ã€‚æˆ‘ä»¬æ‰“å°äº†æŒ–çŸ¿çš„åŒºå—ï¼Œç„¶åæ‰“å°äº†åŒºå—é“¾çš„çŠ¶æ€ã€‚åŒæ ·åœ°ï¼Œåœ¨ <code>blueMine</code> å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬è½¬ç»™äº†ç¬¬äºŒä¸ªè´¦æˆ· 100 BTCã€‚</p><h3 id="å‘é€å‡½æ•°"><a href="#å‘é€å‡½æ•°" class="headerlink" title="å‘é€å‡½æ•°"></a>å‘é€å‡½æ•°</h3><p>å‘é€å‡½æ•°å’ŒæŒ–çŸ¿å‡½æ•°ç•¥å¾®ç›¸ä¼¼ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="meta">@IBAction</span> <span class="function"><span class="keyword">func</span> <span class="title">redSend</span><span class="params">(<span class="number">_</span> sender: Any)</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> redAmount.text == <span class="string">""</span> &#123;</span><br><span class="line">        present(invalidAlert, animated: <span class="literal">true</span>, completion: <span class="literal">nil</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        transaction(from: <span class="string">"<span class="subst">\(firstAccount)</span>"</span>, to: <span class="string">"<span class="subst">\(secondAccount)</span>"</span>, amount: <span class="type">Int</span>(redAmount.text!)!, type: <span class="string">"normal"</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"<span class="subst">\(redAmount.text!)</span> BTC sent from <span class="subst">\(firstAccount)</span> to <span class="subst">\(secondAccount)</span>"</span>)</span><br><span class="line">        chainState()</span><br><span class="line">        redAmount.text = <span class="string">""</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">    </span><br><span class="line"><span class="meta">@IBAction</span> <span class="function"><span class="keyword">func</span> <span class="title">blueSend</span><span class="params">(<span class="number">_</span> sender: Any)</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> blueAmount.text == <span class="string">""</span> &#123;</span><br><span class="line">        present(invalidAlert, animated: <span class="literal">true</span>, completion: <span class="literal">nil</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        transaction(from: <span class="string">"<span class="subst">\(secondAccount)</span>"</span>, to: <span class="string">"<span class="subst">\(firstAccount)</span>"</span>, amount: <span class="type">Int</span>(blueAmount.text!)!, type: <span class="string">"normal"</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"<span class="subst">\(blueAmount.text!)</span> BTC sent from <span class="subst">\(secondAccount)</span> to <span class="subst">\(firstAccount)</span>"</span>)</span><br><span class="line">        chainState()</span><br><span class="line">        blueAmount.text = <span class="string">""</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é¦–å…ˆï¼Œæˆ‘ä»¬æ£€æŸ¥ <code>redAmount</code> æˆ–è€… <code>blueAmount</code> çš„æ–‡æœ¬å€¼æ˜¯å¦ä¸ºç©ºã€‚å¦‚æœä¸ºç©ºï¼Œåˆ™å¼¹å‡ºæ— æ•ˆäº¤æ˜“çš„æç¤ºæ¡†ã€‚å¦‚æœä¸ä¸ºç©ºï¼Œåˆ™ç»§ç»­ä¸‹ä¸€æ­¥ã€‚æˆ‘ä»¬ä½¿ç”¨äº¤æ˜“å‡½æ•°ä»ç¬¬ä¸€ä¸ªè´¦æˆ·è½¬è´¦åˆ°ç¬¬äºŒä¸ªè´¦æˆ·ï¼ˆæˆ–è€…åå‘è½¬è´¦ï¼‰ï¼Œé‡‘é¢ä¸ºè¾“å…¥çš„æ•°é‡ã€‚æˆ‘ä»¬æ‰“å°è½¬è´¦é‡‘é¢ï¼Œå¹¶è°ƒç”¨ <code>chainState()</code> æ–¹æ³•ã€‚æœ€åï¼Œæ¸…ç©ºæ–‡æœ¬æ¡†ã€‚</p><p>å°±é…±ï¼Œå·¥ä½œå®Œæˆï¼è¯·æ£€æŸ¥ä½ çš„ä»£ç æ˜¯å¦å’Œå›¾ä¸­ä¸€è‡´ï¼š</p><p><img src="https://appcoda.com/wp-content/uploads/2018/05/blockchain-7.png" alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°"></p><p>ç°åœ¨è¿è¡Œåº”ç”¨å¹¶æµ‹è¯•ä¸€ä¸‹ã€‚ä»å‰ç«¯çœ‹ï¼Œè¿™å°±åƒä¸€ä¸ªæ­£å¸¸çš„äº¤æ˜“åº”ç”¨ï¼Œä½†æ˜¯è¿è¡Œåœ¨å±å¹•èƒŒåçš„å¯æ˜¯åŒºå—é“¾å•Šï¼è¯·å°è¯•ä½¿ç”¨åº”ç”¨å°† BTC ä»ä¸€ä¸ªå¸æˆ·è½¬ç§»åˆ°å¦ä¸€ä¸ªå¸æˆ·ï¼Œéšæ„æµ‹è¯•ï¼Œå°½æƒ…æŠŠç©å§ï¼</p><h3 id="ç»“è®º"><a href="#ç»“è®º" class="headerlink" title="ç»“è®º"></a>ç»“è®º</h3><p>åœ¨è¿™ä¸ªæ•™ç¨‹ä¸­ï¼Œä½ å·²ç»å­¦ä¼šäº†å¦‚ä½•ä½¿ç”¨ Swift åˆ›å»ºåŒºå—é“¾ï¼Œå¹¶ä¸”åˆ›å»ºäº†ä½ è‡ªå·±çš„æ¯”ç‰¹å¸äº¤æ˜“ç³»ç»Ÿã€‚è¯·æ³¨æ„ï¼ŒçœŸæ­£åŠ å¯†è´§å¸çš„åç«¯ï¼Œå’Œæˆ‘ä»¬ä¸Šé¢çš„å®ç°å®Œå…¨ä¸ä¸€æ ·ï¼Œå› ä¸ºå®ƒéœ€è¦ç”¨æ™ºèƒ½åˆçº¦å®ç°åˆ†å¸ƒå¼ï¼Œè€Œæœ¬ä¾‹ä»…ç”¨äºå­¦ä¹ ã€‚</p><p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å°†åŒºå—é“¾æŠ€æœ¯åº”ç”¨äºåŠ å¯†è´§å¸ï¼Œç„¶è€Œä½ èƒ½æƒ³åˆ°åŒºå—é“¾çš„å…¶ä»–åº”ç”¨åœºæ™¯å—ï¼Ÿè¯·ç•™è¨€åˆ†äº«ç»™å¤§å®¶ï¼å¸Œæœ›ä½ èƒ½å­¦åˆ°æ›´å¤šæ–°ä¸œè¥¿ï¼</p><p>ä¸ºäº†å‚è€ƒï¼Œä½ å¯ä»¥ä» GitHub ä¸‹è½½<a href="https://github.com/appcoda/BlockchainDemo" target="_blank" rel="noopener">å®Œæ•´çš„ç¤ºä¾‹</a>ã€‚</p><blockquote><p>æœ¬æ–‡ç”± SwiftGG ç¿»è¯‘ç»„ç¿»è¯‘ï¼Œå·²ç»è·å¾—ä½œè€…ç¿»è¯‘æˆæƒï¼Œæœ€æ–°æ–‡ç« è¯·è®¿é—® <a href="http://swift.gg">http://swift.gg</a>ã€‚</p></blockquote>]]></content>
    
    <summary type="html">
    
      æ„å»ºç¬¬ä¸€ä¸ª Swift åŒºå—é“¾åº”ç”¨
    
    </summary>
    
      <category term="AppCoda" scheme="https://swift.gg/categories/AppCoda/"/>
    
    
      <category term="Swift" scheme="https://swift.gg/tags/Swift/"/>
    
      <category term="åŒºå—é“¾" scheme="https://swift.gg/tags/%E5%8C%BA%E5%9D%97%E9%93%BE/"/>
    
  </entry>
  
  <entry>
    <title>åœ¨ Swift ä¸­ä½¿ç”¨ Watch Connectivity â€” Application Context</title>
    <link href="https://swift.gg/2018/08/15/watch-connectivity-swift-application-context/"/>
    <id>https://swift.gg/2018/08/15/watch-connectivity-swift-application-context/</id>
    <published>2018-08-15T00:00:00.000Z</published>
    <updated>2019-02-18T08:52:03.568Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ä½œè€…ï¼šcodingexplorerï¼Œ<a href="http://www.codingexplorer.com/watch-connectivity-swift-application-context/" target="_blank" rel="noopener">åŸæ–‡é“¾æ¥</a>ï¼ŒåŸæ–‡æ—¥æœŸï¼š2018-07-18<br>è¯‘è€…ï¼š<a href="http://khala-wan.com" target="_blank" rel="noopener">Khala-wan</a>ï¼›æ ¡å¯¹ï¼š<a href="http://blog.yousanflics.com.cn" target="_blank" rel="noopener">Yousanflics</a>ï¼Œ<a href="undefined">wongzigii</a>ï¼›å®šç¨¿ï¼š<a href="https://github.com/chenmingbiao" target="_blank" rel="noopener">CMB</a></p></blockquote><!--æ­¤å¤„å¼€å§‹æ­£æ–‡--><p><img src="/img/articles/Watch Connectivity in Swift â€” Application Context/Watch-Connectivity-Application-Context.png1534304479.3475852" alt=""></p><p>åœ¨ watchOS 1 æ—¶ä»£ï¼Œ<code>WatchKit Extension</code> ä½äºå·²é…å¯¹çš„ iOS è®¾å¤‡ä¸Šï¼Œè¿™ä½¿å¾—å®¿ä¸» APP å’Œ watch ä¹‹é—´çš„æ•°æ®å…±äº«å˜å¾—ç®€å•ã€‚ç±»ä¼¼åå¥½è®¾ç½®è¿™ç§æœ€ç®€å•çš„æ•°æ®ï¼Œåªéœ€è¦é€šè¿‡ App Groups åŠŸèƒ½æ¥å­˜å– <code>NSUserDefaults</code>ã€‚ç›®å‰åœ¨æ‰‹æœºä¸Šç•™å­˜çš„å…¶ä»–æ‰©å±•ç¨‹åºå’Œä¸» app ä¹‹é—´å…±äº«æ•°æ®ä»ç„¶åº”è¯¥ä½¿ç”¨è¿™ç§æ–¹å¼ï¼Œä¾‹å¦‚ <code>Today View Extension</code>ï¼Œä½†å®ƒå·²ä¸å†é€‚ç”¨äº watchOS çš„ appã€‚<br>å¹¸è¿çš„æ˜¯ï¼Œè‹¹æœä¸ºæˆ‘ä»¬æä¾›äº†æ–°çš„ API æ¥åšè¿™ä»¶äº‹ã€‚ç›¸æ¯” App Groupsï¼ŒWatch Connectivity æ‹¥æœ‰æ›´å¼ºå¤§çš„åŠŸèƒ½ã€‚å®ƒä¸ä»…æä¾›äº†ä½ çš„ Apple Watch å’Œä¸å…¶é…å¯¹ iPhone ä¹‹é—´è¿æ¥çŠ¶æ€çš„æ›´å¤šä¿¡æ¯ï¼Œè¿˜å…è®¸å®ƒä»¬ä¹‹é—´è¿›è¡Œäº¤äº’æ¶ˆæ¯å’Œ 3 ç§æ–¹å¼çš„åå°ä¼ è¾“ï¼Œè¿™äº›æ–¹å¼åˆ†åˆ«æ˜¯ï¼š</p><ol><li>Application Context</li><li>User Info Transfer</li><li>File Transfer</li></ol><p>æˆ‘ä»¬ä»Šå¤©å…ˆè®¨è®ºç¬¬ä¸€ç§æ–¹å¼ï¼šApplication Contextã€‚</p><a id="more"></a><h2 id="ä»€ä¹ˆæ˜¯-Application-Context"><a href="#ä»€ä¹ˆæ˜¯-Application-Context" class="headerlink" title="ä»€ä¹ˆæ˜¯ Application Context"></a>ä»€ä¹ˆæ˜¯ Application Context</h2><p>å‡è®¾ä½ æœ‰ä¸ª watch appï¼Œå®ƒæœ‰ä¸€äº›å¯ä»¥åœ¨ iOS app ç«¯è®¾ç½®çš„è®¾ç½®é¡¹ï¼Œæ¯”å¦‚æ¸©åº¦çš„æ˜¾ç¤ºå•ä½æ˜¯æ‘„æ°åº¦è¿˜æ˜¯åæ°åº¦ã€‚å¯¹äºè¿™æ ·çš„è®¾ç½®é¡¹ï¼Œé™¤éä½ å¸Œæœ›åœ¨ç”¨æˆ·åœ¨è®¾ç½®å®Œæˆä¹‹åç«‹å³ä½¿ç”¨ watch ä¸Šçš„ appï¼Œå¦åˆ™å°†è®¾ç½®é¡¹çš„ä¿¡æ¯é€šè¿‡åå°ä¼ è¾“å‘é€åˆ° watch æ‰ä¼šæ˜¯æ¯”è¾ƒåˆç†çš„ã€‚</p><p>å› ä¸ºå®ƒå¯èƒ½ä¸æ˜¯ç«‹å³éœ€è¦çš„ï¼Œæ‰€ä»¥ç³»ç»Ÿå¯èƒ½ä¼šåœ¨èŠ‚çœç”µé‡æœ€å¤šçš„æƒ…å†µä¸‹å°†å…¶å‘é€å‡ºå»ã€‚ä½ ä¹Ÿä¸éœ€è¦ä»»ä½•å†å²è®°å½•ï¼Œå› ä¸ºç”¨æˆ·å¯èƒ½å¹¶ä¸å…³å¿ƒä¸€å°æ—¶ä¹‹å‰çš„è®¾ç½®æ˜¯æ‘„æ°åº¦ã€‚</p><p>è¿™å°±æ˜¯ Application Context çš„ç”¨æ­¦ä¹‹åœ°ã€‚å®ƒä»…ç”¨äºå‘é€æœ€æ–°çš„æ•°æ®ã€‚å¦‚æœä½ å°†æ¸©åº¦è®¾ç½®é¡¹ä»æ‘„æ°åº¦æ”¹ä¸ºåæ°åº¦ï¼Œç„¶ååœ¨ Application Context å‘é€åˆ° watch ä¹‹å‰å†å°†å®ƒï¼ˆæˆ–è€…å…¶ä»–è®¾ç½®é¡¹ï¼‰è®¾ç½®ä¸ºä¸åŒçš„å€¼ï¼Œé‚£ä¹ˆæœ€æ–°çš„å€¼ä¼šè¦†ç›–ä¹‹å‰ç­‰å¾…å‘é€çš„ä¿¡æ¯ã€‚</p><p>å¦‚æœä½ ç¡®å®å¸Œæœ›å®ƒèƒ½ä¿å­˜å…ˆå‰ä¿¡æ¯çš„å†å²è®°å½•ï¼Œè€Œä¸”æ˜¯ä»¥æœ€çœç”µçš„æ–¹å¼ä¼ è¾“ã€‚é‚£ä¹ˆå¯ä»¥ä½¿ç”¨ <code>User Info</code> æ–¹å¼è¿›è¡Œä¼ è¾“ã€‚å®ƒçš„ä½¿ç”¨æ–¹å¼å’Œ Application Context å¾ˆç›¸ä¼¼ï¼Œä½†å®ƒä¼šå°†æ›´æ–°æ“ä½œåŠ å…¥åˆ°ä¸€ä¸ªé˜Ÿåˆ—ä¸­å¹¶é€ä¸€å‘é€ï¼ˆè€Œä¸æ˜¯ä»…ä»…è¦†ç›–æŸäº›å†…å®¹åªå‘é€æœ€æ–°çš„ä¿¡æ¯ï¼‰ã€‚å…·ä½“ <code>User Info</code> çš„ä½¿ç”¨å°†ä½œä¸ºä»¥åå¦ä¸€ç¯‡æ–‡ç« çš„ä¸»é¢˜æ¥è®²ã€‚</p><h2 id="è®¾ç½®-iOS-åº”ç”¨ç¨‹åº"><a href="#è®¾ç½®-iOS-åº”ç”¨ç¨‹åº" class="headerlink" title="è®¾ç½® iOS åº”ç”¨ç¨‹åº"></a>è®¾ç½® iOS åº”ç”¨ç¨‹åº</h2><p>æˆ‘ä»¬å°†ä»ä¸€ä¸ªç±»ä¼¼äºä¸Šä¸€ç¯‡æ–‡ç«  <a href="http://www.codingexplorer.com/watchos-2-hello-world-app-in-swift/" target="_blank" rel="noopener">watchOS Hello World App in Swift</a> ä¸­çš„ app è¯´èµ·ã€‚ä¸è¿‡åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†åœ¨è¿™ä¸ª iPhone app ä¸ŠåŠ å…¥ä¸€ä¸ª <code>UISwitch</code> æ§ä»¶ï¼Œå¹¶é€šè¿‡æ›´æ–° watchOS app ä¸Šçš„ WKInterfaceLabel æ¥è¯´æ˜ <code>UISwitch</code> çš„çŠ¶æ€ã€‚</p><p>é¦–å…ˆï¼Œåœ¨ iOS app çš„ <code>viewController</code> ä¸­ï¼Œæˆ‘ä»¬éœ€è¦è®¾ç½®ä¸€äº›ä¸œè¥¿ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> WatchConnectivity</span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewController</span>: <span class="title">UIViewController</span>, <span class="title">WCSessionDelegate</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">session</span><span class="params">(<span class="number">_</span> session: WCSession, activationDidCompleteWith activationState: WCSessionActivationState, error: Error?)</span></span> &#123; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">sessionDidBecomeInactive</span><span class="params">(<span class="number">_</span> session: WCSession)</span></span> &#123; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">sessionDidDeactivate</span><span class="params">(<span class="number">_</span> session: WCSession)</span></span> &#123; &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> session: <span class="type">WCSession</span>?</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.viewDidLoad()</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> <span class="type">WCSession</span>.isSupported() &#123;</span><br><span class="line">            session = <span class="type">WCSession</span>.<span class="keyword">default</span></span><br><span class="line">            session?.delegate = <span class="keyword">self</span></span><br><span class="line">            session?.activate()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸‹é¢ï¼Œæˆ‘ä»¬æœ€å…ˆéœ€è¦å¯¼å…¥ <code>WatchConnectivity</code> æ¡†æ¶ã€‚æ²¡æœ‰å®ƒï¼Œæˆ‘ä»¬æ‰€åšçš„éƒ½æ˜¯æ— ç”¨åŠŸã€‚æ¥ä¸‹æ¥ï¼Œä¸ºäº†å“åº”æ¥è‡ª WCSession çš„å›è°ƒï¼Œæˆ‘ä»¬éœ€è¦å°†å½“å‰è¿™ä¸ª <code>ViewController</code> è®¾ç½®ä¸º <code>WCSession</code> çš„ä»£ç†ï¼Œä¸ºæ­¤æˆ‘ä»¬éœ€è¦è®©å®ƒéµå®ˆè¿™ä¸ªåè®®ï¼Œæ‰€ä»¥åœ¨ <code>ViewController</code> çš„çˆ¶ç±»å£°æ˜åé¢æ·»åŠ  <code>WCSessionDelegate</code> åè®®ã€‚</p><p>ä¸‹ä¸€æ­¥ï¼Œæˆ‘ä»¬éœ€è¦å®ç° <code>WCSessionDelegate</code> ä¸­çš„ä¸€äº›æ–¹æ³•ã€‚å¯¹äºå½“å‰è¿™ä¸ª appï¼Œå®ƒä»¬ä¸æ˜¯ç‰¹åˆ«å¿…è¦ï¼Œä½†æ˜¯å¦‚æœæƒ³è¦å¿«é€Ÿåœ¨ watch app ä¸­åˆ‡æ¢ï¼Œä½ å°±éœ€è¦è¿›ä¸€æ­¥å®ç°å®ƒä»¬ã€‚</p><p>ä¹‹åï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªå˜é‡ç”¨äºå­˜å‚¨ <code>WCSession</code>ã€‚å› ä¸º <code>WCSession</code> å®é™…ä¸Šæ˜¯ä¸€ä¸ªå•ä¾‹ï¼ŒæŠ€æœ¯ä¸Šæˆ‘ä»¬å¯ä»¥è·³è¿‡è¿™ä¸€æ­¥ï¼Œä½†æ¯æ¬¡è¾“å…¥ <code>session?</code> è‚¯å®šè¦æ¯” <code>WCSession.default</code> æ›´ç®€çŸ­ã€‚</p><p>ä½ åº”è¯¥åœ¨ä»£ç è¿è¡ŒåˆæœŸå¯¹ session è¿›è¡Œè®¾ç½®ã€‚åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œè¿™å°†åœ¨ç¨‹åºåˆå§‹åŒ–çš„æ—¶å€™æ¥åšã€‚ä½†ç”±äºæˆ‘ä»¬æ˜¯åœ¨ <code>ViewController</code> ä¸­æ‰§è¡Œæ­¤æ“ä½œï¼Œæ‰€ä»¥æœ€æ—©èƒ½æ‰§è¡Œçš„åœ°æ–¹å¤§æ¦‚å°±åªæœ‰ <code>viewDidLoad</code> æ–¹æ³•ä¸­äº†ã€‚ä¸€èˆ¬æƒ…å†µä¸‹æ¥è¯´ï¼Œä½ ä¸åº”è¯¥åœ¨ <code>viewController</code> ä¸­æ‰§è¡Œè¿™ä¸ªæ“ä½œï¼Œå› ä¸ºä½ çš„ app å¸Œæœ›åœ¨å±å¹•ä¸ŠæœªåŠ è½½ç‰¹å®š <code>viewController</code> æ—¶å°±å¯ä»¥æ›´æ–°å®ƒçš„æ•°æ®æ¨¡å‹ã€‚ä¸ºäº†ç®€å•èµ·è§ï¼Œæˆ‘åœ¨ <code>viewController</code> ä¸­åšäº†è¿™ä¸ªæ“ä½œï¼Œè¿™ä»…ä»…æ˜¯ä¸ºäº†å±•ç¤ºå¦‚ä½•ä½¿ç”¨è¿™äº› APIã€‚å¦‚æœè¿™ä¸ª <code>ViewController</code> æ˜¯å”¯ä¸€å…³å¿ƒä½¿ç”¨ <code>WCSession</code> çš„ä¸œè¥¿ï¼Œé‚£å°±æ²¡å…³ç³»ã€‚ä½†é€šå¸¸æƒ…å†µå¹¶éå¦‚æ­¤ã€‚</p><p>è¦è®¾ç½® sessionï¼Œæˆ‘ä»¬éœ€è¦å…ˆæ ¹æ® <code>WCSession</code> çš„ <code>isSupport</code> æ–¹æ³•çš„è¿”å›å€¼æ¥æ£€æŸ¥æ˜¯å¦æ”¯æŒã€‚å¦‚æœç¨‹åºåœ¨ iPad ä¸Šè¿è¡Œçš„è¯ï¼Œè¿™ä¸€ç‚¹å°¤ä¸ºé‡è¦ã€‚ç›®å‰ï¼Œä½ æ— æ³•å°† iPad ä¸ Apple Watch é…å¯¹ï¼Œå› æ­¤å®ƒä¼šè¿”å› <code>false</code> è¡¨ç¤ºä¸æ”¯æŒåœ¨ iPad ä¸Šä½¿ç”¨ <code>WCSession</code>ã€‚åœ¨ iPhone ä¸Šå®ƒä¼šè¿”å› <code>true</code>ã€‚</p><p>ä¸€æ—¦æˆ‘ä»¬å®Œæˆæ£€æŸ¥ï¼Œå°±å¯ä»¥å°† WCSession çš„ defaultSession å­˜å‚¨åœ¨é‚£é‡Œï¼Œæ¥ç€å°†è¿™ä¸ª <code>ViewController</code> è®¾ç½®ä¸ºå®ƒçš„ä»£ç†å¹¶æ¿€æ´» sessionã€‚å¦‚æœæˆ‘ä»¬å¯ä»¥åœ¨åˆå§‹åŒ–ç¨‹åºä¸­æ‰§è¡Œ <code>isSupported</code> æ¥æµ‹è¯•æ˜¯å¦æ”¯æŒï¼Œå°±å¯ä»¥æŠŠ session ç”¨ä½œä¸€ä¸ªå¸¸é‡ã€‚è€Œè¿™é‡Œçš„ session æ˜¯ä¸€ä¸ªå¯é€‰å€¼æ˜¯å› ä¸ºæˆ‘ä»¬ä¸çŸ¥é“ç¨‹åºæ˜¯å¦ä¼šè¿è¡Œåœ¨ <code>iPad</code> ä¸Šï¼Œæ‰€ä»¥å½“æ”¯æŒ <code>WCSession</code> æ—¶ï¼Œsession çš„å€¼ä¸º <code>WCSession.defualt</code>ï¼Œåä¹‹åˆ™ä¸º <code>nil</code>ã€‚è¿™æ ·ï¼Œå½“æˆ‘ä»¬åœ¨ <code>iPad</code> ä¸Šå°è¯•è®¿é—® session ä¸­çš„å±æ€§æˆ–æ–¹æ³•æ—¶ï¼Œå®ƒä»¬ç”šè‡³ä¸ä¼šæ‰§è¡Œï¼Œå› ä¸º session ä¸º <code>nil</code>ã€‚</p><p>å°†ä¸€ä¸ª <code>UISwitch</code> æ”¾åœ¨ Storyboard ä¸Šï¼Œå¹¶å°†å…¶ <code>ValueChanged</code> æ–¹æ³•å…³è”åˆ° <code>ViewController</code> ä¸­ã€‚<br>åœ¨æ–¹æ³•ä¸­åŠ å…¥å¦‚ä¸‹ä»£ç ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="meta">@IBAction</span> <span class="function"><span class="keyword">func</span> <span class="title">switchValueChanged</span><span class="params">(<span class="number">_</span> sender: UISwitch)</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> validSession = session &#123;</span><br><span class="line">        <span class="keyword">let</span> iPhoneAppContext = [<span class="string">"switchStatus"</span>: sender.isOn]</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            <span class="keyword">try</span> validSession.updateApplicationContext(iPhoneAppContext)</span><br><span class="line">        &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"Something went wrong"</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é¦–å…ˆæ£€æŸ¥æˆ‘ä»¬æ˜¯å¦æœ‰ä¸€ä¸ªæœ‰æ•ˆçš„ sessionï¼Œå¦‚æœæ˜¯è¿è¡Œåœ¨ iPad ä¸Šï¼Œé‚£ä¹ˆå°†è·³è¿‡æ•´ä¸ªä»£ç å—ã€‚ <code>Application Context</code> æ˜¯ä¸€ä¸ª Swift å­—å…¸ï¼Œå®ƒä»¥ <code>String</code> ä½œä¸º <code>key</code>ï¼Œ<code>AnyObject</code> ä½œä¸º <code>value</code> (<code>Dictionary&lt;String, AnyObject&gt;</code>)ã€‚ value å¿…é¡»éµå¾ªå±æ€§åˆ—è¡¨çš„è§„åˆ™ï¼Œå¹¶ä¸”åªåŒ…å«æŸäº›ç±»å‹ã€‚å®ƒå’Œ <code>NSUserDefaults</code> å…·æœ‰ç›¸åŒçš„é™åˆ¶ï¼Œæ‰€ä»¥åœ¨ä¸Šä¸€ç¯‡æ–‡ç«  <a href="http://www.codingexplorer.com/nsuserdefaults-a-swift-introduction/" target="_blank" rel="noopener">NSUserDefaults â€” A Swift Introduction</a> ä¸­å·²ç»ä»‹ç»è¿‡äº†å…·ä½“å¯ä»¥ä½¿ç”¨å“ªäº›ç±»å‹ã€‚å°½ç®¡å¦‚æ­¤ï¼Œå½“æˆ‘ä»¬å‘é€ä¸€ä¸ª Swift <code>Bool</code> ç±»å‹æ—¶ï¼Œå…¶å°†ä¼šè¢«è½¬æ¢ä¸º <code>NSNumber boolean value</code>ï¼Œæ‰€ä»¥æ²¡å…³ç³»ã€‚</p><p>è°ƒç”¨ <code>updateApplicationContext</code> å¯èƒ½ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å°†å®ƒåŒ…è£…åœ¨ <code>do-block</code> ä¸­å¹¶é€šè¿‡ <code>try</code> æ¥è°ƒç”¨ã€‚å¦‚æœå‡ºç°å¼‚å¸¸ï¼Œæˆ‘ä»¬åªæ˜¯åœ¨æ§åˆ¶å°ä¸Šæ‰“å°äº†ä¸€äº›ä¿¡æ¯ï¼Œä½ è¿˜å¯ä»¥è®¾ç½®ä»»ä½•ä½ éœ€è¦çš„ä¸œè¥¿ï¼Œæ¯”å¦‚ä½ å¯èƒ½éœ€è¦è®©ç”¨æˆ·çŸ¥é“å‘ç”Ÿäº†é”™è¯¯ï¼Œé‚£å°±å¯ä»¥æ˜¾ç¤ºä¸€ä¸ª UIAlerControllerï¼ŒåŒæ ·ï¼Œå¦‚æœæœ‰å¿…è¦å¯ä»¥åŠ å…¥å¼‚å¸¸çš„æ¸…ç†æˆ–æ¢å¤ä»£ç ã€‚è¿™å°±æ˜¯ä¸ºäº†å‘é€ <code>Application Context</code>ï¼Œæˆ‘ä»¬æ‰€éœ€è¦çš„å…¨éƒ¨å‡†å¤‡ã€‚</p><h2 id="è®¾ç½®-watchOS-åº”ç”¨ç¨‹åº"><a href="#è®¾ç½®-watchOS-åº”ç”¨ç¨‹åº" class="headerlink" title="è®¾ç½® watchOS åº”ç”¨ç¨‹åº"></a>è®¾ç½® watchOS åº”ç”¨ç¨‹åº</h2><p>å› ä¸ºæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ä¹‹å‰ <a href="http://www.codingexplorer.com/watchos-2-hello-world-app-in-swift/" target="_blank" rel="noopener">watchOS Hello World App in Swift</a> æ–‡ä¸­çš„ Hello World Appï¼Œæ‰€ä»¥éƒ¨åˆ†ç›¸åŒçš„è®¾ç½®å·²ç»æ›¿æˆ‘ä»¬å®Œæˆäº†ã€‚è·Ÿ iPhone ç±»ä¼¼ï¼Œæˆ‘ä»¬è¿˜éœ€è¦åšä¸€äº›è®¾ç½®æ‰èƒ½ä½¿ç”¨ <code>WatchConnectivity</code>ã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> WatchConnectivity</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">InterfaceController</span>: <span class="title">WKInterfaceController</span>, <span class="title">WCSessionDelegate</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">session</span><span class="params">(<span class="number">_</span> session: WCSession, activationDidCompleteWith activationState: WCSessionActivationState, error: Error?)</span></span> &#123; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> session = <span class="type">WCSession</span>.<span class="keyword">default</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">awake</span><span class="params">(withContext context: Any?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.awake(withContext: context)</span><br><span class="line">        </span><br><span class="line">        session.delegate = <span class="keyword">self</span></span><br><span class="line">        session.activate()</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œçœç•¥æ‰äº†ä¹‹å‰ App ä¸­çš„ä¸€äº›æ— å…³ä»£ç ï¼Œåªå±•ç¤ºä¸ <code>WatchConnectivity</code> è®¾ç½®ç›¸å…³çš„éƒ¨åˆ†ã€‚åŒæ ·ï¼Œæˆ‘ä»¬éœ€è¦å¯¼å…¥ <code>WatchConnectivity</code> æ¡†æ¶ï¼Œå¹¶è®©æˆ‘ä»¬çš„ InterfaceController éµå®ˆ WCSessionDelegate åè®®ï¼Œç´§æ¥ç€ï¼Œæˆ‘ä»¬å°† session å¸¸é‡åˆå§‹åŒ–ä¸º <code>WCSession</code> çš„å•ä¾‹ <code>defaultSession</code>ã€‚</p><p>ä¸ iOS ç«¯ä¸åŒçš„æ˜¯ï¼Œè¿™é‡Œæˆ‘ä»¬å°† session å£°æ˜ä¸ºä¸€ä¸ªéå¯é€‰å€¼çš„å¸¸é‡ã€‚å¾ˆæ˜¾ç„¶ï¼Œè¿è¡Œåœ¨ä¸ä½äº <code>watchOS 2</code> ç³»ç»Ÿä¸Šçš„ Apple Watch æ˜¯æ”¯æŒ <code>Watch Connectivity</code> çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸éœ€è¦åœ¨ <code>watchOS</code> ç«¯è¿›è¡Œç›¸åŒçš„æµ‹è¯•ã€‚ å¹¶ä¸”æˆ‘ä»¬åœ¨å£°æ˜æ—¶å°±åˆå§‹åŒ–äº†å®ƒï¼Œåˆæ²¡æœ‰å…¶ä»–å¹³å°ï¼ˆå¦‚iPadï¼‰éœ€è¦æ‹…å¿ƒï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸éœ€è¦å®ƒæ˜¯å¯é€‰çš„ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œåœ¨ä»£ç çš„åˆæœŸï¼Œæˆ‘ä»¬éœ€è¦è®¾ç½® sessionã€‚åœ¨ InterfaceController ä¸­ awakeWithContext æ–¹æ³•æ˜¯ä¸ªå¾ˆå¥½çš„åœ°æ–¹ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨è¿™é‡Œåšç›¸å…³è®¾ç½®ã€‚å’Œ iOS App ä¸€æ ·ï¼Œæˆ‘ä»¬è®¾ç½®å½“å‰ç±»ä½œä¸º session çš„ä»£ç†ï¼Œç„¶åæ¿€æ´» sessionã€‚</p><p>è®©æˆ‘ä»¬å†™ä¸€ä¸ªè¾…åŠ©æ–¹æ³•æ¥å¤„ç† Application Context çš„å›è°ƒï¼Œå› ä¸ºæˆ‘ä»¬å¯èƒ½ä¼šå¤šæ¬¡è°ƒç”¨å®ƒï¼Œè€Œä¸æ˜¯ä»…ä»…å½“æˆ‘ä»¬æ”¶åˆ°ä¸€ä¸ªæ–° <code>context</code> æ—¶ï¼ˆä½ å¾ˆå¿«ä¼šçœ‹åˆ°ï¼‰ã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">processApplicationContext</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> iPhoneContext = session.receivedApplicationContext <span class="keyword">as</span>? [<span class="type">String</span> : <span class="type">Bool</span>] &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> iPhoneContext[<span class="string">"switchStatus"</span>] == <span class="literal">true</span> &#123;</span><br><span class="line">            displayLabel.setText(<span class="string">"Switch On"</span>)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            displayLabel.setText(<span class="string">"Switch Off"</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>WCSession</code> æœ‰ 2 ä¸ªä¸ <code>Application Context</code> ç›¸å…³çš„å±æ€§ï¼Œ<code>applicationContext</code> å’Œ <code>receivedApplicationContext</code>ã€‚å®ƒä»¬çš„ä¸åŒä¹‹å¤„æ˜¯ï¼š</p><ul><li>applicationContext - æ­¤è®¾å¤‡æœ€è¿‘ä¸€æ¬¡<strong>å‘é€</strong>çš„ <code>Application Context</code>ã€‚</li><li>receivedApplicationContext - æ­¤è®¾å¤‡æœ€è¿‘ä¸€æ¬¡<strong>æ¥æ”¶</strong>çš„ <code>Application Context</code>ã€‚</li></ul><p>ç°åœ¨ï¼ŒæŠŠå®ƒä¿©æ”¾åˆ°ä¸€èµ·æ¥çœ‹ï¼Œè‡³å°‘æ¥æ”¶åˆ°çš„çœ‹èµ·æ¥å¾ˆæ˜æ˜¾ã€‚ä½†åœ¨æˆ‘ç¬¬ä¸€æ¬¡æ¶‰åŠè¿™ä¸ªæ—¶ï¼ˆä¸è®°å¾— WWDC ä¸­ Watch Connectivityçš„ä»‹ç»è§†é¢‘çš„å…¨éƒ¨å†…å®¹ï¼Ÿï¼‰ï¼Œæˆ‘è®¤ä¸º applicationContext æ˜¯ä»æœ€è¿‘çš„å‘é€æˆ–æ¥æ”¶æ¥æ›´æ–°çš„ï¼Œå› ä¸ºæˆ‘è®¤ä¸ºå®ƒä»¬æ˜¯ä¸€è‡´çš„ <code>context</code>ã€‚ç„¶è€Œæˆ‘å¤§é”™ç‰¹é”™ï¼Œæˆ‘èŠ±äº†ä¸€æ®µæ—¶é—´æ‰æ„è¯†åˆ°å®ƒä»¬æ˜¯åˆ†å¼€çš„ã€‚æˆ‘å½“ç„¶èƒ½çœ‹å‡ºæ¥åŸå› ï¼Œå› ä¸ºæˆ‘ä»¬å¯èƒ½æ¯æ¬¡éƒ½ä¼šå‘é€ä¸ä¸€æ ·çš„æ•°æ®ï¼Œå°±åƒä» Watch çš„è§’åº¦æ¥çœ‹ï¼ŒapplicationContext å°±æ˜¯ iPhone ç«¯éœ€è¦çš„ Watch ç›¸å…³ <code>context</code>ï¼Œè€Œ receivedApplicationContext åˆ™æ˜¯ Watch ç«¯éœ€è¦çš„ iPhone ç›¸å…³ <code>context</code>ã€‚æ— è®ºå“ªç§æ–¹å¼ï¼Œè¯·è®°ä½å®ƒä»¬æ˜¯ä¸åŒçš„ä¸¤ä¸ªä¸œè¥¿ï¼Œå¹¶æ ¹æ®å®é™…æƒ…å†µé€‰æ‹©ä½ æ‰€éœ€è¦çš„é‚£ä¸ªã€‚</p><p>æ‰€ä»¥åœ¨è¿™ä¸ªæ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆå°è¯•å°† <code>receivedApplicationContext</code> ç”± <code>[String: AnyObject]</code> ç±»å‹çš„å­—å…¸è½¬æ¢ä¸ºæˆ‘ä»¬éœ€è¦çš„ <code>[String: Bool]</code> ç±»å‹ã€‚å¦‚æœè½¬æ¢æˆåŠŸï¼Œåˆ™å†æ ¹æ®å­—å…¸ä¸­å¸ƒå°”å€¼çš„çŠ¶æ€å°† displayLabel çš„ text å€¼è®¾ç½®ä¸º â€œSwitch Onâ€ æˆ– â€œSwitch Offâ€ã€‚</p><p>å½“æˆ‘ä»¬å®é™…æ¥æ”¶åˆ°ä¸€ä¸ªæ–°çš„  Application context æ—¶ï¼Œè¯¥ InterfaceController å°†ä¼šæ”¶åˆ°æˆ‘ä»¬ WCSession å¯¹è±¡çš„ä»£ç†å›è°ƒæ¥é€šçŸ¥æˆ‘ä»¬è¿™ä¸ªä¿¡æ¯ï¼Œæˆ‘ä»¬å°†åœ¨é‚£é‡Œè°ƒç”¨è¿™ä¸ªè¾…åŠ©æ–¹æ³•ã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">session</span><span class="params">(<span class="number">_</span> session: WCSession, didReceiveApplicationContext applicationContext: [String : Any])</span></span> &#123;</span><br><span class="line">    <span class="type">DispatchQueue</span>.main.async() &#123;</span><br><span class="line">        <span class="keyword">self</span>.processApplicationContext()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç°åœ¨ï¼Œä½ å¤§æ¦‚çœ‹åˆ°äº† <code>didReceiveApplicationContext</code> æ–¹æ³•çš„å…¥å‚å¸¦æœ‰å®ƒæ¥æ”¶åˆ°çš„ <code>Application Context</code> å‰¯æœ¬ã€‚å®ƒå­˜å‚¨åœ¨ä¸Šé¢æåˆ°çš„ <code>receivedApplicationContext</code> å±æ€§ä¸­ã€‚æ‰€ä»¥æˆ‘ä»¬å¹¶ä¸éœ€è¦å®ƒæ¥è°ƒç”¨è¾…åŠ©æ–¹æ³•, å› æ­¤è¿™ä¸ªæ–¹æ³•ä¸éœ€è¦ä¼ å…¥ä»»ä½•è¡Œå‚ã€‚</p><blockquote><p>è¯‘è€…æ³¨ï¼š<br>å…¶å®å¯¹äºè¾…åŠ©æ–¹æ³• <code>processApplicationContext</code> æ¥è¯´ï¼Œå¢åŠ è¡Œå‚ context åè€Œæ›´ <strong>å‡½æ•°å¼</strong>ï¼Œä¹Ÿæ›´ <strong>Swift</strong>ã€‚ é€šè¿‡å¢åŠ ä¸€ä¸ª context çš„å…¥å‚ï¼Œå¯ä»¥è®©æ–¹æ³•å†…éƒ¨å®ç°å’Œå¤–éƒ¨ä¾èµ–è§£è€¦ï¼Œæ›´åŠ æ–¹ä¾¿æˆ‘ä»¬å¯¹å®ƒè¿›è¡Œå•å…ƒæµ‹è¯•ã€‚</p></blockquote><p>é‚£ä¹ˆï¼Œè°ƒç”¨ <code>dispatch_async</code> æ˜¯ä¸ºäº†åšä»€ä¹ˆå‘¢ï¼Ÿå¥½å§ï¼Œè¿™äº›ä»£ç†å›è°ƒä¸åœ¨ä¸»çº¿ç¨‹ä¸Šã€‚ä½ æ°¸è¿œä¸åº”è¯¥åœ¨é™¤ä¸»çº¿ç¨‹ä»¥å¤–çš„ä»»ä½•çº¿ç¨‹æ›´æ–° iOS æˆ– watchOS ä¸­çš„ UIã€‚è€Œæˆ‘ä»¬çš„è¾…åŠ©æ–¹æ³•é™¤äº†ä» <code>receivedApplicationContext</code> ä¸­è¯»å–ä¿¡æ¯ä¹‹å¤–ï¼Œä¸»è¦ç›®çš„æ˜¯ç”¨æ¥æ›´æ–° UI å…ƒç´ ã€‚å› æ­¤ï¼Œæˆ‘ä»¬è¦é€šè¿‡ <code>dispatch_async</code> æ–¹æ³•è¿”å›ä¸»çº¿ç¨‹æ¥è°ƒç”¨è¯¥æ–¹æ³•ã€‚è°ƒç”¨ <code>dispatch_async</code> éœ€è¦ 2 ä¸ªå‚æ•°ï¼Œé¦–å…ˆæ˜¯æ´¾å‘é˜Ÿåˆ—ï¼ˆå¯¹äºä¸»çº¿ç¨‹ï¼Œæˆ‘ä»¬é€šè¿‡ <code>dispatch_get_main_queue</code> æ–¹æ³•è·å–ï¼‰ï¼Œå…¶æ¬¡æ˜¯ä¸€ä¸ªé—­åŒ…æ¥å‘Šè¯‰å®ƒéœ€è¦åšä»€ä¹ˆæ“ä½œï¼Œè¿™é‡Œæˆ‘ä»¬åªæ˜¯å‘Šè¯‰å®ƒå»è°ƒç”¨è¾…åŠ©æ–¹æ³•ã€‚</p><p>æ‰€ä»¥ï¼Œä¸ºä»€ä¹ˆæˆ‘ä»¬è¦åœ¨è¾…åŠ©æ–¹æ³•é‡Œè¿™æ ·åšï¼Œè€Œä¸æ˜¯ç›´æ¥åœ¨å›è°ƒæ–¹æ³•é‡Œé¢ç›´æ¥å¤„ç†å‘¢ï¼Ÿå¥½å§ï¼Œå½“ä½ å®é™…æ¥æ”¶åˆ°ä¸€ä¸ªæ–°çš„ <code>Application Context</code> æ—¶ï¼Œä¼šå›è°ƒ <code>didReceiveApplicationContext</code> ä»£ç†æ–¹æ³•ã€‚å½“ <code>WCSession</code> åœ¨å…³é—­æ—¶æ¥æ”¶åˆ°æ–°çš„ <code>ApplicationContext</code> ä¼šè°ƒç”¨ activateSession æ–¹æ³•ï¼Œåœ¨é‚£ä¸ä¹…ä¹‹åä¹Ÿä¼šå›è°ƒåˆ° <code>didReceiveApplicationContext</code> æ–¹æ³•ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä½¿ç”¨æ­¤ ApplicationContext ä½œä¸ºè¯¥ä¿¡æ¯çš„åå¤‡å­˜å‚¨ã€‚æˆ‘ä¸ç¡®å®šè¿™æ˜¯ä¸æ˜¯ä¸€ä¸ªå¥½çš„ä¸»æ„ï¼Œä½†æ˜¯å¯¹äºä¸€ä¸ªç®€å•çš„ app æ¥è¯´ï¼Œè¿™æ˜¯åˆç†çš„ï¼Œ å› ä¸º <code>label</code> çš„é‡ç‚¹æ˜¯æ˜¾ç¤º iPhone ä¸Šçš„ <code>UISwitch</code> æ˜¯å¼€å¯è¿˜æ˜¯å…³é—­ã€‚</p><p>é‚£ä¹ˆï¼Œå½“æˆ‘ä»¬çš„ app å®ŒæˆåŠ è½½ä¹‹åæƒ³ä½¿ç”¨æœ€åä¸€æ¬¡æ¥æ”¶åˆ°çš„å€¼ï¼Œä½†æ˜¯ app åœ¨å…³é—­æœŸé—´åˆæ²¡æœ‰æ”¶åˆ°æ–°çš„ <code>context</code>ï¼Œè¿™ç§æƒ…å†µè¯¥æ€ä¹ˆåŠï¼Ÿæˆ‘ä»¬åœ¨è§†å›¾ç”Ÿå‘½å‘¨æœŸçš„æ—©æœŸè®¾ç½® labelï¼Œæ‰€ä»¥ç°åœ¨ <code>awakeWithContext</code> çœ‹èµ·æ¥åº”è¯¥æ˜¯è¿™æ ·ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">awake</span><span class="params">(withContext context: Any?)</span></span> &#123;</span><br><span class="line">    <span class="keyword">super</span>.awake(withContext: context)</span><br><span class="line"> </span><br><span class="line">    processApplicationContext()</span><br><span class="line"> </span><br><span class="line">    session.delegate = <span class="keyword">self</span></span><br><span class="line">    session.activate()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç”±äº awakeWithContext è‚¯å®šåœ¨ä¸»çº¿ç¨‹ä¸Šï¼Œæˆ‘ä»¬ä¸éœ€è¦ <code>dispatch_async</code>ã€‚ å› æ­¤è¿™å°±æ˜¯å®ƒä»…ç”¨äºåœ¨ didReceiveApplicationContext å›è°ƒä¸­æ¥è°ƒç”¨è¾…åŠ©æ–¹æ³•è€Œä¸æ˜¯åœ¨è¾…åŠ©æ–¹æ³•å†…éƒ¨ä½¿ç”¨çš„åŸå› ã€‚</p><p>æ­¤æ—¶ iOS App å¹¶æ²¡æœ‰ä¿ç•™è¯¥ <code>UISwitch</code> çš„çŠ¶æ€ï¼Œæ‰€ä»¥åœ¨å¯åŠ¨æ—¶ä¿æŒå®ƒä»¬çš„åŒæ­¥å¹¶ä¸é‚£ä¹ˆé‡è¦ï¼Œå¯¹äºä¸€ä¸ªæœ‰ä»·å€¼çš„ app æ¥è¯´ï¼Œæˆ‘ä»¬åº”è¯¥å°† UISwitch çš„çŠ¶æ€å­˜å‚¨åœ¨æŸä¸ªåœ°æ–¹ã€‚æ¯”å¦‚å¯ä»¥åœ¨ iPhone ç«¯ä½¿ç”¨ WCSession çš„ ApplicationContext å±æ€§ã€‚ï¼ˆè¯·è®°ä½ï¼ŒapplicationContext æ˜¯ä»è®¾å¤‡<strong>å‘é€</strong>è¿‡æ¥çš„æœ€åä¸€ä¸ª <code>context</code>ï¼‰ï¼Œä½†å¦‚æœæ˜¯åœ¨iPadä¸Šè¿è¡Œå‘¢ï¼Ÿä½ å¯ä»¥å°†å®ƒå­˜å‚¨åœ¨ <code>NSUserDefaults</code>ï¼Œæˆ–è€…å…¶ä»–è®¸å¤šåœ°æ–¹ï¼Œä½†è¿™äº›ä¸åœ¨å¦‚ä½•ä½¿ç”¨ WatchConnectivity çš„è®¨è®ºèŒƒç•´å†…ã€‚å…·ä½“ä½ å¯ä»¥åœ¨æ—©æœŸçš„ <a href="http://www.codingexplorer.com/nsuserdefaults-a-swift-introduction/" target="_blank" rel="noopener">NSUserDefaults â€” A Swift Introduction</a> æ–‡ç« ä¸­äº†è§£åˆ°ã€‚</p><h2 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h2><p>ä»¥ä¸‹æ˜¯è¯¥é¡¹ç›®çš„å®Œæ•´ä»£ç ï¼š</p><h3 id="ViewController-swift"><a href="#ViewController-swift" class="headerlink" title="ViewController.swift"></a>ViewController.swift</h3><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"><span class="keyword">import</span> WatchConnectivity</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewController</span>: <span class="title">UIViewController</span>, <span class="title">WCSessionDelegate</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">session</span><span class="params">(<span class="number">_</span> session: WCSession, activationDidCompleteWith activationState: WCSessionActivationState, error: Error?)</span></span> &#123; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">sessionDidBecomeInactive</span><span class="params">(<span class="number">_</span> session: WCSession)</span></span> &#123; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">sessionDidDeactivate</span><span class="params">(<span class="number">_</span> session: WCSession)</span></span> &#123; &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@IBOutlet</span> <span class="keyword">var</span> theSwitch: <span class="type">UISwitch</span>!</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> session: <span class="type">WCSession</span>?</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.viewDidLoad()</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> <span class="type">WCSession</span>.isSupported() &#123;</span><br><span class="line">            session = <span class="type">WCSession</span>.<span class="keyword">default</span></span><br><span class="line">            session?.delegate = <span class="keyword">self</span></span><br><span class="line">            session?.activate()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">processApplicationContext</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> iPhoneContext = session?.applicationContext <span class="keyword">as</span>? [<span class="type">String</span> : <span class="type">Bool</span>] &#123;</span><br><span class="line">            <span class="keyword">if</span> iPhoneContext[<span class="string">"switchStatus"</span>] == <span class="literal">true</span> &#123;</span><br><span class="line">                theSwitch.isOn = <span class="literal">true</span></span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                theSwitch.isOn = <span class="literal">false</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@IBAction</span> <span class="function"><span class="keyword">func</span> <span class="title">switchValueChanged</span><span class="params">(<span class="number">_</span> sender: UISwitch)</span></span> &#123;</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> validSession = session &#123;</span><br><span class="line">            <span class="keyword">let</span> iPhoneAppContext = [<span class="string">"switchStatus"</span>: sender.isOn]</span><br><span class="line"></span><br><span class="line">            <span class="keyword">do</span> &#123;</span><br><span class="line">                <span class="keyword">try</span> validSession.updateApplicationContext(iPhoneAppContext)</span><br><span class="line">            &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">"Something went wrong"</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="InterfaceController-swift"><a href="#InterfaceController-swift" class="headerlink" title="InterfaceController.swift"></a>InterfaceController.swift</h3><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> WatchKit</span><br><span class="line"><span class="keyword">import</span> WatchConnectivity</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">InterfaceController</span>: <span class="title">WKInterfaceController</span>, <span class="title">WCSessionDelegate</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">session</span><span class="params">(<span class="number">_</span> session: WCSession, activationDidCompleteWith activationState: WCSessionActivationState, error: Error?)</span></span> &#123; &#125;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="meta">@IBOutlet</span> <span class="keyword">var</span> displayLabel: <span class="type">WKInterfaceLabel</span>!</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">let</span> session = <span class="type">WCSession</span>.<span class="keyword">default</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">awake</span><span class="params">(withContext context: Any?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.awake(withContext: context)</span><br><span class="line">        </span><br><span class="line">        processApplicationContext()</span><br><span class="line">        </span><br><span class="line">        session.delegate = <span class="keyword">self</span></span><br><span class="line">        session.activate()</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@IBAction</span> <span class="function"><span class="keyword">func</span> <span class="title">buttonTapped</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="comment">//displayLabel.setText("Hello World!")</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">session</span><span class="params">(<span class="number">_</span> session: WCSession, didReceiveApplicationContext applicationContext: [String : Any])</span></span> &#123;</span><br><span class="line">        <span class="type">DispatchQueue</span>.main.async() &#123;</span><br><span class="line">            <span class="keyword">self</span>.processApplicationContext()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">processApplicationContext</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> iPhoneContext = session.receivedApplicationContext <span class="keyword">as</span>? [<span class="type">String</span> : <span class="type">Bool</span>] &#123;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> iPhoneContext[<span class="string">"switchStatus"</span>] == <span class="literal">true</span> &#123;</span><br><span class="line">                displayLabel.setText(<span class="string">"Switch On"</span>)</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                displayLabel.setText(<span class="string">"Switch Off"</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¯·è®°ä½ï¼Œè¿™äº›ä»£ç æ¥è‡ª Hello World Appï¼Œä½†æ˜¯æˆ‘ä»¬æ²¡æœ‰ç”¨åˆ° watchOS App ä¸Šçš„ buttonã€‚æ‰€ä»¥æˆ‘åªæ˜¯æ³¨é‡Šäº†åŸå§‹åŠŸèƒ½çš„ä»£ç ã€‚</p><h2 id="ç»“è®º"><a href="#ç»“è®º" class="headerlink" title="ç»“è®º"></a>ç»“è®º</h2><p>ä»¥ä¸Šå°±æ˜¯å¦‚ä½•ä½¿ç”¨ Watch Connectivity çš„ Application Context æ–¹å¼è¿›è¡Œåå°ä¼ è¾“çš„æ•™ç¨‹ã€‚å‘æ‰‹æœºç«¯å›ä¼ æ•°æ®ä¹Ÿæ˜¯å®Œå…¨ç›¸åŒçš„ï¼Œå› ä¸ºå®ƒä»¬å…·æœ‰åŒæ ·çš„ä»£ç†å›è°ƒå’Œå±æ€§ã€‚è™½ç„¶åœ¨é‚£ç§æƒ…å†µä¸‹ï¼Œä½ å¯èƒ½è¿˜éœ€è¦æ ¹æ®å®é™…æƒ…å†µæ£€æŸ¥æ˜¯å¦å­˜åœ¨ä¸è¯¥è®¾å¤‡é…å¯¹çš„ Apple Watch æˆ–è€… Watch ä¸Šæ˜¯å¦å®‰è£…äº†å¯¹åº”çš„ appã€‚</p><p>æ­£å¦‚æˆ‘ä¹‹å‰æåˆ°çš„ï¼Œåœ¨ <code>ViewController / InterfaceController</code> ä¸­æ‰§è¡Œæ‰€æœ‰ä»£ç å¯èƒ½ä¸æ˜¯æœ€å¥½çš„ä¸»æ„ï¼Œä½†è¿™åªæ˜¯ä¸ºäº†ç®€å•åœ°å±•ç¤ºå¦‚ä½•ä½¿ç”¨ APIâ€‹â€‹ã€‚æˆ‘ä¸ªäººéå¸¸å–œæ¬¢åœ¨è‡ªå·±çš„ <code>Watch Connectivity manager</code> å®ä¾‹ä¸­æ‰§è¡Œè¿™äº›æ“ä½œã€‚æ‰€ä»¥æˆ‘å¼ºçƒˆå»ºè®®ä½ é˜…è¯» Natasha The Robot çš„æ–‡ç«  <a href="https://www.natashatherobot.com/watchconnectivity-say-hello-to-wcsession/" target="_blank" rel="noopener">WatchConnectivity: Say Hello to WCSession</a>ï¼Œå¹¶å…³è”ä»–çš„ <a href="https://gist.github.com/NatashaTheRobot/6bcbe79afd7e9572edf6" target="_blank" rel="noopener">GitHub Gist</a>ã€‚è¿™å°†å¯¹ä½ ä½¿ç”¨ WatchConnectivity å¾ˆæœ‰å¸®åŠ©ã€‚</p><p>æˆ‘å¸Œæœ›æœ¬æ–‡èƒ½å¯¹ä½ æœ‰æ‰€å¸®åŠ©ã€‚å¦‚æœæœ‰å¸®åˆ°ä½ ï¼Œè¯·ä¸è¦çŠ¹è±«ï¼Œåœ¨ Twitter æˆ–è€…ä½ é€‰æ‹©çš„ç¤¾äº¤åª’ä½“ä¸Šåˆ†äº«è¿™ç¯‡æ–‡ç« ï¼Œæ¯ä¸ªåˆ†äº«å¯¹æˆ‘éƒ½æ˜¯å¸®åŠ©ã€‚å½“ç„¶ï¼Œå¦‚æœä½ æœ‰ä»»ä½•ç–‘é—®ï¼Œè¯·éšæ—¶é€šè¿‡<a href="http://www.codingexplorer.com/contact/" target="_blank" rel="noopener">è”ç³»é¡µé¢</a>æˆ– Twitter <a href="https://twitter.com/CodingExplorer" target="_blank" rel="noopener">@CodingExplorer</a> ä¸æˆ‘è”ç³»ï¼Œæˆ‘ä¼šçœ‹çœ‹æˆ‘èƒ½åšäº›ä»€ä¹ˆã€‚è°¢è°¢ï¼</p><h2 id="æ¥æº"><a href="#æ¥æº" class="headerlink" title="æ¥æº"></a>æ¥æº</h2><ul><li><a href="https://itunes.apple.com/us/book/swift-programming-language/id881256329?mt=11&amp;uo=4&amp;at=10lJ3x&amp;ct=blog-SwiftOperatorOverloading" target="_blank" rel="noopener">The Swift Programming Language â€“ Apple Inc.</a></li><li><a href="https://medium.com/swift-programming/facets-of-swift-part-5-custom-operators-1080bc78ccc" target="_blank" rel="noopener">Facets of Swift, Part 5: Custom Operators â€” Swift Programming â€” Medium</a></li><li><a href="http://www.kristinathai.com/watchos-2-tutorial-using-application-context-to-transfer-data-watch-connectivity-2/" target="_blank" rel="noopener">watchOS 2 Tutorial: Using application context to transfer data (Watch    Connectivity #2)</a> by <a href="https://twitter.com/kristinathai" target="_blank" rel="noopener">Kristina Thai</a></li><li><a href="https://www.natashatherobot.com/watchconnectivity-application-context/" target="_blank" rel="noopener">WatchConnectivity: Sharing The Latest Data via Application Context</a> by   <a href="https://twitter.com/natashatherobot" target="_blank" rel="noopener">Natasha The Robot</a></li></ul><blockquote><p>æœ¬æ–‡ç”± SwiftGG ç¿»è¯‘ç»„ç¿»è¯‘ï¼Œå·²ç»è·å¾—ä½œè€…ç¿»è¯‘æˆæƒï¼Œæœ€æ–°æ–‡ç« è¯·è®¿é—® <a href="http://swift.gg">http://swift.gg</a>ã€‚</p></blockquote>]]></content>
    
    <summary type="html">
    
      æœ¬æ–‡è¯¦ç»†è®²è§£äº†å¦‚ä½•é€šè¿‡ Watch Connectivity çš„ Application Context æ–¹å¼è¿›è¡Œ watch å’Œ é…å¯¹ iPhone ä¹‹é—´å…±äº«æ•°æ®ã€‚
    
    </summary>
    
      <category term="codingexplorer" scheme="https://swift.gg/categories/codingexplorer/"/>
    
    
      <category term="æ•™ç¨‹" scheme="https://swift.gg/tags/%E6%95%99%E7%A8%8B/"/>
    
  </entry>
  
  <entry>
    <title>Swift 4 ä¸­çš„å­—ç¬¦ä¸²</title>
    <link href="https://swift.gg/2018/08/09/swift-4-strings/"/>
    <id>https://swift.gg/2018/08/09/swift-4-strings/</id>
    <published>2018-08-09T00:00:00.000Z</published>
    <updated>2019-02-18T08:52:03.568Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ä½œè€…ï¼šOle Begemannï¼Œ<a href="https://oleb.net/blog/2017/11/swift-4-strings" target="_blank" rel="noopener">åŸæ–‡é“¾æ¥</a>ï¼ŒåŸæ–‡æ—¥æœŸï¼š2017-11-27<br>è¯‘è€…ï¼š<a href="https://weibo.com/u/5029986118" target="_blank" rel="noopener">ä¸œèå¤§å”å’Œå°š</a>ï¼›æ ¡å¯¹ï¼š<a href="http://www.jianshu.com/users/596f2ba91ce9/latest_articles" target="_blank" rel="noopener">pmst</a>ï¼Œ<a href="undefined">Firecrest</a>ï¼›å®šç¨¿ï¼š<a href="https://github.com/chenmingbiao" target="_blank" rel="noopener">CMB</a></p></blockquote><!--æ­¤å¤„å¼€å§‹æ­£æ–‡--><p>è¿™ä¸ªç³»åˆ—ä¸­å…¶ä»–æ–‡ç« ï¼š</p><ol><li><a href="https://oleb.net/blog/2014/07/swift-strings/" target="_blank" rel="noopener">Swift 1 ä¸­çš„å­—ç¬¦ä¸²</a></li><li><a href="https://oleb.net/blog/2016/08/swift-3-strings/" target="_blank" rel="noopener">Swift 3 ä¸­çš„å­—ç¬¦ä¸²</a></li><li>Swift 4 ä¸­çš„å­—ç¬¦ä¸²ï¼ˆæœ¬æ–‡ï¼‰</li></ol><p>æœ¬æ–‡èŠ‚é€‰è‡ªæˆ‘ä»¬çš„æ–°ä¹¦ã€Šé«˜çº§ Swift ç¼–ç¨‹ã€‹ã€Œå­—ç¬¦ä¸²ã€è¿™ä¸€ç« ã€‚ã€Šé«˜çº§ Swift ç¼–ç¨‹ã€‹æ–°ç‰ˆæœ¬å·²æ ¹æ® Swift 4 çš„æ–°ç‰¹æ€§ä¿®è®¢è¡¥å……ï¼Œæ–°ç‰ˆç°å·²ä¸Šå¸‚ã€‚</p><a id="more"></a><p>æ‰€æœ‰çš„ç°ä»£ç¼–ç¨‹è¯­è¨€éƒ½æœ‰å¯¹ Unicode ç¼–ç å­—ç¬¦ä¸²çš„æ”¯æŒï¼Œä½†è¿™é€šå¸¸åªæ„å‘³ç€å®ƒä»¬çš„åŸç”Ÿå­—ç¬¦ä¸²ç±»å‹å¯ä»¥å­˜å‚¨ Unicode ç¼–ç çš„æ•°æ®â€”â€”å¹¶ä¸æ„å‘³ç€æ‰€æœ‰åƒè·å–å­—ç¬¦ä¸²é•¿åº¦è¿™æ ·ç®€å•çš„æ“ä½œéƒ½ä¼šå¾—åˆ°ã€Œåˆæƒ…åˆç†ã€çš„è¾“å‡ºç»“æœã€‚</p><p>å®é™…ä¸Šï¼Œå¤§å¤šæ•°è¯­è¨€ï¼Œä»¥åŠç”¨è¿™äº›è¯­è¨€ç¼–å†™çš„å¤§å¤šæ•°å­—ç¬¦ä¸²æ“ä½œä»£ç ï¼Œéƒ½è¡¨ç°å‡ºå¯¹Unicodeå›ºæœ‰å¤æ‚æ€§çš„æŸç§ç¨‹åº¦çš„å¦å®šã€‚è¿™å¯èƒ½ä¼šå¯¼è‡´ä¸€äº›ä»¤äººä¸å¼€å¿ƒçš„é”™è¯¯</p><p>Swift ä¸ºäº†å­—ç¬¦ä¸²çš„å®ç°æ”¯æŒ Unicode åšå‡ºäº†å·¨å¤§çš„åŠªåŠ›ã€‚Swift ä¸­çš„ <a href="https://developer.apple.com/documentation/swift/string" target="_blank" rel="noopener"><code>String</code></a>ï¼ˆå­—ç¬¦ä¸²ï¼‰æ˜¯ä¸€ç³»åˆ— <a href="https://developer.apple.com/documentation/swift/character" target="_blank" rel="noopener"><code>Character</code></a> å€¼ï¼ˆå­—ç¬¦ï¼‰çš„é›†åˆã€‚è¿™é‡Œçš„ <code>Character</code> æŒ‡çš„æ˜¯äººä»¬è§†ä¸ºå•ä¸ªå­—æ¯çš„å¯è¯»æ–‡æœ¬ï¼Œæ— è®ºè¿™ä¸ªå­—æ¯æ˜¯ç”±å¤šå°‘ä¸ª Unicode ç¼–ç å­—ç¬¦ç»„æˆã€‚å› æ­¤ï¼Œæ‰€æœ‰å¯¹äº <code>Collection</code>ï¼ˆé›†åˆï¼‰çš„æ“ä½œï¼ˆæ¯”å¦‚ <code>count</code> æˆ–è€… <code>prefix(5)</code>ï¼‰ä¹ŸåŒæ ·æ˜¯æŒ‰ç…§ç”¨æˆ·æ‰€ç†è§£çš„å­—æ¯æ¥æ“ä½œçš„ã€‚</p><p>è¿™æ ·çš„è®¾è®¡åœ¨æ­£ç¡®æ€§ä¸Šæ— å¯æŒ‘å‰”ï¼Œä½†è¿™æ˜¯æœ‰ä»£ä»·çš„ï¼Œä¸»è¦æ˜¯äººä»¬å¯¹å®ƒä¸ç†Ÿæ‚‰ã€‚å¦‚æœä½ ä¹ æƒ¯äº†ç†Ÿç»ƒæ“ä½œå…¶ä»–ç¼–ç¨‹è¯­è¨€é‡Œå­—ç¬¦ä¸²çš„æ•´æ•°ç´¢å¼•ï¼ŒSwift çš„è®¾è®¡ä¼šè®©ä½ è§‰å¾—ç¬¨é‡ä¸å ªï¼Œè®©ä½ æ„Ÿè§‰åˆ°å¥‡æ€ªã€‚ä¸ºä»€ä¹ˆ <code>str[999]</code> ä¸èƒ½è·å¾—å­—ç¬¦ä¸²ç¬¬ä¸€åƒä¸ªå­—ç¬¦ï¼Ÿä¸ºä»€ä¹ˆ <code>str[idx+1]</code> ä¸èƒ½è·å¾—ä¸‹ä¸€ä¸ªå­—ç¬¦ï¼Ÿä¸ºä»€ä¹ˆä¸èƒ½ç”¨ç±»ä¼¼ <code>&quot;a&quot;...&quot;z&quot;</code> çš„æ–¹å¼éå†ä¸€ä¸ªèŒƒå›´çš„ <code>Character</code>ï¼ˆå­—ç¬¦ï¼‰ï¼Ÿ</p><p>åŒæ—¶ï¼Œè¿™æ ·çš„è®¾è®¡å¯¹ä»£ç æ€§èƒ½ä¹Ÿæœ‰ä¸€å®šçš„å½±å“ï¼š<code>String</code> ä¸æ”¯æŒéšæ„è·å–ã€‚æ¢å¥è¯è¯´ï¼Œè·å¾—ä¸€ä¸ªä»»æ„å­—ç¬¦ä¸æ˜¯ O(1) çš„æ“ä½œâ€”â€”å½“å­—ç¬¦å®½åº¦æ˜¯ä¸ªå˜é‡çš„æ—¶å€™ï¼Œå­—ç¬¦ä¸²åªæœ‰æŸ¥çœ‹è¿‡å‰é¢æ‰€æœ‰å­—ç¬¦ä¹‹åï¼Œæ‰ä¼šçŸ¥é“ç¬¬ n ä¸ªå­—ç¬¦å‚¨å­˜åœ¨å“ªé‡Œã€‚</p><p>åœ¨æœ¬ç« ä¸­ï¼Œæˆ‘ä»¬ä¸€èµ·æ¥è¯¦ç»†è®¨è®ºä¸€ä¸‹ Swift ä¸­å­—ç¬¦ä¸²çš„è®¾è®¡ï¼Œä»¥åŠä¸€äº›è·å¾—åŠŸèƒ½å’Œæ€§èƒ½æœ€ä¼˜çš„æŠ€å·§ã€‚ä¸è¿‡ï¼Œé¦–å…ˆæˆ‘ä»¬è¦å…ˆæ¥å­¦ä¹ ä¸€ä¸‹ Unicode ç¼–ç çš„ä¸“ä¸šçŸ¥è¯†ã€‚</p><h2 id="Unicodeï¼šæŠ›å¼ƒå›ºå®šå®½åº¦"><a href="#Unicodeï¼šæŠ›å¼ƒå›ºå®šå®½åº¦" class="headerlink" title="Unicodeï¼šæŠ›å¼ƒå›ºå®šå®½åº¦"></a>Unicodeï¼šæŠ›å¼ƒå›ºå®šå®½åº¦</h2><p>æœ¬æ¥äº‹æƒ…å¾ˆç®€å•ã€‚<a href="https://en.wikipedia.org/wiki/ASCII" target="_blank" rel="noopener">ASCIIç¼–ç </a> çš„å­—ç¬¦ä¸²ç”¨ 0 åˆ° 127 ä¹‹é—´çš„ä¸€ç³»åˆ—æ•´æ•°è¡¨ç¤ºã€‚å¦‚æœä½¿ç”¨ 8 æ¯”ç‰¹çš„äºŒè¿›åˆ¶æ•°ç»„åˆè¡¨ç¤ºå­—ç¬¦ï¼Œç”šè‡³è¿˜å¤šä½™ä¸€ä¸ªæ¯”ç‰¹ï¼ç”±äºæ¯ä¸ªå­—ç¬¦çš„é•¿åº¦å›ºå®šï¼Œæ‰€ä»¥ ASCII ç¼–ç çš„å­—ç¬¦ä¸²æ˜¯å¯ä»¥éšæœºè·å–çš„ã€‚</p><p>ä½†æ˜¯ï¼Œå¦‚æœä¸æ˜¯è‹±è¯­è€Œæ˜¯å…¶ä»–å›½å®¶çš„è¯­è¨€çš„è¯ï¼Œå…¶ä¸­çš„ä¸€äº›å­—ç¬¦ ASCII ç¼–ç æ˜¯ä¸å¤Ÿçš„ï¼ˆå…¶å®å³ä½¿æ˜¯è¯´è‹±è¯­çš„è‹±å›½ä¹Ÿæœ‰ä¸€ä¸ªâ€Â£â€ç¬¦å·ï¼‰ã€‚è¿™äº›è¯­è¨€ä¸­çš„ç‰¹æ®Šå­—ç¬¦å¤§å¤šæ•°éƒ½éœ€è¦è¶…è¿‡ 7 æ¯”ç‰¹çš„ç¼–ç ã€‚åœ¨ <a href="https://en.wikipedia.org/wiki/ISO/IEC_8859" target="_blank" rel="noopener">ISO 8859</a> æ ‡å‡†ä¸­ï¼Œå°±ç”¨å¤šå‡ºæ¥çš„é‚£ä¸ªæ¯”ç‰¹å®šä¹‰äº† 16 ç§è¶…å‡º ASCII ç¼–ç èŒƒå›´çš„ç¼–ç ï¼Œæ¯”å¦‚ç¬¬ä¸€éƒ¨åˆ†ï¼ˆISO8859-1ï¼‰åŒ…æ‹¬äº†å‡ ç§è¥¿æ¬§è¯­è¨€çš„ç¼–ç ï¼Œç¬¬äº”éƒ¨åˆ†åŒ…æ‹¬äº†å¯¹è¥¿é‡Œå°”å­—æ¯è¯­è¨€çš„ç¼–ç ã€‚</p><p>ä½†è¿™æ ·çš„åšæ³•å…¶å®è¿˜æœ‰å±€é™ã€‚å¦‚æœä½ æƒ³æ ¹æ® ISO8859 æ ‡å‡†ï¼Œç”¨åœŸè€³å…¶è¯­å†™å¤å¸Œè…Šè¯­çš„è¯ï¼Œä½ å°±ä¸èµ°è¿äº†ï¼Œå› ä¸ºä½ è¦ä¹ˆå¾—é€‰æ‹©ç¬¬ä¸ƒéƒ¨åˆ†ï¼ˆæ‹‰ä¸è¯­/å¸Œè…Šè¯­ï¼‰æˆ–è€…ç¬¬ä¹éƒ¨åˆ†ï¼ˆåœŸè€³å…¶è¯­ï¼‰ã€‚è€Œä¸”ï¼Œæ€»çš„æ¥è¯´ 8 ä¸ªæ¯”ç‰¹çš„ç¼–ç ç©ºé—´æ— æ³•æ¶µç›–å¤šç§è¯­è¨€ã€‚ä¾‹å¦‚ï¼Œç¬¬å…­éƒ¨åˆ†ï¼ˆæ‹‰ä¸è¯­/é˜¿æ‹‰ä¼¯è¯­ï¼‰å°±ä¸åŒ…å«åŒæ ·ä½¿ç”¨é˜¿æ‹‰ä¼¯å­—æ¯çš„ä¹Œå°”éƒ½è¯­å’Œæ³¢æ–¯è¯­ä¸­çš„å¾ˆå¤šå­—ç¬¦ã€‚åŒæ—¶ï¼Œè¶Šå—è¯­è™½ç„¶ä½¿ç”¨çš„ä¹Ÿæ˜¯æ‹‰ä¸å­—æ¯ï¼Œä½†æ˜¯æœ‰å¾ˆå¤šå˜éŸ³ç»„åˆï¼Œè¿™ç§æƒ…å†µåªæœ‰æ›¿æ¢æ‰ä¸€äº›åŸæœ‰ ASCII ç¼–ç çš„å­—æ¯æ‰å¯èƒ½å­˜å‚¨åˆ° 8 ä¸ªæ¯”ç‰¹çš„ç©ºé—´é‡Œã€‚è€Œä¸”ï¼Œè¿™ç§æ–¹æ³•ä¸é€‚ç”¨å…¶ä»–å¾ˆå¤šä¸œäºšè¯­è¨€ã€‚</p><p>å½“å›ºå®šé•¿åº¦ç¼–ç ç©ºé—´ä¸è¶³ä»¥å®¹çº³æ›´å¤šå­—ç¬¦æ—¶ï¼Œä½ è¦åšä¸€ä¸ªé€‰æ‹©ï¼šè¦ä¹ˆæé«˜å­˜å‚¨ç©ºé—´ï¼Œè¦ä¹ˆé‡‡ç”¨å˜é•¿ç¼–ç ã€‚èµ·å…ˆï¼Œ<a href="https://en.wikipedia.org/wiki/Unicode" target="_blank" rel="noopener">Unicode</a> è¢«å®šä¹‰ä¸º 2 å­—èŠ‚å›ºå®šå®½åº¦çš„æ ¼å¼ï¼Œç°åœ¨æˆ‘ä»¬ç§°ä¹‹ä¸º <a href="https://en.wikipedia.org/wiki/Universal_Coded_Character_Set" target="_blank" rel="noopener">UCS-2</a>ã€‚å½¼æ—¶æ¢¦æƒ³å°šæœªç…§è¿›ç°å®ï¼Œåæ¥äººä»¬å‘ç°ï¼Œè¦å®ç°å¤§éƒ¨åˆ†çš„åŠŸèƒ½ï¼Œä¸ä»… 2 å­—èŠ‚ä¸å¤Ÿï¼Œç”šè‡³4ä¸ªå­—èŠ‚éƒ½è¿œè¿œä¸å¤Ÿã€‚</p><p>æ‰€ä»¥åˆ°äº†ä»Šå¤©ï¼ŒUnicode ç¼–ç çš„å®½åº¦æ˜¯å¯å˜çš„ï¼Œè¿™ç§å¯å˜æœ‰ä¸¤ä¸ªä¸åŒçš„å«ä¹‰ï¼šä¸€æ˜¯è¯´ Unicode æ ‡é‡å¯èƒ½ç”±è‹¥å¹²ä¸ªä»£ç å—ç»„æˆï¼›ä¸€æ˜¯è¯´å­—ç¬¦å¯èƒ½ç”±è‹¥å¹²ä¸ªæ ‡é‡ç»„æˆã€‚</p><p>Unicode ç¼–ç çš„æ•°æ®å¯ä»¥ç”¨å¤šç§ä¸åŒå®½åº¦çš„ <a href="https://www.unicode.org/glossary/#code_unit" target="_blank" rel="noopener">ä»£ç å•å…ƒï¼ˆ<em>code unit</em>ï¼‰</a> æ¥è¡¨ç¤ºï¼Œæœ€å¸¸è§çš„æ˜¯ 8 æ¯”ç‰¹ï¼ˆ<a href="https://en.wikipedia.org/wiki/UTF-8" target="_blank" rel="noopener">UTF-8</a>ï¼‰å’Œ 16ï¼ˆ<a href="https://en.wikipedia.org/wiki/UTF-16" target="_blank" rel="noopener">UTF-16</a>ï¼‰æ¯”ç‰¹ã€‚UTF-8 ç¼–ç çš„ä¸€å¤§ä¼˜åŠ¿æ˜¯å®ƒå‘åå…¼å®¹ 8 æ¯”ç‰¹çš„ ACSCII ç¼–ç ï¼Œè¿™ä¹Ÿæ˜¯å®ƒå–ä»£ ASCII æˆä¸ºäº’è”ç½‘ä¸Šæœ€å—æ¬¢è¿çš„ç¼–ç çš„ä¸€å¤§åŸå› ã€‚åœ¨ Swift é‡Œé¢ç”¨ <code>UInt16</code> å’Œ <code>UInt8</code> çš„æ•°å€¼ä»£è¡¨UTC-16å’ŒUTF-8çš„ä»£ç å•å…ƒï¼ˆåˆ«ååˆ†åˆ«æ˜¯ <a href="https://developer.apple.com/documentation/swift/unicode.utf8/codeunit" target="_blank" rel="noopener"><code>Unicode.UTF16.CodeUnit</code></a> å’Œ <a href="https://developer.apple.com/documentation/swift/unicode.utf16/codeunit" target="_blank" rel="noopener"><code>Unicode.UTF8.CodeUnit</code></a>ï¼‰ã€‚</p><p>ä¸€ä¸ª <a href="https://www.unicode.org/glossary/#code_point" target="_blank" rel="noopener"><em>ä»£ç ç‚¹ï¼ˆcode pointï¼‰</em></a> æŒ‡çš„æ˜¯ Unicode ç¼–ç ç©ºé—´ä¸­ä¸€ä¸ªå•ä¸€çš„å€¼ï¼Œå¯èƒ½çš„èŒƒå›´æ˜¯ <code>0</code> åˆ° <code>0x10FFFF</code> (æ¢ç®—æˆåè¿›åˆ¶å°±æ˜¯ 1114111)ã€‚ç°åœ¨å·²ä½¿ç”¨çš„ä»£ç ç‚¹å¤§çº¦åªæœ‰ 137000 ä¸ªï¼Œæ‰€ä»¥è¿˜æœ‰å¾ˆå¤šç©ºé—´å¯ä»¥å­˜å‚¨å„ç§ emojiã€‚å¦‚æœä½ ä½¿ç”¨çš„æ˜¯ <a href="https://en.wikipedia.org/wiki/UTF-32" target="_blank" rel="noopener">UTF-32</a> ç¼–ç ï¼Œé‚£ä¹ˆä¸€ä¸ªä»£ç ç‚¹å°±æ˜¯ä¸€ä¸ªä»£ç å—ï¼›å¦‚æœä½¿ç”¨çš„æ˜¯ UTF-8 ç¼–ç ï¼Œä¸€ä¸ªä»£ç ç‚¹å¯èƒ½æœ‰ 1 åˆ° 4 ä¸ªä»£ç å—ç»„æˆã€‚æœ€åˆçš„ 256 ä¸ª Unicode ç¼–ç çš„ä»£ç ç‚¹å¯¹åº”ç€ Latin-1 ä¸­çš„å­—æ¯ã€‚</p><p><a href="https://www.unicode.org/glossary/#unicode_scalar_value" target="_blank" rel="noopener">Unicode æ ‡é‡</a> è·Ÿä»£ç ç‚¹åŸºæœ¬ä¸€æ ·ï¼Œä½†æ˜¯ä¹Ÿæœ‰ä¸€ç‚¹ä¸ä¸€æ ·ã€‚é™¤å¼€ <code>0xD800-0xDFFF</code> ä¸­é—´çš„ 2048 ä¸ªä»£ç†ä»£ç ç‚¹ï¼ˆ<a href="https://en.wikipedia.org/wiki/UTF-16#U.2BD800_to_U.2BDFFF" target="_blank" rel="noopener"><em>surrogate code points</em></a>ï¼‰ä¹‹å¤–ï¼Œä»–ä»¬éƒ½æ˜¯ä¸€æ ·çš„ã€‚è¿™ 2048 ä¸ªä»£ç†ä»£ç ç‚¹æ˜¯ UTF-16 ä¸­ç”¨ä½œè¡¨ç¤ºé…å¯¹çš„å‰ç¼€æˆ–å°¾ç¼€ç¼–ç ã€‚æ ‡é‡åœ¨ Swift ä¸­ç”¨ <code>\u{xxxx}</code> è¡¨ç¤ºï¼Œxxxx ä»£è¡¨åè¿›åˆ¶çš„æ•°å­—ã€‚æ‰€ä»¥æ¬§å…ƒç¬¦å·åœ¨Swifté‡Œå¯ä»¥è¡¨ç¤ºä¸º <code>&quot;â‚¬&quot;</code> æˆ– <code>&quot;\u{20AC}&quot;</code>ã€‚ä¸ä¹‹å¯¹åº”çš„ Swift ç±»å‹æ˜¯ <a href="https://developer.apple.com/documentation/swift/unicode.scalar" target="_blank" rel="noopener"><code>Unicode.Scalar</code></a>ï¼Œä¸€ä¸ª <a href="https://developer.apple.com/documentation/swift/uint32" target="_blank" rel="noopener"><code>UInt32</code></a> æ•°å€¼çš„å°è£…ã€‚</p><p>ä¸ºäº†ç”¨ä¸€ä¸ªä»£ç å•å…ƒä»£è¡¨ä¸€ä¸ª Unicode scalarï¼Œä½ éœ€è¦ä¸€ä¸ª 21 æ¯”ç‰¹çš„ç¼–ç æœºåˆ¶ï¼ˆé€šå¸¸ä¼šè¾¾åˆ° 32 æ¯”ç‰¹ï¼Œæ¯”å¦‚ UTF-32ï¼‰ï¼Œä½†æ˜¯å³ä¾¿è¿™æ ·ä½ ä¹Ÿæ— æ³•å¾—åˆ°ä¸€ä¸ªå›ºå®šå®½åº¦çš„ç¼–ç ï¼šæœ€ç»ˆè¡¨ç¤ºå­—ç¬¦çš„æ—¶å€™ï¼ŒUnicode ä»ç„¶æ˜¯ä¸€ä¸ªå®½åº¦å¯å˜çš„ç¼–ç æ ¼å¼ã€‚å±å¹•ä¸Šæ˜¾ç¤ºçš„ä¸€ä¸ªå­—ç¬¦ï¼Œä¹Ÿå°±æ˜¯ç”¨æˆ·é€šå¸¸è®¤ä¸ºçš„ä¸€ä¸ªå­—ç¬¦ï¼Œå¯èƒ½éœ€è¦å¤šä¸ª scalar ç»„åˆè€Œæˆã€‚Unicode ç¼–ç é‡ŒæŠŠè¿™ç§ç”¨æˆ·ç†è§£çš„å­—ç¬¦ç§°ä¹‹ä¸º <a href="https://www.unicode.org/glossary/#extended_grapheme_cluster" target="_blank" rel="noopener">ï¼ˆæ‰©å±•ï¼‰å­—ä½é›†</a> (extended grapheme cluster)ã€‚</p><p>æ ‡é‡ç»„æˆå­—ä½é›†çš„è§„åˆ™å†³å®šäº†å¦‚ä½•åˆ†è¯ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ æŒ‰äº†ä¸€ä¸‹é”®ç›˜ä¸Šçš„é€€æ ¼é”®ï¼Œä½ è§‰å¾—ä½ çš„æ–‡æœ¬ç¼–è¾‘å™¨å°±åº”è¯¥åˆ é™¤æ‰ä¸€ä¸ªå­—ä½é›†ï¼Œå³ä½¿é‚£ä¸ªâ€œå­—ç¬¦â€æ˜¯ç”±å¤šä¸ª Unicode scalars ç»„æˆï¼Œä¸”æ¯ä¸ª scalar åœ¨è®¡ç®—æœºå†…å­˜ä¸Šè¿˜ç”±æ•°é‡ä¸ç­‰çš„ä»£ç å—ç»„æˆçš„ã€‚Swiftä¸­ç”¨ <code>Character</code> ç±»å‹ä»£è¡¨å­—ä½é›†ã€‚<code>Character</code> ç±»å‹å¯ä»¥ç”±ä»»æ„æ•°é‡çš„ Scalars ç»„æˆï¼Œåªè¦å®ƒä»¬å½¢æˆä¸€ä¸ªç”¨æˆ·çœ‹åˆ°çš„å­—ç¬¦ã€‚åœ¨ä¸‹ä¸€éƒ¨åˆ†ï¼Œæˆ‘ä»¬ä¼šçœ‹åˆ°å‡ ä¸ªè¿™æ ·çš„ä¾‹å­ã€‚</p><h2 id="å­—ä½é›†å’Œè§„èŒƒå¯¹ç­‰ï¼ˆCanonical-Equivalenceï¼‰"><a href="#å­—ä½é›†å’Œè§„èŒƒå¯¹ç­‰ï¼ˆCanonical-Equivalenceï¼‰" class="headerlink" title="å­—ä½é›†å’Œè§„èŒƒå¯¹ç­‰ï¼ˆCanonical Equivalenceï¼‰"></a>å­—ä½é›†å’Œè§„èŒƒå¯¹ç­‰ï¼ˆCanonical Equivalenceï¼‰</h2><h3 id="ç»„åˆç¬¦å·"><a href="#ç»„åˆç¬¦å·" class="headerlink" title="ç»„åˆç¬¦å·"></a>ç»„åˆç¬¦å·</h3><p>è¿™é‡Œæœ‰ä¸€ä¸ªå¿«é€Ÿäº†è§£ <code>String</code> ç±»å‹å¦‚ä½•å¤„ç† Unicode ç¼–ç æ•°æ®çš„æ–¹æ³•ï¼šå†™ â€œÃ©â€ çš„ä¸¤ç§ä¸åŒæ–¹æ³•ã€‚Unicode ç¼–ç ä¸­å®šä¹‰ä¸º <a href="https://codepoints.net/U+00E9" target="_blank" rel="noopener">U+00E9</a>ï¼Œ<em>Latin small letter e with acute</em>ï¼ˆæ‹‰ä¸å­—æ¯å°å†™ e åŠ é‡éŸ³ç¬¦å·ï¼‰ï¼Œå•ä¸€å€¼ã€‚ä½†æ˜¯ä½ ä¹Ÿå¯ä»¥å†™ä¸€ä¸ªæ­£å¸¸çš„ <a href="https://codepoints.net/U+0065" target="_blank" rel="noopener">å°å†™ e</a>ï¼Œå†è·Ÿä¸Šä¸€ä¸ª <a href="https://codepoints.net/U+0301" target="_blank" rel="noopener">U+0301</a>ï¼Œ<em>combining acute accent</em>ï¼ˆé‡éŸ³ç¬¦å·ï¼‰ã€‚åœ¨è¿™ä¸¤ç§æƒ…å†µä¸­ï¼Œæ˜¾ç¤ºçš„éƒ½æ˜¯ Ã©ï¼Œç”¨æˆ·å½“ç„¶ä¼šè®¤ä¸ºè¿™ä¸¤ä¸ª â€œrÃ©sumÃ©â€ æ— è®ºä½¿ç”¨ä»€ä¹ˆæ–¹å¼æ‰“å‡ºæ¥çš„ï¼Œè‚¯å®šæ˜¯ç›¸ç­‰çš„ï¼Œé•¿åº¦ä¹Ÿéƒ½æ˜¯ 6 ä¸ªå­—ç¬¦ã€‚è¿™å°±æ˜¯ Unicode ç¼–ç è§„èŒƒä¸­æ‰€è¯´çš„ <a href="https://www.unicode.org/glossary/#canonical_equivalent" target="_blank" rel="noopener">è§„èŒƒå¯¹ç­‰ï¼ˆCanonically Equivalentï¼‰</a>ã€‚</p><p>è€Œä¸”ï¼Œåœ¨ Swift è¯­è¨€é‡Œï¼Œä»£ç è¡Œä¸ºå’Œç”¨æˆ·é¢„æœŸæ˜¯ä¸€è‡´çš„ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> single = <span class="string">"Pok\u&#123;00E9&#125;mon"</span></span><br><span class="line"><span class="keyword">let</span> double = <span class="string">"Poke\u&#123;0301&#125;mon"</span></span><br></pre></td></tr></table></figure><p>å®ƒä»¬æ˜¾ç¤ºä¹Ÿæ˜¯å®Œå…¨ä¸€è‡´çš„ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">(single, double) <span class="comment">// â†’ ("PokÃ©mon", "PokÃ©mon")</span></span><br></pre></td></tr></table></figure><p>å®ƒä»¬çš„å­—ç¬¦æ•°ä¹Ÿæ˜¯ä¸€æ ·çš„ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">single.<span class="built_in">count</span> <span class="comment">// â†’ 7</span></span><br><span class="line">double.<span class="built_in">count</span> <span class="comment">// â†’ 7</span></span><br></pre></td></tr></table></figure><p>å› æ­¤ï¼Œæ¯”è¾ƒèµ·æ¥ï¼Œå®ƒä»¬ä¹Ÿæ˜¯ç›¸ç­‰çš„ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">single == double <span class="comment">// â†’ true</span></span><br></pre></td></tr></table></figure><p>åªæœ‰å½“ä½ é€šè¿‡åº•å±‚çš„æ˜¾ç¤ºæ–¹å¼æŸ¥çœ‹çš„æ—¶å€™ï¼Œæ‰èƒ½çœ‹åˆ°å®ƒä»¬çš„ä¸åŒä¹‹å¤„ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">single.utf16.<span class="built_in">count</span> <span class="comment">// â†’ 7</span></span><br><span class="line">double.utf16.<span class="built_in">count</span> <span class="comment">// â†’ 8</span></span><br></pre></td></tr></table></figure><p>è¿™ä¸€ç‚¹å’Œ Foundation ä¸­çš„ <a href="https://developer.apple.com/documentation/foundation/nsstring" target="_blank" rel="noopener"><code>NSString</code></a> å¯¹æ¯”ä¸€ä¸‹ï¼šåœ¨ <code>NSString</code> ä¸­ï¼Œä¸¤ä¸ªå­—ç¬¦ä¸²æ˜¯ä¸ç›¸ç­‰çš„ï¼Œå®ƒä»¬çš„ <code>length</code> ï¼ˆå¾ˆå¤šç¨‹åºå‘˜éƒ½ç”¨è¿™ä¸ªæ–¹æ³•æ¥ç¡®å®šå­—ç¬¦ä¸²æ˜¾ç¤ºåœ¨å±å¹•ä¸Šçš„é•¿åº¦ï¼‰ä¹Ÿæ˜¯ä¸åŒçš„ã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Foundation</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> nssingle = single <span class="keyword">as</span> <span class="type">NSString</span></span><br><span class="line">nssingle.length <span class="comment">// â†’ 7</span></span><br><span class="line"><span class="keyword">let</span> nsdouble = double <span class="keyword">as</span> <span class="type">NSString</span></span><br><span class="line">nsdouble.length <span class="comment">// â†’ 8</span></span><br><span class="line">nssingle == nsdouble <span class="comment">// â†’ false</span></span><br></pre></td></tr></table></figure><p>è¿™é‡Œï¼Œ<code>==</code> æ˜¯å®šä¹‰ä¸ºæ¯”è¾ƒä¸¤ä¸ª <code>NSObject</code> ï¼š</p><figure class="highlight objc"><table><tr><td class="code"><pre><span class="line">extension <span class="built_in">NSObject</span>: Equatable &#123;</span><br><span class="line">    <span class="keyword">static</span> func ==(lhs: <span class="built_in">NSObject</span>, rhs: <span class="built_in">NSObject</span>) -&gt; Bool &#123;</span><br><span class="line">        <span class="keyword">return</span> lhs.isEqual(rhs)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ <code>NSString</code> ä¸­ï¼Œè¿™ä¸ªæ“ä½œä¼šæ¯”è¾ƒä¸¤ä¸ª UTF-16 ä»£ç å—ã€‚å¾ˆå¤šå…¶ä»–è¯­è¨€é‡Œé¢çš„å­—ç¬¦ä¸² API ä¹Ÿæ˜¯è¿™æ ·çš„ã€‚å¦‚æœä½ æƒ³åšçš„æ˜¯ä¸€ä¸ªè§„èŒƒæ¯”è¾ƒï¼ˆcannonical comparisonï¼‰ï¼Œä½ å¿…é¡»ç”¨ <code>NSString.compare(_:)</code> ã€‚æ²¡å¬è¯´è¿‡è¿™ä¸ªæ–¹æ³•ï¼Ÿå°†æ¥é‡åˆ°ä¸€äº›æ‰¾ä¸å‡ºæ¥çš„ bug ï¼Œä»¥åŠä¸€äº›æ€’æ°”å†²å†²çš„å›½å¤–ç”¨æˆ·çš„æ—¶å€™ï¼Œå¤Ÿä½ å—çš„ã€‚</p><p>å½“ç„¶ï¼Œåªæ¯”è¾ƒä»£ç å•å…ƒæœ‰ä¸€ä¸ªå¾ˆå¤§çš„ä¼˜ç‚¹æ˜¯ï¼šé€Ÿåº¦å¿«ï¼åœ¨ Swift é‡Œï¼Œä½ ä¹Ÿå¯ä»¥é€šè¿‡ <code>utf16</code> è§†å›¾æ¥å®ç°è¿™ä¸€ç‚¹ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">single.utf16.elementsEqual(double.utf16) <span class="comment">// â†’ false</span></span><br></pre></td></tr></table></figure><p>ä¸ºä»€ä¹ˆ Unicode ç¼–ç è¦æ”¯æŒåŒä¸€å­—ç¬¦çš„å¤šç§å±•ç°æ–¹å¼å‘¢ï¼Ÿå› ä¸º Latin-1 ä¸­å·²ç»æœ‰äº†ç±»ä¼¼ Ã© å’Œ Ã± è¿™æ ·çš„å­—æ¯ï¼Œåªæœ‰çµæ´»çš„ç»„åˆæ–¹å¼æ‰èƒ½è®©é•¿åº¦å¯å˜çš„ Unicode ä»£ç ç‚¹å…¼å®¹ Latin-1ã€‚</p><p>è™½ç„¶ä½¿ç”¨èµ·æ¥ä¼šæœ‰ä¸€äº›éº»çƒ¦ï¼Œä½†æ˜¯å®ƒä½¿å¾—ä¸¤ç§ç¼–ç ä¹‹é—´çš„è½¬æ¢å˜å¾—ç®€å•å¿«é€Ÿã€‚</p><p>è€Œä¸”æŠ›å¼ƒå˜éŸ³å½¢å¼ä¹Ÿæ²¡æœ‰ä»€ä¹ˆç”¨ï¼Œå› ä¸ºè¿™ç§ç»„åˆä¸ä»…ä»…åªæ˜¯ä¸¤ä¸ªä¸¤ä¸ªçš„ï¼Œæœ‰æ—¶å€™ç”šè‡³æ˜¯å¤šç§å˜éŸ³ç¬¦å·ç»„åˆã€‚ä¾‹å¦‚ï¼Œçº¦é²å·´è¯­ä¸­æœ‰ä¸€ä¸ªå­—ç¬¦æ˜¯ á»Ì ï¼Œå¯ä»¥ç”¨ä¸‰ç§ä¸åŒæ–¹å¼å†™å‡ºæ¥ï¼šä¸€ä¸ª Ã³ åŠ ä¸€ç‚¹ï¼Œä¸€ä¸ª á» åŠ ä¸€ä¸ªé‡éŸ³ï¼Œæˆ–è€…ä¸€ä¸ª o  åŠ ä¸€ä¸ªé‡éŸ³å’Œä¸€ç‚¹ã€‚è€Œä¸”ï¼Œå¯¹æœ€åä¸€ç§æ–¹å¼æ¥è¯´ï¼Œä¸¤ä¸ªå˜éŸ³ç¬¦å·çš„é¡ºåºæ— å…³ç´§è¦ï¼æ‰€ä»¥ï¼Œä¸‹é¢å‡ ç§å½¢å¼çš„å†™æ³•éƒ½æ˜¯ç›¸ç­‰çš„ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> chars: [<span class="type">Character</span>] = [</span><br><span class="line">    <span class="string">"\u&#123;1ECD&#125;\u&#123;300&#125;"</span>,      <span class="comment">// á»Ì</span></span><br><span class="line">    <span class="string">"\u&#123;F2&#125;\u&#123;323&#125;"</span>,        <span class="comment">// á»Ì</span></span><br><span class="line">    <span class="string">"\u&#123;6F&#125;\u&#123;323&#125;\u&#123;300&#125;"</span>, <span class="comment">// á»Ì</span></span><br><span class="line">    <span class="string">"\u&#123;6F&#125;\u&#123;300&#125;\u&#123;323&#125;"</span>  <span class="comment">// á»Ì</span></span><br><span class="line">]</span><br><span class="line"><span class="keyword">let</span> allEqual = chars.<span class="built_in">dropFirst</span>()</span><br><span class="line">    .all(matching: &#123; $<span class="number">0</span> == chars.first &#125;) <span class="comment">// â†’ true</span></span><br></pre></td></tr></table></figure><p><code>all(matching:)</code> æ–¹æ³•ç”¨æ¥æ£€æµ‹æ¡ä»¶æ˜¯å¦å¯¹åºåˆ—ä¸­çš„æ‰€æœ‰å…ƒç´ éƒ½ä¸ºçœŸï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Sequence</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">all</span><span class="params">(matching predicate: <span class="params">(Element)</span></span></span> <span class="keyword">throws</span> -&gt; <span class="type">Bool</span>) <span class="keyword">rethrows</span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> element <span class="keyword">in</span> <span class="keyword">self</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">try</span> !predicate(element) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…¶å®ï¼Œä¸€äº›å˜éŸ³ç¬¦å·å¯ä»¥åŠ æ— ç©·ä¸ªã€‚è¿™ä¸€ç‚¹ï¼Œ<a href="http://knowyourmeme.com/memes/zalgo" target="_blank" rel="noopener">ç½‘ä¸Šæµä¼ å¾ˆå¹¿</a> çš„ä¸€ä¸ªé¢œæ–‡å­—è¡¨ç°å¾—å¾ˆå¥½ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> zalgo = <span class="string">"sÌ¼ÌÍ—ÍœoÌ Ì¦Ì¤Í¯Í¥Ì’Í«ÌÍ…oÌºÌªÍ–Ì—Ì½Í©ÌƒÍŸÍ…nÌ¢Í”Í–Í‡Í‡Í‰Ì«Ì°ÍªÍ‘"</span></span><br><span class="line"></span><br><span class="line">zalgo.<span class="built_in">count</span> <span class="comment">// â†’ 4</span></span><br><span class="line">zalgo.utf16.<span class="built_in">count</span> <span class="comment">// â†’ 36</span></span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œ<code>zalgo.count</code> è¿”å›å€¼æ˜¯ 4ï¼ˆæ­£ç¡®çš„ï¼‰ï¼Œè€Œ <code>zalgo.utf16.count</code> è¿”å›å€¼æ˜¯ 36ã€‚å¦‚æœä½ çš„ä»£ç è¿ç½‘ä¸Šçš„é¢œæ–‡å­—éƒ½æ— æ³•æ­£ç¡®å¤„ç†ï¼Œé‚£å®ƒæœ‰ä»€ä¹ˆå¥½çš„ï¼Ÿ</p><p>Unicode ç¼–ç çš„å­—ä½åˆ†å‰²è§„åˆ™ç”šè‡³åœ¨ä½ å¤„ç†çº¯ ASCII ç¼–ç çš„å­—ç¬¦çš„æ—¶å€™ä¹Ÿæœ‰å½±å“ï¼Œå›è½¦ <a href="https://codepoints.net/U+000D" target="_blank" rel="noopener">CR</a> å’Œ æ¢è¡Œ <a href="https://codepoints.net/U+000A" target="_blank" rel="noopener">LF</a> è¿™ä¸€ä¸ªå­—ç¬¦å¯¹åœ¨ Windows ç³»ç»Ÿä¸Šé€šå¸¸è¡¨ç¤ºæ–°å¼€ä¸€è¡Œï¼Œä½†å®ƒä»¬å…¶å®åªæ˜¯ä¸€ä¸ªå­—ä½ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// CR+LF is a single Character</span></span><br><span class="line"><span class="keyword">let</span> crlf = <span class="string">"\r\n"</span></span><br><span class="line">crlf.<span class="built_in">count</span> <span class="comment">// â†’ 1</span></span><br></pre></td></tr></table></figure><h3 id="Emoji"><a href="#Emoji" class="headerlink" title="Emoji"></a>Emoji</h3><p>è®¸å¤šå…¶ä»–ç¼–ç¨‹è¯­è¨€å¤„ç†åŒ…å« emoji çš„å­—ç¬¦ä¸²çš„æ—¶å€™ä¼šè®©äººæ„å¤–ã€‚è®¸å¤š emoji çš„ Unicode æ ‡é‡æ— æ³•å­˜å‚¨åœ¨ä¸€ä¸ª UTF-16 çš„ä»£ç å•å…ƒé‡Œé¢ã€‚æœ‰äº›è¯­è¨€ï¼ˆä¾‹å¦‚ Java æˆ–è€… C#ï¼‰æŠŠå­—ç¬¦ä¸²å½“åš UTF-16 ä»£ç å—çš„é›†åˆï¼Œè¿™äº›è¯­è¨€å®šä¹‰<a href="https://emojipedia.org/face-with-tears-of-joy/" target="_blank" rel="noopener">â€œğŸ˜‚â€</a>ä¸ºä¸¤ä¸ª â€œå­—ç¬¦â€ çš„é•¿åº¦ã€‚Swift å¤„ç†ä¸Šè¿°æƒ…å†µæ›´ä¸ºåˆç†ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> oneEmoji = <span class="string">"ğŸ˜‚"</span> <span class="comment">// U+1F602</span></span><br><span class="line">oneEmoji.<span class="built_in">count</span> <span class="comment">// â†’ 1</span></span><br></pre></td></tr></table></figure><blockquote><p>æ³¨æ„ï¼Œé‡è¦çš„æ˜¯å­—ç¬¦ä¸²å¦‚ä½•å±•ç°ç»™ç¨‹åºçš„ï¼Œ<strong>ä¸æ˜¯</strong>å­—ç¬¦ä¸²åœ¨å†…å­˜ä¸­æ˜¯å¦‚ä½•å­˜å‚¨çš„ã€‚å¯¹äºé ASCII çš„å­—ç¬¦ä¸²ï¼ŒSwift å†…éƒ¨ç”¨çš„æ˜¯ UTF-16 çš„ç¼–ç ï¼Œè¿™åªæ˜¯å†…éƒ¨çš„å®ç°ç»†èŠ‚ã€‚å…¬å…± API è¿˜æ˜¯åŸºäºå­—ä½é›†ï¼ˆgrapheme clusterï¼‰çš„ã€‚</p></blockquote><p>æœ‰äº› emoji ç”±å¤šä¸ªæ ‡é‡ç»„æˆã€‚emoji ä¸­çš„å›½æ——æ˜¯ç”±ä¸¤ä¸ªå¯¹åº” ISO å›½å®¶ä»£ç çš„<a href="https://en.wikipedia.org/wiki/Regional_Indicator_Symbol" target="_blank" rel="noopener">åœ°åŒºæ ‡è¯†ç¬¦å·ï¼ˆreginal indicator symbolsï¼‰</a>ç»„æˆçš„ã€‚Swift é‡Œå°†ä¸€ä¸ªå›½æ——è§†ä¸ºä¸€ä¸ª <code>Character</code> ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> flags = <span class="string">"ğŸ‡§ğŸ‡·ğŸ‡³ğŸ‡¿"</span></span><br><span class="line">flags.<span class="built_in">count</span> <span class="comment">// â†’ 2</span></span><br></pre></td></tr></table></figure><p>è¦æ£€æŸ¥ä¸€ä¸ªå­—ç¬¦ä¸²ç”±å‡ ä¸ª Unicode æ ‡é‡ç»„æˆï¼Œéœ€è¦ä½¿ç”¨ <a href="https://developer.apple.com/documentation/swift/string/1539070-unicodescalars" target="_blank" rel="noopener"><code>unicodeScalars</code></a> è§†å›¾ã€‚è¿™é‡Œï¼Œæˆ‘ä»¬å°† scalar çš„å€¼æ ¼å¼åŒ–ä¸ºåè¿›åˆ¶çš„æ•°å­—ï¼Œè¿™æ˜¯ä»£ç ç‚¹çš„æ™®éæ ¼å¼ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">flags.unicodeScalars.<span class="built_in">map</span> &#123;</span><br><span class="line">    <span class="string">"U+<span class="subst">\(String($<span class="number">0</span>.value, radix: <span class="number">16</span>, uppercase: <span class="literal">true</span>)</span>)"</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// â†’ ["U+1F1E7", "U+1F1F7", "U+1F1F3", "U+1F1FF"]</span></span><br></pre></td></tr></table></figure><p>è‚¤è‰²æ˜¯ç”±ä¸€ä¸ªåŸºç¡€çš„è§’è‰²ç¬¦å·ï¼ˆä¾‹å¦‚ğŸ‘§ï¼‰åŠ ä¸Šä¸€ä¸ªè‚¤è‰²ä¿®é¥°ç¬¦ï¼ˆä¾‹å¦‚ğŸ½ï¼‰ç»„æˆçš„ï¼ŒSwift é‡Œæ˜¯è¿™ä¹ˆå¤„ç†çš„ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> skinTone = <span class="string">"ğŸ‘§ğŸ½"</span> <span class="comment">// ğŸ‘§ + ğŸ½</span></span><br><span class="line">skinTone.<span class="built_in">count</span> <span class="comment">// â†’ 1</span></span><br></pre></td></tr></table></figure><p>è¿™æ¬¡æˆ‘ä»¬ç”¨ Foundation API é‡Œé¢çš„ <a href="https://oleb.net/blog/2016/01/icu-text-transforms/" target="_blank" rel="noopener">ICU string transform</a> æŠŠ Unicode æ ‡é‡è½¬æ¢æˆå®˜æ–¹çš„ Unicode åç§°ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">StringTransform</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">let</span> toUnicodeName = <span class="type">StringTransform</span>(rawValue: <span class="string">"Any-Name"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Unicode</span>.<span class="title">Scalar</span> </span>&#123;</span><br><span class="line">    <span class="comment">/// The scalarâ€™s Unicode name, e.g. "LATIN CAPITAL LETTER A".</span></span><br><span class="line">    <span class="keyword">var</span> unicodeName: <span class="type">String</span> &#123;</span><br><span class="line">        <span class="comment">// Force-unwrapping is safe because this transform always succeeds</span></span><br><span class="line">        <span class="keyword">let</span> name = <span class="type">String</span>(<span class="keyword">self</span>).applyingTransform(.toUnicodeName,</span><br><span class="line">            <span class="built_in">reverse</span>: <span class="literal">false</span>)!</span><br><span class="line"></span><br><span class="line">        <span class="comment">// The string transform returns the name wrapped in "\\N&#123;...&#125;". Remove those.</span></span><br><span class="line">        <span class="keyword">let</span> prefixPattern = <span class="string">"\\N&#123;"</span></span><br><span class="line">        <span class="keyword">let</span> suffixPattern = <span class="string">"&#125;"</span></span><br><span class="line">        <span class="keyword">let</span> prefixLength = name.hasPrefix(prefixPattern) ? prefixPattern.<span class="built_in">count</span> : <span class="number">0</span></span><br><span class="line">        <span class="keyword">let</span> suffixLength = name.hasSuffix(suffixPattern) ? suffixPattern.<span class="built_in">count</span> : <span class="number">0</span></span><br><span class="line">        <span class="keyword">return</span> <span class="type">String</span>(name.<span class="built_in">dropFirst</span>(prefixLength).<span class="built_in">dropLast</span>(suffixLength))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">skinTone.unicodeScalars.<span class="built_in">map</span> &#123; $<span class="number">0</span>.unicodeName &#125;</span><br><span class="line"><span class="comment">// â†’ ["GIRL", "EMOJI MODIFIER FITZPATRICK TYPE-4"]</span></span><br></pre></td></tr></table></figure><p>è¿™æ®µä»£ç é‡Œé¢æœ€é‡è¦çš„æ˜¯å¯¹ <code>applyingTransform(.toUnicodeName,...)</code> çš„è°ƒç”¨ã€‚å…¶ä»–çš„ä»£ç åªæ˜¯æŠŠè½¬æ¢æ–¹æ³•è¿”å›çš„åå­—æ¸…ç†äº†ä¸€ä¸‹ï¼Œç§»é™¤äº†æ‹¬å·ã€‚è¿™æ®µä»£ç å¾ˆä¿å®ˆï¼šå…ˆæ˜¯æ£€æŸ¥äº†å­—ç¬¦ä¸²æ˜¯å¦ç¬¦åˆæœŸæœ›çš„æ ¼å¼ï¼Œç„¶åè®¡ç®—äº†ä»å¤´åˆ°å°¾çš„å­—ç¬¦æ•°ã€‚å¦‚æœå°†æ¥è½¬æ¢æ–¹æ³•è¿”å›çš„åå­—æ ¼å¼å‘ç”Ÿäº†å˜åŒ–ï¼Œæœ€å¥½è¾“å‡ºåŸå­—ç¬¦ä¸²ï¼Œè€Œä¸æ˜¯ç§»é™¤å¤šä½™å­—ç¬¦åçš„å­—ç¬¦ä¸²ã€‚</p><p>æ³¨æ„æˆ‘ä»¬æ˜¯å¦‚ä½•ä½¿ç”¨æ ‡å‡†çš„é›†åˆï¼ˆ<code>Collection</code>ï¼‰æ–¹æ³• <code>dropFirst</code> å’Œ <code>droplast</code> è¿›è¡Œç§»é™¤æ“ä½œçš„ã€‚å¦‚æœä½ æƒ³å¯¹å­—ç¬¦ä¸²è¿›è¡Œæ“ä½œï¼Œä½†æ˜¯åˆä¸æƒ³å¯¹å­—ç¬¦ä¸²è¿›è¡Œæ‰‹åŠ¨ç´¢å¼•ï¼Œè¿™å°±æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­ã€‚è¿™ä¸ªæ–¹æ³•åŒæ ·ä¹Ÿå¾ˆé«˜æ•ˆï¼Œå› ä¸º <code>dropFisrt</code> å’Œ <code>dropLast</code> æ–¹æ³•è¿”å›çš„æ˜¯ <code>Substring</code> å€¼ï¼Œå®ƒä»¬åªæ˜¯åŸå­—ç¬¦ä¸²çš„ä¸€éƒ¨åˆ†ã€‚åœ¨æˆ‘ä»¬æœ€åä¸€æ­¥åˆ›å»ºä¸€ä¸ªæ–°çš„ <code>String</code> å­—ç¬¦ä¸²ï¼Œèµ‹å€¼ä¸ºè¿™ä¸ª substring ä¹‹å‰ï¼Œå®ƒæ˜¯ä¸å ç”¨æ–°çš„å†…å­˜çš„ã€‚å…³äºè¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬åœ¨è¿™ä¸€ç« çš„åé¢è¿˜æœ‰å¾ˆå¤šä¸œè¥¿ä¼šæ¶‰åŠåˆ°ã€‚</p><p>Emoji é‡Œé¢å¯¹å®¶åº­å’Œå¤«å¦»çš„è¡¨ç¤ºï¼ˆä¾‹å¦‚ <a href="https://emojipedia.org/family-man-woman-girl-boy/" target="_blank" rel="noopener">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦</a> å’Œ <a href="https://emojipedia.org/couple-with-heart-woman-woman/" target="_blank" rel="noopener">ğŸ‘©â€â¤ï¸â€ğŸ‘©</a>ï¼‰æ˜¯ Unicode ç¼–ç æ ‡å‡†é¢ä¸´çš„åˆä¸€ä¸ªæŒ‘æˆ˜ã€‚ç”±äºæ€§åˆ«ä»¥åŠäººæ•°çš„å¯èƒ½ç»„åˆå¤ªå¤šï¼Œä¸ºæ¯ç§å¯èƒ½çš„ç»„åˆéƒ½åšä¸€ä¸ªä»£ç ç‚¹è‚¯å®šä¼šæœ‰é—®é¢˜ã€‚å†åŠ ä¸Šæ¯ä¸ªäººç‰©è§’è‰²çš„è‚¤è‰²çš„é—®é¢˜ï¼Œè¿™æ ·åšå‡ ä¹ä¸å¯è¡Œã€‚Unicode ç¼–ç æ˜¯è¿™æ ·è§£å†³è¿™ä¸ªé—®é¢˜çš„ï¼Œå®ƒå°†è¿™ç§ emoji å®šä¹‰ä¸ºä¸€ç³»åˆ—ç”±é›¶å®½åº¦è¿æ¥ç¬¦ï¼ˆ<a href="https://codepoints.net/U+200D" target="_blank" rel="noopener"><em>zero-width joiner</em></a>ï¼‰è”ç³»èµ·æ¥çš„ emoji ã€‚è¿™æ ·ä¸‹æ¥ï¼Œè¿™ä¸ªå®¶åº­ ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ emoji å…¶å®å°±æ˜¯ <a href="https://emojipedia.org/man/" target="_blank" rel="noopener"><em>man</em> ğŸ‘¨</a> + ZWJ + <a href="https://emojipedia.org/woman/" target="_blank" rel="noopener"><em>woman</em> ğŸ‘©</a> + ZWJ + <a href="https://emojipedia.org/girl/" target="_blank" rel="noopener"><em>girl</em> ğŸ‘§</a> + ZWJ + <a href="https://emojipedia.org/boy/" target="_blank" rel="noopener"><em>boy</em> ğŸ‘¦</a>ã€‚è€Œé›¶å®½åº¦è¿æ¥ç¬¦çš„ä½œç”¨å°±æ˜¯è®©æ“ä½œç³»ç»ŸçŸ¥é“è¿™ä¸ª emoji åº”è¯¥åªæ˜¯ä¸€ä¸ªå­—ç´ ã€‚</p><p>æˆ‘ä»¬å¯ä»¥éªŒè¯ä¸€ä¸‹åˆ°åº•æ˜¯ä¸æ˜¯è¿™æ ·ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> family1 = <span class="string">"ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦"</span></span><br><span class="line"><span class="keyword">let</span> family2 = <span class="string">"ğŸ‘¨\u&#123;200D&#125;ğŸ‘©\u&#123;200D&#125;ğŸ‘§\u&#123;200D&#125;ğŸ‘¦"</span></span><br><span class="line">family1 == family2 <span class="comment">// â†’ true</span></span><br></pre></td></tr></table></figure><p>åœ¨ Swift é‡Œï¼Œè¿™æ ·ä¸€ä¸ª emoji ä¹ŸåŒæ ·è¢«è®¤ä¸ºæ˜¯ä¸€ä¸ªå­—ç¬¦ <code>Character</code> ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">family1.<span class="built_in">count</span> <span class="comment">// â†’ 1</span></span><br><span class="line">family2.<span class="built_in">count</span> <span class="comment">// â†’ 1</span></span><br></pre></td></tr></table></figure><p>2016å¹´æ–°å¼•å…¥çš„èŒä¸šç±»å‹ emoji ä¹Ÿæ˜¯è¿™ç§æƒ…å†µã€‚ä¾‹å¦‚å¥³æ€§æ¶ˆé˜²é˜Ÿå‘˜ <a href="https://emojipedia.org/female-firefighter/" target="_blank" rel="noopener">ğŸ‘©â€ğŸš’</a> å°±æ˜¯ <a href="https://emojipedia.org/woman/" target="_blank" rel="noopener"><em>woman</em> ğŸ‘©</a> + ZWJ + <a href="https://emojipedia.org/fire-engine/" target="_blank" rel="noopener"><em>fire engine</em> ğŸš’</a>ã€‚ç”·æ€§åŒ»ç”Ÿå°±æ˜¯ <a href="https://emojipedia.org/man/" target="_blank" rel="noopener"><em>man</em> ğŸ‘¨</a> + ZWJ + <a href="https://emojipedia.org/staff-of-aesculapius/" target="_blank" rel="noopener"><em>staff of aesculapius</em> âš•</a>ï¼ˆè¯‘è€…æ³¨ï¼šé˜¿æ–¯å…‹å‹’åº‡å„æ–¯ï¼Œæ˜¯å¤å¸Œè…Šç¥è¯ä¸­çš„åŒ»ç¥ï¼Œä¸€æ¡è›‡ç»•ç€ä¸€ä¸ªæŸ±å­æŒ‡åŒ»ç–—ç›¸å…³èŒä¸šï¼‰ã€‚</p><p>å°†è¿™äº›ä¸€ç³»åˆ—é›¶å®½åº¦è¿æ¥ç¬¦è¿æ¥èµ·æ¥çš„ emoji æ¸²æŸ“ä¸ºä¸€ä¸ªå­—ç´ æ˜¯æ“ä½œç³»ç»Ÿçš„å·¥ä½œã€‚2017å¹´ï¼ŒApple çš„æ“ä½œç³»ç»Ÿè¡¨ç¤ºæ”¯æŒ Unicode ç¼–ç æ ‡å‡†ä¸‹çš„ RGI ç³»åˆ—ï¼ˆâ€œ<a href="https://unicode.org/emoji/charts/emoji-zwj-sequences.html" target="_blank" rel="noopener">recommended for general interchange</a>â€ï¼‰ã€‚å¦‚æœæ²¡æœ‰å­—ä½å¯ä»¥æ­£ç¡®è¡¨ç¤ºè¿™ä¸ªåºåˆ—ï¼Œé‚£æ–‡æœ¬æ¸²æŸ“ç³»ç»Ÿä¼šå›é€€ï¼Œæ˜¾ç¤ºä¸ºæ¯ä¸ªå•ä¸ªçš„å­—ç´ ã€‚</p><p>æ³¨æ„è¿™é‡Œåˆå¯èƒ½ä¼šå¯¼è‡´ä¸€ä¸ªç†è§£åå·®ï¼Œå³ç”¨æˆ·æ‰€è®¤ä¸ºçš„å­—ç¬¦å’Œ Swift æ‰€è®¤ä¸ºçš„å­—ä½é›†ä¹‹é—´çš„åå·®ã€‚æˆ‘ä»¬ä¸Šé¢æ‰€æœ‰çš„ä¾‹å­éƒ½æ˜¯æ‹…å¿ƒç¼–ç¨‹è¯­è¨€ä¼šæŠŠå­—ç¬¦<strong>æ•°å¤šäº†</strong>ï¼Œä½†è¿™é‡Œæ­£å¥½ç›¸åã€‚ä¸¾ä¾‹æ¥è¯´ï¼Œä¸Šé¢é‚£ä¸ªå®¶åº­çš„ emoji é‡Œé¢æ¶‰åŠåˆ°çš„è‚¤è‰² emoji è¿˜æœªè¢«æ”¶å½•åˆ° RGI é›†åˆé‡Œé¢ã€‚ä½†å°½ç®¡å¤§å¤šæ•°æ“ä½œç³»ç»Ÿéƒ½æŠŠè¿™ç³»åˆ— emoji æ¸²æŸ“æˆå¤šä¸ªå­—ç´ ï¼Œä½† Swift ä»æ—§åªæŠŠå®ƒä»¬çœ‹åšä¸€ä¸ªå­—ç¬¦ï¼Œå› ä¸º Unicode ç¼–ç çš„åˆ†è¯è§„åˆ™å’Œæ¸²æŸ“æ— å…³ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Family with skin tones is rendered as multiple glyphs</span></span><br><span class="line"><span class="comment">// on most platforms in 2017</span></span><br><span class="line"><span class="keyword">let</span> family3 = <span class="string">"ğŸ‘±ğŸ¾\u&#123;200D&#125;ğŸ‘©ğŸ½\u&#123;200D&#125;ğŸ‘§ğŸ¿\u&#123;200D&#125;ğŸ‘¦ğŸ»"</span> <span class="comment">// â†’ "ğŸ‘±ğŸ¾â€ğŸ‘©ğŸ½â€ğŸ‘§ğŸ¿â€ğŸ‘¦ğŸ»"</span></span><br><span class="line"><span class="comment">// But Swift still counts it as a single Character</span></span><br><span class="line">family3.<span class="built_in">count</span> <span class="comment">// â†’ 1</span></span><br></pre></td></tr></table></figure><p><a href="https://blog.emojipedia.org/diverse-emoji-families-come-to-windows/" target="_blank" rel="noopener">Windows ç³»ç»Ÿå·²ç»å¯ä»¥</a>æŠŠè¿™äº› emoji æ¸²æŸ“ä¸ºä¸€ä¸ªå­—ç´ äº†ï¼Œå…¶ä»–æ“ä½œç³»ç»Ÿå‚å®¶è‚¯å®šä¹Ÿä¼šå°½å¿«æ”¯æŒã€‚ä½†æ˜¯ï¼Œæœ‰ä¸€ç‚¹æ˜¯ä¸å˜çš„ï¼šæ— è®ºä¸€ä¸ªå­—ç¬¦ä¸²çš„ API å¦‚ä½•ç²¾å¿ƒè®¾è®¡ï¼Œéƒ½æ— æ³•å®Œç¾æ”¯æŒæ¯ä¸€ä¸ªç»†å°çš„æ¡ˆä¾‹ï¼Œå› ä¸ºæ–‡æœ¬å¤ªå¤æ‚äº†ã€‚</p><blockquote><p>è¿‡å» Swift å¾ˆéš¾è·Ÿå¾—ä¸Š Unicode ç¼–ç æ ‡å‡†æ”¹å˜çš„æ­¥ä¼ã€‚Swift 3 æ¸²æŸ“è‚¤è‰²å’Œé›¶å®½åº¦è¿æ¥ç¬¦ç³»åˆ— emoji æ˜¯é”™è¯¯çš„ï¼Œå› ä¸ºå½“æ—¶çš„åˆ†è¯ç®—æ³•æ˜¯æ ¹æ®ä¸Šä¸€ä¸ªç‰ˆæœ¬çš„ Unicode ç¼–ç æ ‡å‡†ã€‚è‡ª Swift 4 èµ·ï¼ŒSwift å¼€å§‹å¯ç”¨æ“ä½œç³»ç»Ÿçš„ <a href="http://site.icu-project.org" target="_blank" rel="noopener">ICU</a> åº“ã€‚å› æ­¤ï¼Œåªè¦ç”¨æˆ·æ›´æ–°ä»–ä»¬çš„æ“ä½œç³»ç»Ÿï¼Œä½ çš„ç¨‹åºå°±ä¼šé‡‡ç”¨æœ€æ–°çš„ Unicode ç¼–ç æ ‡å‡†ã€‚ç¡¬å¸çš„å¦ä¸€é¢æ˜¯ï¼Œä½ å¼€å‘ä¸­çœ‹åˆ°çš„å’Œç”¨æˆ·çœ‹åˆ°çš„ä¸œè¥¿å¯èƒ½æ˜¯ä¸ä¸€æ ·çš„ã€‚</p></blockquote><p>ç¼–ç¨‹è¯­è¨€å¦‚æœå…¨é¢è€ƒè™‘ Unicode ç¼–ç å¤æ‚æ€§çš„è¯ï¼Œåœ¨å¤„ç†æ–‡æœ¬çš„æ—¶å€™ä¼šå¼•å‘å¾ˆå¤šé—®é¢˜ã€‚ä¸Šé¢è¿™ä¹ˆå¤šä¾‹å­æˆ‘ä»¬åªæ˜¯è°ˆåŠå…¶ä¸­çš„ä¸€ä¸ªé—®é¢˜ï¼šå­—ç¬¦ä¸²çš„é•¿åº¦ã€‚å¦‚æœä¸€ä¸ªç¼–ç¨‹è¯­è¨€ä¸æ˜¯æŒ‰å­—ç´ é›†å¤„ç†å­—ç¬¦ä¸²ï¼Œè€Œè¿™ä¸ªå­—ç¬¦ä¸²åˆåŒ…å«å¾ˆå¤šå­—ç¬¦åºåˆ—çš„è¯ï¼Œè¿™æ—¶å€™ä¸€ä¸ªç®€ç®€å•å•çš„ååºè¾“å‡ºå­—ç¬¦ä¸²çš„æ“ä½œä¼šå˜å¾—å¤šä¹ˆå¤æ‚ã€‚</p><p>è¿™ä¸æ˜¯ä¸ªæ–°é—®é¢˜ï¼Œä½†æ˜¯ emoji çš„æµè¡Œä½¿å¾—ç³Ÿç³•çš„æ–‡æœ¬å¤„ç†æ–¹æ³•é€ æˆçš„é—®é¢˜æ›´å®¹æ˜“æµ®å‡ºè¡¨é¢ï¼Œå³ä½¿ä½ çš„ç”¨æˆ·ç¾¤å¤§éƒ¨åˆ†æ˜¯è¯´è‹±è¯­çš„ã€‚è€Œä¸”ï¼Œé”™è¯¯çš„çº§åˆ«ä¹Ÿå¤§å¤§æå‡ï¼šåå¹´å‰ï¼Œå¼„é”™ä¸€ä¸ªå˜éŸ³ç¬¦å·çš„å­—æ¯å¯èƒ½åªä¼šé€ æˆ 1 ä¸ªå­—ç¬¦æ•°çš„è¯¯å·®ï¼Œç°åœ¨å¦‚æœå¼„é”™äº† emoji çš„è¯å¾ˆå¯èƒ½å°±æ˜¯ 10 ä¸ªå­—ç¬¦æ•°çš„è¯¯å·®ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªå››äººå®¶åº­çš„ emoji åœ¨ UTF-16 ç¼–ç ä¸‹æ˜¯ 11 ä¸ªå­—ç¬¦ï¼Œåœ¨ UTF-8 ç¼–ç ä¸‹å°±æ˜¯ 25 ä¸ªå­—ç¬¦äº†ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">family1.<span class="built_in">count</span> <span class="comment">// â†’ 1</span></span><br><span class="line">family1.utf16.<span class="built_in">count</span> <span class="comment">// â†’ 11</span></span><br><span class="line">family1.utf8.<span class="built_in">count</span> <span class="comment">// â†’ 25</span></span><br></pre></td></tr></table></figure><p>ä¹Ÿä¸æ˜¯è¯´å…¶ä»–ç¼–ç¨‹è¯­è¨€å°±å®Œå…¨æ²¡æœ‰ç¬¦åˆ Unicode ç¼–ç æ ‡å‡†çš„ APIï¼Œå¤§éƒ¨åˆ†è¿˜æ˜¯æœ‰çš„ã€‚ä¾‹å¦‚ï¼Œ<code>NSString</code> å°±æœ‰ä¸€ä¸ª <a href="https://developer.apple.com/documentation/foundation/nsstring/1416774-enumeratesubstrings" target="_blank" rel="noopener"><code>enumerateSubstrings</code></a> çš„æ–¹æ³•å¯ä»¥æŒ‰ç…§å­—ä½é›†éå†ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚ä½†æ˜¯ç¼ºçœè®¾ç½®å¾ˆé‡è¦ï¼Œè€Œ Swift çš„åŸåˆ™å°±æ˜¯ç¼ºçœæƒ…å†µä¸‹ï¼Œå°±æŒ‰æ­£ç¡®çš„æ–¹å¼æ¥åšã€‚è€Œä¸”å¦‚æœä½ éœ€è¦ä½ä¸€ä¸ªæŠ½è±¡çº§åˆ«å»çœ‹ï¼Œ<code>String</code> ä¹Ÿæä¾›ä¸åŒçš„è§†å›¾ï¼Œç„¶ä½ å¯ä»¥ç›´æ¥ä» Unicode æ ‡é‡æˆ–è€…ä»£ç å—çš„çº§åˆ«æ“ä½œã€‚ä¸‹é¢çš„å†…å®¹é‡Œæˆ‘ä»¬è¿˜ä¼šæ¶‰åŠåˆ°è¿™ä¸€ç‚¹ã€‚</p><h2 id="å­—ç¬¦ä¸²å’Œé›†åˆ"><a href="#å­—ç¬¦ä¸²å’Œé›†åˆ" class="headerlink" title="å­—ç¬¦ä¸²å’Œé›†åˆ"></a>å­—ç¬¦ä¸²å’Œé›†åˆ</h2><p>æˆ‘ä»¬å·²ç»çœ‹åˆ°ï¼Œ<code>String</code> æ˜¯ä¸€ä¸ª <code>Character</code> å€¼çš„é›†åˆã€‚åœ¨ Swift è¯­è¨€å‘å±•çš„å‰ä¸‰å¹´é‡Œï¼Œ<code>String</code> è¿™ä¸ªç±»åœ¨éµå®ˆè¿˜æ˜¯ä¸éµå®ˆ <code>Collection</code> é›†åˆåè®®è¿™ä¸ªé—®é¢˜ä¸Šå·¦å³æ‘‡æ‘†äº†å‡ æ¬¡ã€‚åšæŒä¸è¦éµå®ˆé›†åˆåè®®çš„äººè®¤ä¸ºï¼Œå¦‚æœéµå®ˆçš„è¯ï¼Œç¨‹åºå‘˜ä¼šè®¤ä¸ºæ‰€æœ‰é€šç”¨çš„é›†åˆå¤„ç†ç®—æ³•ç”¨åœ¨å­—ç¬¦ä¸²ä¸Šæ˜¯ç»å¯¹å®‰å…¨çš„ï¼Œä¹Ÿç»å¯¹ç¬¦åˆ Unicode ç¼–ç æ ‡å‡†çš„ï¼Œä½†æ˜¯æ˜¾ç„¶æœ‰ä¸€äº›ç‰¹ä¾‹å­˜åœ¨ã€‚</p><p>ä¸¾ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œä¸¤ä¸ªé›†åˆç›¸åŠ ï¼Œå¾—åˆ°çš„æ–°çš„é›†åˆçš„é•¿åº¦è‚¯å®šæ˜¯ä¸¤ä¸ªå­é›†åˆé•¿åº¦çš„å’Œã€‚ä½†æ˜¯åœ¨å­—ç¬¦ä¸²ä¸­ï¼Œå¦‚æœç¬¬ä¸€ä¸ªå­—ç¬¦ä¸²çš„åç¼€å’Œç¬¬äºŒä¸ªå­—ç¬¦ä¸²çš„å‰ç¼€å½¢æˆäº†ä¸€ä¸ªå­—ä½é›†ï¼Œé•¿åº¦å°±ä¼šæœ‰å˜åŒ–äº†ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> flagLetterJ = <span class="string">"ğŸ‡¯"</span></span><br><span class="line"><span class="keyword">let</span> flagLetterP = <span class="string">"ğŸ‡µ"</span></span><br><span class="line"><span class="keyword">let</span> flag = flagLetterJ + flagLetterP <span class="comment">// â†’ "ğŸ‡¯ğŸ‡µ"</span></span><br><span class="line">flag.<span class="built_in">count</span> <span class="comment">// â†’ 1</span></span><br><span class="line">flag.<span class="built_in">count</span> == flagLetterJ.<span class="built_in">count</span> + flagLetterP.<span class="built_in">count</span> <span class="comment">// â†’ false</span></span><br></pre></td></tr></table></figure><p>å‡ºäºè¿™ç§è€ƒè™‘ï¼Œåœ¨ Swift 2 å’Œ Swift 3 ä¸­ï¼Œ<code>String</code> å¹¶æ²¡æœ‰è¢«ç®—ä½œä¸€ä¸ªé›†åˆã€‚è¿™ä¸ªç‰¹æ€§æ˜¯ä½œä¸º <code>String</code> çš„ä¸€ä¸ª <a href="https://developer.apple.com/documentation/swift/string/1540072-characters" target="_blank" rel="noopener"><code>characters</code></a> è§†å›¾å­˜åœ¨çš„ï¼Œå’Œå…¶ä»–å‡ ä¸ªé›†åˆè§†å›¾ä¸€æ ·ï¼š<a href="https://developer.apple.com/documentation/swift/string/1539070-unicodescalars" target="_blank" rel="noopener"><code>unicodeScalars</code></a>ï¼Œ<a href="https://developer.apple.com/documentation/swift/string/1539703-utf8" target="_blank" rel="noopener"><code>utf8</code></a> å’Œ <a href="https://developer.apple.com/documentation/swift/string/1541301-utf16" target="_blank" rel="noopener"><code>utf16</code></a>ã€‚é€‰æ‹©ä¸€ä¸ªç‰¹å®šçš„è§†å›¾ï¼Œå°±ç›¸å½“äºè®©ç¨‹åºå‘˜è½¬æ¢åˆ°å¦ä¸€ç§â€œå¤„ç†é›†åˆâ€çš„æ¨¡å¼ï¼Œç›¸åº”çš„ï¼Œç¨‹åºå‘˜å°±å¿…é¡»è€ƒè™‘åˆ°è¿™ç§æ¨¡å¼ä¸‹å¯èƒ½äº§ç”Ÿçš„é—®é¢˜ã€‚</p><p>ä½†æ˜¯ï¼Œåœ¨å®é™…åº”ç”¨ä¸­ï¼Œè¿™ä¸ªæ”¹å˜æå‡äº†å­¦ä¹ æˆæœ¬ï¼Œé™ä½äº†å¯ç”¨æ€§ï¼›å•å•ä¸ºäº†ä¿è¯åœ¨é‚£äº›æç«¯ä¸ªä¾‹ä¸­çš„æ­£ç¡®æ€§ï¼ˆå…¶å®åœ¨çœŸå®åº”ç”¨ä¸­å¾ˆå°‘é‡åˆ°ï¼Œé™¤éä½ å†™çš„æ˜¯ä¸ªæ–‡æœ¬ç¼–è¾‘å™¨çš„åº”ç”¨ï¼‰åšå‡ºè¿™æ ·çš„æ”¹å˜å¤ªä¸å€¼å¾—äº†ã€‚å› æ­¤ï¼Œåœ¨ Swift 4 ä¸­ï¼Œ<code>String</code> å†æ¬¡æˆäº†ä¸€ä¸ªé›†åˆã€‚<code>characters</code> è§†å›¾è¿˜åœ¨ï¼Œä½†æ˜¯åªæ˜¯ä¸ºäº†å‘åå…¼å®¹ Swift 3ã€‚</p><h3 id="åŒå‘è·å–ï¼Œè€Œéä»»æ„è·å–"><a href="#åŒå‘è·å–ï¼Œè€Œéä»»æ„è·å–" class="headerlink" title="åŒå‘è·å–ï¼Œè€Œéä»»æ„è·å–"></a>åŒå‘è·å–ï¼Œè€Œéä»»æ„è·å–</h3><p>ç„¶è€Œï¼Œ<code>String</code> å¹¶<strong>ä¸æ˜¯</strong>ä¸€ä¸ªå¯ä»¥ä»»æ„è·å–çš„é›†åˆï¼ŒåŸå› çš„è¯ï¼Œä¸Šä¸€éƒ¨åˆ†çš„å‡ ä¸ªä¾‹å­å·²ç»å±•ç°çš„å¾ˆæ¸…æ¥šã€‚ä¸€ä¸ªå­—ç¬¦åˆ°åº•æ˜¯ç¬¬å‡ ä¸ªå­—ç¬¦å–å†³äºå®ƒå‰é¢æœ‰å¤šå°‘ä¸ª Unicode scalarï¼Œè¿™æ ·çš„æƒ…å†µä¸‹ï¼Œæ ¹æœ¬ä¸å¯èƒ½å®ç°ä»»æ„è·å–ã€‚ç”±äºè¿™ä¸ªåŸå› ï¼ŒSwift é‡Œé¢çš„å­—ç¬¦ä¸²éµå®ˆåŒå‘è·å–ï¼ˆ<a href="https://developer.apple.com/documentation/swift/bidirectionalcollection" target="_blank" rel="noopener"><code>BidirectionalCollection</code></a>ï¼‰è§„åˆ™ã€‚å¯ä»¥ä»å­—ç¬¦ä¸²çš„ä¸¤å¤´æ•°ï¼Œä»£ç ä¼šæ ¹æ®ç›¸é‚»å­—ç¬¦çš„ç»„æˆï¼Œè·³è¿‡æ­£ç¡®æ•°é‡çš„å­—èŠ‚ã€‚ä½†æ˜¯ï¼Œæ¯æ¬¡è®¿é—®åªèƒ½ä¸Šç§»æˆ–è€…ä¸‹ç§»ä¸€ä¸ªå­—ç¬¦ã€‚</p><p>åœ¨å†™å¤„ç†å­—ç¬¦ä¸²çš„ä»£ç çš„æ—¶å€™ï¼Œè¦è€ƒè™‘åˆ°è¿™ç§æ–¹å¼çš„æ“ä½œå¯¹ä»£ç æ€§èƒ½çš„å½±å“ã€‚é‚£äº›ä¾é ä»»æ„è·å–æ¥ä¿è¯ä»£ç æ€§èƒ½çš„ç®—æ³•å¯¹ Unicode ç¼–ç çš„å­—ç¬¦ä¸²å¹¶ä¸åˆé€‚ã€‚æˆ‘ä»¬çœ‹ä¸€ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬è¦è·å–ä¸€ä¸ªå­—ç¬¦ä¸²æ‰€æœ‰ prefix çš„åˆ—è¡¨ã€‚æˆ‘ä»¬åªéœ€è¦å¾—åˆ°ä¸€ä¸ªä»é›¶åˆ°å­—ç¬¦ä¸²é•¿åº¦çš„ä¸€ç³»åˆ—æ•´æ•°ï¼Œç„¶åæ ¹æ®æ¯ä¸ªé•¿åº¦çš„æ•´æ•°åœ¨å­—ç¬¦ä¸²ä¸­æ‰¾åˆ°å¯¹åº”é•¿åº¦çš„ prefixï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">String</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> allPrefixes1: [<span class="type">Substring</span>] &#123;</span><br><span class="line">        <span class="keyword">return</span> (<span class="number">0</span>...<span class="keyword">self</span>.<span class="built_in">count</span>).<span class="built_in">map</span>(<span class="keyword">self</span>.<span class="keyword">prefix</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> hello = <span class="string">"Hello"</span></span><br><span class="line">hello.allPrefixes1 <span class="comment">// â†’ ["", "H", "He", "Hel", "Hell", "Hello"]</span></span><br></pre></td></tr></table></figure><p>å°½ç®¡è¿™æ®µä»£ç çœ‹èµ·æ¥å¾ˆç®€å•ï¼Œä½†æ˜¯è¿è¡Œæ€§èƒ½å¾ˆä½ã€‚å®ƒå…ˆæ˜¯éå†äº†å­—ç¬¦ä¸²ä¸€æ¬¡ï¼Œè®¡ç®—å‡ºå­—ç¬¦ä¸²çš„é•¿åº¦ï¼Œè¿™è¿˜ OKã€‚ä½†æ˜¯æ¯æ¬¡å¯¹ <a href="https://developer.apple.com/documentation/swift/substring/2893985-prefix" target="_blank" rel="noopener"><code>prefix</code></a> è¿›è¡Œ n+1 çš„è°ƒç”¨éƒ½æ˜¯ä¸€æ¬¡ <em>O(n)</em> æ“ä½œï¼Œå› ä¸º <code>prefix</code> æ–¹æ³•éœ€è¦ä»å­—ç¬¦ä¸²çš„å¼€å¤´å¾€åæ‰¾å‡ºæ‰€éœ€æ•°é‡çš„å­—ç¬¦ã€‚è€Œåœ¨ä¸€ä¸ªçº¿æ€§è¿ç®—é‡Œè¿›è¡Œå¦ä¸€ä¸ªçº¿æ€§è¿ç®—å°±æ„å‘³ç€ç®—æ³•å·²ç»æˆäº† <em>O(n2)</em> â€”â€”éšç€å­—ç¬¦ä¸²é•¿åº¦çš„å¢åŠ ï¼Œç®—æ³•æ‰€éœ€çš„æ—¶é—´æ˜¯å‘ˆæŒ‡æ•°çº§å¢é•¿çš„ã€‚</p><p>å¦‚æœå¯èƒ½çš„è¯ï¼Œä¸€ä¸ªé«˜æ€§èƒ½çš„ç®—æ³•åº”è¯¥æ˜¯éå†å­—ç¬¦ä¸²ä¸€æ¬¡ï¼Œç„¶åé€šè¿‡å¯¹å­—ç¬¦ä¸²ç´¢å¼•çš„æ“ä½œå¾—åˆ°æƒ³è¦çš„å­å­—ç¬¦ä¸²ã€‚ä¸‹é¢æ˜¯ç›¸åŒç®—æ³•çš„å¦ä¸€ä¸ªç‰ˆæœ¬ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">String</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> allPrefixes2: [<span class="type">Substring</span>] &#123;</span><br><span class="line">        <span class="keyword">return</span> [<span class="string">""</span>] + <span class="keyword">self</span>.<span class="built_in">indices</span>.<span class="built_in">map</span> &#123; index <span class="keyword">in</span> <span class="keyword">self</span>[...index] &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">hello.allPrefixes2 <span class="comment">// â†’ ["", "H", "He", "Hel", "Hell", "Hello"]</span></span><br></pre></td></tr></table></figure><p>è¿™æ®µä»£ç åªéœ€è¦éå†å­—ç¬¦ä¸²ä¸€æ¬¡ï¼Œå¾—åˆ°å­—ç¬¦ä¸²çš„ç´¢å¼•ï¼ˆ<a href="https://developer.apple.com/documentation/swift/bidirectionalcollection/1785188-indices" target="_blank" rel="noopener"><code>indices</code></a>ï¼‰é›†åˆã€‚ä¸€æ—¦å®Œæˆä¹‹åï¼Œä¹‹åå† <code>map</code> å†…çš„æ“ä½œå°±åªæ˜¯ <em>O(1)</em>ã€‚æ•´ä¸ªç®—æ³•ä¹Ÿåªæ˜¯ <em>O(n)</em>ã€‚</p><h3 id="èŒƒå›´å¯æ›¿æ¢ï¼Œä¸å¯å˜"><a href="#èŒƒå›´å¯æ›¿æ¢ï¼Œä¸å¯å˜" class="headerlink" title="èŒƒå›´å¯æ›¿æ¢ï¼Œä¸å¯å˜"></a>èŒƒå›´å¯æ›¿æ¢ï¼Œä¸å¯å˜</h3><p><code>String</code> è¿˜éµä»äº <a href="https://developer.apple.com/documentation/swift/rangereplaceablecollection" target="_blank" rel="noopener"><code>RangeReplaceableCollection</code></a> ï¼ˆèŒƒå›´å¯æ›¿æ¢ï¼‰çš„é›†åˆæ“ä½œã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä½ å¯ä»¥å…ˆæŒ‰å­—ç¬¦ä¸²ç´¢å¼•çš„å½¢å¼å®šä¹‰å‡ºä¸€ä¸ªèŒƒå›´ï¼Œç„¶åé€šè¿‡è°ƒç”¨ <a href="https://developer.apple.com/documentation/swift/string/1641462-replacesubrange" target="_blank" rel="noopener"><code>replaceSubrange</code></a> ï¼ˆæ›¿æ¢å­èŒƒå›´ï¼‰æ–¹æ³•ï¼Œæ›¿æ¢æ‰å­—ç¬¦ä¸²ä¸­çš„ä¸€äº›å­—ç¬¦ã€‚è¿™é‡Œæœ‰ä¸€ä¸ªä¾‹å­ã€‚æ›¿æ¢çš„å­—ç¬¦ä¸²å¯ä»¥æœ‰ä¸åŒçš„é•¿åº¦ï¼Œç”šè‡³è¿˜å¯ä»¥æ˜¯ç©ºçš„ï¼ˆè¿™æ—¶å€™å°±ç›¸å½“äºè°ƒç”¨ <a href="https://developer.apple.com/documentation/swift/string/2893740-removesubrange" target="_blank" rel="noopener"><code>removeSubrange</code></a> æ–¹æ³•äº†ï¼‰ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> greeting = <span class="string">"Hello, world!"</span></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">let</span> comma = greeting.index(of: <span class="string">","</span>) &#123;</span><br><span class="line">    greeting[..&lt;comma] <span class="comment">// â†’ "Hello"</span></span><br><span class="line">    greeting.replaceSubrange(comma..., with: <span class="string">" again."</span>)</span><br><span class="line">&#125;</span><br><span class="line">greeting <span class="comment">// â†’ "Hello again."</span></span><br></pre></td></tr></table></figure><p>åŒæ ·ï¼Œè¿™é‡Œä¹Ÿè¦æ³¨æ„ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚æœæ›¿æ¢çš„å­—ç¬¦ä¸²å’ŒåŸå­—ç¬¦ä¸²ä¸­ç›¸é‚»çš„å­—ç¬¦å½¢æˆäº†æ–°çš„å­—ä½é›†ï¼Œé‚£ç»“æœå¯èƒ½å°±ä¼šæœ‰ç‚¹å‡ºäººæ„æ–™äº†ã€‚</p><p>å­—ç¬¦ä¸²æ— æ³•æä¾›çš„ä¸€ä¸ªç±»é›†åˆç‰¹æ€§æ˜¯ï¼š<a href="https://developer.apple.com/documentation/swift/mutablecollection" target="_blank" rel="noopener"><code>MutableCollection</code></a>ã€‚è¯¥åè®®ç»™é›†åˆé™¤ <code>get</code> ä¹‹å¤–ï¼Œæ·»åŠ äº†ä¸€ä¸ªé€šè¿‡ä¸‹æ ‡è¿›è¡Œå•ä¸€å…ƒç´  <code>set</code> çš„ç‰¹æ€§ã€‚è¿™å¹¶ä¸æ˜¯è¯´å­—ç¬¦ä¸²æ˜¯ä¸å¯å˜çš„â€”â€”æˆ‘ä»¬ä¸Šé¢å·²ç»çœ‹åˆ°äº†ï¼Œæœ‰å¥½å‡ ç§å˜åŒ–çš„æ–¹æ³•ã€‚ä½ æ— æ³•å®Œæˆçš„æ˜¯ä½¿ç”¨ä¸‹æ ‡æ“ä½œç¬¦æ›¿æ¢å…¶ä¸­çš„ä¸€ä¸ªå­—ç¬¦ã€‚è®¸å¤šäººç›´è§‰è®¤ä¸ºç”¨ä¸‹æ ‡æ“ä½œç¬¦æ›¿æ¢ä¸€ä¸ªå­—ç¬¦æ˜¯å³æ—¶å‘ç”Ÿçš„ï¼Œå°±åƒæ•°ç»„ <a href="https://developer.apple.com/documentation/swift/array" target="_blank" rel="noopener"><code>Array</code></a> é‡Œé¢çš„æ›¿æ¢ä¸€æ ·ã€‚ä½†æ˜¯ï¼Œå› ä¸ºå­—ç¬¦ä¸²é‡Œçš„å­—ç¬¦é•¿åº¦æ˜¯ä¸å®šçš„ï¼Œæ‰€ä»¥æ›¿æ¢ä¸€ä¸ªå­—ç¬¦çš„æ—¶é—´å’Œå­—ç¬¦ä¸²çš„é•¿åº¦å‘ˆçº¿æ€§å…³ç³»ï¼šæ›¿æ¢ä¸€ä¸ªå…ƒç´ çš„å®½åº¦ä¼šæŠŠå…¶ä»–æ‰€æœ‰å…ƒç´ åœ¨å†…å­˜ä¸­çš„ä½ç½®é‡æ–°æ´—ç‰Œã€‚è€Œä¸”ï¼Œæ›¿æ¢å…ƒç´ ç´¢å¼•åé¢çš„å…ƒç´ ç´¢å¼•åœ¨æ´—ç‰Œä¹‹åéƒ½å˜äº†ï¼Œè¿™ä¹Ÿæ˜¯è·Ÿäººä»¬çš„ç›´è§‰ç›¸è¿èƒŒçš„ã€‚å‡ºäºè¿™äº›åŸå› ï¼Œä½ å¿…é¡»ä½¿ç”¨ <code>replaceSubrange</code> è¿›è¡Œæ›¿æ¢ï¼Œå³ä½¿ä½ å˜åŒ–åªæ˜¯ä¸€ä¸ªå…ƒç´ ã€‚</p><h2 id="å­—ç¬¦ä¸²ç´¢å¼•"><a href="#å­—ç¬¦ä¸²ç´¢å¼•" class="headerlink" title="å­—ç¬¦ä¸²ç´¢å¼•"></a>å­—ç¬¦ä¸²ç´¢å¼•</h2><p>å¤§å¤šæ•°ç¼–ç¨‹è¯­è¨€éƒ½æ˜¯ç”¨æ•´æ•°ä½œä¸ºå­—ç¬¦ä¸²çš„ä¸‹æ ‡ï¼Œä¾‹å¦‚ <code>str[5]</code> å°±ä¼šè¿”å› <code>str</code> çš„ç¬¬å…­ä¸ªâ€œå­—ç¬¦â€ï¼ˆæ— è®ºè¿™ä¸ªè¯­è¨€å®šä¹‰çš„â€œå­—ç¬¦â€æ˜¯ä»€ä¹ˆï¼‰ã€‚Swift å´ä¸å…è®¸è¿™æ ·ã€‚ä¸ºä»€ä¹ˆå‘¢ï¼ŸåŸå› å¯èƒ½ä½ å·²ç»å¬äº†å¾ˆå¤šéäº†ï¼šä¸‹æ ‡åº”è¯¥æ˜¯ä½¿ç”¨å›ºå®šæ—¶é—´çš„(æ— è®ºæ˜¯ç›´è§‰ä¸Šï¼Œè¿˜æ˜¯æ ¹æ®é›†åˆåè®®)ï¼Œä½†æ˜¯æŸ¥è¯¢ç¬¬ n ä¸ªâ€œå­—ç¬¦â€çš„æ“ä½œå¿…é¡»æŸ¥è¯¢å®ƒå‰é¢æ‰€æœ‰çš„å­—èŠ‚ã€‚</p><p><a href="https://developer.apple.com/documentation/swift/string.index" target="_blank" rel="noopener">å­—ç¬¦ä¸²ç´¢å¼•ï¼ˆ<code>String.Index</code>ï¼‰</a> æ˜¯å­—ç¬¦ä¸²åŠå…¶è§†å›¾ä½¿ç”¨çš„ç´¢å¼•ç±»å‹ã€‚å®ƒæ˜¯ä¸ªä¸é€æ˜å€¼ï¼ˆopaque valueï¼Œå†…éƒ¨ä½¿ç”¨çš„å€¼ï¼Œå¼€å‘è€…ä¸€èˆ¬ä¸ç›´æ¥ä½¿ç”¨ï¼‰ï¼Œæœ¬è´¨ä¸Šå­˜å‚¨çš„æ˜¯ä»å­—ç¬¦ä¸²å¼€å¤´ç®—èµ·çš„å­—èŠ‚åç§»é‡ã€‚å¦‚æœä½ æƒ³è®¡ç®—ç¬¬ n ä¸ªå­—ç¬¦çš„ç´¢å¼•ï¼Œå®ƒè¿˜æ˜¯ä¸€ä¸ª <em>O(n)</em> çš„æ“ä½œï¼Œè€Œä¸”ä½ è¿˜æ˜¯å¿…é¡»ä»å­—ç¬¦ä¸²çš„å¼€å¤´å¼€å§‹ç®—èµ·ï¼Œä½†æ˜¯ä¸€æ—¦ä½ æœ‰äº†ä¸€ä¸ªæ­£ç¡®çš„ç´¢å¼•ä¹‹åï¼Œå¯¹è¿™ä¸ªå­—ç¬¦ä¸²è¿›è¡Œä¸‹æ ‡æ“ä½œå°±åªéœ€è¦ <em>O(1)</em> æ¬¡äº†ã€‚å…³é”®æ˜¯ï¼Œæ‰¾åˆ°ç°æœ‰ç´¢å¼•åé¢çš„å…ƒç´ çš„ç´¢å¼•çš„æ“ä½œä¹Ÿä¼šå˜å¾—å¾ˆå¿«ï¼Œå› ä¸ºä½ åªéœ€è¦ä»å·²æœ‰ç´¢å¼•å­—èŠ‚åé¢å¼€å§‹ç®—èµ·äº†â€”â€”æ²¡æœ‰å¿…è¦ä»å­—ç¬¦ä¸²å¼€å¤´å¼€å§‹äº†ã€‚è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆæœ‰åºï¼ˆå‘å‰æˆ–æ˜¯å‘åï¼‰è®¿é—®å­—ç¬¦ä¸²é‡Œçš„å­—ç¬¦æ•ˆç‡å¾ˆé«˜çš„åŸå› ã€‚</p><p>å­—ç¬¦ä¸²ç´¢å¼•æ“ä½œçš„ä¾æ®è·Ÿä½ åœ¨å…¶ä»–é›†åˆé‡Œä½¿ç”¨çš„æ‰€æœ‰ API ä¸€æ ·ã€‚å› ä¸ºæˆ‘ä»¬æœ€å¸¸ç”¨çš„é›†åˆï¼šæ•°ç»„ï¼Œä½¿ç”¨çš„æ˜¯æ•´æ•°ç´¢å¼•ï¼Œæˆ‘ä»¬é€šå¸¸ä½¿ç”¨ç®€å•çš„ç®—æœ¯æ¥æ“ä½œï¼Œæ‰€ä»¥æœ‰ä¸€ç‚¹å¾ˆå®¹æ˜“å¿˜è®°ï¼š <a href="https://developer.apple.com/documentation/swift/string/1782583-index" target="_blank" rel="noopener"><code>index(after:)</code></a> æ–¹æ³•è¿”å›çš„æ˜¯ä¸‹ä¸€ä¸ªå­—ç¬¦çš„ç´¢å¼•ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> s = <span class="string">"abcdef"</span></span><br><span class="line"><span class="keyword">let</span> second = s.index(after: s.startIndex)</span><br><span class="line">s[second] <span class="comment">// â†’ "b"</span></span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ <a href="https://developer.apple.com/documentation/swift/string/1786175-index" target="_blank" rel="noopener"><code>index(_:offsetBy:)</code></a>æ–¹æ³•ï¼Œä½ å¯ä»¥é€šè¿‡ä¸€æ¬¡æ“ä½œï¼Œè‡ªåŠ¨åœ°è®¿é—®å¤šä¸ªå­—ç¬¦ï¼Œ</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Advance 4 more characters</span></span><br><span class="line"><span class="keyword">let</span> sixth = s.index(second, offsetBy: <span class="number">4</span>)</span><br><span class="line">s[sixth] <span class="comment">// â†’ "f"</span></span><br></pre></td></tr></table></figure><p>å¦‚æœå¯èƒ½è¶…å‡ºå­—ç¬¦ä¸²æœ«å°¾ï¼Œä½ å¯ä»¥åŠ ä¸€ä¸ª <a href="https://developer.apple.com/documentation/swift/anybidirectionalcollection/1781464-index" target="_blank" rel="noopener"><code>limitedBy:</code></a> å‚æ•°ã€‚å¦‚æœåœ¨è®¿é—®åˆ°ç›®æ ‡ç´¢å¼•ä¹‹å‰åˆ°è¾¾äº†å­—ç¬¦ä¸²çš„æœ«å°¾ï¼Œè¿™ä¸ªæ–¹æ³•ä¼šè¿”å›ä¸€ä¸ª <code>nil</code> å€¼ã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> safeIdx = s.index(s.startIndex, offsetBy: <span class="number">400</span>, limitedBy: s.endIndex)</span><br><span class="line">safeIdx <span class="comment">// â†’ nil</span></span><br></pre></td></tr></table></figure><p>æ¯”èµ·ç®€å•çš„æ•´æ•°ç´¢å¼•ï¼Œè¿™æ— ç–‘ä½¿ç”¨äº†æ›´å¤šçš„ä»£ç ã€‚<strong>è¿™æ˜¯ Swift æ•…æ„çš„ã€‚</strong>å¦‚æœ Swift å…è®¸å¯¹å­—ç¬¦ä¸²è¿›è¡Œæ•´æ•°ç´¢å¼•ï¼Œé‚£ä¸å°å¿ƒå†™å‡ºæ€§èƒ½çƒ‚åˆ°çˆ†çš„ä»£ç ï¼ˆæ¯”å¦‚åœ¨ä¸€ä¸ªå¾ªç¯ä¸­ä½¿ç”¨æ•´æ•°çš„ä¸‹æ ‡æ“ä½œï¼‰çš„è¯±æƒ‘å¤ªå¤§äº†ã€‚</p><p>ç„¶è€Œï¼Œå¯¹ä¸€ä¸ªä¹ æƒ¯äºå¤„ç†å›ºå®šå®½åº¦å­—ç¬¦çš„äººæ¥è¯´ï¼Œåˆšå¼€å§‹ä½¿ç”¨ Swift å¤„ç†å­—ç¬¦ä¸²ä¼šæœ‰äº›æŒ‘æˆ˜â€”â€”æ²¡æœ‰äº†æ•´æ•°ç´¢å¼•æ€ä¹ˆæï¼Ÿè€Œä¸”ç¡®å®ï¼Œä¸€äº›çœ‹èµ·æ¥ç®€å•çš„ä»»åŠ¡å¤„ç†èµ·æ¥è¿˜å¾—å¤§åŠ¨å¹²æˆˆï¼Œæ¯”å¦‚æå–å­—ç¬¦ä¸²çš„å‰å››ä¸ªå­—ç¬¦ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">s[..&lt;s.index(s.startIndex, offsetBy: <span class="number">4</span>)] <span class="comment">// â†’ "abcd"</span></span><br></pre></td></tr></table></figure><p>ä¸è¿‡è°¢å¤©è°¢åœ°ï¼Œä½ å¯ä»¥ä½¿ç”¨é›†åˆçš„æ¥å£æ¥è·å–å­—ç¬¦ä¸²ï¼Œè¿™æ„å‘³ç€è®¸å¤šé€‚ç”¨äºæ•°ç»„çš„æ–¹æ³•åŒæ ·ä¹Ÿé€‚ç”¨äºå­—ç¬¦ä¸²ã€‚æ¯”å¦‚ä¸Šé¢é‚£ä¸ªä¾‹å­ï¼Œå¦‚æœä½¿ç”¨ <code>prefix</code> æ–¹æ³•å°±ç®€å•å¾—å¤šäº†ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">s.<span class="keyword">prefix</span>(<span class="number">4</span>) <span class="comment">// â†’ "abcd"</span></span><br></pre></td></tr></table></figure><p>ï¼ˆæ³¨æ„ï¼Œä¸Šé¢çš„å‡ ä¸ªæ–¹æ³•è¿”å›çš„éƒ½æ˜¯å­å­—ç¬¦ä¸² <a href="https://developer.apple.com/documentation/swift/substring" target="_blank" rel="noopener"><code>Substring</code></a>ï¼Œä½ å¯ä»¥ä½¿ç”¨ä¸€ä¸ª <code>String.init</code> æŠŠå®ƒè½¬æ¢ä¸ºå­—ç¬¦ä¸²ã€‚å…³äºè¿™ä¸€éƒ¨åˆ†ï¼Œæˆ‘ä»¬ä¸‹ä¸€éƒ¨åˆ†ä¼šè®²æ›´å¤šã€‚ï¼‰</p><p>æ²¡æœ‰æ•´æ•°ç´¢å¼•ï¼Œå¾ªç¯è®¿é—®å­—ç¬¦ä¸²é‡Œçš„å­—ç¬¦ä¹Ÿå¾ˆç®€å•ï¼Œç”¨ <code>for</code> å¾ªç¯ã€‚å¦‚æœä½ æƒ³æŒ‰é¡ºåºæ’åˆ—ï¼Œä½¿ç”¨ <a href="https://developer.apple.com/documentation/swift/sequence/1641222-enumerated" target="_blank" rel="noopener"><code>enumerated()</code></a>ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> (i, <span class="built_in">c</span>) <span class="keyword">in</span> s.enumerated() &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"<span class="subst">\(i)</span>: <span class="subst">\(<span class="built_in">c</span>)</span>"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ–è€…å¦‚æœä½ æƒ³æ‰¾åˆ°ä¸€ä¸ªç‰¹å®šçš„å­—ç¬¦ï¼Œä½ å¯ä»¥ä½¿ç”¨ <a href="https://developer.apple.com/documentation/swift/string/2893264-index" target="_blank" rel="noopener"><code>index(of:)</code></a>:</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> hello = <span class="string">"Hello!"</span></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">let</span> idx = hello.index(of: <span class="string">"!"</span>) &#123;</span><br><span class="line">    hello.insert(contentsOf: <span class="string">", world"</span>, at: idx)</span><br><span class="line">&#125;</span><br><span class="line">hello <span class="comment">// â†’ "Hello, world!"</span></span><br></pre></td></tr></table></figure><p><a href="https://developer.apple.com/documentation/swift/string/2893571-insert" target="_blank" rel="noopener"><code>insert(contentsOf:at:)</code></a> æ–¹æ³•å¯ä»¥åœ¨æŒ‡å®šç´¢å¼•å‰æ’å…¥ç›¸åŒç±»å‹çš„å¦ä¸€ä¸ªé›†åˆï¼ˆæ¯”å¦‚è¯´å­—ç¬¦ä¸²é‡Œçš„å­—ç¬¦ï¼‰ã€‚å¹¶ä¸ä¸€å®šæ˜¯å¦ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œä½ å¯ä»¥å¾ˆå®¹æ˜“åœ°æŠŠä¸€ä¸ªå­—ç¬¦çš„æ•°ç»„æ’å…¥åˆ°ä¸€ä¸ªå­—ç¬¦ä¸²é‡Œã€‚</p><h2 id="å­å­—ç¬¦ä¸²"><a href="#å­å­—ç¬¦ä¸²" class="headerlink" title="å­å­—ç¬¦ä¸²"></a>å­å­—ç¬¦ä¸²</h2><p>å’Œå…¶ä»–çš„é›†åˆä¸€æ ·ï¼Œå­—ç¬¦ä¸²æœ‰ä¸€ä¸ªç‰¹å®šçš„åˆ‡ç‰‡ç±»å‹æˆ–è€…è¯´å­åºåˆ—ç±»å‹ï¼ˆ<a href="https://developer.apple.com/documentation/swift/collection/1641276-subsequence" target="_blank" rel="noopener"><code>SubSequence</code></a>ï¼‰ï¼šå­å­—ç¬¦ä¸²ï¼ˆ<a href="https://developer.apple.com/documentation/swift/substring" target="_blank" rel="noopener"><code>Substring</code></a>ï¼‰ã€‚å­å­—ç¬¦ä¸²å°±åƒæ˜¯ä¸€ä¸ªæ•°ç»„åˆ‡ç‰‡ï¼ˆ<a href="https://developer.apple.com/documentation/swift/arrayslice" target="_blank" rel="noopener"><code>ArraySlice</code></a>ï¼‰ï¼šå®ƒæ˜¯åŸå­—ç¬¦ä¸²çš„ä¸€ä¸ªè§†å›¾ï¼Œèµ·å§‹ç´¢å¼•å’Œç»“æŸç´¢å¼•ä¸åŒã€‚å­å­—ç¬¦ä¸²å…±äº«åŸå­—ç¬¦ä¸²çš„æ–‡æœ¬å­˜å‚¨ç©ºé—´ã€‚è¿™æ˜¯ä¸€ä¸ªå¾ˆå¤§çš„ä¼˜åŠ¿ï¼Œå¯¹ä¸€ä¸ªå­—ç¬¦ä¸²è¿›è¡Œåˆ‡ç‰‡æ“ä½œä¸å ç”¨å†…å­˜ç©ºé—´ã€‚åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œåˆ›å»º<code>firstWord</code>å˜é‡ä¸å ç”¨å†…å­˜ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> sentence = <span class="string">"The quick brown fox jumped over the lazy dog."</span></span><br><span class="line"><span class="keyword">let</span> firstSpace = sentence.index(of: <span class="string">" "</span>) ?? sentence.endIndex</span><br><span class="line"><span class="keyword">let</span> firstWord = sentence[..&lt;firstSpace] <span class="comment">// â†’ "The"</span></span><br><span class="line">type(of: firstWord) <span class="comment">// â†’ Substring.Type</span></span><br></pre></td></tr></table></figure><p>åˆ‡ç‰‡æ“ä½œä¸å ç”¨å†…å­˜æ„ä¹‰é‡å¤§ï¼Œç‰¹åˆ«æ˜¯åœ¨ä¸€ä¸ªå¾ªç¯ä¸­ï¼Œæ¯”å¦‚ä½ è¦é€šè¿‡å¾ªç¯è®¿é—®æ•´ä¸ªå­—ç¬¦ä¸²ï¼ˆå¯èƒ½ä¼šå¾ˆé•¿ï¼‰æ¥æå–å…¶ä¸­çš„å­—ç¬¦ã€‚æ¯”å¦‚åœ¨æ–‡æœ¬ä¸­æ‰¾åˆ°ä¸€ä¸ªå•è¯ä½¿ç”¨çš„æ¬¡æ•°ï¼Œæ¯”å¦‚è§£æä¸€ä¸ª CSV æ–‡ä»¶ã€‚è¿™é‡Œæœ‰ä¸€ä¸ªéå¸¸æœ‰ç”¨çš„å­—ç¬¦ä¸²å¤„ç†æ“ä½œï¼šsplitã€‚<code>split</code> æ˜¯ <code>Collection</code> é›†åˆä¸­å®šä¹‰çš„ä¸€ä¸ªæ–¹æ³•ï¼Œå®ƒä¼šè¿”å›ä¸€ä¸ªå­åºåˆ—çš„æ•°ç»„ï¼ˆå³ <code>[Substring]</code> ï¼‰ã€‚å®ƒæœ€å¸¸è§çš„å˜ç§å°±åƒæ˜¯è¿™æ ·ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Collection</span> <span class="title">where</span> <span class="title">Element</span>: <span class="title">Equatable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">split</span><span class="params">(separator: Element, maxSplits: Int = Int.<span class="built_in">max</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">        omittingEmptySubsequences: Bool = <span class="literal">true</span>)</span></span> -&gt; [<span class="type">SubSequence</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½ å¯ä»¥è¿™æ ·ä½¿ç”¨ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> poem = <span class="string">""</span><span class="string">"</span></span><br><span class="line"><span class="string">    Over the wintry</span></span><br><span class="line"><span class="string">    forest, winds howl in rage</span></span><br><span class="line"><span class="string">    with no leaves to blow.</span></span><br><span class="line"><span class="string">    "</span><span class="string">""</span></span><br><span class="line"><span class="keyword">let</span> lines = poem.<span class="built_in">split</span>(separator: <span class="string">"\n"</span>)</span><br><span class="line"><span class="comment">// â†’ ["Over the wintry", "forest, winds howl in rage", "with no leaves to blow."]</span></span><br><span class="line">type(of: lines) <span class="comment">// â†’ Array&lt;Substring&gt;.Type</span></span><br></pre></td></tr></table></figure><p>è¿™ä¸ªè·Ÿ <code>String</code> ç»§æ‰¿è‡ª <code>NSString</code> çš„ <a href="https://developer.apple.com/documentation/swift/stringprotocol/2923413-components" target="_blank" rel="noopener"><code>components(separatedBy:)</code></a> æ–¹æ³•çš„åŠŸèƒ½ç±»ä¼¼ï¼Œä½ è¿˜å¯ä»¥ç”¨ä¸€äº›é¢å¤–è®¾ç½®æ¯”å¦‚æ˜¯å¦æŠ›å¼ƒç©ºçš„ç»„ä»¶ã€‚è€Œä¸”åœ¨è¿™ä¸ªæ“ä½œä¸­ï¼Œæ‰€æœ‰è¾“å…¥å­—ç¬¦ä¸²éƒ½æ²¡æœ‰åˆ›å»ºæ–°çš„å¤åˆ¶ã€‚å› ä¸ºè¿˜æœ‰å…¶ä»–<code>split</code>æ–¹æ³•çš„å˜ç§å¯ä»¥å®Œæˆæ“ä½œï¼Œé™¤äº†æ¯”è¾ƒå­—ç¬¦ä»¥å¤–ï¼Œ<code>split</code> è¿˜å¯ä»¥å®Œæˆæ›´å¤šçš„äº‹æƒ…ã€‚ä¸‹é¢è¿™ä¸ªä¾‹å­æ˜¯æ–‡æœ¬æ¢è¡Œç®—æ³•çš„ä¸€ä¸ªåŸå§‹çš„å®ç°ï¼Œæœ€åçš„ä»£ç è®¡ç®—äº†è¡Œçš„é•¿åº¦ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">String</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">wrapped</span><span class="params">(after: Int = <span class="number">70</span>)</span></span> -&gt; <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> i = <span class="number">0</span></span><br><span class="line">        <span class="keyword">let</span> lines = <span class="keyword">self</span>.<span class="built_in">split</span>(omittingEmptySubsequences: <span class="literal">false</span>) &#123;</span><br><span class="line">            character <span class="keyword">in</span></span><br><span class="line">            <span class="keyword">switch</span> character &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">"\n"</span>, <span class="string">" "</span> <span class="keyword">where</span> i &gt;= after:</span><br><span class="line">                i = <span class="number">0</span></span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                i += <span class="number">1</span></span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> lines.joined(separator: <span class="string">"\n"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">sentence.wrapped(after: <span class="number">15</span>)</span><br><span class="line"><span class="comment">// â†’ "The quick brown\nfox jumped over\nthe lazy dog."</span></span><br></pre></td></tr></table></figure><p>æˆ–è€…ï¼Œè€ƒè™‘å†™å¦å¤–ä¸€ä¸ªç‰ˆæœ¬ï¼Œå¯ä»¥æ‹¿åˆ°ä¸€ä¸ªåŒ…å«å¤šä¸ªåˆ†éš”ç¬¦çš„åºåˆ—ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Collection</span> <span class="title">where</span> <span class="title">Element</span>: <span class="title">Equatable</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">split</span>&lt;S: Sequence&gt;<span class="params">(separators: S)</span></span> -&gt; [<span class="type">SubSequence</span>]</span><br><span class="line">        <span class="keyword">where</span> <span class="type">Element</span> == <span class="type">S</span>.<span class="type">Element</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">split</span> &#123; separators.<span class="built_in">contains</span>($<span class="number">0</span>) &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·çš„è¯ï¼Œä½ è¿˜å¯ä»¥è¿™ä¹ˆå†™ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="string">"Hello, world!"</span>.<span class="built_in">split</span>(separators: <span class="string">",! "</span>) <span class="comment">// â†’ ["Hello", "world"]</span></span><br></pre></td></tr></table></figure><h3 id="å­—ç¬¦ä¸²åè®®-StringProtocol"><a href="#å­—ç¬¦ä¸²åè®®-StringProtocol" class="headerlink" title="å­—ç¬¦ä¸²åè®® StringProtocol"></a>å­—ç¬¦ä¸²åè®® <code>StringProtocol</code></h3><p><code>Substring</code> å’Œ <code>String</code> å‡ ä¹æœ‰ç€ç›¸åŒçš„æ¥å£ï¼Œå› ä¸ºä¸¤ç§ç±»å‹éƒ½éµå®ˆä¸€ä¸ªå…±åŒçš„å­—ç¬¦ä¸²åè®®ï¼ˆ<a href="https://developer.apple.com/documentation/swift/stringprotocol" target="_blank" rel="noopener"><code>StringProtocol</code></a>ï¼‰ã€‚å› ä¸ºå‡ ä¹æ‰€æœ‰çš„å­—ç¬¦ä¸²API éƒ½æ˜¯åœ¨ <a href="https://developer.apple.com/documentation/swift/stringprotocol" target="_blank" rel="noopener"><code>StringProtocol</code></a> ä¸­å®šä¹‰çš„ï¼Œæ‰€ä»¥æ“ä½œ <code>Substring</code> è·Ÿæ“ä½œ <code>String</code> æ²¡æœ‰ä»€ä¹ˆå¤§çš„åŒºåˆ«ã€‚ä½†æ˜¯ï¼Œåœ¨æœ‰äº›æƒ…å†µä¸‹ï¼Œä½ è¿˜å¿…é¡»æŠŠå­å­—ç¬¦ä¸²è½¬æ¢ä¸ºå­—ç¬¦ä¸²çš„ç±»å‹ï¼›å°±åƒæ‰€æœ‰çš„åˆ‡ç‰‡ï¼ˆsliceï¼‰ä¸€æ ·ï¼Œå­å­—ç¬¦ä¸²åªæ˜¯ä¸ºäº†çŸ­æ—¶é—´å†…çš„å­˜å‚¨ï¼Œä¸ºäº†é˜²æ­¢ä¸€æ¬¡æ“ä½œå®šä¹‰å¤ªå¤šä¸ªå¤åˆ¶ã€‚å¦‚æœæ“ä½œç»“æŸä¹‹åï¼Œä½ è¿˜æƒ³ä¿ç•™ç»“æœï¼Œå°†æ•°æ®ä¼ åˆ°å¦ä¸€ä¸ªå­ç³»ç»Ÿé‡Œï¼Œä½ åº”è¯¥åˆ›å»ºä¸€ä¸ªæ–°çš„å­—ç¬¦ä¸²ã€‚ä½ å¯ä»¥ç”¨ä¸€ä¸ª <code>Substring</code> çš„å€¼åˆå§‹åŒ–ä¸€ä¸ª <code>String</code>ï¼Œå°±åƒæˆ‘ä»¬åœ¨è¿™ä¸ªä¾‹å­ä¸­åšçš„ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">lastWord</span><span class="params">(<span class="keyword">in</span> input: String)</span></span> -&gt; <span class="type">String</span>? &#123;</span><br><span class="line">    <span class="comment">// Process the input, working on substrings</span></span><br><span class="line">    <span class="keyword">let</span> words = input.<span class="built_in">split</span>(separators: [<span class="string">","</span>, <span class="string">" "</span>])</span><br><span class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> lastWord = words.last <span class="keyword">else</span> &#123; <span class="keyword">return</span> <span class="literal">nil</span> &#125;</span><br><span class="line">    <span class="comment">// Convert to String for return</span></span><br><span class="line">    <span class="keyword">return</span> <span class="type">String</span>(lastWord)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">lastWord(<span class="keyword">in</span>: <span class="string">"one, two, three, four, five"</span>) <span class="comment">// â†’ "five"</span></span><br></pre></td></tr></table></figure><p>ä¸å»ºè®®å­å­—ç¬¦ä¸²é•¿æœŸå­˜å‚¨èƒŒåçš„åŸå› æ˜¯å­å­—ç¬¦ä¸²ä¸€ç›´å…³è”ç€åŸå­—ç¬¦ä¸²ã€‚å³ä½¿ä¸€ä¸ªè¶…é•¿å­—ç¬¦ä¸²çš„å­å­—ç¬¦ä¸²åªæœ‰ä¸€ä¸ªå­—ç¬¦ï¼Œåªè¦å­å­—ç¬¦ä¸²è¿˜åœ¨ä½¿ç”¨ï¼Œé‚£åŸå…ˆçš„å­—ç¬¦ä¸²å°±è¿˜ä¼šåœ¨å†…å­˜é‡Œï¼Œå³ä½¿åŸå­—ç¬¦ä¸²çš„ç”Ÿå‘½å‘¨æœŸå·²ç»ç»“æŸã€‚å› æ­¤ï¼Œé•¿æœŸå­˜å‚¨å­å­—ç¬¦ä¸²å¯èƒ½å¯¼è‡´å†…å­˜æ³„æ¼ï¼Œå› ä¸ºæœ‰æ—¶å€™åŸå­—ç¬¦ä¸²å·²ç»æ— æ³•è®¿é—®äº†ï¼Œä½†æ˜¯è¿˜åœ¨å ç”¨å†…å­˜ã€‚</p><p>æ“ä½œè¿‡ç¨‹ä¸­ä½¿ç”¨å­å­—ç¬¦ä¸²ï¼Œæ“ä½œç»“æŸçš„æ—¶å€™æ‰åˆ›å»ºæ–°çš„å­—ç¬¦ä¸²ï¼Œé€šè¿‡è¿™ç§æ–¹å¼ï¼Œæˆ‘ä»¬æŠŠå ç”¨å†…å­˜çš„åŠ¨ä½œæ¨è¿Ÿåˆ°äº†æœ€åä¸€åˆ»ï¼Œè€Œä¸”ä¿è¯äº†æˆ‘ä»¬åªä¼šåˆ›å»ºå¿…è¦çš„å­—ç¬¦ä¸²ã€‚åœ¨ä¸Šé¢çš„ä¾‹å­å½“ä¸­ï¼Œæˆ‘ä»¬æŠŠæ•´ä¸ªå­—ç¬¦ä¸²ï¼ˆå¯èƒ½ä¼šå¾ˆé•¿ï¼‰åˆ†æˆäº†ä¸€ä¸ªä¸ªçš„å­å­—ç¬¦ä¸²ï¼Œä½†æ˜¯åœ¨æœ€ååªæ˜¯åˆ›å»ºäº†ä¸€ä¸ªå¾ˆçŸ­çš„å­—ç¬¦ä¸²ã€‚ï¼ˆä¾‹å­ä¸­çš„ç®—æ³•å¯èƒ½æ•ˆç‡ä¸æ˜¯é‚£ä¹ˆé«˜ï¼Œæš‚æ—¶å¿½ç•¥ä¸€ä¸‹ï¼›ä»åå…ˆå‰æ‰¾åˆ°ç¬¬ä¸€ä¸ªåˆ†éš”ç¬¦å¯èƒ½æ˜¯ä¸ªæ›´å¥½çš„æ–¹æ³•ã€‚ï¼‰</p><p>é‡åˆ°åªæ¥å— <code>Substring</code> ç±»å‹çš„æ–¹æ³•ï¼Œä½†æ˜¯ä½ æƒ³ä¼ é€’ä¸€ä¸ª <code>String</code> çš„ç±»å‹ï¼Œè¿™ç§æƒ…å†µå¾ˆå°‘è§ï¼ˆå¤§éƒ¨åˆ†çš„æ–¹æ³•éƒ½æ¥å— <code>String</code> ç±»å‹æˆ–è€…æ¥å—æ‰€æœ‰ç¬¦åˆå­—ç¬¦ä¸²åè®®çš„ç±»å‹ï¼‰ï¼Œä½†æ˜¯å¦‚æœä½ ç¡®å®éœ€è¦ä¼ é€’ä¸€ä¸ª <code>String</code> çš„ç±»å‹ï¼Œæœ€ä¾¿æ·çš„æ–¹æ³•æ˜¯ä½¿ç”¨èŒƒå›´æ“ä½œç¬¦ï¼š<code>...</code>ï¼ˆrange operatorï¼‰ï¼Œä¸é™å®šèŒƒå›´ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å­å­—ç¬¦ä¸²å’ŒåŸå­—ç¬¦ä¸²çš„èµ·å§‹å’Œç»“æŸçš„ç´¢å¼•å®Œå…¨ä¸€è‡´ </span></span><br><span class="line"><span class="keyword">let</span> substring = sentence[...]</span><br></pre></td></tr></table></figure><hr><p><code>Substring</code> ç±»å‹æ˜¯ Swift 4 ä¸­çš„æ–°ç‰¹æ€§ã€‚åœ¨ Swift 3 ä¸­ï¼Œ<code>String.CharacterView</code> æ˜¯è‡ªå·±ç‹¬æœ‰çš„åˆ‡ç‰‡ç±»å‹ï¼ˆslice typeï¼‰ã€‚è¿™ä¹ˆåšçš„ä¼˜åŠ¿æ˜¯ç”¨æˆ·åªéœ€è¦äº†è§£ä¸€ç§ç±»å‹ï¼Œä½†è¿™ä¹Ÿæ„å‘³è¿™å¦‚æœå­˜å‚¨ä¸€ä¸ªå­å­—ç¬¦ä¸²ï¼Œæ•´ä¸ªåŸå­—ç¬¦ä¸²ä¹Ÿä¼šå æ®å†…å­˜ï¼Œå³ä½¿å®ƒæ­£å¸¸æƒ…å†µä¸‹åº”è¯¥å·²ç»è¢«é‡Šæ”¾äº†ã€‚Swift 4 æŸå¤±äº†ä¸€ç‚¹ä¾¿æ·ï¼Œæ¢æ¥çš„æ˜¯çš„æ–¹ä¾¿çš„åˆ‡ç‰‡æ“ä½œå’Œå¯é¢„æµ‹çš„å†…å­˜ä½¿ç”¨ã€‚</p><p>è¦æ±‚ <code>Substring</code> åˆ° <code>String</code> çš„è½¬æ¢å¿…é¡»æ˜ç¡®å†™å‡ºï¼ŒSwift å›¢é˜Ÿè®¤ä¸ºè¿™æ²¡é‚£ä¹ˆçƒ¦äººã€‚å¦‚æœå®é™…åº”ç”¨ä¸­å¤§å®¶éƒ½è§‰å¾—é—®é¢˜å¾ˆå¤§ï¼Œä»–ä»¬ä¹Ÿä¼šè€ƒè™‘ç›´æ¥åœ¨ç¼–è¯‘å™¨ä¸­å†™ä¸€ä¸ª <code>Substring</code> å’Œ <code>String</code> ä¹‹é—´çš„<a href="https://github.com/apple/swift/blob/master/docs/StringManifesto.md#substrings" target="_blank" rel="noopener">æ¨¡ç³Šå­ç±»å‹å…³ç³»ï¼ˆimplicit subtype relationshipï¼‰</a>ï¼Œå°±åƒ <code>Int</code> æ˜¯ <code>Optional&lt;Int&gt;</code> çš„å­ç±»å‹ä¸€æ ·ã€‚è¿™æ ·ä½ å°±å¯ä»¥éšæ„ä¼ é€’ <code>Substring</code> ç±»å‹ï¼Œç¼–è¯‘å™¨ä¼šå¸®ä½ å®Œæˆç±»å‹è½¬æ¢ã€‚</p><hr><p>ä½ å¯èƒ½ä¼šå€¾å‘äºå……åˆ†åˆ©ç”¨å­—ç¬¦ä¸²åè®®ï¼ŒæŠŠä½ æ‰€æœ‰çš„ API å†™æˆæ¥å—æ‰€æœ‰éµå®ˆå­—ç¬¦ä¸²åè®®çš„å®ä¾‹ï¼Œè€Œä¸æ˜¯ä»…ä»…æ¥å— <code>String</code> å­—ç¬¦ä¸²ã€‚ä½† Swift å›¢é˜Ÿçš„å»ºè®®æ˜¯ï¼Œ<a href="https://lists.swift.org/pipermail/swift-evolution/Week-of-Mon-20170626/037828.html" target="_blank" rel="noopener">åˆ«è¿™æ ·</a>ï¼š</p><blockquote><p>æ€»çš„æ¥è¯´ï¼Œæˆ‘ä»¬å»ºè®®ç»§ç»­ä½¿ç”¨å­—ç¬¦ä¸²å˜é‡ã€‚ ä½¿ç”¨å­—ç¬¦ä¸²å˜é‡ï¼Œå¤§å¤šæ•°çš„ API éƒ½ä¼šæ¯”æŠŠå®ƒä»¬å†™æˆé€šç”¨ç±»å‹ï¼ˆè¿™ä¸ªæ“ä½œæœ¬èº«å°±æœ‰ä¸€äº›ä»£ä»·ï¼‰æ›´åŠ ç®€æ´æ¸…æ™°ï¼Œç”¨æˆ·åœ¨å¿…è¦çš„æ—¶å€™è¿›è¡Œä¸€äº›è½¬æ¢å¹¶ä¸éœ€è¦èŠ±è´¹å¾ˆå¤§çš„ç²¾åŠ›ã€‚</p></blockquote><p>ä¸€äº› API ææœ‰å¯èƒ½å’Œå­å­—ç¬¦ä¸²ä¸€èµ·ä½¿ç”¨ï¼ŒåŒæ—¶æ— æ³•æ³›åŒ–åˆ°é€‚ç”¨äºæ•´ä¸ªåºåˆ— <code>Sequence</code> æˆ–é›†åˆ <code>Collection</code> çš„çº§åˆ«ï¼Œè¿™äº› API å¯ä»¥ä¸å—è¿™æ¡è§„åˆ™çš„é™åˆ¶ã€‚ä¸€ä¸ªä¾‹å­å°±æ˜¯æ ‡å‡†åº“ä¸­çš„ <a href="https://developer.apple.com/documentation/swift/sequence/1641243-joined" target="_blank" rel="noopener"><code>joined</code></a> æ–¹æ³•ã€‚Swift 4 ä¸­ï¼Œé’ˆå¯¹éµå®ˆå­—ç¬¦ä¸²åè®®çš„å…ƒç´ ç»„æˆçš„åºåˆ—ï¼ˆ<code>Sequence</code>ï¼‰æ·»åŠ äº†ä¸€ä¸ªé‡è½½ï¼ˆ<code>overload</code>ï¼‰ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Sequence</span> <span class="title">where</span> <span class="title">Element</span>: <span class="title">StringProtocol</span> </span>&#123;</span><br><span class="line">    <span class="comment">/// ä¸¤ä¸ªå…ƒç´ ä¸­é—´åŠ ä¸Šä¸€ä¸ªç‰¹å®šåˆ†éš”ç¬¦å</span></span><br><span class="line">    <span class="comment">/// åˆå¹¶åºåˆ—ä¸­æ‰€æœ‰å…ƒç´ ï¼Œè¿”å›ä¸€ä¸ªæ–°çš„å­—ç¬¦ä¸²</span></span><br><span class="line">    <span class="comment">/// Returns a new string by concatenating the elements of the sequence,</span></span><br><span class="line">    <span class="comment">/// adding the given separator between each element.</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">joined</span><span class="params">(separator: String = <span class="string">""</span>)</span></span> -&gt; <span class="type">String</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·ï¼Œä½ å°±å¯ä»¥ç›´æ¥å¯¹ä¸€ä¸ªå­å­—ç¬¦ä¸²çš„æ•°ç»„è°ƒç”¨ <code>joined</code> æ–¹æ³•äº†ï¼Œæ²¡å¿…è¦éå†ä¸€æ¬¡æ•°ç»„å¹¶ä¸”æŠŠæ¯ä¸ªå­å­—ç¬¦ä¸²è½¬æ¢ä¸ºæ–°çš„å­—ç¬¦ä¸²ã€‚è¿™æ ·ï¼Œä¸€åˆ‡éƒ½å¾ˆæ–¹ä¾¿å¿«é€Ÿã€‚</p><p>æ•°å€¼ç±»å‹åˆå§‹å™¨ï¼ˆnumber type initializerï¼‰å¯ä»¥å°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºä¸€ä¸ªæ•°å­—ã€‚åœ¨ Swift 4 ä¸­ï¼Œå®ƒä¹Ÿæ¥å—éµå®ˆå­—ç¬¦ä¸²åè®®çš„å€¼ã€‚å¦‚æœä½ è¦å¤„ç†ä¸€ä¸ªå­å­—ç¬¦ä¸²çš„æ•°ç»„çš„è¯ï¼Œè¿™ä¸ªæ–¹æ³•å¾ˆé¡ºæ‰‹ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> commaSeparatedNumbers = <span class="string">"1,2,3,4,5"</span></span><br><span class="line"><span class="keyword">let</span> numbers = commaSeparatedNumbers</span><br><span class="line">    .<span class="built_in">split</span>(separator: <span class="string">","</span>).flatMap &#123; <span class="type">Int</span>($<span class="number">0</span>) &#125;</span><br><span class="line"><span class="comment">// â†’ [1, 2, 3, 4, 5]</span></span><br></pre></td></tr></table></figure><p>ç”±äºå­å­—ç¬¦ä¸²çš„ç”Ÿå‘½å‘¨æœŸå¾ˆçŸ­ï¼Œæ‰€ä»¥ä¸å»ºè®®æ–¹æ³•çš„è¿”å›å€¼æ˜¯å­å­—ç¬¦ä¸²ï¼Œé™¤éæ˜¯åºåˆ— <code>Sequence</code> æˆ–é›†åˆ <code>Collection</code> çš„ä¸€äº›è¿”å›åˆ‡ç‰‡çš„ APIã€‚å¦‚æœä½ å†™äº†ä¸€ä¸ªç±»ä¼¼çš„æ–¹æ³•ï¼Œåªå¯¹å­—ç¬¦ä¸²æœ‰æ„ä¹‰ï¼Œé‚£è®©å®ƒçš„è¿”å›å€¼æ˜¯å­å­—ç¬¦ä¸²ï¼Œå¥½è®©è¯»è€…æ˜ç™½è¿™ä¸ªæ–¹æ³•å¹¶ä¸ä¼šäº§ç”Ÿå¤åˆ¶ï¼Œä¸ä¼šå ç”¨å†…å­˜ã€‚åˆ›å»ºæ–°å­—ç¬¦ä¸²çš„æ–¹æ³•éœ€è¦å ç”¨å†…å­˜ï¼Œæ¯”å¦‚ <a href="https://developer.apple.com/documentation/swift/stringprotocol/2908613-uppercased" target="_blank" rel="noopener"><code>uppercased()</code></a>ï¼Œè¿™ç±»çš„æ–¹æ³•åº”è¯¥è¿”å› <code>String</code> å­—ç¬¦ä¸²ç±»å‹çš„å€¼ã€‚</p><p>å¦‚æœä½ æƒ³ä¸ºå­—ç¬¦ä¸²ç±»å‹æ‰©å±•æ–°çš„åŠŸèƒ½ï¼Œ å¥½çš„åŠæ³•æ˜¯å°†æ‰©å±•æ”¾åœ¨å­—ç¬¦ä¸²åè®® <code>StringProtocol</code> ä¸Šï¼Œä¿è¯ API åœ¨å­—ç¬¦ä¸²å’Œå­å­—ç¬¦ä¸²å±‚é¢çš„ä¸€è‡´æ€§ã€‚å­—ç¬¦æƒåè®®çš„è®¾è®¡åˆè¡·å°±æ˜¯æ›¿æ¢åŸå…ˆåœ¨å­—ç¬¦ä¸²åŸºç¡€ä¸Šåšçš„æ‰©å±•åŠŸèƒ½ã€‚å¦‚æœä½ æƒ³æŠŠç°æœ‰çš„æ‰©å±•ä»å­—ç¬¦ä¸²è½¬ç§»åˆ°å­—ç¬¦ä¸²åè®®ä¸Šï¼Œä½ è¦åšçš„å”¯ä¸€æ”¹å˜å°±æ˜¯ï¼ŒæŠŠä¼ é€’ <code>Self</code> ç»™åªæ¥å—å…·ä½“ <code>String</code> å€¼çš„ APIæ›¿æ¢ä¸º <code>String(Self)</code>ã€‚</p><p>éœ€è¦è®°ä½çš„ä¸€ç‚¹æ˜¯ï¼Œä» Swift 4 å¼€å§‹ï¼Œå¦‚æœä½ æœ‰ä¸€äº›è‡ªå®šä¹‰çš„å­—ç¬¦ä¸²ç±»å‹ï¼Œä¸å»ºè®®éµå®ˆå­—ç¬¦ä¸²åè®®<code>StringProtocol</code>ã€‚å®˜æ–¹æ–‡æ¡£æ˜ç¡®è­¦å‘Šï¼š</p><blockquote><p>ä¸è¦åšä»»ä½•æ–°çš„éµå®ˆå­—ç¬¦ä¸²åè®® <code>StringProtocol</code> çš„å£°æ˜ã€‚åªæœ‰æ ‡å‡†åº“é‡Œçš„ <code>String</code> å’Œ <code>Substring</code> æ˜¯æœ‰æ•ˆçš„éµå®ˆç±»å‹ã€‚</p></blockquote><p>å…è®¸å¼€å‘è€…å†™è‡ªå·±çš„å­—ç¬¦ä¸²ç±»å‹ï¼ˆæ¯”å¦‚æœ‰ç‰¹æ®Šçš„å­˜å‚¨ä¼˜åŒ–æˆ–æ€§èƒ½ä¼˜åŒ–ï¼‰æ˜¯ç»ˆæç›®æ ‡ï¼Œä½†æ˜¯ç°é˜¶æ®µåè®®çš„è®¾è®¡è¿˜æ²¡æœ‰æœ€ç»ˆç¡®å®šï¼Œæ‰€ä»¥ç°åœ¨å°±å¯ç”¨å®ƒå¯èƒ½ä¼šå¯¼è‡´ä½ çš„ä»£ç åœ¨ Swift 5é‡Œæ— æ³•æ­£å¸¸è¿è¡Œã€‚</p><p><code>â€¦ &lt;SNIP&gt;  &lt;å†…å®¹æœ‰åˆ å‡&gt;â€¦</code></p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>Swift è¯­è¨€é‡Œçš„å­—ç¬¦ä¸²è·Ÿå…¶ä»–æ‰€æœ‰çš„ä¸»æµç¼–ç¨‹è¯­è¨€é‡Œçš„å­—ç¬¦ä¸²å·®å¼‚å¾ˆå¤§ã€‚å½“ä½ ä¹ æƒ¯äºæŠŠå­—ç¬¦ä¸²å½“åšä»£ç å—çš„æ•°ç»„åï¼Œä½ å¾—èŠ±ç‚¹æ—¶é—´è½¬åŒ–æ€ç»´ï¼Œä¹ æƒ¯ Swift çš„å¤„ç†æ–¹æ³•ï¼šå®ƒæŠŠéµå®ˆ Unicode ç¼–ç æ ‡å‡†æ”¾åœ¨<strong>ç®€æ´</strong>å‰é¢ã€‚</p><p>æ€»çš„æ¥è®²ï¼Œæˆ‘ä»¬è®¤ä¸º Swift çš„é€‰æ‹©æ˜¯æ­£ç¡®çš„ã€‚Unicode ç¼–ç æ–‡æœ¬æ¯”å…¶ä»–ç¼–ç¨‹è¯­è¨€æ‰€è®¤ä¸ºçš„è¦å¤æ‚å¾—å¤šã€‚é•¿è¿œæ¥çœ‹ï¼Œå¤„ç†ä½ å¯èƒ½å†™å‡ºæ¥çš„ bug çš„æ—¶é—´è‚¯å®šæ¯”å­¦ä¹ æ–°çš„ç´¢å¼•æ–¹å¼ï¼ˆå¿˜è®°æ•´æ•°ç´¢å¼•ï¼‰æ‰€éœ€çš„æ—¶é—´å¤šã€‚</p><p>æˆ‘ä»¬å·²ç»ä¹ æƒ¯äºä»»æ„è·å–â€œå­—ç¬¦â€ï¼Œä»¥è‡³äºæˆ‘ä»¬éƒ½å¿˜äº†å…¶å®è¿™ä¸ªç‰¹æ€§åœ¨çœŸæ­£çš„å­—ç¬¦ä¸²å¤„ç†çš„ä»£ç é‡Œå¾ˆå°‘ç”¨åˆ°ã€‚æˆ‘ä»¬å¸Œæœ›é€šè¿‡è¿™ä¸€ç« é‡Œçš„ä¾‹å­å¯ä»¥è¯´æœå¤§å®¶ï¼Œå¯¹äºå¤§å¤šæ•°å¸¸è§„çš„æ“ä½œï¼Œç®€å•çš„æŒ‰åºéå†ä¹Ÿå®Œå…¨ OKã€‚å¼ºè¿«ä½ æ¸…æ¥šåœ°å†™å‡ºä½ æƒ³åœ¨å“ªä¸ªå±‚é¢ï¼ˆå­—ä½é›†ï¼ŒUnicode scalarï¼ŒUTF-16 ä»£ç å—ï¼ŒUTF-8 ä»£ç å—ï¼‰å¤„ç†å­—ç¬¦ä¸²æ˜¯å¦ä¸€é¡¹å®‰å…¨æªæ–½ï¼›è¯»ä½ ä»£ç çš„äººä¼šå¯¹ä½ å¿ƒå­˜æ„Ÿæ¿€çš„ã€‚</p><p>2016å¹´7æœˆï¼ŒChris Lattner è°ˆåˆ°äº† <a href="https://lists.swift.org/pipermail/swift-evolution/Week-of-Mon-20160725/025676.html" target="_blank" rel="noopener">Swift è¯­è¨€å­—ç¬¦ä¸²å¤„ç†çš„ç›®æ ‡</a>ï¼Œä»–æœ€åæ˜¯è¿™ä¹ˆè¯´çš„ï¼š</p><blockquote><p>æˆ‘ä»¬çš„ç›®æ ‡æ˜¯åœ¨å­—ç¬¦ä¸²å¤„ç†ä¸Šè¶…è¶Š Perlã€‚</p></blockquote><p>å½“ç„¶ Swift 4 è¿˜æ²¡æœ‰å®ç°è¿™ä¸ªç›®æ ‡â€”â€”å¾ˆå¤šæƒ³è¦çš„ç‰¹æ€§è¿˜æ²¡å®ç°ï¼ŒåŒ…æ‹¬æŠŠ Foundation åº“ä¸­çš„è¯¸å¤šå­—ç¬¦ä¸² API è½¬ç§»åˆ°æ ‡å‡†åº“ï¼Œæ­£åˆ™è¡¨è¾¾å¼çš„è‡ªç„¶è¯­è¨€æ”¯æŒï¼Œå­—ç¬¦ä¸²æ ¼å¼åŒ–å’Œè§£æ APIï¼Œæ›´å¼ºå¤§çš„å­—ç¬¦ä¸²æ’å…¥åŠŸèƒ½ã€‚å¥½æ¶ˆæ¯æ˜¯ Swift å›¢é˜Ÿå·²ç»è¡¨ç¤º <a href="https://github.com/apple/swift/blob/master/docs/StringManifesto.md" target="_blank" rel="noopener">ä¼šåœ¨å°†æ¥è§£å†³æ‰€æœ‰è¿™äº›é—®é¢˜</a>ã€‚</p><hr><p>å¦‚æœå–œæ¬¢æœ¬æ–‡çš„è¯ï¼Œè¯·è€ƒè™‘<a href="https://gumroad.com/a/507458675" target="_blank" rel="noopener">è´­ä¹°å…¨ä¹¦</a>ã€‚è°¢è°¢ï¼</p><p>å…¨ä¹¦ä¸­ç¬¬ä¸€å¼ æ˜¯æœ¬æ–‡çš„ä¸¤æœ¬ã€‚è®¨è®ºäº†å…¶ä»–çš„ä¸€äº›é—®é¢˜ï¼ŒåŒ…æ‹¬å¦‚ä½•ä½¿ç”¨ä»¥åŠä»€ä¹ˆæ—¶å€™ä½¿ç”¨å­—ç¬¦ä¸²çš„ä»£ç å—è§†å›¾ï¼Œå¦‚ä½•å’Œ Foundationé‡Œçš„å¤„ç†å­—ç¬¦ä¸²çš„ APIï¼ˆä¾‹å¦‚ <a href="https://developer.apple.com/documentation/foundation/nsregularexpression" target="_blank" rel="noopener"><code>NSRegularExpression</code></a> æˆ–è€… <a href="https://developer.apple.com/documentation/foundation/nsattributedstring" target="_blank" rel="noopener"><code>NSAttributedString</code></a>ï¼‰ é…åˆå¤„ç†ã€‚è´´åˆ«æ˜¯åé¢è¿™ä¸ªé—®é¢˜å¾ˆéš¾ï¼Œè€Œä¸”å¾ˆå®¹æ˜“çŠ¯é”™ã€‚é™¤æ­¤ä¹‹å¤–è¿˜è®¨è®ºäº†å…¶ä»–æ ‡å‡†åº“é‡Œé¢æœºé‡å­—ç¬¦ä¸²çš„ APIï¼Œä¾‹å¦‚æ–‡æœ¬è¾“å‡ºæµï¼ˆ<a href="https://developer.apple.com/documentation/swift/textoutputstream" target="_blank" rel="noopener"><code>TextOutputStream</code></a>ï¼‰æˆ–è‡ªå®šä¹‰å­—ç¬¦ä¸²è½¬æ¢ï¼ˆ<a href="https://developer.apple.com/documentation/swift/customstringconvertible" target="_blank" rel="noopener"><code>CustomStringConvertible</code></a>ï¼‰ã€‚</p><blockquote><p>æœ¬æ–‡ç”± SwiftGG ç¿»è¯‘ç»„ç¿»è¯‘ï¼Œå·²ç»è·å¾—ä½œè€…ç¿»è¯‘æˆæƒï¼Œæœ€æ–°æ–‡ç« è¯·è®¿é—® <a href="http://swift.gg">http://swift.gg</a>ã€‚</p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;ä½œè€…ï¼šOle Begemannï¼Œ&lt;a href=&quot;https://oleb.net/blog/2017/11/swift-4-strings&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;åŸæ–‡é“¾æ¥&lt;/a&gt;ï¼ŒåŸæ–‡æ—¥æœŸï¼š2017-11-27&lt;br&gt;è¯‘è€…ï¼š&lt;a href=&quot;https://weibo.com/u/5029986118&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;ä¸œèå¤§å”å’Œå°š&lt;/a&gt;ï¼›æ ¡å¯¹ï¼š&lt;a href=&quot;http://www.jianshu.com/users/596f2ba91ce9/latest_articles&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;pmst&lt;/a&gt;ï¼Œ&lt;a href=&quot;undefined&quot;&gt;Firecrest&lt;/a&gt;ï¼›å®šç¨¿ï¼š&lt;a href=&quot;https://github.com/chenmingbiao&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;CMB&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;!--æ­¤å¤„å¼€å§‹æ­£æ–‡--&gt;
&lt;p&gt;è¿™ä¸ªç³»åˆ—ä¸­å…¶ä»–æ–‡ç« ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&quot;https://oleb.net/blog/2014/07/swift-strings/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Swift 1 ä¸­çš„å­—ç¬¦ä¸²&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://oleb.net/blog/2016/08/swift-3-strings/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Swift 3 ä¸­çš„å­—ç¬¦ä¸²&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Swift 4 ä¸­çš„å­—ç¬¦ä¸²ï¼ˆæœ¬æ–‡ï¼‰&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;æœ¬æ–‡èŠ‚é€‰è‡ªæˆ‘ä»¬çš„æ–°ä¹¦ã€Šé«˜çº§ Swift ç¼–ç¨‹ã€‹ã€Œå­—ç¬¦ä¸²ã€è¿™ä¸€ç« ã€‚ã€Šé«˜çº§ Swift ç¼–ç¨‹ã€‹æ–°ç‰ˆæœ¬å·²æ ¹æ® Swift 4 çš„æ–°ç‰¹æ€§ä¿®è®¢è¡¥å……ï¼Œæ–°ç‰ˆç°å·²ä¸Šå¸‚ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="Ole Begemannh" scheme="https://swift.gg/categories/Ole-Begemannh/"/>
    
    
      <category term="Swift è¿›é˜¶" scheme="https://swift.gg/tags/Swift-%E8%BF%9B%E9%98%B6/"/>
    
  </entry>
  
  <entry>
    <title>å‰–æ ARM 64 æ¶æ„ä¸­çš„ objc_msgSend</title>
    <link href="https://swift.gg/2018/08/06/friday-qa-2017-06-30-dissecting-objc_msgsend-on-arm64/"/>
    <id>https://swift.gg/2018/08/06/friday-qa-2017-06-30-dissecting-objc_msgsend-on-arm64/</id>
    <published>2018-08-06T00:00:00.000Z</published>
    <updated>2019-02-18T08:52:03.568Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ä½œè€…ï¼šMike Ashï¼Œ<a href="https://www.mikeash.com/pyblog/friday-qa-2017-06-30-dissecting-objc_msgsend-on-arm64.html" target="_blank" rel="noopener">åŸæ–‡é“¾æ¥</a>ï¼ŒåŸæ–‡æ—¥æœŸï¼š2017-06-30<br>è¯‘è€…ï¼š<a href="https://bignerdcoding.com/" target="_blank" rel="noopener">BigNerdCoding</a>ï¼›æ ¡å¯¹ï¼š<a href="http://www.jianshu.com/users/596f2ba91ce9/latest_articles" target="_blank" rel="noopener">pmst</a>ï¼Œ<a href="http://codebuild.me/" target="_blank" rel="noopener">shanks</a>ï¼›å®šç¨¿ï¼š<a href="https://github.com/chenmingbiao" target="_blank" rel="noopener">CMB</a></p></blockquote><!--æ­¤å¤„å¼€å§‹æ­£æ–‡--><p>å¾ˆé«˜å…´ï¼Œæˆ‘åˆå›æ¥äº†ã€‚åœ¨åˆšåˆšè¿‡å»çš„ WWDC æœŸé—´ï¼Œæˆ‘åœ¨ CocoaConf Next Door åšä¸ªä¸€ä¸ªå…³äºå‰–æ ARM64 ä¸Š <code>objc_msgSend</code> è¿è¡Œæµç¨‹çš„å‘è¨€ã€‚ç°åœ¨æˆ‘å°†æ•´ç†åçš„å†…å®¹é‡æ–°å‘å¸ƒåˆ° Friday Q&amp;A ä¸Šã€‚</p><a id="more"></a><h2 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><p>æ¯ä¸ª Objective-C å¯¹è±¡éƒ½ä¼šæŒ‡å‘ä¸€ä¸ªç±»ï¼Œè€Œæ¯ä¸ªç±»åˆåŒ…å«ä¸€ä¸ªæ–¹æ³•åˆ—è¡¨ã€‚æ¯ä¸ªæ–¹æ³•åˆ™ç”±é€‰æ‹©å™¨ï¼ˆ<code>selector</code>ï¼‰ã€å‡½æ•°æŒ‡é’ˆå’Œä¸€äº›å…ƒæ•°æ®ï¼ˆ<code>metadata</code>ï¼‰æ„æˆã€‚<code>objc_msgSend</code> èŒè´£å°±æ˜¯æ¥æ”¶å¯¹è±¡ï¼ˆ<code>object</code>ï¼‰å’Œé€‰æ‹©å™¨ï¼ˆ<code>selector</code>ï¼‰ï¼Œæ ¹æ®é€‰æ‹©å™¨åç§°æ‰¾åˆ°å¯¹åº”æ–¹æ³•çš„å‡½æ•°æŒ‡é’ˆå¹¶è·³è½¬æ‰§è¡Œè¯¥å‡½æ•°ã€‚</p><p>æŸ¥æ‰¾è¿‡ç¨‹ç›¸å¯¹æ¥è¯´è¿˜æ˜¯æ¯”è¾ƒå¤æ‚çš„ã€‚è‹¥æŸä¸ªæ–¹æ³•åœ¨å½“å‰ç±»ä¸­æœªæ‰¾åˆ°ï¼Œå°±éœ€è¦æ²¿ç€ç»§æ‰¿é“¾ç»§ç»­åœ¨çˆ¶ç±»ä¸­æŸ¥æ‰¾ã€‚å¦‚æœåœ¨çˆ¶ç±»ä¸­ä¹ŸæœªæŸ¥è¯¢åˆ°çš„è¯ï¼Œåˆ™ä¼šè§¦å‘ runtime æœºåˆ¶ä¸­çš„æ¶ˆæ¯è½¬å‘æœºåˆ¶ã€‚ä»»ä½•å¯¹è±¡åœ¨æ¥æ”¶åˆ°ç¬¬ä¸€æ¡æ¶ˆæ¯åéƒ½ä¼šè§¦å‘ç±»æ–¹æ³• <code>+initialize</code> ã€‚</p><p>å› ä¸ºæ¯æ¬¡æ–¹æ³•è°ƒç”¨éƒ½ä¼šè§¦å‘ä¸Šè¿°æµç¨‹ï¼Œæ‰€ä»¥åœ¨å¸¸è§åœºæ™¯ä¸‹çš„æŸ¥æ‰¾é€Ÿåº¦å¿…é¡»éå¸¸å¿«ã€‚æ˜¾ç„¶è¿™ä¸å¤æ‚çš„æ“ä½œè¿‡ç¨‹ä¹‹é—´å­˜åœ¨ä¸€å®šå†²çªã€‚</p><p>ä¸ºäº†è§£å†³è¿™å¯¹çŸ›ç›¾æé«˜æŸ¥è¯¢é€Ÿåº¦ï¼ŒObjective-C é‡‡ç”¨äº†æ–¹æ³•ç¼“å­˜ç­–ç•¥ã€‚æ¯ä¸ªç±»éƒ½ä¼šä½¿ç”¨å“ˆå¸Œè¡¨å°†å…¶æ–¹æ³•æŒ‰ç…§ Selector - IMPsï¼ˆå‡½æ•°æŒ‡é’ˆï¼‰ é”®å€¼å¯¹å…³ç³»ç¼“å­˜èµ·æ¥ã€‚è¿™æ ·åœ¨æŸ¥è¯¢æ–¹æ³•æ—¶ï¼Œruntime é¦–å…ˆä¼šç›´æ¥å»å“ˆå¸Œè¡¨ä¸­æŸ¥è¯¢ã€‚å¦‚æœå“ˆå¸Œè¡¨ä¸­ä¸å­˜åœ¨çš„è¯åˆ™è½¬è€Œæ‰§è¡ŒåŸæœ‰å¤æ‚ã€ç¼“æ…¢çš„å¤„ç†æµç¨‹ï¼Œå¹¶å°†æœ€ç»ˆç»“æœç¼“å­˜èµ·æ¥å·²å¤‡ä¸‹æ¬¡ä½¿ç”¨ã€‚</p><p><code>objc_msgSend</code> ç”¨æ±‡ç¼–è¯­è¨€è¿›è¡Œå®ç°ï¼Œå…·ä½“ç†ç”±æœ‰ä¸¤ä¸ªï¼šé¦–å…ˆçº¯ C è¯­è¨€æ— æ³•å®ç°è¿™ä¹ˆä¸€ä¸ªå‡½æ•°ï¼šæ¥æ”¶ä¸å®šä¸ªæ•°ä¸”æœªçŸ¥ç±»å‹çš„å‚æ•°ä½œä¸ºå…¥å‚è·³è½¬è‡³ä»»æ„å‡½æ•°æŒ‡é’ˆï¼ˆå³è°ƒç”¨å®ç°ï¼‰ï¼›å…¶æ¬¡ï¼Œæ‰§è¡Œé€Ÿåº¦å¯¹ <code>objc_msgSend</code> æ¥è¯´éå¸¸é‡è¦ï¼Œæ±‡ç¼–è¯­è¨€èƒ½æœ€å¤§åŒ–æå‡è¯¥é¡¹æŒ‡æ ‡ã€‚</p><p>å½“ç„¶ï¼Œä½¿ç”¨æ±‡ç¼–è¯­è¨€å®ç°æ•´ä¸ªå¤æ‚çš„æ¶ˆæ¯å¤„ç†è¿‡ç¨‹æ˜¯ä¸ç°å®çš„ï¼Œè€Œä¸”ä¹Ÿæ²¡è¿™ç§å¿…è¦ã€‚å› ä¸ºæœ‰äº›æµç¨‹ä¸€æ—¦è§¦å‘ç¨‹åºéƒ½ä¼šå˜æ…¢ï¼Œæ— è®ºé‡‡ç”¨ä½•ç§è¯­è¨€å±‚é¢çš„å®ç°ã€‚æ•´ä¸ªæ¶ˆæ¯å¤„ç†æµç¨‹ä»£ç å¯ä»¥åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†ï¼šé€šè¿‡æ±‡ç¼–ä»£ç å®ç°çš„å¿«é€Ÿè·¯å¾„éƒ¨åˆ†ï¼ˆfast pathï¼‰ ï¼ŒC è¯­è¨€å®ç°çš„æ…¢è·¯å¾„æµç¨‹ï¼ˆslow pathï¼‰ã€‚å…¶ä¸­æ±‡ç¼–ä»£ç å¯¹åº”ç¼“å­˜è¡¨ä¸­æŸ¥è¯¢æ–¹æ³•éƒ¨åˆ†å¹¶ä¸”æœªå‘½ä¸­æ—¶è·³è½¬ C ä»£ç æ¥è¿›è¡Œä¸‹ä¸€æ­¥å¤„ç†ã€‚</p><p>å› æ­¤ï¼Œ<code>objc_msgSend</code> ä»£ç å¤„ç†æµç¨‹å¤§è‡´å¦‚ä¸‹ï¼š</p><ol><li>è·å–æ¶ˆæ¯å¯¹è±¡æ‰€å¯¹åº”çš„ç±»ä¿¡æ¯</li><li>è·å–ç±»æ‰€å¯¹åº”çš„æ–¹æ³•ç¼“å­˜</li><li>åœ¨æ–¹æ³•ç¼“å­˜ä¸­æŸ¥è¯¢ <em>selector</em> å¯¹è±¡çš„å‡½æ•°å®ç°</li><li>å¦‚æœæŸ¥è¯¢å¤±è´¥åˆ™è°ƒç”¨ C ä»£ç è¿›è¡Œä¸‹ä¸€æ­¥å¤„ç†</li><li>è·³è½¬åˆ° IMP æ‰€æŒ‡çš„å‡½æ•°å®ç°</li></ol><p>ä¸‹é¢å¼€å§‹åˆ†æå…¶å…·ä½“å®ç°ã€‚</p><h2 id="æ‰§è¡Œè¿‡ç¨‹çš„æŒ‡ä»¤"><a href="#æ‰§è¡Œè¿‡ç¨‹çš„æŒ‡ä»¤" class="headerlink" title="æ‰§è¡Œè¿‡ç¨‹çš„æŒ‡ä»¤"></a>æ‰§è¡Œè¿‡ç¨‹çš„æŒ‡ä»¤</h2><p><em>objc_msgSend</em> åœ¨ä¸åŒæƒ…å½¢ä¸‹æ‰§è¡Œè·¯å¾„ä¸å°½ç›¸åŒã€‚å¯¹äºå‘ <code>nil</code> å‘é€æ¶ˆæ¯ï¼Œæ ‡è®°æŒ‡é’ˆï¼ˆtagged pointersï¼‰ï¼Œå“ˆå¸Œè¡¨å†²çªä¼šç›¸åº”ç‰¹æ®Šä»£ç ä¸­è¿›è¡Œå¤„ç†ã€‚ä¸‹é¢æˆ‘å°†é€šè¿‡æœ€å¸¸è§ä¹Ÿæ˜¯æœ€ç®€å•çš„æƒ…å½¢æ¥è§£é‡Š <code>objc_msgSend</code>  çš„æ‰§è¡Œï¼Œå³å¤„ç† non-nilã€non-tagged æ¶ˆæ¯å¹¶ä¸”å“ˆå¸Œè¡¨ä¹Ÿèƒ½å‘½ä¸­è¯¥æ–¹æ³•ã€‚æˆ‘ä¼šåœ¨è¯¥è¿‡ç¨‹ä¸­æ ‡è®°å‡ºé‚£äº›éœ€è¦æ³¨æ„çš„å¤„ç†è·¯å¾„<em>å²”è·¯å£</em>ï¼Œç„¶åå›è¿‡å¤´æ¥è¿›è¡Œè¯¦ç»†è®²è§£ã€‚</p><p>æˆ‘å°†åˆ—å‡ºå•æ¡æˆ–ä¸€ç»„æŒ‡ä»¤ï¼Œç„¶ååœ¨ä¸‹é¢ç´§æ¥ç›¸å…³è§£é‡Šå†…å®¹ã€‚</p><p>æ¯æ¡æŒ‡ä»¤å‰é¢éƒ½ä¼šæœ‰ä¸€ä¸ªåœ°å€åç§»é‡ï¼Œå¯ä»¥å°†å…¶çœ‹ä½œä¸€ä¸ªæŒ‡ç¤ºè·³è½¬ä½ç½®çš„æ ‡è®°é‡ã€‚</p><p>ARM64 æ¶æ„ä¸­åŒ…å« 31 ä¸ª 64 ä½æ•´å‹å¯„å­˜å™¨ï¼Œå¯¹åº”ç¬¦å·è¡¨ç¤ºä¸º x0 - x30 ã€‚æ¯ä¸ªå¯„å­˜å™¨çš„ä½ 32 ä½ä¹Ÿå¯ä»¥é€šè¿‡ w0 åˆ° w30 è¿›è¡Œè®¿é—®ï¼Œå°±åƒå®ƒä¹Ÿæ˜¯ä¸€ä¸ªå•ç‹¬çš„å¯„å­˜å™¨ã€‚å…¶ä¸­ x0 åˆ° x7 è¢«ç”¨æ¥ä¿å­˜å‡½æ•°è°ƒç”¨æ—¶çš„å‰ 8 ä¸ªå‚æ•°ã€‚è¿™æ„å‘³ç€ <code>objc_msgSend</code> å‡½æ•°ä¸­çš„ <code>self</code> å‚æ•°ä¿å­˜åœ¨ x0 è€Œ <code>_cmd</code> ä¿å­˜åœ¨ x1 ã€‚</p><p>èµ·å§‹æŒ‡ä»¤å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">0x0000 cmp     x0, #0x0</span><br><span class="line">0x0004 b.le    0x6c</span><br></pre></td></tr></table></figure><p>è¯¥æ®µæŒ‡ä»¤æ˜¯å°† <code>self</code> ä¸ 0 è¿›è¡Œæœ‰ç¬¦å·æ¯”è¾ƒï¼Œå¦‚æœ <code>self</code> ä¸å¤§äº 0 çš„è¯åˆ™ä¼šè¿›è¡Œè·³è½¬å¤„ç†ã€‚ç­‰äº 0 å…¶å®å°±ç›¸å½“äº <code>nil</code> å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯è¯´æ­¤æ—¶ä¼šè°ƒç”¨å‘ <em>nil</em> å‘é€æ¶ˆæ¯æƒ…å½¢ä¸‹å¯¹åº”çš„ç‰¹å®šä»£ç ã€‚å¦å¤–ï¼Œè¯¥æŒ‡ä»¤ä¹Ÿè¢«ç”¨äºæ ‡è®°æŒ‡é’ˆï¼ˆ<code>tagged pointers</code>ï¼‰çš„å¤„ç†ã€‚ARM64 é€šè¿‡è®¾ç½®æœ€é«˜ä½ä¸º 1 æ¥æ ‡è®° Tagged Pointersï¼ˆx86-64 åˆ™æ˜¯æœ€ä½ä½ï¼‰ï¼Œæ­¤æ—¶å¯¹åº”æœ‰ç¬¦å·æ•°æ¯”ä¸ºè´Ÿã€‚å¯¹äºæ™®é€šæŒ‡é’ˆæ¥è¯´ï¼Œä¸Šè¿°å¤„ç†åˆ†æ”¯éƒ½ä¼šä¸è¢«è§¦å‘ã€‚</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">0x0008 ldr    x13, [x0]</span><br></pre></td></tr></table></figure><p>è¯¥æŒ‡ä»¤å°† x0 ä¸­æ‰€è¡¨ç¤ºçš„ <em>self</em> çš„ isa åœ°å€åŠ è½½åˆ° x13 å¯„å­˜å™¨ä¸­ã€‚</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">0x000c and    x16, x13, #0xffffffff8</span><br></pre></td></tr></table></figure><p>å› ä¸º ARM64 æ¶æ„ä¸‹èƒ½å¤Ÿä½¿ç”¨ <a href="(http://www.sealiesoftware.com/blog/archive/2013/09/24/objc_explain_Non-pointer_isa.html)[http://www.sealiesoftware.com/blog/archive/2013/09/24/objc_explain_Non-pointer_isa.html]"><code>non-pointer isas</code></a> æŠ€æœ¯ï¼Œæ‰€ä»¥ä¸ä¹‹å‰ç›¸æ¯” isa å­—æ®µä¸ä»…å¯ä»¥åŒ…å«æŒ‡å‘ Class çš„ä¿¡æ¯ï¼Œå®ƒè¿˜èƒ½åˆ©ç”¨å¤šä½™æ¯”ç‰¹ä½å­˜å‚¨å…¶å®ƒæœ‰æ•ˆä¿¡æ¯ï¼ˆä¾‹å¦‚ï¼Œå¼•ç”¨è®¡æ•°ï¼‰ã€‚è¿™é‡Œé€šè¿‡ AND é€»è¾‘è¿ç®—å»é™¤ä½ä½çš„å†—ä½™ä¿¡æ¯å¾—åˆ°æœ€ç»ˆçš„ Class çš„åœ°å€å¹¶å°†å…¶å­˜å…¥ x13 å¯„å­˜å™¨ä¸­ã€‚</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">0x0010 ldp    x10, x11, [x16, #0x10]</span><br></pre></td></tr></table></figure><p>è¿™æ˜¯æ•´ä¸ª <code>objc_msgSend</code> å¤„ç†æµç¨‹ä¸­æˆ‘æœ€å–œæ¬¢çš„æŒ‡ä»¤ã€‚è¯¥æŒ‡ä»¤ä¼šå°† Class ä¸­çš„æ–¹æ³•ç¼“å­˜å“ˆå¸Œè¡¨åŠ è½½åˆ° x10 å’Œ x11 ä¸¤ä¸ªå¯„å­˜å™¨ä¸­ã€‚<code>ldp</code> æŒ‡ä»¤ä¼šå°†æœ‰æ•ˆçš„å†…å­˜ä¿¡æ¯åŠ è½½åˆ°è¯¥æŒ‡ä»¤çš„å‰ä¸¤ä¸ªå¯„å­˜å™¨ä¸­ï¼Œè€Œç¬¬ä¸‰ä¸ªå‚æ•°åˆ™å¯¹åº”è¯¥ä¿¡æ¯çš„å†…å­˜åœ°å€ã€‚åœ¨è¯¥ä¾‹ä¸­ç¼“å­˜å“ˆå¸Œè¡¨åœ°å€ä¸º x16 å¯„å­˜å™¨ä¸­åœ°å€åç§» 16 åæ‰€å¤„ä½ç½®ã€‚ç¼“å­˜å¯¹è±¡æ•°æ®ç»“æ„ç±»ä¼¼äºï¼š</p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">uint32_t</span> <span class="keyword">mask_t</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">cache_t</span> &#123;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">bucket_t</span> *_<span class="title">buckets</span>;</span></span><br><span class="line">    <span class="keyword">mask_t</span> _mask;</span><br><span class="line">    <span class="keyword">mask_t</span> _occupied;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ä¸Šè¿° <code>ldp</code> æŒ‡ä»¤ä¸­ï¼Œx10 ä¸­ä¿å­˜äº† <code>_buckets</code> å€¼ï¼Œè€Œ x11 å¯„å­˜å™¨çš„é«˜ 32 ä½ä¿å­˜çš„æ˜¯ <code>_occupied</code> ä½ 32 ä½åˆ™ä¿å­˜äº† <code>_mask</code> ã€‚</p><p><code>_occupied</code> è¡¨ç¤ºå“ˆå¸Œè¡¨ä¸­çš„å…ƒç´ çš„æ•°é‡ï¼Œåœ¨ <code>objc_msgSend</code> å¤„ç†è¿‡ç¨‹ä¸­æ²¡æœ‰å¤ªå¤§çš„ä½œç”¨ã€‚è€Œ <code>_mask</code> åˆ™ç›¸å¯¹é‡è¦ï¼šå®ƒå°†å“ˆå¸Œè¡¨å¤§å°æè¿°ä¸ºäº†ä¸€ä¸ªä¾¿äºè¿›è¡Œä¸æ“ä½œçš„æ©ç ã€‚<code>_mask</code> å€¼ä¸º 2^n - 1 ï¼Œæ¢å¥è¯è¯´å®ƒçš„äºŒè¿›åˆ¶è¡¨ç¤ºå°†ä»¥ä¸€ç»„ 1 ä½œä¸ºç»“å°¾ï¼Œå½¢å¦‚ 000000001111111 ã€‚è¯¥å€¼ä¸ºæŸ¥è¯¢ selector çš„å“ˆå¸Œè¡¨ç´¢å¼•ä»¥åŠæ ‡è®°è¡¨å°¾çš„å¿…è¦æ¡ä»¶ã€‚</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">0x0014 and    w12, w1, w11</span><br></pre></td></tr></table></figure><p>è¯¥æŒ‡ä»¤ç”¨äºè®¡ç®— <code>_cmd</code> æ‰€ä¼ é€’è¿‡æ¥çš„ <code>selector</code> åœ¨å“ˆå¸Œè¡¨ä¸­çš„èµ·å§‹ä½ç½®ã€‚å› ä¸º <code>_cmd</code> ä¿å­˜åœ¨ x1 å¯„å­˜å™¨ä¸­ï¼Œæ‰€ä»¥ w1 å¯„å­˜å™¨åˆ™åŒ…å«äº† <code>_cmd</code> çš„ä½ 32 ä½ä¿¡æ¯ã€‚è€Œ w11 å¯„å­˜å™¨ä¿å­˜äº†ä¸Šé¢æåˆ°çš„ <code>_mask</code> ä¿¡æ¯ã€‚é€šè¿‡ AND æŒ‡ä»¤æˆ‘ä»¬å°†è¿™ä¸¤ä¸ªå¯„å­˜å™¨ä¸­æ•°å€¼<em>ä¸æ“ä½œ</em>ç»“æœä¿å­˜åˆ° w12 å¯„å­˜å™¨ä¸­ã€‚è®¡ç®—ç»“æœç›¸å½“äº <code>_cmd % table_size</code>  ï¼Œä½†æ˜¯å®ƒå´é¿å…äº†æ¨¡æ“ä½œçš„æ˜‚è´µå¼€é”€ã€‚</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">0x0018 add    x12, x10, x12, lsl #4</span><br></pre></td></tr></table></figure><p>ä»…ä»…å¾—åˆ°ç´¢å¼•æ˜¯ä¸å¤Ÿï¼Œä¸ºäº†ä»è¡¨ä¸­åŠ è½½æ•°æ®ï¼Œæˆ‘ä»¬éœ€è¦å¾—åˆ°æœ€ç»ˆçš„å®é™…åœ°å€ã€‚è€Œè¿™æ­£æ˜¯è¯¥æŒ‡ä»¤çš„ç›®çš„ã€‚å› ä¸ºå“ˆå¸Œè¡¨çš„ bucket éƒ½æ˜¯ 16 ä¸ªæ¯”ç‰¹ä½ï¼Œæ‰€ä»¥è¿™é‡Œå…ˆå¯¹ x12 å¯„å­˜å™¨ä¸­çš„ç´¢å¼•å€¼å·¦ç§» 4 ä½ä¹Ÿå°±æ˜¯ä¹˜ä»¥ 16 ï¼Œç„¶åå†å°†å…¶ä¸è¡¨é¦–åœ°å€ç›¸åŠ åçš„ç¡®åˆ‡ bucket åœ°å€ä¿¡æ¯ä¿å­˜åˆ° x12 ä¸­ã€‚</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">0x001c ldp    x9, x17, [x12]</span><br></pre></td></tr></table></figure><p>å†ä¸€æ¬¡é€šè¿‡ <code>ldp</code> æŒ‡ä»¤ï¼Œå°†ä¸Šä¸€æ­¥ä¿å­˜åœ¨ x12 å¯„å­˜å™¨ä¸­ bucket å¯¹åº”çš„ä¿¡æ¯åŠ è½½åˆ° x9 å’Œ x17 å¯„å­˜å™¨ä¸­ã€‚å› ä¸º bucket ç”± selector å’Œ IMP ä¸¤éƒ¨åˆ†æ„æˆï¼Œæ‰€ä»¥ x9 å¯¹åº”ä¿å­˜äº† selector ä¿¡æ¯è€Œ x17 åˆ™ä¿å­˜äº† IMP ä¿¡æ¯ã€‚</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">0x0020 cmp    x9, x1</span><br><span class="line">0x0024 b.ne   0x2c</span><br></pre></td></tr></table></figure><p>è¯¥æ®µæŒ‡ä»¤ä¼šå°† x9 å¯„å­˜å™¨ä¸­çš„å†…å®¹å’Œ x1 ä¸­çš„ <code>_cmd</code> è¿›è¡Œå¯¹æ¯”ï¼Œå¦‚æœå®ƒä»¬ä¸ç­‰åˆ™æ„å‘³ç€ bucket ä¸­ä¸åŒ…å«æˆ‘ä»¬æ‰€æ“ä½œçš„ selector ï¼Œå¹¶ä¸”åœ¨æ­¤æ—¶è·³è½¬åˆ° 0x2c å¤„æ‰§è¡Œå¯¹åº”çš„æœªåŒ¹é…å¤„ç†ã€‚å¦‚æœç›¸åŒçš„è¯åˆ™è¡¨ç¤ºå‘½ä¸­ï¼Œç»§ç»­æ‰§è¡Œä¸‹ä¸€æ¡æŒ‡ä»¤ã€‚</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">0x0028 br    x17</span><br></pre></td></tr></table></figure><p>è¯¥æŒ‡ä»¤ä¸ºæ— æ¡ä»¶è·³è½¬åˆ° x17 å¯„å­˜å™¨æ‰€æŒ‡ä½ç½®ï¼Œä¹Ÿå°±æ˜¯è·³è½¬åˆ° IMP æ‰€æŒ‡å¤„æ‰§è¡Œå…·ä½“å®ç°ä»£ç ã€‚æ­¤æ—¶ <code>objc_msgSend</code> å¤„ç†æµç¨‹ä¸­æœ€å¿«çš„è·¯å¾„å·²ç»ç»“æŸã€‚å…¶ä½™å‚æ•°æ‰€åšå¯„å­˜å™¨éƒ½æ²¡æœ‰è¢«å¹²æ‰°ï¼Œç›®æ ‡æ–¹æ³•ä¼šæ¥å—ä¼ å…¥çš„å…¨éƒ¨å‚æ•°ï¼Œä¸€åˆ‡è¡Œå¦‚ç›´æ¥è°ƒç”¨ç›®æ ‡å‡½æ•°ã€‚</p><p>åœ¨æœ€ç†æƒ³çš„æƒ…å½¢ä¸‹ï¼Œ<code>objc_msgSend</code> å¤„ç†æµç¨‹æœ€å¿«å¯ä»¥åœ¨ 3 çº³ç§’å†…æ‰§è¡Œå®Œæ¯•ã€‚</p><p>åœ¨ä»‹ç»å®Œç†æƒ³çš„æœ€å¿«æƒ…å½¢åï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦å…³æ³¨å…¶ä½™å‡ ç§æƒ…å½¢ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹å½“æ–¹æ³•æœªç¼“å­˜æ—¶çš„å¤„ç†ã€‚</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">0x002c cbz    x9, __objc_msgSend_uncached</span><br></pre></td></tr></table></figure><p>å‰é¢æåˆ° x9 å¯„å­˜å™¨åŒ…å«äº†åŠ è½½åçš„ selector ä¿¡æ¯ã€‚å°†å¯„å­˜å™¨ä¸­çš„ä¿¡æ¯ä¸é›¶è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœç­‰äº 0 çš„è¯å°±è·³è½¬åˆ° <code>__objc_msgSend_uncached</code> ä»£ç å¤„ã€‚å› ä¸ºç­‰äº 0 å°±æ„å‘³ç€ bucket ä¸ºç©ºä¹Ÿå°±æ˜¯è¯´æ–¹æ³•æŸ¥è¯¢å¤±è´¥ï¼Œselector å¯¹åº”çš„æ–¹æ³•æ²¡æœ‰è¢«ç¼“å­˜åˆ°å“ˆå¸Œè¡¨ä¸­ã€‚æ­¤æ—¶æˆ‘ä»¬éœ€è¦è°ƒç”¨ C è¯­è¨€ä»£ç è¿›è¡Œæ›´ä¸ºå¤æ‚çš„å¤„ç†ï¼Œä¹Ÿå°±æ˜¯ <code>__objc_msgSend_uncached</code> ã€‚å¦‚æœä»…ä»…åªæ˜¯æ–¹æ³•ä¸åŒ¹é…ä¸” bucket ä¸ä¸ºç©ºçš„è¯ï¼Œåˆ™éœ€è¦ç»§ç»­è¿›è¡Œæ–¹æ³•æŸ¥æ‰¾ã€‚</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">0x0030 cmp    x12, x10</span><br><span class="line">0x0034 b.eq   0x40</span><br></pre></td></tr></table></figure><p>è¯¥æŒ‡ä»¤å°† x12 å¯„å­˜å™¨ä¸­çš„å½“å‰ bucket åœ°å€ä¸ x10 å¯„å­˜å™¨ä¸­çš„å“ˆå¸Œè¡¨é¦–åœ°å€è¿›è¡Œæ¯”è¾ƒã€‚å¦‚æœä¸¤è€…å†…å®¹åŒ¹é…ä¸Šäº†ï¼Œåˆ™æˆ‘ä»¬ä»å“ˆå¸Œè¡¨çš„æœ«å°¾è¿›è¡Œåå‘æŸ¥è¯¢ã€‚è™½ç„¶æˆ‘è¿˜æ²¡å¼„æ˜ç™½æ­¤æ—¶ä¸ºä»€ä¹ˆæ²¡æœ‰é‡‡ç”¨å¸¸è§çš„æ­£å‘éå†æŸ¥è¯¢ï¼Œä½†æ˜¯æœ‰ç†ç”±è®¤ä¸ºå¯èƒ½è¿™æ ·é€Ÿåº¦æ›´å¿«ã€‚</p><p>0x40 è¡¨ç¤ºåŒ¹é…åè·³è½¬ç›®çš„åœ°å€ã€‚å¦‚æœä¸¤è€…ä¸åŒ¹é…åˆ™ç»§ç»­æ‰§è¡Œä¸‹é¢çš„æŒ‡ä»¤ã€‚</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">0x0038 ldp    x9, x17, [x12, #-0x10]!</span><br></pre></td></tr></table></figure><p>å†ä¸€æ¬¡ä»£ç é€šè¿‡ ldp æŒ‡ä»¤åŠ è½½ç¼“å­˜ä¿¡æ¯ï¼Œåªä¸è¿‡åœ°å€ä¸ºè·å½“å‰ bucket  åç§» -0x10 æ‰€æŒ‡ä½ç½®ã€‚è¯¥æŒ‡ä»¤ä¸­çš„ ï¼ç¬¦å·è¡¨ç¤ºå¯„å­˜å™¨å›å†™æ“ä½œï¼Œä¹Ÿå°±æ˜¯è¯´ä¼šä½¿ç”¨è®¡ç®—åçš„ç»“æœæ›´æ–° x12 å¯„å­˜å™¨ã€‚å°†å…¶ç”¨æ•°å­¦æ–¹å¼è¡¨ç¤ºå°±æ˜¯ï¼šx12 -= 16ï¼Œå°† x12 ä¸­è¡¨ç¤ºçš„åœ°å€å‰ç§» 16 ä¸ªå•ä½ã€‚</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">0x003c b      0x20</span><br></pre></td></tr></table></figure><p>åŠ è½½æ–°çš„ bucket ä¿¡æ¯åï¼Œä»£ç é‡æ–°è·³è½¬åˆ° 0x20 å¤„å¾ªç¯æŸ¥è¯¢è¿‡ç¨‹ï¼Œç›´åˆ°å‡ºç°ä¸‹åˆ—æƒ…å½¢ï¼šæ‰¾åˆ°åŒ¹é…é¡¹ï¼Œbucket ä¸ºç©ºï¼Œå†æ¬¡å›åˆ°äº†å“ˆå¸Œè¡¨çš„èµ·å§‹å¤„ã€‚</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">0x0040 add    x12, x12, w11, uxtw #4</span><br></pre></td></tr></table></figure><p>å½“æŸ¥è¯¢åˆ°åŒ¹é…æƒ³åä¼šè§¦å‘è¯¥æŒ‡ä»¤ã€‚æ­¤æ—¶ x12 å¯„å­˜å™¨ä¸ºæœ€æ–°çš„ bucket åœ°å€ï¼Œè€Œ w11 ä¿å­˜äº†åŒ…å«å“ˆå¸Œè¡¨å¤§å°çš„æ©ç å€¼ã€‚è¯¥æŒ‡ä»¤å°† w11 å·¦ç§» 4 ä½åå°†ä¸¤ä¸ªå€¼è¿›è¡Œå åŠ å¾—åˆ°å“ˆå¸Œè¡¨å°¾åœ°å€ï¼Œå¹¶å°†ç»“æœä¿å­˜åˆ° x12 å¯„å­˜å™¨ä¸­ï¼Œç„¶åæ¥ç€æ¢å¤æŸ¥è¯¢æ“ä½œã€‚</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">0x0044 ldp    x9, x17, [x12]</span><br></pre></td></tr></table></figure><p>è¯¥æŒ‡ä»¤ä¸ºåŠ è½½æ–° bucket ä¿¡æ¯åˆ° x9ï¼Œx17 å¯„å­˜å™¨ä¸­ã€‚</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">0x0048 cmp    x9, x1</span><br><span class="line">0x004c b.ne   0x54</span><br><span class="line">0x0050 br     x17</span><br></pre></td></tr></table></figure><p>è¯¥æ®µæŒ‡ä»¤ä¸å‰é¢çš„ 0x0020 å¤„çš„åŠŸèƒ½ä¸€è‡´ï¼Œåªè¦å¯„å­˜å™¨å†…å®¹åŒ¹é…ä¸Šäº†å°±è·³è½¬åˆ°å¯¹åº” IMP ä½ç½®æ‰§è¡Œä»£ç ã€‚</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">0x0054 cbz    x9, __objc_msgSend_uncached</span><br></pre></td></tr></table></figure><p>åŒæ ·çš„ï¼Œè‹¥ä¸åŒ¹é…åˆ™æ‰§è¡Œä¸å‰é¢ 0x002c ä¸€æ ·çš„å¤„ç†æµç¨‹ã€‚</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">0x0058 cmp    x12, x10</span><br><span class="line">0x005c b.eq   0x68</span><br></pre></td></tr></table></figure><p>è¯¥æŒ‡ä»¤ä¸ 0x0030 å¤„ä¸€è‡´ï¼Œåªä¸è¿‡å¦‚æœæ­¤æ—¶ x12 å¯„å­˜å™¨å†…å®¹ä¾æ—§æ˜¯å“ˆå¸Œè¡¨é¦–åœ°å€çš„è¯ç¨‹åºä¼šè·³è½¬åˆ° 0x68 å¤„è¿›è¡Œå¤„ç†ã€‚</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">0x0068 b      __objc_msgSend_uncached</span><br></pre></td></tr></table></figure><p>è¿™ç§æƒ…å†µä¸€èˆ¬ä¸å¤ªå®¹æ˜“å‘ç”Ÿï¼Œå› ä¸ºå®ƒä¼šå¯¼è‡´å“ˆå¸Œè¡¨æŒç»­è†¨èƒ€ã€‚æ­¤æ—¶å“ˆå¸Œè¡¨çš„æŸ¥è¯¢æ•ˆç‡ä¼šä¸‹é™è€Œå»æ½œåœ¨å“ˆå¸Œç¢°æ’çš„å¯èƒ½æ€§ä¼šå˜é«˜ã€‚</p><p>è‡³äºåŸå› ï¼Œæºç ä¸­çš„æ³¨é‡Šæ˜¯è¿™äº›å†™çš„ï¼š</p><blockquote><p>Clone scanning loop to miss instead of hang when cache is corrupt. The slow path may detect any corruption and halt later.<br>å½“ç¼“å­˜æŸåæ—¶ï¼Œéœ€è¦è·³å‡ºä¸Šé¢çš„å¾ªç¯æŸ¥è¯¢æµç¨‹è€Œä¸æ˜¯è¿›å…¥æŒ‚èµ·çŠ¶æ€ã€‚ è½¬è€Œæ‰§è¡Œæ…¢é€Ÿè·¯å¾„æµç¨‹å»æ£€æµ‹ä»»ä½•å¯èƒ½çš„æŸåå¹¶ç»ˆæ­¢ä»£ç æ‰§è¡Œã€‚</p></blockquote><p>æˆ‘æ€€ç–‘è¿™ç§æƒ…å†µå¾ˆå¸¸è§ï¼Œä½†å¾ˆæ˜¾ç„¶è‹¹æœå…¬å¸çš„å‘˜å·¥å·²ç»çœ‹åˆ°å†…å­˜æŸåä¼šè®©å“ˆå¸Œè¡¨å……æ»¡æ— æ•ˆå†…å®¹æ‰€ä»¥åœ¨æ­¤å¤„è·³è½¬åˆ° C ä»£ç ä¸­è¿›è¡Œé”™è¯¯è¯Šæ–­ã€‚</p><p>æ­¤é¡¹æ£€æŸ¥çš„å­˜åœ¨åº”è¯¥å°†å¯¹æœªæŸåçš„ç¼“å­˜çš„å½±å“é™ä½åˆ°æœ€å°ã€‚å»é™¤è¯¥æ£€æŸ¥ï¼ŒåŸæ¥çš„å¾ªç¯å¤„ç†æµç¨‹å¯ä»¥è¢«é‡ç”¨ï¼Œè¿™ä¼šèŠ‚çœä¸€ç‚¹æŒ‡ä»¤ç¼“å­˜ç©ºé—´ã€‚ æ— è®ºå¦‚ä½•ï¼Œè¯¥å¤„ç†ç¨‹åºå™¨å¹¶ä¸æ˜¯å¸¸è§çš„æƒ…å†µã€‚ åªä¼šåœ¨å“ˆå¸Œè¡¨çš„å¼€å§‹ä½ç½®æŸ¥è¯¢åˆ°æ‰€éœ€çš„é€‰æ‹©å­æˆ–è€…å‘ç”Ÿäº†å“ˆå¸Œç¢°æ’æ—¶æ‰ä¼šè¢«è°ƒç”¨ã€‚</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">0x0060 ldp    x9, x17, [x12, #-0x10]!</span><br><span class="line">0x0064 b      0x48</span><br></pre></td></tr></table></figure><p>è¯¥æ®µæŒ‡ä»¤ä¸ä¹‹å‰åŠŸèƒ½ä¸€è‡´ï¼ŒåŠ è½½æ–° bucket ä¿¡æ¯åˆ° x9ï¼Œx17 å¯„å­˜å™¨ä¸­ã€‚æ›´æ–° x12 ä¸­çš„åœ°å€ï¼Œå¹¶è·³è½¬åˆ° 0x48 å¤„é‡å¤æŸ¥æ‰¾æµç¨‹ã€‚</p><p>objc_msgSend çš„ä¸»è¦å¤„ç†æµç¨‹åˆ°æ­¤å‘Šä¸€æ®µè½ï¼Œå‰©ä¸‹ Tagged Pointer å’Œ <code>nil</code> ä¸¤ä¸ªç‰¹æ®Šæƒ…å½¢çš„å¤„ç†ã€‚</p><h2 id="æ ‡è®°æŒ‡é’ˆçš„å¤„ç†"><a href="#æ ‡è®°æŒ‡é’ˆçš„å¤„ç†" class="headerlink" title="æ ‡è®°æŒ‡é’ˆçš„å¤„ç†"></a>æ ‡è®°æŒ‡é’ˆçš„å¤„ç†</h2><p>æˆ‘ä»¬å›åˆ°ç¬¬ä¸€ç»„æ±‡ç¼–æŒ‡ä»¤çš„è·³è½¬å¤„æ¥è®²è§£æ ‡è®°æŒ‡é’ˆï¼ˆ<code>Tagged Pointer</code>ï¼‰çš„å¤„ç†ã€‚</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">0x006c b.eq    0xa4</span><br></pre></td></tr></table></figure><p>å½“å‚æ•° <em>self</em> ä¸å¤§äº 0 æ—¶ï¼Œè¯¥æŒ‡ä»¤å°±ä¼šè¢«è§¦å‘ã€‚å…¶ä¸­å°äº 0 å¯¹åº”æ ‡è®°æŒ‡é’ˆï¼Œè€Œç­‰äºé›¶åˆ™å¯¹åº” <code>nil</code> ã€‚è¿™ä¸¤ç§æƒ…å½¢æœ‰å„è‡ªçš„å¤„ç†æµç¨‹ï¼Œæ‰€ä»¥ç¬¬ä¸€æ­¥å°±æ˜¯è¦åŒºåˆ†å‡ºåˆ°åº•æ˜¯å“ªç§æƒ…å½¢ã€‚è‹¥ä¸º <em>nil</em> æƒ…å½¢åˆ™è·³è½¬åˆ° 0xa4 å¤„è¿›è¡Œå¤„ç†ï¼Œå¦åˆ™ç»§ç»­æ‰§è¡Œã€‚</p><p>åœ¨ç»§ç»­è®²è§£ä¹‹å‰ï¼Œå…ˆç®€å•è®¨è®ºä¸‹æ ‡è®°æŒ‡é’ˆå·¥ä½œåŸç†ã€‚ æ ‡è®°æŒ‡é’ˆæ”¯æŒå¤šä¸ªç±»ã€‚å…¶ä¸­é«˜ 4 ä½ï¼ˆåœ¨ ARM64 ä¸Šï¼‰æŒ‡æ˜äº†â€œå¯¹è±¡â€çš„ç±»ä¿¡æ¯ï¼Œæœ¬è´¨ä¸Šå°±æ˜¯ Tagged Pointer çš„ isa ã€‚å½“ç„¶ 4 ä¸ªæ¯”ç‰¹ä½ä¸è¶³ä»¥å®¹çº³ä¸€ä¸ªç±»æŒ‡é’ˆï¼Œå®é™…ä¸Šè¿™äº›ä¿¡æ¯éƒ½è¢«å­˜åœ¨äº†ä¸€å¼ ç‰¹æ®Šè¡¨ä¸­ã€‚æˆ‘ä»¬å¯ä»¥ä»¥é«˜ 4 ä½çš„å€¼ä¸ºç´¢å¼•å»è¡¨ä¸­æŸ¥è¯¢çœŸæ­£çš„ç±»ä¿¡æ¯ã€‚</p><p>è¿™è¿˜ä¸æ˜¯å…¨éƒ¨ï¼Œæ ‡è®°æŒ‡é’ˆï¼ˆè‡³å°‘åœ¨ ARM64 ä¸Šï¼‰æ”¯æŒæ‹“å±•ç±»ã€‚å½“é«˜ 4 ä½å…¨ä¸º 1 æ—¶ï¼Œç´§æ¥ç€çš„ 8 ä¸ªæ¯”ç‰¹ä½å°†è¢«ç”¨ä½œæ‹“å±•ç±»è¡¨ä¸­çš„ç´¢å¼•å€¼ã€‚ è¿™æ ·åœ¨è¿è¡Œæ—¶æ”¯æŒæ›´å¤šçš„æ ‡è®°æŒ‡é’ˆç±»ï¼Œä¸è¿‡ä»£ä»·å°±æ˜¯èƒ½å­˜å‚¨çš„æœ‰æ•ˆä¿¡æ¯ä¼šå˜å°‘ã€‚</p><p>ä¸‹é¢ç»§ç»­æŒ‡ä»¤çš„æ‰§è¡Œã€‚</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">0x0070 mov    x10, #-0x1000000000000000</span><br></pre></td></tr></table></figure><p>è¯¥æŒ‡ä»¤å°†ä¸€ä¸ªæ•´å½¢å€¼ï¼ˆé«˜ 4 ä½ä¸º 1 ï¼Œå…¶ä½™å…¨ä¸º 0ï¼‰å†™å…¥ x10 å¯„å­˜å™¨ä¸­ã€‚è¿™å°†ç”¨ä½œä¸‹ä¸€æ­¥æå– <code>self</code> æ ‡è®°ä½çš„æ©ç ã€‚</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">0x0074 cmp    x0, x10</span><br><span class="line">0x0078 b.hs   0x90</span><br></pre></td></tr></table></figure><p>è¿™ä¸€æ­¥æ—¶æ£€æŸ¥æ‹“å±•æ ‡è®°æŒ‡é’ˆå†…å®¹ã€‚å¦‚æœ <code>self</code> å¤§äºæˆ–è€…ç­‰äº x10 ä¸­çš„å€¼ï¼Œåˆ™æ„å‘³è¿™ <code>self</code> çš„é«˜ 4 ä½ä¹Ÿå…¨éƒ¨ä¸º 1 ã€‚æ­¤æ—¶ä»£ç ä¼šè·³è½¬åˆ° 0x90 å¤„ç†æ‹“å±•ç±»éƒ¨åˆ†çš„å†…å®¹ï¼Œå¦åˆ™å°±ç»§ç»­æ‰§è¡Œä¸‹é¢çš„æŒ‡ä»¤å»ä¸»æ ‡è®°æŒ‡é’ˆè¡¨ä¸­çš„æŸ¥è¯¢ç±»ä¿¡æ¯ã€‚</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">0x007c adrp   x10, _objc_debug_taggedpointer_classes@PAGE</span><br><span class="line">0x0080 add    x10, x10, _objc_debug_taggedpointer_classes@PAGEOFF</span><br></pre></td></tr></table></figure><p>è¯¥æ®µæŒ‡ä»¤ä¸»è¦å°±æ˜¯åŠ è½½ <code>_objc_debug_taggedpointer_classes@PAGE</code>  æ‰€æŒ‡çš„ä¸»æ ‡è®°æŒ‡é’ˆè¡¨åœ°å€ã€‚å› ä¸º ARM64 ä¸Šçš„æŒ‡é’ˆæ˜¯ 64 ä½å®½ï¼Œè€ŒæŒ‡ä»¤åªæœ‰ 32 ä½å®½ï¼Œæ‰€ä»¥éœ€è¦é‡‡ç”¨ç±» RISC æ ‡å‡†æŠ€æœ¯é€šè¿‡ä¸¤ä¸ªæŒ‡ä»¤æ¥åŠ è½½ç¬¦å·åœ°å€ã€‚</p><p>x86 æ¶æ„åˆ™ä¸å­˜åœ¨è¯¥é—®é¢˜ï¼Œå› ä¸ºå®ƒé‡‡ç”¨å¯å˜é•¿åº¦æŒ‡ä»¤é›†ã€‚å®ƒå¯ä»¥é€šè¿‡ä¸€ä¸ª 10 å­—èŠ‚é•¿çš„æŒ‡ä»¤å¤„ç†ä¸Šé¢çš„é—®é¢˜ï¼š2 ä¸ªå­—èŠ‚ç”¨æ¥åŒºåˆ†å…·ä½“æŒ‡ä»¤å’Œå¯„å­˜å™¨ï¼Œå‰©ä¸‹ 8 ä¸ªå­—èŠ‚ç”¨æ¥ä¿å­˜æŒ‡é’ˆåœ°å€ã€‚</p><p>è€Œåœ¨å®šé•¿æŒ‡ä»¤é›†æœºå™¨ä¸Šï¼Œæˆ‘ä»¬åªèƒ½é€šè¿‡ä¸€ç»„å‘½ä»¤åŠ ä»¥åº”å¯¹ã€‚ä¾‹å¦‚ï¼Œä¸Šä¾‹å°±æ˜¯é€šè¿‡ä¸¤æ¡æŒ‡ä»¤å®ç° 64 ä½æŒ‡é’ˆåœ°å€çš„åŠ è½½æ“ä½œã€‚adrp æŒ‡ä»¤åŠ è½½é«˜ 32 ä½ä¿¡æ¯ç„¶åå†é€šè¿‡ add æŒ‡ä»¤å°†å…¶ä¸ä½ 32 ä½è¿›è¡Œæ±‚å’Œã€‚</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">0x0084 lsr    x11, x0, #60</span><br></pre></td></tr></table></figure><p>å› ä¸ºç´¢å¼•å€¼ä¿å­˜åœ¨ x0 çš„é«˜ 4 ä½ä¸­ï¼Œæ‰€ä»¥è¯¥æŒ‡ä»¤å°† x0 è¿›è¡Œå³ç§» 60 ä½å–å‡ºå¯¹åº”çš„ç´¢å¼•å€¼ï¼ˆå–å€¼èŒƒå›´ä¸º 0-15ï¼‰å¹¶ä¿å­˜åˆ° x11 ä¸­ã€‚</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">0x0088 ldr    x16, [x10, x11, lsl #3]</span><br></pre></td></tr></table></figure><p>æ ¹æ®ç´¢å¼•å€¼è·å–æ ‡è®°æŒ‡é’ˆçš„ç±»ä¿¡æ¯å¹¶ä¿å­˜åˆ° x16 ä¸­ã€‚</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">0x008c b      0x10</span><br></pre></td></tr></table></figure><p>è·å¾—ç±»ä¿¡æ¯åç¨‹åºä¼šæ— æ¡ä»¶è·³å› 0x10 å¤„ï¼Œå¹¶å¤ç”¨ä¸»åˆ†æ”¯ä¸­çš„ä»£ç è¿›è¡Œæ–¹æ³•æŸ¥è¯¢å¤„ç†ã€‚</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">0x0090 adrp   x10, _objc_debug_taggedpointer_ext_classes@PAGE</span><br><span class="line">0x0094 add    x10, x10, _objc_debug_taggedpointer_ext_classes@PAGEOFF</span><br></pre></td></tr></table></figure><p>è¯¥æ®µæŒ‡ä»¤ä¸å‰é¢åŠ è½½ä¸»æ ‡è®°æŒ‡é’ˆè¡¨åŠŸèƒ½ä¸€æ ·ï¼Œåªä¸è¿‡æ­¤æ—¶å®ƒç”¨äºå¤„ç†å‰é¢æåˆ°çš„æ‹“å±•è¡¨åˆ†æ”¯ã€‚</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">0x0098 ubfx   x11, x0, #52, #8</span><br></pre></td></tr></table></figure><p>è¯¥æŒ‡ä»¤åªè¦æ˜¯å–å‡º <em>self</em> ä¸­ä»ç¬¬ 52 ä½å¼€å§‹çš„ 8 ä½ä¿¡æ¯ä½œä¸ºæ‹“å±•è¡¨çš„ç´¢å¼•å€¼ï¼Œå¹¶å°†å…¶ä¿å­˜åˆ° x11 ä¸­ã€‚</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">0x009c ldr    x16, [x10, x11, lsl #3]</span><br></pre></td></tr></table></figure><p>å†ä¸€æ¬¡ï¼Œæˆ‘ä»¬å°†è·å¾—çš„ç±»ä¿¡æ¯åŠ è½½åˆ° x16 ä¸­ã€‚</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">0x00a0 b      0x10</span><br></pre></td></tr></table></figure><p>æœ€åï¼Œæˆ‘ä»¬åŒæ ·è·³å›åˆ° 0x10 å¤„ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥çœ‹ <code>nil</code> æƒ…å½¢çš„å¤„ç†è¿‡ç¨‹ã€‚</p><h2 id="nil-çš„å¤„ç†"><a href="#nil-çš„å¤„ç†" class="headerlink" title="nil çš„å¤„ç†"></a><code>nil</code> çš„å¤„ç†</h2><p>ä½œä¸ºæœ€åä¸€ä¸ªç‰¹æ®Šæƒ…å†µï¼Œä¸‹é¢å°±æ˜¯ <code>nil</code> æƒ…å½¢ä¸‹è¢«æ‰§è¡Œçš„æ‰€æœ‰æŒ‡ä»¤ã€‚</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">0x00a4 mov    x1, #0x0</span><br><span class="line">0x00a8 movi   d0, #0000000000000000</span><br><span class="line">0x00ac movi   d1, #0000000000000000</span><br><span class="line">0x00b0 movi   d2, #0000000000000000</span><br><span class="line">0x00b4 movi   d3, #0000000000000000</span><br><span class="line">0x00b8 ret</span><br></pre></td></tr></table></figure><p><code>nil</code> æƒ…å½¢çš„å¤„ç†ä¸å…¶ä»–æƒ…å½¢å®Œå…¨ä¸åŒï¼Œå®ƒä¸ä¼šè¿›è¡Œç±»æŸ¥è¯¢å’Œæ–¹æ³•æ´¾å‘ï¼Œè€Œä»…ä»…è¿”å› 0 ç»™è°ƒç”¨è€…ã€‚</p><p>è¯¥æ®µæŒ‡ä»¤æœ€éº»çƒ¦çš„äº‹æƒ…æ˜¯ <code>objc_msgSend</code> ä¸çŸ¥é“å…·ä½“çš„è¿”å›å€¼ç±»å‹ã€‚æ˜¯æ•´å‹å€¼ã€æµ®ç‚¹å€¼ã€äº¦æˆ–è€…æ˜¯ä»€ä¹ˆéƒ½ä¸è¿”å›ã€‚</p><p>å¹¸è¿çš„æ˜¯ï¼Œæ‰€æœ‰ç”¨äºè®¾ç½®è¿”å›å€¼çš„å¯„å­˜å™¨éƒ½èƒ½è¢«å®‰å…¨è¦†å†™ï¼Œå³ä½¿æ­¤æ¬¡è°ƒç”¨è¿‡ç¨‹ä¸ä¼šä½¿ç”¨åˆ°ã€‚æ•´å‹è¿”å›å€¼è¢«ä¿å­˜åœ¨ x0 å’Œ x1 ä¸­ï¼Œè€Œæµ®ç‚¹å€¼åˆ™ä¿å­˜åœ¨å‘é‡å¯„å­˜å™¨ v0 - v3 ä¸­ã€‚åŒæ—¶ä½¿ç”¨å¤šä¸ªå¯„å­˜å™¨å¯ä»¥è¿”å›ä¸€ä¸ªå°å‹ç»“æ„ä½“ç±»å‹è¿”å›å€¼ã€‚</p><p>åœ¨å¤„ç† <code>nil</code> æƒ…å½¢æ—¶ï¼Œä¸Šè¯‰æŒ‡ä»¤ä¼šå°† x1 ä»¥åŠ v0 - v3 ä¸­çš„å€¼å…¨éƒ¨æ¸…ç©ºå¹¶è®¾ç½®ä¸º 0ã€‚å…¶ä¸­ d0 - d3 åˆ†åˆ«å¯¹åº”å‘é‡å¯„å­˜å™¨ v0 - v3 çš„ååŠéƒ¨åˆ†ï¼Œé€šè¿‡å°†å…¶è®¾ç½®ä¸º 0 æ¸…é™¤äº†ååŠéƒ¨åˆ†ç„¶ååœ¨é€šè¿‡ movi æ¸…é™¤æ‰€æœ‰çš„å¯„å­˜å™¨å†…å®¹ã€‚æ¸…ç©ºè¿”å›å€¼å¯„å­˜å™¨åï¼Œæ§åˆ¶æƒå°†é‡æ–°å›åˆ°è°ƒç”¨æ–¹ã€‚</p><p>å¦‚æœè¿”å›å€¼ä¸ºæ¯”è¾ƒå¤§çš„ç»“æ„ä½“ï¼Œé‚£ä¹ˆå¯„å­˜å™¨å¯èƒ½å°±å˜çš„ä¸å¤Ÿç”¨äº†ã€‚æ­¤æ—¶å°±éœ€è¦è°ƒç”¨è€…åšå‡ºä¸€äº›é…åˆã€‚è°ƒç”¨è€…ä¼šåœ¨ä¸€å¼€å§‹ä¸ºè¯¥ç»“æ„ä½“åˆ†é…ä¸€å—å†…å­˜ï¼Œç„¶åå°†å…¶åœ°å€æå‰å†™å…¥åˆ° x8 å¯„å­˜å™¨ä¸­ã€‚åœ¨è®¾ç½®è¿”å›å€¼çš„æ—¶å€™ï¼Œç›´æ¥å¾€è¯¥åœ°å€ä¸­å†™æ•°æ®å³å¯ã€‚<br>å› ä¸ºè¯¥å†…å­˜å¤§å°å¯¹ <code>objc_msgSend</code> æ˜¯é€æ˜çš„ï¼Œå› æ­¤ä¸èƒ½å¯¹å…¶è¿›è¡Œæ¸…ç©ºæ“ä½œã€‚å–è€Œä»£ä¹‹çš„æ“ä½œå°±æ˜¯åœ¨è°ƒç”¨ <code>objc_msgSend</code>  ä¹‹å‰ç¼–è¯‘å™¨ä¼šå°†å…¶è®¾ç½®ä¸º 0 ã€‚</p><p>ä»¥ä¸Šå°±æ˜¯ <code>nil</code> æƒ…å½¢çš„å¤„ç†ï¼Œ<code>objc_msgSend</code> æµç¨‹åˆ°æ­¤ä¹Ÿå®£å‘Šç»“æŸã€‚</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>æ·±å…¥æ¡†æ¶åº•å±‚è¿˜æ˜¯å¾ˆæœ‰è¶£çš„ï¼Œè€Œ <code>objc_msgSend</code>  å°±åƒä¸€ä»¶è‰ºæœ¯å“ï¼Œå€¼å¾—ç»†ç»†ç©å‘³ã€‚</p><p>ä»Šå¤©çš„å†…å®¹åˆ°æ­¤ç»“æŸï¼Œä¸‹æ¬¡å†ä¼šä¸ºå¤§å®¶å¸¦æ¥ä¸€äº›æ›´å¥½çš„å†…å®¹ã€‚Friday Q&amp;A å¾ˆå¤šå†…å®¹éƒ½æ˜¯ç”±è¯»è€…é©±åŠ¨è€Œæ¥ï¼Œæ‰€ä»¥æ¬¢è¿å¤§å®¶åœ¨ä¸‹é¢ç§¯æå‘è¨€ã€‚</p><h3 id="æ±‡ç¼–æŒ‡ä»¤æ ¡å¯¹è€…æ³¨"><a href="#æ±‡ç¼–æŒ‡ä»¤æ ¡å¯¹è€…æ³¨" class="headerlink" title="æ±‡ç¼–æŒ‡ä»¤æ ¡å¯¹è€…æ³¨"></a>æ±‡ç¼–æŒ‡ä»¤æ ¡å¯¹è€…æ³¨</h3><ol><li><code>#0x0</code>ï¼šâ€œ#â€ä¿®é¥°çš„æ•°å­—è¡¨ç¤ºç«‹å³æ•°ï¼Œå¯ç®€å•ç†è§£ä¸ºæ•°å€¼ï¼Œè€Œéåœ°å€ï¼š</li><li><code>b</code> ï¼šè·³è½¬æŒ‡ä»¤ï¼Œb.le æŒ‡æ¯”è¾ƒç»“æœå°äºç­‰äºçš„æ—¶å€™è·³è½¬è‡³æŸå†…å­˜åœ°å€ï¼›</li><li><code>ldr</code> ï¼šä»å†…å­˜ä¸­è¯»å–æ•°æ®åˆ°å¯„å­˜å™¨ï¼›</li><li><code>and</code>ï¼šarm çš„ <code>and</code> æŒ‡ä»¤ï¼Œéœ€è¦3ä¸ªæ“ä½œæ•°ï¼Œä¾‹å¦‚ <code>AND R0ï¼ŒR0ï¼Œ#3</code> æ˜¯å°† R0 å¯„å­˜å™¨çš„å€¼ä¸æ•°å­—3ï¼ˆ0x0000003ï¼‰é€»è¾‘ä¸ï¼Œå°†ç»“æœå­˜å‚¨ä¸º R0 å¯„å­˜å™¨</li><li><code>add</code>ï¼š<code>ADD[con][S] Rd,Rn,operand</code>ï¼Œå°† operand æ•°æ®ä¸ Rn çš„å€¼ç›¸åŠ ï¼Œç»“æœä¿å­˜åˆ° Rd å¯„å­˜å™¨ï¼›</li><li><code>lsl</code>ï¼š é€»è¾‘å·¦ç§»æŒ‡ä»¤ï¼Œå¯ä»¥ç»“åˆ <code>add</code> æŒ‡ä»¤ä¸€èµ·ä½¿ç”¨ï¼Œå¦‚<code>ADDS R0,R1,R2,LSL#2</code>ï¼Œå°† R2 å¯„å­˜å™¨å·¦ç§» 2 ä½ï¼Œæ¥ç€ R1 å’Œ R2 å€¼ç›¸åŠ ï¼Œå°†ç»“æœå­˜å‚¨åˆ° R0 ä¸­ï¼›</li><li><code>cbz</code>ï¼šcå¯¹åº”compareï¼Œbå°±æ˜¯ä¸Šé¢çš„è·³è½¬ï¼Œzå¯¹åº”0 zeroï¼Œå› æ­¤è¿™æ¡å‘½ä»¤å½“æ¯”è¾ƒç»“æœä¸ºé›¶ï¼ˆZeroï¼‰å°±è·³è½¬è‡³ä¹‹åçš„æŒ‡ä»¤ï¼›</li><li><code>UXTW</code>ï¼š 32 ä½çš„é€»è¾‘å·¦ç§»æŒ‡ä»¤ï¼Œæ›´å¤šè¯·è§<a href="http://lists.llvm.org/pipermail/llvm-commits/Week-of-Mon-20140407/212142.html" target="_blank" rel="noopener">[llvm] r205861</a>;</li><li><code>LSR</code>ï¼š é€»è¾‘å³ç§»ï¼›</li><li><code>UBFX</code>ï¼š<code>UBFX{cond} Rd, Rn, #lsb, #width</code> ä»ä¸€ä¸ªå¯„å­˜å™¨ä¸­æå–ä½åŸŸï¼Œcond â€”å¯é€‰ï¼Œæ¡ä»¶ç  ï¼›Rd â€” ç›®æ ‡å¯„å­˜å™¨ ï¼›Rn â€” æºå¯„å­˜å™¨ ï¼›lsb â€”ä½åŸŸçš„æœ€ä½æœ‰æ•ˆä½çš„ä½ç½®ï¼ŒèŒƒå›´æ˜¯ 0 - 31ï¼› width â€” ä½åŸŸçš„å®½åº¦ï¼ŒèŒƒå›´æ˜¯1åˆ° 32-lsb</li></ol><blockquote><p>æœ¬æ–‡ç”± SwiftGG ç¿»è¯‘ç»„ç¿»è¯‘ï¼Œå·²ç»è·å¾—ä½œè€…ç¿»è¯‘æˆæƒï¼Œæœ€æ–°æ–‡ç« è¯·è®¿é—® <a href="http://swift.gg">http://swift.gg</a>ã€‚</p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;ä½œè€…ï¼šMike Ashï¼Œ&lt;a href=&quot;https://www.mikeash.com/pyblog/friday-qa-2017-06-30-dissecting-objc_msgsend-on-arm64.html&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;åŸæ–‡é“¾æ¥&lt;/a&gt;ï¼ŒåŸæ–‡æ—¥æœŸï¼š2017-06-30&lt;br&gt;è¯‘è€…ï¼š&lt;a href=&quot;https://bignerdcoding.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;BigNerdCoding&lt;/a&gt;ï¼›æ ¡å¯¹ï¼š&lt;a href=&quot;http://www.jianshu.com/users/596f2ba91ce9/latest_articles&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;pmst&lt;/a&gt;ï¼Œ&lt;a href=&quot;http://codebuild.me/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;shanks&lt;/a&gt;ï¼›å®šç¨¿ï¼š&lt;a href=&quot;https://github.com/chenmingbiao&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;CMB&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;!--æ­¤å¤„å¼€å§‹æ­£æ–‡--&gt;
&lt;p&gt;å¾ˆé«˜å…´ï¼Œæˆ‘åˆå›æ¥äº†ã€‚åœ¨åˆšåˆšè¿‡å»çš„ WWDC æœŸé—´ï¼Œæˆ‘åœ¨ CocoaConf Next Door åšä¸ªä¸€ä¸ªå…³äºå‰–æ ARM64 ä¸Š &lt;code&gt;objc_msgSend&lt;/code&gt; è¿è¡Œæµç¨‹çš„å‘è¨€ã€‚ç°åœ¨æˆ‘å°†æ•´ç†åçš„å†…å®¹é‡æ–°å‘å¸ƒåˆ° Friday Q&amp;amp;A ä¸Šã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="Mike Ash" scheme="https://swift.gg/categories/Mike-Ash/"/>
    
    
      <category term="iOS å¼€å‘" scheme="https://swift.gg/tags/iOS-%E5%BC%80%E5%8F%91/"/>
    
  </entry>
  
</feed>
