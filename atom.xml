<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>SwiftGG</title>
  
  <subtitle>èµ°å¿ƒçš„ Swift ç¿»è¯‘ç»„</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://swift.gg/"/>
  <updated>2019-08-14T12:15:53.984Z</updated>
  <id>https://swift.gg/</id>
  
  <author>
    <name>SwiftGG</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>ç»™ UIView æ¥ç‚¹çƒŸèŠ±</title>
    <link href="https://swift.gg/2019/08/14/add-fireworks-and-sparks-to-a-uiview/"/>
    <id>https://swift.gg/2019/08/14/add-fireworks-and-sparks-to-a-uiview/</id>
    <published>2019-08-14T00:00:00.000Z</published>
    <updated>2019-08-14T12:15:53.984Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ä½œè€…ï¼šTomasz Szulcï¼Œ<a href="http://szulctomasz.com/programming-blog/2018/09/add-fireworks-and-sparks-to-a-uiview/" target="_blank" rel="noopener">åŸæ–‡é“¾æ¥</a>ï¼ŒåŸæ–‡æ—¥æœŸï¼š2018-09<br>è¯‘è€…ï¼š<a href="https://github.com/joeytat" target="_blank" rel="noopener">Joeytat</a>ï¼›æ ¡å¯¹ï¼š<a href="http://numbbbbb.com/" target="_blank" rel="noopener">numbbbbb</a>ï¼Œ<a href="https://github.com/WAMaker" target="_blank" rel="noopener">WAMaker</a>ï¼›å®šç¨¿ï¼š<a href="undefined">Pancf</a></p></blockquote><!--æ­¤å¤„å¼€å§‹æ­£æ–‡--><a id="more"></a><p>ä½ ä¹Ÿå¾ˆå–œæ¬¢å¸¸ç”¨ app é‡Œçš„é‚£äº›å°ç»†èŠ‚å§ï¼Ÿå½“æˆ‘ä» <a href="https://dribbble.com/" target="_blank" rel="noopener">dribbble</a> ä¸­å¯»æ‰¾çµæ„Ÿæ—¶ï¼Œå°±å‘ç°äº†è¿™ä¸ªæ¼‚äº®çš„è®¾è®¡ï¼šå½“ç”¨æˆ·åœ¨æŸä¸ªé‡è¦çš„è§†å›¾ä¸­ä¿®æ”¹è®¾ç½®æˆ–è€…è¿›è¡Œäº†ä»€ä¹ˆæ“ä½œæ—¶ï¼Œä¼šæœ‰çƒŸèŠ±åœ¨å‘¨å›´ç»½æ”¾ã€‚äºæ˜¯æˆ‘å°±åœ¨æƒ³è¿™ä¸ªä¸œè¥¿æœ‰å¤šéš¾å®ç°ï¼Œç„¶åè¿‡äº†ä¸€æ®µæ—¶é—´ï¼Œæˆ‘å®Œæˆäº† :)</p><p><img src="http://szulctomasz.com/uploads/programming-blog/post-54/hero.gif" alt="hero"></p><h2 id="çƒŸèŠ±çš„ç»†èŠ‚"><a href="#çƒŸèŠ±çš„ç»†èŠ‚" class="headerlink" title="çƒŸèŠ±çš„ç»†èŠ‚"></a><em>çƒŸèŠ±çš„ç»†èŠ‚</em></h2><p>ä¸‹é¢æ˜¯å¯¹äºè¿™ä¸ªæ•ˆæœçš„è¯¦ç»†æè¿°ã€‚çƒŸèŠ±åº”è¯¥åœ¨è§†å›¾å‘¨å›´çš„æŸä¸ªç‰¹æ®Šçš„ä½ç½®çˆ†å¼€ï¼Œå¯èƒ½æ˜¯æŒ‰é’®åœ¨ç‚¹å‡»äº‹ä»¶å“åº”æ—¶ã€‚å½“ç‚¹å‡»å‘ç”Ÿæ—¶ï¼ŒçƒŸèŠ±åº”è¯¥åœ¨æŒ‰é’®çš„å››è§’çˆ†å¼€ï¼Œå¹¶ä¸”çˆ†ç‚¸äº§ç”Ÿçš„ç«èŠ±åº”è¯¥æŒ‰ç…§è‡ªèº«çš„è½¨è¿¹ç§»åŠ¨ã€‚</p><p><img src="http://szulctomasz.com/uploads/programming-blog/post-54/final.jpg" alt="final"></p><p><em>è¶…å–œæ¬¢è¿™ä¸ªæ•ˆæœ! ä¸ä»…è®©æˆ‘æ„Ÿå—åˆ°è§†è§‰ä¸Šçš„æ„‰æ‚¦ï¼Œè¿˜è®©æˆ‘æƒ³è¦ä¸åœåœ°æˆ³è¿™ä¸ªæŒ‰é’®ï¼ :) ğŸ‰</em></p><p>ç°åœ¨è®©æˆ‘ä»¬å†çœ‹ä¸€çœ¼è¿™ä¸ªåŠ¨ç”»ã€‚æ¯æ¬¡ç”Ÿæˆçš„çƒŸèŠ±ï¼Œå…¶æ•´ä½“è¡Œä¸ºæ˜¯å¤§è‡´ç›¸ä¼¼çš„ã€‚ä½†è¿˜æ˜¯åœ¨ç«èŠ±çš„è½¨è¿¹å’Œå¤§å°ä¸Šæœ‰ä¸€äº›åŒºåˆ«ã€‚è®©æˆ‘ä»¬æ‹†å¼€æ¥è¯´ã€‚</p><ul><li>æ¯ä¸€æ¬¡ç‚¹å‡»éƒ½ä¼šäº§ç”Ÿ<em>ä¸¤å¤„çƒŸèŠ±</em>ï¼Œ</li><li>æ¯ä¸€å¤„çƒŸèŠ±ä¼šäº§ç”Ÿ <em>8 ä¸ªç«èŠ±</em>ï¼Œ</li><li>æ¯ä¸ªç«èŠ±éƒ½éµå¾ªç€è‡ªå·±çš„<em>è½¨è¿¹</em>ï¼Œ</li><li>è½¨è¿¹çœ‹èµ·æ¥<em>ç›¸ä¼¼</em>ï¼Œä½†å…¶å®<em>ä¸å®Œå…¨ä¸€æ ·</em>ã€‚ä»çˆ†ç‚¸<em>å¼€å§‹</em>çš„ä½ç½®æ¥çœ‹ï¼Œæœ‰éƒ¨åˆ†æœ<em>å³</em>ï¼Œæœ‰éƒ¨åˆ†æœ<em>å·¦</em>ï¼Œå‰©ä½™çš„æœ<em>ä¸Š</em>æˆ–<em>ä¸‹</em>ã€‚</li></ul><h2 id="ç«èŠ±çš„åˆ†å¸ƒ"><a href="#ç«èŠ±çš„åˆ†å¸ƒ" class="headerlink" title="ç«èŠ±çš„åˆ†å¸ƒ"></a><em>ç«èŠ±çš„åˆ†å¸ƒ</em></h2><p>è¿™ä¸ªçƒŸèŠ±ç‰¹æ•ˆæœ‰ç€ç®€å•çš„ç«èŠ±åˆ†å¸ƒè§„åˆ™ã€‚å°†çˆ†ç‚¸ç‚¹åˆ†ä¸ºå››å—ã€Œè§†çº¿åŒºåŸŸã€æ¥çœ‹ï¼šä¸Šå·¦ï¼Œä¸Šå³ï¼Œä¸‹å·¦ï¼Œä¸‹å³ï¼Œæ¯ä¸ªåŒºåŸŸéƒ½æœ‰ä¸¤ä¸ªç«èŠ±ã€‚</p><p><img src="http://szulctomasz.com/uploads/programming-blog/post-54/sparks-distribution.jpg" alt="sparks distribution"></p><h2 id="ç«èŠ±çš„è½¨è¿¹"><a href="#ç«èŠ±çš„è½¨è¿¹" class="headerlink" title="ç«èŠ±çš„è½¨è¿¹"></a><em>ç«èŠ±çš„è½¨è¿¹</em></h2><p>ç«èŠ±çš„ç§»åŠ¨æœ‰ç€è‡ªå·±çš„è½¨è¿¹ã€‚åœ¨ä¸€å¤„çƒŸèŠ±ä¸­æœ‰ 8 ä¸ªç«èŠ±ï¼Œé‚£è‡³å°‘éœ€è¦ 8 é“è½¨è¿¹ã€‚ç†æƒ³çŠ¶æ€ä¸‹åº”è¯¥æœ‰æ›´å¤šçš„è½¨è¿¹ï¼Œå¯ä»¥å¢åŠ ä¸€äº›éšæœºæ€§ï¼Œè¿™æ ·è¿ç»­çˆ†å‘çƒŸèŠ±çš„æ—¶å€™ï¼Œä¸ä¼šçœ‹èµ·æ¥å’Œå‰ä¸€ä¸ªå®Œå…¨ä¸€æ ·ã€‚</p><p><img src="http://szulctomasz.com/uploads/programming-blog/post-54/spark-trajectories.jpg" alt="spark-trajectories"></p><p>æˆ‘ä¸ºæ¯ä¸€ä¸ªåŒºåŸŸåˆ›å»ºäº† 4 æ¡è½¨è¿¹ï¼Œè¿™æ ·å°±èµ‹äºˆäº†ä¸¤å€äºç«èŠ±æ•°é‡çš„éšæœºæ€§ã€‚ä¸ºäº†æ–¹ä¾¿è®¡ç®—ï¼Œæˆ‘ç»Ÿä¸€äº†æ¯æ¡è½¨è¿¹çš„åˆå§‹ç‚¹ã€‚å› ä¸ºæˆ‘ç”¨äº†ä¸åŒçš„å·¥å…·æ¥å¯è§†åŒ–è¿™äº›è½¨è¿¹ï¼Œæ‰€ä»¥å›¾ä¸Šçš„è½¨è¿¹å’Œæˆ‘å®Œæˆçš„æ•ˆæœç•¥æœ‰ä¸åŒ - ä½†ä½ èƒ½æ˜ç™½æˆ‘çš„æƒ³æ³•å°±è¡Œ :)</p><h2 id="å®ç°"><a href="#å®ç°" class="headerlink" title="_å®ç°_"></a>_å®ç°_</h2><p>ç†è®ºè¶³å¤Ÿäº†ã€‚æ¥ä¸‹æ¥è®©æˆ‘ä»¬æŠŠå„ä¸ªæ¨¡å—æ‹¼å‡‘èµ·æ¥ã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">SparkTrajectory</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// å­˜å‚¨ç€å®šä¹‰è½¨è¿¹æ‰€éœ€è¦çš„æ‰€æœ‰çš„ç‚¹</span></span><br><span class="line">    <span class="keyword">var</span> points: [<span class="type">CGPoint</span>] &#123; <span class="keyword">get</span> <span class="keyword">set</span> &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// ç”¨ path æ¥è¡¨ç°è½¨è¿¹</span></span><br><span class="line">    <span class="keyword">var</span> path: <span class="type">UIBezierPath</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ˜¯ä¸€ä¸ªç”¨äºè¡¨ç¤ºç«èŠ±è½¨è¿¹çš„åè®®ã€‚ä¸ºäº†èƒ½å¤Ÿæ›´ç®€å•åœ°åˆ›å»ºå„å¼å„æ ·çš„è½¨è¿¹ï¼Œæˆ‘å®šä¹‰äº†è¿™ä¸ªé€šç”¨æ¥å£åè®®ï¼Œå¹¶ä¸”é€‰æ‹©åŸºäºä¸‰é˜¶ <a href="https://en.wikipedia.org/wiki/B%C3%A9zier_curve" target="_blank" rel="noopener">è´å¡å°”æ›²çº¿</a> æ¥å®ç°è½¨è¿¹ï¼›è¿˜æ·»åŠ äº†ä¸€ä¸ª <code>init</code> æ–¹æ³•ï¼Œè¿™æ ·æˆ‘å°±å¯ä»¥é€šè¿‡ä¸€è¡Œä»£ç æ¥åˆ›å»ºè½¨è¿¹äº†ã€‚ä¸‰é˜¶è´å¡å°”æ›²çº¿å¿…é¡»åŒ…å«å››ä¸ªç‚¹ã€‚ç¬¬ä¸€ä¸ªå’Œæœ€åä¸€ä¸ªç‚¹å®šä¹‰äº†è½¨è¿¹çš„å¼€å§‹å’Œç»“æŸçš„ä½ç½®ï¼Œä¸­é—´çš„ä¸¤ä¸ªç‚¹ç”¨äºæ§åˆ¶æ›²çº¿çš„å¼¯æ›²åº¦ã€‚ä½ å¯ä»¥ç”¨åœ¨çº¿æ•°å­¦å·¥å…· <a href="https://www.desmos.com/calculator/epunzldltu" target="_blank" rel="noopener">desmos</a> æ¥è°ƒæ•´è‡ªå·±çš„è´å¡å°”æ›²çº¿ã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">/// æ‹¥æœ‰ä¸¤ä¸ªæ§åˆ¶ç‚¹çš„è´å¡å°”æ›²çº¿</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">CubicBezierTrajectory</span>: <span class="title">SparkTrajectory</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> points = [<span class="type">CGPoint</span>]()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">init</span>(<span class="number">_</span> x0: <span class="type">CGFloat</span>, <span class="number">_</span> y0: <span class="type">CGFloat</span>,</span><br><span class="line">         <span class="number">_</span> x1: <span class="type">CGFloat</span>, <span class="number">_</span> y1: <span class="type">CGFloat</span>,</span><br><span class="line">         <span class="number">_</span> x2: <span class="type">CGFloat</span>, <span class="number">_</span> y2: <span class="type">CGFloat</span>,</span><br><span class="line">         <span class="number">_</span> x3: <span class="type">CGFloat</span>, <span class="number">_</span> y3: <span class="type">CGFloat</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.points.append(<span class="type">CGPoint</span>(x: x0, y: y0))</span><br><span class="line">        <span class="keyword">self</span>.points.append(<span class="type">CGPoint</span>(x: x1, y: y1))</span><br><span class="line">        <span class="keyword">self</span>.points.append(<span class="type">CGPoint</span>(x: x2, y: y2))</span><br><span class="line">        <span class="keyword">self</span>.points.append(<span class="type">CGPoint</span>(x: x3, y: y3))</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> path: <span class="type">UIBezierPath</span> &#123;</span><br><span class="line">        <span class="keyword">guard</span> <span class="keyword">self</span>.points.<span class="built_in">count</span> == <span class="number">4</span> <span class="keyword">else</span> &#123; <span class="built_in">fatalError</span>(<span class="string">"4 points required"</span>) &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> path = <span class="type">UIBezierPath</span>()</span><br><span class="line">        path.move(to: <span class="keyword">self</span>.points[<span class="number">0</span>])</span><br><span class="line">        path.addCurve(to: <span class="keyword">self</span>.points[<span class="number">3</span>], controlPoint1: <span class="keyword">self</span>.points[<span class="number">1</span>], controlPoint2: <span class="keyword">self</span>.points[<span class="number">2</span>])</span><br><span class="line">        <span class="keyword">return</span> path</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="http://szulctomasz.com/uploads/programming-blog/post-54/desmos-tool.png" alt="desmos-tool"></p><p>æ¥ä¸‹æ¥è¦å®ç°çš„æ˜¯ä¸€ä¸ªèƒ½å¤Ÿåˆ›å»ºéšæœºè½¨è¿¹çš„å·¥å‚ã€‚å‰é¢çš„å›¾ä¸­ä½ å¯ä»¥çœ‹åˆ°è½¨è¿¹æ˜¯æ ¹æ®é¢œè‰²æ¥åˆ†ç»„çš„ã€‚æˆ‘åªåˆ›å»ºäº†ä¸Šå³å’Œä¸‹å³ä¸¤å—ä½ç½®çš„è½¨è¿¹ï¼Œç„¶åè¿›è¡Œäº†é•œåƒå¤åˆ¶ã€‚è¿™å¯¹äºæˆ‘ä»¬å°†è¦å‘å°„çš„çƒŸèŠ±æ¥è¯´å·²ç»è¶³å¤Ÿäº†ğŸš€</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">SparkTrajectoryFactory</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">ClassicSparkTrajectoryFactoryProtocol</span>: <span class="title">SparkTrajectoryFactory</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">randomTopRight</span><span class="params">()</span></span> -&gt; <span class="type">SparkTrajectory</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">randomBottomRight</span><span class="params">()</span></span> -&gt; <span class="type">SparkTrajectory</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">ClassicSparkTrajectoryFactory</span>: <span class="title">ClassicSparkTrajectoryFactoryProtocol</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">lazy</span> <span class="keyword">var</span> topRight: [<span class="type">SparkTrajectory</span>] = &#123;</span><br><span class="line">        <span class="keyword">return</span> [</span><br><span class="line">            <span class="type">CubicBezierTrajectory</span>(<span class="number">0.00</span>, <span class="number">0.00</span>, <span class="number">0.31</span>, -<span class="number">0.46</span>, <span class="number">0.74</span>, -<span class="number">0.29</span>, <span class="number">0.99</span>, <span class="number">0.12</span>),</span><br><span class="line">            <span class="type">CubicBezierTrajectory</span>(<span class="number">0.00</span>, <span class="number">0.00</span>, <span class="number">0.31</span>, -<span class="number">0.46</span>, <span class="number">0.62</span>, -<span class="number">0.49</span>, <span class="number">0.88</span>, -<span class="number">0.19</span>),</span><br><span class="line">            <span class="type">CubicBezierTrajectory</span>(<span class="number">0.00</span>, <span class="number">0.00</span>, <span class="number">0.10</span>, -<span class="number">0.54</span>, <span class="number">0.44</span>, -<span class="number">0.53</span>, <span class="number">0.66</span>, -<span class="number">0.30</span>),</span><br><span class="line">            <span class="type">CubicBezierTrajectory</span>(<span class="number">0.00</span>, <span class="number">0.00</span>, <span class="number">0.19</span>, -<span class="number">0.46</span>, <span class="number">0.41</span>, -<span class="number">0.53</span>, <span class="number">0.65</span>, -<span class="number">0.45</span>),</span><br><span class="line">        ]</span><br><span class="line">    &#125;()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">lazy</span> <span class="keyword">var</span> bottomRight: [<span class="type">SparkTrajectory</span>] = &#123;</span><br><span class="line">        <span class="keyword">return</span> [</span><br><span class="line">            <span class="type">CubicBezierTrajectory</span>(<span class="number">0.00</span>, <span class="number">0.00</span>, <span class="number">0.42</span>, -<span class="number">0.01</span>, <span class="number">0.68</span>, <span class="number">0.11</span>, <span class="number">0.87</span>, <span class="number">0.44</span>),</span><br><span class="line">            <span class="type">CubicBezierTrajectory</span>(<span class="number">0.00</span>, <span class="number">0.00</span>, <span class="number">0.35</span>, <span class="number">0.00</span>, <span class="number">0.55</span>, <span class="number">0.12</span>, <span class="number">0.62</span>, <span class="number">0.45</span>),</span><br><span class="line">            <span class="type">CubicBezierTrajectory</span>(<span class="number">0.00</span>, <span class="number">0.00</span>, <span class="number">0.21</span>, <span class="number">0.05</span>, <span class="number">0.31</span>, <span class="number">0.19</span>, <span class="number">0.32</span>, <span class="number">0.45</span>),</span><br><span class="line">            <span class="type">CubicBezierTrajectory</span>(<span class="number">0.00</span>, <span class="number">0.00</span>, <span class="number">0.18</span>, <span class="number">0.00</span>, <span class="number">0.31</span>, <span class="number">0.11</span>, <span class="number">0.35</span>, <span class="number">0.25</span>),</span><br><span class="line">        ]</span><br><span class="line">    &#125;()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">randomTopRight</span><span class="params">()</span></span> -&gt; <span class="type">SparkTrajectory</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">self</span>.topRight[<span class="type">Int</span>(arc4random_uniform(<span class="type">UInt32</span>(<span class="keyword">self</span>.topRight.<span class="built_in">count</span>)))]</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">randomBottomRight</span><span class="params">()</span></span> -&gt; <span class="type">SparkTrajectory</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">self</span>.bottomRight[<span class="type">Int</span>(arc4random_uniform(<span class="type">UInt32</span>(<span class="keyword">self</span>.bottomRight.<span class="built_in">count</span>)))]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå…ˆåˆ›å»ºäº†ç”¨æ¥è¡¨ç¤ºç«èŠ±è½¨è¿¹å·¥å‚çš„æŠ½è±¡åè®®ï¼Œè¿˜æœ‰ä¸€ä¸ªæˆ‘å°†å…¶å‘½åä¸º<em>ç»å…¸çƒŸèŠ±</em>çš„ç«èŠ±è½¨è¿¹çš„æŠ½è±¡åè®®ï¼Œè¿™æ ·çš„æŠ½è±¡å¯ä»¥æ–¹ä¾¿åç»­å°†å…¶æ›¿æ¢æˆå…¶ä»–çš„è½¨è¿¹åè®®ã€‚</p><p>å¦‚åŒæˆ‘å‰é¢æåˆ°çš„ï¼Œæˆ‘é€šè¿‡ <a href="https://www.desmos.com/calculator/epunzldltu" target="_blank" rel="noopener">desmos</a> åˆ›å»ºäº†ä¸¤ç»„è½¨è¿¹ï¼Œå¯¹åº”ç€å³ä¸Šï¼Œå’Œå³ä¸‹ä¸¤å—åŒºåŸŸã€‚</p><p><strong>é‡è¦æé†’</strong>ï¼šå¦‚æœåœ¨ desmos ä¸Š y è½´æ‰€æ˜¾ç¤ºçš„æ˜¯æ­£æ•°ï¼Œé‚£ä¹ˆä½ åº”è¯¥å°†å…¶è½¬æ¢æˆè´Ÿæ•°ã€‚å› ä¸ºåœ¨ iOS ç³»ç»Ÿä¸­ï¼Œè¶Šæ¥è¿‘å±å¹•é¡¶éƒ¨ y è½´çš„å€¼è¶Šå°ï¼Œæ‰€ä»¥ y è½´çš„å€¼éœ€è¦ç¿»è½¬ä¸€ä¸‹ã€‚</p><p>å¹¶ä¸”å€¼å¾—ä¸€æçš„æ˜¯ï¼Œä¸ºäº†åé¢å¥½è®¡ç®—ï¼Œæ‰€æœ‰çš„è½¨è¿¹åˆå§‹ç‚¹éƒ½æ˜¯ (0,0)ã€‚</p><p>æˆ‘ä»¬ç°åœ¨åˆ›å»ºå¥½äº†è½¨è¿¹ã€‚æ¥ä¸‹æ¥åˆ›å»ºä¸€äº›è§†å›¾æ¥è¡¨ç¤ºç«èŠ±ã€‚å¯¹äºç»å…¸çƒŸèŠ±æ¥è¯´ï¼Œåªéœ€è¦æœ‰é¢œè‰²çš„åœ†åœˆå°±è¡Œã€‚é€šè¿‡æŠ½è±¡å¯ä»¥è®©æˆ‘ä»¬åœ¨æœªæ¥ä»¥æ›´ä½çš„æˆæœ¬ï¼Œåˆ›å»ºä¸åŒçš„ç«èŠ±è§†å›¾ã€‚æ¯”å¦‚å°é¸­å­å›¾ç‰‡ï¼Œæˆ–è€…æ˜¯èƒ–å‰çŒ« :)</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SparkView</span>: <span class="title">UIView</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">CircleColorSparkView</span>: <span class="title">SparkView</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">init</span>(color: <span class="type">UIColor</span>, size: <span class="type">CGSize</span>) &#123;</span><br><span class="line">        <span class="keyword">super</span>.<span class="keyword">init</span>(frame: <span class="type">CGRect</span>(origin: .zero, size: size))</span><br><span class="line">        <span class="keyword">self</span>.backgroundColor = color</span><br><span class="line">        <span class="keyword">self</span>.layer.cornerRadius = <span class="keyword">self</span>.frame.width / <span class="number">2.0</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">required</span> <span class="keyword">init</span>?(coder aDecoder: <span class="type">NSCoder</span>) &#123;</span><br><span class="line">        <span class="keyword">super</span>.<span class="keyword">init</span>(coder: aDecoder)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">UIColor</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> sparkColorSet1: [<span class="type">UIColor</span>] = &#123;</span><br><span class="line">        <span class="keyword">return</span> [</span><br><span class="line">            <span class="type">UIColor</span>(red:<span class="number">0.89</span>, green:<span class="number">0.58</span>, blue:<span class="number">0.70</span>, alpha:<span class="number">1.00</span>),</span><br><span class="line">            <span class="type">UIColor</span>(red:<span class="number">0.96</span>, green:<span class="number">0.87</span>, blue:<span class="number">0.62</span>, alpha:<span class="number">1.00</span>),</span><br><span class="line">            <span class="type">UIColor</span>(red:<span class="number">0.67</span>, green:<span class="number">0.82</span>, blue:<span class="number">0.94</span>, alpha:<span class="number">1.00</span>),</span><br><span class="line">            <span class="type">UIColor</span>(red:<span class="number">0.54</span>, green:<span class="number">0.56</span>, blue:<span class="number">0.94</span>, alpha:<span class="number">1.00</span>),</span><br><span class="line">        ]</span><br><span class="line">    &#125;()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸ºäº†åˆ›å»ºç«èŠ±è§†å›¾ï¼Œæˆ‘ä»¬è¿˜éœ€è¦ä¸€ä¸ªå·¥å‚æ•°æ®ä»¥å¡«å……ï¼Œéœ€è¦çš„æ•°æ®æ˜¯ç«èŠ±çš„å¤§å°ï¼Œä»¥åŠç”¨æ¥å†³å®šç«èŠ±åœ¨å“ªä¸ªçƒŸèŠ±çš„ç´¢å¼•ï¼ˆç”¨äºå¢åŠ éšæœºæ€§ï¼‰ã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">SparkViewFactoryData</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> size: <span class="type">CGSize</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">    <span class="keyword">var</span> index: <span class="type">Int</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">SparkViewFactory</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">create</span><span class="params">(with data: SparkViewFactoryData)</span></span> -&gt; <span class="type">SparkView</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CircleColorSparkViewFactory</span>: <span class="title">SparkViewFactory</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> colors: [<span class="type">UIColor</span>] &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="type">UIColor</span>.sparkColorSet1</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">create</span><span class="params">(with data: SparkViewFactoryData)</span></span> -&gt; <span class="type">SparkView</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> color = <span class="keyword">self</span>.colors[data.index % <span class="keyword">self</span>.colors.<span class="built_in">count</span>]</span><br><span class="line">        <span class="keyword">return</span> <span class="type">CircleColorSparkView</span>(color: color, size: data.size)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½ çœ‹è¿™æ ·æŠ½è±¡äº†ä¹‹åï¼Œå°±ç®—å†å®ç°ä¸€ä¸ªåƒèƒ–å‰çŒ«çš„ç«èŠ±ä¹Ÿä¼šå¾ˆç®€å•ã€‚æ¥ä¸‹æ¥è®©æˆ‘ä»¬æ¥åˆ›å»º<em>ç»å…¸çƒŸèŠ±</em>ã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">typealias</span> <span class="type">FireworkSpark</span> = (sparkView: <span class="type">SparkView</span>, trajectory: <span class="type">SparkTrajectory</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">Firework</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// çƒŸèŠ±çš„åˆå§‹ä½ç½®</span></span><br><span class="line">    <span class="keyword">var</span> origin: <span class="type">CGPoint</span> &#123; <span class="keyword">get</span> <span class="keyword">set</span> &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// å®šä¹‰äº†è½¨è¿¹çš„å¤§å°. è½¨è¿¹éƒ½æ˜¯ç»Ÿä¸€å¤§å°</span></span><br><span class="line">    <span class="comment">/// æ‰€ä»¥éœ€è¦åœ¨å±•ç¤ºåˆ°å±å¹•ä¸Šå‰å°†å…¶æ”¾å¤§</span></span><br><span class="line">    <span class="keyword">var</span> scale: <span class="type">CGFloat</span> &#123; <span class="keyword">get</span> <span class="keyword">set</span> &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// ç«èŠ±çš„å¤§å°</span></span><br><span class="line">    <span class="keyword">var</span> sparkSize: <span class="type">CGSize</span> &#123; <span class="keyword">get</span> <span class="keyword">set</span> &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// è·å–è½¨è¿¹</span></span><br><span class="line">    <span class="keyword">var</span> trajectoryFactory: <span class="type">SparkTrajectoryFactory</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// è·å–ç«èŠ±è§†å›¾</span></span><br><span class="line">    <span class="keyword">var</span> sparkViewFactory: <span class="type">SparkViewFactory</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">sparkViewFactoryData</span><span class="params">(at index: Int)</span></span> -&gt; <span class="type">SparkViewFactoryData</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">sparkView</span><span class="params">(at index: Int)</span></span> -&gt; <span class="type">SparkView</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">trajectory</span><span class="params">(at index: Int)</span></span> -&gt; <span class="type">SparkTrajectory</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Firework</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// å¸®åŠ©æ–¹æ³•ï¼Œç”¨äºè¿”å›ç«èŠ±è§†å›¾åŠå¯¹åº”çš„è½¨è¿¹</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">spark</span><span class="params">(at index: Int)</span></span> -&gt; <span class="type">FireworkSpark</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="type">FireworkSpark</span>(<span class="keyword">self</span>.sparkView(at: index), <span class="keyword">self</span>.trajectory(at: index))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™å°±æ˜¯çƒŸèŠ±çš„æŠ½è±¡ã€‚ä¸ºäº†è¡¨ç¤ºä¸€ä¸ªçƒŸèŠ±éœ€è¦è¿™äº›ä¸œè¥¿:</p><ul><li><em>origin</em></li><li><em>scale</em></li><li><em>sparkSize</em></li><li><em>trajectoryFactory</em></li><li><em>sparkViewFactory</em></li></ul><p>åœ¨æˆ‘ä»¬å®ç°åè®®ä¹‹å‰ï¼Œè¿˜æœ‰ä¸€ä¸ªæˆ‘ä¹‹å‰æ²¡æœ‰æåˆ°è¿‡çš„å«åš<em>æŒ‰è½¨è¿¹ç¼©æ”¾</em>çš„æ¦‚å¿µã€‚å½“ç«èŠ±å¤„äºè½¨è¿¹ &lt;-1, 1&gt; æˆ–ç›¸ä¼¼çš„ä½ç½®æ—¶ï¼Œæˆ‘ä»¬å¸Œæœ›å®ƒçš„å¤§å°ä¼šè·Ÿéšè½¨è¿¹å˜åŒ–ã€‚æˆ‘ä»¬è¿˜éœ€è¦æ”¾å¤§è·¯å¾„ä»¥è¦†ç›–æ›´å¤§çš„å±å¹•æ˜¾ç¤ºæ•ˆæœã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜éœ€è¦æ”¯æŒæ°´å¹³ç¿»è½¬è·¯å¾„ï¼Œä»¥æ–¹ä¾¿æˆ‘ä»¬å®ç°ç»å…¸çƒŸèŠ±å·¦ä¾§éƒ¨åˆ†çš„è½¨è¿¹ï¼Œå¹¶ä¸”è¿˜è¦è®©è½¨è¿¹èƒ½æœæŸä¸ªæŒ‡å®šæ–¹å‘åç§»ä¸€ç‚¹ï¼ˆå¢åŠ éšæœºæ€§ï¼‰ã€‚ä¸‹é¢æ˜¯ä¸¤ä¸ªèƒ½å¤Ÿå¸®åŠ©æˆ‘ä»¬è¾¾åˆ°ç›®çš„çš„æ–¹æ³•ï¼Œæˆ‘ç›¸ä¿¡è¿™æ®µä»£ç å·²ç»ä¸éœ€è¦æ›´å¤šæè¿°äº†ã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">SparkTrajectory</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// ç¼©æ”¾è½¨è¿¹ä½¿å…¶ç¬¦åˆå„ç§ UI çš„è¦æ±‚</span></span><br><span class="line">    <span class="comment">/// åœ¨å„ç§å½¢å˜å’Œ shift: ä¹‹å‰ä½¿ç”¨</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">scale</span><span class="params">(by value: CGFloat)</span></span> -&gt; <span class="type">SparkTrajectory</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> copy = <span class="keyword">self</span></span><br><span class="line">        (<span class="number">0</span>..&lt;<span class="keyword">self</span>.points.<span class="built_in">count</span>).forEach &#123; copy.points[$<span class="number">0</span>].multiply(by: value) &#125;</span><br><span class="line">        <span class="keyword">return</span> copy</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// æ°´å¹³ç¿»è½¬è½¨è¿¹</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">flip</span><span class="params">()</span></span> -&gt; <span class="type">SparkTrajectory</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> copy = <span class="keyword">self</span></span><br><span class="line">        (<span class="number">0</span>..&lt;<span class="keyword">self</span>.points.<span class="built_in">count</span>).forEach &#123; copy.points[$<span class="number">0</span>].x *= -<span class="number">1</span> &#125;</span><br><span class="line">        <span class="keyword">return</span> copy</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// åç§»è½¨è¿¹ï¼Œåœ¨æ¯ä¸ªç‚¹ä¸Šç”Ÿæ•ˆ</span></span><br><span class="line">    <span class="comment">/// åœ¨å„ç§å½¢å˜å’Œ scale: å’Œä¹‹åä½¿ç”¨</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">shift</span><span class="params">(to point: CGPoint)</span></span> -&gt; <span class="type">SparkTrajectory</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> copy = <span class="keyword">self</span></span><br><span class="line">        <span class="keyword">let</span> vector = <span class="type">CGVector</span>(dx: point.x, dy: point.y)</span><br><span class="line">        (<span class="number">0</span>..&lt;<span class="keyword">self</span>.points.<span class="built_in">count</span>).forEach &#123; copy.points[$<span class="number">0</span>].add(vector: vector) &#125;</span><br><span class="line">        <span class="keyword">return</span> copy</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¥½äº†ï¼Œæ¥ä¸‹æ¥å°±æ˜¯å®ç°ç»å…¸çƒŸèŠ±ã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ClassicFirework</span>: <span class="title">Firework</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     x     |     x</span></span><br><span class="line"><span class="comment">        x  |   x</span></span><br><span class="line"><span class="comment">           |</span></span><br><span class="line"><span class="comment">     ---------------</span></span><br><span class="line"><span class="comment">         x |  x</span></span><br><span class="line"><span class="comment">       x   |</span></span><br><span class="line"><span class="comment">           |     x</span></span><br><span class="line"><span class="comment">     **/</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="class"><span class="keyword">struct</span> <span class="title">FlipOptions</span>: <span class="title">OptionSet</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> rawValue: <span class="type">Int</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">let</span> horizontally = <span class="type">FlipOptions</span>(rawValue: <span class="number">1</span> &lt;&lt; <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">let</span> vertically = <span class="type">FlipOptions</span>(rawValue: <span class="number">1</span> &lt;&lt; <span class="number">1</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="class"><span class="keyword">enum</span> <span class="title">Quarter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">case</span> topRight</span><br><span class="line">        <span class="keyword">case</span> bottomRight</span><br><span class="line">        <span class="keyword">case</span> bottomLeft</span><br><span class="line">        <span class="keyword">case</span> topLeft</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> origin: <span class="type">CGPoint</span></span><br><span class="line">    <span class="keyword">var</span> scale: <span class="type">CGFloat</span></span><br><span class="line">    <span class="keyword">var</span> sparkSize: <span class="type">CGSize</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> maxChangeValue: <span class="type">Int</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">10</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> trajectoryFactory: <span class="type">SparkTrajectoryFactory</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="type">ClassicSparkTrajectoryFactory</span>()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> classicTrajectoryFactory: <span class="type">ClassicSparkTrajectoryFactoryProtocol</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">self</span>.trajectoryFactory <span class="keyword">as</span>! <span class="type">ClassicSparkTrajectoryFactoryProtocol</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> sparkViewFactory: <span class="type">SparkViewFactory</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="type">CircleColorSparkViewFactory</span>()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> quarters = [<span class="type">Quarter</span>]()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">init</span>(origin: <span class="type">CGPoint</span>, sparkSize: <span class="type">CGSize</span>, scale: <span class="type">CGFloat</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.origin = origin</span><br><span class="line">        <span class="keyword">self</span>.scale = scale</span><br><span class="line">        <span class="keyword">self</span>.sparkSize = sparkSize</span><br><span class="line">        <span class="keyword">self</span>.quarters = <span class="keyword">self</span>.shuffledQuarters()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">sparkViewFactoryData</span><span class="params">(at index: Int)</span></span> -&gt; <span class="type">SparkViewFactoryData</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="type">DefaultSparkViewFactoryData</span>(size: <span class="keyword">self</span>.sparkSize, index: index)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">sparkView</span><span class="params">(at index: Int)</span></span> -&gt; <span class="type">SparkView</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">self</span>.sparkViewFactory.create(with: <span class="keyword">self</span>.sparkViewFactoryData(at: index))</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">trajectory</span><span class="params">(at index: Int)</span></span> -&gt; <span class="type">SparkTrajectory</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> quarter = <span class="keyword">self</span>.quarters[index]</span><br><span class="line">        <span class="keyword">let</span> flipOptions = <span class="keyword">self</span>.flipOptions(<span class="keyword">for</span>: quarter)</span><br><span class="line">        <span class="keyword">let</span> changeVector = <span class="keyword">self</span>.randomChangeVector(flipOptions: flipOptions, maxValue: <span class="keyword">self</span>.maxChangeValue)</span><br><span class="line">        <span class="keyword">let</span> sparkOrigin = <span class="keyword">self</span>.origin.adding(vector: changeVector)</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">self</span>.randomTrajectory(flipOptions: flipOptions).scale(by: <span class="keyword">self</span>.scale).shift(to: sparkOrigin)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">flipOptions</span><span class="params">(`<span class="keyword">for</span>` quarter: Quarter)</span></span> -&gt; <span class="type">FlipOptions</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> flipOptions: <span class="type">FlipOptions</span> = []</span><br><span class="line">        <span class="keyword">if</span> quarter == .bottomLeft || quarter == .topLeft &#123;</span><br><span class="line">            flipOptions.insert(.horizontally)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> quarter == .bottomLeft || quarter == .bottomRight &#123;</span><br><span class="line">            flipOptions.insert(.vertically)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> flipOptions</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">shuffledQuarters</span><span class="params">()</span></span> -&gt; [<span class="type">Quarter</span>] &#123;</span><br><span class="line">        <span class="keyword">var</span> quarters: [<span class="type">Quarter</span>] = [</span><br><span class="line">            .topRight, .topRight,</span><br><span class="line">            .bottomRight, .bottomRight,</span><br><span class="line">            .bottomLeft, .bottomLeft,</span><br><span class="line">            .topLeft, .topLeft</span><br><span class="line">        ]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> shuffled = [<span class="type">Quarter</span>]()</span><br><span class="line">        <span class="keyword">for</span> <span class="number">_</span> <span class="keyword">in</span> <span class="number">0</span>..&lt;quarters.<span class="built_in">count</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> idx = <span class="type">Int</span>(arc4random_uniform(<span class="type">UInt32</span>(quarters.<span class="built_in">count</span>)))</span><br><span class="line">            shuffled.append(quarters[idx])</span><br><span class="line">            quarters.remove(at: idx)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> shuffled</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">randomTrajectory</span><span class="params">(flipOptions: FlipOptions)</span></span> -&gt; <span class="type">SparkTrajectory</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> trajectory: <span class="type">SparkTrajectory</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> flipOptions.<span class="built_in">contains</span>(.vertically) &#123;</span><br><span class="line">            trajectory = <span class="keyword">self</span>.classicTrajectoryFactory.randomBottomRight()</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            trajectory = <span class="keyword">self</span>.classicTrajectoryFactory.randomTopRight()</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> flipOptions.<span class="built_in">contains</span>(.horizontally) ? trajectory.flip() : trajectory</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">randomChangeVector</span><span class="params">(flipOptions: FlipOptions, maxValue: Int)</span></span> -&gt; <span class="type">CGVector</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> values = (<span class="keyword">self</span>.randomChange(maxValue), <span class="keyword">self</span>.randomChange(maxValue))</span><br><span class="line">        <span class="keyword">let</span> changeX = flipOptions.<span class="built_in">contains</span>(.horizontally) ? -values.<span class="number">0</span> : values.<span class="number">0</span></span><br><span class="line">        <span class="keyword">let</span> changeY = flipOptions.<span class="built_in">contains</span>(.vertically) ? values.<span class="number">1</span> : -values.<span class="number">0</span></span><br><span class="line">        <span class="keyword">return</span> <span class="type">CGVector</span>(dx: changeX, dy: changeY)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">randomChange</span><span class="params">(<span class="number">_</span> maxValue: Int)</span></span> -&gt; <span class="type">CGFloat</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="type">CGFloat</span>(arc4random_uniform(<span class="type">UInt32</span>(maxValue)))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¤§å¤šæ•°ä»£ç éƒ½æ˜¯ <code>Firework</code> åè®®çš„å®ç°ï¼Œæ‰€ä»¥åº”è¯¥å¾ˆå®¹æ˜“ç†è§£ã€‚æˆ‘ä»¬åœ¨å„å¤„ä¼ é€’äº†éœ€è¦çš„å·¥å‚ç±»ï¼Œè¿˜æ·»åŠ äº†ä¸€ä¸ªé¢å¤–çš„æšä¸¾ç±»å‹æ¥éšæœºåœ°ä¸ºæ¯ä¸ªç«èŠ±æŒ‡å®šè½¨è¿¹ã€‚</p><p>æœ‰å°‘æ•°å‡ ä¸ªæ–¹æ³•ç”¨æ¥ä¸ºçƒŸèŠ±å’Œç«èŠ±å¢åŠ éšæœºæ€§ã€‚</p><p>è¿˜å¼•å…¥äº†ä¸€ä¸ª <code>quarters</code> å±æ€§ï¼Œå…¶ä¸­åŒ…å«äº†ç«èŠ±çš„æ‰€æœ‰çš„æ–¹ä½ã€‚æˆ‘ä»¬é€šè¿‡  <code>shuffledQuarters:</code> æ¥é‡æ–°æ’åˆ—ï¼Œä»¥ç¡®ä¿æˆ‘ä»¬ä¸ä¼šæ€»æ˜¯åœ¨ç›¸åŒçš„æ–¹ä½åˆ›å»ºç›¸åŒæ•°é‡çš„ç«èŠ±ã€‚</p><p>å¥½äº†ï¼Œæˆ‘ä»¬åˆ›å»ºå¥½äº†çƒŸèŠ±ï¼Œæ¥ä¸‹æ¥æ€ä¹ˆè®©ç«èŠ±åŠ¨èµ·æ¥å‘¢ï¼Ÿè¿™å°±å¼•å…¥äº†ç«èŠ±åŠ¨ç”»å¯åŠ¨å™¨çš„æ¦‚å¿µã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">SparkViewAnimator</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">animate</span><span class="params">(spark: FireworkSpark, duration: TimeInterval)</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ–¹æ³•æ¥å—ä¸€ä¸ªåŒ…å«ç«èŠ±è§†å›¾å’Œå…¶å¯¹åº”è½¨è¿¹çš„å…ƒç»„ <code>FireworkSpark</code>ï¼Œä»¥åŠåŠ¨ç”»çš„æŒç»­æ—¶é—´ã€‚æ–¹æ³•çš„å®ç°å–å†³äºæˆ‘ä»¬ã€‚æˆ‘è‡ªå·±çš„å®ç°è›®å¤šçš„ï¼Œä½†ä¸»è¦åšäº†ä¸‰ä»¶äº‹æƒ…ï¼šè®©ç«èŠ±è§†å›¾è·Ÿéšè½¨è¿¹ï¼ŒåŒæ—¶ç¼©æ”¾ç«èŠ±ï¼ˆå¸¦æœ‰éšæœºæ€§ï¼‰ï¼Œä¿®æ”¹å…¶ä¸é€æ˜åº¦ã€‚ç®€å•å§ã€‚åŒæ—¶å¾—ç›Šäº <code>SparkViewAnimator</code> çš„æŠ½è±¡åº¦ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥å¾ˆç®€å•åœ°å°†å…¶æ›¿æ¢æˆä»»ä½•æˆ‘ä»¬æƒ³è¦çš„åŠ¨ç”»æ•ˆæœã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">ClassicFireworkAnimator</span>: <span class="title">SparkViewAnimator</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">animate</span><span class="params">(spark: FireworkSpark, duration: TimeInterval)</span></span> &#123;</span><br><span class="line">        spark.sparkView.isHidden = <span class="literal">false</span> <span class="comment">// show previously hidden spark view</span></span><br><span class="line"></span><br><span class="line">        <span class="type">CATransaction</span>.begin()</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ç«èŠ±çš„ä½ç½®</span></span><br><span class="line">        <span class="keyword">let</span> positionAnim = <span class="type">CAKeyframeAnimation</span>(keyPath: <span class="string">"position"</span>)</span><br><span class="line">        positionAnim.path = spark.trajectory.path.cgPath</span><br><span class="line">        positionAnim.calculationMode = kCAAnimationLinear</span><br><span class="line">        positionAnim.rotationMode = kCAAnimationRotateAuto</span><br><span class="line">        positionAnim.duration = duration</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ç«èŠ±çš„ç¼©æ”¾</span></span><br><span class="line">        <span class="keyword">let</span> randomMaxScale = <span class="number">1.0</span> + <span class="type">CGFloat</span>(arc4random_uniform(<span class="number">7</span>)) / <span class="number">10.0</span></span><br><span class="line">        <span class="keyword">let</span> randomMinScale = <span class="number">0.5</span> + <span class="type">CGFloat</span>(arc4random_uniform(<span class="number">3</span>)) / <span class="number">10.0</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> fromTransform = <span class="type">CATransform3DIdentity</span></span><br><span class="line">        <span class="keyword">let</span> byTransform = <span class="type">CATransform3DScale</span>(fromTransform, randomMaxScale, randomMaxScale, randomMaxScale)</span><br><span class="line">        <span class="keyword">let</span> toTransform = <span class="type">CATransform3DScale</span>(<span class="type">CATransform3DIdentity</span>, randomMinScale, randomMinScale, randomMinScale)</span><br><span class="line">        <span class="keyword">let</span> transformAnim = <span class="type">CAKeyframeAnimation</span>(keyPath: <span class="string">"transform"</span>)</span><br><span class="line"></span><br><span class="line">        transformAnim.values = [</span><br><span class="line">            <span class="type">NSValue</span>(caTransform3D: fromTransform),</span><br><span class="line">            <span class="type">NSValue</span>(caTransform3D: byTransform),</span><br><span class="line">            <span class="type">NSValue</span>(caTransform3D: toTransform)</span><br><span class="line">        ]</span><br><span class="line"></span><br><span class="line">        transformAnim.duration = duration</span><br><span class="line">        transformAnim.timingFunction = <span class="type">CAMediaTimingFunction</span>(name: kCAMediaTimingFunctionEaseOut)</span><br><span class="line">        spark.sparkView.layer.transform = toTransform</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ç«èŠ±çš„ä¸é€æ˜åº¦</span></span><br><span class="line">        <span class="keyword">let</span> opacityAnim = <span class="type">CAKeyframeAnimation</span>(keyPath: <span class="string">"opacity"</span>)</span><br><span class="line">        opacityAnim.values = [<span class="number">1.0</span>, <span class="number">0.0</span>]</span><br><span class="line">        opacityAnim.keyTimes = [<span class="number">0.95</span>, <span class="number">0.98</span>]</span><br><span class="line">        opacityAnim.duration = duration</span><br><span class="line">        spark.sparkView.layer.opacity = <span class="number">0.0</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// ç»„åˆåŠ¨ç”»</span></span><br><span class="line">        <span class="keyword">let</span> groupAnimation = <span class="type">CAAnimationGroup</span>()</span><br><span class="line">        groupAnimation.animations = [positionAnim, transformAnim, opacityAnim]</span><br><span class="line">        groupAnimation.duration = duration</span><br><span class="line"></span><br><span class="line">        <span class="type">CATransaction</span>.setCompletionBlock(&#123;</span><br><span class="line">            spark.sparkView.removeFromSuperview()</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">        spark.sparkView.layer.add(groupAnimation, forKey: <span class="string">"spark-animation"</span>)</span><br><span class="line"></span><br><span class="line">        <span class="type">CATransaction</span>.commit()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç°åœ¨çš„ä»£ç å·²ç»è¶³å¤Ÿè®©æˆ‘ä»¬åœ¨ç‰¹å®šçš„è§†å›¾ä¸Šå±•ç¤ºçƒŸèŠ±äº†ã€‚æˆ‘åˆæ›´è¿›äº†ä¸€æ­¥ï¼Œåˆ›å»ºäº†ä¸€ä¸ª <code>ClassicFireworkController</code> æ¥å¤„ç†æ‰€æœ‰çš„å·¥ä½œï¼Œè¿™æ ·ç”¨ä¸€è¡Œä»£ç å°±èƒ½å¯åŠ¨çƒŸèŠ±ã€‚</p><p>è¿™ä¸ªçƒŸèŠ±æ§åˆ¶å™¨è¿˜åšäº†å¦ä¸€ä»¶äº‹ã€‚å®ƒå¯ä»¥ä¿®æ”¹çƒŸèŠ±çš„ <code>zPosition</code>ï¼Œè¿™æ ·æˆ‘ä»¬å¯ä»¥è®©çƒŸèŠ±ä¸€å‰ä¸€ååœ°å±•ç¤ºï¼Œæ•ˆæœæ›´å¥½çœ‹ä¸€äº›ã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ClassicFireworkController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> sparkAnimator: <span class="type">SparkViewAnimator</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="type">ClassicFireworkAnimator</span>()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">createFirework</span><span class="params">(at origin: CGPoint, sparkSize: CGSize, scale: CGFloat)</span></span> -&gt; <span class="type">Firework</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="type">ClassicFirework</span>(origin: origin, sparkSize: sparkSize, scale: scale)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// è®©çƒŸèŠ±åœ¨å…¶æºè§†å›¾çš„è§’è½é™„è¿‘çˆ†å¼€</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">addFireworks</span><span class="params">(<span class="built_in">count</span> fireworksCount: Int = <span class="number">1</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">                      sparks sparksCount: Int,</span></span></span><br><span class="line"><span class="function"><span class="params">                      around sourceView: UIView,</span></span></span><br><span class="line"><span class="function"><span class="params">                      sparkSize: CGSize = CGSize<span class="params">(width: <span class="number">7</span>, height: <span class="number">7</span>)</span></span></span>,</span><br><span class="line">                      scale: <span class="type">CGFloat</span> = <span class="number">45.0</span>,</span><br><span class="line">                      maxVectorChange: <span class="type">CGFloat</span> = <span class="number">15.0</span>,</span><br><span class="line">                      animationDuration: <span class="type">TimeInterval</span> = <span class="number">0.4</span>,</span><br><span class="line">                      canChangeZIndex: <span class="type">Bool</span> = <span class="literal">true</span>) &#123;</span><br><span class="line">        <span class="keyword">guard</span> <span class="keyword">let</span> superview = sourceView.superview <span class="keyword">else</span> &#123; <span class="built_in">fatalError</span>() &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> origins = [</span><br><span class="line">            <span class="type">CGPoint</span>(x: sourceView.frame.minX, y: sourceView.frame.minY),</span><br><span class="line">            <span class="type">CGPoint</span>(x: sourceView.frame.maxX, y: sourceView.frame.minY),</span><br><span class="line">            <span class="type">CGPoint</span>(x: sourceView.frame.minX, y: sourceView.frame.maxY),</span><br><span class="line">            <span class="type">CGPoint</span>(x: sourceView.frame.maxX, y: sourceView.frame.maxY),</span><br><span class="line">            ]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> <span class="number">_</span> <span class="keyword">in</span> <span class="number">0</span>..&lt;fireworksCount &#123;</span><br><span class="line">            <span class="keyword">let</span> idx = <span class="type">Int</span>(arc4random_uniform(<span class="type">UInt32</span>(origins.<span class="built_in">count</span>)))</span><br><span class="line">            <span class="keyword">let</span> origin = origins[idx].adding(vector: <span class="keyword">self</span>.randomChangeVector(<span class="built_in">max</span>: maxVectorChange))</span><br><span class="line"></span><br><span class="line">            <span class="keyword">let</span> firework = <span class="keyword">self</span>.createFirework(at: origin, sparkSize: sparkSize, scale: scale)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> sparkIndex <span class="keyword">in</span> <span class="number">0</span>..&lt;sparksCount &#123;</span><br><span class="line">                <span class="keyword">let</span> spark = firework.spark(at: sparkIndex)</span><br><span class="line">                spark.sparkView.isHidden = <span class="literal">true</span></span><br><span class="line">                superview.addSubview(spark.sparkView)</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> canChangeZIndex &#123;</span><br><span class="line">                    <span class="keyword">let</span> zIndexChange: <span class="type">CGFloat</span> = arc4random_uniform(<span class="number">2</span>) == <span class="number">0</span> ? -<span class="number">1</span> : +<span class="number">1</span></span><br><span class="line">                    spark.sparkView.layer.zPosition = sourceView.layer.zPosition + zIndexChange</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    spark.sparkView.layer.zPosition = sourceView.layer.zPosition</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">self</span>.sparkAnimator.animate(spark: spark, duration: animationDuration)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">randomChangeVector</span><span class="params">(<span class="built_in">max</span>: CGFloat)</span></span> -&gt; <span class="type">CGVector</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="type">CGVector</span>(dx: <span class="keyword">self</span>.randomChange(<span class="built_in">max</span>: <span class="built_in">max</span>), dy: <span class="keyword">self</span>.randomChange(<span class="built_in">max</span>: <span class="built_in">max</span>))</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">randomChange</span><span class="params">(<span class="built_in">max</span>: CGFloat)</span></span> -&gt; <span class="type">CGFloat</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="type">CGFloat</span>(arc4random_uniform(<span class="type">UInt32</span>(<span class="built_in">max</span>))) - (<span class="built_in">max</span> / <span class="number">2.0</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ§åˆ¶å™¨åªåšäº†å‡ ä»¶äº‹æƒ…ã€‚éšæœºé€‰æ‹©äº†ä¸€ä¸ªè§’è½å±•ç¤ºçƒŸèŠ±ã€‚åœ¨çƒŸèŠ±å‡ºç°çš„ä½ç½®ï¼ŒçƒŸèŠ±å’Œç«èŠ±çš„æ•°é‡ä¸Šå¢åŠ äº†ä¸€äº›éšæœºæ€§ã€‚ç„¶åå°†ç«èŠ±æ·»åŠ åˆ°ç›®æ ‡è§†å›¾ä¸Šï¼Œå¦‚æœéœ€è¦çš„è¯è¿˜ä¼šè°ƒæ•´ <code>zIndex</code>ï¼Œæœ€åå¯åŠ¨äº†åŠ¨ç”»ã€‚</p><p>å‡ ä¹æ‰€æœ‰çš„å‚æ•°éƒ½è®¾ç½®äº†é»˜è®¤å‚æ•°ï¼Œæ‰€ä»¥ä½ å¯ä»¥ä¸ç®¡ä»–ä»¬ã€‚ç›´æ¥é€šè¿‡ä½ çš„æ§åˆ¶å™¨è°ƒç”¨è¿™ä¸ªï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">self</span>.fireworkController.addFireworks(<span class="built_in">count</span>: <span class="number">2</span>, sparks: <span class="number">8</span>, around: button)</span><br></pre></td></tr></table></figure><p>ç„¶åï¼Œå“‡!</p><p><img src="http://szulctomasz.com/uploads/programming-blog/post-54/classic.gif" alt="classic"></p><p>ä»è¿™ä¸€æ­¥èµ·ï¼Œæ–°æ·»åŠ ä¸€ä¸ªåƒä¸‹é¢è¿™æ ·çš„çƒŸèŠ±å°±å˜å¾—éå¸¸ç®€å•äº†ã€‚ä½ åªéœ€è¦å®šä¹‰æ–°çš„è½¨è¿¹ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„çƒŸèŠ±ï¼Œå¹¶ä¸”æŒ‰ç…§ä½ å¸Œæœ›çš„æ ·å­æ¥å®ç°å³å¯ã€‚å°†è¿™äº›ä»£ç æ”¾å…¥ä¸€ä¸ªæ§åˆ¶å™¨å¯ä»¥è®©ä½ æƒ³åœ¨å“ªé‡Œå¯åŠ¨çƒŸèŠ±éƒ½å¾ˆç®€å• :) æˆ–è€…ä½ ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨è¿™ä¸ª<em>å–·æ³‰çƒŸèŠ±</em>ï¼Œæˆ‘å·²ç»æŠŠå®ƒæ”¾åœ¨äº†æˆ‘çš„ github é¡¹ç›® <a href="https://github.com/tomkowz/fireworks" target="_blank" rel="noopener">tomkowz/fireworks</a> ä¸­ã€‚</p><p><img src="http://szulctomasz.com/uploads/programming-blog/post-54/fountain.gif" alt="fountain"></p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="_æ€»ç»“_"></a>_æ€»ç»“_</h2><p>è¿™ä¸ªåŠ¨ç”»æ•ˆæœçš„å®ç°å¹¶ä¸ç®€å•ä½†ä¹Ÿä¸ç®—å¾ˆéš¾ã€‚é€šè¿‡å¯¹é—®é¢˜ï¼ˆåœ¨æˆ‘ä»¬çš„æƒ…å†µä¸‹æ˜¯åŠ¨ç”»æ•ˆæœï¼‰çš„æ­£ç¡®åˆ†æï¼Œæˆ‘ä»¬å¯ä»¥å°†å…¶åˆ†è§£æˆå¤šä¸ªå°é—®é¢˜ï¼Œé€ä¸ªè§£å†³ç„¶åå°†å…¶ç»„åˆåœ¨ä¸€èµ·ã€‚çœŸå¸Œæœ›æˆ‘æœ‰æœºä¼šèƒ½å¤Ÿåœ¨æœªæ¥çš„çš„é¡¹ç›®ä¸­ä½¿ç”¨è¿™ä¸ªæ•ˆæœğŸ‰</p><p>å¥½å•¦è¿™å°±æ˜¯ä»Šå¤©çš„å†…å®¹ã€‚æ„Ÿè°¢é˜…è¯»ï¼</p><blockquote><p>æœ¬æ–‡ç”± SwiftGG ç¿»è¯‘ç»„ç¿»è¯‘ï¼Œå·²ç»è·å¾—ä½œè€…ç¿»è¯‘æˆæƒï¼Œæœ€æ–°æ–‡ç« è¯·è®¿é—® <a href="http://swift.gg">http://swift.gg</a>ã€‚</p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;ä½œè€…ï¼šTomasz Szulcï¼Œ&lt;a href=&quot;http://szulctomasz.com/programming-blog/2018/09/add-fireworks-and-sparks-to-a-uiview/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;åŸæ–‡é“¾æ¥&lt;/a&gt;ï¼ŒåŸæ–‡æ—¥æœŸï¼š2018-09&lt;br&gt;è¯‘è€…ï¼š&lt;a href=&quot;https://github.com/joeytat&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Joeytat&lt;/a&gt;ï¼›æ ¡å¯¹ï¼š&lt;a href=&quot;http://numbbbbb.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;numbbbbb&lt;/a&gt;ï¼Œ&lt;a href=&quot;https://github.com/WAMaker&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;WAMaker&lt;/a&gt;ï¼›å®šç¨¿ï¼š&lt;a href=&quot;undefined&quot;&gt;Pancf&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;!--æ­¤å¤„å¼€å§‹æ­£æ–‡--&gt;
    
    </summary>
    
      <category term="Tomasz Szulc" scheme="https://swift.gg/categories/Tomasz-Szulc/"/>
    
    
      <category term="Swift" scheme="https://swift.gg/tags/Swift/"/>
    
      <category term="æ•™ç¨‹" scheme="https://swift.gg/tags/%E6%95%99%E7%A8%8B/"/>
    
  </entry>
  
  <entry>
    <title>Bundles and Packages</title>
    <link href="https://swift.gg/2019/07/19/nshipster-bundles-and-packages/"/>
    <id>https://swift.gg/2019/07/19/nshipster-bundles-and-packages/</id>
    <published>2019-07-19T00:00:00.000Z</published>
    <updated>2019-08-14T12:15:53.984Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ä½œè€…ï¼šMatttï¼Œ<a href="https://nshipster.com/bundles-and-packages/" target="_blank" rel="noopener">åŸæ–‡é“¾æ¥</a>ï¼ŒåŸæ–‡æ—¥æœŸï¼š2018-12-17<br>è¯‘è€…ï¼š<a href="https://github.com/WAMaker" target="_blank" rel="noopener">WAMaker</a>ï¼›æ ¡å¯¹ï¼š<a href="http://numbbbbb.com/" target="_blank" rel="noopener">numbbbbb</a>ï¼Œ<a href="https://bignerdcoding.com/" target="_blank" rel="noopener">BigNerdCoding</a>ï¼›å®šç¨¿ï¼š<a href="http://forelax.space" target="_blank" rel="noopener">Forelax</a></p></blockquote><!--æ­¤å¤„å¼€å§‹æ­£æ–‡--><p>åœ¨è¿™ä¸ªç»™äºˆçš„å­£èŠ‚ï¼Œè®©æˆ‘ä»¬åœä¸‹è„šæ­¥ï¼Œæ€è€ƒä¸€ä¸ªç°ä»£è®¡ç®—æœºç³»ç»Ÿèµäºˆæˆ‘ä»¬çš„æœ€æ£’çš„ç¤¼ç‰©ï¼šæŠ½è±¡ã€‚</p><p>åœ¨æ•°ç™¾ä¸‡ CPU æ™¶ä½“ç®¡ã€SSD æ‰‡åŒºå’Œ LCD åƒç´ å…±åŒåä½œä¸‹ï¼Œå…¨çƒæ•°åäº¿äººèƒ½å¤Ÿæ—¥å¸¸ä½¿ç”¨è®¡ç®—æœºå’Œç§»åŠ¨è®¾å¤‡è€Œå¯¹æ­¤å…¨ç„¶ä¸çŸ¥ã€‚è¿™ä¸€åˆ‡éƒ½åº”å½’åŠŸäºåƒæ–‡ä»¶ï¼Œç›®å½•ï¼Œåº”ç”¨å’Œæ–‡æ¡£è¿™æ ·çš„æŠ½è±¡ã€‚</p><p>è¿™å‘¨çš„ NSHipsterï¼Œæˆ‘ä»¬å°†è®¨è®ºè‹¹æœå¹³å°ä¸Šä¸¤ä¸ªé‡è¦çš„æŠ½è±¡ï¼šåŒ…ä¸åŒ…è£¹ã€‚ğŸ</p><a id="more"></a><hr><p>å°½ç®¡æ˜¯ä¸åŒçš„æ¦‚å¿µï¼ŒåŒ…ä¸åŒ…è£¹è¿™ä¸¤ä¸ªæœ¯è¯­ç»å¸¸ä¼šè¢«æ›¿æ¢ä½¿ç”¨ã€‚æ¯«æ— ç–‘é—®ï¼Œé€ æˆå›°æƒ‘çš„éƒ¨åˆ†åŸå› å‡ºè‡ªå®ƒä»¬ç›¸ä¼¼çš„åç§°ï¼Œä½†æˆ–è®¸ä¸»è¦åŸå› æ˜¯è®¸å¤šåŒ…æ°å¥½ä¹Ÿæ˜¯åŒ…è£¹ï¼ˆåä¹‹äº¦ç„¶ï¼‰ã€‚</p><p>åœ¨æˆ‘ä»¬æ·±å…¥ä¹‹å‰ï¼Œå…ˆå®šä¹‰ä¸€ä¸‹è¿™ä¸¤ä¸ªæœ¯è¯­ï¼š</p><ul><li>åŒ…æ˜¯æŒ‡å…·æœ‰å·²çŸ¥ç»“æ„çš„ï¼ŒåŒ…å«å¯æ‰§è¡Œä»£ç ï¼Œä»¥åŠä»£ç æ‰€éœ€çš„èµ„æºçš„ç›®å½•ã€‚</li><li>åŒ…è£¹æ˜¯æŒ‡åœ¨è®¿è¾¾ä¸­çœ‹èµ·æ¥åƒæ˜¯æ–‡ä»¶çš„ç›®å½•ã€‚</li></ul><p>ä¸‹å›¾å±•ç¤ºäº†åŒ…ä¸åŒ…è£¹ä¹‹é—´çš„å…³ç³»ï¼Œå°†åº”ç”¨ã€æ¡†æ¶åŒ…ã€æ’ä»¶åŒ…å’Œæ–‡æ¡£åˆ†åˆ«æ”¾å…¥ä¸€ä¸ªæˆ–å¤šä¸ªåˆ†ç±»ä¹‹ä¸­ï¼š<br><img src="https://nshipster.com/assets/packages-and-bundles-diagram-a604d818c7decc7430fffc8642f0743728d2f6be4dfae15b274a599655cd3e40.svg" alt="diagram"></p><blockquote><p>å¦‚æœå¯¹ä¸¤è€…çš„åŒºåˆ«ä½ ä¾ç„¶æ„Ÿåˆ°å›°æƒ‘ï¼Œè¿™ä¸ªç±»æ¯”æˆ–è®¸èƒ½å¸®åŠ©ä½ ç†è§£ï¼š<br>æŠŠåŒ…è£¹æƒ³è±¡æˆæ˜¯ä¸€ä¸ªå†…å®¹è¢«éšè—çš„ç›’å­ï¼ˆğŸ“¦ï¼‰ï¼Œä½œä¸ºä¸€ä¸ªç‹¬ç«‹çš„å®ä½“è€Œå­˜åœ¨ã€‚è¿™ç‚¹ä¸åŒ…ä¸åŒï¼ŒåŒ…æ›´åƒæ˜¯ä¸€ä¸ªèƒŒåŒ…ï¼ˆğŸ’ï¼‰ â€”â€” æ¯ä¸€æ¬¾éƒ½æœ‰ç‰¹æ®Šçš„å£è¢‹å’Œéš”å±‚ç”¨æ¥æºå¸¦ä½ éœ€è¦çš„ä¸œè¥¿ï¼Œä¸åŒçš„é…ç½®ç”¨ä»¥å†³å®šæ˜¯å¸¦å»å­¦æ ¡ï¼Œå»å·¥ä½œï¼Œè¿˜æ˜¯å»å¥èº«æˆ¿ã€‚å¦‚æœæŸæ ·ä¸œè¥¿æ—¢æ˜¯åŒ…ä¹Ÿæ˜¯åŒ…è£¹ï¼Œæ°ä¼¼è¡Œæï¼ˆğŸ§³ï¼‰ä¸€èˆ¬ï¼šåƒç›’å­ä¸€æ ·æµ‘ç„¶ä¸€ä½“ï¼ŒåƒèƒŒåŒ…ä¸€æ ·åˆ†éš”è‡ªå¦‚ã€‚</p></blockquote><h2 id="åŒ…ï¼ˆBundlesï¼‰"><a href="#åŒ…ï¼ˆBundlesï¼‰" class="headerlink" title="åŒ…ï¼ˆBundlesï¼‰"></a>åŒ…ï¼ˆBundlesï¼‰</h2><p>åŒ…ä¸ºä»£ç å’Œèµ„æºçš„ç»„ç»‡æä¾›äº†ç‰¹å®šç»“æ„ï¼Œæ„åœ¨<strong>æå‡å¼€å‘è€…çš„ä½“éªŒ</strong>ã€‚è¿™ä¸ªç»“æ„ä¸ä»…å…è®¸é¢„æµ‹æ€§çš„åŠ è½½ä»£ç å’Œèµ„æºï¼ŒåŒæ—¶ä¹Ÿæ”¯æŒç±»ä¼¼äºæœ¬åœ°åŒ–è¿™æ ·çš„ç³»ç»Ÿæ€§ç‰¹æ€§ã€‚</p><p>åŒ…åˆ†å±äºä»¥ä¸‹ä¸‰ä¸ªç±»åˆ«ï¼Œæ¯ä¸€ç§éƒ½æœ‰å®ƒè‡ªå·±ç‰¹æ®Šçš„ç»“æ„å’Œè¦æ±‚ï¼š</p><ul><li><strong>åº”ç”¨åŒ…ï¼ˆApp Bundlesï¼‰</strong>ï¼šåŒ…å«ä¸€ä¸ªèƒ½è¢«å¯åŠ¨çš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œä¸€ä¸ªæè¿°å¯æ‰§è¡Œæ–‡ä»¶çš„ <code>Info.plist</code> æ–‡ä»¶ï¼Œåº”ç”¨å›¾æ ‡ï¼Œå¯åŠ¨å›¾ç‰‡ï¼Œèƒ½è¢«å¯æ‰§è¡Œæ–‡ä»¶è°ƒç”¨çš„æ¥å£æ–‡ä»¶ï¼Œå­—ç¬¦ä¸²æ–‡ä»¶ï¼Œä»¥åŠæ•°æ®æ–‡ä»¶ã€‚</li><li><strong>æ¡†æ¶åŒ…ï¼ˆFramework Bundlesï¼‰</strong>ï¼šåŒ…å«åŠ¨æ€åˆ†äº«åº“æ‰€éœ€è¦çš„ä»£ç å’Œèµ„æºã€‚</li><li><strong>å¯åŠ è½½åŒ…ï¼ˆLoadable Bundlesï¼‰</strong>ï¼šç±»ä¼¼äºæ’ä»¶ï¼ŒåŒ…å«æ‰©å±•åº”ç”¨åŠŸèƒ½çš„å¯æ‰§è¡Œä»£ç å’Œèµ„æºã€‚</li></ul><h3 id="è®¿é—®åŒ…å†…å®¹"><a href="#è®¿é—®åŒ…å†…å®¹" class="headerlink" title="è®¿é—®åŒ…å†…å®¹"></a>è®¿é—®åŒ…å†…å®¹</h3><p>å¯¹äºåº”ç”¨ï¼Œplaygroundsï¼Œä»¥åŠå…¶å®ƒä½ æ„Ÿå…´è¶£çš„åŒ…æ¥è¯´ï¼Œéƒ½èƒ½é€šè¿‡ <code>Bundle.main</code> è¿›è¡Œè®¿é—®ã€‚å¤§å¤šæ•°æƒ…å†µï¼Œå¯ä»¥ä½¿ç”¨ <code>url(forResource:withExtension:)</code>ï¼ˆæˆ–å®ƒçš„ä¸€ç§å˜ä½“ï¼‰æ¥è·å–ç‰¹å®šèµ„æºçš„è·¯å¾„ã€‚</p><p>ä¸¾ä¾‹æ¥è¯´ï¼Œå¦‚æœåº”ç”¨ä¸­åŒ…å«äº†ä¸€ä¸ªåå« <code>Photo.jpg</code> çš„æ–‡ä»¶ï¼Œç”¨ä¸‹é¢çš„æ–¹æ³•èƒ½è·å¾—è®¿é—®å®ƒçš„ URLï¼š<br><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="type">Bundle</span>.main.url(forResource: <span class="string">"Photo"</span>, withExtension: <span class="string">"jpg"</span>)</span><br></pre></td></tr></table></figure></p><blockquote><p>å¦‚æœä½¿ç”¨ Asset Catalogï¼Œä½ å¯ä»¥ä»åª’ä½“åº“ï¼ˆ<kbd>â‡§</kbd><kbd>âŒ˜</kbd><kbd>M</kbd>ï¼‰æ‹–æ‹½åˆ°ç¼–è¾‘å™¨æ¥åˆ›å»ºå›¾åƒã€‚</p></blockquote><p>é™¤æ­¤ä¹‹å¤–ï¼Œ<code>Bundle</code> æä¾›äº†ä¸€äº›å®ä¾‹æ–¹æ³•å’Œå˜é‡æ¥è·å–æ ‡å‡†åŒ…å†…å®¹çš„ä½ç½®ï¼Œè¿”å› URL æˆ– String ç±»å‹çš„è·¯å¾„ï¼š</p><table><thead><tr><th>URL</th><th>Path</th><th>æè¿°</th></tr></thead><tbody><tr><td>executableURL</td><td>executablePath</td><td>å¯æ‰§è¡Œæ–‡ä»¶</td></tr><tr><td>url(forAuxiliaryExecutable:)</td><td>path(forAuxiliaryExecutable:)</td><td>è¾…åŠ©çš„å¯æ‰§è¡Œæ–‡ä»¶</td></tr><tr><td>resourceURL</td><td>resourcePath</td><td>åŒ…å«èµ„æºçš„å­ç›®å½•</td></tr><tr><td>sharedFrameworksURL</td><td>sharedFrameworksPath</td><td>åŒ…å«å…±äº«æ¡†æ¶çš„å­ç›®å½•</td></tr><tr><td>privateFrameworksURL</td><td>privateFrameworksPath</td><td>åŒ…å«ç§æœ‰æ¡†æ¶çš„å­ç›®å½•</td></tr><tr><td>builtInPlugInsURL</td><td>builtInPlugInsPath</td><td>åŒ…å«æ’ä»¶çš„å­ç›®å½•</td></tr><tr><td>sharedSupportURL</td><td>sharedSupportPath</td><td>åŒ…å«å…±äº«æ”¯æ´æ–‡ä»¶çš„å­ç›®å½•</td></tr><tr><td>appStoreReceiptURL</td><td></td><td>App Store çš„æ”¶æ®</td></tr></tbody></table><h3 id="è·å–åº”ç”¨ä¿¡æ¯"><a href="#è·å–åº”ç”¨ä¿¡æ¯" class="headerlink" title="è·å–åº”ç”¨ä¿¡æ¯"></a>è·å–åº”ç”¨ä¿¡æ¯</h3><p>æ‰€æœ‰çš„åº”ç”¨åŒ…éƒ½å¿…é¡»æœ‰ä¸€ä¸ªåŒ…å«åº”ç”¨ä¿¡æ¯çš„ <code>Info.plist</code> æ–‡ä»¶ã€‚</p><p><code>bundleURL</code> å’Œ <code>bundleIdentifier</code> è¿™æ ·çš„åŸæ•°æ®èƒ½å¤Ÿé€šè¿‡ bundle å®ä¾‹è¢«ç›´æ¥è®¿é—®ã€‚<br><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Foundation</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> bundle = <span class="type">Bundle</span>.main</span><br><span class="line"></span><br><span class="line">bundle.bundleURL        <span class="comment">// "/path/to/Example.app"</span></span><br><span class="line">bundle.bundleIdentifier <span class="comment">// "com.nshipster.example"</span></span><br></pre></td></tr></table></figure></p><p>é€šè¿‡ä¸‹æ ‡èƒ½ä» <code>infoDictionary</code> å˜é‡è·å¾—å…¶ä»–ä¿¡æ¯ï¼ˆå¦‚æœä¿¡æ¯è¦å±•ç¤ºç»™ç”¨æˆ·ï¼Œè¯·ä½¿ç”¨ <code>localizedInfoDictionary</code>ï¼‰ã€‚<br><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">bundle.infoDictionary[<span class="string">"CFBundleName"</span>] <span class="comment">// "Example"</span></span><br><span class="line">bundle.localizedInfoDictionary[<span class="string">"CFBundleName"</span>] <span class="comment">// "Esempio" (`it_IT` locale)</span></span><br></pre></td></tr></table></figure></p><h3 id="è·å–æœ¬åœ°åŒ–å­—ç¬¦ä¸²"><a href="#è·å–æœ¬åœ°åŒ–å­—ç¬¦ä¸²" class="headerlink" title="è·å–æœ¬åœ°åŒ–å­—ç¬¦ä¸²"></a>è·å–æœ¬åœ°åŒ–å­—ç¬¦ä¸²</h3><p>åŒ…çš„å­˜åœ¨è®©æœ¬åœ°åŒ–å˜å¾—å®¹æ˜“ã€‚å¼ºåˆ¶æœ¬åœ°åŒ–èµ„æºçš„å­˜æ”¾ä½ç½®åï¼Œç³»ç»Ÿä¾¿èƒ½å°†åŠ è½½å“ªä¸ªç‰ˆæœ¬çš„æ–‡ä»¶çš„é€»è¾‘ä»å¼€å‘è€…å±‚é¢æŠ½è±¡å‡ºæ¥ã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼ŒåŒ…è´Ÿè´£åŠ è½½åº”ç”¨çš„æœ¬åœ°åŒ–å­—ç¬¦ä¸²ã€‚ä½¿ç”¨ <code>localizedString(forKey:value:table:)</code> æ–¹æ³•å°±å¯ä»¥è·å–åˆ°è¿™äº›å€¼ã€‚<br><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Foundation</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> bundle = <span class="type">Bundle</span>.main</span><br><span class="line">bundle.localizedString(forKey: <span class="string">"Hello, %@"</span>,</span><br><span class="line">                       value: <span class="string">"Hello, $&#123;username&#125;"</span>,</span><br><span class="line">                       table: <span class="literal">nil</span>)</span><br></pre></td></tr></table></figure></p><p>ç„¶è€Œï¼Œé€šå¸¸æ¥è¯´ç”¨ <code>NSLocalizedString</code> ä¼šæ›´å¥½ï¼Œåƒ <code>genstrings</code> è¿™æ ·çš„å·¥å…·èƒ½å¤Ÿè‡ªåŠ¨å–å‡ºé”®å’Œæ³¨é‡Šåˆ° <code>.strings</code> æ–‡ä»¶ä¸­ä¾¿äºç¿»è¯‘ã€‚<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">// Terminal</span><br><span class="line">$ find . \( -name &quot;*.swift&quot; !           \ # æ‰¾å‡ºæ‰€æœ‰ swift æ–‡ä»¶</span><br><span class="line">            ! -path &quot;./Carthage/*&quot;      \ # æ— è§† Carthage ä¸ CocoaPods çš„ä¾èµ–</span><br><span class="line">            ! -path &quot;./Pods/*&quot;</span><br><span class="line">         \)    |                        \</span><br><span class="line">  tr &apos;\n&apos; &apos;\0&apos; |                        \ # æ›¿æ¢åˆ†éš”ç¬¦</span><br><span class="line">  xargs -0 genstrings -o .              \ # å¤„ç†å¸¦ç©ºæ ¼çš„è·¯å¾„</span><br></pre></td></tr></table></figure></p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="type">NSLocalizedString</span>(<span class="string">"Hello, %@"</span>, comment: <span class="string">"Hello, $&#123;username&#125;"</span>)</span><br></pre></td></tr></table></figure><h2 id="åŒ…è£¹ï¼ˆPackagesï¼‰"><a href="#åŒ…è£¹ï¼ˆPackagesï¼‰" class="headerlink" title="åŒ…è£¹ï¼ˆPackagesï¼‰"></a>åŒ…è£¹ï¼ˆPackagesï¼‰</h2><p>åŒ…è£¹æŠŠç›¸å…³èµ„æºå°è£…å’ŒåŠ å›ºæˆä¸€ä¸ªç‹¬ç«‹å•å…ƒï¼Œæ„åœ¨<strong>æå‡ç”¨æˆ·ä½“éªŒ</strong>ã€‚</p><p>æ»¡è¶³ä»¥ä¸‹ä»»æ„ä¸€ä¸ªæ¡ä»¶ï¼Œç›®å½•å°±ä¼šè¢«è®¿è¾¾è®¤ä¸ºæ˜¯åŒ…è£¹ï¼š</p><ul><li>ç›®å½•æœ‰ç±»ä¼¼äº <code>.app</code>ï¼Œ<code>.playground</code> æˆ– <code>.plugin</code> ç­‰ç‰¹æ®Šæ‰©å±•ã€‚</li><li>ç›®å½•æœ‰ä¸€ä¸ªè¢«ä¸€ä¸ªåº”ç”¨æ³¨å†Œä½œä¸ºæ–‡æ¡£ç±»å‹çš„æ‰©å±•ã€‚</li><li>ç›®å½•å…·æœ‰æœ‰æ‰©å±•å±æ€§ï¼Œå°†å…¶æŒ‡å®šä¸ºåŒ…è£¹ã€‚</li></ul><h3 id="è®¿é—®åŒ…è£¹ä¸­çš„å†…å®¹"><a href="#è®¿é—®åŒ…è£¹ä¸­çš„å†…å®¹" class="headerlink" title="è®¿é—®åŒ…è£¹ä¸­çš„å†…å®¹"></a>è®¿é—®åŒ…è£¹ä¸­çš„å†…å®¹</h3><p>åœ¨è®¿è¾¾ä¸­ï¼Œå³é”®å±•ç¤ºé€‰ä¸­é¡¹ç›®çš„å¯æ“ä½œç›®å½•ã€‚å¦‚æœé€‰ä¸­é¡¹ç›®æ˜¯åŒ…è£¹ï¼Œâ€œæ‰“å¼€â€æ“ä½œä¸‹ä¼šå‡ºç°â€œæ˜¾ç¤ºåŒ…å†…å®¹â€é€‰é¡¹ã€‚<br><img src="https://nshipster.com/assets/show-package-contents-c7cc72f58a573cb2fbe349e6f76a4ef29d14fbada3cd9b8376fc37979da16bf3.png" alt></p><p>ç‚¹å‡»è¿™ä¸ªé€‰é¡¹ä¼šä»åŒ…è£¹ç›®å½•æ‰“å¼€ä¸€ä¸ªæ–°çš„è®¿è¾¾çª—å£ã€‚</p><p>å½“ç„¶ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ä»£ç è®¿é—®åŒ…è£¹ä¸­çš„å†…å®¹ã€‚åŒ…è£¹çš„ç±»å‹å†³å®šäº†è·å–å†…å®¹çš„æœ€ä½³æ–¹å¼ï¼š</p><ul><li>å¦‚æœåŒ…è£¹æœ‰åŒ…çš„ç»“æ„ï¼Œå‰æ–‡æ‰€è¯´çš„ <code>Bundle</code> å°±èƒ½è½»æ¾èƒœä»»ã€‚</li><li>å¦‚æœåŒ…è£¹æ˜¯ä¸€ä¸ªæ–‡æ¡£ï¼Œåœ¨ macOS ä¸Šä½¿ç”¨ <code>NSDocument</code> æˆ–åœ¨ iOS ä¸Šä½¿ç”¨ <code>UIDocument</code> æ¥è®¿é—®ã€‚</li><li>å…¶ä»–æƒ…å†µä¸‹ï¼Œç”¨ <code>FileWrapper</code> å¯¼èˆªç›®å½•ï¼Œæ–‡ä»¶å’Œç¬¦å·é“¾æ¥ï¼Œç”¨ <code>FileHandler</code> æ¥è¯»å†™æ–‡ä»¶æè¿°ã€‚</li></ul><h3 id="åˆ¤æ–­ä¸€ä¸ªç›®å½•æ˜¯å¦æ˜¯åŒ…è£¹"><a href="#åˆ¤æ–­ä¸€ä¸ªç›®å½•æ˜¯å¦æ˜¯åŒ…è£¹" class="headerlink" title="åˆ¤æ–­ä¸€ä¸ªç›®å½•æ˜¯å¦æ˜¯åŒ…è£¹"></a>åˆ¤æ–­ä¸€ä¸ªç›®å½•æ˜¯å¦æ˜¯åŒ…è£¹</h3><p>è™½è¯´æ˜¯ç”±è®¿è¾¾å†³å®šå¦‚ä½•å±•ç¤ºæ–‡ä»¶å’Œç›®å½•ï¼Œå¤§å¤šæ•°çš„åˆ¤æ–­ä¼šè¢«ä»£ç†ç»™æ“ä½œç³»ç»Ÿä»¥åŠç®¡ç†ç»Ÿä¸€ç±»å‹æ ‡è¯†ï¼ˆUTIï¼‰çš„æœåŠ¡ã€‚</p><p>å¦‚æœæƒ³è¦ç¡®å®šä¸€ä¸ªæ–‡ä»¶æ‰©å±•æ˜¯ä¸€ä¸ªå†…ç½®ç³»ç»ŸåŒ…è£¹ç±»å‹ï¼Œè¿˜æ˜¯ä¸€ä¸ªè¢«å·²å®‰è£…çš„åº”ç”¨ä½¿ç”¨çš„æ–‡æ¡£ç±»å‹ï¼Œè°ƒç”¨ Core Services æ–¹æ³• <code>UTTypeCreatePreferredIdentifierForTag(_:_:_:)</code> ä¸ <code>UTTypeConformsTo(_:_:)</code> èƒ½æ»¡è¶³ä½ çš„éœ€æ±‚ï¼š<br><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Foundation</span><br><span class="line"><span class="keyword">import</span> CoreServices</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">directoryIsPackage</span><span class="params">(<span class="number">_</span> url: URL)</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> filenameExtension: <span class="type">CFString</span> = url.pathExtension <span class="keyword">as</span> <span class="type">NSString</span></span><br><span class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> uti = <span class="type">UTTypeCreatePreferredIdentifierForTag</span>(</span><br><span class="line">                        kUTTagClassFilenameExtension,</span><br><span class="line">                        filenameExtension, <span class="literal">nil</span></span><br><span class="line">                    )?.takeRetainedValue()</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="type">UTTypeConformsTo</span>(uti, kUTTypePackage)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> xcode = <span class="type">URL</span>(fileURLWithPath: <span class="string">"/Applications/Xcode.app"</span>)</span><br><span class="line">directoryIsPackage(xcode) <span class="comment">// true</span></span><br></pre></td></tr></table></figure></p><blockquote><p>æˆ‘ä»¬æ‰¾ä¸åˆ°ä»»ä½•æè¿°å¦‚ä½•è®¾ç½®æ‰€è°“çš„åŒ…è£¹æ¯”ç‰¹ï¼ˆpackage bitï¼‰çš„æ–‡æ¡£ï¼Œä½†æ ¹æ® <a href="https://opensource.apple.com/source/CarbonHeaders/CarbonHeaders-8A428/Finder.h" target="_blank" rel="noopener">CarbonCore/Finder.h</a>ï¼Œåœ¨ <code>com.apple.FindlerInfo</code> æ‰©å±•å‚æ•°ä¸­è®¾ç½® <code>kHasBundleï¼ˆ0x2000ï¼‰</code> æ ‡ç¤ºèƒ½å¤Ÿå®ç°ï¼š<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt; $ xattr -wx com.apple.FinderInfo /path/to/package \</span><br><span class="line">&gt;  00 00 00 00 00 00 00 00 20 00 00 00 00 00 00 00 \</span><br><span class="line">&gt;  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure></p></blockquote><hr><p>æ­£å¦‚æˆ‘ä»¬çœ‹åˆ°çš„é‚£æ ·ï¼Œå¹¶éåªæœ‰ç»ˆç«¯ç”¨æˆ·ä»æŠ½è±¡ä¸­è·ç›Š â€”â€” æ— è®ºæ˜¯åƒ Swift è¿™æ ·çš„é«˜çº§ç¼–ç¨‹è¯­è¨€çš„å®‰å…¨æ€§å’Œè¡¨ç°åŠ›ï¼Œè¿˜æ˜¯åƒ Foundation è¿™æ ·çš„ API çš„ä¾¿åˆ©æ€§ï¼Œä½œä¸ºå¼€å‘è€…ä¹Ÿå¯ä»¥åˆ©ç”¨æŠ½è±¡å¼€å‘å‡ºä¼˜ç§€çš„è½¯ä»¶ã€‚</p><p>æˆ–è®¸æˆ‘ä»¬ä¼šæŠ±æ€¨ <a href="https://en.wikipedia.org/wiki/Leaky_abstraction" target="_blank" rel="noopener">æŠ½è±¡æ³„æ¼</a> ä¸ <a href="https://en.wikipedia.org/wiki/Abstraction_inversion" target="_blank" rel="noopener">æŠ½è±¡åè½¬</a> å¸¦æ¥çš„é—®é¢˜ï¼Œä½†é‡è¦çš„æ˜¯é€€ä¸€æ­¥ï¼Œäº†è§£æˆ‘ä»¬æ¯å¤©å¤„ç†å¤šå°‘æœ‰ç”¨çš„æŠ½è±¡ï¼Œä»¥åŠå®ƒä»¬å¸¦ç»™äº†æˆ‘ä»¬å¤šå°‘å¯èƒ½æ€§ã€‚</p><blockquote><p>æœ¬æ–‡ç”± SwiftGG ç¿»è¯‘ç»„ç¿»è¯‘ï¼Œå·²ç»è·å¾—ä½œè€…ç¿»è¯‘æˆæƒï¼Œæœ€æ–°æ–‡ç« è¯·è®¿é—® <a href="http://swift.gg">http://swift.gg</a>ã€‚</p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;ä½œè€…ï¼šMatttï¼Œ&lt;a href=&quot;https://nshipster.com/bundles-and-packages/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;åŸæ–‡é“¾æ¥&lt;/a&gt;ï¼ŒåŸæ–‡æ—¥æœŸï¼š2018-12-17&lt;br&gt;è¯‘è€…ï¼š&lt;a href=&quot;https://github.com/WAMaker&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;WAMaker&lt;/a&gt;ï¼›æ ¡å¯¹ï¼š&lt;a href=&quot;http://numbbbbb.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;numbbbbb&lt;/a&gt;ï¼Œ&lt;a href=&quot;https://bignerdcoding.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;BigNerdCoding&lt;/a&gt;ï¼›å®šç¨¿ï¼š&lt;a href=&quot;http://forelax.space&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Forelax&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;!--æ­¤å¤„å¼€å§‹æ­£æ–‡--&gt;
&lt;p&gt;åœ¨è¿™ä¸ªç»™äºˆçš„å­£èŠ‚ï¼Œè®©æˆ‘ä»¬åœä¸‹è„šæ­¥ï¼Œæ€è€ƒä¸€ä¸ªç°ä»£è®¡ç®—æœºç³»ç»Ÿèµäºˆæˆ‘ä»¬çš„æœ€æ£’çš„ç¤¼ç‰©ï¼šæŠ½è±¡ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨æ•°ç™¾ä¸‡ CPU æ™¶ä½“ç®¡ã€SSD æ‰‡åŒºå’Œ LCD åƒç´ å…±åŒåä½œä¸‹ï¼Œå…¨çƒæ•°åäº¿äººèƒ½å¤Ÿæ—¥å¸¸ä½¿ç”¨è®¡ç®—æœºå’Œç§»åŠ¨è®¾å¤‡è€Œå¯¹æ­¤å…¨ç„¶ä¸çŸ¥ã€‚è¿™ä¸€åˆ‡éƒ½åº”å½’åŠŸäºåƒæ–‡ä»¶ï¼Œç›®å½•ï¼Œåº”ç”¨å’Œæ–‡æ¡£è¿™æ ·çš„æŠ½è±¡ã€‚&lt;/p&gt;
&lt;p&gt;è¿™å‘¨çš„ NSHipsterï¼Œæˆ‘ä»¬å°†è®¨è®ºè‹¹æœå¹³å°ä¸Šä¸¤ä¸ªé‡è¦çš„æŠ½è±¡ï¼šåŒ…ä¸åŒ…è£¹ã€‚ğŸ&lt;/p&gt;
    
    </summary>
    
      <category term="Swift" scheme="https://swift.gg/categories/Swift/"/>
    
      <category term="NSHipster" scheme="https://swift.gg/categories/Swift/NSHipster/"/>
    
    
      <category term="Swift" scheme="https://swift.gg/tags/Swift/"/>
    
      <category term="NSHipster" scheme="https://swift.gg/tags/NSHipster/"/>
    
  </entry>
  
  <entry>
    <title>Swift ä¸­çš„é›†åˆï¼ˆSetï¼‰</title>
    <link href="https://swift.gg/2019/07/09/Sets-in-Swift/"/>
    <id>https://swift.gg/2019/07/09/Sets-in-Swift/</id>
    <published>2019-07-09T00:00:00.000Z</published>
    <updated>2019-08-14T12:15:53.984Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ä½œè€…ï¼šThomas Hanningï¼Œ<a href="http://www.thomashanning.com/sets-in-swift/" target="_blank" rel="noopener">åŸæ–‡é“¾æ¥</a>ï¼ŒåŸæ–‡æ—¥æœŸï¼š2018-09-06<br>è¯‘è€…ï¼š<a href="https://github.com/rsenjoyer" target="_blank" rel="noopener">rsenjoyer</a>ï¼›æ ¡å¯¹ï¼š<a href="http://numbbbbb.com/" target="_blank" rel="noopener">numbbbbb</a>ï¼Œ<a href="http://www.jianshu.com/users/596f2ba91ce9/latest_articles" target="_blank" rel="noopener">pmst</a>ï¼›å®šç¨¿ï¼š<a href="http://forelax.space" target="_blank" rel="noopener">Forelax</a></p></blockquote><!--æ­¤å¤„å¼€å§‹æ­£æ–‡--><p>é›†åˆï¼ˆSetï¼‰æ˜¯ Swift é›†åˆç±»å‹ï¼ˆcollection typesï¼‰ä¹‹ä¸€ï¼Œé›†åˆç”¨æ¥å­˜å‚¨ç±»å‹ç›¸åŒä¸”æ²¡æœ‰ç¡®å®šé¡ºåºå”¯ä¸€çš„å€¼ã€‚ä½ å¯ä»¥å°†é›†åˆæƒ³è±¡æˆä¸€ç›’å°çƒï¼šå®ƒä»¬åœ¨é¢œè‰²å’Œæ•°é‡ä¸Šç‹¬ä¸€æ— äºŒï¼Œä½†åœ¨ç›’å†…æ˜¯æ— åºçš„ã€‚</p><p><img src="http://s12572.pcdn.co/wp-content/uploads/2018/11/billiard.jpg" alt></p><a id="more"></a><p><em>æç¤ºï¼šè¿™ç¯‡æ–‡ç« ä½¿ç”¨çš„æ˜¯ Swift 4 å’Œ Xcode 10</em></p><h2 id="åˆ›å»ºé›†åˆ"><a href="#åˆ›å»ºé›†åˆ" class="headerlink" title="åˆ›å»ºé›†åˆ"></a>åˆ›å»ºé›†åˆ</h2><p>åˆ›å»ºä¸€ä¸ªé›†åˆéå¸¸ç®€å•ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> setA: <span class="type">Set</span>&lt;<span class="type">String</span>&gt; = [<span class="string">"a"</span>,<span class="string">"b"</span>,<span class="string">"c"</span>]</span><br></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œåˆ›å»ºä¸€ä¸ª <code>String</code> ç±»å‹çš„é›†åˆï¼Œå‘½åä¸º <code>setA</code>ã€‚å®ƒå­˜å‚¨ç€ <code>a</code>ã€<code>b</code>ã€<code>c</code> ä¸‰ä¸ªå€¼ã€‚ä¸æ•°ç»„ç›¸æ¯”ï¼Œé›†åˆå†…å…ƒç´ æ˜¯æ— åºçš„ã€‚é€šè¿‡ç¼–è¯‘å™¨çš„ç±»å‹æ¨å¯¼åŠŸèƒ½ï¼Œä½ ä¹Ÿå¯ä»¥åƒå¦‚ä¸‹æ–¹å¼åˆ›å»ºé›†åˆï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> setB: <span class="type">Set</span> = [<span class="string">"a"</span>,<span class="string">"b"</span>,<span class="string">"c"</span>]</span><br></pre></td></tr></table></figure><p>åŒæ ·ä¹Ÿå¯ä»¥ä½¿ç”¨é›†åˆçš„æ„é€ å™¨ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> setC = <span class="type">Set</span>([<span class="string">"a"</span>,<span class="string">"b"</span>,<span class="string">"c"</span>])</span><br></pre></td></tr></table></figure><p>è·Ÿæ•°ç»„ä¸€æ ·ï¼Œå¦‚æœä½¿ç”¨ <code>let</code> æ¥å®šä¹‰ä¸€ä¸ªé›†åˆï¼Œå®ƒå°±æ˜¯ä¸å¯å˜çš„ã€‚ä½¿ç”¨ <code>var</code>å®šä¹‰çš„æ˜¯ä¸€ä¸ªå¯å˜é›†åˆã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> setD = <span class="type">Set</span>([<span class="string">"a"</span>,<span class="string">"b"</span>])</span><br></pre></td></tr></table></figure><p>ç¨åæˆ‘ä»¬å°†äº†è§£æ›´å¤šæœ‰å…³å¯å˜é›†åˆçš„ä¿¡æ¯ã€‚</p><h2 id="è®¿é—®é›†åˆä¸­çš„å…ƒç´ "><a href="#è®¿é—®é›†åˆä¸­çš„å…ƒç´ " class="headerlink" title="è®¿é—®é›†åˆä¸­çš„å…ƒç´ "></a>è®¿é—®é›†åˆä¸­çš„å…ƒç´ </h2><p>ä½ å¯ä»¥ä½¿ç”¨å¾ªç¯æ¥è®¿é—®é›†åˆä¸­çš„å…ƒç´ ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> value <span class="keyword">in</span> setA &#123;</span><br><span class="line">     <span class="built_in">print</span>(value)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼šæ¯æ¬¡è¿è¡Œä»£ç æ—¶ï¼Œå¾ªç¯ä¸­å€¼çš„é¡ºåºå¯èƒ½ä¸åŒã€‚ä»è¡¨é¢æ¥çœ‹ï¼Œå®ƒä»¬åƒæ˜¯éšæœºè¿”å›ä¸€æ ·ã€‚</p><h2 id="é›†åˆåˆ†æ"><a href="#é›†åˆåˆ†æ" class="headerlink" title="é›†åˆåˆ†æ"></a>é›†åˆåˆ†æ</h2><p>é¦–å…ˆï¼Œä½ å¯ä»¥æ£€æŸ¥é›†åˆæ˜¯å¦ä¸ºç©ºï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="built_in">print</span>(setA.isEmpty)</span><br></pre></td></tr></table></figure><p>ä¹Ÿå¯ä»¥è·å–é›†åˆä¸­å…ƒç´ çš„ä¸ªæ•°ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="built_in">print</span>(setA.<span class="built_in">count</span>)</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„æ“ä½œå¯¹æ•°ç»„åŒæ ·æœ‰æ•ˆï¼Œå¯¹é›†åˆè€Œè¨€ï¼Œæ›´åŠ æ™®éçš„é—®é¢˜æ˜¯åˆ¤æ–­é›†åˆä¸­æ˜¯å¦åŒ…å«æŸä¸ªå…ƒç´ ã€‚ä¸ºæ­¤ï¼Œä½ å¯ä»¥ä½¿ç”¨ <code>contains</code> æ–¹æ³•ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="built_in">print</span>(setA.<span class="built_in">contains</span>(<span class="string">"a"</span>))</span><br></pre></td></tr></table></figure><h2 id="ä»é›†åˆä¸­æ·»åŠ å’Œåˆ é™¤å…ƒç´ "><a href="#ä»é›†åˆä¸­æ·»åŠ å’Œåˆ é™¤å…ƒç´ " class="headerlink" title="ä»é›†åˆä¸­æ·»åŠ å’Œåˆ é™¤å…ƒç´ "></a>ä»é›†åˆä¸­æ·»åŠ å’Œåˆ é™¤å…ƒç´ </h2><p>ä½ å¯ä»¥å‘å¯å˜é›†åˆé‡Œé¢æ·»åŠ å’Œåˆ é™¤å…ƒç´ :</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">setD.insert(<span class="string">"c"</span>)</span><br><span class="line">setD.remove(<span class="string">"a"</span>)</span><br></pre></td></tr></table></figure><p>ç”±äºé›†åˆå…ƒç´ çš„å”¯ä¸€æ€§ï¼Œå› æ­¤åªèƒ½å°†åŒä¸€ä¸ªå…ƒç´ æ·»åŠ åˆ°é›†åˆä¸­ä¸€æ¬¡ã€‚å¯ä»¥å¤šæ¬¡ä½¿ç”¨ç›¸åŒçš„å€¼è°ƒç”¨ <code>insert</code> æ–¹æ³•ï¼Œä½†é›†åˆä¸ä¼šæ”¹å˜ã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> setE: <span class="type">Set</span> = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>]</span><br><span class="line"> </span><br><span class="line">setE.insert(<span class="number">5</span>)</span><br><span class="line">setE.insert(<span class="number">5</span>)</span><br><span class="line">setE.insert(<span class="number">5</span>)</span><br><span class="line"> </span><br><span class="line"><span class="built_in">print</span>(setE) <span class="comment">//[4,5,1,2,3]</span></span><br></pre></td></tr></table></figure><p>å’Œå‰é¢æ‰€è¯´çš„ä¸€æ ·ï¼Œä¸Šé¢ä»£ç æ¯æ¬¡æ‰§è¡Œæ—¶è¾“å‡ºçš„é¡ºåºå¯èƒ½ä¸åŒï¼Œå› ä¸ºé›†åˆå…ƒç´ æ— åºã€‚</p><h2 id="é›†åˆæ¯”è¾ƒ"><a href="#é›†åˆæ¯”è¾ƒ" class="headerlink" title="é›†åˆæ¯”è¾ƒ"></a>é›†åˆæ¯”è¾ƒ</h2><p>é›†åˆé—´èƒ½è¿›è¡Œæ¯”è¾ƒã€‚æ˜¾ç„¶ï¼Œå¯ä»¥æ¯”è¾ƒä¸¤ä¸ªé›†åˆæ˜¯å¦ç›¸ç­‰ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> setA: = [â€œaâ€, â€œbâ€, â€œ<span class="built_in">c</span>â€]</span><br><span class="line"><span class="keyword">let</span> setB: = [â€œaâ€, â€œbâ€, â€œ<span class="built_in">c</span>â€]</span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> setA == setB &#123;</span><br><span class="line">     <span class="built_in">print</span>(â€œthe sets are <span class="built_in">equal</span>â€)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ç§æƒ…å†µä¸‹ï¼Œé›†åˆæ˜¯ç›¸ç­‰çš„ã€‚</p><p>æ¯”è¾ƒä¸¤ä¸ªé›†åˆçš„å¤§å°æ˜¯æ²¡æœ‰æ˜ç¡®çš„å®šä¹‰ï¼Œä½†å¯ä»¥æ£€æŸ¥ä¸€ä¸ªé›†åˆæ˜¯å¦æ˜¯å¦ä¸€ä¸ªé›†åˆçš„å­é›†ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> intSetA: <span class="type">Set</span> = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">0</span>]</span><br><span class="line"><span class="keyword">let</span> intSetB: <span class="type">Set</span> = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]</span><br><span class="line">intSetB.isSubset(of: intSetA) <span class="comment">//true</span></span><br></pre></td></tr></table></figure><p>ä¹Ÿå¯ä»¥æ£€æŸ¥é›†åˆæ˜¯å¦æ˜¯å¦ä¸€ä¸ªé›†åˆçš„çœŸå­é›†ã€‚è¿™ç§æƒ…å†µå°±æ˜¯è¯¥é›†åˆæ˜¯å¦ä¸€ä¸ªé›†åˆçš„å­é›†ä½†ä¸æƒ³ç­‰ã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> intSetA: <span class="type">Set</span> = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">0</span>]</span><br><span class="line"><span class="keyword">let</span> intSetB: <span class="type">Set</span> = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">0</span>]</span><br><span class="line"><span class="keyword">let</span> intSetC: <span class="type">Set</span> = [<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>]</span><br><span class="line"> </span><br><span class="line">intSetB.isSubset(of: intSetA) <span class="comment">//true</span></span><br><span class="line">intSetB.isStrictSubset(of: intSetA) <span class="comment">//false</span></span><br><span class="line">intSetC.isSubset(of: intSetA) <span class="comment">// true</span></span><br><span class="line">intSetC.isStrictSubset(of: intSetA) <span class="comment">//true</span></span><br></pre></td></tr></table></figure><p>ä¸ä¹‹ç›¸å¯¹çš„æ¦‚å¿µå°±æ˜¯è¶…é›†ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> intSetA: <span class="type">Set</span> = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">0</span>]</span><br><span class="line"><span class="keyword">let</span> intSetC: <span class="type">Set</span> = [<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>]</span><br><span class="line">intSetA.isSuperset(of: intSetC) <span class="comment">//true</span></span><br><span class="line">intSetA.isStrictSuperset(of: intSetC) <span class="comment">//true</span></span><br></pre></td></tr></table></figure><p>å¦‚æœä¸¤ä¸ªé›†åˆæ²¡æœ‰ç›¸åŒçš„å…ƒç´ ï¼Œé‚£ä¹ˆå°±è¯´è¿™ä¸¤ä¸ªé›†åˆä¸ç›¸äº¤</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> intSetA: <span class="type">Set</span> = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">0</span>]</span><br><span class="line"><span class="keyword">let</span> intSetC: <span class="type">Set</span> = [<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>]</span><br><span class="line"><span class="keyword">let</span> intSetD: <span class="type">Set</span> = [<span class="number">13</span>,<span class="number">14</span>,<span class="number">15</span>]</span><br><span class="line"> </span><br><span class="line">intSetA.isDisjoint(with: intSetC) <span class="comment">//false</span></span><br><span class="line">intSetA.isDisjoint(with: intSetD) <span class="comment">//true</span></span><br></pre></td></tr></table></figure><h2 id="é›†åˆç»“åˆ"><a href="#é›†åˆç»“åˆ" class="headerlink" title="é›†åˆç»“åˆ"></a>é›†åˆç»“åˆ</h2><p>ä½ å¯ä»¥å°†ä¸¤ä¸ªé›†åˆåˆå¹¶æˆä¸ºä¸€ä¸ªæ–°é›†åˆï¼Œæ–°çš„é›†åˆä¸­åŒ…å«ä¸¤ä¸ªé›†åˆä¸­æ‰€æœ‰çš„å…ƒç´ ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> stringSetA: <span class="type">Set</span> = [<span class="string">"a"</span>,<span class="string">"b"</span>,<span class="string">"c"</span>]</span><br><span class="line"><span class="keyword">let</span> stringSetB: <span class="type">Set</span> = [<span class="string">"c"</span>,<span class="string">"d"</span>,<span class="string">"e"</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> unionSetAB = stringSetA.union(stringSetB)</span><br><span class="line"><span class="built_in">print</span>(unionSetAB) <span class="comment">//["d", "b", "c", "a", "e"]</span></span><br></pre></td></tr></table></figure><p>å¦ä¸€æ–¹é¢ï¼Œäº¤é›†å°±æ˜¯ä»…åŒ…å«ä¸¤ä¸ªé›†åˆä¸­å…±åŒçš„å…ƒç´ ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> stringSetA: <span class="type">Set</span> = [<span class="string">"a"</span>,<span class="string">"b"</span>,<span class="string">"c"</span>]</span><br><span class="line"><span class="keyword">let</span> stringSetB: <span class="type">Set</span> = [<span class="string">"c"</span>,<span class="string">"d"</span>,<span class="string">"e"</span>]</span><br><span class="line"> </span><br><span class="line"><span class="keyword">let</span> intersectionAB = stringSetA.intersection(stringSetB)</span><br><span class="line"><span class="built_in">print</span>(intersectionAB) <span class="comment">//[â€œcâ€]</span></span><br></pre></td></tr></table></figure><h2 id="è‡ªå®šä¹‰é›†åˆå…ƒç´ ç±»å‹"><a href="#è‡ªå®šä¹‰é›†åˆå…ƒç´ ç±»å‹" class="headerlink" title="è‡ªå®šä¹‰é›†åˆå…ƒç´ ç±»å‹"></a>è‡ªå®šä¹‰é›†åˆå…ƒç´ ç±»å‹</h2><p>ä½ å¯ä»¥åœ¨é›†åˆä¸­å­˜å‚¨è‡ªå®šä¹‰çš„ç±»å‹ã€‚è¿™ç§ç±»å‹å¯ä»¥æ˜¯ç±»æˆ–è€…ç»“æ„ä½“ã€‚ä¸ºäº†èƒ½æ­£å¸¸ä½¿ç”¨é›†åˆï¼Œè¯¥ç±»å‹å¿…é¡»éµå¾ª <code>hashable</code> åè®®ã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Movie</span>: <span class="title">Hashable</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">     <span class="keyword">var</span> title: <span class="type">String</span></span><br><span class="line">     <span class="keyword">var</span> year: <span class="type">Int</span></span><br><span class="line"> </span><br><span class="line">     <span class="keyword">init</span>(title: <span class="type">String</span>, year: <span class="type">Int</span>) &#123;</span><br><span class="line">          <span class="keyword">self</span>.title = title</span><br><span class="line">          <span class="keyword">self</span>.year = year</span><br><span class="line">     &#125;</span><br><span class="line"> </span><br><span class="line">     <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> == <span class="params">(lhs: Movie, rhs: Movie)</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">          <span class="keyword">return</span> lhs.title == rhs.title &amp;&amp;</span><br><span class="line">          lhs.year == rhs.year</span><br><span class="line">     &#125;</span><br><span class="line"> </span><br><span class="line">     <span class="keyword">var</span> hashValue: <span class="type">Int</span> &#123;</span><br><span class="line">          <span class="keyword">return</span> title.hashValue ^ year.hashValue</span><br><span class="line">     &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">let</span> terminator = <span class="type">Movie</span>(title: <span class="string">"Terminator"</span>, year: <span class="number">1980</span>)</span><br><span class="line"><span class="keyword">let</span> backToTheFuture = <span class="type">Movie</span>(title: <span class="string">"Back to the Future"</span>, year: <span class="number">1985</span>)</span><br><span class="line"> </span><br><span class="line"><span class="keyword">let</span> movieSetA: <span class="type">Set</span> = [terminator,backToTheFuture]</span><br></pre></td></tr></table></figure><blockquote><p>æœ¬æ–‡ç”± SwiftGG ç¿»è¯‘ç»„ç¿»è¯‘ï¼Œå·²ç»è·å¾—ä½œè€…ç¿»è¯‘æˆæƒï¼Œæœ€æ–°æ–‡ç« è¯·è®¿é—® <a href="http://swift.gg">http://swift.gg</a>ã€‚</p></blockquote>]]></content>
    
    <summary type="html">
    
      å…³äº Swift ä¸­çš„é›†åˆï¼ˆSetï¼‰
    
    </summary>
    
      <category term="thomashanning" scheme="https://swift.gg/categories/thomashanning/"/>
    
    
      <category term="Swiftï¼ŒiOSå¼€å‘ï¼ŒSwiftè¿›é˜¶" scheme="https://swift.gg/tags/Swift%EF%BC%8CiOS%E5%BC%80%E5%8F%91%EF%BC%8CSwift%E8%BF%9B%E9%98%B6/"/>
    
  </entry>
  
  <entry>
    <title>PhotoKit çš„æ•°æ®æ¨¡å‹</title>
    <link href="https://swift.gg/2019/07/01/photos-data-model/"/>
    <id>https://swift.gg/2019/07/01/photos-data-model/</id>
    <published>2019-07-01T00:00:00.000Z</published>
    <updated>2019-08-14T12:15:53.984Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ä½œè€…ï¼šOle Begemannï¼Œ<a href="https://oleb.net/2018/photos-data-model/" target="_blank" rel="noopener">åŸæ–‡é“¾æ¥</a>ï¼ŒåŸæ–‡æ—¥æœŸï¼š2018-09-28<br>è¯‘è€…ï¼š<a href="https://github.com/zhangchi25806" target="_blank" rel="noopener">å¼ å¼›</a>ï¼›æ ¡å¯¹ï¼š<a href="http://numbbbbb.com/" target="_blank" rel="noopener">numbbbbb</a>ï¼Œ<a href="http://blog.yousanflics.com.cn" target="_blank" rel="noopener">Yousanflics</a>ï¼›å®šç¨¿ï¼š<a href="http://forelax.space" target="_blank" rel="noopener">Forelax</a></p></blockquote><!--æ­¤å¤„å¼€å§‹æ­£æ–‡--><p>åœ¨ iOS ç³»ç»Ÿä¸­ï¼Œ<a href="https://developer.apple.com/documentation/photokit" target="_blank" rel="noopener">PhotoKit æ¡†æ¶</a> ä¸ä»…è¢«ç³»ç»Ÿçš„ç…§ç‰‡ App æ‰€ä½¿ç”¨ï¼ŒåŒæ—¶å®ƒä¹Ÿä¸ºå¼€å‘äººå‘˜è®¿é—®è®¾å¤‡çš„ç…§ç‰‡åº“æä¾›äº†æ¥å£æ”¯æŒã€‚è€Œå®ƒçš„åº•å±‚åˆ™æ˜¯ <a href="https://developer.apple.com/documentation/coredata" target="_blank" rel="noopener">Core Data</a> å®ç°çš„ã€‚</p><a id="more"></a><p>è‡³å°‘ä»è¿™ä¸¤ä¸ªåœ°æ–¹ï¼Œä½ å°±å¯ä»¥ç¡®è®¤è¿™ä¸€ç‚¹ï¼š</p><ol><li>ç¼–å†™ä¸€ä¸ªèƒ½å¤Ÿè®¿é—®ç…§ç‰‡åº“çš„åº”ç”¨ï¼Œå¹¶ä½¿ç”¨ <a href="https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/CoreData/TroubleshootingCoreData.html#//apple_ref/doc/uid/TP40001075-CH26-SW21" target="_blank" rel="noopener"><code>-com.apple.CoreData.SQLDebug 1.</code></a> æ¥å¯åŠ¨è¿™ä¸ªåº”ç”¨ç¨‹åºã€‚å½“ä½ è®¿é—®ç…§ç‰‡åº“æ—¶ï¼Œä»æ§åˆ¶å°å°±å¯ä»¥çœ‹åˆ° Core Data çš„è°ƒè¯•ä¿¡æ¯ã€‚</li><li>å¦‚æœæŸ¥çœ‹ PhotoKit æ¡†æ¶çš„ <a href="http://stevenygard.com/projects/class-dump/" target="_blank" rel="noopener">class dump</a>ï¼Œä½ å°†ä¼šåœ¨ä¸»è¦çš„ç±»ä¸­çœ‹åˆ°å¯¹ <a href="https://developer.apple.com/documentation/coredata/nsmanagedobjectid" target="_blank" rel="noopener"><code>NSManagedObjectID</code></a> å’Œå…¶ä»– Core Data ç±»å‹çš„å¼•ç”¨ï¼Œä¾‹å¦‚ï¼Œ <a href="https://github.com/nst/iOS-Runtime-Headers/blob/fbb634c78269b0169efdead80955ba64eaaa2f21/Frameworks/Photos.framework/PHObject.h" target="_blank" rel="noopener"><code>PHObject</code> æœ‰ä¸€ä¸ª <code>_objectIDï¼šNSManagedObjectID</code> çš„ ivar</a>ã€‚</li></ol><h2 id="å¯»æ‰¾-PhotoKit-çš„æ ¸å¿ƒæ•°æ®æ¨¡å‹"><a href="#å¯»æ‰¾-PhotoKit-çš„æ ¸å¿ƒæ•°æ®æ¨¡å‹" class="headerlink" title="å¯»æ‰¾ PhotoKit çš„æ ¸å¿ƒæ•°æ®æ¨¡å‹"></a>å¯»æ‰¾ PhotoKit çš„æ ¸å¿ƒæ•°æ®æ¨¡å‹</h2><p>ä¸ºäº†æ›´å¥½åœ°ç†è§£ PhotoKit æ¡†æ¶ï¼ˆç‰¹åˆ«æ˜¯å®ƒçš„æ€§èƒ½ç‰¹å¾ï¼‰ï¼Œæˆ‘æ£€æŸ¥äº†å®ƒçš„æ•°æ®æ¨¡å‹ã€‚æˆ‘åœ¨ Xcode 10.0 åº”ç”¨ç¨‹åºçš„åŒ…å†…å®¹ä¸­æ‰¾åˆ°äº†ä¸€ä¸ªåä¸º <code>PhotoLibraryServices.framework / photos.momd / photos-10.0.mom</code> çš„æ–‡ä»¶ï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">/Applications/Xcode-10.app/Contents/Developer/Platforms/iPhoneOS.platform/Developer/Library/CoreSimulator/Profiles/Runtimes/iOS.simruntime/Contents/Resources/RuntimeRoot/System/Library/PrivateFrameworks/PhotoLibraryServices.framework/photos.momd/photos-10.0.mom</span><br></pre></td></tr></table></figure><blockquote><p>ä½ å¯ä»¥ä½¿ç”¨å¦‚ä¸‹çš„å‘½ä»¤æ¥æŸ¥æ‰¾ Xcode ä¸­æ¨¡æ‹Ÿå™¨è¿è¡Œæ—¶å†…çš„å…¶ä»– Core Data æ¨¡å‹ï¼š</p><p><code>find /Applications/Xcode-10.app -name &#39;*.mom&#39;</code></p></blockquote><h2 id="åœ¨-Xcode-ä¸­æ‰“å¼€å·²ç¼–è¯‘çš„-Core-Data-æ¨¡å‹"><a href="#åœ¨-Xcode-ä¸­æ‰“å¼€å·²ç¼–è¯‘çš„-Core-Data-æ¨¡å‹" class="headerlink" title="åœ¨ Xcode ä¸­æ‰“å¼€å·²ç¼–è¯‘çš„ Core Data æ¨¡å‹"></a>åœ¨ Xcode ä¸­æ‰“å¼€å·²ç¼–è¯‘çš„ Core Data æ¨¡å‹</h2><p><code>.mom</code> æ–‡ä»¶æ˜¯<em>å·²ç¼–è¯‘çš„</em> Core Data æ•°æ®æ¨¡å‹ã€‚Xcode æ— æ³•ç›´æ¥æ‰“å¼€å®ƒï¼Œä½†å¯ä»¥å°†å®ƒ<em>å¯¼å…¥</em>åˆ°å¦ä¸€ä¸ª Core Data æ¨¡å‹ä¸­ã€‚é€šè¿‡å¦‚ä¸‹çš„æ­¥éª¤ï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨ Xcode ä¸­æŸ¥çœ‹è¿™ä¸ªæ¨¡å‹ï¼š</p><ol><li>åˆ›å»ºä¸€ä¸ªæ–°çš„ç©ºé¡¹ç›®ã€‚å› ä¸ºä½¿ç”¨ Xcode 10 åœ¨é¡¹ç›®ä¹‹å¤–æ˜¾ç¤º Core Data æ¨¡å‹åŒ…å¹¶ä¸æ˜¯ä¸€ä¸ªå¥½çš„é€‰æ‹©ã€‚</li><li>åœ¨é¡¹ç›®ä¸­åˆ›å»ºä¸€ä¸ªå…¨æ–°çš„â€œCore Data æ•°æ®æ¨¡å‹â€æ–‡ä»¶ã€‚ è¿™å°†åˆ›å»ºä¸€ä¸ª <code>.xcdatamodeld</code> åŒ…ã€‚</li><li>æ‰“å¼€æ–°æ•°æ®æ¨¡å‹ï¼Œç„¶åé€‰æ‹© ç¼–è¾‘å™¨ &gt; å¯¼å…¥â€¦. ï¼Œé€‰æ‹©è¦å¯¼å…¥çš„ <code>.mom</code> æ–‡ä»¶ã€‚</li></ol><p>ä¸å¹¸çš„æ˜¯ï¼Œç¼–è¯‘çš„æ¨¡å‹å¹¶ä¸å­˜å‚¨ Xcode çš„æ¨¡å‹ç¼–è¾‘å™¨çš„å¸ƒå±€ä¿¡æ¯ï¼Œå› æ­¤ä½ å¿…é¡»æ‰‹åŠ¨å°†ç¼–è¾‘å™¨ä¸­çš„å®ä½“æ‹–å‡ºæ¥ä¸€ä¸ªæ¼‚äº®çš„æ ·å¼ä¸­ã€‚è¿™èŠ±äº†æˆ‘å‡ ä¸ªå°æ—¶ã€‚</p><blockquote><p>æ¸©é¦¨æç¤ºï¼šä½ å¯ä»¥ä½¿ç”¨ç®­å¤´é”®ï¼ˆå’Œ shift é”®+ç®­å¤´é”®ï¼‰ç²¾ç¡®å®šä½äº‹ç‰©ã€‚</p><p>ä¸“å®¶æç¤ºï¼šè¯·å‹¿ç‚¹å‡» âŒ˜Z æ’¤æ¶ˆç§»åŠ¨æ“ä½œã€‚å¯¹å›¾å½¢çš„ç¼–è¾‘ä¸ä¼šè¢« Xcode è§†ä½œä¸€ä¸ªå¯æ’¤é”€çš„æ“ä½œï¼Œå› æ­¤ Xcode å¯èƒ½ä¼šæ’¤æ¶ˆä¸€å¼€å§‹çš„å¯¼å…¥æ“ä½œï¼Œè¿™æ„å‘³ç€ä½ å°†ä¸¢å¤±æ‰€æœ‰æœªä¿å­˜çš„å·¥ä½œã€‚</p></blockquote><h2 id="å¸¦æœ‰è‰¯å¥½æ ¼å¼çš„-PhotoKit-çš„æ¨¡å‹"><a href="#å¸¦æœ‰è‰¯å¥½æ ¼å¼çš„-PhotoKit-çš„æ¨¡å‹" class="headerlink" title="å¸¦æœ‰è‰¯å¥½æ ¼å¼çš„ PhotoKit çš„æ¨¡å‹"></a>å¸¦æœ‰è‰¯å¥½æ ¼å¼çš„ PhotoKit çš„æ¨¡å‹</h2><p>è¿™æ˜¯ä¸ Xcode 10.0ï¼ˆiOS 12.0ï¼‰æ†ç»‘åœ¨ä¸€èµ·çš„ <code>photos-10.0.mom</code>ï¼š</p><p><img src="https://oleb.net/media/photos-10.0-core-data-model-5974px.png" alt="iOS 12.0 ä¸­ PhotoLibraryServices.framework çš„ Core Data æ•°æ®æ¨¡å‹ã€‚è¯·ä¸‹è½½å›¾ç‰‡å¹¶åœ¨æœ¬åœ°æ‰“å¼€ä»¥è·å¾—æœ€ä½³æ•ˆæœã€‚"></p><p>å¹¶éæ‰€æœ‰çš„å†…å®¹éƒ½èƒ½åœ¨è¿™å¼ å›¾ç‰‡ä¸­è¢«çœ‹åˆ°ã€‚ä½ å¯ä»¥ <a href="https://github.com/ole/AppleCoreDataModels" target="_blank" rel="noopener">ä¸‹è½½å®Œæ•´æ¨¡å‹</a> å¹¶åœ¨ Xcode ä¸­æŸ¥çœ‹å®ƒçš„ä¸€äº›å±æ€§ã€‚</p><p>è¯·æ³¨æ„ï¼Œè¿™ä¸ä¸€å®šæ˜¯ iOS ä¸Šçš„ç…§ç‰‡çš„å®Œæ•´æ•°æ®æ¨¡å‹ã€‚æ›´å¤šçš„ä¸€äº› Core Data æ¨¡å‹è¢«æ”¾ç½®åœ¨ <code>PrivateFrameworks/PhotoAnalysis.framework</code> ä¸­ã€‚</p><blockquote><p>æœ¬æ–‡ç”± SwiftGG ç¿»è¯‘ç»„ç¿»è¯‘ï¼Œå·²ç»è·å¾—ä½œè€…ç¿»è¯‘æˆæƒï¼Œæœ€æ–°æ–‡ç« è¯·è®¿é—® <a href="http://swift.gg">http://swift.gg</a>ã€‚</p></blockquote>]]></content>
    
    <summary type="html">
    
      PhotoKit çš„æ•°æ®æ¨¡å‹
    
    </summary>
    
      <category term="PhotoKit" scheme="https://swift.gg/categories/PhotoKit/"/>
    
      <category term="Ole Begemann" scheme="https://swift.gg/categories/PhotoKit/Ole-Begemann/"/>
    
    
      <category term="iOS å¼€å‘" scheme="https://swift.gg/tags/iOS-%E5%BC%80%E5%8F%91/"/>
    
  </entry>
  
  <entry>
    <title>å°† Swift åºåˆ—åˆ‡åˆ†ä¸ºå¤´éƒ¨å’Œå°¾éƒ¨</title>
    <link href="https://swift.gg/2019/06/24/sequence-head-tail/"/>
    <id>https://swift.gg/2019/06/24/sequence-head-tail/</id>
    <published>2019-06-24T00:00:00.000Z</published>
    <updated>2019-08-14T12:15:53.980Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ä½œè€…ï¼šOle Begemannï¼Œ<a href="https://oleb.net/2018/sequence-head-tail/" target="_blank" rel="noopener">åŸæ–‡é“¾æ¥</a>ï¼ŒåŸæ–‡æ—¥æœŸï¼š2018-11-29<br>è¯‘è€…ï¼š<a href="https://github.com/WAMaker" target="_blank" rel="noopener">WAMaker</a>ï¼›æ ¡å¯¹ï¼š<a href="http://numbbbbb.com/" target="_blank" rel="noopener">numbbbbb</a>ï¼Œ<a href="https://bignerdcoding.com/" target="_blank" rel="noopener">BigNerdCoding</a>ï¼›å®šç¨¿ï¼š<a href="http://forelax.space" target="_blank" rel="noopener">Forelax</a></p></blockquote><!--æ­¤å¤„å¼€å§‹æ­£æ–‡--><p>å‡½æ•°å¼ç¼–ç¨‹è¯­è¨€çš„ä¸€ä¸ªå¸¸ç”¨èŒƒå¼æ˜¯æŠŠä¸€ä¸ªåˆ—è¡¨åˆ‡åˆ†ä¸ºå¤´éƒ¨ï¼ˆç¬¬ä¸€ä¸ªå…ƒç´ ï¼‰å’Œå°¾éƒ¨ï¼ˆå…¶ä½™å…ƒç´ ï¼‰ã€‚åœ¨ Haskell ä¸­ï¼Œ<a href="https://en.wikibooks.org/wiki/Haskell/Pattern_matching" target="_blank" rel="noopener">x:xs</a> ä¼šåŒ¹é…éç©ºåˆ—è¡¨ï¼Œå°†å¤´éƒ¨ç»‘å®šç»™å˜é‡ xï¼Œå°¾éƒ¨ç»‘å®šç»™ xsã€‚</p><p><a href="https://academy.realm.io/posts/tryswift-rob-napier-swift-legacy-functional-programming/" target="_blank" rel="noopener">Swift ä¸æ˜¯ä¸€é—¨å‡½æ•°å¼ç¼–ç¨‹è¯­è¨€</a>ã€‚æ—¢æ²¡æœ‰å†…ç½®çš„ <code>List</code> ç±»å‹ï¼Œä¹Ÿæ²¡æœ‰é›†åˆçš„ç‰¹å®šåŒ¹é…è¯­æ³•ã€‚<a href="#foot1" id="1"><sup>[1]</sup></a></p><a id="more"></a><h2 id="é›†åˆï¼ˆCollectionsï¼‰"><a href="#é›†åˆï¼ˆCollectionsï¼‰" class="headerlink" title="é›†åˆï¼ˆCollectionsï¼‰"></a>é›†åˆï¼ˆCollectionsï¼‰</h2><p>å°½ç®¡å¦‚æ­¤ï¼Œå°† <code>Sequence</code> æˆ– <code>Collection</code> åˆ‡åˆ†æˆå¤´éƒ¨å’Œå°¾éƒ¨å¶å°”å¾ˆæœ‰ç”¨ã€‚å¯¹äºé›†åˆæ¥è¯´è¿™å¾ˆå®¹æ˜“ï¼š<br><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Collection</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> headAndTail: (head: <span class="type">Element</span>, tail: <span class="type">SubSequence</span>)? &#123;</span><br><span class="line">        <span class="keyword">guard</span> <span class="keyword">let</span> head = first <span class="keyword">else</span> &#123; <span class="keyword">return</span> <span class="literal">nil</span> &#125;</span><br><span class="line">        <span class="keyword">return</span> (head, <span class="built_in">dropFirst</span>())</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">let</span> (firstLetter, remainder) = <span class="string">"Hello"</span>.headAndTail &#123;</span><br><span class="line">    <span class="comment">// firstLetter: Character == "H"</span></span><br><span class="line">    <span class="comment">// remainder: Substring == "ello"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h2 id="åºåˆ—ï¼ˆSequenceï¼‰"><a href="#åºåˆ—ï¼ˆSequenceï¼‰" class="headerlink" title="åºåˆ—ï¼ˆSequenceï¼‰"></a>åºåˆ—ï¼ˆSequenceï¼‰</h2><p>å¯¹äºåºåˆ—æ¥è¯´å´å¾ˆå›°éš¾ï¼Œå› ä¸ºå®ƒä»¬å¯ä»¥æ˜¯å•å‘ï¼ˆsingle-passï¼‰çš„ï¼šä¸€äº›åºåˆ—åªèƒ½è¢«è¿­ä»£ä¸€æ¬¡ï¼Œè¿­ä»£å™¨ä¼šæ¶ˆè€—å…¶ä¸­çš„å…ƒç´ ã€‚ä»¥ç½‘ç»œæµä¸ºä¾‹ï¼Œä¸€æ—¦ä½ ä»ç¼“å†²åŒºé‡Œè¯»å–äº†ä¸€ä¸ªå­—èŠ‚ï¼Œæ“ä½œç³»ç»Ÿä¾¿å°†å®ƒæŠ›å¼ƒäº†ã€‚ä½ æ— æ³•è®©å®ƒé‡æ–°æ¥ä¸€éã€‚</p><p>ä¸€ä¸ªå¯èƒ½çš„è§£å†³æ–¹æ¡ˆæ˜¯ <a href="https://developer.apple.com/documentation/swift/sequence/2885155-makeiterator" target="_blank" rel="noopener">åˆ›å»ºä¸€ä¸ªè¿­ä»£å™¨</a> è¯»å–ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œå¹¶æŠŠå½“å‰çš„è¿­ä»£å™¨çŠ¶æ€åŒ…è£¹è¿›ä¸€ä¸ªæ–°çš„ <a href="https://developer.apple.com/documentation/swift/anysequence" target="_blank" rel="noopener">AnySequence</a> å®ä¾‹ï¼š<br><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Sequence</span> </span>&#123;</span><br><span class="line"><span class="keyword">var</span> headAndTail: (head: <span class="type">Element</span>, tail: <span class="type">AnySequence</span>&lt;<span class="type">Element</span>&gt;)? &#123;</span><br><span class="line">    <span class="keyword">var</span> iterator = makeIterator()</span><br><span class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> head = iterator.next() <span class="keyword">else</span> &#123; <span class="keyword">return</span> <span class="literal">nil</span> &#125;</span><br><span class="line">    <span class="keyword">let</span> tail = <span class="type">AnySequence</span> &#123; iterator &#125;</span><br><span class="line">    <span class="keyword">return</span> (head, tail)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ä»¥ä¸Šä»£ç èƒ½å¤Ÿå®ç°åŠŸèƒ½ï¼Œä½†ä¸æ˜¯ä¸€ä¸ªå¥½çš„é€šç”¨è§£å†³æ–¹æ¡ˆï¼Œå°¤å…¶æ˜¯å¯¹æ»¡è¶³ <code>Collection</code> çš„ç±»å‹è€Œè¨€ã€‚å°†å°¾éƒ¨åŒ…è¿› <code>AnySequence</code> ä¼šæ˜¯ä¸€ä¸ª <a href="https://github.com/apple/swift-evolution/blob/master/proposals/0234-remove-sequence-subsequence.md#type-erasure-performance" target="_blank" rel="noopener">æ€§èƒ½æ€æ‰‹</a>ï¼Œä¹Ÿä¸å¯ä»¥ä½¿ç”¨åˆé€‚çš„é›†åˆç±»å‹ <a href="https://developer.apple.com/documentation/swift/sequence/1641117-subsequence#" target="_blank" rel="noopener">SubSequence</a>ã€‚</p><p>ä¸ºäº†ä¿æŠ¤é›†åˆçš„ <code>SubSequence</code> ç±»å‹ï¼Œæœ€å¥½ç»™ <code>Collection</code> å’Œ <code>Sequence</code> åˆ†åˆ«å†™æ‰©å±•ã€‚ï¼ˆæˆ‘ä»¬ä¹Ÿå°†ä¼šçœ‹åˆ°ï¼Œè¿™æ˜¯ Swift 5 æ‰€æ¨å´‡çš„æ–¹æ¡ˆï¼Œè¿™ç‚¹ä¼šåœ¨åé¢è°ˆåˆ°ã€‚ï¼‰</p><h2 id="ä¿æŠ¤-SubSequence-ç±»å‹"><a href="#ä¿æŠ¤-SubSequence-ç±»å‹" class="headerlink" title="ä¿æŠ¤ SubSequence ç±»å‹"></a>ä¿æŠ¤ SubSequence ç±»å‹</h2><p>æˆ‘æ²¡æœ‰æ‰¾åˆ°ä¸€ä¸ªé€šç”¨çš„æ–¹æ¡ˆï¼Œèƒ½å¤Ÿè®©å°¾éƒ¨çš„ <code>SubSequence</code> ç±»å‹å®Œå¥½ï¼Œä¹ŸåŒæ—¶èƒ½è®©å•å‘åºåˆ—æ­£å¸¸å·¥ä½œã€‚å¾ˆæ„Ÿè°¢ <a href="https://twitter.com/dennisvennink" target="_blank" rel="noopener">Dennis Vennink</a> èƒ½å¤Ÿæ‰¾å‡ºä¸€ä¸ªè§£å†³æ–¹æ¡ˆå¹¶ <a href="https://twitter.com/dennisvennink/status/1060158576679882753" target="_blank" rel="noopener">åˆ†äº«ç»™æˆ‘</a>ã€‚ä¸‹é¢æ˜¯ <a href="https://gist.github.com/dennisvennink/e8b1921916d3c2f90ab52f47291145ef" target="_blank" rel="noopener">ä»–çš„ä»£ç </a>ï¼ˆæˆ‘ç•¥å¾®å¯¹æ ¼å¼è¿›è¡Œäº†ä¿®æ”¹ï¼‰ï¼š<br><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Sequence</span> </span>&#123;</span><br><span class="line"><span class="keyword">var</span> headAndTail: (head: <span class="type">Element</span>, tail: <span class="type">SubSequence</span>)? &#123;</span><br><span class="line">    <span class="keyword">var</span> first: <span class="type">Element?</span> = <span class="literal">nil</span></span><br><span class="line">    <span class="keyword">let</span> tail = drop(<span class="keyword">while</span>: &#123; element <span class="keyword">in</span></span><br><span class="line">        <span class="keyword">if</span> first == <span class="literal">nil</span> &#123;</span><br><span class="line">            first = element</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> head = first <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> (head, tail)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>Dennis çš„çªé—¨æ˜¯è°ƒç”¨ <a href="https://developer.apple.com/documentation/swift/sequence/2965501-drop" target="_blank" rel="noopener">Sequence.drop(while:)</a>ï¼Œä¸ºå°¾éƒ¨ä¿ç•™äº† <code>SubSequence</code> ç±»å‹ï¼ŒåŒæ—¶åœ¨ <code>drop(while:)</code> å†…éƒ¨â€œæ•è·â€äº†ç¬¬ä¸€ä¸ªå…ƒç´ ã€‚å¹²å¾—æ¼‚äº®ï¼</p><h2 id="Swift-5"><a href="#Swift-5" class="headerlink" title="Swift 5"></a>Swift 5</h2><p>ä¸Šé¢çš„ä»£ç ä½¿ç”¨ Swift 4.2ã€‚åœ¨ Swift 5 ä¸­ç”±äºåºåˆ—ä¸å†ä¼šæœ‰å…³è” <code>SubSequence</code> ç±»å‹ï¼Œåªå­˜åœ¨äºé›†åˆä¸­ï¼ˆ<a href="https://github.com/apple/swift-evolution/blob/master/proposals/0234-remove-sequence-subsequence.md" target="_blank" rel="noopener">Swift Evolution proposal SE-0234</a>ï¼‰ï¼Œä»¥ä¸Šä»£ç ä¼šå´©æºƒã€‚<a href="#foot2" id="2"><sup>[2]</sup></a></p><p>è¿™ä¸ªæ”¹å˜æœ‰å¾ˆå¤šä¼˜åŠ¿ï¼Œä½†åŒæ ·æ„å‘³ç€ä¸å¯èƒ½æœ‰ä¸€ç§é€šç”¨çš„æ–¹æ³•èƒ½å¤Ÿè®© <code>SubSequence</code> åŒæ—¶å¯¹ <code>Sequence</code> å’Œ <code>Collection</code> æœ‰æ•ˆã€‚</p><p>ç›¸å¯¹çš„ï¼Œæˆ‘ä»¬æŠŠé‚£ä¸ªç®€å•çš„è§£å†³æ–¹æ¡ˆæ·»åŠ ç»™ <code>Collection</code>ï¼š<br><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Collection</span> </span>&#123;</span><br><span class="line"><span class="keyword">var</span> headAndTail: (head: <span class="type">Element</span>, tail: <span class="type">SubSequence</span>)? &#123;</span><br><span class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> head = first <span class="keyword">else</span> &#123; <span class="keyword">return</span> <span class="literal">nil</span> &#125;</span><br><span class="line">    <span class="keyword">return</span> (head, <span class="built_in">dropFirst</span>())</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>å¦‚æœæˆ‘ä»¬éœ€è¦è®© <code>Sequence</code> æ‹¥æœ‰åŒæ ·çš„åŠŸèƒ½ï¼Œå°±éœ€è¦æ·»åŠ ä¸€ä¸ªç‹¬ç«‹çš„æ‰©å±•ï¼Œä½¿ç”¨æ–°çš„ <code>DropWhileSequence</code> ä½œä¸ºè¿”å›ç±»å‹çš„å°¾éƒ¨ï¼š<br><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Sequence</span> </span>&#123;</span><br><span class="line"><span class="keyword">var</span> headAndTail: (head: <span class="type">Element</span>, tail: <span class="type">DropWhileSequence</span>&lt;<span class="type">Self</span>&gt;)? &#123;</span><br><span class="line">    <span class="keyword">var</span> first: <span class="type">Element?</span> = <span class="literal">nil</span></span><br><span class="line">    <span class="keyword">let</span> tail = drop(<span class="keyword">while</span>: &#123; element <span class="keyword">in</span></span><br><span class="line">        <span class="keyword">if</span> first == <span class="literal">nil</span> &#123;</span><br><span class="line">            first = element</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> head = first <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> (head, tail)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ï¼ˆå®ç°å’Œä¹‹å‰çš„ä»£ç ä¸€æ ·ï¼Œä»…ä»…æ”¹å˜äº†è¿”å›çš„ç±»å‹ã€‚ï¼‰</p><hr><p><a id="foot1" href="#1"><sup>[1]</sup></a>ä¸ºé›†åˆæ·»åŠ ä¸€ç§æ¨¡å¼åŒ¹é…ç»“æ„ä½œä¸ºä¸€ä¸ª <a href="https://forums.swift.org/t/review-se-0074-implementation-of-binary-search-functions/2438/9" target="_blank" rel="noopener">å¯è¡Œ</a> çš„ç‰¹æ€§å·²ç»åœ¨è®ºå›å¤šæ¬¡è¢« <a href="https://forums.swift.org/t/pattern-matching-with-arrays/4735/3" target="_blank" rel="noopener">æåŠ</a>ã€‚æœ‰äº†å®ƒï¼Œä½ å¯ä»¥åƒä¸‹é¢è¿™æ ·å°†ä¸€ä¸ªæœ‰åºé›†åˆè§£æ„æˆå¤´éƒ¨å’Œå°¾éƒ¨ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> numbers = <span class="number">1</span>...<span class="number">10</span></span><br><span class="line"><span class="keyword">let</span> [head, tail...] = numbers</span><br><span class="line"><span class="comment">// head == 1</span></span><br><span class="line"><span class="comment">// tail == 2...10</span></span><br></pre></td></tr></table></figure><p>åœ¨ <code>switch</code> è¡¨è¾¾å¼ä¸­ä¼šå¾ˆæœ‰ç”¨ã€‚</p><p><a id="foot2" href="#2"><sup>[2]</sup></a>å¾ˆé—æ†¾æˆ‘ä»¬è¢«è¯¯å¯¼æ€§çš„åå­— <code>Sequence</code> ç»™æŸç¼šä½äº†ã€‚è¦å°† <code>Collection.SubSequence</code> é‡å‘½åæˆæ›´åˆé€‚çš„ <code>Slice</code> ä¼šé€ æˆ <a href="https://forums.swift.org/t/rationalizing-sequence-subsequence/17586/13" target="_blank" rel="noopener">ä¸¥é‡çš„ä»£ç ç ´å</a>ã€‚</p><blockquote><p>æœ¬æ–‡ç”± SwiftGG ç¿»è¯‘ç»„ç¿»è¯‘ï¼Œå·²ç»è·å¾—ä½œè€…ç¿»è¯‘æˆæƒï¼Œæœ€æ–°æ–‡ç« è¯·è®¿é—® <a href="http://swift.gg">http://swift.gg</a>ã€‚</p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;ä½œè€…ï¼šOle Begemannï¼Œ&lt;a href=&quot;https://oleb.net/2018/sequence-head-tail/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;åŸæ–‡é“¾æ¥&lt;/a&gt;ï¼ŒåŸæ–‡æ—¥æœŸï¼š2018-11-29&lt;br&gt;è¯‘è€…ï¼š&lt;a href=&quot;https://github.com/WAMaker&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;WAMaker&lt;/a&gt;ï¼›æ ¡å¯¹ï¼š&lt;a href=&quot;http://numbbbbb.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;numbbbbb&lt;/a&gt;ï¼Œ&lt;a href=&quot;https://bignerdcoding.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;BigNerdCoding&lt;/a&gt;ï¼›å®šç¨¿ï¼š&lt;a href=&quot;http://forelax.space&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Forelax&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;!--æ­¤å¤„å¼€å§‹æ­£æ–‡--&gt;
&lt;p&gt;å‡½æ•°å¼ç¼–ç¨‹è¯­è¨€çš„ä¸€ä¸ªå¸¸ç”¨èŒƒå¼æ˜¯æŠŠä¸€ä¸ªåˆ—è¡¨åˆ‡åˆ†ä¸ºå¤´éƒ¨ï¼ˆç¬¬ä¸€ä¸ªå…ƒç´ ï¼‰å’Œå°¾éƒ¨ï¼ˆå…¶ä½™å…ƒç´ ï¼‰ã€‚åœ¨ Haskell ä¸­ï¼Œ&lt;a href=&quot;https://en.wikibooks.org/wiki/Haskell/Pattern_matching&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;x:xs&lt;/a&gt; ä¼šåŒ¹é…éç©ºåˆ—è¡¨ï¼Œå°†å¤´éƒ¨ç»‘å®šç»™å˜é‡ xï¼Œå°¾éƒ¨ç»‘å®šç»™ xsã€‚&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://academy.realm.io/posts/tryswift-rob-napier-swift-legacy-functional-programming/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Swift ä¸æ˜¯ä¸€é—¨å‡½æ•°å¼ç¼–ç¨‹è¯­è¨€&lt;/a&gt;ã€‚æ—¢æ²¡æœ‰å†…ç½®çš„ &lt;code&gt;List&lt;/code&gt; ç±»å‹ï¼Œä¹Ÿæ²¡æœ‰é›†åˆçš„ç‰¹å®šåŒ¹é…è¯­æ³•ã€‚&lt;a href=&quot;#foot1&quot; id=&quot;1&quot;&gt;&lt;sup&gt;[1]&lt;/sup&gt;&lt;/a&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="Ole Begemann" scheme="https://swift.gg/categories/Ole-Begemann/"/>
    
    
      <category term="Swift" scheme="https://swift.gg/tags/Swift/"/>
    
  </entry>
  
  <entry>
    <title>ä½¿ç”¨ Swift å®ç°åŸºäºå †çš„ä¼˜å…ˆçº§é˜Ÿåˆ—</title>
    <link href="https://swift.gg/2019/05/06/implementing-a-heap-based-priority-queue-using-swift/"/>
    <id>https://swift.gg/2019/05/06/implementing-a-heap-based-priority-queue-using-swift/</id>
    <published>2019-05-06T00:00:00.000Z</published>
    <updated>2019-08-14T12:15:53.980Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ä½œè€…ï¼šAPPCODA EDITORIAL TEAMï¼Œ<a href="https://appcoda.com/swift-algorithm/" target="_blank" rel="noopener">åŸæ–‡é“¾æ¥</a>ï¼ŒåŸæ–‡æ—¥æœŸï¼š2019-01-07<br>è¯‘è€…ï¼š<a href="undefined">Roc Zhang</a>ï¼›æ ¡å¯¹ï¼š<a href="http://www.jianshu.com/users/596f2ba91ce9/latest_articles" target="_blank" rel="noopener">pmst</a>ï¼Œ<a href="http://numbbbbb.com/" target="_blank" rel="noopener">numbbbbb</a>ï¼›å®šç¨¿ï¼š<a href="http://forelax.space" target="_blank" rel="noopener">Forelax</a></p></blockquote><!--æ­¤å¤„å¼€å§‹æ­£æ–‡--><p>åœ¨è®¡ç®—æœºç§‘å­¦ä¸­ï¼Œæœ‰å¾ˆå¤šé—®é¢˜å¯ä»¥é€šè¿‡å°†åº•å±‚æ•°æ®ç»“æ„ç”¨ä¼˜å…ˆçº§é˜Ÿåˆ—å®ç°æ¥æ”¹å–„ç®—æ³•çš„æ—¶é—´å¤æ‚åº¦ã€‚å…¶ä¸­ Dijkstra çš„æœ€çŸ­è·¯å¾„ç®—æ³•ä¾¿æ˜¯ä¸€ä¸ªä¾‹å­ï¼Œè¯¥ç®—æ³•ä½¿ç”¨äº†ä¼˜å…ˆçº§é˜Ÿåˆ—æ¥åœ¨å›¾ä¸­æœç´¢ä¸¤ä¸ªé¡¶ç‚¹é—´çš„æœ€çŸ­è·¯å¾„ã€‚</p><p>ä¸å¹¸çš„æ˜¯ï¼ŒSwift çš„æ ‡å‡†åº“ä¸­å¹¶æ²¡æœ‰æä¾›ä¼˜å…ˆçº§é˜Ÿåˆ—çš„é»˜è®¤å®ç°ã€‚æ‰€ä»¥æˆ‘ä»¬å°†ä¼šç ”ç©¶å¦‚ä½•è‡ªè¡Œå®ç°åŸºäºå †çš„ä¼˜å…ˆçº§é˜Ÿåˆ—ã€‚</p><a id="more"></a><p>å¦‚æœä½ æƒ³åœ¨è‡ªå·±çš„ IDE ä¸­ä¸€èµ·åŠ¨æ‰‹æ¥æ“ä½œï¼Œç‚¹å‡» <a href="https://github.com/JimmyMAndersson/HeapPriorityQueue" target="_blank" rel="noopener">æ­¤é“¾æ¥</a> ä¾¿å¯è·å–åˆ°æºç ã€‚</p><h2 id="ä»€ä¹ˆæ˜¯ä¼˜å…ˆçº§é˜Ÿåˆ—ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯ä¼˜å…ˆçº§é˜Ÿåˆ—ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯ä¼˜å…ˆçº§é˜Ÿåˆ—ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯ä¼˜å…ˆçº§é˜Ÿåˆ—ï¼Ÿ</h2><p>ä¼˜å…ˆçº§é˜Ÿåˆ—æ˜¯ä¸€ç§å¯ä»¥å¯¹å…·æœ‰ç›¸å¯¹ä¼˜å…ˆçº§çš„å¯¹è±¡è¿›è¡Œé«˜æ•ˆæ’åºçš„æ•°æ®ç»“æ„ã€‚å®ƒä¼šæ ¹æ®é˜Ÿåˆ—ä¸­æ¯ä¸ªå¯¹è±¡çš„ä¼˜å…ˆçº§ï¼Œä¸€ä¸ªä¸ªå°†é˜Ÿåˆ—ä¸­çš„å¯¹è±¡è¿›è¡Œæ’åºã€‚</p><p>å‡è®¾ä½ åˆ›å»ºäº†ä¸€ç³»åˆ—ä»»åŠ¡å¹¶å‡†å¤‡åœ¨å°†æ¥çš„æŸä¸ªæ—¶é—´ç‚¹è¿è¡Œå®ƒä»¬ï¼Œåˆ©ç”¨ä¼˜å…ˆçº§é˜Ÿåˆ—å°±å¯ä»¥è®©è¿™äº›ä»»åŠ¡æŒ‰ç…§ä½ é¢„æœŸæ‰§è¡Œã€‚</p><p>åœ¨æ¥ä¸‹æ¥çš„æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨å †ç»“æ„æ¥å®ç°æˆ‘ä»¬çš„ä¼˜å…ˆçº§é˜Ÿåˆ—ã€‚</p><h2 id="ä»€ä¹ˆæ˜¯å †ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯å †ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯å †ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯å †ï¼Ÿ</h2><p>æˆ‘ä»¬å¯ä»¥æŠŠå †çœ‹ä½œæ˜¯æ¯ä¸ªèŠ‚ç‚¹æœ€å¤šåªæœ‰ä¸¤ä¸ªå­èŠ‚ç‚¹çš„æ ‘ï¼Œä½†ä¸æ ‘ä¸åŒçš„æ˜¯ï¼Œå‘å †ä¸­æ·»åŠ æ–°èŠ‚ç‚¹æ—¶è¦å°½å¯èƒ½å¾€é¡¶å±‚å·¦ä¾§æ”¾ç½®ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="https://appcoda.com/wp-content/uploads/2019/01/Conceptual-sketch-of-a-new-node-being-inserted-into-a-heap.png" alt></p><p>åŒæ—¶ï¼Œå †è¿˜å…·æœ‰ç€ä¸€äº›ä¸èŠ‚ç‚¹é—´ç›¸å¯¹å¤§å°å…³ç³»ç›¸å…³çš„ç‰¹æ€§ã€‚ä¸€ä¸ªæœ€å°å †ï¼ˆå°±æ˜¯æˆ‘ä»¬å³å°†è¦ä½¿ç”¨çš„ï¼‰æœ‰ç€æ¯ä¸€ä¸ªèŠ‚ç‚¹æ¯”å…¶å­èŠ‚ç‚¹éƒ½è¦å°çš„ç‰¹æ€§ã€‚æœ€å¤§å †åˆ™æ­£å¥½ç›¸åã€‚</p><p>ä¸ºäº†èƒ½å¤Ÿç»´æŒè¿™ç§æ€§è´¨ï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡ä¸€äº›æ“ä½œæ¥å¾—åˆ°èŠ‚ç‚¹çš„æ­£ç¡®ä½ç½®é¡ºåºã€‚å½“æˆ‘ä»¬æ’å…¥ä¸€ä¸ªæ–°èŠ‚ç‚¹æ—¶ï¼Œå…ˆå°†å®ƒæ”¾åœ¨æ ‘çš„é¡¶å±‚å·¦ä¾§å¼€å§‹çš„ç¬¬ä¸€ä¸ªç©ºä½™å¯ç”¨çš„ä½ç½®ä¸Šã€‚å¦‚æœåœ¨æ”¾ç½®åæœ€å°å †çš„æ€§è´¨ä¸æˆç«‹ï¼Œåˆ™å°†æ­¤èŠ‚ç‚¹ä¸å®ƒçš„çˆ¶èŠ‚ç‚¹äº¤æ¢ï¼Œç›´åˆ°æœ€å°å †æ€§è´¨æˆç«‹ä¸ºæ­¢ã€‚ä¸‹å›¾å±•ç¤ºäº†å‘ä¸€ä¸ªå·²æœ‰çš„æœ€å°å †ä¸­æ’å…¥æ•°å­— 2 çš„æƒ…å†µã€‚</p><p><img src="https://appcoda.com/wp-content/uploads/2019/01/Maintaining-the-min-heap-property-on-insertion.png" alt></p><p>å½“è¦æŠŠä¸€ä¸ªå¯¹è±¡ç§»å‡ºé˜Ÿåˆ—æ—¶ï¼Œéœ€é™åˆ¶åªä»é˜Ÿåˆ—çš„æŸä¸€ç«¯è¿›è¡Œæ“ä½œã€‚åœ¨è¿™é‡Œæˆ‘ä»¬å°†é€šè¿‡é™å®šåªèƒ½åˆ é™¤æ ¹èŠ‚ç‚¹çš„æ–¹å¼æ¥å®ç°ã€‚å½“æ ¹èŠ‚ç‚¹è¢«ç§»é™¤æ—¶ï¼Œä¼šè¢«é¡¶å±‚æœ€å³è¾¹çš„èŠ‚ç‚¹æ›¿ä»£ã€‚ç”±äºæ–°èŠ‚ç‚¹æˆä¸ºæ ¹èŠ‚ç‚¹åæœ‰å¾ˆå¤§æ¦‚ç‡ä¼šè¿‡å¤§ï¼Œæˆ‘ä»¬å°†æŠŠå®ƒå‘ä¸‹ç§»åŠ¨ï¼ŒæŠŠå®ƒä¸æœ€å°çš„å­èŠ‚ç‚¹äº¤æ¢ï¼Œç›´åˆ°æˆ‘ä»¬æ¢å¤æœ€å°å †ã€‚</p><h2 id="å…³äºå®ç°æœ¬èº«çš„ç®€çŸ­è¯´æ˜"><a href="#å…³äºå®ç°æœ¬èº«çš„ç®€çŸ­è¯´æ˜" class="headerlink" title="å…³äºå®ç°æœ¬èº«çš„ç®€çŸ­è¯´æ˜"></a>å…³äºå®ç°æœ¬èº«çš„ç®€çŸ­è¯´æ˜</h2><p>æˆ‘ä»¬å°†é‡‡ç”¨æ•°ç»„æ¥å®ç°ä¸€ä¸ªæ—¢å¿«é€ŸåˆèŠ‚çœç©ºé—´çš„æ ‘ç»“æ„ã€‚è¿™é‡Œæˆ‘ä¸æ‰“ç®—è¿‡äºæ·±å…¥å…¶ä¸­çš„æ•°å­¦è¿ç®—ï¼Œä½†å¦‚æœä½ æœ‰å…´è¶£çš„è¯ï¼Œå¯ä»¥çœ‹ä¸€çœ‹è¿™ä¸ª <a href="https://en.wikipedia.org/wiki/Heap_%28data_structure%29#Implementation" target="_blank" rel="noopener">é“¾æ¥</a>ï¼Œå®ƒè§£é‡Šäº†æ•°å­¦åœ¨å…¶ä¸­è¿ç”¨çš„æ–¹å¼ä¸èƒŒåçš„åŸå› ã€‚</p><p>å‡†å¤‡å¥½äº†å—ï¼Ÿæˆ‘ä»¬å¼€å§‹å§ã€‚</p><h2 id="è®¾è®¡åè®®"><a href="#è®¾è®¡åè®®" class="headerlink" title="è®¾è®¡åè®®"></a>è®¾è®¡åè®®</h2><p>åŒå¾€å¸¸ä¸€æ ·ï¼Œæˆ‘ä»¬å…ˆæ¥å®šä¹‰å¯¹è±¡è¦å±•ç¤ºç»™å¤–éƒ¨ç”¨æˆ·æ€æ ·çš„åŠŸèƒ½ã€‚æˆ‘ä»¬ä»¥å®šä¹‰åè®®çš„æ–¹å¼æ¥å®Œæˆè¿™ä»¶äº‹ï¼Œç¨åå†è®©å…·ä½“çš„ç±»æ¥éµå¾ªå®ƒã€‚æˆ‘ä¸ºé˜Ÿåˆ—è®¾è®¡çš„åè®®å¦‚ä¸‹ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">Queue</span> </span>&#123;</span><br><span class="line">  <span class="keyword">associatedtype</span> <span class="type">DataType</span>: <span class="type">Comparable</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">  å°†ä¸€ä¸ªæ–°å…ƒç´ æ’å…¥åˆ°é˜Ÿåˆ—ä¸­ã€‚</span></span><br><span class="line"><span class="comment">  - å‚æ•° itemï¼šè¦æ·»åŠ çš„å…ƒç´ ã€‚</span></span><br><span class="line"><span class="comment">  - è¿”å›å€¼ï¼šæ’å…¥æ˜¯å¦æˆåŠŸã€‚</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  <span class="meta">@discardableResult</span> <span class="function"><span class="keyword">func</span> <span class="title">add</span><span class="params">(<span class="number">_</span> item: DataType)</span></span> -&gt; <span class="type">Bool</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">  åˆ é™¤é¦–ä¸ªå…ƒç´ ã€‚</span></span><br><span class="line"><span class="comment">  - è¿”å›å€¼ï¼šè¢«ç§»é™¤çš„å…ƒç´ ã€‚</span></span><br><span class="line"><span class="comment">  - æŠ›å‡ºå€¼ï¼šQueueError ç±»å‹çš„é”™è¯¯ã€‚</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  <span class="meta">@discardableResult</span> <span class="function"><span class="keyword">func</span> <span class="title">remove</span><span class="params">()</span></span> <span class="keyword">throws</span> -&gt; <span class="type">DataType</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">  è·å–åˆ°é˜Ÿåˆ—ä¸­çš„é¦–ä¸ªå…ƒç´ ï¼Œå¹¶å°†å…¶ç§»å‡ºé˜Ÿåˆ—ã€‚</span></span><br><span class="line"><span class="comment">  - è¿”å›å€¼ï¼šä¸€ä¸ªåŒ…å«é˜Ÿåˆ—ä¸­é¦–ä¸ªå…ƒç´ çš„å¯é€‰å€¼ã€‚</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">dequeue</span><span class="params">()</span></span> -&gt; <span class="type">DataType?</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">  è·å–é˜Ÿåˆ—ä¸­çš„é¦–ä¸ªå…ƒç´ ï¼Œä½†ä¸å°†å®ƒç§»å‡ºé˜Ÿåˆ—ã€‚</span></span><br><span class="line"><span class="comment">  - è¿”å›å€¼ï¼šä¸€ä¸ªåŒ…å«é˜Ÿåˆ—ä¸­é¦–ä¸ªå…ƒç´ çš„å¯é€‰å€¼ã€‚</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">peek</span><span class="params">()</span></span> -&gt; <span class="type">DataType?</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">  æ¸…ç©ºé˜Ÿåˆ—ã€‚</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">clear</span><span class="params">()</span></span> -&gt; <span class="type">Void</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¯¥åè®®æ˜ç¡®äº†æˆ‘ä»¬éœ€è¦å®ç°çš„åŠŸèƒ½ï¼Œä¾›å¤–éƒ¨ç”¨æˆ·è°ƒç”¨ã€‚åè®®åŒæ ·è¿˜è¯´æ˜äº†å…¶ä¸­çš„æŸä¸€ä¸ªæ–¹æ³•å¯èƒ½ä¼šæŠ›å‡ºé”™è¯¯ï¼Œä¸”æ ¹æ®æ–‡æ¡£æˆ‘ä»¬èƒ½å¤Ÿäº†è§£åˆ°å®ƒä¼šæ˜¯ä¸€ä¸ª QueueError ç±»å‹çš„é”™è¯¯ï¼Œå› æ­¤æˆ‘ä»¬åŒæ ·ä¹Ÿè¦å®ç°å®ƒã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">QueueError</span>: <span class="title">Error</span> </span>&#123;</span><br><span class="line">  <span class="keyword">case</span> noSuchItem(<span class="type">String</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ®µä»£ç éå¸¸ç®€æ˜æ‰¼è¦ï¼šå½“ç”¨æˆ·å°è¯•ä»ç©ºé˜Ÿåˆ—ä¸­åˆ é™¤å…ƒç´ æ—¶ï¼Œæˆ‘ä»¬ä¼šæŠ›å‡ºä¸Šé¢è¿™æ ·çš„é”™è¯¯ã€‚</p><p>ç°åœ¨æ‰€æœ‰çš„å‡†å¤‡å·¥ä½œå·²ç»å®Œæˆï¼Œè®©æˆ‘ä»¬å¼€å§‹å®ç°é˜Ÿåˆ—æœ¬èº«ã€‚</p><h2 id="å®ç°ä¼˜å…ˆçº§é˜Ÿåˆ—"><a href="#å®ç°ä¼˜å…ˆçº§é˜Ÿåˆ—" class="headerlink" title="å®ç°ä¼˜å…ˆçº§é˜Ÿåˆ—"></a>å®ç°ä¼˜å…ˆçº§é˜Ÿåˆ—</h2><p>æˆ‘ä»¬å°†é¦–å…ˆä»å£°æ˜ PriorityQueue ç±»å¼€å§‹ï¼Œç„¶åå†å®ç°å®ƒçš„åˆå§‹åŒ–æ–¹æ³•ä¸å­˜å‚¨å…ƒç´ ï¼ŒåŒæ—¶å®Œæˆä¸€äº›â€œæœ‰åˆ™æ›´å¥½â€çš„æ–¹æ³•ã€‚ä»£ç çœ‹èµ·æ¥æ˜¯è¿™æ ·çš„ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> åŸºäºå †æ•°æ®ç»“æ„çš„ PriorityQueue å®ç°ã€‚</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PriorityQueue</span>&lt;<span class="title">DataType</span>: <span class="title">Comparable</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   é˜Ÿåˆ—çš„å­˜å‚¨ã€‚</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">var</span> queue: <span class="type">Array</span>&lt;<span class="type">DataType</span>&gt;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   å½“å‰é˜Ÿåˆ—çš„å¤§å°ã€‚</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">var</span> size: <span class="type">Int</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>.queue.<span class="built_in">count</span></span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">init</span>() &#123;</span><br><span class="line">    <span class="keyword">self</span>.queue = <span class="type">Array</span>&lt;<span class="type">DataType</span>&gt;()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½ ä¹Ÿè®¸æ³¨æ„åˆ°äº†ï¼Œæˆ‘ä»¬ç›®å‰è¿˜æ²¡æœ‰å®ç°é˜Ÿåˆ—çš„åè®®ã€‚å½“æˆ‘ä»¬è¿›è¡Œç¼–ç æ—¶ï¼Œé€šå¸¸å¸Œæœ›äº‹ç‰©ä¹‹é—´èƒ½ä¿æŒç›¸å¯¹åˆ†ç¦»ã€‚å¹¶ä¸”å¸Œæœ›èƒ½åˆ›å»ºå‡ºä¸€ä¸ªæ¦‚è§ˆä»è€Œæ–¹ä¾¿æˆ‘ä»¬å»è¿›è¡ŒæŸ¥æ‰¾ã€‚æœ‰äº›ç±»å¯èƒ½ä¼šé€æ¸å˜å¾—éå¸¸å¤§ï¼Œè§£å†³è¿™ç§æƒ…å†µçš„æ–¹æ³•ä¹‹ä¸€æ˜¯ä½¿ç”¨æ‰©å±•ä½œç”¨åŸŸã€‚è¿™æ ·ï¼Œæ¯ä¸€ä¸ªæ‰©å±•å€¾å‘äºåªåšä¸€ä¸ªä»»åŠ¡ï¼ˆæ¯”å¦‚å»éµå¾ªä¸€ä¸ªåè®®ï¼Œå¤„ç†å­˜å‚¨ä¸åˆå§‹åŒ–ï¼Œåˆæˆ–æ˜¯åµŒå¥—ç±»çš„å£°æ˜ç­‰ï¼‰ï¼Œäº‹åå†å»æŸ¥æ‰¾æ—¶å°±ä¼šå®¹æ˜“å¾ˆå¤šã€‚è®©æˆ‘ä»¬åœ¨è¿™é‡Œä¹Ÿå°è¯•ä½¿ç”¨è¿™ç§æ–¹å¼ã€‚é¦–å…ˆï¼Œå®ç°ä¸€ä¸ª Int ç±»å‹çš„ç§æœ‰æ‰©å±•ï¼Œè¿™èƒ½å¤Ÿå¸®åŠ©æˆ‘ä»¬æ‰§è¡Œä¸€äº›é¢„å…ˆå®šä¹‰å¥½çš„ç´¢å¼•è®¡ç®—:</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="class"><span class="keyword">extension</span> <span class="title">Int</span> </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> leftChild: <span class="type">Int</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (<span class="number">2</span> * <span class="keyword">self</span>) + <span class="number">1</span></span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">var</span> rightChild: <span class="type">Int</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (<span class="number">2</span> * <span class="keyword">self</span>) + <span class="number">2</span></span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">var</span> parent: <span class="type">Int</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (<span class="keyword">self</span> - <span class="number">1</span>) / <span class="number">2</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç”±äºæ˜¯ç§æœ‰çš„è®¿é—®æƒé™ï¼Œè¿™ä¸ªæ‰©å±•åªåœ¨ PriorityQueue æ–‡ä»¶ä¸­å¯ç”¨ã€‚è¿™é‡Œèšé›†äº†æˆ‘ä»¬å°†è¦ä½¿ç”¨çš„è·å–æŸä¸ªèŠ‚ç‚¹çš„å­èŠ‚ç‚¹ä¸çˆ¶èŠ‚ç‚¹çš„è®¡ç®—ã€‚è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡è°ƒç”¨ .leftChild å±æ€§æ¥æ–¹ä¾¿çš„è·å–åˆ°å·¦å­èŠ‚ç‚¹çš„ç´¢å¼•ï¼Œè€Œä¸å¿…åœ¨å®ç°ä¸­å»è¿›è¡Œä¸€å †çš„æ•°å­¦è¿ç®—äº†ï¼Œä»¥æ­¤ç±»æ¨ã€‚</p><p>ä¸‹é¢æ˜¯æˆ‘ä»¬å¯¹ Queue åè®®çš„éµå¾ªå®ç°:</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">PriorityQueue</span>: <span class="title">Queue</span> </span>&#123;</span><br><span class="line">  <span class="meta">@discardableResult</span></span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">add</span><span class="params">(<span class="number">_</span> item: DataType)</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">    <span class="keyword">self</span>.queue.append(item)</span><br><span class="line">    <span class="keyword">self</span>.heapifyUp(from: <span class="keyword">self</span>.queue.<span class="built_in">count</span> - <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@discardableResult</span></span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">remove</span><span class="params">()</span></span> <span class="keyword">throws</span> -&gt; <span class="type">DataType</span> &#123;</span><br><span class="line">    <span class="keyword">guard</span> <span class="keyword">self</span>.queue.<span class="built_in">count</span> &gt; <span class="number">0</span> <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="type">QueueError</span>.noSuchItem(<span class="string">"Attempt to remove item from an empty queue."</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>.popAndHeapifyDown()</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">dequeue</span><span class="params">()</span></span> -&gt; <span class="type">DataType?</span> &#123;</span><br><span class="line">    <span class="keyword">guard</span> <span class="keyword">self</span>.queue.<span class="built_in">count</span> &gt; <span class="number">0</span> <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>.popAndHeapifyDown()</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">peek</span><span class="params">()</span></span> -&gt; <span class="type">DataType?</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>.queue.first</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">clear</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">self</span>.queue.removeAll()</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">  å¼¹å‡ºé˜Ÿåˆ—ä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œå¹¶é€šè¿‡å°†æ ¹å…ƒç´ ç§»å‘é˜Ÿå°¾çš„æ–¹å¼æ¢å¤æœ€å°å †æ’åºã€‚</span></span><br><span class="line"><span class="comment">  - è¿”å›å€¼: é˜Ÿåˆ—ä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ ã€‚</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  <span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">popAndHeapifyDown</span><span class="params">()</span></span> -&gt; <span class="type">DataType</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> firstItem = <span class="keyword">self</span>.queue[<span class="number">0</span>]</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">self</span>.queue.<span class="built_in">count</span> == <span class="number">1</span> &#123;</span><br><span class="line">      <span class="keyword">self</span>.queue.remove(at: <span class="number">0</span>)</span><br><span class="line">      <span class="keyword">return</span> firstItem</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">self</span>.queue[<span class="number">0</span>] = <span class="keyword">self</span>.queue.remove(at: <span class="keyword">self</span>.queue.<span class="built_in">count</span> - <span class="number">1</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">self</span>.heapifyDown()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> firstItem</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   é€šè¿‡å°†å…ƒç´ ç§»å‘é˜Ÿå¤´çš„æ–¹å¼æ¢å¤æœ€å°å †æ’åºã€‚</span></span><br><span class="line"><span class="comment">   - å‚æ•° index: è¦ç§»åŠ¨çš„å…ƒç´ çš„ç´¢å¼•å€¼ã€‚</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">heapifyUp</span><span class="params">(from index: Int)</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> child = index</span><br><span class="line">    <span class="keyword">var</span> parent = child.parent</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">while</span> parent &gt;= <span class="number">0</span> &amp;&amp; <span class="keyword">self</span>.queue[parent] &gt; <span class="keyword">self</span>.queue[child] &#123;</span><br><span class="line">      <span class="built_in">swap</span>(parent, with: child)</span><br><span class="line">      child = parent</span><br><span class="line">      parent = child.parent</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   é€šè¿‡å°†æ ¹å…ƒç´ ç§»å‘é˜Ÿå°¾çš„æ–¹å¼æ¢å¤é˜Ÿåˆ—çš„æœ€å°å †æ’åºã€‚</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">heapifyDown</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> parent = <span class="number">0</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">while</span> <span class="literal">true</span> &#123;</span><br><span class="line">      <span class="keyword">let</span> leftChild = parent.leftChild</span><br><span class="line">      <span class="keyword">if</span> leftChild &gt;= <span class="keyword">self</span>.queue.<span class="built_in">count</span> &#123;</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">      &#125;</span><br><span class="line">      </span><br><span class="line">      <span class="keyword">let</span> rightChild = parent.rightChild</span><br><span class="line">      <span class="keyword">var</span> minChild = leftChild</span><br><span class="line">      <span class="keyword">if</span> rightChild &lt; <span class="keyword">self</span>.queue.<span class="built_in">count</span> &amp;&amp; <span class="keyword">self</span>.queue[minChild] &gt; <span class="keyword">self</span>.queue[rightChild] &#123;</span><br><span class="line">        minChild = rightChild</span><br><span class="line">      &#125;</span><br><span class="line">      </span><br><span class="line">      <span class="keyword">if</span> <span class="keyword">self</span>.queue[parent] &gt; <span class="keyword">self</span>.queue[minChild] &#123;</span><br><span class="line">        <span class="keyword">self</span>.<span class="built_in">swap</span>(parent, with: minChild)</span><br><span class="line">        parent = minChild</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   äº¤æ¢å­˜å‚¨ä¸­ä½äºä¸¤å¤„ç´¢å¼•å€¼ä½ç½®çš„å…ƒç´ ã€‚</span></span><br><span class="line"><span class="comment">   - å‚æ•° firstIndexï¼šç¬¬ä¸€ä¸ªè¦äº¤æ¢å…ƒç´ çš„ç´¢å¼•ã€‚</span></span><br><span class="line"><span class="comment">   - å‚æ•° secondIndexï¼šç¬¬äºŒä¸ªè¦äº¤æ¢å…ƒç´ çš„ç´¢å¼•ã€‚</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">swap</span><span class="params">(<span class="number">_</span> firstIndex: Int, with secondIndex: Int)</span></span> &#123;</span><br><span class="line">    <span class="keyword">let</span> firstItem = <span class="keyword">self</span>.queue[firstIndex]</span><br><span class="line">    <span class="keyword">self</span>.queue[firstIndex] = <span class="keyword">self</span>.queue[secondIndex]</span><br><span class="line">    <span class="keyword">self</span>.queue[secondIndex] = firstItem</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„å†…å®¹æœ‰ç‚¹å¤šï¼Œä½ ä¹Ÿè®¸ä¼šæƒ³å¤šè¯»ä¸Šä¸€ä¸¤æ¬¡ã€‚å…¶ä¸­ï¼Œæœ€ä¸Šé¢æ˜¯æˆ‘ä»¬å…ˆå‰åœ¨åè®®ä¸­æ‰€å®šä¹‰å¥½çš„æ‰€æœ‰æ–¹æ³•ï¼Œä¸‹é¢åˆ™æ˜¯ä¸€äº›ç§æœ‰çš„ï¼Œä»…åœ¨æ­¤ç±»ä¸­å¯ç”¨çš„è¾…åŠ©æ–¹æ³•ã€‚æˆ‘å·²ç»ä¸ºè¿™äº›è¾…åŠ©æ–¹æ³•åŠ ä¸Šäº†æ³¨é‡Šï¼Œä»¥ä¾¿ä½ èƒ½å¿«é€Ÿçš„äº†è§£åˆ°å®ƒä»¬æ˜¯ç”¨æ¥åšä»€ä¹ˆçš„ã€‚æ­¤å¤–ï¼Œè®°å¾—å…³æ³¨ä¸€ä¸‹å…ˆå‰å¯¹ Int çš„æ‰©å±•åœ¨è¿™é‡Œæ˜¯å¦‚ä½•è¢«ä½¿ç”¨çš„ã€‚ä¾æˆ‘çœ‹æ¥ï¼Œè¿™æ˜¯éå¸¸ç®€æ´å®ç”¨çš„è®¾è®¡ã€‚</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>ç°åœ¨ï¼Œæˆ‘ä»¬å·²ç»å®Œæˆäº†æ‰€æœ‰ PriorityQueue æ‰€éœ€è¦çš„åŠŸèƒ½ã€‚ç°åœ¨æˆ‘ä»¬å°†æ·»åŠ å¯¹ CustomStringConvertible åè®®çš„å®ç°ï¼Œä»¥ä¾¿åœ¨å‘ print å‡½æ•°ä¼ å…¥ä¸€ä¸ªé˜Ÿåˆ—åèƒ½å¾—åˆ°ä¸€äº›å¯é˜…è¯»çš„å†…å®¹:</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">PriorityQueue</span>: <span class="title">CustomStringConvertible</span> </span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">var</span> description: <span class="type">String</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>.queue.description</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>èµ!</p><p>ä¸Šè¿°å°±æ˜¯è¿™æ¬¡çš„å…¨éƒ¨å†…å®¹äº†ã€‚ç°åœ¨ä½ å·²ç»çŸ¥é“äº†å¦‚ä½•å»å®ç°ä¸€ä¸ªåŸºäºå †æ•°æ®ç»“æ„çš„ä¼˜å…ˆçº§é˜Ÿåˆ—ã€‚å¦‚æœæœ‰ä»»ä½•ç–‘é—®ï¼Œæ¬¢è¿å‘è¡¨è¯„è®ºã€‚</p><p>è¦äº†è§£ iOS å¼€å‘çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹æˆ‘ä¹‹å‰çš„æ–‡ç« :<br><a href="https://medium.com/swlh/introduction-to-protocol-oriented-programming-1ff3862f9a3c" target="_blank" rel="noopener">Introduction To Protocol Oriented Programming</a><br><a href="https://medium.com/@JimmyMAndersson/using-swift-extensions-to-clean-up-our-code-1aed32da24bc" target="_blank" rel="noopener">Using Swift Extensions To Clean Up Our Code</a></p><blockquote><p>æœ¬æ–‡ç”± SwiftGG ç¿»è¯‘ç»„ç¿»è¯‘ï¼Œå·²ç»è·å¾—ä½œè€…ç¿»è¯‘æˆæƒï¼Œæœ€æ–°æ–‡ç« è¯·è®¿é—® <a href="http://swift.gg">http://swift.gg</a>ã€‚</p></blockquote>]]></content>
    
    <summary type="html">
    
      æœ¬æ–‡è§£é‡Šäº†ä¼˜å…ˆçº§é˜Ÿåˆ—ã€å †ç­‰ç›¸å…³æ¦‚å¿µï¼Œå¹¶å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ Swift å®ç°åŸºäºå †çš„ä¼˜å…ˆçº§é˜Ÿåˆ—ã€‚
    
    </summary>
    
      <category term="AppCoda" scheme="https://swift.gg/categories/AppCoda/"/>
    
      <category term="iOS" scheme="https://swift.gg/categories/AppCoda/iOS/"/>
    
    
      <category term="Swift" scheme="https://swift.gg/tags/Swift/"/>
    
      <category term="Algorithm" scheme="https://swift.gg/tags/Algorithm/"/>
    
      <category term="Data Structure" scheme="https://swift.gg/tags/Data-Structure/"/>
    
      <category term="Priority Queue" scheme="https://swift.gg/tags/Priority-Queue/"/>
    
  </entry>
  
  <entry>
    <title>Swift 5 å­—ç¬¦ä¸²æ’å€¼-ç®€ä»‹</title>
    <link href="https://swift.gg/2019/04/22/swift5-stringinterpolation-part1/"/>
    <id>https://swift.gg/2019/04/22/swift5-stringinterpolation-part1/</id>
    <published>2019-04-22T00:00:00.000Z</published>
    <updated>2019-08-14T12:15:53.980Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ä½œè€…ï¼šOlivier Halligonï¼Œ<a href="http://alisoftware.github.io/swift/2018/12/15/swift5-stringinterpolation-part1/" target="_blank" rel="noopener">åŸæ–‡é“¾æ¥</a>ï¼ŒåŸæ–‡æ—¥æœŸï¼š2018-12-15<br>è¯‘è€…ï¼š<a href="https://nemocdz.github.io/" target="_blank" rel="noopener">Nemocdz</a>ï¼›æ ¡å¯¹ï¼š<a href="http://numbbbbb.com/" target="_blank" rel="noopener">numbbbbb</a>ï¼Œ<a href="http://blog.yousanflics.com.cn" target="_blank" rel="noopener">Yousanflics</a>ï¼›å®šç¨¿ï¼š<a href="http://forelax.space" target="_blank" rel="noopener">Forelax</a></p></blockquote> <!--æ­¤å¤„å¼€å§‹æ­£æ–‡--><p> <code>StringInterpolation</code> åè®®æœ€åˆçš„è®¾è®¡æ•ˆç‡ä½ä¸‹åˆä¸æ˜“æ‰©å±•ï¼Œä¸ºäº†åœ¨åç»­çš„ç‰ˆæœ¬ä¸­èƒ½å¤Ÿå°†å…¶å½»åº•é‡æ„ï¼ŒSwift 4 ä¸­å°†è¯¥åè®®æ ‡è®°ä¸ºåºŸå¼ƒã€‚å³å°†åœ¨ Swift 5 ä¸­äº®ç›¸çš„ <a href="https://github.com/apple/swift-evolution/blob/master/proposals/0228-fix-expressiblebystringinterpolation.md" target="_blank" rel="noopener">SE-0228</a> ææ¡ˆä»‹ç»äº†ä¸€ç§æ–°çš„ <code>StringInterpolation</code> è®¾è®¡ï¼Œä½¿å¾— String æœ‰äº†æ›´å¤§çš„æ½œèƒ½ã€‚</p> <a id="more"></a><p> åœ¨ Swift çš„ <code>master</code> åˆ†æ”¯é‡Œå®ç°ä¹‹åï¼Œå°±å¯ä»¥ä¸‹è½½ä¸€ä¸ª <a href="https://swift.org/download/#snapshots" target="_blank" rel="noopener">å¿«ç…§</a> æ¥å®‰è£…æœ€æ–°çš„ Swift 5 å·¥å…·é“¾åˆ° Xcode ä¸­ï¼Œæ¥å°è¯•å…¨æ–°çš„ <code>StringInterpolation</code>ã€‚è®©æˆ‘ä»¬æ¥æŠŠç©ä¸€ä¸‹ã€‚</p><h2 id="å…¨æ–°çš„-StringInterpolation-è®¾è®¡"><a href="#å…¨æ–°çš„-StringInterpolation-è®¾è®¡" class="headerlink" title="å…¨æ–°çš„ StringInterpolation è®¾è®¡"></a>å…¨æ–°çš„ StringInterpolation è®¾è®¡</h2><p> æˆ‘å¼ºçƒˆå»ºè®®æœ¬ç¯‡æ–‡ç« çš„è¯»è€…é˜…è¯»ä¸€ä¸‹ <a href="https://github.com/apple/swift-evolution/blob/master/proposals/0228-fix-expressiblebystringinterpolation.md" target="_blank" rel="noopener">SE-0228</a> ææ¡ˆï¼Œæ„Ÿå—ä¸€ä¸‹æ–° API çš„èƒŒåçš„è®¾è®¡æ€è·¯å’ŒåŠ¨æœºã€‚</p><p> è¦è®©ä¸€ä¸ªç±»å‹éµå¾ª <code>ExpressibleByStringInterpolation</code>ï¼Œæœ€åŸºæœ¬çš„ä½ éœ€è¦ï¼š</p><ul><li>è®©è¿™ä¸ªç±»å‹æ‹¥æœ‰ä¸€ä¸ªç±»å‹ä¸º <code>StringInterpolation</code> çš„å­ç±»å‹ï¼Œè¿™ä¸ªå­ç±»å‹éµå¾ª <code>StringInterpolationProtocol</code> å¹¶å°†è´Ÿè´£è§£é‡Šæ’å€¼</li><li>è¿™ä¸ªå­ç±»å‹ä»…éœ€è¦å®ç° <code>appendLiteral(_ literal: String)</code> æ–¹æ³•ï¼Œå†é€‰æ‹©ä¸€ä¸ªæˆ–å¤šä¸ªä½ è‡ªå·±æƒ³è¦æ”¯æŒçš„ <code>appendInterpolation(...)</code> ç­¾åçš„æ–¹æ³•</li><li>è¿™ä¸ª <code>StringInterpolation</code> å­ç±»å‹ä¼šä½œä¸ºâ€œæ„é€ å™¨â€æœåŠ¡äºä½ çš„ä¸»ç±»å‹ï¼Œç„¶åç¼–è¯‘å™¨ä¼šè°ƒç”¨é‚£äº› <code>appendâ€¦</code> æ–¹æ³•ä¸€æ­¥ä¸€æ­¥åœ°æ„é€ å¯¹è±¡</li><li>ç„¶åä½ çš„ä¸»ç±»å‹éœ€è¦å®ç° <code>init(stringInterpolation: StringInterpolation)</code> ï¼Œå®ƒä¼šç”¨ä¸Šä¸€æ­¥çš„ç»“æœæ¥å®ä¾‹åŒ–å®ƒè‡ªå·±ã€‚</li></ul><p>ä½ å¯ä»¥å®ç°ä»»ä½•ä½ å–œæ¬¢çš„ <code>appenInterpolation(...)</code> æ–¹æ³•ï¼Œè¿™æ„å‘³ç€ä½ å¯ä»¥ä»»æ„é€‰æ‹©æ”¯æŒä»€ä¹ˆæ’å€¼ã€‚è¿™æ˜¯ä¸€ä¸ªå¸¦æ¥å·¨å¤§çš„å¯èƒ½æ€§çš„è¶…å¼ºåŠŸèƒ½ã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœä½ å®ç°äº† <code>func appendInterpolation(_ string: String, pad: Int)</code>ï¼Œé‚£ä¹ˆæ„å‘³ç€ä½ å°†å¯ä»¥ç”¨ç±»ä¼¼è¿™æ ·çš„æ’å€¼ï¼š<code>&quot;Hello \(name, pad: 10), how are you?&quot;</code> æ¥æ„é€ ä½ çš„ç±»å‹ã€‚æ’å€¼åªéœ€è¦åŒ¹é…ä½ çš„ <code>StringInterpolation</code> å­ç±»å‹å…¶ä¸­ä¸€ä¸ªæ”¯æŒçš„ <code>appendInterpolation</code> æ–¹æ³•ç­¾åã€‚</p><h2 id="ä¸€ä¸ªç®€å•çš„ä¾‹å­"><a href="#ä¸€ä¸ªç®€å•çš„ä¾‹å­" class="headerlink" title="ä¸€ä¸ªç®€å•çš„ä¾‹å­"></a>ä¸€ä¸ªç®€å•çš„ä¾‹å­</h2><p>è®©æˆ‘ç”¨ä¸€ä¸ªç®€å•çš„ä¾‹å­æ¥æ¼”ç¤ºä¸€ä¸‹æ’å€¼æ˜¯å¦‚ä½•è¿ä½œçš„ã€‚ä¸€èµ·æ¥æ„é€ ä¸€ä¸ªå…è®¸å¼•ç”¨ issue ç¼–å·å’Œç”¨æˆ·çš„ <code>GitHubComment</code> ç±»å‹å§ã€‚</p><p>è¿™ä¸ªä¾‹å­çš„ç›®æ ‡æ˜¯åšåˆ°ç±»ä¼¼ä¸‹é¢çš„å†™æ³•ï¼š</p> <figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> comment: <span class="type">GitHubComment</span> = <span class="string">"""</span></span><br><span class="line"><span class="string">  See \(issue: 123) where \(user: "alisoftware") explains the steps to reproduce.</span></span><br><span class="line"><span class="string">  """</span></span><br></pre></td></tr></table></figure><p>æ‰€ä»¥æˆ‘ä»¬è¯¥æ€ä¹ˆå®ç°å®ƒå‘¢ï¼Ÿ</p><p>é¦–å…ˆï¼Œè®©æˆ‘ä»¬å£°æ˜åŸºæœ¬çš„ç»“æ„ä½“ <code>struct GitHubComment</code> å¹¶è®©å®ƒéµå¾ª <code>ExpressibleByStringLiteral</code>ï¼ˆå› ä¸º <code>ExpressibleByStringInterpolation</code> ç»§æ‰¿è‡ªè¿™ä¸ªåè®®æ‰€ä»¥æˆ‘ä»¬å°†å®ƒçš„å®ç°æŠ½ç¦»ï¼‰å’Œ <code>CustomStringConvertible</code>ï¼ˆä¸ºäº† debug æ—¶å‹å¥½åœ°åœ¨æ§åˆ¶å°ä¸­æ‰“å°ï¼‰ã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">GitHubComment</span> </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> markdown: <span class="type">String</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">GitHubComment</span>: <span class="title">ExpressibleByStringLiteral</span> </span>&#123;</span><br><span class="line">  <span class="keyword">init</span>(stringLiteral value: <span class="type">String</span>) &#123;</span><br><span class="line">    <span class="keyword">self</span>.markdown = value</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">GitHubComment</span>: <span class="title">CustomStringConvertible</span> </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> description: <span class="type">String</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>.markdown</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åï¼Œæˆ‘ä»¬è®© <code>GitHubComment</code> éµå¾ª <code>ExpressibleByStringInterpolation</code>ã€‚è¿™æ„å‘³ç€åœ¨å‰©ä¸‹éœ€è¦å®ç°çš„åŠŸèƒ½ï¼Œå°†ç”±ä¸€ä¸ª <code>StringInterpolation</code> å­ç±»å‹æ¥å®Œæˆï¼š</p><ul><li><p>é¦–å…ˆåˆå§‹åŒ–å®ƒè‡ªå·±ï¼š<code>init(literalCapacity: Int, interpolationCount: Int)</code> æä¾›ç»™ä½ ä¿ç•™ä¸€éƒ¨åˆ†æ•°æ®åˆ°ç¼“å†²åŒºçš„èƒ½åŠ›ï¼Œåœ¨ä¸€æ­¥æ­¥æ„é€ ç±»å‹æ—¶å°±ä¼šç”¨åˆ°è¿™ä¸ªèƒ½åŠ›ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æ„é€ å®ä¾‹çš„æ—¶å€™ï¼Œç®€å•ç”¨ä¸€ä¸ª <code>String</code> å¹¶å¾€å®ƒä¸Šé¢è¿½åŠ ç‰‡æ®µï¼Œä¸è¿‡è¿™é‡Œæˆ‘é‡‡ç”¨ä¸€ä¸ª <code>parts: [String]</code> æ¥ä»£æ›¿ï¼Œä¹‹åå†å°†å®ƒç»„åˆèµ·æ¥</p></li><li><p>å®ç° <code>appendLiteral(_ string: String)</code> é€ä¸ªè¿½åŠ æ–‡æœ¬åˆ° <code>parts</code> é‡Œ</p></li><li><p>å®ç° <code>appendInterpolation(user: String)</code> åœ¨é‡åˆ° <code>\(user: xxx)</code> æ—¶é€ä¸ªè¿½åŠ  markdown è¡¨ç¤ºçš„ç”¨æˆ·é…ç½®é“¾æ¥</p></li><li><p>å®ç° <code>appendInterpolation(issue: Int)</code> é€ä¸ªè¿½åŠ ç”¨ markdown è¡¨ç¤ºçš„ issue é“¾æ¥</p></li><li><p>ç„¶ååœ¨ <code>GitHubComment</code> ä¸Šå®ç° <code>init(stringInterpolation: StringInterpolation)</code> å°† <code>parts</code> æ„é€ æˆä¸€ä¸ªè¯„è®º</p></li></ul><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">GitHubComment</span>: <span class="title">ExpressibleByStringInterpolation</span> </span>&#123;</span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">StringInterpolation</span>: <span class="title">StringInterpolationProtocol</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> parts: [<span class="type">String</span>]</span><br><span class="line">      <span class="keyword">init</span>(literalCapacity: <span class="type">Int</span>, interpolationCount: <span class="type">Int</span>) &#123;</span><br><span class="line">      <span class="keyword">self</span>.parts = []</span><br><span class="line">      <span class="comment">// - literalCapacity æ–‡æœ¬ç‰‡æ®µçš„å­—ç¬¦æ•° (L)</span></span><br><span class="line">      <span class="comment">// - interpolationCount æ’å€¼ç‰‡æ®µæ•° (I)</span></span><br><span class="line">      <span class="comment">// æˆ‘ä»¬é¢„è®¡é€šå¸¸ç»“æ„ä¼šæ˜¯åƒ "LILILIL"</span></span><br><span class="line">      <span class="comment">// â€” e.g. "Hello \(world, .color(.blue))!" â€” å› æ­¤æ˜¯ 2n+1</span></span><br><span class="line">      <span class="keyword">self</span>.parts.reserveCapacity(<span class="number">2</span>*interpolationCount+<span class="number">1</span>)</span><br><span class="line">    &#125;</span><br><span class="line">      <span class="keyword">mutating</span> <span class="function"><span class="keyword">func</span> <span class="title">appendLiteral</span><span class="params">(<span class="number">_</span> literal: String)</span></span> &#123;</span><br><span class="line">      <span class="keyword">self</span>.parts.append(literal)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">mutating</span> <span class="function"><span class="keyword">func</span> <span class="title">appendInterpolation</span><span class="params">(user name: String)</span></span> &#123;</span><br><span class="line">      <span class="keyword">self</span>.parts.append(<span class="string">"[\(name)](https://github.com/\(name))"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">mutating</span> <span class="function"><span class="keyword">func</span> <span class="title">appendInterpolation</span><span class="params">(issue number: Int)</span></span> &#123;</span><br><span class="line">      <span class="keyword">self</span>.parts.append(<span class="string">"[#\(number)](issues/\(number))"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">init</span>(stringInterpolation: <span class="type">StringInterpolation</span>) &#123;</span><br><span class="line">    <span class="keyword">self</span>.markdown = stringInterpolation.parts.joined()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™å°±å®Œäº‹äº†ï¼æˆ‘ä»¬æˆåŠŸäº†ï¼</p><p>æ³¨æ„ï¼Œå› ä¸ºé‚£äº›æˆ‘ä»¬å®ç°äº†çš„ <code>appendInterpolation</code> æ–¹æ³•ç­¾åï¼Œæˆ‘ä»¬å…è®¸ä½¿ç”¨ <code>Hello \(user: &quot;alisoftware&quot;)</code> ä½†ä¸èƒ½ä½¿ç”¨ <code>Hello \(user: 123)</code>ï¼Œå› ä¸º <code>appendInterpolation(user:)</code> æœŸæœ›ä¸€ä¸ª <code>String</code> ä½œä¸ºå½¢å‚ã€‚ç±»ä¼¼çš„æ˜¯ï¼Œåœ¨ä½ çš„å­—ç¬¦ä¸²ä¸­ <code>\(issue: 123)</code> åªèƒ½å…è®¸ä¸€ä¸ª <code>Int</code> å› ä¸º <code>appendInterpolation(issue:)</code> é‡‡ç”¨ä¸€ä¸ª <code>Int</code> ä½œä¸ºå½¢å‚ã€‚</p><p>å®é™…ä¸Šï¼Œå¦‚æœä½ å°è¯•åœ¨ä½ çš„ <code>StringInterpolation</code> å­ç±»ä¸­ç”¨ä¸æ”¯æŒçš„æ’å€¼ï¼Œç¼–è¯‘å™¨ä¼šç»™ä½ æç¤ºæŠ¥é”™ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> comment: <span class="type">GitHubComment</span> = <span class="string">"""</span></span><br><span class="line"><span class="string">See \(issue: "bob") where \(username: "alisoftware") explains the steps to reproduce.</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="comment">//             ^~~~~         ^~~~~~~~~</span></span><br><span class="line"><span class="comment">// é”™è¯¯: æ— æ³•è½¬æ¢ â€˜Stringâ€™ ç±»å‹çš„å€¼åˆ°æœŸæœ›çš„å½¢å‚ç±»å‹ â€˜Intâ€™</span></span><br><span class="line"><span class="comment">// é”™è¯¯: è°ƒç”¨ (have 'username:', expected 'user:')å®å‚æ ‡ç­¾ä¸æ­£ç¡®</span></span><br></pre></td></tr></table></figure><h2 id="è¿™ä»…ä»…åªæ˜¯ä¸ªå¼€å§‹"><a href="#è¿™ä»…ä»…åªæ˜¯ä¸ªå¼€å§‹" class="headerlink" title="è¿™ä»…ä»…åªæ˜¯ä¸ªå¼€å§‹"></a>è¿™ä»…ä»…åªæ˜¯ä¸ªå¼€å§‹</h2><p>è¿™ä¸ªæ–°çš„è®¾è®¡æ‰“å¼€äº†ä¸€å¤§ä¸²è„‘æ´è®©ä½ å»å®ç°è‡ªå·±çš„ <code>ExpressibleByStringInterpolation</code> ç±»å‹ã€‚è¿™äº›æƒ³æ³•åŒ…æ‹¬ï¼š</p><ul><li>åˆ›å»ºä¸€ä¸ª <code>HTML</code> ç±»å‹å¹¶éµå¾ªï¼Œä½ å°±å¯ä»¥ç”¨æ’å€¼å†™ HTML </li><li>åˆ›å»ºä¸€ä¸ª <code>SQLStatement</code> ç±»å‹å¹¶éµå¾ªï¼Œä½ å°±å¯ä»¥å†™æ›´ç®€å•çš„ SQL è¯­å¥</li><li>ç”¨å­—ç¬¦ä¸²æ’å€¼æ”¯æŒæ›´å¤šè‡ªå®šä¹‰æ ¼å¼ï¼Œæ¯”å¦‚åœ¨ä½ çš„æ’å€¼å­—ç¬¦ä¸²ä¸­ç”¨æ ¼å¼åŒ– <code>Double</code> æˆ–è€… <code>Date</code> å€¼</li><li>åˆ›å»ºä¸€ä¸ª <code>RegEX</code> ç±»å‹å¹¶éµå¾ªï¼Œä½ å°±å¯ä»¥ç”¨èŠ±é‡Œèƒ¡å“¨çš„è¯­æ³•å†™æ­£åˆ™è¡¨è¾¾å¼</li><li>åˆ›å»ºä¸€ä¸ª <code>AttributedString</code> ç±»å‹å¹¶éµå¾ªï¼Œå°±å¯ä»¥ç”¨å­—ç¬¦ä¸²æ’å€¼æ„å»º <code>NSAttributedString</code> </li></ul><p>å¸¦æ¥æ–°çš„å­—ç¬¦ä¸²æ’å€¼è®¾è®¡çš„ <a href="https://github.com/brentdax" target="_blank" rel="noopener">Brent Royal-Gordon</a> å’Œ <a href="https://github.com/milseman" target="_blank" rel="noopener">Michael Ilseman</a>ï¼Œæä¾›äº†æ›´å¤šä¾‹å­åœ¨è¿™ä¸ª <a href="https://gist.github.com/brentdax/0b46ce25b7da1049e61b4669352094b6" target="_blank" rel="noopener">è¦ç‚¹åˆ—è¡¨</a> ä¸­ã€‚</p><p>æˆ‘ä¸ªäººå°è¯•äº†ä¸€ä¸‹æ”¯æŒ <code>NSAttributedString</code> çš„å®ç°ï¼Œå¹¶æƒ³ <a href="http://alisoftware.github.io/swift/2018/12/16/swift5-stringinterpolation-part2/" target="_blank" rel="noopener">åœ¨ä¸“é—¨çš„ä¸€ç¯‡æ–‡ç« é‡Œåˆ†äº«å®ƒçš„åˆæ­¥å®ç°</a>ï¼Œå› ä¸ºæˆ‘å‘ç°å®ƒéå¸¸ä¼˜é›…ã€‚æˆ‘ä»¬ä¸‹ä¸€ç¯‡æ–‡ç« å†è§ï¼</p><blockquote><p>æœ¬æ–‡ç”± SwiftGG ç¿»è¯‘ç»„ç¿»è¯‘ï¼Œå·²ç»è·å¾—ä½œè€…ç¿»è¯‘æˆæƒï¼Œæœ€æ–°æ–‡ç« è¯·è®¿é—® <a href="http://swift.gg">http://swift.gg</a>ã€‚</p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;ä½œè€…ï¼šOlivier Halligonï¼Œ&lt;a href=&quot;http://alisoftware.github.io/swift/2018/12/15/swift5-stringinterpolation-part1/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;åŸæ–‡é“¾æ¥&lt;/a&gt;ï¼ŒåŸæ–‡æ—¥æœŸï¼š2018-12-15&lt;br&gt;è¯‘è€…ï¼š&lt;a href=&quot;https://nemocdz.github.io/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Nemocdz&lt;/a&gt;ï¼›æ ¡å¯¹ï¼š&lt;a href=&quot;http://numbbbbb.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;numbbbbb&lt;/a&gt;ï¼Œ&lt;a href=&quot;http://blog.yousanflics.com.cn&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Yousanflics&lt;/a&gt;ï¼›å®šç¨¿ï¼š&lt;a href=&quot;http://forelax.space&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Forelax&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
 &lt;!--æ­¤å¤„å¼€å§‹æ­£æ–‡--&gt;
&lt;p&gt; &lt;code&gt;StringInterpolation&lt;/code&gt; åè®®æœ€åˆçš„è®¾è®¡æ•ˆç‡ä½ä¸‹åˆä¸æ˜“æ‰©å±•ï¼Œä¸ºäº†åœ¨åç»­çš„ç‰ˆæœ¬ä¸­èƒ½å¤Ÿå°†å…¶å½»åº•é‡æ„ï¼ŒSwift 4 ä¸­å°†è¯¥åè®®æ ‡è®°ä¸ºåºŸå¼ƒã€‚å³å°†åœ¨ Swift 5 ä¸­äº®ç›¸çš„ &lt;a href=&quot;https://github.com/apple/swift-evolution/blob/master/proposals/0228-fix-expressiblebystringinterpolation.md&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;SE-0228&lt;/a&gt; ææ¡ˆä»‹ç»äº†ä¸€ç§æ–°çš„ &lt;code&gt;StringInterpolation&lt;/code&gt; è®¾è®¡ï¼Œä½¿å¾— String æœ‰äº†æ›´å¤§çš„æ½œèƒ½ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="Crunchy Development" scheme="https://swift.gg/categories/Crunchy-Development/"/>
    
    
      <category term="Swift è¿›é˜¶" scheme="https://swift.gg/tags/Swift-%E8%BF%9B%E9%98%B6/"/>
    
      <category term="Swift" scheme="https://swift.gg/tags/Swift/"/>
    
  </entry>
  
  <entry>
    <title>åœ¨ iOS 11 ä¸­ä½¿ç”¨ Core Bluetooth</title>
    <link href="https://swift.gg/2019/04/15/core-bluetooth/"/>
    <id>https://swift.gg/2019/04/15/core-bluetooth/</id>
    <published>2019-04-15T00:00:00.000Z</published>
    <updated>2019-08-14T12:15:53.980Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ä½œè€…ï¼šAndrew Jaffeeï¼Œ<a href="https://appcoda.com/core-bluetooth/" target="_blank" rel="noopener">åŸæ–‡é“¾æ¥</a>ï¼ŒåŸæ–‡æ—¥æœŸï¼š2018-04-17<br>è¯‘è€…ï¼š<a href="https://github.com/dzyding" target="_blank" rel="noopener">ç°s</a>ï¼›æ ¡å¯¹ï¼š<a href="https://github.com/Cee" target="_blank" rel="noopener">Cee</a>ï¼Œ<a href="http://numbbbbb.com/" target="_blank" rel="noopener">numbbbbb</a>ï¼›å®šç¨¿ï¼š<a href="http://forelax.space" target="_blank" rel="noopener">Forelax</a></p></blockquote><!--æ­¤å¤„å¼€å§‹æ­£æ–‡--><p>ä½œä¸º iOS å¼€å‘ï¼Œæˆ‘ä»¬ååˆ†æ¸…æ¥šäººä»¬éƒ½å–œæ¬¢äº’é€šæ€§ã€‚æˆ‘ä»¬å–œæ¬¢é€šè¿‡æ— çº¿è®¾å¤‡ä¸å…¶ä»–äººè¿›è¡Œæ²Ÿé€šè¿™ä¸€ç‚¹æ˜¯æ˜¾è€Œæ˜“è§çš„ã€‚æœ€è¿‘ï¼Œæˆ‘ä»¬å¼€å§‹å¸Œæœ›èƒ½å¤Ÿä¸é‚£äº›æ›¾ç»è¢«è®¤ä¸ºæ˜¯ç‹¬ç«‹çš„æ™®é€šè®¾å¤‡è¿›è¡Œ<em>é€šä¿¡</em>ã€‚æˆ‘ä»¬å¼€å§‹å–œæ¬¢ï¼Œç”šè‡³æ˜¯æœŸæœ›ï¼Œéƒ¨åˆ†æ— çº¿è®¾å¤‡å¯ä»¥æ”¶é›†å¹¶ä¸”åˆ†æè‡ªå·±çš„æ•°æ®ï¼ˆé€šå¸¸ç§°ä¸ºâ€œå¯ç©¿æˆ´è®¾å¤‡â€ï¼‰ã€‚è®¸å¤šè®¾å¤‡å·²ç»æˆä¸ºæˆ‘ä»¬ç”Ÿæ´»é‡Œçš„ä¸€éƒ¨åˆ†ï¼Œè¿˜ä¸ºè¿˜æœ‰ä¸€ä¸ªä¸“é—¨çš„æœ¯è¯­æ¥æè¿°å®ƒï¼šâ€œInternet of Thingsâ€ æˆ–è€… â€œIoTâ€ï¼ˆç‰©è”ç½‘ï¼‰ã€‚ç°åœ¨åœ°çƒä¸Šæœ‰æ•°åäº¿çš„æ— çº¿é€šè®¯è®¾å¤‡ã€‚åœ¨è¿™ç¯‡æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†èšç„¦ IoT å…¶ä¸­çš„ä¸€éƒ¨åˆ†ï¼šè“ç‰™ã€‚  </p><p>æˆ‘å°†è¯´æ˜è“ç‰™æŠ€æœ¯èƒŒåçš„åŸºæœ¬æ¦‚å¿µï¼Œä»¥åŠï¼š  </p><ul><li>å±•ç¤ºå¦‚ä½•ç²¾é€šè“ç‰™æ–¹å‘çš„è½¯ä»¶å¼€å‘ï¼Œä»è€Œä¸ºä½ æä¾›å·¨å¤§çš„èŒä¸šæœºé‡  </li><li>æé†’ä½ å¿…é¡»å»ç¡®è®¤åœ¨å‘å¸ƒä¸€ä¸ªä½¿ç”¨è“ç‰™æŠ€æœ¯çš„åº”ç”¨æ—¶æ˜¯å¦éœ€è¦é€šè¿‡â€œèµ„æ ¼å®¡æŸ¥â€  </li><li>ç»™ä½ æä¾› Apple çš„<a href="https://developer.apple.com/documentation/corebluetooth" target="_blank" rel="noopener"><strong><em>Core Bluetooth</em></strong></a> æ¡†æ¶æ¦‚è¿° (<a href="https://developer.apple.com/library/archive/documentation/NetworkingInternetWeb/Conceptual/CoreBluetooth_concepts/AboutCoreBluetooth/Introduction.html#//apple_ref/doc/uid/TP40013257-CH1-SW1" target="_blank" rel="noopener"><strong>ä¹Ÿå¯ä»¥å‚é˜…è¿™é‡Œ</strong></a>)  </li><li>æœ€åï¼Œå¸¦é¢†ä½ ä½¿ç”¨ Swift 4 å¹¶é€šè¿‡ <em>Core Bluetooth</em> å’Œä¸€ä¸ªè“ç‰™è®¾å¤‡æ¥å¼€å‘ä¸€æ¬¾ç”¨äºç›‘æ§å¿ƒç‡çš„ iOS åº”ç”¨ç¨‹åº</li></ul><blockquote><p>æç¤ºï¼šæ³¨æ„è·Ÿéšé˜…è¯»æ–‡ç« ä¸­åŒ…å«çš„è¶…é“¾æ¥ã€‚å¯¹äºå¼€å‘è€…è¿™æ˜¯é‡è¦çš„èµ„æ–™ï¼Œå®ƒç¡®ä¿ä½ å®Œå…¨ç†è§£è“ç‰™çš„å·¥ä½œæ–¹å¼ä»¥åŠè‹¹æœæ˜¯å¦‚ä½•æ”¯æŒè“ç‰™è¿™ç§æŠ€æœ¯çš„ã€‚</p></blockquote><a id="more"></a><h2 id="è“ç‰™-ä¸€é¡¹è¿…é€Ÿå‘å±•çš„æŠ€æœ¯"><a href="#è“ç‰™-ä¸€é¡¹è¿…é€Ÿå‘å±•çš„æŠ€æœ¯" class="headerlink" title="è“ç‰™ - ä¸€é¡¹è¿…é€Ÿå‘å±•çš„æŠ€æœ¯"></a>è“ç‰™ - ä¸€é¡¹è¿…é€Ÿå‘å±•çš„æŠ€æœ¯</h2><p>åœ¨ä¸€ç¯‡æ–‡ç« ä¸­ä¸å¯èƒ½è¯´æ¸…æ¥šå¦‚ä½•ä¸ºæ•´ä¸ªç‰©è”ç½‘å¼€å‘è½¯ä»¶ï¼Œä½†å®é™…ä¸Šï¼Œå¯¹æ‰€æœ‰è¿™äº›æ— çº¿è®¾å¤‡è¿›è¡Œæ•°æ®åˆ†ææ˜¯å¾ˆæœ‰å¯å‘æ€§çš„ - å®é™…ä¸Šæ˜¯å¾ˆä¸å¯æ€è®®çš„ã€‚è¿æ¥ç€çš„ä¸œè¥¿æ— å¤„ä¸åœ¨å¹¶ä¸”å¯ä»¥é¢„æµ‹è¿™ä¸ªå°ä¸œè¥¿çš„å¢é•¿é€Ÿåº¦å°†æ˜¯æƒŠäººçš„ã€‚å¦‚æœä½ è§‚å¯Ÿä¸€ä¸‹æˆ‘ä»¬ä»Šå¤©è®¨è®ºçš„å†…å®¹ï¼Œåœ¨â€œçŸ­ç¨‹æ®µâ€ä¸­ï¼Œä½¿ç”¨å¦‚è“ç‰™å’Œæ— çº¿ç½‘çš„æŠ€æœ¯ï¼Œç„¶åæ·»åŠ ä¸Šâ€œå¹¿åŸŸç±»åˆ«â€ä¸­ï¼Œä½¿ç”¨å¦‚ç”µè¯çš„æŠ€æœ¯ï¼ˆæ¯”å¦‚: CDMAï¼‰ï¼Œ<a href="https://www.ericsson.com/en/mobility-report/internet-of-things-forecast" target="_blank" rel="noopener"><strong>ä½ å°†çœ‹åˆ°</strong></a> ~ 2014 å¹´çš„ 125 äº¿è®¾å¤‡è¿…é€Ÿå¢åŠ åˆ° 2022 å¹´é¢„è®¡çš„ 300 äº¿ã€‚  </p><p>è“ç‰™æ˜¯ä¸€ç§çŸ­è·ç¦»æ— çº¿é€šè®¯æŠ€æœ¯çš„æ ‡å‡†åŒ–è§„èŒƒã€‚<a href="https://www.bluetooth.com/zh-cn" target="_blank" rel="noopener"><strong>Bluetooth Special Interest Groupï¼ˆè“ç‰™æŠ€æœ¯è”ç›Ÿï¼‰</strong></a> ç®¡ç†å’Œä¿æŠ¤è¿™ç§çŸ­ç¨‹æ— çº¿æŠ€æœ¯èƒŒåçš„ç ”å‘ã€å‘å±•è¿˜æœ‰çŸ¥è¯†äº§æƒã€‚SIG ç¡®ä¿å…³äºè“ç‰™çš„åˆ¶é€ å•†ï¼Œå¼€å‘è€…å’Œé”€å”®è€…ä»–ä»¬çš„ç¡¬ä»¶å’Œè½¯ä»¶éƒ½æ˜¯åŸºäºæ ‡å‡†åŒ–è§„èŒƒã€‚  </p><p>æ ¹æ® Bluetooth SIG æŠ¥é“ï¼Œ<a href="https://www.bluetooth.com/bluetooth-technology" target="_blank" rel="noopener"><strong>â€œä»Šå¹´æœ‰å°†è¿‘ 40 äº¿å°è®¾å¤‡ä½¿ç”¨è“ç‰™è¿›è¡Œè¿æ¥ã€‚è“ç‰™å°†è¿æ¥æ‰‹æœºã€å¹³æ¿ç”µè„‘ã€ä¸ªäººç”µè„‘ï¼Œè“ç‰™å°†ä¼šå°†æˆ‘ä»¬å½¼æ­¤è¿æ¥ã€‚â€</strong></a>ã€‚ä¸€å®¶å¯¹çŸ­ç¨‹é€šè®¯æŠ€æœ¯è¿›è¡Œæ·±åº¦æŠ•èµ„çš„å…¬å¸ Ellisys å¯¹æ­¤è¡¨ç¤ºè®¤åŒï¼Œå¹¶ <a href="https://globenewswire.com/news-release/2018/02/22/1379920/0/en/Ellisys-Increases-Support-for-Bluetooth-Mesh-Networking-on-Protocol-Solutions.html" target="_blank" rel="noopener"><strong>â€œé¢„ä¼° 2018 å¹´å°†æœ‰è¿‘ 40 äº¿å°æ–°çš„è“ç‰™è®¾å¤‡ä¸Šå¸‚â€</strong></a>ã€‚è¯·è®°ä½ï¼Œ<em>ä»…åœ¨ä»Šå¹´</em>å°±æœ‰ 40 äº¿<em>æ–°</em>è“ç‰™è®¾å¤‡ä¸Šå¸‚ã€‚  </p><p>æ ¹æ®è¿™ä¸ªè¶‹åŠ¿ï¼Œä¸€å®¶æ”¶é›†â€œå¸‚åœºå’Œæ¶ˆè´¹æ•°æ®â€çš„å…¬å¸ Statista è®¤ä¸ºå…¨çƒçš„è“ç‰™è®¾å¤‡ <a href="https://www.statista.com/statistics/283638/installed-base-forecast-bluetooth-enabled-devices-2012-2018/" target="_blank" rel="noopener"><strong>å°†ä» 2012 å¹´çš„ 35 äº¿å¢é•¿åˆ° 2018 å¹´é¢„ä¼°çš„ 100 äº¿</strong></a>ã€‚</p><h2 id="å¯¹äºä½ çš„èŒä¸šç”Ÿæ¶¯ï¼Œè“ç‰™æ„å‘³ç€ä»€ä¹ˆ"><a href="#å¯¹äºä½ çš„èŒä¸šç”Ÿæ¶¯ï¼Œè“ç‰™æ„å‘³ç€ä»€ä¹ˆ" class="headerlink" title="å¯¹äºä½ çš„èŒä¸šç”Ÿæ¶¯ï¼Œè“ç‰™æ„å‘³ç€ä»€ä¹ˆ"></a>å¯¹äºä½ çš„èŒä¸šç”Ÿæ¶¯ï¼Œè“ç‰™æ„å‘³ç€ä»€ä¹ˆ</h2><p>Dogtown Media æœ‰é™è´£ä»»å…¬å¸ï¼Œä¸€å®¶ iOS ç«¯â€œç‰©è”ç½‘è“ç‰™åº”ç”¨â€ç²¾å“å¼€å‘å•†ï¼Œè¯¥å…¬å¸å£°ç§° <a href="http://www.dogtownmedia.com/app-development-services/internet-of-things-bluetooth-app-development/" target="_blank" rel="noopener"><strong>â€œæ ¹æ®éº¦è‚¯é”¡å…¨çƒç ”ç©¶æ‰€ï¼ˆMcKinsey Global Instituteï¼‰çš„ä¸“å®¶é¢„æµ‹ï¼Œåœ¨æœªæ¥ 9 å¹´å†…ï¼Œç‰©è”ç½‘å°†å¯¹å…¨çƒç»æµäº§ç”Ÿè¶…è¿‡ 6 ä¸‡äº¿ç¾å…ƒçš„å½±å“â€</strong></a> ã€‚è¿™å¯¹äºåƒä½ æˆ‘è¿™æ ·çš„ iOS å¼€å‘æ„å‘³ç€ä»€ä¹ˆï¼ŸDogtown è¯´ <a href="http://www.dogtownmedia.com/app-development-services/internet-of-things-bluetooth-app-development/" target="_blank" rel="noopener"><strong>â€œæœªæ¥å‡ å¹´ï¼Œå¯¹é‚£äº›æœ‰è¿œè§çš„åˆåˆ›ä¼ä¸šå’Œåˆ›ä¸šè€…æ¥è¯´ï¼Œå°†æ˜¯ä»¤äººå…´å¥‹çš„ã€å¤šäº§çš„ï¼Œè€Œä¸”éå¸¸æœ‰åˆ©å¯å›¾çš„ã€‚â€</strong></a><br>ç¿»è¯‘ï¼šä½œä¸ºä¸€ä¸ªæœ‰å‰ç»æ€§æˆ–è€…æƒ³åˆ›ä¸šçš„é’å¹´ï¼Œåº”è¯¥å­¦ä¹ ä½¿ç”¨è“ç‰™æ¥è¿›è¡Œåº”ç”¨ç¨‹åºçš„å¼€å‘ï¼Œå› ä¸ºåœ¨è¿™ä¸ªè¿…é€Ÿæ‰©å¤§çš„å¸‚åœºï¼Œä½ çš„ä¸‹ä¸ªä»»åŠ¡æˆ–è€…å²—ä½æœ‰å¾ˆå¤§å¯èƒ½éœ€è¦è¿™ä¸ªæŠ€èƒ½ã€‚  </p><p><strong>å…è´£å£°æ˜</strong>ï¼š  </p><blockquote><ul><li><em>æˆ‘ä¸ Dogtown Media, LLC ä¹‹é—´æ²¡æœ‰ä»»ä½•çš„ä»å±å…³ç³»ã€‚åœ¨æœç´¢åˆ°è¿™ç¯‡æ–‡ç« çš„æœŸé—´ï¼Œæˆ‘å‘ç°äº†è¿™å®¶å…¬å¸çš„ç½‘ç«™ï¼Œçœ‹åˆ°ä»–ä»¬ä¸“é—¨ä»äº‹ iOS ç«¯çš„è“ç‰™å¼€å‘ã€‚</em>  </li><li><em>æˆ‘æ˜¯ Bluetooth SIG çš„ä¸€å â€œAdopterâ€ çº§åˆ«æˆå‘˜ã€‚</em>  </li></ul></blockquote><h2 id="åœ¨æäº¤ä½ ä½¿ç”¨-Core-Bluetooth-å¼€å‘çš„åº”ç”¨ç¨‹åºè¢«å®¡æ ¸ä¹‹å‰"><a href="#åœ¨æäº¤ä½ ä½¿ç”¨-Core-Bluetooth-å¼€å‘çš„åº”ç”¨ç¨‹åºè¢«å®¡æ ¸ä¹‹å‰" class="headerlink" title="åœ¨æäº¤ä½ ä½¿ç”¨ Core Bluetooth å¼€å‘çš„åº”ç”¨ç¨‹åºè¢«å®¡æ ¸ä¹‹å‰"></a>åœ¨æäº¤ä½ ä½¿ç”¨ Core Bluetooth å¼€å‘çš„åº”ç”¨ç¨‹åºè¢«å®¡æ ¸ä¹‹å‰</h2><p>åœ¨è“ç‰™æŠ€æœ¯åˆšå±•éœ²å¤´è§’ä¹‹é™…ï¼Œæˆ‘ç»å¸¸çœ‹åˆ°å¼€å‘è€…ä»¬æ‰¾ä¸€äº›å‚è€ƒèµ„æ–™ï¼Œç„¶åç«‹å³æŠ•å…¥åˆ°æ¶‰åŠæ— çº¿è®¾å¤‡çš„åº”ç”¨å¼€å‘ä¸­ï¼Œå¹¶æäº¤è“ç‰™åº”ç”¨åˆ° Apple çš„ AppStore ä¸­ã€‚æˆ‘æƒ³è¯´ï¼šåˆ«é‚£ä¹ˆå¿«ï¼Œä¼™è®¡ã€‚  </p><p>Bluetooth SIG è§„å®šï¼Œ<a href="https://www.bluetooth.com/develop-with-bluetooth/qualification-listing" target="_blank" rel="noopener"><strong>â€œæ‰€æœ‰ä½¿ç”¨è“ç‰™æŠ€æœ¯çš„äº§å“å¿…é¡»å®Œæˆ Bluetooth Qualification Processï¼ˆè“ç‰™èµ„æ ¼å®¡æ ¸ï¼‰ã€‚â€</strong></a> æˆ‘å¬åˆ°æœ‰äººè¯´ï¼Œâ€œå¸‚é¢ä¸Šæœ‰å¤ªå¤šåŸºäºè“ç‰™çš„åº”ç”¨ï¼›æ²¡æœ‰äººä¼šæ³¨æ„åˆ°æˆ‘çš„â€ã€‚å‘ƒï¼Œå¹¶ä¸æ˜¯è¿™æ ·ã€‚è“ç‰™æŠ€æœ¯æœ‰ <a href="https://www.bluetooth.com/about-us/governing-documents" target="_blank" rel="noopener"><strong>ç‰ˆæƒï¼Œä¸“åˆ©ï¼Œå¹¶ä¸”æˆæƒ</strong></a> ç»™åº”ç”¨å¼€å‘è€…ã€‚å¦‚æœä½ æƒ³è®©ä½ çš„åº”ç”¨ç¨‹åºè¢«èšç„¦å¹¶ä¸”å±•ç¤ºä½ é›†æˆäº†è“ç‰™æŠ€æœ¯çš„äº‹å®ï¼Œè¯·è®°ä½ï¼š  </p><blockquote><p><em>Bluetooth</em> å•†æ ‡ - åŒ…æ‹¬ BLUETOOTH æ–‡å­—å•†æ ‡ï¼Œå›¾å½¢å•†æ ‡ï¼ˆç¬¦æ–‡ B å’Œæ¤­åœ†å½¢è®¾è®¡ï¼‰ï¼Œè¿˜æœ‰ç»„åˆå•†æ ‡ï¼ˆè“ç‰™æ–‡å­—å•†æ ‡å’Œè®¾è®¡ï¼‰- è¿™äº›éƒ½è¢« Bluetooth SIG æ‰€æ‹¥æœ‰ã€‚åªæœ‰ Bluetooth SIG çš„æˆå‘˜å¹¶ä¸”æ‹¥æœ‰å¯¹åº”èµ„æ ¼å’Œç”³æŠ¥è¿‡çš„äº§å“æ‰å¯ä»¥å±•ç¤ºï¼Œç›¸å…³åŠŸèƒ½æˆ–è€…ä½¿ç”¨ä»»ä½•å•†æ ‡ã€‚ä¸ºäº†ä¿æŠ¤è¿™äº›å•†æ ‡ï¼ŒBluetooth SIG ç®¡ç†äº†ä¸€å¥—æ‰§è¡Œç¨‹åºï¼Œç›‘æ§å¸‚åœºå¹¶è¿›è¡Œå®¡æ ¸ï¼Œä»¥ç¡®ä¿ä¼šå‘˜ä½¿ç”¨å•†æ ‡çš„è¡Œä¸ºç¬¦åˆè“ç‰™å“ç‰ŒæŒ‡å—ï¼Œå¹¶ç¡®ä¿æœ€ç»ˆå‘å¸ƒçš„äº§å“ä¸å·²é€šè¿‡èµ„æ ¼å®¡æŸ¥ç¨‹åºçš„å•†å“å’ŒæœåŠ¡ç›¸å¯¹åº”ã€‚</p></blockquote><p>æ¥çœ‹ä¸€ä¸‹ Bluetooth SIG çš„ <a href="https://www.bluetooth.com/develop-with-bluetooth/qualification-listing" target="_blank" rel="noopener"><strong>èµ„è´¨ FAQ</strong></a>ï¼š</p><blockquote><p>å¦‚æœæˆ‘æ²¡æœ‰ç»™æˆ‘çš„äº§å“ç”³è¯·ç›¸åº”çš„èµ„è´¨ä¼šæ€ä¹ˆæ ·?  </p><p>å¦‚æœä½ æ²¡æœ‰ç»™ä½ çš„äº§å“ç”³è¯·ç›¸åº”çš„èµ„è´¨ï¼Œä½ å°†æˆä¸ºæ‰§æ³•è¡ŒåŠ¨çš„å¯¹è±¡ã€‚è¯·é˜…è¯»è¿™é‡Œçš„ <a href="https://www.bluetooth.com/develop-with-bluetooth/qualification-listing" target="_blank" rel="noopener"><strong>æ›´æ–°ç­–ç•¥</strong></a>ï¼Œå…¶ä¸­æˆ‘ä»¬æ¦‚è¿°äº†å‡çº§è®¡åˆ’ã€‚å¦‚æœæ²¡æœ‰é‡‡å–çº æ­£æªæ–½ï¼Œæ‚¨çš„ Bluetooth SIG ä¼šå‘˜èµ„è´¨å¯èƒ½è¢«æš‚åœæˆ–æ’¤é”€ã€‚</p></blockquote><p>åˆ«å‚»äº†ï¼Œåˆ«å»å†’é™©ã€‚æœ€é‡è¦çš„ä¸€ç‚¹æ˜¯ï¼Œæˆ‘ä»¬æ‰€æœ‰äººéƒ½åº”è¯¥åŠªåŠ›è¿½æ±‚æœ€é«˜çš„è¯šä¿¡å’Œè¯šå®ï¼Œåœ¨åº”è¯¥ç»™äºˆä¿¡ä»»çš„æ—¶å€™ç»™äºˆä¿¡ä»»ï¼Œå¹¶ä¿ƒè¿›éµå®ˆæ ‡å‡†ï¼Œä½¿ååŒå·¥ä½œæˆä¸ºè§„èŒƒï¼Œè€Œä¸æ˜¯ä¾‹å¤–ã€‚æ•°åƒä¸ªäººè´¡çŒ®äº†æ•°åƒä¸ªå°æ—¶çš„å·¥ä½œå’Œæ•°ç™¾ä¸‡ç¾å…ƒç”¨äºå‘å±•è“ç‰™çš„æ ‡å‡†å’Œ <a href="http://www.ipwatchdog.com/2015/05/10/evolution-of-technology-bluetooth-the-once-and-future-king/id=57473/" target="_blank" rel="noopener"><strong>å¤šé¡¹ä¸“åˆ©</strong></a>ï¼Œä»è€Œåˆ›é€ äº†ä¸€å¥—æ˜æ˜¾æœ‰ç”¨çš„çŸ¥è¯†è´¢äº§ã€‚</p><h2 id="åˆ«è®©æˆ‘å“ç€ä½ "><a href="#åˆ«è®©æˆ‘å“ç€ä½ " class="headerlink" title="åˆ«è®©æˆ‘å“ç€ä½ "></a>åˆ«è®©æˆ‘å“ç€ä½ </h2><p>äººä»¬å¸¸å¸¸è¢«ã€Œå•†æ ‡ã€ã€ã€Œä¸“åˆ©ã€ã€ã€Œç‰ˆæƒã€ã€ã€Œèµ„è´¨ã€ã€ã€Œä¼šå‘˜ã€ã€ç­‰ä¸¥å‰çš„è¯è¯­æ‰€å“å€’ï¼Œå°¤å…¶æ˜¯ â€œå¼ºåˆ¶æ‰§è¡Œã€‚â€ä¸è¦å¼€å§‹æ‹…å¿ƒä½¿ç”¨è“ç‰™è¿›è¡Œå¼€å‘çš„äº‹ã€‚<em>åŠ å…¥ Bluetooth SIGï¼å®ƒæ˜¯å…è´¹çš„ï¼</em> <a href="https://www.bluetooth.com/develop-with-bluetooth/join" target="_blank" rel="noopener"><strong>ç‚¹å‡»è¿™é‡Œ</strong></a>ï¼Œç„¶åï¼š</p><blockquote><p>é¦–å…ˆæˆä¸ºä¸€ä¸ª Adopter çº§åˆ«çš„ä¼šå‘˜ã€‚ä½¿ç”¨è“ç‰™æŠ€æœ¯å¼€å‘ä¸€æ¬¾äº§å“ï¼Œä¼šå‘˜èµ„æ ¼æ˜¯å¿…é¡»çš„ï¼ŒAdopter çº§åˆ«ä¼šå‘˜æ‹¥æœ‰ä»¥ä¸‹è¿™äº›ç¦åˆ©ï¼š<br>â€¢ æ ¹æ® <a href="https://www.bluetooth.com/~/media/downloads/pcla%20esign%20version%20version%2011.ashx?la=en" target="_blank" rel="noopener"><strong>Bluetooth Patent/Copyright License Agreementï¼ˆè“ç‰™ä¸“åˆ©/ç‰ˆæƒè®¸å¯åè®®ï¼‰</strong></a> ä½¿ç”¨è“ç‰™æŠ€æœ¯ç”Ÿäº§äº§å“çš„è®¸å¯<br>â€¢ æ ¹æ® <a href="https://www.bluetooth.com/~/media/files/membership/btla.ashx?la=en" target="_blank" rel="noopener"><strong>Bluetooth Trademark License Agreementï¼ˆè“ç‰™å•†æ ‡è®¸å¯åè®®ï¼‰</strong></a> åœ¨ç¬¦åˆæ¡ä»¶çš„äº§å“ä¸Šä½¿ç”¨è“ç‰™å•†æ ‡çš„è®¸å¯<br>â€¢ èƒ½å¤Ÿä¸æ•°ä»¥ä¸‡è®¡çš„ Bluetooth SIG æˆå‘˜å»ºç«‹ç½‘ç»œï¼Œå¹¶åœ¨å„ç§å„æ ·çš„è¡Œä¸šä¸­åˆä½œ â€” ä»èŠ¯ç‰‡åˆ¶é€ å•†åˆ°åº”ç”¨ç¨‹åºçš„å¼€å‘è€…ï¼Œè®¾å¤‡åˆ¶é€ å•†å’ŒæœåŠ¡æä¾›å•†<br>â€¢ èƒ½å¤Ÿå‚åŠ  <a href="https://www.bluetooth.com/specifications/working-groups/working-groups-committees" target="_blank" rel="noopener"><strong>SIG ä¸“å®¶ç»„ã€ç ”ç©¶å°ç»„å’Œå·¥ä½œç»„ä¸­çš„å­å°ç»„</strong></a><br>â€¢ è®¿é—®è¯¸å¦‚ Profile Tuning Suiteï¼ˆPTSï¼‰ä¹‹ç±»çš„å·¥å…·ï¼Œæä¾›åè®®å’ŒååŒæµ‹è¯•â€¦â€¦</p></blockquote><h2 id="æˆä¸º-Bluetooth-SIG-çš„ä¸€å‘˜"><a href="#æˆä¸º-Bluetooth-SIG-çš„ä¸€å‘˜" class="headerlink" title="æˆä¸º Bluetooth SIG çš„ä¸€å‘˜"></a>æˆä¸º Bluetooth SIG çš„ä¸€å‘˜</h2><p>æˆä¸º SIG çš„ä¸€å‘˜ <a href="https://www.bluetooth.com/develop-with-bluetooth/build" target="_blank" rel="noopener"><strong>ä¼šåŒ…å«å¾ˆå¤šå¥½å¤„</strong></a>ã€‚ä½ å¯ä»¥å…è´¹ä½¿ç”¨æ•™è‚²å·¥å…·åŒ…ã€åŸ¹è®­è§†é¢‘ã€ç½‘ç»œç ”è®¨ä¼šã€å¼€å‘äººå‘˜è®ºå›ã€å¼€å‘äººå‘˜æ”¯æŒæœåŠ¡ã€ç™½çš®ä¹¦ã€äº§å“æµ‹è¯•å·¥å…·ï¼Œå¹¶å¸®åŠ©ç¡®ä¿æ‚¨çš„åº”ç”¨ç¨‹åºæ»¡è¶³å›½é™…ç›‘ç®¡è¦æ±‚ï¼ˆä¸»è¦æ˜¯å…³äº <a href="https://www.fda.gov/MedicalDevices/DigitalHealth/WirelessMedicalDevices/default.htm" target="_blank" rel="noopener"><strong>å°„é¢‘æ’æ”¾</strong></a>ï¼‰ã€‚  </p><p>ä½ åªè¦æˆä¸ºä¼šå‘˜å°±ä¼šå¾—åˆ°ä¸€äº›æ›å…‰ã€‚æˆ‘çš„å…¬å¸æ˜¯å®ƒçš„ä¸€ä¸ªæˆå‘˜ï¼Œæ‰€ä»¥åœ¨ Bluetooth SIGâ€™s Member Directory ä¸­å¯ä»¥ <a href="https://www.bluetooth.com/develop-with-bluetooth/join/member-directory?q=microIT%20Infrastructure,%20LLC" target="_blank" rel="noopener"><strong>è¢«çœ‹åˆ°</strong></a>ï¼š<br><img src="https://appcoda.com/wp-content/uploads/2018/04/membership.png" alt>  </p><p>ä¸€æ—¦ä½ å¼€å‘äº†ä¸€æ¬¾åº”ç”¨ï¼Œä½¿å…¶é€šè¿‡ SIG è®¤è¯ï¼Œå¹¶è·å¾— Apple App Store çš„è®¸å¯ï¼Œé‚£ä¹ˆä½ çš„äº§å“åŒæ—¶ä¹Ÿä¼šè¢« SIG å…¬å¼€ä¸Šå¸‚ï¼Œè¿™æ—¶ä½ å°†è·å¾—æ›´å¤šçš„æ›å…‰ã€‚  </p><h2 id="å¯¹åº”ç”¨ç¨‹åºè¿›è¡Œèµ„æ ¼è®¤è¯æ—¢ç®€å•åˆä¾¿å®œ"><a href="#å¯¹åº”ç”¨ç¨‹åºè¿›è¡Œèµ„æ ¼è®¤è¯æ—¢ç®€å•åˆä¾¿å®œ" class="headerlink" title="å¯¹åº”ç”¨ç¨‹åºè¿›è¡Œèµ„æ ¼è®¤è¯æ—¢ç®€å•åˆä¾¿å®œ"></a>å¯¹åº”ç”¨ç¨‹åºè¿›è¡Œèµ„æ ¼è®¤è¯æ—¢ç®€å•åˆä¾¿å®œ</h2><p>å½“ä½ å¯¹è‡ªå·±åŸºäº Core Bluetooth å¼€å‘çš„åº”ç”¨ç¨‹åºæ„Ÿåˆ°æ»¡æ„ï¼Œå¹¶å‡†å¤‡å°†å…¶æäº¤åˆ° Apple App Store è¿›è¡Œå®¡æ ¸ï¼Œè¯·åœä¸‹ï¼Œç„¶åå‰å¾€ Bluetooth SIG çš„ç½‘é¡µå¯¹ä½ çš„åº”ç”¨ç¨‹åºè¿›è¡Œ <a href="https://www.bluetooth.com/develop-with-bluetooth/qualification-listing" target="_blank" rel="noopener"><strong>è®¤è¯</strong></a>ã€‚SIG å°†ä¸ºæ‚¨æä¾›ä¸€ä¸ªæ•´æ´çš„ <a href="https://launchstudio.bluetooth.com/" target="_blank" rel="noopener"><strong>â€œLaunch Studioâ€</strong></a>ï¼Œå®ƒæ˜¯æ‚¨ç”¨æ¥å®Œæˆ Bluetooth Qualification Process çš„åœ¨çº¿å·¥å…·ã€‚â€  </p><p>å¯¹äºå¤§å¤šæ•°åº”ç”¨ç¨‹åºï¼Œæ¯”å¦‚æˆ‘å°†åœ¨æœ¬æ•™ç¨‹ä¸­ä»‹ç»çš„ â€œGATT - based Profile Clientï¼ˆappï¼‰ï¼Œâ€è®¤è¯å’Œä¸Šå¸‚çš„è´¹ç”¨æ˜¯ 100 ç¾å…ƒã€‚èŠ±ä¸€äº›ç²¾åŠ›æ¥ç¡®ä¿æ‚¨çš„ä»£ç ç¬¦åˆ Bluetooth è§„èŒƒå’Œåšä¸€äº›æµ‹è¯•ï¼Œå°†æ˜¯éå¸¸å€¼å¾—çš„ã€‚æœ€åï¼Œå¯ä»¥ç»™ä½ çš„åº”ç”¨ç¨‹åºå°ä¸Šè“ç‰™çš„å•†æ ‡ã€‚è¿™ä¸ª <a href="https://www.bluetooth.com/develop-with-bluetooth/marketing-branding" target="_blank" rel="noopener"><strong>å•†æ ‡</strong></a> â€œåœ¨å…¨çƒèŒƒå›´å†…éƒ½æ˜¯å¯è¯†åˆ«çš„ï¼Œæ¶ˆè´¹è€…è®¤çŸ¥åº¦é«˜è¾¾92%ã€‚â€  </p><p>è¯·ä¸è¦æ‹…å¿ƒ 100 ç¾å…ƒçš„é—®é¢˜ã€‚ä½ æ›´æœ‰å¯èƒ½è·å¾—ä¸€ä»½æ‹¥æœ‰ä¸°åšè–ªæ°´æˆ–è€…æ—¶è–ªçš„å·¥ä½œï¼Œå¹¶ä¸ºå…¬å¸å¤„ç†è¿™äº›è“ç‰™çš„åˆè§„é—®é¢˜ã€‚</p><h2 id="ç†è§£-Core-Bluetooth"><a href="#ç†è§£-Core-Bluetooth" class="headerlink" title="ç†è§£ Core Bluetooth"></a>ç†è§£ Core Bluetooth</h2><p>å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œä½¿ç”¨è“ç‰™è®¾å¤‡æ˜¯éå¸¸ç®€å•çš„ã€‚å¼€å‘ä¸è“ç‰™é€šè®¯çš„è½¯ä»¶å´æœ‰å¯èƒ½éå¸¸å¤æ‚ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆ Apple åˆ›é€ äº† <a href="https://developer.apple.com/library/archive/documentation/NetworkingInternetWeb/Conceptual/CoreBluetooth_concepts/CoreBluetoothOverview/CoreBluetoothOverview.html#//apple_ref/doc/uid/TP40013257-CH2-SW1" target="_blank" rel="noopener"><strong><em>Core Bluetooth</em></strong> <strong>æ¡†æ¶</strong></a>ï¼š  </p><blockquote><p>Core Bluetooth æ¡†æ¶è®©æ‚¨çš„ iOS å’Œ Mac åº”ç”¨ç¨‹åºä¸è“ç‰™ä½èƒ½è€—è®¾å¤‡é€šä¿¡ã€‚ä¾‹å¦‚ï¼Œæ‚¨çš„åº”ç”¨ç¨‹åºå¯ä»¥å‘ç°ã€æœç´¢ä½èƒ½é‡çš„å¤–å›´è®¾å¤‡è¿˜æœ‰ä¸ä¹‹äº¤äº’ï¼Œæ¯”å¦‚å¿ƒç‡ç›‘è§†å™¨ã€æ•°å­—æ’æ¸©å™¨ï¼Œç”šè‡³å…¶ä»– iOS è®¾å¤‡ã€‚  </p></blockquote><blockquote><p>è¯¥æ¡†æ¶æ˜¯è“ç‰™ 4.0 è§„èŒƒä¸­å…³äºä½¿ç”¨ä½èƒ½è€—è®¾å¤‡çš„æŠ½è±¡ã€‚å°±æ˜¯è¯´ï¼Œå®ƒä¸ºä½ ï¼Œä¹Ÿå°±æ˜¯å¼€å‘è€…ï¼Œéšè—äº†è§„èŒƒä¸­å¾ˆå¤šåº•å±‚çš„ç»†èŠ‚ï¼Œä½¿ä½ æ›´å®¹æ˜“å¼€å‘ä¸ä½èƒ½è€—è®¾å¤‡è¿›è¡Œäº¤äº’çš„åº”ç”¨ç¨‹åºã€‚å› ä¸ºè¯¥æ¡†æ¶æ˜¯åŸºäºæ ‡å‡†è§„èŒƒçš„ï¼Œæ‰€æœ‰è§„èŒƒä¸­çš„å¾ˆå¤šæ¦‚å¿µå’Œæœ¯è¯­è¢«é‡‡ç”¨äº†â€¦â€¦  </p></blockquote><p>è¯·æ³¨æ„æ˜¯â€œä½èƒ½é‡è®¾å¤‡â€ã€‚å½“ä½¿ç”¨ <em>Core Bluetooth</em> æˆ‘ä»¬å¹¶ä¸æ˜¯å¤„ç†å¦‚æ— çº¿æ‰¬å£°å™¨è¿™æ ·çš„ç»å…¸è“ç‰™è®¾å¤‡ã€‚ä¸è¿™ç±»è®¾å¤‡çš„é€šè®¯ä¼šå¾ˆå¿«çš„è€—å°½ç”µæ± èƒ½é‡ã€‚<em>Core Bluetooth</em> æ˜¯é’ˆå¯¹â€œBluetooth Low Energyâ€ï¼ˆBLEï¼‰çš„ APIï¼Œä¹Ÿç§°ä¸ºâ€œBluetooth 4.0â€ã€‚BLE ä½¿ç”¨çš„ç”µåŠ›è¦å°‘å¾—å¤šï¼Œå› ä¸ºå®ƒçš„è®¾è®¡ç›®çš„æ˜¯é€šä¿¡å°‘é‡çš„æ•°æ®ã€‚BLE è®¾å¤‡çš„ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­æ˜¯å¿ƒç‡ç›‘æµ‹å™¨ï¼ˆHRMï¼‰ã€‚å®ƒå‡ ä¹æ¯ç§’é’Ÿåªå‘é€å‡ ä¸ªå­—èŠ‚çš„æ•°æ®ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆäººä»¬å¯ä»¥å¸¦ç€ä¸€ä¸ª HRM æˆ–è€…å¸¦ç€ä»–ä»¬çš„ iPhone è·‘ä¸€ä¸ªå°æ—¶ï¼Œè®°å½•è·‘æ­¥æœŸé—´å¿ƒç‡çš„å˜åŒ–ï¼Œè€Œçœ‹ä¸åˆ°ç”µæ± ç”µé‡çš„å·¨å¤§æ¶ˆè€—ã€‚æ³¨æ„ï¼Œéšç€æœ¬æ–‡çš„è¿›è¡Œï¼Œåƒ BLE è¿™ç§é¦–å­—æ¯ç¼©ç•¥è¯çš„æ•°é‡æ­£åœ¨å¢åŠ ã€‚  </p><p>ä¸ºäº†æˆ‘ä»¬èƒ½å¤Ÿä¸€èµ·æµç•…çš„è®¨è®º <em>Core Bluetooth</em> ä½ éœ€è¦å­¦ä¹ ä¸€ä¸ªæ–°çš„è¯æ±‡è¡¨ã€‚  </p><p>åˆ†åˆ«ä» <a href="https://developer.apple.com/library/archive/documentation/NetworkingInternetWeb/Conceptual/CoreBluetooth_concepts/CoreBluetoothOverview/CoreBluetoothOverview.html#//apple_ref/doc/uid/TP40013257-CH2-SW17" target="_blank" rel="noopener"><strong>å®¢æˆ·ç«¯/æœåŠ¡ç«¯å’Œç”Ÿäº§è€…/æ¶ˆè´¹è€…æ¨¡å‹</strong></a> çš„è§’åº¦è€ƒè™‘ BLE åè®®ã€‚<br><img src="https://appcoda.com/wp-content/uploads/2018/04/central-peripheral.png" alt>  </p><h2 id="The-Peripheralï¼ˆå¤–å›´è®¾å¤‡ï¼‰"><a href="#The-Peripheralï¼ˆå¤–å›´è®¾å¤‡ï¼‰" class="headerlink" title="The Peripheralï¼ˆå¤–å›´è®¾å¤‡ï¼‰"></a>The Peripheralï¼ˆå¤–å›´è®¾å¤‡ï¼‰</h2><p><em>å¤–å›´è®¾å¤‡</em>æ˜¯ç¡¬ä»¶/è½¯ä»¶çš„ä¸€éƒ¨åˆ†ï¼Œå°±åƒ HRMã€‚å¤§å¤šæ•° HRM è®¾å¤‡æœé›†æˆ–/å’Œè®¡ç®—æ•°æ®ï¼Œå¦‚æ¯åˆ†é’Ÿå¿ƒè·³ã€HRM çš„ç”µæ± ç”µé‡æ°´å¹³ã€ä»¥åŠæ‰€è°“çš„â€œRR-Intervalâ€ã€‚è®¾å¤‡ä¼ è¾“è¿™äº›æ•°æ®åˆ°å¦ä¸€ä¸ªéœ€è¦å®ƒä»¬çš„å®ä½“æˆ–å®ä½“ç»„ã€‚å¤–å›´è®¾å¤‡æ˜¯<em>æœåŠ¡è€…</em>å’Œ<em>ç”Ÿäº§è€…</em>ã€‚å¸‚åœºä¸Šæ¯”è¾ƒæµè¡Œçš„ HRM æœ‰ <a href="https://www.wahoofitness.com/devices/heart-rate-monitors/wahoo-tickr-heart-rate-strap" target="_blank" rel="noopener"><strong>Wahoo TICKRï¼Œ</strong></a><a href="https://www.polar.com/us-en/products/accessories/h10_heart_rate_sensor" target="_blank" rel="noopener"><strong>Polar H7ï¼Œ</strong></a>å’Œ <a href="https://www.scosche.com/rhythm-plus-heart-rate-monitor-armband" target="_blank" rel="noopener"><strong>Scosche Rhythm+</strong></a>ã€‚<br><img src="https://appcoda.com/wp-content/uploads/2018/04/heart-rate-monitor-device.png" alt>  </p><p>æˆ‘å°†é€šè¿‡ç¼–å†™è¿æ¥åˆ°è¿™ä¸‰ç§è®¾å¤‡çš„ Swift 4 ä»£ç æ¥å±•ç¤º BLE ç­‰æ ‡å‡†çš„é‡è¦æ€§ã€‚  </p><p><strong><em>Core Bluetooth è§†è§’</em></strong>  </p><p>æ¥è‡ª <a href="https://developer.apple.com/documentation/corebluetooth/cbperipheraldelegate" target="_blank" rel="noopener"><strong>è‹¹æœçš„æ–‡æ¡£</strong></a>ï¼š  </p><blockquote><p>CBPeripheralDelegate  </p><p><a href="https://developer.apple.com/documentation/corebluetooth/cbperipheral" target="_blank" rel="noopener"><code>CBPeripheral</code></a> å¯¹è±¡çš„ä»£ç†å¿…é¡»éµå®ˆ <a href="https://developer.apple.com/documentation/corebluetooth/cbperipheraldelegate" target="_blank" rel="noopener"><code>CBPeripheralDelegate</code></a> åè®®ã€‚ä»£ç†ä½¿ç”¨è¿™ä¸ªåè®®çš„æ–¹æ³•æ¥å¯¹ä¸€ä¸ªè¿œç¨‹å¤–å›´è®¾å¤‡çš„æœåŠ¡å’Œå±æ€§ï¼Œè¿›è¡Œå‘ç°ã€æ¢ç´¢ã€è¿˜æœ‰äº¤äº’æ–¹é¢çš„ç›‘æ§ã€‚è¿™ä¸ªåè®®é‡Œé¢æ²¡æœ‰å¿…é¡»éµå®ˆçš„æ–¹æ³•ã€‚  </p></blockquote><h2 id="The-Centralï¼ˆä¸­å¤®è®¾å¤‡ï¼‰"><a href="#The-Centralï¼ˆä¸­å¤®è®¾å¤‡ï¼‰" class="headerlink" title="The Centralï¼ˆä¸­å¤®è®¾å¤‡ï¼‰"></a>The Centralï¼ˆä¸­å¤®è®¾å¤‡ï¼‰</h2><p><em>ä¸­å¤®è®¾å¤‡</em>æ˜¯ç¡¬ä»¶/è½¯ä»¶çš„ä¸€éƒ¨åˆ†ï¼Œå°±åƒ iPhoneã€iPadã€MacBookã€<br>iMac ç­‰ã€‚è¿™äº›è®¾å¤‡å¯ä»¥ä½¿ç”¨åº”ç”¨ç¨‹åºæ‰«æåƒ HRM è¿™æ ·çš„è“ç‰™å¤–å›´è®¾å¤‡ã€‚ä¸­å¤®è®¾å¤‡æ˜¯ä¸€ä¸ª<em>å®¢æˆ·</em>ä»¥åŠ <em>æ¶ˆè´¹è€…</em>ã€‚å®ƒä»¬ä¸ HRM æ˜¯è¿é€šçš„ï¼Œæ‰€ä»¥å®ƒä»¬å¯ä»¥ä½¿ç”¨ä»å¤–å›´è®¾å¤‡ä¸­å–å‡ºçš„åƒæ¯åˆ†é’Ÿå¿ƒè·³ã€ç”µæ± çš„ç”µé‡æ°´å¹³ã€è¿˜æœ‰â€œRR-Intervalâ€è¿™æ ·çš„æ•°æ®ã€‚ä¸­å¤®è®¾å¤‡æ¥æ”¶è¿™äº›æ•°æ®ï¼Œå¯ä»¥å¯¹æ•°æ®æ‰§è¡Œå¢å€¼è®¡ç®—ï¼Œæˆ–è€…åªæ˜¯é€šè¿‡ç”¨æˆ·ç•Œé¢æ˜¾ç¤ºæ•°æ®ï¼Œæˆ–è€…æ˜¯å­˜å‚¨æ•°æ®ä»¥ä¾›å°†æ¥åˆ†æã€å±•ç¤ºï¼Œæˆ–è€…æ˜¯èšåˆå’Œæ•°æ®åˆ†æï¼ˆå°±åƒç»Ÿè®¡åˆ†æéœ€è¦è¶³å¤Ÿçš„æ•°æ®æ¥ç¡®å®šé‡è¦çš„å’Œæœ‰æ„ä¹‰çš„è¶‹åŠ¿ï¼‰ï¼Œæˆ–å…¶ä»–ç±»ä¼¼çš„æ“ä½œã€‚  </p><p><strong><em>Core Bluetooth è§†è§’</em></strong>  </p><p>æ¥è‡ª <a href="https://developer.apple.com/documentation/corebluetooth/cbcentralmanagerdelegate" target="_blank" rel="noopener"><strong>è‹¹æœçš„æ–‡æ¡£</strong></a>ï¼š  </p><blockquote><p><a href="https://developer.apple.com/documentation/corebluetooth/cbcentralmanagerdelegate" target="_blank" rel="noopener"><code>CBCentralManagerDelegate</code></a> åè®®å®šä¹‰äº†æ–¹æ³•ï¼Œ<a href="https://developer.apple.com/documentation/corebluetooth/cbcentralmanager" target="_blank" rel="noopener"><code>CBCentralManager</code></a> å¯¹è±¡çš„ä»£ç†å¿…é¡»éµå®ˆå®ƒã€‚åè®®ä¸­çš„å¯é€‰æ–¹æ³•å…è®¸ä»£ç†æ¥ç›‘æ§å¯¹å¤–å›´è®¾å¤‡çš„å‘ç°ã€è¿æ¥ã€è¿˜æœ‰æ£€ç´¢ã€‚å”¯ä¸€å¿…é¡»å®ç°çš„æ–¹æ³•è¡¨æ˜ä¸­å¤®è®¾å¤‡çš„å¯ç”¨æ€§ï¼Œå¹¶ä¸”å½“ä¸­å¤®è®¾å¤‡çš„çŠ¶æ€å‘ç”Ÿæ›´æ–°æ—¶è¢«è°ƒç”¨ã€‚</p></blockquote><h2 id="é€šè¿‡å¹¿æ’­æ‰¾åˆ°å¤–å›´è®¾å¤‡"><a href="#é€šè¿‡å¹¿æ’­æ‰¾åˆ°å¤–å›´è®¾å¤‡" class="headerlink" title="é€šè¿‡å¹¿æ’­æ‰¾åˆ°å¤–å›´è®¾å¤‡"></a>é€šè¿‡å¹¿æ’­æ‰¾åˆ°å¤–å›´è®¾å¤‡</h2><p>å¦‚æœä½ çš„ iPhone æˆ– iPad æ‰¾ä¸åˆ°è¿™äº›å¤–è®¾ä»è€Œä¸èƒ½è¿æ¥åˆ°å®ƒä»¬ï¼Œé‚£ä¹ˆ HRM ä¹‹ç±»çš„å¤–è®¾å°±æ²¡ä»€ä¹ˆç”¨äº†ã€‚å› æ­¤ï¼Œå®ƒä»¬ä¸æ–­é€šè¿‡æ— çº¿é¢‘æ®µå‘é€ç€æ•°æ®çš„å°ç‰‡æ®µï¼ˆåŒ…ï¼‰ï¼Œè¯´ç€ç±»ä¼¼è¿™æ ·çš„è¯ï¼šâ€œå˜¿ï¼Œæˆ‘æ˜¯ Scosche Rhythm+ å¿ƒç‡æ£€æµ‹å™¨ï¼›æˆ‘èƒ½æä¾›ç±»ä¼¼æˆ‘çš„ç©¿æˆ´è€…æ¯åˆ†é’Ÿå¿ƒç‡çš„åŠŸèƒ½ï¼›æˆ‘èƒ½æä¾›ç±»ä¼¼æˆ‘çš„ç”µæ± ç”µé‡æ°´å¹³çš„ä¿¡æ¯ã€‚â€å½“ä¸€ä¸ªå¯¹å¿ƒç‡æ„Ÿå…´è¶£çš„<em>ä¸­å¤®è®¾å¤‡</em>é€šè¿‡<em>æ‰«æ</em>æ‰¾åˆ°äº†è¿™ä¸ª<em>å¤–å›´è®¾å¤‡</em>ï¼Œä¸­å¤®è®¾å¤‡å°†è¿æ¥åˆ°å®ƒå¹¶ä¸”å®ƒä¼šåœæ­¢å¹¿æ’­ã€‚  </p><p>ä½ å¯èƒ½å·²ç»ä½¿ç”¨è¿‡ iPhone -&gt; <em>è®¾ç½®</em> -&gt; <em>è“ç‰™</em> æ¥å¼€å¯æˆ–å…³é—­è“ç‰™ï¼ˆåŒ…æ‹¬ä¼ ç»Ÿçš„å’Œ BLEï¼‰ã€‚å½“åˆ‡æ¢åˆ°å¼€å¯ï¼Œä½ å¯ä»¥çœ‹åˆ°ä½ çš„ iPhone æ‰«æè®¾å¤‡å¹¶ä¸å®ƒä»¬å»ºç«‹è¿æ¥ï¼Œå°±åƒä¸‹é¢æˆ‘æ‰€æˆªçš„ä¸¤å¼ å›¾ï¼Œæœç´¢ï¼Œå¹¶ä¸”å°†æˆ‘çš„ iPhone è¿æ¥åˆ°ä¸€ä¸ª Scosche Rhythm+ HRMï¼š<br><img src="https://appcoda.com/wp-content/uploads/2018/04/bluetooth-found-ryhthm.png" alt>  </p><p>ä¾ç…§ <a href="https://developer.apple.com/library/archive/documentation/NetworkingInternetWeb/Conceptual/CoreBluetooth_concepts/CoreBluetoothOverview/CoreBluetoothOverview.html#//apple_ref/doc/uid/TP40013257-CH2-SW17" target="_blank" rel="noopener"><strong>è‹¹æœ</strong></a> çš„è¯´æ³•ï¼š  </p><blockquote><p>å¤–å›´è®¾å¤‡ä»¥å¹¿æ’­åŒ…çš„å½¢å¼å¹¿æ’­ä¸€äº›æ•°æ®ã€‚ä¸€ä¸ªå¹¿æ’­åŒ…æ˜¯ä¸€ä¸ªç›¸å¯¹è¾ƒå°çš„æ•°æ®æŸï¼Œå…¶ä¸­å¯èƒ½åŒ…å«å¤–å›´è®¾å¤‡æ‰€èƒ½æä¾›çš„æœ‰ç”¨ä¿¡æ¯ï¼Œæ¯”å¦‚å¤–å›´è®¾å¤‡çš„åå­—è¿˜æœ‰ä¸»è¦åŠŸèƒ½ã€‚ä¾‹å¦‚ï¼Œæ•°å­—æ’æ¸©å™¨å¯èƒ½ä¼šå¹¿æ’­å®ƒèƒ½æä¾›æˆ¿é—´çš„å½“å‰æ¸©åº¦ã€‚åœ¨ BLE ä¸­ï¼Œå¹¿æ’­æ˜¯å¤–å›´è®¾å¤‡å±•ç¤ºå…¶å­˜åœ¨çš„ä¸»è¦æ–¹å¼ã€‚å¦ä¸€æ–¹é¢ï¼Œä¸­å¤®è®¾å¤‡å¯ä»¥æ‰«æå’Œç›‘å¬ä»»ä½•å¤–å›´è®¾å¤‡ï¼Œåªè¦è¿™äº›è®¾å¤‡çš„å¹¿æ’­ä¿¡æ¯æ˜¯å®ƒæ„Ÿå…´è¶£çš„â€¦â€¦  </p></blockquote><p>åœ¨è¿™ç¯‡æ•™ç¨‹ä¸­ï¼Œè¿‡ä¸€ä¼šæˆ‘ä¼šå‘ä½ å±•ç¤ºæ€æ ·ä½¿ç”¨ Swift 4 æ¥ç¼–ç è¿›è¡Œå¤–å›´è®¾å¤‡çš„æ‰«æå¹¶è¿æ¥å®ƒä»¬ã€‚</p><h2 id="å¤–å›´è®¾å¤‡çš„å„ç§æœåŠ¡"><a href="#å¤–å›´è®¾å¤‡çš„å„ç§æœåŠ¡" class="headerlink" title="å¤–å›´è®¾å¤‡çš„å„ç§æœåŠ¡"></a>å¤–å›´è®¾å¤‡çš„å„ç§æœåŠ¡</h2><p>æœåŠ¡å¯èƒ½ä¸æ˜¯ä½ è®¤ä¸ºçš„é‚£æ ·ã€‚æœåŠ¡<em>æè¿°</em>å¤–å›´è®¾å¤‡æä¾›çš„ä¸»è¦ç‰¹æ€§æˆ–åŠŸèƒ½ã€‚ä½†å®ƒå¹¶ä¸æ˜¯ä¸€ç§å…·ä½“çš„æµ‹é‡æ–¹æ³•ï¼Œå¦‚æ¯åˆ†é’Ÿå¿ƒè·³æ•°ï¼Œè€Œæ˜¯ä¸€ç§æè¿°ä»å¤–å›´è®¾å¤‡å¯ä»¥å¾—åˆ°çš„ä¸å¿ƒè„ç›¸å…³çš„æµ‹é‡æ–¹æ³•çš„åˆ†ç±»ã€‚  </p><p>ä¾ç…§ <a href="https://developer.apple.com/library/archive/documentation/NetworkingInternetWeb/Conceptual/CoreBluetooth_concepts/CoreBluetoothOverview/CoreBluetoothOverview.html#//apple_ref/doc/uid/TP40013257-CH2-SW17" target="_blank" rel="noopener"><strong>è‹¹æœ</strong></a> çš„è¯´æ³•ï¼š  </p><blockquote><p>æœåŠ¡æ˜¯ä¸€ä¸ªæ•°æ®å’Œç›¸å…³è¡Œä¸ºçš„é›†åˆï¼Œç”¨äºå®ç°è®¾å¤‡ï¼ˆæˆ–è®¾å¤‡çš„ä¸€éƒ¨åˆ†ï¼‰çš„åŠŸèƒ½æˆ–ç‰¹æ€§ã€‚æ¯”å¦‚ï¼Œå¿ƒç‡æ£€æµ‹å™¨çš„ä¸€é¡¹æœåŠ¡å¯èƒ½æ˜¯å…¬å¼€æ¥è‡ªç›‘æµ‹å™¨çš„å¿ƒç‡ä¼ æ„Ÿå™¨çš„å¿ƒç‡æ•°æ®ã€‚</p></blockquote><p>å…·ä½“å®šä¹‰ä¸€ä¸ªè“ç‰™â€œæœåŠ¡â€ï¼Œæˆ‘ä»¬åº”è¯¥çœ‹çœ‹ Bluetooth SIG çš„ <a href="https://www.bluetooth.com/specifications/gatt/services" target="_blank" rel="noopener"><strong>â€œGATT Servicesï¼ˆæœåŠ¡ï¼‰â€</strong></a> åˆ—è¡¨ï¼Œè¿™é‡Œ GATT ä»£è¡¨ <a href="https://www.bluetooth.com/specifications/gatt" target="_blank" rel="noopener"><strong>â€œGeneric Attributesï¼ˆé€šç”¨å±æ€§ï¼‰â€</strong></a>ã€‚  </p><p>å‘ä¸‹æ»šåŠ¨æœåŠ¡ <a href="https://www.bluetooth.com/specifications/gatt/services" target="_blank" rel="noopener"><strong>åˆ—è¡¨</strong></a>ï¼Œç›´åˆ°ä½ åœ¨ <strong>Nameï¼ˆåå­—ï¼‰</strong> åˆ—ä¸­çœ‹åˆ° â€œHeart Rateâ€ã€‚æ³¨æ„ï¼Œ <strong>Uniform Type Identifier (ç»Ÿä¸€ç±»å‹æ ‡è¯†ç¬¦)</strong> å¯¹åº”çš„æ˜¯ â€œorg.bluetooth.service.heart_rateâ€ï¼Œ<strong>Assigned Numberï¼ˆæŒ‡å®šç¼–ç ï¼‰</strong> åˆ™æ˜¯ 0x180Dã€‚è¯·æ³¨æ„åœ¨åé¢çš„ä»£ç ä¸­æˆ‘ä»¬å°†ä½¿ç”¨ 0x180D è¿™ä¸ªå€¼ã€‚  </p><p>ç‚¹å‡» <a href="https://www.bluetooth.com/specifications/gatt/viewer?attributeXmlFile=org.bluetooth.service.heart_rate.xml" target="_blank" rel="noopener"><strong>â€œHeart Rateï¼ˆå¿ƒç‡ï¼‰â€</strong></a>ï¼Œä½ å°†æ‰“å¼€ä¸€ä¸ªç½‘é¡µï¼Œä¸Šé¢ç”¨ç²—ä½“å­—å†™ç€ <strong>Name: Heart Rate</strong>ã€‚è¯·æ³¨æ„ <strong>Summaryï¼ˆæ‘˜è¦ï¼‰</strong> ï¼Œâ€œHEART RATE Serviceï¼ˆå¿ƒç‡æœåŠ¡ï¼‰å…¬å¼€å¿ƒç‡å’Œå…¶ä»–ä¸å¿ƒç‡ä¼ æ„Ÿå™¨ç›¸å…³çš„æ•°æ®ï¼Œç”¨äºå¥èº«åº”ç”¨ã€‚â€å‘ä¸‹æ»šåŠ¨é¡µé¢å°±ä¼šå‘ç° <strong>Heart Rate</strong> <em>service</em> æœ¬èº«å¹¶ä¸ä¼šæä¾›æ¯åˆ†é’Ÿè·³åŠ¨çš„å®é™…å¿ƒç‡ã€‚è¿™ä¸ªæœåŠ¡æ˜¯ä¸€ä¸ªå…¶ä»–æ•°æ®ç‰‡æ®µçš„é›†åˆï¼Œå®ƒä»¬è¢«ç§°ä¸º <em>characteristicsï¼ˆç‰¹å¾ï¼‰</em>ã€‚æœ€åï¼Œä½ ä¼šå¾—åˆ°ä¸€ä¸ªç‰¹å¾æ¥æä¾›é‡è¦æ•°æ®ï¼šå¿ƒç‡ã€‚  </p><p><strong><em>Core Bluetooth è§†è§’</em></strong>  </p><p>æ¥è‡ª <a href="https://developer.apple.com/documentation/corebluetooth/cbservice" target="_blank" rel="noopener"><strong>è‹¹æœçš„æ–‡æ¡£</strong></a>ï¼š  </p><blockquote><p><a href="https://developer.apple.com/documentation/corebluetooth/cbservice" target="_blank" rel="noopener"><code>CBService</code></a> å’Œå®ƒçš„å­ç±» <a href="https://developer.apple.com/documentation/corebluetooth/cbmutableservice" target="_blank" rel="noopener"><code>CBMutableService</code></a> ä»£è¡¨ä¸€ä¸ªå¤–å›´è®¾å¤‡çš„æœåŠ¡ - ä¸ºå®ç°è®¾å¤‡ï¼ˆæˆ–è®¾å¤‡çš„ä¸€éƒ¨åˆ†ï¼‰çš„åŠŸèƒ½æˆ–ç‰¹æ€§è€Œæ”¶é›†çš„æ•°æ®å’Œç›¸å…³è¡Œä¸ºã€‚<code>CBService</code> å¯¹è±¡ç‰¹æŒ‡è¿œç¨‹å¤–å›´è®¾å¤‡ï¼ˆä½¿ç”¨ <a href="https://developer.apple.com/documentation/corebluetooth/cbperipheral" target="_blank" rel="noopener"><code>CBPeripheral</code></a> å¯¹è±¡æ¥è¡¨ç¤ºï¼‰çš„æœåŠ¡ã€‚æœåŠ¡ç»„å¯èƒ½æ˜¯ä¸»è¦çš„ï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯æ¬¡è¦çš„ï¼Œå¯èƒ½ä¼šåŒ…å«ä¸€ä¸ªç‰¹å¾ç»„çš„ä»£ç ï¼Œä¹Ÿæœ‰å¯èƒ½ä¼šåŒ…å«ä¸€ä¸ªæœåŠ¡ç»„ï¼ˆä»£è¡¨å…¶ä»–çš„æœåŠ¡ç»„ï¼‰ã€‚  </p></blockquote><h2 id="å¤–å›´è®¾å¤‡æœåŠ¡çš„ç‰¹å¾"><a href="#å¤–å›´è®¾å¤‡æœåŠ¡çš„ç‰¹å¾" class="headerlink" title="å¤–å›´è®¾å¤‡æœåŠ¡çš„ç‰¹å¾"></a>å¤–å›´è®¾å¤‡æœåŠ¡çš„ç‰¹å¾</h2><p>å¤–å›´è®¾å¤‡çš„æœåŠ¡å¸¸å¸¸è¢«åˆ†è§£æˆæ›´ç»†åŒ–ä½†ç›¸å…³çš„ä¿¡æ¯ã€‚ç‰¹å¾é€šå¸¸æ˜¯æˆ‘ä»¬æ‰¾åˆ°é‡è¦ä¿¡æ¯ã€çœŸå®<em>æ•°æ®</em>çš„åœ°æ–¹ã€‚å†æ¬¡æŸ¥çœ‹ <a href="https://developer.apple.com/library/archive/documentation/NetworkingInternetWeb/Conceptual/CoreBluetooth_concepts/CoreBluetoothOverview/CoreBluetoothOverview.html#//apple_ref/doc/uid/TP40013257-CH2-SW17" target="_blank" rel="noopener"><strong>è‹¹æœ</strong></a> çš„è¯´æ˜ï¼š  </p><blockquote><p>æœåŠ¡æœ¬èº«æ˜¯ç”±ç‰¹å¾æˆ–åŒ…å«çš„æœåŠ¡ï¼ˆè¿™é‡ŒæŒ‡åˆ«çš„æœåŠ¡ï¼‰ç»„æˆã€‚ç‰¹å¾æ›´è¯¦ç»†çš„æä¾›äº†å¤–å›´è®¾å¤‡çš„æœåŠ¡ä¿¡æ¯ã€‚ä¾‹å¦‚ï¼Œåˆšæ‰æè¿°çš„å¿ƒç‡æœåŠ¡ï¼Œå¯èƒ½åŒ…å«ä¸€ä¸ªæè¿°è®¾å¤‡çš„å¿ƒç‡ä¼ æ„Ÿå™¨æ‰€åœ¨ç›®æ ‡èº«ä½“ä½ç½®çš„ç‰¹å¾å’Œå¦ä¸€ä¸ªä¼ é€’å¿ƒç‡æµ‹é‡æ•°æ®çš„ç‰¹å¾ã€‚  </p></blockquote><p>è®©æˆ‘ä»¬ç»§ç»­ä½¿ç”¨ HRM ä½œä¸ºä¾‹å­ã€‚è¯·è¿”å›é‚£ä¸ªç”¨ç²—ä½“å­—å†™ç€ <strong>Name: Heart Rateï¼ˆåå­—ï¼šå¿ƒç‡ï¼‰</strong> çš„ <a href="https://www.bluetooth.com/specifications/gatt/viewer?attributeXmlFile=org.bluetooth.service.heart_rate.xml" target="_blank" rel="noopener"><strong>ç•Œé¢</strong></a>ã€‚å‘ä¸‹æ»šåŠ¨ç›´åˆ°ä½ çœ‹åˆ° <strong>Service Characteristicsï¼ˆæœåŠ¡ç‰¹å¾ï¼‰</strong>ã€‚é‚£æ˜¯ä¸€ä¸ªåŒ…å«å¤§é‡å…ƒæ•°æ®ï¼ˆ<em>å…³äº</em>ä¿¡æ¯çš„æ•°æ®ï¼‰çš„å¤§è¡¨æ ¼ã€‚è¯·æ‰¾åˆ° <strong>Heart Rate Measurementï¼ˆå¿ƒç‡æµ‹é‡ï¼‰</strong> å¹¶ç‚¹å‡» <a href="https://www.bluetooth.com/specifications/gatt/viewer?attributeXmlFile=org.bluetooth.characteristic.heart_rate_measurement.xml" target="_blank" rel="noopener"><strong>org.bluetooth.characteristic.heart_rate_measurement</strong></a> ç„¶åå®¡æŸ¥ã€‚ç¨åæˆ‘ä¼šå¯¹è¿™ä¸ªç•Œé¢è¿›è¡Œè§£é‡Šã€‚  </p><p><strong><em>Core Bluetooth è§†è§’</em></strong><br>æ¥è‡ª <a href="https://developer.apple.com/documentation/corebluetooth/cbcharacteristic" target="_blank" rel="noopener"><strong>è‹¹æœçš„æ–‡æ¡£</strong></a>ï¼š </p><blockquote><p><a href="https://developer.apple.com/documentation/corebluetooth/cbcharacteristic" target="_blank" rel="noopener"><code>CBCharacteristic</code></a> å’Œå®ƒçš„å­ç±» <a href="https://developer.apple.com/documentation/corebluetooth/cbmutablecharacteristic" target="_blank" rel="noopener"><code>CBMutableCharacteristic</code></a> ä»£è¡¨å…³äºå¤–å›´è®¾å¤‡æœåŠ¡çš„è¯¦ç»†ä¿¡æ¯ã€‚<code>CBCharacteristic</code> å¯¹è±¡ç‰¹æŒ‡è¿œç¨‹å¤–å›´è®¾å¤‡ï¼ˆè¿œç¨‹å¤–å›´è®¾å¤‡ä½¿ç”¨ <code>CBPeripheral</code> å¯¹è±¡è¡¨ç¤ºï¼‰æœåŠ¡çš„ç‰¹å¾ã€‚ä¸€ä¸ªç‰¹å¾åŒ…å«ä¸€ä¸ªå•ä¸€çš„å€¼ä»¥åŠä»»æ„ä¸ªæè¿°ç¬¦æ¥æè¿°è¿™ä¸ªå€¼ã€‚ç‰¹å¾çš„å±æ€§æè¿°äº†å¦‚ä½•ä½¿ç”¨è¿™ä¸ªç‰¹å¾çš„å€¼ä»¥åŠå¦‚ä½•è®¿é—®è¿™äº›æè¿°ç¬¦ã€‚</p></blockquote><h2 id="GATT-è§„èŒƒ"><a href="#GATT-è§„èŒƒ" class="headerlink" title="GATT è§„èŒƒ"></a>GATT è§„èŒƒ</h2><p>å½“ä½ ä½¿ç”¨ <em>Core Bluetooth</em> å¼€å‘ä¸€æ¬¾éœ€è¦ä¸è“ç‰™å¤–å›´è®¾å¤‡äº¤äº’çš„åº”ç”¨ç¨‹åºæ—¶ï¼Œä½ é¦–å…ˆåº”è¯¥å‰å¾€ Bluetooth SIG çš„é¦–é¡µã€‚  </p><p>è®©æˆ‘ä»¬ä¸€èµ·å›é¡¾æˆ‘æ›¾ç»çš„ç»å†ï¼Œé‚£ä¼šæˆ‘åœ¨å¼€å‘ä¸€ä¸ªåº”ç”¨ç¨‹åºï¼Œç”¨ HRM åšäº†å„ç§å„æ ·éå¸¸å¥½ç©çš„åŠŸèƒ½ã€‚æŸ¥çœ‹ <a href="https://www.bluetooth.com/specifications/gatt" target="_blank" rel="noopener"><strong>GATT Specificationsï¼ˆGATT æŠ€æœ¯æŒ‡æ ‡ï¼‰</strong></a> éƒ¨åˆ†ï¼Œç„¶ååœ¨ <a href="https://www.bluetooth.com/specifications/gatt/services" target="_blank" rel="noopener"><strong>GATT Servicesï¼ˆGATT æœåŠ¡ï¼‰</strong></a> ä¸‹é¢æ‰¾åˆ°ä½ éœ€è¦çš„å¤–å›´è®¾å¤‡æœåŠ¡ã€‚  </p><p>åœ¨æœ¬æ–‡ä»‹ç»çš„ HRM ç¤ºä¾‹ä¸­ï¼Œé¦–å…ˆåœ¨ <a href="https://www.bluetooth.com/specifications/gatt/services" target="_blank" rel="noopener"><strong>GATT Servicesï¼ˆGATT æœåŠ¡ï¼‰</strong></a> ç•Œé¢çš„ <strong>Nameï¼ˆåå­—ï¼‰</strong> åˆ—ä¸­æ‰¾åˆ° â€œHeart Rateâ€ï¼ˆä¹Ÿå°±æ˜¯ä¸€ä¸ªè¶…é“¾æ¥ï¼‰é¡¹ã€‚ç‚¹å‡» <a href="https://www.bluetooth.com/specifications/gatt/viewer?attributeXmlFile=org.bluetooth.service.heart_rate.xml" target="_blank" rel="noopener"><strong>â€œHeart Rateï¼ˆå¿ƒç‡ï¼‰â€</strong></a> é“¾æ¥å¹¶ä¸”æŸ¥çœ‹å®Œæ•´çš„ç½‘ç«™ã€‚è¯·è®°ä½ <strong>Assigned Numberï¼ˆåˆ†é…ç¬¦ï¼‰</strong>ï¼ˆ0x180Dï¼‰ç„¶åæ»‘åŠ¨åˆ°åº•éƒ¨çš„ <strong>Service Characteristicsï¼ˆæœåŠ¡ç‰¹å¾ï¼‰</strong> è¡¨ã€‚ä»”ç»†çš„æŸ¥çœ‹è¡¨æ ¼å¹¶ä¸”æ‰¾åˆ°æœ‰å…´è¶£çš„ç‰¹å¾ã€‚  </p><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œé˜…è¯» <strong>Heart Rate Measurementï¼ˆå¿ƒç‡æµ‹é‡ï¼‰</strong> å’Œ <strong>Body Sensor Locationï¼ˆä¼ æ„Ÿå™¨æ‰€åœ¨èº«ä½“éƒ¨ä½ï¼‰</strong> åˆ†åŒºï¼Œç„¶åç‚¹å‡»å„è‡ªçš„è¯¦ç»†é“¾æ¥ï¼Œ<a href="https://www.bluetooth.com/specifications/gatt/viewer?attributeXmlFile=org.bluetooth.characteristic.heart_rate_measurement.xml" target="_blank" rel="noopener"><strong>org.bluetooth.characteristic.heart_rate_measurement</strong></a> å’Œ <a href="https://www.bluetooth.com/specifications/gatt/viewer?attributeXmlFile=org.bluetooth.characteristic.body_sensor_location.xml" target="_blank" rel="noopener"><strong>org.bluetooth.characteristic.body_sensor_location</strong></a>ã€‚  </p><p>åœ¨ <strong>Heart Rate Measurementï¼ˆå¿ƒç‡æµ‹é‡ï¼‰</strong> ä»¥åŠ <strong>Body Sensor Locationï¼ˆä¼ æ„Ÿå™¨æ‰€åœ¨èº«ä½“éƒ¨ä½ï¼‰</strong> ç•Œé¢ä¸­ï¼Œåˆ†åˆ«è®°ä½å®ƒä»¬çš„ <strong>Assigned Numberï¼ˆåˆ†é…ç¬¦ï¼‰</strong>ï¼Œï¼ˆ0x2A37ï¼‰å’Œï¼ˆ0x2A38ï¼‰ï¼Œç„¶åæŸ¥çœ‹ç•Œé¢ä¸­çš„æ‰€æœ‰ä¿¡æ¯ï¼Œä»¥ä¾¿äº†è§£å°†è¢«å‘é€åˆ°è¯¥ HRM åº”ç”¨ç¨‹åºä¸­çš„è“ç‰™ç¼–ç æ•°æ®ç»“æ„è¯¥å¦‚ä½•è§£è¯‘ã€‚ç¼–å†™ä»£ç æ—¶å¿…é¡»æŠŠè“ç‰™ç¼–ç æ•°æ®è½¬æ¢æˆäººç±»å¯è¯»çš„æ ¼å¼ã€‚  </p><p>éšç€æœ¬æ•™ç¨‹çš„æ·±å…¥ï¼Œæˆ‘å°†å‘ä½ ä»‹ç»æ›´å¤šç»†èŠ‚ï¼Œç‰¹åˆ«æ˜¯å½“æˆ‘å‘ä½ å±•ç¤ºï¼Œæˆ‘ç”¨æ¥ä¸ BLE HRM é€šä¿¡çš„åº”ç”¨ç¨‹åºä»£ç ã€‚  </p><p>å¦‚æœä½  <a href="https://www.bluetooth.com/develop-with-bluetooth/join" target="_blank" rel="noopener"><strong>åŠ å…¥</strong></a> Bluetooth SIG ï¼Œä½ å¯ä»¥è·å¾—æ›´å¤šå…³äºä½¿ç”¨æœåŠ¡å’Œç‰¹å¾è¿›è¡Œç¼–ç¨‹çš„è¯¦ç»†ä¿¡æ¯ã€‚  </p><h2 id="ç¼–å†™-Core-Bluetooth-ä»£ç "><a href="#ç¼–å†™-Core-Bluetooth-ä»£ç " class="headerlink" title="ç¼–å†™ Core Bluetooth ä»£ç "></a>ç¼–å†™ Core Bluetooth ä»£ç </h2><p>åœ¨è¿™æ¬¡è®¨è®ºä¸­ï¼Œæˆ‘å°†å‡è®¾ä½ äº†è§£ iOS åº”ç”¨ç¨‹åºå¼€å‘çš„åŸºç¡€çŸ¥è¯†ï¼ŒåŒ…æ‹¬ Swift ç¼–ç¨‹è¯­è¨€å’Œ Xcode <em>Single View App</em>ï¼ˆå•è§†å›¾åº”ç”¨ç¨‹åºï¼‰æ¨¡æ¿ã€‚æµ‹è¯•åº”ç”¨ç¨‹åºçš„ç”¨æˆ·ç•Œé¢ï¼ˆUIï¼‰ï¼ŒåŒ…æ‹¬ Auto Layoutï¼ˆè‡ªåŠ¨å¸ƒå±€ï¼‰ï¼Œä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼Œéå¸¸ç®€å•ã€‚  </p><p>æˆ‘å°†ç”¨ä¸€ç³»åˆ—æ­¥éª¤æ¥æè¿°ä»£ç  â€” è¿™äº›æ­¥éª¤åœ¨ä¸‹é¢çš„ä»£ç ä¸­<em>åŒæ ·</em>ä¼šè¢«è§£é‡Šã€‚å› æ­¤ï¼Œåœ¨é˜…è¯»æœ¬èŠ‚ä¸­çš„æ­¥éª¤æ—¶ï¼Œè¯·å‚é˜…ä¸‹é¢ä»£ç ä¸­å¯¹åº”çš„æ­¥éª¤ã€‚æ•´ä¸ªè¿‡ç¨‹åŸºæœ¬ä¸Šæ˜¯çº¿æ€§çš„ã€‚è¯·è®°ä½ï¼Œå…¶ä¸­ä¸€äº›æ­¥éª¤è¡¨ç¤ºå›è°ƒ â€” æ­£åœ¨è°ƒç”¨çš„å§”æ‰˜æ–¹æ³•ã€‚  </p><p>åœ¨ç¼–å†™åº”ç”¨ç¨‹åºæ—¶ï¼Œæˆ‘ä¼šå°† <a href="https://developer.apple.com/library/archive/documentation/NetworkingInternetWeb/Conceptual/CoreBluetooth_concepts/AboutCoreBluetooth/Introduction.html#//apple_ref/doc/uid/TP40013257-CH1-SW1" target="_blank" rel="noopener"><strong><em>Core Bluetooth</em></strong></a> ç»„ä»¶åˆ†è§£æˆåè®®æˆ–ç±» â€” ä¾‹å¦‚ï¼Œå°†æ ¸å¿ƒåŠŸèƒ½ä» UI ä¸­åˆ†ç¦»å‡ºæ¥ã€‚ä½†è¿™æ®µä»£ç çš„ç›®çš„æ˜¯å‘æ‚¨å±•ç¤º <em>Core Bluetooth</em> å¦‚ä½•åœ¨æœ€å°‘çš„å¹²æ‰°ä¸‹å·¥ä½œã€‚æˆ‘çš„æ³¨é‡Šå¾ˆç®€å•ï¼Œè€Œä¸”æœ‰å®é™…æ„ä¹‰ã€‚åœ¨ä¸€ä¸ªé¡µé¢ä¸­ä½ åªä¼šçœ‹åˆ°é‡è¦éƒ¨åˆ†ã€‚  </p><h2 id="ç¤ºä¾‹åº”ç”¨ç¨‹åºæ ·å¼"><a href="#ç¤ºä¾‹åº”ç”¨ç¨‹åºæ ·å¼" class="headerlink" title="ç¤ºä¾‹åº”ç”¨ç¨‹åºæ ·å¼"></a>ç¤ºä¾‹åº”ç”¨ç¨‹åºæ ·å¼</h2><p>é’ˆå¯¹è¿™ç¯‡æ–‡ç« æˆ‘æ‰€å¼€å‘çš„åº”ç”¨ç¨‹åº UI æå…¶ç®€å•ã€‚å½“åº”ç”¨ç¨‹åºè¢«å¯åŠ¨ï¼Œå®ƒå¼€å§‹æ‰«æå¹¶å°è¯•åŒ¹é…ä¸€ä¸ª HRMã€‚æ‰«æçš„è¿‡ç¨‹é€šè¿‡ <code>UIActivityIndicatorView</code> ç±»åœ¨å±å¹•ä¸Šæ˜¾ç¤ºå¹¶æ—‹è½¬æ¥è¡¨æ˜ã€‚å½“æ²¡æœ‰åŒ¹é…ä¸Šä»»ä¸€ HRM æ—¶ï¼Œé€šè¿‡ä¸€ä¸ªçº¢è‰²æ­£æ–¹å½¢çš„ <code>UIView</code> æ¥è¡¨æ˜ã€‚ä¸€æ—¦å‘ç°ä¸€ä¸ª HRM å¹¶åˆæ­¥é“¾æ¥ï¼Œ<code>UIActivityIndicatorView</code> åœæ­¢æ—‹è½¬å¹¶éšè—ï¼Œå¹¶ä¸”çº¢è‰² <code>UIView</code> è½¬å˜ä¸ºç»¿è‰²ã€‚å½“ HRM å®Œå…¨é“¾æ¥å¹¶è¢«è®¿é—®ï¼Œæˆ‘ä¼šæ˜¾ç¤º HRM çš„å“ç‰Œå‹å·å’Œç©¿æˆ´è€…æ”¾ç½®åœ¨èº«ä½“ä¸Šçš„é¢„å®šä½ç½®ã€‚æ­¤æ—¶æˆ‘ä¼šå¼€å§‹è¯»å–å¹¶ä¸”æ˜¾ç¤ºç©¿æˆ´è€…æ¯åˆ†é’Ÿçš„å¿ƒç‡ï¼Œå¤§çº¦æ¯ç§’æ›´æ–°ã€‚å¤§å¤šæ•° HRM éƒ½æ˜¯æ¯ç§’å‘é€ä¸€æ¬¡æ¯åˆ†é’Ÿå¿ƒç‡å€¼ã€‚æˆ‘äººä¸ºåœ°è®¾è®¡äº†ä¸€ä¸ªå¿ƒç‡æ•°å­—çš„è„‰å†²åŠ¨ç”»è®©åº”ç”¨çœ‹èµ·æ¥æ›´æœ‰å¸å¼•åŠ›ï¼Œä½†æ˜¯ä½ çœ‹åˆ°çš„æ˜¯æˆ‘<em>çœŸå®</em>çš„å¿ƒç‡ã€‚å½“ HRM æ–­å¼€é“¾æ¥ï¼Œæˆ‘æ¸…ç©ºæ‰€æœ‰çš„ä¿¡æ¯æ–‡æœ¬ï¼Œå°†æ­£æ–¹å½¢ <code>UIView</code> è½¬å˜ä¸ºçº¢è‰²ï¼Œæ˜¾ç¤º <code>UIActivityIndicatorView</code> å¹¶å¼€å§‹æ—‹è½¬ï¼ŒåŒæ—¶å†æ¬¡å¼€å§‹æ‰«æ HRMã€‚  </p><p>ä»¥ä¸‹æ˜¯æˆ‘çš„åº”ç”¨ç¨‹åºåœ¨ä¸ä¸‰ä¸ªä¸åŒå“ç‰Œçš„ HRM åŒ¹é…è¿è¡Œæ—¶çš„æ ·å¼ â€” Scosche Rhythm+ï¼ŒWahoo TICKRï¼Œè¿˜æœ‰Polar H7ï¼š  </p><p><img src="https://appcoda.com/wp-content/uploads/2018/04/hrm-demo-1024x433.png" alt>  </p><p>Rhythm+ ä½¿ç”¨çº¢å¤–å…‰â€œçœ‹â€æˆ‘çš„é™è„‰ä»¥ç¡®å®šå¿ƒç‡ã€‚TICKR å’Œ H7 ä½¿ç”¨ç”µææ£€æµ‹å‘Šè¯‰æˆ‘å¿ƒè·³çš„ç”µè„‰å†²ã€‚</p><h2 id="é€æ­¥äº†è§£æˆ‘çš„ä»£ç "><a href="#é€æ­¥äº†è§£æˆ‘çš„ä»£ç " class="headerlink" title="é€æ­¥äº†è§£æˆ‘çš„ä»£ç "></a>é€æ­¥äº†è§£æˆ‘çš„ä»£ç </h2><p>ä½ å¯ä»¥åœ¨ä¸‹ä¸€æ®µæ‰¾åˆ°å®Œæ•´çš„æºä»£ç ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘å°†å‘ä½ ä»‹ç»å®ç°æ­¥éª¤ã€‚  </p><p><strong>Step 0.00 ï¼š</strong> æˆ‘å¿…é¡»å¯¼å…¥ <code>CoreBluetooth</code> æ¡†æ¶ã€‚  </p><p><strong>Step 0.0 ï¼š</strong> æŒ‡å®š GATT ä¸­çš„ <strong>Assigned Numbersï¼ˆåˆ†é…ç¬¦ï¼‰</strong> ä¸ºå¸¸é‡ã€‚æˆ‘è¿™æ ·åšè®©è“ç‰™è§„èŒƒçš„æ ‡è¯†ç¬¦æ›´å…·å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ï¼Œé’ˆå¯¹ <a href="https://www.bluetooth.com/specifications/gatt/viewer?attributeXmlFile=org.bluetooth.service.heart_rate.xml" target="_blank" rel="noopener"><strong>â€œå¿ƒç‡â€</strong></a> æœåŠ¡ï¼Œå…¶ <a href="https://www.bluetooth.com/specifications/gatt/viewer?attributeXmlFile=org.bluetooth.characteristic.heart_rate_measurement.xml" target="_blank" rel="noopener"><strong>â€œå¿ƒç‡æµ‹é‡â€</strong></a> ç‰¹å¾ï¼Œè¿˜æœ‰å…¶ <a href="https://www.bluetooth.com/specifications/gatt/viewer?attributeXmlFile=org.bluetooth.characteristic.body_sensor_location.xml" target="_blank" rel="noopener"><strong>â€œèº«ä½“ä¼ æ„Ÿå™¨ä½ç½®â€</strong></a> ç‰¹å¾ã€‚  </p><p><strong>Step 0.1 ï¼š</strong> åˆ›å»ºä¸€ä¸ª <code>UIViewController</code> çš„å­ç±» <code>HeartRateMonitorViewController</code>ã€‚ä½¿ <code>HeartRateMonitorViewController</code> éµå®ˆ <a href="https://developer.apple.com/documentation/corebluetooth/cbcentralmanagerdelegate" target="_blank" rel="noopener"><code>**CBCentralManagerDelegate**</code></a> å’Œ <a href="https://developer.apple.com/documentation/corebluetooth/cbperipheraldelegate" target="_blank" rel="noopener"><code>**CBPeripheralDelegate**</code></a> åè®®ã€‚æˆ‘ä½¿ç”¨åè®®å’Œå§”æ‰˜çš„è®¾è®¡æ¨¡å¼ï¼Œæ­£å¦‚æˆ‘åœ¨ AppCoda æ–‡ç« ä¸­ <a href="https://appcoda.com/protocol-oriented-programming/" target="_blank" rel="noopener"><strong>è¿™é‡Œ</strong></a> è¿˜æœ‰ <a href="https://appcoda.com/swift-delegate/" target="_blank" rel="noopener"><strong>è¿™é‡Œ</strong></a> åˆ†åˆ«æè¿°çš„é‚£æ ·ã€‚æˆ‘ä»¬å°†å®ç°æ¥è‡ªä¸¤ä¸ªåè®®çš„æ–¹æ³•ã€‚æˆ‘ä»¬å°†è°ƒç”¨ä¸€äº› <em>Core Bluetooth</em> çš„æ–¹æ³•ï¼Œä¸€äº›æ–¹æ³•å°†ç”± <em>Core Bluetooth</em> ä¸ºæˆ‘ä»¬è°ƒç”¨ï¼Œä»¥å“åº”æˆ‘ä»¬è‡ªå·±çš„è°ƒç”¨ã€‚  </p><p><strong>Step 0.2 ï¼š</strong> æˆ‘ä»¬åœ¨ <code>HeartRateMonitorViewController</code> ç±»ä¸­å®šä¹‰å®ä¾‹å˜é‡ï¼Œå®ƒä»¬ä»£è¡¨ <code>CBCentralManager</code> å’Œ <code>CBPeripheral</code> ç±»ï¼Œæ‰€ä»¥å®ƒä»¬åœ¨åº”ç”¨ç¨‹åºçš„ç”Ÿå‘½å‘¨æœŸå†…éƒ½æ˜¯<em>æŒç»­å­˜åœ¨</em>çš„ã€‚  </p><p><strong>Step 1 ï¼š</strong> æˆ‘ä»¬ä¸ºè¿›ç¨‹åœ¨åå°åˆ›å»ºä¸€ä¸ªå¹¶å‘é˜Ÿåˆ—ã€‚æˆ‘å¸Œæœ› <em>Core Bluetooth</em> çš„è¿è¡Œå‘ç”Ÿåœ¨åå°ã€‚æˆ‘å¸Œæœ› UI ä¿æŒå“åº”ã€‚è¯´ä¸å®šï¼Œåœ¨ä¸€ä¸ªæ›´å¤æ‚çš„åº”ç”¨ç¨‹åºä¸­ï¼ŒHRM å¯èƒ½ä¼šè¿è¡Œæ•°å°æ—¶ï¼Œä¸ºç”¨æˆ·æ”¶é›†å¿ƒç‡æ•°æ®ã€‚ç”¨æˆ·å¯èƒ½å¸Œæœ›ä½¿ç”¨å…¶ä»–åº”ç”¨ç¨‹åºç‰¹æ€§ï¼Œä¾‹å¦‚ï¼Œä¿®æ”¹åº”ç”¨ç¨‹åºè®¾ç½®ï¼Œæˆ–è€…ï¼Œå¦‚æœç”¨æˆ·æ­£åœ¨è·‘æ­¥ï¼Œå¹¶ä¸”å¸Œæœ›ä½¿ç”¨ <code>Core Location</code> æ¥è·Ÿè¸ªè·‘æ­¥çš„è·¯çº¿ã€‚å› æ­¤ï¼Œåœ¨å¿ƒç‡æ•°æ®æ­£åœ¨æ”¶é›†å’Œæ˜¾ç¤ºçš„åŒæ—¶ï¼Œç”¨æˆ·å¯ä»¥æ”¶é›†å’Œ/æˆ–æŸ¥çœ‹ä»–ä»¬çš„åœ°ç†ä½ç½®ã€‚  </p><p><strong>Step 2 ï¼š</strong> åˆ›å»ºç”¨äºæ‰«æã€è¿æ¥ã€ç®¡ç†å’Œä»å¤–å›´è®¾å¤‡æ”¶é›†æ•°æ®çš„æ§åˆ¶ä¸­å¿ƒã€‚è¿™æ˜¯<em>å¿…è¦</em>çš„ä¸€æ­¥ã€‚ç¼ºå°‘äº†æ§åˆ¶ä¸­å¿ƒ <em>Core Bluetooth</em> å°†æ— æ³•å·¥ä½œã€‚å¦ä¸€ä¸ªå¿…è¦çš„ï¼šç”±äº <code>HeartRateMonitorViewController</code> é‡‡ç”¨äº† <code>CBCentralManagerDelegate</code>ï¼Œæˆ‘ä»¬å°† <code>centralManager</code> çš„å§”æ‰˜å±æ€§è®¾ç½®æˆ <code>HeartRateMonitorViewController</code>ï¼ˆ<code>self</code>ï¼‰ã€‚åŒæ—¶æˆ‘ä»¬è¿˜ä¸ºæ§åˆ¶ä¸­å¿ƒæŒ‡å®šäº† <code>DispatchQueue</code>ã€‚  </p><p><strong>Step 3.1 ï¼š</strong> <code>centralManagerDidUpdateState</code> æ–¹æ³•çš„è°ƒç”¨åŸºäºè®¾å¤‡çš„è“ç‰™çŠ¶æ€ã€‚ç†æƒ³æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åº”è¯¥è€ƒè™‘ä¸€ä¸ªåœºæ™¯ï¼Œåœ¨è¯¥åœºæ™¯ä¸­ï¼Œç”¨æˆ·æ— æ„ï¼ˆæˆ–æ•…æ„ï¼‰åœ¨ <code>Settingsï¼ˆè®¾ç½®ï¼‰</code> åº”ç”¨ç¨‹åºä¸­å…³é—­è“ç‰™ã€‚æˆ‘ä»¬<em>åªèƒ½</em>åœ¨è“ç‰™ä¸º <code>.poweredOn</code> çŠ¶æ€æ—¶æ‰èƒ½æ‰«æå¤–å›´è®¾å¤‡ã€‚  </p><p><strong>Step 3.2 ï¼š</strong> æ§åˆ¶ä¸­å¿ƒåº”è¯¥æ‰«ææ„Ÿå…´è¶£çš„å¤–å›´è®¾å¤‡ï¼Œä½†<em>å‰æ</em>æ˜¯è®¾å¤‡ï¼ˆå¦‚iPhoneï¼‰å¼€å¯äº†è“ç‰™ã€‚è¿˜è®°å¾—ä¸Šé¢æ ‡é¢˜ä¸ºâ€œé€šè¿‡å¹¿æ’­æ‰¾åˆ°å¤–å›´è®¾å¤‡â€çš„éƒ¨åˆ†å—ï¼Ÿæˆ‘ä»¬å°±æ˜¯è¿™æ ·å¤„ç†è¿™ä¸ªè°ƒç”¨çš„ã€‚æˆ‘ä»¬çš„ç›‘å¬<em>åª</em>é’ˆå¯¹æ­£åœ¨å¹¿æ’­ <a href="https://www.bluetooth.com/specifications/gatt/viewer?attributeXmlFile=org.bluetooth.service.heart_rate.xml" target="_blank" rel="noopener"><strong>å¿ƒç‡</strong></a> æœåŠ¡ï¼ˆ0x180Dï¼‰çš„ HRMã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡æ·»åŠ ç‰¹å®šæœåŠ¡çš„ <code>CBUUIDs</code> åˆ° <code>serviceUUIDs</code> æ•°ç»„å‚æ•°ï¼ˆæ ‡è®°ä¸º <code>withServices</code>ï¼‰ï¼Œä»è€Œè¾¾åˆ°ç›‘å¬å¹¶ä¸”è¿æ¥æ›´å¤šå¤–å›´è®¾å¤‡çš„ç›®çš„ã€‚ä¾‹å¦‚ï¼Œåœ¨ä¸€äº›å¥åº·ç›¸å…³çš„åº”ç”¨ç¨‹åºä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ç›‘å¬å¹¶è¿æ¥åˆ° HRM <em>å’Œ</em>è¡€å‹ç›‘æµ‹å™¨æˆ–è€… BPMï¼ˆå°½ç®¡æˆ‘ä»¬éœ€è¦å†åˆ›å»ºä¸€ä¸ª <code>CBPeripheral</code> ç±»çš„å®ä¾‹å˜é‡ï¼‰ã€‚æ³¨æ„ï¼Œå¦‚æœæˆ‘ä»¬åšäº†è¿™ä¸ªè°ƒç”¨ï¼š  </p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">centralManager?.scanForPeripherals(withServices: <span class="literal">nil</span>)</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥ç›‘å¬èŒƒå›´å†…<em>æ‰€æœ‰</em>è“ç‰™è®¾å¤‡çš„å¹¿æ’­ã€‚åœ¨ä¸€äº›è“ç‰™åŠŸèƒ½ç±»çš„åº”ç”¨ç¨‹åºä¸­å®ƒå¯èƒ½æœ‰ç”¨ã€‚  </p><p><strong>Step 4.1 ï¼š</strong> æ‰¾åˆ°è¿™ä¸ªåº”ç”¨ç¨‹åºå¯ä»¥è¿æ¥å“ªäº›<em>æ„Ÿå…´è¶£çš„</em>å¤–å›´è®¾å¤‡ï¼ˆHRMï¼‰ã€‚è¿™ä¸ª <code>didDiscover</code> æ–¹æ³•å‘Šè¯‰æˆ‘ä»¬ï¼Œåœ¨æ‰«ææ—¶ï¼Œæ§åˆ¶ä¸­å¿ƒå·²ç»å‘ç°äº†æ­£åœ¨å¹¿æ’­çš„ HRMã€‚  </p><p><strong>Step 4.2 ï¼š</strong> æˆ‘ä»¬<em>å¿…é¡»</em>åœ¨ç±»çš„å®ä¾‹å˜é‡ä¸­ä¿å­˜åˆšåˆšå‘ç°çš„å¤–å›´è®¾å¤‡çš„å¼•ç”¨ï¼Œå®ƒå°†æŒç»­å­˜åœ¨ã€‚å¦‚æœæˆ‘ä»¬ä»…ä»…åªæ˜¯ä½¿ç”¨äº†ä¸€ä¸ªå±€éƒ¨å˜é‡ï¼Œæˆ‘ä»¬ä¼šå€’éœ‰çš„ã€‚  </p><p><strong>Step 4.3 ï¼š</strong> å› ä¸º <code>HeartRateMonitorViewController</code> é‡‡ç”¨äº† <code>CBPeripheralDelegate</code> åè®®ï¼Œæ‰€ä»¥ <code>peripheralHeartRateMonitor</code> å¯¹è±¡å¿…é¡»å°†å®ƒçš„ <code>delegate</code> å±æ€§è®¾ç½®ä¸º <code>HeartRateMonitorViewController</code>ï¼ˆ<code>self</code>ï¼‰ã€‚  </p><p><strong>Step 5 ï¼š</strong> æˆ‘ä»¬åœ¨ <code>didDiscover</code> ä¸­å‘Šè¯‰æ§åˆ¶ä¸­å¿ƒåœæ­¢æ‰«æä»¥ä¾¿ä¿æŠ¤ç”µæ± å¯¿å‘½ã€‚å½“å·²ç»è¿æ¥çš„ HRM æˆ–å¤–å›´è®¾å¤‡æ–­å¼€è¿æ¥æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å†æ¬¡å¼€å¯æ‰«æã€‚  </p><p><strong>Step 6 ï¼š</strong> æ­¤æ—¶è¿˜åœ¨ <code>didDiscover</code> ä¸­ï¼Œæˆ‘ä»¬è¿æ¥åˆ°è¢«å‘ç°çš„æ„Ÿå…´è¶£çš„å¤–å›´è®¾å¤‡ï¼Œä¸€ä¸ª HRMã€‚  </p><p><strong>Step 7 ï¼š</strong> <code>didConnect</code> æ–¹æ³•<em>ä»…ä»…</em>â€œå½“æˆåŠŸä¸ä¸€ä¸ªå¤–å›´è®¾å¤‡è¿æ¥æ—¶è°ƒç”¨ã€‚â€è¯·æ³¨æ„â€œæˆåŠŸâ€è¿™ä¸ªè¯ã€‚å¦‚æœä½ å‘ç°ä¸€ä¸ªå¤–å›´è®¾å¤‡ä½†ä¸èƒ½è¿æ¥ï¼Œé‚£ä¹ˆä½ éœ€è¦è¿›è¡Œä¸€äº›è°ƒè¯•ã€‚è¯·æ³¨æ„æˆ‘æ›´æ–°äº† UI ç”¨æ¥æ˜¾ç¤ºæˆ‘è¿æ¥äº†é‚£ä¸ªå¤–å›´è®¾å¤‡ï¼Œå¹¶è¡¨æ˜æˆ‘å·²ç»åœæ­¢æ‰«æï¼Œä»¥åŠå…¶ä»–ä¸€äº›äº‹æƒ…ã€‚  </p><p><strong>Step 8 ï¼š</strong> æ­¤æ—¶è¿˜åœ¨ <code>didConnect</code> æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬åœ¨å¤–å›´è®¾å¤‡ä¸Šå¯»æ‰¾æ„Ÿå…´è¶£çš„æœåŠ¡ã€‚å…·ä½“æ¥è¯´ï¼Œæˆ‘ä»¬å¸Œæœ›æ‰¾åˆ° <a href="https://www.bluetooth.com/specifications/gatt/viewer?attributeXmlFile=org.bluetooth.service.heart_rate.xml" target="_blank" rel="noopener"><strong>Heart Rateï¼ˆå¿ƒç‡ï¼‰</strong></a>ï¼ˆ0x180Dï¼‰æœåŠ¡ã€‚  </p><p><strong>Step 9 ï¼š</strong> å½“ <code>didDiscoverServices</code> æ–¹æ³•è¢«è°ƒç”¨çš„æ—¶å€™ï¼Œè¯´æ˜åœ¨æˆ‘ä»¬æ‰€è¿æ¥çš„å¤–å›´è®¾å¤‡ä¸Šå‘ç°äº† <a href="https://www.bluetooth.com/specifications/gatt/viewer?attributeXmlFile=org.bluetooth.service.heart_rate.xml" target="_blank" rel="noopener"><strong>â€œHeart Rateï¼ˆå¿ƒç‡ï¼‰â€</strong></a> æœåŠ¡ã€‚è¯·è®°ä½æˆ‘ä»¬éœ€è¦å¯»æ‰¾æ„Ÿå…´è¶£çš„<em>ç‰¹å¾</em>ã€‚è¿™é‡Œæˆ‘å¯¹ <strong>Heart Rateï¼ˆå¿ƒç‡ï¼‰</strong> æœåŠ¡çš„æ‰€æœ‰ç‰¹å¾è¿›è¡Œäº†ä¸€æ¬¡å¾ªç¯ä»¥æ‰¾åˆ°æˆ‘æ¥ä¸‹æ¥è¦ç”¨çš„é‚£ä¸ªã€‚å¦‚æœä½ å‰å¾€ Bluetooth SIG ç½‘é¡µä¸­ <a href="https://www.bluetooth.com/specifications/gatt/viewer?attributeXmlFile=org.bluetooth.service.heart_rate.xml" target="_blank" rel="noopener"><strong>â€œHeart Rateï¼ˆå¿ƒç‡ï¼‰â€</strong></a> æœåŠ¡å¯¹åº”çš„é¡µé¢ï¼Œæ»šåŠ¨åˆ°ä¸‹é¢æ ‡è®°ä¸º <strong>Service Characteristicsï¼ˆæœåŠ¡ç‰¹å¾ï¼‰</strong> çš„åˆ†åŒºï¼Œå°±å¯ä»¥æŸ¥çœ‹é‚£ä¸‰ä¸ªå¯ç”¨çš„ç‰¹å¾ã€‚  </p><p><strong>Step 10 ï¼š</strong> <code>didDiscoverCharacteristicsFor service</code> æ–¹æ³•è¯æ˜æˆ‘ä»¬å·²ç»å‘ç°äº†æ„Ÿå…´è¶£çš„æœåŠ¡ä¸­æ‰€æœ‰çš„ç‰¹å¾ã€‚  </p><p><strong>Step 11 ï¼š</strong> é¦–å…ˆï¼Œæˆ‘è®¢é˜…äº†ä¸€ä¸ªé€šçŸ¥ - â€œreadâ€ - å…³äºæ„Ÿå…´è¶£çš„ <strong>Body Sensor Locationï¼ˆä¼ æ„Ÿå™¨æ‰€åœ¨èº«ä½“éƒ¨ä½ï¼‰</strong> ç‰¹å¾ã€‚å‰å¾€ <a href="https://www.bluetooth.com/specifications/gatt/viewer?attributeXmlFile=org.bluetooth.service.heart_rate.xml" target="_blank" rel="noopener"><strong>â€œHeart Rateï¼ˆå¿ƒç‡ï¼‰â€</strong></a> æœåŠ¡çš„é¡µé¢ï¼Œä½ ä¼šå‘ç°è¿™ä¸ªç‰¹å¾è¢«æ ‡è®°ä¸ºâ€œRead Mandatoryã€‚â€è°ƒç”¨ <code>peripheral.readValue</code> å°†ä¼šå¼•èµ· <code>peripheral:didUpdateValueForCharacteristic:error:</code> æ–¹æ³•ç¨åè¢«è°ƒç”¨ï¼Œæ‰€ä»¥æˆ‘å¯ä»¥å°†è¿™ä¸ªç‰¹å¾è§£ææˆäººç±»è¯­è¨€ã€‚å…¶æ¬¡ï¼Œæˆ‘è®¢é˜…äº†ä¸€ä¸ªå®šæœŸé€šçŸ¥ â€” â€œnotifyâ€ â€” å…³äºæ„Ÿå…´è¶£çš„ <strong>Heart Rate Measurementï¼ˆå¿ƒç‡æµ‹é‡ï¼‰</strong> ç‰¹å¾ã€‚å‰å¾€ <a href="https://www.bluetooth.com/specifications/gatt/viewer?attributeXmlFile=org.bluetooth.service.heart_rate.xml" target="_blank" rel="noopener"><strong>â€œHeart Rateï¼ˆå¿ƒç‡ï¼‰â€</strong></a> æœåŠ¡çš„é¡µé¢ï¼Œä½ ä¼šå‘ç°è¿™ä¸ªç‰¹å¾è¢«æ ‡è®°ä¸ºâ€œNotify Mandatoryã€‚â€è°ƒç”¨ <code>peripheral.setNotifyValue</code> å°†ä¼šå¼•èµ· <code>peripheral:didUpdateValueForCharacteristic:error:</code> æ–¹æ³•ç¨åè¢«è°ƒç”¨ï¼Œå¹¶ä¸”æ˜¯å‡ ä¹<em>æ¯ä¸€ç§’é’Ÿ</em>è§¦å‘ä¸€æ¬¡ï¼Œæ‰€ä»¥æˆ‘å¯ä»¥å°†è¿™ä¸ªç‰¹å¾è§£ææˆäººç±»è¯­è¨€ã€‚  </p><p><strong>Step 12 ï¼š</strong> å› ä¸ºæˆ‘å¯¹ç‰¹å¾ <strong>Body Sensor Locationï¼ˆä¼ æ„Ÿå™¨æ‰€åœ¨èº«ä½“éƒ¨ä½ï¼‰</strong> ï¼ˆ0x2A38ï¼‰è®¢é˜…äº†è¯»å–å€¼ï¼Œå¹¶ä¸”å¯¹ç‰¹å¾ <strong>Heart Rate Measurementï¼ˆå¿ƒç‡æµ‹é‡ï¼‰</strong> ï¼ˆ0x2A37ï¼‰è®¢é˜…äº†å®šæœŸè·å–é€šçŸ¥ï¼Œæ‰€ä»¥å¦‚æœå®ƒä»¬å‘é€å€¼æˆ–è€…å®šæœŸæ›´æ–°ï¼Œæˆ‘å°†åˆ†åˆ«è·å¾—è¿™ä¸¤ä¸ªäºŒè¿›åˆ¶å€¼ã€‚  </p><p><strong>Step 13 ï¼š</strong> å°† BLE <strong>Heart Rate Measurementï¼ˆå¿ƒç‡æµ‹é‡ï¼‰</strong> çš„æ•°æ®è§£è¯‘æˆäººä»¬å¯è¯»çš„æ ¼å¼ã€‚å‰å¾€ GATT è§„èŒƒçš„ <a href="https://www.bluetooth.com/specifications/gatt/viewer?attributeXmlFile=org.bluetooth.characteristic.heart_rate_measurement.xml" target="_blank" rel="noopener"><strong>é¡µé¢</strong></a> æ‰¾åˆ°è¿™ä¸ªç‰¹å¾ã€‚ç¬¬ä¸€ä¸ªå­—èŠ‚æ˜¯å…³äºå…¶ä½™æ•°æ®çš„å…ƒæ•°æ® (<strong>æ ‡è®°</strong>)ã€‚è§„èŒƒå‘Šè¯‰æˆ‘çœ‹ç¬¬ä¸€ä¸ªå­—èŠ‚çš„æœ€ä½æœ‰æ•ˆä½ï¼Œ<strong>Heart Rate Value Format bitï¼ˆå¿ƒç‡å€¼çš„æ ‡è¯†ä½ï¼‰</strong>ã€‚å¦‚æœæ˜¯ 0ï¼ˆzeroï¼‰ï¼Œæ¯åˆ†é’Ÿçš„å¿ƒè·³æ•°å°†ä»¥ <code>UINT8</code> æ ¼å¼åœ¨ç¬¬äºŒå­—èŠ‚ã€‚æˆ‘ä»æ¥æ²¡æœ‰é‡åˆ°è¿‡ä¸€ä¸ª HRM ä½¿ç”¨ç¬¬äºŒä¸ªå­—èŠ‚ä»¥å¤–çš„ä»»ä½•å­—èŠ‚ï¼Œæˆ‘åœ¨è¿™é‡Œæ¼”ç¤ºçš„ä¸‰ä¸ª HRM ä¹Ÿä¸ä¾‹å¤–ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘å¿½ç•¥äº† <strong>Heart Rate Value Format bitï¼ˆå¿ƒç‡å€¼çš„æ ‡è¯†ä½ï¼‰</strong> å€¼ä¸º 1ï¼ˆoneï¼‰çš„ç”¨ä¾‹ã€‚æˆ‘çœ‹è¿‡æ‰€æœ‰è¢«æåˆ°çš„å®ç°ï¼Œä½†ä»æ¥æ²¡æœ‰èƒ½å¤Ÿæµ‹è¯•è¿™äº›å®ç°ã€‚å¯¹äºæˆ‘æ— æ³•é‡ç°çš„æƒ…å†µï¼Œæˆ‘ä¸ä¼šå‘è¡¨ä»»ä½•çœ‹æ³•ã€‚  </p><p><strong>Step 14 ï¼š</strong> å°† BLE <strong>Body Sensor Locationï¼ˆä¼ æ„Ÿå™¨æ‰€åœ¨èº«ä½“éƒ¨ä½ï¼‰</strong> çš„æ•°æ®è§£è¯‘æˆäººä»¬å¯è¯»çš„æ ¼å¼ã€‚å‰å¾€ GATT è§„èŒƒçš„ <a href="https://www.bluetooth.com/specifications/gatt/viewer?attributeXmlFile=org.bluetooth.characteristic.body_sensor_location.xml" target="_blank" rel="noopener"><strong>é¡µé¢</strong></a> æ‰¾åˆ°è¿™ä¸ªç‰¹å¾ã€‚è¿™ä¸ªç‰¹å¾éå¸¸ç®€å•ã€‚å°†å€¼ 1ã€2ã€3ã€4ã€5ã€6 æˆ– 7 å­˜å‚¨åœ¨ 8 ä½ä¸­ã€‚å½¢æˆçš„æ–‡æœ¬å­—ç¬¦ä¸²ä¸è¿™äº›å€¼ä»¥è§£è¯‘ä¸ºç›®çš„çš„å±•ç¤ºæ˜¯ä¸€æ ·çš„ã€‚  </p><p><strong>Step 15 ï¼š</strong> å½“ä¸€ä¸ªå¤–å›´è®¾å¤‡ä»æ§åˆ¶ä¸­å¿ƒæ–­å¼€æ—¶ï¼Œé‡‡å–é€‚å½“çš„è¡ŒåŠ¨ã€‚æˆ‘æ›´æ–°æˆ‘çš„ UI ä»¥åŠâ€¦â€¦  </p><p><strong>Step 16 ï¼š</strong> å¼€å§‹æ‰«æï¼Œä¸ºäº†å‘ç°ä¸€ä¸ªæ­£åœ¨å¹¿æ’­ <strong>Heart Rateï¼ˆå¿ƒç‡ï¼‰</strong> æœåŠ¡ï¼ˆ0x180Dï¼‰çš„å¤–å›´è®¾å¤‡ã€‚  </p><h2 id="æˆ‘çš„æºä»£ç "><a href="#æˆ‘çš„æºä»£ç " class="headerlink" title="æˆ‘çš„æºä»£ç "></a>æˆ‘çš„æºä»£ç </h2><p>è¿™é‡Œæ˜¯å¯¹äºæˆ‘ä»¬åˆšåˆšæ‰€è®¨è®ºçš„å®ç°ï¼Œå®Œæ•´çš„æºä»£ç ï¼š<br><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"></span><br><span class="line"><span class="comment">// STEP 0.00: å¿…é¡»å¯¼å…¥ CoreBluetooth framework</span></span><br><span class="line"><span class="keyword">import</span> CoreBluetooth</span><br><span class="line"></span><br><span class="line"><span class="comment">// STEP 0.0: æŒ‡å®š GATT ä¸­çš„ "Assigned Numbers" ä¸ºå¸¸é‡ï¼Œè¿™æ ·å®ƒä»¬ä¼šæ‹¥æœ‰æ›´å¥½çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// MARK: - Core Bluetooth æœåŠ¡ ID</span></span><br><span class="line"><span class="keyword">let</span> <span class="type">BLE_Heart_Rate_Service_CBUUID</span> = <span class="type">CBUUID</span>(string: <span class="string">"0x180D"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// MARK: - Core Bluetooth ç‰¹å¾ ID</span></span><br><span class="line"><span class="keyword">let</span> <span class="type">BLE_Heart_Rate_Measurement_Characteristic_CBUUID</span> = <span class="type">CBUUID</span>(string: <span class="string">"0x2A37"</span>)</span><br><span class="line"><span class="keyword">let</span> <span class="type">BLE_Body_Sensor_Location_Characteristic_CBUUID</span> = <span class="type">CBUUID</span>(string: <span class="string">"0x2A38"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// STEP 0.1: è¿™ä¸ªç±»åŒæ—¶é‡‡ç”¨äº†æ§åˆ¶ä¸­å¿ƒå’Œå¤–å›´è®¾å¤‡çš„å§”æ‰˜åè®®ï¼Œæ‰€ä»¥å¿…é¡»éµå®ˆè¿™äº›åè®®çš„è¦æ±‚</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HeartRateMonitorViewController</span>: <span class="title">UIViewController</span>, <span class="title">CBCentralManagerDelegate</span>, <span class="title">CBPeripheralDelegate</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// MARK: - Core Bluetooth ç±»çš„æˆå‘˜å˜é‡</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// STEP 0.2: åˆ†åˆ«åˆ›å»º CBCentralManager å’Œ CBPeripheral çš„å®ä¾‹å˜é‡</span></span><br><span class="line">    <span class="comment">// æ‰€ä»¥å®ƒä»¬åœ¨åº”ç”¨ç¨‹åºçš„ç”Ÿå‘½å‘¨æœŸé‡ŒæŒç»­å­˜åœ¨</span></span><br><span class="line">    <span class="keyword">var</span> centralManager: <span class="type">CBCentralManager?</span></span><br><span class="line">    <span class="keyword">var</span> peripheralHeartRateMonitor: <span class="type">CBPeripheral?</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// MARK: - UI outlets / æˆå‘˜å˜é‡</span></span><br><span class="line">    </span><br><span class="line">    <span class="meta">@IBOutlet</span> <span class="keyword">weak</span> <span class="keyword">var</span> connectingActivityIndicator: <span class="type">UIActivityIndicatorView!</span></span><br><span class="line">    <span class="meta">@IBOutlet</span> <span class="keyword">weak</span> <span class="keyword">var</span> connectionStatusView: <span class="type">UIView!</span></span><br><span class="line">    <span class="meta">@IBOutlet</span> <span class="keyword">weak</span> <span class="keyword">var</span> brandNameTextField: <span class="type">UITextField!</span></span><br><span class="line">    <span class="meta">@IBOutlet</span> <span class="keyword">weak</span> <span class="keyword">var</span> sensorLocationTextField: <span class="type">UITextField!</span></span><br><span class="line">    <span class="meta">@IBOutlet</span> <span class="keyword">weak</span> <span class="keyword">var</span> beatsPerMinuteLabel: <span class="type">UILabel!</span></span><br><span class="line">    <span class="meta">@IBOutlet</span> <span class="keyword">weak</span> <span class="keyword">var</span> bluetoothOffLabel: <span class="type">UILabel!</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è®¾ç½® HealthKit </span></span><br><span class="line">    <span class="keyword">let</span> healthKitInterface = <span class="type">HealthKitInterface</span>()</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// MARK: - UIViewController delegate</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.viewDidLoad()</span><br><span class="line">        <span class="comment">// åœ¨è§†å›¾åŠ è½½å®Œæˆä»¥åï¼Œé€šå¸¸æ˜¯é€šè¿‡ä¸€ä¸ª nibï¼Œåšæ‰€æœ‰é™„åŠ çš„è®¾ç½®ã€‚</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// æœ€åˆï¼Œæˆ‘ä»¬åœ¨è¿›è¡Œæ‰«æå¹¶ä¸”æ²¡æœ‰äº§ç”Ÿè¿æ¥</span></span><br><span class="line">        connectingActivityIndicator.backgroundColor = <span class="type">UIColor</span>.white</span><br><span class="line">        connectingActivityIndicator.startAnimating()</span><br><span class="line">        connectionStatusView.backgroundColor = <span class="type">UIColor</span>.red</span><br><span class="line">        brandNameTextField.text = <span class="string">"----"</span></span><br><span class="line">        sensorLocationTextField.text = <span class="string">"----"</span></span><br><span class="line">        beatsPerMinuteLabel.text = <span class="string">"---"</span></span><br><span class="line">        <span class="comment">// ä»¥é˜² Bluetooth è¢«å…³é—­</span></span><br><span class="line">        bluetoothOffLabel.alpha = <span class="number">0.0</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// STEP 1: ä¸ºæ§åˆ¶ä¸­å¿ƒåœ¨åå°åˆ›å»ºä¸€ä¸ªå¹¶å‘é˜Ÿåˆ—</span></span><br><span class="line">        <span class="keyword">let</span> centralQueue: <span class="type">DispatchQueue</span> = <span class="type">DispatchQueue</span>(label: <span class="string">"com.iosbrain.centralQueueName"</span>, attributes: .concurrent)</span><br><span class="line">        <span class="comment">// STEP 2: åˆ›å»ºç”¨äºæ‰«æã€è¿æ¥ã€ç®¡ç†å’Œä»å¤–å›´è®¾å¤‡æ”¶é›†æ•°æ®çš„æ§åˆ¶ä¸­å¿ƒã€‚</span></span><br><span class="line">        centralManager = <span class="type">CBCentralManager</span>(delegate: <span class="keyword">self</span>, queue: centralQueue)</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// ä» HKHealthStore è¯»å–å¿ƒç‡æ•°æ®</span></span><br><span class="line">        <span class="comment">// healthKitInterface.readHeartRateData()</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// ä» HKHealthStore è¯»å–æ€§åˆ«ç±»å‹</span></span><br><span class="line">        <span class="comment">// healthKitInterface.readGenderType()</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">didReceiveMemoryWarning</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.didReceiveMemoryWarning()</span><br><span class="line">        <span class="comment">// å¤„ç†ä»»ä½•å¯ä»¥é‡æ–°åˆ›å»ºçš„èµ„æº</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// MARK: - CBCentralManagerDelegate methods</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// STEP 3.1: è¿™ä¸ªæ–¹æ³•çš„è°ƒç”¨åŸºäºè®¾å¤‡çš„è“ç‰™çŠ¶æ€ï¼› </span></span><br><span class="line">    <span class="comment">// ä»…åœ¨ Bluetooth ä¸º .poweredOn æ—¶æ‰å¯ä»¥æ‰«æå¤–å›´è®¾å¤‡</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">centralManagerDidUpdateState</span><span class="params">(<span class="number">_</span> central: CBCentralManager)</span></span> &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">switch</span> central.state &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">case</span> .unknown:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"Bluetooth status is UNKNOWN"</span>)</span><br><span class="line">            bluetoothOffLabel.alpha = <span class="number">1.0</span></span><br><span class="line">        <span class="keyword">case</span> .resetting:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"Bluetooth status is RESETTING"</span>)</span><br><span class="line">            bluetoothOffLabel.alpha = <span class="number">1.0</span></span><br><span class="line">        <span class="keyword">case</span> .unsupported:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"Bluetooth status is UNSUPPORTED"</span>)</span><br><span class="line">            bluetoothOffLabel.alpha = <span class="number">1.0</span></span><br><span class="line">        <span class="keyword">case</span> .unauthorized:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"Bluetooth status is UNAUTHORIZED"</span>)</span><br><span class="line">            bluetoothOffLabel.alpha = <span class="number">1.0</span></span><br><span class="line">        <span class="keyword">case</span> .poweredOff:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"Bluetooth status is POWERED OFF"</span>)</span><br><span class="line">            bluetoothOffLabel.alpha = <span class="number">1.0</span></span><br><span class="line">        <span class="keyword">case</span> .poweredOn:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"Bluetooth status is POWERED ON"</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="type">DispatchQueue</span>.main.async &#123; () -&gt; <span class="type">Void</span> <span class="keyword">in</span></span><br><span class="line">                <span class="keyword">self</span>.bluetoothOffLabel.alpha = <span class="number">0.0</span></span><br><span class="line">                <span class="keyword">self</span>.connectingActivityIndicator.startAnimating()</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// STEP 3.2: æ‰«ææˆ‘ä»¬æ„Ÿå…´è¶£çš„å¤–å›´è®¾å¤‡</span></span><br><span class="line">            centralManager?.scanForPeripherals(withServices: [<span class="type">BLE_Heart_Rate_Service_CBUUID</span>])</span><br><span class="line">            </span><br><span class="line">        &#125; <span class="comment">// END switch</span></span><br><span class="line">        </span><br><span class="line">    &#125; <span class="comment">// END func centralManagerDidUpdateState</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// STEP 4.1: æ‰¾åˆ°è¿™ä¸ªåº”ç”¨ç¨‹åºå¯ä»¥è¿æ¥å“ªäº›æ„Ÿå…´è¶£çš„å¤–å›´è®¾å¤‡</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">centralManager</span><span class="params">(<span class="number">_</span> central: CBCentralManager, didDiscover peripheral: CBPeripheral, advertisementData: [String : <span class="keyword">Any</span>], rssi RSSI: NSNumber)</span></span> &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">print</span>(peripheral.name!)</span><br><span class="line">        decodePeripheralState(peripheralState: peripheral.state)</span><br><span class="line">        <span class="comment">// STEP 4.2: å¿…é¡»å‚¨å­˜ä¸€ä¸ªå¤–å›´è®¾å¤‡çš„å¼•ç”¨åˆ°ç±»çš„å®ä¾‹å˜é‡ä¸­</span></span><br><span class="line">        peripheralHeartRateMonitor = peripheral</span><br><span class="line">        <span class="comment">// STEP 4.3: å› ä¸º HeartRateMonitorViewController é‡‡ç”¨äº† CBPeripheralDelegate åè®®ï¼Œ</span></span><br><span class="line">        <span class="comment">// æ‰€ä»¥ peripheralHeartRateMonitor å¿…é¡»è®¾ç½®ä»–çš„ </span></span><br><span class="line">        <span class="comment">// delegate å±æ€§ä¸º HeartRateMonitorViewController (self)</span></span><br><span class="line">        peripheralHeartRateMonitor?.delegate = <span class="keyword">self</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// STEP 5: åœæ­¢æ‰«æä»¥ä¿æŠ¤ç”µæ± çš„å¯¿å‘½ï¼›å½“æ–­å¼€é“¾æ¥çš„æ—¶å€™å†æ¬¡æ‰«æã€‚</span></span><br><span class="line">        centralManager?.stopScan()</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// STEP 6: ä¸å·²ç»å‘ç°çš„ï¼Œæ„Ÿå…´è¶£çš„å¤–å›´è®¾å¤‡å»ºç«‹è¿æ¥</span></span><br><span class="line">        centralManager?.connect(peripheralHeartRateMonitor!)</span><br><span class="line">        </span><br><span class="line">    &#125; <span class="comment">// END func centralManager(... didDiscover peripheral</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// STEP 7: â€œå½“ä¸€ä¸ªä¸å¤–å›´è®¾å¤‡çš„è¿æ¥è¢«æˆåŠŸåˆ›å»ºæ—¶è°ƒç”¨ã€‚â€</span></span><br><span class="line">    <span class="comment">// åªæœ‰å½“æˆ‘ä»¬çŸ¥é“ä¸å¤–å›´è®¾å¤‡çš„è¿æ¥å»ºç«‹æˆåŠŸä¹‹åæ‰èƒ½å‰å¾€ä¸‹ä¸€æ­¥</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">centralManager</span><span class="params">(<span class="number">_</span> central: CBCentralManager, didConnect peripheral: CBPeripheral)</span></span> &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="type">DispatchQueue</span>.main.async &#123; () -&gt; <span class="type">Void</span> <span class="keyword">in</span></span><br><span class="line">            </span><br><span class="line">            <span class="keyword">self</span>.brandNameTextField.text = peripheral.name!</span><br><span class="line">            <span class="keyword">self</span>.connectionStatusView.backgroundColor = <span class="type">UIColor</span>.green</span><br><span class="line">            <span class="keyword">self</span>.beatsPerMinuteLabel.text = <span class="string">"---"</span></span><br><span class="line">            <span class="keyword">self</span>.sensorLocationTextField.text = <span class="string">"----"</span></span><br><span class="line">            <span class="keyword">self</span>.connectingActivityIndicator.stopAnimating()</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// STEP 8: åœ¨å¤–å›´è®¾å¤‡ä¸Šå¯»æ‰¾æ„Ÿå…´è¶£çš„æœåŠ¡</span></span><br><span class="line">        peripheralHeartRateMonitor?.discoverServices([<span class="type">BLE_Heart_Rate_Service_CBUUID</span>])</span><br><span class="line"></span><br><span class="line">    &#125; <span class="comment">// END func centralManager(... didConnect peripheral</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// STEP 15: å½“ä¸€ä¸ªå¤–å›´è®¾å¤‡æ–­å¼€è¿æ¥ï¼Œä½¿ç”¨é€‚å½“çš„æ–¹æ³•</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">centralManager</span><span class="params">(<span class="number">_</span> central: CBCentralManager, didDisconnectPeripheral peripheral: CBPeripheral, error: Error?)</span></span> &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// print("Disconnected!")</span></span><br><span class="line">        </span><br><span class="line">        <span class="type">DispatchQueue</span>.main.async &#123; () -&gt; <span class="type">Void</span> <span class="keyword">in</span></span><br><span class="line">            </span><br><span class="line">            <span class="keyword">self</span>.brandNameTextField.text = <span class="string">"----"</span></span><br><span class="line">            <span class="keyword">self</span>.connectionStatusView.backgroundColor = <span class="type">UIColor</span>.red</span><br><span class="line">            <span class="keyword">self</span>.beatsPerMinuteLabel.text = <span class="string">"---"</span></span><br><span class="line">            <span class="keyword">self</span>.sensorLocationTextField.text = <span class="string">"----"</span></span><br><span class="line">            <span class="keyword">self</span>.connectingActivityIndicator.startAnimating()</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// STEP 16: åœ¨è¿™ä¸ªç”¨ä¾‹ä¸­ï¼Œå¼€å§‹æ‰«æç›¸åŒæˆ–å…¶ä»–çš„å¤–è®¾ï¼Œåªè¦å®ƒä»¬æ˜¯ HRMï¼Œå°±å¯ä»¥é‡æ–°è”æœº</span></span><br><span class="line">        centralManager?.scanForPeripherals(withServices: [<span class="type">BLE_Heart_Rate_Service_CBUUID</span>])</span><br><span class="line">        </span><br><span class="line">    &#125; <span class="comment">// END func centralManager(... didDisconnectPeripheral peripheral</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// MARK: - CBPeripheralDelegate methods</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">peripheral</span><span class="params">(<span class="number">_</span> peripheral: CBPeripheral, didDiscoverServices error: Error?)</span></span> &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> service <span class="keyword">in</span> peripheral.services! &#123;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> service.uuid == <span class="type">BLE_Heart_Rate_Service_CBUUID</span> &#123;</span><br><span class="line">                </span><br><span class="line">                <span class="built_in">print</span>(<span class="string">"Service: \(service)"</span>)</span><br><span class="line">                </span><br><span class="line">                <span class="comment">// STEP 9: åœ¨æ„Ÿå…´è¶£çš„æœåŠ¡ä¸­å¯»æ‰¾æ„Ÿå…´è¶£çš„ç‰¹å¾</span></span><br><span class="line">                peripheral.discoverCharacteristics(<span class="literal">nil</span>, <span class="keyword">for</span>: service)</span><br><span class="line">                </span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125; <span class="comment">// END func peripheral(... didDiscoverServices</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// STEP 10: ä»æ„Ÿå…´è¶£çš„æœåŠ¡ä¸­ï¼Œç¡®è®¤æˆ‘ä»¬æ‰€å‘ç°æ„Ÿå…´è¶£çš„ç‰¹å¾</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">peripheral</span><span class="params">(<span class="number">_</span> peripheral: CBPeripheral, didDiscoverCharacteristicsFor service: CBService, error: Error?)</span></span> &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> characteristic <span class="keyword">in</span> service.characteristics! &#123;</span><br><span class="line">            <span class="built_in">print</span>(characteristic)</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> characteristic.uuid == <span class="type">BLE_Body_Sensor_Location_Characteristic_CBUUID</span> &#123;</span><br><span class="line">                </span><br><span class="line">                <span class="comment">// STEP 11: è®¢é˜…å…³äºæ„Ÿå…´è¶£ç‰¹å¾çš„å•æ¬¡é€šçŸ¥ï¼›</span></span><br><span class="line">                <span class="comment">// â€œå½“ä½ ä½¿ç”¨è¿™ä¸ªæ–¹æ³•å»è¯»å–ç‰¹å¾çš„å€¼æ—¶ï¼Œå¤–å›´è®¾å¤‡å°†ä¼šè°ƒç”¨â€¦â€¦ </span></span><br><span class="line">                <span class="comment">// peripheral:didUpdateValueForCharacteristic:error:â€</span></span><br><span class="line">                <span class="comment">//</span></span><br><span class="line">                <span class="comment">// Read    Mandatory</span></span><br><span class="line">                <span class="comment">//</span></span><br><span class="line">                peripheral.readValue(<span class="keyword">for</span>: characteristic)</span><br><span class="line">                </span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> characteristic.uuid == <span class="type">BLE_Heart_Rate_Measurement_Characteristic_CBUUID</span> &#123;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// STEP 11: è®¢é˜…å…³äºæ„Ÿå…´è¶£ç‰¹å¾çš„æŒç»­é€šçŸ¥ï¼›</span></span><br><span class="line">                <span class="comment">// â€œå½“ä½ å¯ç”¨ç‰¹å¾å€¼çš„é€šçŸ¥æ—¶ï¼Œå¤–å›´è®¾å¤‡è°ƒç”¨â€¦â€¦</span></span><br><span class="line">                <span class="comment">// peripheral(_:didUpdateValueFor:error:)â€ </span></span><br><span class="line">                <span class="comment">//</span></span><br><span class="line">                <span class="comment">// Notify    Mandatory</span></span><br><span class="line">                <span class="comment">//</span></span><br><span class="line">                peripheral.setNotifyValue(<span class="literal">true</span>, <span class="keyword">for</span>: characteristic)</span><br><span class="line">                </span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">        &#125; <span class="comment">// END for</span></span><br><span class="line">        </span><br><span class="line">    &#125; <span class="comment">// END func peripheral(... didDiscoverCharacteristicsFor service</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// STEP 12: æ¯å½“ä¸€ä¸ªç‰¹å¾å€¼å®šæœŸæ›´æ–°æˆ–è€…å‘å¸ƒä¸€æ¬¡æ—¶ï¼Œæˆ‘ä»¬éƒ½ä¼šæ”¶åˆ°é€šçŸ¥ï¼›</span></span><br><span class="line">    <span class="comment">// é˜…è¯»å¹¶è§£è¯‘æˆ‘ä»¬è®¢é˜…çš„ç‰¹å¾å€¼</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">peripheral</span><span class="params">(<span class="number">_</span> peripheral: CBPeripheral, didUpdateValueFor characteristic: CBCharacteristic, error: Error?)</span></span> &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> characteristic.uuid == <span class="type">BLE_Heart_Rate_Measurement_Characteristic_CBUUID</span> &#123;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// STEP 13: é€šå¸¸æˆ‘ä»¬éœ€è¦å°† BLE çš„æ•°æ®è§£ææˆäººç±»å¯è¯»çš„æ ¼å¼</span></span><br><span class="line">            <span class="keyword">let</span> heartRate = deriveBeatsPerMinute(using: characteristic)</span><br><span class="line">            </span><br><span class="line">            <span class="type">DispatchQueue</span>.main.async &#123; () -&gt; <span class="type">Void</span> <span class="keyword">in</span></span><br><span class="line">                </span><br><span class="line">                <span class="type">UIView</span>.animate(withDuration: <span class="number">1.0</span>, animations: &#123;</span><br><span class="line">                    <span class="keyword">self</span>.beatsPerMinuteLabel.alpha = <span class="number">1.0</span></span><br><span class="line">                    <span class="keyword">self</span>.beatsPerMinuteLabel.text = <span class="type">String</span>(heartRate)</span><br><span class="line">                &#125;, completion: &#123; (<span class="literal">true</span>) <span class="keyword">in</span></span><br><span class="line">                    <span class="keyword">self</span>.beatsPerMinuteLabel.alpha = <span class="number">0.0</span></span><br><span class="line">                &#125;)</span><br><span class="line">                </span><br><span class="line">            &#125; <span class="comment">// END DispatchQueue.main.async...</span></span><br><span class="line"></span><br><span class="line">        &#125; <span class="comment">// END if characteristic.uuid ==...</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> characteristic.uuid == <span class="type">BLE_Body_Sensor_Location_Characteristic_CBUUID</span> &#123;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// STEP 14: é€šå¸¸æˆ‘ä»¬éœ€è¦å°† BLE çš„æ•°æ®è§£ææˆäººç±»å¯è¯»çš„æ ¼å¼</span></span><br><span class="line">            <span class="keyword">let</span> sensorLocation = readSensorLocation(using: characteristic)</span><br><span class="line"></span><br><span class="line">            <span class="type">DispatchQueue</span>.main.async &#123; () -&gt; <span class="type">Void</span> <span class="keyword">in</span></span><br><span class="line">                <span class="keyword">self</span>.sensorLocationTextField.text = sensorLocation</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="comment">// END if characteristic.uuid ==...</span></span><br><span class="line">        </span><br><span class="line">    &#125; <span class="comment">// END func peripheral(... didUpdateValueFor characteristic</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// MARK: - Utilities</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">deriveBeatsPerMinute</span><span class="params">(using heartRateMeasurementCharacteristic: CBCharacteristic)</span></span> -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">let</span> heartRateValue = heartRateMeasurementCharacteristic.value!</span><br><span class="line">        <span class="comment">// è½¬æ¢ä¸ºæ— ç¬¦å· 8 ä½æ•´æ•°æ•°ç»„</span></span><br><span class="line">        <span class="keyword">let</span> buffer = [<span class="type">UInt8</span>](heartRateValue)</span><br><span class="line"></span><br><span class="line">        <span class="comment">// UInt8: â€œä¸€ä¸ª 8 ä½æ— ç¬¦å·æ•´æ•°ç±»å‹ã€‚â€</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// åœ¨ç¼“å†²åŒºçš„ç¬¬ä¸€ä¸ªå­—èŠ‚ï¼ˆ8 ä½ï¼‰æ˜¯æ ‡è®°ï¼ˆå…ƒæ•°æ®ï¼Œç”¨äºç®¡ç†åŒ…ä¸­å…¶ä½™éƒ¨åˆ†ï¼‰ï¼›</span></span><br><span class="line">        <span class="comment">// å¦‚æœæœ€ä½æœ‰æ•ˆä½ï¼ˆLSBï¼‰æ˜¯ 0ï¼Œå¿ƒç‡ï¼ˆbpmï¼‰åˆ™æ˜¯ UInt8 æ ¼å¼ï¼Œ</span></span><br><span class="line">        <span class="comment">// å¦‚æœ LSB æ˜¯ 1ï¼ŒBPM åˆ™æ˜¯ UInt16</span></span><br><span class="line">        <span class="keyword">if</span> ((buffer[<span class="number">0</span>] &amp;amp; <span class="number">0x01</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">// ç¬¬äºŒä¸ªå­—èŠ‚ï¼šâ€œå¿ƒç‡çš„æ ¼å¼è¢«è®¾ç½®ä¸º UINT8â€</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"BPM is UInt8"</span>)</span><br><span class="line">            <span class="comment">// å°†å¿ƒç‡å†™å…¥ HKHealthStore</span></span><br><span class="line">            <span class="comment">// healthKitInterface.writeHeartRateData(heartRate: Int(buffer[1]))</span></span><br><span class="line">            <span class="keyword">return</span> <span class="type">Int</span>(buffer[<span class="number">1</span>])</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123; <span class="comment">// æˆ‘ä»æ¥æ²¡æœ‰çœ‹åˆ°è¿‡è¿™ä¸ªç”¨ä¾‹ï¼Œæ‰€ä»¥æˆ‘æŠŠå®ƒç•™ç»™ç†è®ºå­¦å®¶å»äº‰è®º</span></span><br><span class="line">            <span class="comment">// ç¬¬äºŒä¸ªå’Œç¬¬ä¸‰ä¸ªå­—èŠ‚ï¼šâ€œå¿ƒç‡çš„æ ¼å¼è¢«è®¾ç½®ä¸º UINT16â€</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"BPM is UInt16"</span>)</span><br><span class="line">            <span class="keyword">return</span> -<span class="number">1</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125; <span class="comment">// END func deriveBeatsPerMinute</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">readSensorLocation</span><span class="params">(using sensorLocationCharacteristic: CBCharacteristic)</span></span> -&gt; <span class="type">String</span> &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">let</span> sensorLocationValue = sensorLocationCharacteristic.value!</span><br><span class="line">        <span class="comment">//  è½¬æ¢ä¸ºæ— ç¬¦å· 8 ä½æ•´æ•°æ•°ç»„</span></span><br><span class="line">        <span class="keyword">let</span> buffer = [<span class="type">UInt8</span>](sensorLocationValue)</span><br><span class="line">        <span class="keyword">var</span> sensorLocation = <span class="string">""</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// åªçœ‹ 8 ä½</span></span><br><span class="line">        <span class="keyword">if</span> buffer[<span class="number">0</span>] == <span class="number">1</span></span><br><span class="line">        &#123;</span><br><span class="line">            sensorLocation = <span class="string">"Chest"</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> buffer[<span class="number">0</span>] == <span class="number">2</span></span><br><span class="line">        &#123;</span><br><span class="line">            sensorLocation = <span class="string">"Wrist"</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            sensorLocation = <span class="string">"N/A"</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> sensorLocation</span><br><span class="line">        </span><br><span class="line">    &#125; <span class="comment">// END func readSensorLocation</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">decodePeripheralState</span><span class="params">(peripheralState: CBPeripheralState)</span></span> &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">switch</span> peripheralState &#123;</span><br><span class="line">            <span class="keyword">case</span> .disconnected:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">"Peripheral state: disconnected"</span>)</span><br><span class="line">            <span class="keyword">case</span> .connected:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">"Peripheral state: connected"</span>)</span><br><span class="line">            <span class="keyword">case</span> .connecting:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">"Peripheral state: connecting"</span>)</span><br><span class="line">            <span class="keyword">case</span> .disconnecting:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">"Peripheral state: disconnecting"</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125; <span class="comment">// END func decodePeripheralState(peripheralState</span></span><br><span class="line"></span><br><span class="line">&#125; <span class="comment">// END class HeartRateMonitorViewController</span></span><br></pre></td></tr></table></figure></p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>æˆ‘å¸Œæœ›ä½ å–œæ¬¢è¿™ç¯‡æ•™ç¨‹ã€‚ä¹°æˆ–è€…å€Ÿä¸€ä¸ª BLE è®¾å¤‡ï¼Œç„¶åä½¿ç”¨æˆ‘çš„ä»£ç æˆ–è‡ªå·±ç¼–å†™ä»£ç æ¥è¿æ¥å®ƒã€‚éµå¾ªæ•™ç¨‹ä¸­æ‰€æœ‰æˆ‘æä¾›çš„è¶…é“¾æ¥å¹¶ä¸”é˜…è¯»å®ƒä»¬ã€‚æŸ¥é˜… Bluetooth SIG çš„ <a href="https://www.bluetooth.com/" target="_blank" rel="noopener"><strong>ç½‘é¡µ</strong></a> ä»¥åŠè‹¹æœçš„ <a href="https://developer.apple.com/documentation/corebluetooth" target="_blank" rel="noopener"><strong><em>Core Bluetooth</em></strong></a>ï¼ˆ<a href="https://developer.apple.com/library/archive/documentation/NetworkingInternetWeb/Conceptual/CoreBluetooth_concepts/AboutCoreBluetooth/Introduction.html#//apple_ref/doc/uid/TP40013257-CH1-SW1" target="_blank" rel="noopener"><strong>è¿™é‡Œ</strong></a> ä¹Ÿå¯ä»¥çœ‹åˆ°ï¼‰æ¡†æ¶æ–‡æ¡£ï¼Œä½ ä¸€å®šå¯ä»¥å¯¹è“ç‰™æŠ€æœ¯æœ‰ä¸€ä¸ªæ¦‚è§ˆã€‚  </p><p>æ„Ÿè°¢é˜…è¯»ã€‚è®°å¾—äº«å—ä½ çš„å·¥ä½œã€‚ä¸è¦å¿˜è®°ï¼Œå½“ä½ çš„ç®€å†ä¸Šé¢æœ‰è“ç‰™çš„ç»éªŒå°†æ˜¯ä½ çš„èŒä¸šç”Ÿæ¶¯çš„ä¸€å¤§äº®ç‚¹ã€‚  </p><p>ä½œä¸ºå‚è€ƒï¼Œä½ å¯ä»¥ <a href="https://github.com/appcoda/HealthKit-and-Bluetooth-HRM" target="_blank" rel="noopener"><strong>åœ¨ GitHub ä¸Šé¢æŸ¥çœ‹å®Œæ•´çš„æºä»£ç </strong></a>ã€‚</p><blockquote><p>æœ¬æ–‡ç”± SwiftGG ç¿»è¯‘ç»„ç¿»è¯‘ï¼Œå·²ç»è·å¾—ä½œè€…ç¿»è¯‘æˆæƒï¼Œæœ€æ–°æ–‡ç« è¯·è®¿é—® <a href="http://swift.gg">http://swift.gg</a>ã€‚</p></blockquote>]]></content>
    
    <summary type="html">
    
      è¯¦ç»†æè¿°äº†ä½¿ç”¨ Core Bluetooth çš„å…¨æµç¨‹ã€‚åŒ…æ‹¬æ³¨å†Œæˆä¸º Bluetooth SIG çš„ä¼šå‘˜ï¼Œä»¥åŠ GATT è§„èŒƒçš„æŸ¥é˜…ã€‚
    
    </summary>
    
      <category term="appcoda" scheme="https://swift.gg/categories/appcoda/"/>
    
    
      <category term="æ•™ç¨‹" scheme="https://swift.gg/tags/%E6%95%99%E7%A8%8B/"/>
    
  </entry>
  
  <entry>
    <title>Void</title>
    <link href="https://swift.gg/2019/02/25/void/"/>
    <id>https://swift.gg/2019/02/25/void/</id>
    <published>2019-02-25T00:00:00.000Z</published>
    <updated>2019-08-14T12:15:53.980Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ä½œè€…ï¼šMatttï¼Œ<a href="https://nshipster.com/void/" target="_blank" rel="noopener">åŸæ–‡é“¾æ¥</a>ï¼ŒåŸæ–‡æ—¥æœŸï¼š2018-10-31<br>è¯‘è€…ï¼š<a href="https://github.com/zhongWJ" target="_blank" rel="noopener">zhongWJ</a>ï¼›æ ¡å¯¹ï¼š<a href="http://numbbbbb.com/" target="_blank" rel="noopener">numbbbbb</a>ï¼Œ<a href="http://www.jianshu.com/users/596f2ba91ce9/latest_articles" target="_blank" rel="noopener">pmst</a>ï¼›å®šç¨¿ï¼š<a href="http://forelax.space" target="_blank" rel="noopener">Forelax</a></p></blockquote><!--æ­¤å¤„å¼€å§‹æ­£æ–‡--><p>ä» <a href="https://nshipster.com/nil/" target="_blank" rel="noopener">æˆ‘ä»¬ç¬¬ä¸€ç¯‡å…³äº Objective-C ä¸­çš„ <code>nil</code> çš„æ–‡ç« </a> åˆ° <a href="https://nshipster.com/never/" target="_blank" rel="noopener">æœ€è¿‘å¯¹ Swift ä¸­ <code>Never</code> ç±»å‹çš„ä¸€ç¥</a>ï¼Œâ€œä¸å­˜åœ¨â€ä¸€ç›´æ˜¯ NSHipster è®¨è®ºçš„è¯é¢˜ã€‚ä½†ä»Šå¤©çš„æ–‡ç« å¯èƒ½æ˜¯å®ƒä»¬å½“ä¸­å……æ–¥ç€æœ€å¤šå¦‚ <a href="https://en.wikipedia.org/wiki/Horror_vacui" target="_blank" rel="noopener">ææ€–ç•™ç™½</a> èˆ¬ç»†èŠ‚çš„ â€”â€” å› ä¸ºæˆ‘ä»¬å°†ç›®å…‰èšç„¦åœ¨äº† Swift ä¸­çš„ <code>Void</code> ä¸Šã€‚</p><a id="more"></a><p><code>Void</code> æ˜¯ä»€ä¹ˆï¼Ÿåœ¨ Swift ä¸­ï¼Œå®ƒåªä¸è¿‡æ˜¯ä¸€ä¸ªç©ºå…ƒç»„ã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">typealias</span> <span class="type">Void</span> = ()</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬ä½¿ç”¨ <code>Void</code> æ—¶æ‰ä¼šå¼€å§‹å…³æ³¨å®ƒã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> void: <span class="type">Void</span> = ()</span><br><span class="line">void. <span class="comment">// æ²¡æœ‰ä»£ç è¡¥å…¨æç¤º</span></span><br></pre></td></tr></table></figure><p><code>Void</code> ç±»å‹çš„å€¼æ²¡æœ‰æˆå‘˜ï¼šæ—¢æ²¡æœ‰æˆå‘˜æ–¹æ³•ï¼Œä¹Ÿæ²¡æœ‰æˆå‘˜å˜é‡ï¼Œç”šè‡³è¿åå­—éƒ½æ²¡æœ‰ã€‚å®ƒå¹¶ä¸æ¯” <code>nil</code> å¤šäº›ä»€ä¹ˆã€‚å¯¹äºä¸€ä¸ªç©ºå®¹å™¨ï¼ŒXcode ä¸ä¼šç»™æˆ‘ä»¬ä»»ä½•ä»£ç è¡¥å…¨æç¤ºã€‚</p><h2 id="ä¸ºâ€œä¸å­˜åœ¨â€è€Œç”Ÿä¹‹ç‰©"><a href="#ä¸ºâ€œä¸å­˜åœ¨â€è€Œç”Ÿä¹‹ç‰©" class="headerlink" title="ä¸ºâ€œä¸å­˜åœ¨â€è€Œç”Ÿä¹‹ç‰©"></a>ä¸ºâ€œä¸å­˜åœ¨â€è€Œç”Ÿä¹‹ç‰©</h2><p>åœ¨æ ‡å‡†åº“ä¸­ï¼Œ<code>Void</code> ç±»å‹æœ€æ˜¾è‘—å’Œå¥‡ç‰¹çš„ç”¨æ³•æ˜¯åœ¨ <code>ExpressibleByNilLiteral</code> åè®®ä¸­ã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">ExpressibleByNilLiteral</span> </span>&#123;</span><br><span class="line">    <span class="keyword">init</span>(nilLiteral: ())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>éµä» <code>ExpressibleByNilLiteral</code> åè®®çš„ç±»å‹å¯ä»¥ç”¨ <code>nil</code> å­—é¢é‡æ¥åˆå§‹åŒ–ã€‚å¤§å¤šæ•°ç±»å‹å¹¶ä¸éµä»è¿™ä¸ªåè®®ï¼Œå› ä¸ºç”¨ <code>Optional</code> æ¥è¡¨ç¤ºå€¼å¯èƒ½ä¸å­˜åœ¨ä¼šæ›´å®¹æ˜“ç†è§£ã€‚ä½†å¶å°”ä½ ä¹Ÿä¼šç¢°åˆ° <code>ExpressibleByNilLiteral</code>ã€‚</p><p><code>ExpressibleByNilLiteral</code> çš„æŒ‡å®šæ„é€ æ–¹æ³•ä¸æ¥æ”¶ä»»ä½•å®é™…å‚æ•°ã€‚ï¼ˆå‡è®¾æ¥æ”¶äº†ï¼Œé‚£ç»“æœä¼šæ€ä¹ˆæ ·ï¼Ÿï¼‰ç„¶è€Œï¼Œè¯¥åè®®çš„æŒ‡å®šæ„é€ æ–¹æ³•ä¸èƒ½ä»…ä»…åªæ˜¯ä¸€ä¸ªç©ºæ„é€ æ–¹æ³• <code>init()</code>ï¼Œå› ä¸ºå¾ˆå¤šç±»å‹ç”¨å®ƒä½œä¸ºé»˜è®¤æ„é€ æ–¹æ³•ã€‚</p><p>ä½ å¯ä»¥å°†æŒ‡å®šæ„é€ æ–¹æ³•æ”¹ä¸ºä¸€ä¸ªè¿”å› <code>nil</code> çš„ç±»å‹æ–¹æ³•ï¼ˆType Methodï¼‰æ¥å°è¯•è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä½†ä¸€äº›å¼ºåˆ¶å†…éƒ¨å¯è§çš„çŠ¶æ€åœ¨æ„é€ æ–¹æ³•å¤–å°±ä¸èƒ½ä½¿ç”¨äº†ã€‚åœ¨è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ä¸€ç§æ›´å¥½çš„è§£å†³æ–¹æ¡ˆï¼Œç»™æ„é€ æ–¹æ³•å¢åŠ ä¸€ä¸ªå¸¦ <code>Void</code> å‚æ•°çš„ <code>nilLiteral</code> æ ‡ç­¾ã€‚è¿™å·§å¦™çš„åˆ©ç”¨å·²æœ‰çš„åŠŸèƒ½æ¥å®ç°éå¸¸è§„çš„ç»“æœã€‚</p><h2 id="å¦‚ä½•æ¯”è¾ƒâ€œä¸å­˜åœ¨â€ä¹‹ç‰©"><a href="#å¦‚ä½•æ¯”è¾ƒâ€œä¸å­˜åœ¨â€ä¹‹ç‰©" class="headerlink" title="å¦‚ä½•æ¯”è¾ƒâ€œä¸å­˜åœ¨â€ä¹‹ç‰©"></a>å¦‚ä½•æ¯”è¾ƒâ€œä¸å­˜åœ¨â€ä¹‹ç‰©</h2><p>å…ƒç»„ä»¥åŠå…ƒç±»å‹ï¼ˆä¾‹å¦‚ <code>Int.Type</code>ï¼Œ<code>Int.self</code> è¿”å›ç»“æœï¼‰ï¼Œå‡½æ•°ç±»å‹ï¼ˆä¾‹å¦‚ <code>(String) -&gt; Bool</code>ï¼‰ï¼Œexistential ç±»å‹ï¼ˆä¾‹å¦‚ <code>Encodable &amp; Decodable</code>ï¼‰ç»„æˆäº†éæ­£å¼ç±»å‹ã€‚ä¸åŒ…å« swift å¤§éƒ¨åˆ†çš„æ­£å¼ç±»å‹æˆ–å‘½åç±»å‹ä¸åŒï¼Œéæ­£å¼ç±»å‹æ˜¯ç›¸å¯¹å…¶ä»–ç±»å‹æ¥å®šä¹‰çš„ã€‚</p><p>éæ­£å¼ç±»å‹ä¸èƒ½è¢«æ‰©å±•ã€‚<code>Void</code> æ˜¯ä¸€ä¸ªç©ºå…ƒç»„ï¼Œè€Œç”±äºå…ƒç»„æ˜¯éæ­£å¼ç±»å‹ï¼Œæ‰€ä»¥ä½ ä¸èƒ½ç»™ <code>Void</code> æ·»åŠ æ–¹æ³•ã€å±æ€§æˆ–è€…éµä»åè®®ã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Void</span> </span>&#123;&#125; <span class="comment">// éæ­£å¼ç±»å‹ `Void` ä¸èƒ½è¢«æ‰©å±•</span></span><br></pre></td></tr></table></figure><p><code>Void</code> ä¸éµä» <code>Equatable</code>åè®®ï¼Œå› ä¸ºå®ƒä¸èƒ½è¿™ä¹ˆåšã€‚ç„¶è€Œå½“æˆ‘ä»¬è°ƒç”¨ç­‰äºæ“ä½œç¬¦ï¼ˆ<code>==</code>ï¼‰æ—¶ï¼Œå®ƒå¦‚æˆ‘ä»¬æœŸæœ›çš„ä¸€æ ·è¿è¡Œæ­£ç¡®ã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">void == void <span class="comment">// true</span></span><br></pre></td></tr></table></figure><p>ä¸‹é¢è¿™ä¸ªå…¨å±€å‡½æ•°å®šä¹‰åœ¨æ‰€æœ‰æ­£å¼åè®®ä¹‹å¤–ï¼Œå®ƒå®ç°äº†è¿™ä¸ªçœ‹ä¼¼çŸ›ç›¾çš„è¡Œä¸ºã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> == <span class="params">(lhs: <span class="params">()</span></span></span>, rhs: ()) -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å°äºæ“ä½œç¬¦ï¼ˆ<code>&lt;</code>ï¼‰ä¹Ÿè¢«åŒæ ·å¤„ç†ï¼Œç”¨è¿™ç§æ–¹å¼æ¥æ›¿ä»£ <code>Comparable</code> åè®®åŠå…¶è¡ç”Ÿå‡ºçš„å…¶ä»–æ¯”è¾ƒæ“ä½œç¬¦ã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> &lt; (lhs: (), rhs: ()) -&gt; <span class="title">Bool</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>Swift æ ‡å‡†åº“ä¸ºå¤§å°æœ€å¤šä¸º 6 çš„å…ƒç»„æä¾›äº†æ¯”è¾ƒå‡½æ•°çš„å®ç°ã€‚ç„¶è€Œè¿™æ˜¯ä¸€ç§ hack æ–¹å¼ã€‚Swift æ ¸å¿ƒå›¢é˜Ÿåœ¨è®¸å¤šæ—¶å€™éƒ½æ˜¾éœ²è¿‡æƒ³è¦ç»™å…ƒç»„å¢åŠ å¯¹ <code>Equatable</code> åè®®çš„æ”¯æŒçš„å…´è¶£ï¼Œä½†åœ¨å®ç°çš„æ—¶å€™ï¼Œå¹¶æ²¡æœ‰è®¨è®ºè¿‡æ­£å¼çš„æè®®ã€‚</p></blockquote><h2 id="å£³ä¸­ä¹‹é¬¼"><a href="#å£³ä¸­ä¹‹é¬¼" class="headerlink" title="å£³ä¸­ä¹‹é¬¼"></a>å£³ä¸­ä¹‹é¬¼</h2><p>ä½œä¸ºéæ­£å¼ç±»å‹ï¼Œ<code>Void</code> ä¸èƒ½è¢«æ‰©å±•ã€‚ä½† <code>Void</code> æ¯•ç«Ÿæ˜¯ä¸€ä¸ªç±»å‹ï¼Œæ‰€ä»¥èƒ½è¢«å½“ä½œæ³›å‹çº¦æŸæ¥ä½¿ç”¨ã€‚</p><p>ä¾‹å¦‚ï¼Œè€ƒè™‘ä»¥ä¸‹å•ä¸ªå€¼çš„æ³›å‹å®¹å™¨ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Wrapper</span>&lt;<span class="title">Value</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> value: <span class="type">Value</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“æ³›å‹å®¹å™¨æ‰€åŒ…è£…çš„å€¼çš„ç±»å‹æœ¬èº«éµå¾ª <code>Equatable</code> åè®®æ—¶ï¼Œåˆ©ç”¨ Swift 4.1 çš„æ€æ‰‹é”ç‰¹æ€§ <a href="https://swift.org/blog/conditional-conformance/" target="_blank" rel="noopener">æ¡ä»¶éµå¾ª</a>ï¼Œæˆ‘ä»¬é¦–å…ˆå¯ä»¥æ‰©å±• <code>Wrapper</code> è®©å…¶æ”¯æŒ <code>Equatable</code> åè®®ã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Wrapper</span>: <span class="title">Equatable</span> <span class="title">where</span> <span class="title">Value</span>: <span class="title">Equatable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> ==<span class="params">(lhs: Wrapper&lt;Value&gt;, rhs: Wrapper&lt;Value&gt;)</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> lhs.value == rhs.value</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ©ç”¨åŒä¹‹å‰ä¸€æ ·çš„æŠ€å·§ï¼Œæˆ‘ä»¬å¯ä»¥å®ç°ä¸€ä¸ªæ¥å— <code>Wrapper&lt;Void&gt;</code> å‚æ•°çš„ <code>==</code> å…¨å±€å‡½æ•°ï¼Œæ¥è¾¾åˆ°å’Œ <code>Equatable</code> åè®®å‡ ä¹ä¸€æ ·çš„æ•ˆæœã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> ==<span class="params">(lhs: Wrapper&lt;Void&gt;, rhs: Wrapper&lt;Void&gt;)</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ¯”è¾ƒä¸¤ä¸ªåŒ…è£…äº† <code>Void</code> å€¼çš„ <code>Wrapper</code>ã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="type">Wrapper</span>(value: void) == <span class="type">Wrapper</span>(value: void) <span class="comment">// true</span></span><br></pre></td></tr></table></figure><p>ç„¶è€Œï¼Œå½“æˆ‘ä»¬å°è¯•å°†è¿™æ ·ä¸€ä¸ªåŒ…è£…å€¼èµ‹å€¼ç»™ä¸€ä¸ªå˜é‡æ—¶ï¼Œç¼–è¯‘å™¨ä¼šç”Ÿæˆè¯¡å¼‚çš„é”™è¯¯ã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> wrapperOfVoid = <span class="type">Wrapper</span>&lt;<span class="type">Void</span>&gt;(value: void)</span><br><span class="line"><span class="comment">// ğŸ‘» é”™è¯¯: ä¸èƒ½èµ‹å€¼:</span></span><br><span class="line"><span class="comment">// ç”±äºæ‰¾ä¸åˆ°å¯¹åº”ç¬¦å·ï¼Œæ— æ³•é”€æ¯ wrapperOfVoid</span></span><br></pre></td></tr></table></figure><p><code>Void</code> çš„å¯æ€•ä¹‹å¤„åè¿‡æ¥å†æ¬¡è‡ªæˆ‘å¦å®šã€‚</p><h2 id="å¹½çµç±»å‹"><a href="#å¹½çµç±»å‹" class="headerlink" title="å¹½çµç±»å‹"></a>å¹½çµç±»å‹</h2><p>å³ä½¿ä½ ä¸æ•¢æåŠå®ƒçš„éæ­£å¼åå­—ï¼Œä½ ä¾ç„¶é€ƒä¸è¿‡ <code>Void</code> çš„æŒå¿ƒã€‚</p><p>ä»»ä½•æ²¡æœ‰æ˜¾å¼å£°æ˜è¿”å›å€¼çš„å‡½æ•°ä¼šéšå¼çš„è¿”å›ä¸€ä¸ª <code>Void</code>ã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">doSomething</span><span class="params">()</span></span> &#123; ... &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç­‰åŒäº</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">doSomething</span><span class="params">()</span></span> -&gt; <span class="type">Void</span> &#123; ... &#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªè¡Œä¸ºå¾ˆå¥‡æ€ªï¼Œä½†ä¸æ˜¯ç‰¹åˆ«æœ‰ç”¨ã€‚å¹¶ä¸”å½“ä½ å°†ä¸€ä¸ªè¿”å› <code>Void</code> ç±»å‹çš„å‡½æ•°çš„è¿”å›å€¼èµ‹å€¼ç»™ä¸€ä¸ªå˜é‡æ—¶ï¼Œç¼–è¯‘å™¨ä¼šç”Ÿæˆä¸€ä¸ªè­¦å‘Šã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">doSomething() <span class="comment">// æ²¡æœ‰è­¦å‘Š</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> result = doSomething()</span><br><span class="line"><span class="comment">// âš ï¸ å¸¸é‡ `result` æŒ‡å‘çš„æ˜¯ä¸€ä¸ª `Void` ç±»å‹çš„å€¼ï¼Œè¿™ç§è¡Œä¸ºçš„ç»“æœä¸å¯é¢„æµ‹</span></span><br></pre></td></tr></table></figure><p>ä½ å¯ä»¥æ˜¾å¼æŒ‡å®šå˜é‡ç±»å‹ä¸º <code>Void</code> æ¥æ¶ˆé™¤è­¦å‘Šã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> result: <span class="type">Void</span> = doSomething() <span class="comment">// ()</span></span><br></pre></td></tr></table></figure><blockquote><p>ç›¸åçš„ï¼Œå½“å‡½æ•°çš„è¿”å›å€¼ç±»å‹ä¸ºé <code>Void</code> æ—¶ï¼Œä½ å¦‚æœä¸å°†è¿”å›å€¼èµ‹å€¼ç»™å…¶ä»–å˜é‡ï¼Œç¼–è¯‘å™¨ä¹Ÿä¼šäº§ç”Ÿè­¦å‘Šã€‚æ›´å¤šè¯¦æƒ…å¯ä»¥å‚è€ƒ <a href="https://github.com/apple/swift-evolution/blob/master/proposals/0047-nonvoid-warn.md" target="_blank" rel="noopener">SE-0047 â€œé»˜è®¤å½“é <code>Void</code> å‡½æ•°è¿”å›ç»“æœæœªä½¿ç”¨æ—¶å‘Šè­¦â€</a>ã€‚</p></blockquote><h2 id="è¯•ç€ä»-Void-æ¢å¤è¿‡æ¥"><a href="#è¯•ç€ä»-Void-æ¢å¤è¿‡æ¥" class="headerlink" title="è¯•ç€ä» Void æ¢å¤è¿‡æ¥"></a>è¯•ç€ä» Void æ¢å¤è¿‡æ¥</h2><p>å¦‚æœä½ æ–œè§† <code>Void?</code>ï¼Œæ—¶é—´è¶³å¤Ÿé•¿ï¼Œä½ å¯èƒ½ä¼šå°†å®ƒå’Œ <code>Bool</code> å¼„æ··ã€‚è¿™ä¸¤ç§ç±»å‹ç±»ä¼¼ï¼Œéƒ½ä»…æœ‰ä¸¤ç§çŠ¶æ€ï¼š<code>true</code> / <code>.some(())</code> ä»¥åŠ <code>false</code> / <code>.none</code>ã€‚</p><p>ä½†ç±»ä¼¼å¹¶ä¸æ„å‘³ç€ä¸€æ ·ã€‚å®ƒä»¬ä¸¤æœ€æ˜æ˜¾çš„ä¸åŒæ˜¯ï¼Œ<code>Bool</code> éµå¾ª <code>ExpressibleByBooleanLiteral</code> åè®®ï¼Œè€Œ <code>Void</code> ä¸æ˜¯ä¹Ÿä¸èƒ½éµå¾ª <code>ExpressibleByBooleanLiteral</code> åè®®ï¼Œå’Œå®ƒä¸èƒ½éµå¾ª <code>Equatable</code> åè®®çš„åŸå› ä¸€æ ·ã€‚æ‰€ä»¥ä½ ä¸èƒ½è¿™æ ·åšï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">(<span class="literal">true</span> <span class="keyword">as</span> <span class="type">Void?</span>) <span class="comment">// é”™è¯¯</span></span><br></pre></td></tr></table></figure><blockquote><p><code>Void</code> å¯èƒ½æ˜¯ Swift ä¸­æœ€ä»¤äººæ¯›éª¨æ‚šçš„ç±»å‹äº†ã€‚ä½†æ˜¯å½“ç»™ <code>Bool</code> èµ·ä¸€ä¸ª <code>Booooooool</code> åˆ«åæ—¶ï¼Œ å°±å’Œ <code>Void</code> ä¸ç›¸ä¸Šä¸‹äº†ã€‚</p></blockquote><p>ä½† <code>Void?</code> ç¡¬å³çš„è¯æ˜¯èƒ½å¤Ÿè¡¨ç°çš„åƒ <code>Bool</code> ä¸€æ ·ã€‚æ¯”å¦‚ä¸‹é¢è¿™ä¸ªéšæœºæŠ›å‡ºé”™è¯¯çš„å‡½æ•°ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Failure</span>: <span class="title">Error</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">failsRandomly</span><span class="params">()</span></span> <span class="keyword">throws</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> <span class="type">Bool</span>.random() &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="type">Failure</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ­£ç¡®æ–¹å¼æ˜¯ï¼Œåœ¨ä¸€ä¸ª <code>do / catch</code> ä»£ç å—ä¸­ç”¨ <code>try</code> è¡¨è¾¾å¼æ¥è°ƒç”¨è¿™ä¸ªå‡½æ•°ã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> failsRandomly()</span><br><span class="line">    <span class="comment">// æˆåŠŸæ‰§è¡Œ</span></span><br><span class="line">&#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">    <span class="comment">// å¤±è´¥æ‰§è¡Œ</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>failsRandomly()</code> éšå¼è¿”å› <code>Void</code>ï¼Œåˆ©ç”¨è¿™ä¸€äº‹å®å¯ä»¥è¾¾åˆ°åŒæ ·æ•ˆæœï¼Œè™½ç„¶ä¸æ­£ç¡®ä½†è¡¨é¢ä¸Šå¯è¡Œã€‚<code>try?</code> è¡¨è¾¾å¼ä¼šå¤„ç†å¯èƒ½æŠ›å‡ºå¼‚å¸¸çš„è¯­å¥ï¼Œå°†ç»“æœåŒ…è£…ä¸ºä¸€ä¸ªå¯é€‰ç±»å‹å€¼ã€‚å¯¹äº <code>failsRandomly()</code> è¿™ç§æƒ…å†µè€Œè¨€ï¼Œç»“æœæ˜¯ <code>Void?</code>ã€‚å‡å¦‚ <code>Void?</code> æœ‰ <code>.some</code> å€¼ï¼ˆå³ï¼Œ<code>!= nil</code>ï¼‰ï¼Œè¿™æ„å‘³ç€å‡½æ•°æ²¡æœ‰å‡ºé”™ç›´æ¥è¿”å›ã€‚å¦‚æœ <code>success</code> æ˜¯ <code>nil</code>ï¼Œé‚£æˆ‘ä»¬å°±çŸ¥é“å‡½æ•°ç”Ÿæˆäº†ä¸€ä¸ªé”™è¯¯ã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> success: <span class="type">Void?</span> = <span class="keyword">try</span>? failsRandomly()</span><br><span class="line"><span class="keyword">if</span> success != <span class="literal">nil</span> &#123;</span><br><span class="line">    <span class="comment">// æˆåŠŸæ‰§è¡Œ</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// å¤±è´¥æ‰§è¡Œ</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¾ˆå¤šäººå¯èƒ½ä¸å–œæ¬¢ <code>do / catch</code> ä»£ç å—ï¼Œä½†ä½ ä¸å¾—ä¸æ‰¿è®¤ï¼Œç›¸æ¯”è¿™é‡Œçš„ä»£ç ï¼Œ<code>do / catch</code> ä»£ç å—æ›´åŠ ä¼˜é›…ã€‚</p><p>åœ¨æŸäº›ç‰¹æ®Šåœºæ™¯ä¸‹ï¼Œè¿™ç§å˜é€šæ–¹å¼å¯èƒ½ä¼šå¾ˆæœ‰ç”¨ã€‚ä¾‹å¦‚ä¸ºäº†ä¿å­˜æ¯ä¸€æ¬¡è‡ªè¯„ä¼°é—­åŒ…æ‰§è¡Œçš„å‰¯ä½œç”¨ï¼Œä½ å¯ä»¥åœ¨ç±»ä¸Šä½¿ç”¨é™æ€å±æ€§ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">var</span> oneTimeSideEffect: <span class="type">Void?</span> = &#123;</span><br><span class="line">   <span class="keyword">return</span> <span class="keyword">try</span>? data.write(to: fileURL)</span><br><span class="line">&#125;()</span><br></pre></td></tr></table></figure><p>è™½ç„¶è¿™æ ·å¯è¡Œï¼Œä½†æ›´å¥½çš„åŠæ³•æ˜¯ä½¿ç”¨ <code>Error</code> å’Œ <code>Bool</code> ç±»å‹ã€‚</p><h2 id="å¤œæ™šæ‰ä¼šå“ï¼ˆâ€Clangâ€ï¼‰çš„ä¸œè¥¿"><a href="#å¤œæ™šæ‰ä¼šå“ï¼ˆâ€Clangâ€ï¼‰çš„ä¸œè¥¿" class="headerlink" title="å¤œæ™šæ‰ä¼šå“ï¼ˆâ€Clangâ€ï¼‰çš„ä¸œè¥¿"></a>å¤œæ™šæ‰ä¼šå“ï¼ˆâ€Clangâ€ï¼‰çš„ä¸œè¥¿</h2><p>å½“è¯»åˆ°è¿™ä¹ˆä»¤äººå‘å¯’çš„æè¿°æ—¶ï¼Œå¦‚æœä½ å¼€å§‹æ‰“å¯’é¢¤äº†ï¼Œä½ å¯ä»¥å¼•å¯¼ <code>Void</code> ç±»å‹çš„åæ­»èƒ½é‡æ¥å¬å”¤å·¨å¤§çš„çƒ­é‡ç»™è‡ªå·±çš„ç²¾ç¥åŠ çƒ­ï¼š</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œé€šè¿‡ä»¥ä¸‹ä»£ç è®© <code>lldb-rpc-server</code> å…¨åŠ›å¼€å¯ CPUï¼ˆè¯‘è€…æ³¨ï¼šç¼–è¯‘å™¨ä¼šå¡æ­»ï¼‰ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Optional</span>: <span class="title">ExpressibleByBooleanLiteral</span> <span class="title">where</span> <span class="title">Wrapped</span> == <span class="title">Void</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">typealias</span> <span class="type">BooleanLiteralType</span> = <span class="type">Bool</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">init</span>(booleanLiteral value: <span class="type">Bool</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> value &#123;</span><br><span class="line">            <span class="keyword">self</span>.<span class="keyword">init</span>(())!</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">self</span>.<span class="keyword">init</span>(nilLiteral: ())!</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> pseudoBool: <span class="type">Void?</span> = <span class="literal">true</span> <span class="comment">// æˆ‘ä»¬æ°¸è¿œéƒ½ä¸ä¼šå‘ç°æ˜¯è¿™é‡Œå¯¼è‡´çš„</span></span><br></pre></td></tr></table></figure><p>æŒ‰ç…§æ´›å¤«å…‹æ‹‰å¤«ç‰¹å¼ææ€–å°è¯´çš„ä¼ ç»Ÿï¼Œ<code>Void</code> æœ‰ä¸€ä¸ªè®¡ç®—æœºæ— æ³•å¤„ç†çš„ç‰©ç†ç»“æ„ï¼›æˆ‘ä»¬ç®€å•åœ°è§è¯äº†å®ƒå¦‚ä½•ä½¿ä¸€ä¸ªè¿›ç¨‹æ— å¯æ•‘è¯çš„ç–¯ç‹‚ã€‚</p><h2 id="å¾’æœ‰å…¶è¡¨çš„èƒœåˆ©"><a href="#å¾’æœ‰å…¶è¡¨çš„èƒœåˆ©" class="headerlink" title="å¾’æœ‰å…¶è¡¨çš„èƒœåˆ©"></a>å¾’æœ‰å…¶è¡¨çš„èƒœåˆ©</h2><p>æˆ‘ä»¬ç”¨ä¸€æ®µç†Ÿæ‚‰çš„ä»£ç æ¥ç»“æŸè¿™æ®µç¥å¥‡çš„å­¦ä¹ ä¹‹æ—…ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">Result</span>&lt;<span class="title">Value</span>, <span class="title">Error</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">case</span> success(<span class="type">Value</span>)</span><br><span class="line">    <span class="keyword">case</span> failure(<span class="type">Error</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœä½ è¿˜è®°å¾—ä¹‹å‰ <a href="https://nshipster.com/never" target="_blank" rel="noopener">æˆ‘ä»¬å…³äº <code>Never</code> ç±»å‹çš„æ–‡ç« </a>ï¼Œä½ åº”è¯¥çŸ¥é“ï¼Œå°† <code>Result</code> çš„ <code>Error</code> ç±»å‹è®¾ä¸º <code>Never</code> å¯ä»¥è®©å®ƒè¡¨ç¤ºæŸäº›æ€»ä¼šæˆåŠŸçš„æ“ä½œã€‚</p><p>ç±»ä¼¼çš„ï¼Œæ“ä½œæˆåŠŸä½†ä¸ä¼šç”Ÿæˆæœ‰æ„ä¹‰çš„ç»“æœï¼Œç”¨ <code>Void</code> ä½œä¸º <code>Value</code> ç±»å‹å¯ä»¥è¡¨ç¤ºã€‚</p><p>ä¾‹å¦‚ï¼Œåº”ç”¨å¯èƒ½ä¼šé€šè¿‡ç®€å•çš„ç½‘ç»œè¯·æ±‚å®šæ—¶â€œpingâ€æœåŠ¡å™¨æ¥å®ç°ä¸€ä¸ª <a href="https://en.wikipedia.org/wiki/The_Tell-Tale_Heart" target="_blank" rel="noopener">å¿ƒè·³</a>ã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">ping</span><span class="params">(<span class="number">_</span> url: URL, completion: <span class="params">(Result&lt;Void, Error&gt;)</span></span></span> -&gt; <span class="type">Void</span>) &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>æ ¹æ® HTTP è¯­ä¹‰ï¼Œä¸€ä¸ªè™šæ‹Ÿ <code>/ping</code> ç»ˆç«¯æ­£ç¡®çš„çŠ¶æ€ç åº”è¯¥æ˜¯ <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/204" target="_blank" rel="noopener">204 No Content</a>ã€‚</p></blockquote><p>åœ¨è¯·æ±‚çš„å›è°ƒä¸­ï¼Œé€šè¿‡ä¸‹é¢çš„è°ƒç”¨æ¥è¡¨ç¤ºæˆåŠŸï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">completion(.success(()))</span><br></pre></td></tr></table></figure><p>å‡å¦‚ä½ è§‰å¾—æ‹¬å·å¤ªå¤šäº†ï¼ˆå…¶å®åˆæœ‰ä»€ä¹ˆé—®é¢˜å‘¢ï¼Ÿï¼‰ï¼Œç»™ <code>Result</code> åŠ ä¸€ä¸ªå…³é”®çš„æ‰©å±•å¯ä»¥è®©äº‹æƒ…æ›´ç®€å•ç‚¹ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Result</span> <span class="title">where</span> <span class="title">Value</span> == <span class="title">Void</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> success: <span class="type">Result</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> .success(())</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ‰ä»˜å‡ºå°±æœ‰æ”¶è·ã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">completion(.success)</span><br></pre></td></tr></table></figure><p><br></p><p>è™½ç„¶è¿™çœ‹èµ·æ¥åƒä¸€æ¬¡çº¯ç†è®ºç”šè‡³æŠ½è±¡çš„ç»ƒä¹ ï¼Œä½†å¯¹ <code>Void</code> çš„æ¢ç©¶èƒ½è®©æˆ‘ä»¬å¯¹ Swift è¿™é—¨ç¼–ç¨‹è¯­è¨€çš„åŸºç¡€æœ‰ä¸€ä¸ªæ›´æ·±åˆ»çš„è®¤çŸ¥ã€‚</p><p>åœ¨ Swift è¿˜æ²¡æœ‰é¢ä¸–å¾ˆä¹…ä¹‹å‰ï¼Œå…ƒç»„åœ¨ç¼–ç¨‹è¯­è¨€ä¸­æ‰®æ¼”ç€é‡è¦è§’è‰²ã€‚å®ƒä»¬å¯ä»¥è¡¨ç¤ºå‚æ•°åˆ—è¡¨å’Œæšä¸¾å…³è”å€¼ï¼Œä¾åœºæ™¯ä¸åŒè€Œæ‰®æ¼”ä¸åŒè§’è‰²ã€‚ä½†åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œè¿™ä¸ªæ¨¡å‹å´©æºƒäº†ã€‚ç¼–ç¨‹è¯­è¨€ä¾ç„¶æ²¡æœ‰è°ƒå’Œå¥½è¿™äº›ä¸åŒç»“æ„ä¹‹é—´çš„å·®å¼‚ã€‚</p><p>ä¾æ® Swift ç¥è¯ï¼Œ<code>Void</code> å°†ä¼šæ˜¯é‚£äº›è€ç¥ï¼ˆè¯‘è€…æ³¨ï¼šæ—§çš„ç¼–ç¨‹è¯­è¨€ï¼‰çš„å…¸èŒƒï¼šå®ƒæ˜¯ä¸€ä¸ªçœŸæ­£çš„å•ä¾‹ï¼Œä½ å‹æ ¹ä¸€ä¸ç‚¹å„¿éƒ½ä¸ä¼šæ³¨æ„åˆ°å®ƒçš„ä½œç”¨å’Œå½±å“ï¼›ç¼–è¯‘å™¨ä¹Ÿä¼šå¿½ç•¥å®ƒã€‚</p><p>å¯èƒ½è¿™ä¸€åˆ‡éƒ½åªæ˜¯æˆ‘ä»¬ç†è§£åŠ›çš„è¾¹ç¼˜å‘æ˜ï¼Œæ˜¯æˆ‘ä»¬å¯¹è¿™é—¨è¯­è¨€å‰æ™¯æ‹…å¿§çš„ä¸€ç§è¡¨ç°ã€‚æ€»ä¹‹ï¼Œå½“ä½ å‡è§† <code>Void</code> æ—¶ï¼Œ<code>Void</code> ä¹Ÿåœ¨å‡è§†ç€ä½ ã€‚</p><blockquote><p>æœ¬æ–‡ç”± SwiftGG ç¿»è¯‘ç»„ç¿»è¯‘ï¼Œå·²ç»è·å¾—ä½œè€…ç¿»è¯‘æˆæƒï¼Œæœ€æ–°æ–‡ç« è¯·è®¿é—® <a href="http://swift.gg">http://swift.gg</a>ã€‚</p></blockquote>]]></content>
    
    <summary type="html">
    
      æœ¬æ–‡ä»‹ç»äº† Swift ä¸­ Void çš„
    
    </summary>
    
      <category term="Swift" scheme="https://swift.gg/categories/Swift/"/>
    
      <category term="NSHipster" scheme="https://swift.gg/categories/Swift/NSHipster/"/>
    
    
      <category term="Swift" scheme="https://swift.gg/tags/Swift/"/>
    
      <category term="NSHipster" scheme="https://swift.gg/tags/NSHipster/"/>
    
  </entry>
  
  <entry>
    <title>Swift 5 å­—ç¬¦ä¸²æ’å€¼ä¹‹ç¾</title>
    <link href="https://swift.gg/2019/02/21/the-beauty-of-swift-5-string-interpolation/"/>
    <id>https://swift.gg/2019/02/21/the-beauty-of-swift-5-string-interpolation/</id>
    <published>2019-02-21T00:00:00.000Z</published>
    <updated>2019-08-14T12:15:53.980Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ä½œè€…ï¼šErica Sadunï¼Œ<a href="https://ericasadun.com/2018/12/12/the-beauty-of-swift-5-string-interpolation/" target="_blank" rel="noopener">åŸæ–‡é“¾æ¥</a>ï¼ŒåŸæ–‡æ—¥æœŸï¼š2018-12-12<br>è¯‘è€…ï¼š<a href="https://www.roczhang.com/" target="_blank" rel="noopener">RocZhang</a>ï¼›æ ¡å¯¹ï¼š<a href="http://numbbbbb.com/" target="_blank" rel="noopener">numbbbbb</a>ï¼Œ<a href="http://www.jianshu.com/users/596f2ba91ce9/latest_articles" target="_blank" rel="noopener">pmst</a>ï¼›å®šç¨¿ï¼š<a href="http://forelax.space" target="_blank" rel="noopener">Forelax</a></p></blockquote><!--æ­¤å¤„å¼€å§‹æ­£æ–‡--><p>æ„Ÿè°¢ææ¡ˆ <a href="https://github.com/apple/swift-evolution/blob/master/proposals/0228-fix-expressiblebystringinterpolation.md" target="_blank" rel="noopener">SE-0228</a>ï¼Œè®©æˆ‘ä»¬èƒ½å¤Ÿç²¾ç¡®æ§åˆ¶å­—ç¬¦ä¸²æ’å€¼çš„æ‰“å°æ–¹å¼ã€‚æ„Ÿè°¢ Brent å¸¦ç»™æˆ‘ä»¬è¿™ä¸ªéå¸¸æ£’çš„åŠŸèƒ½ã€‚è®©æˆ‘æ¥åˆ†äº«ä¸€äº›ä¾‹å­ã€‚</p><a id="more"></a><p>å›æƒ³ä¸€ä¸‹åœ¨æˆ‘ä»¬è¦æ‰“å°å¯é€‰å€¼çš„æ—¶å€™ï¼Œä¼šè¿™æ ·å†™ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="string">"There's \(value1) and \(value2)"</span></span><br></pre></td></tr></table></figure><p>ä½†è¿™æ ·å†™ä¼šç«‹å³å¾—åˆ°ä¸€ä¸ªè­¦å‘Šï¼š</p><p><img src="https://i2.wp.com/ericasadun.com/wp-content/uploads/2018/12/Screen-Shot-2018-12-12-at-2.38.51-PM.png?w=1065&amp;ssl=1" alt></p><p>æˆ‘ä»¬å¯ä»¥ç‚¹å‡»ä¿®å¤æŒ‰é’®æ¥æ¶ˆé™¤è¿™äº›è­¦å‘Šï¼Œå¾—åˆ°å¦‚ä¸‹çš„ä»£ç ã€‚ä½†æˆ‘ä»¬ä»ç„¶ä¼šçœ‹åˆ°ä¸€ä¸ªç±»ä¼¼äºè¿™æ ·çš„è¾“å‡ºï¼šâ€œThereâ€™s Optional(23) and nilâ€ã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="string">"There's \(String(describing: value1)) and \(String(describing: value2))"</span></span><br></pre></td></tr></table></figure><p>ç°åœ¨æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸‹é¢è¿™ç§æ–¹å¼å»æ‰è¾“å‡ºä¸­çš„â€œOptionalâ€ï¼Œç›´æ¥æ‰“å°å‡ºâ€œThereâ€™s 23 and nilâ€ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">String</span>.<span class="title">StringInterpolation</span> </span>&#123;</span><br><span class="line">  <span class="comment">/// æä¾› `Optional` å­—ç¬¦ä¸²æ’å€¼</span></span><br><span class="line">  <span class="comment">/// è€Œä¸å¿…å¼ºåˆ¶ä½¿ç”¨ `String(describing:)`</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">mutating</span> <span class="function"><span class="keyword">func</span> <span class="title">appendInterpolation</span><span class="params">(<span class="number">_</span> value: T?, <span class="keyword">default</span> defaultValue: String)</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> value = value &#123;</span><br><span class="line">      appendInterpolation(value)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      appendLiteral(defaultValue)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// There's 23 and nil</span></span><br><span class="line"><span class="string">"There's \(value1, default: "</span><span class="literal">nil</span><span class="string">") and \(value2, default: "</span><span class="literal">nil</span><span class="string">")"</span></span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬ä¹Ÿå¯ä»¥åˆ›å»ºä¸€ç»„æ ·å¼ï¼Œä»è€Œä½¿å¯é€‰å€¼èƒ½å¤Ÿä¿æŒä¸€è‡´çš„è¾“å‡ºå±•ç¤ºæ–¹å¼ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">String</span>.<span class="title">StringInterpolation</span> </span>&#123;</span><br><span class="line">  <span class="comment">/// å¯é€‰å€¼æ’å€¼æ ·å¼</span></span><br><span class="line">  <span class="keyword">public</span> <span class="class"><span class="keyword">enum</span> <span class="title">OptionalStyle</span> </span>&#123;</span><br><span class="line">    <span class="comment">/// æœ‰å€¼å’Œæ²¡æœ‰å€¼ä¸¤ç§æƒ…å†µä¸‹éƒ½åŒ…å«å•è¯ `Optional`</span></span><br><span class="line">    <span class="keyword">case</span> descriptive</span><br><span class="line">    <span class="comment">/// æœ‰å€¼å’Œæ²¡æœ‰å€¼ä¸¤ç§æƒ…å†µä¸‹éƒ½å»é™¤å•è¯ `Optional`</span></span><br><span class="line">    <span class="keyword">case</span> stripped</span><br><span class="line">    <span class="comment">/// ä½¿ç”¨ç³»ç»Ÿçš„æ’å€¼æ–¹å¼ï¼Œåœ¨æœ‰å€¼æ—¶åŒ…å«å•è¯ `Optional`ï¼Œæ²¡æœ‰å€¼æ—¶åˆ™ä¸åŒ…å«</span></span><br><span class="line">    <span class="keyword">case</span> `<span class="keyword">default</span>`</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/// ä½¿ç”¨æä¾›çš„ `optStyle` æ ·å¼æ¥æ’å…¥å¯é€‰å€¼</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">mutating</span> <span class="function"><span class="keyword">func</span> <span class="title">appendInterpolation</span><span class="params">(<span class="number">_</span> value: T?, optStyle style: String.StringInterpolation.OptionalStyle)</span></span> &#123;</span><br><span class="line">    <span class="keyword">switch</span> style &#123;</span><br><span class="line">    <span class="comment">// æœ‰å€¼å’Œæ²¡æœ‰å€¼ä¸¤ç§æƒ…å†µä¸‹éƒ½åŒ…å«å•è¯ `Optional`</span></span><br><span class="line">    <span class="keyword">case</span> .descriptive:</span><br><span class="line">      <span class="keyword">if</span> value == <span class="literal">nil</span> &#123;</span><br><span class="line">        appendLiteral(<span class="string">"Optional(nil)"</span>)</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        appendLiteral(<span class="type">String</span>(describing: value))</span><br><span class="line">      &#125;</span><br><span class="line">    <span class="comment">// æœ‰å€¼å’Œæ²¡æœ‰å€¼ä¸¤ç§æƒ…å†µä¸‹éƒ½å»é™¤å•è¯ `Optional`</span></span><br><span class="line">    <span class="keyword">case</span> .stripped:</span><br><span class="line">      <span class="keyword">if</span> <span class="keyword">let</span> value = value &#123;</span><br><span class="line">        appendInterpolation(value)</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        appendLiteral(<span class="string">"nil"</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    <span class="comment">// ä½¿ç”¨ç³»ç»Ÿçš„æ’å€¼æ–¹å¼ï¼Œåœ¨æœ‰å€¼æ—¶åŒ…å«å•è¯ `Optional`ï¼Œæ²¡æœ‰å€¼æ—¶åˆ™ä¸åŒ…å«</span></span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      appendLiteral(<span class="type">String</span>(describing: value))</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/// ä½¿ç”¨ `stripped` æ ·å¼æ¥å¯¹å¯é€‰å€¼è¿›è¡Œæ’å€¼</span></span><br><span class="line">  <span class="comment">/// æœ‰å€¼å’Œæ²¡æœ‰å€¼ä¸¤ç§æƒ…å†µä¸‹éƒ½çœç•¥å•è¯ `Optional`</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">mutating</span> <span class="function"><span class="keyword">func</span> <span class="title">appendInterpolation</span><span class="params">(describing value: T?)</span></span> &#123;</span><br><span class="line">    appendInterpolation(value, optStyle: .stripped)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// "There's Optional(23) and nil"</span></span><br><span class="line"><span class="string">"There's \(value1, optStyle: .default) and \(value2, optStyle: .default)"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// "There's Optional(23) and Optional(nil)"</span></span><br><span class="line"><span class="string">"There's \(value1, optStyle: .descriptive) and \(value2, optStyle: .descriptive)"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// "There's 23 and nil"</span></span><br><span class="line"><span class="string">"There's \(describing: value1) and \(describing: value2)"</span></span><br></pre></td></tr></table></figure><p>æ’å€¼ä¸ä»…ä»…ç”¨äºè°ƒæ•´å¯é€‰å€¼çš„è¾“å‡ºæ–¹å¼ï¼Œåœ¨å…¶ä»–æ–¹é¢ä¹Ÿå¾ˆæœ‰ç”¨ã€‚æ¯”å¦‚ä½ æƒ³æ§åˆ¶è¾“å‡ºæ˜¯å¦å¸¦æœ‰ç‰¹å®šçš„å­—ç¬¦ï¼Œå°±ä¸éœ€è¦å†™ä¸€ä¸ªå¸¦æœ‰ç©ºå­—ç¬¦ä¸²çš„ä¸‰å…ƒè¡¨è¾¾å¼ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æˆåŠŸæ—¶åŒ…å«ï¼ˆæ„Ÿè°¢ Nate Cookï¼‰</span></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">String</span>.<span class="title">StringInterpolation</span> </span>&#123;</span><br><span class="line">  <span class="comment">/// åªæœ‰ `condition` çš„è¿”å›å€¼ä¸º `true` æ‰è¿›è¡Œæ’å€¼</span></span><br><span class="line">  <span class="keyword">mutating</span> <span class="function"><span class="keyword">func</span> <span class="title">appendInterpolation</span><span class="params">(<span class="keyword">if</span> condition: @autoclosure <span class="params">()</span></span></span> -&gt; <span class="type">Bool</span>, <span class="number">_</span> literal: <span class="type">StringLiteralType</span>) &#123;</span><br><span class="line">    <span class="keyword">guard</span> condition() <span class="keyword">else</span> &#123; <span class="keyword">return</span> &#125;</span><br><span class="line">    appendLiteral(literal)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ—§å†™æ³•</span></span><br><span class="line"><span class="string">"Cheese Sandwich \(isStarred ? "</span>(*)<span class="string">" : "</span><span class="string">")"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// æ–°å†™æ³•</span></span><br><span class="line"><span class="string">"Cheese Sandwich \(if: isStarred, "</span>(*)<span class="string">")"</span></span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬è¿˜å¯ä»¥ç”¨å­—ç¬¦ä¸²æ’å€¼æ¥åšæ›´å¤šæœ‰è¶£çš„äº‹æƒ…ã€‚</p><blockquote><p>æœ¬æ–‡ç”± SwiftGG ç¿»è¯‘ç»„ç¿»è¯‘ï¼Œå·²ç»è·å¾—ä½œè€…ç¿»è¯‘æˆæƒï¼Œæœ€æ–°æ–‡ç« è¯·è®¿é—® <a href="http://swift.gg">http://swift.gg</a>ã€‚</p></blockquote>]]></content>
    
    <summary type="html">
    
      æœ¬æ–‡å¯¹ Swift 5 ä¸­ SE-0228 å¯¹ String Interpolation ç›¸å…³åŠŸèƒ½çš„æ”¹è¿›è¿›è¡Œäº†ä¸¾ä¾‹è¯´æ˜ï¼Œå±•ç¤ºäº†ä¸€äº›æ§åˆ¶å­—ç¬¦ä¸²æ’å€¼çš„æ–¹å¼ã€‚
    
    </summary>
    
      <category term="Erica Sadun" scheme="https://swift.gg/categories/Erica-Sadun/"/>
    
    
      <category term="Swift" scheme="https://swift.gg/tags/Swift/"/>
    
  </entry>
  
  <entry>
    <title>åè®®ä¸­çš„ç§æœ‰å±æ€§</title>
    <link href="https://swift.gg/2019/02/18/protocols-private-properties/"/>
    <id>https://swift.gg/2019/02/18/protocols-private-properties/</id>
    <published>2019-02-18T00:00:00.000Z</published>
    <updated>2019-08-14T12:15:53.980Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ä½œè€…ï¼šOlivier Halligonï¼Œ<a href="http://alisoftware.github.io/swift/protocols/2018/09/02/protocols-private-properties/" target="_blank" rel="noopener">åŸæ–‡é“¾æ¥</a>ï¼ŒåŸæ–‡æ—¥æœŸï¼š2018-09-02<br>è¯‘è€…ï¼š<a href="https://github.com/dzyding" target="_blank" rel="noopener">ç°s</a>ï¼›æ ¡å¯¹ï¼š<a href="http://numbbbbb.com/" target="_blank" rel="noopener">numbbbbb</a>ï¼Œ<a href="http://linusling.com" target="_blank" rel="noopener">å°é“åŒ Linus</a>ï¼›å®šç¨¿ï¼š<a href="http://forelax.space" target="_blank" rel="noopener">Forelax</a></p></blockquote><!--æ­¤å¤„å¼€å§‹æ­£æ–‡--><p>åœ¨ Swift ä¸­ï¼Œåè®®ä¸­å£°æ˜çš„å±æ€§æ²¡æœ‰è®¿é—®æ§åˆ¶çš„èƒ½åŠ›ã€‚å¦‚æœåè®®ä¸­åˆ—å‡ºäº†æŸä¸ªå±æ€§ï¼Œåˆ™å¿…é¡»ä½¿éµå®ˆåè®®çš„ç±»å‹æ˜¾å¼å£°æ˜è¿™äº›å±æ€§ã€‚  </p><p>ä¸è¿‡æœ‰äº›æ—¶å€™ï¼Œå°½ç®¡ä½ ä¼šåœ¨åè®®ä¸­å£°æ˜ä¸€äº›å±æ€§ï¼Œä½†ä½ æ˜¯è¦åˆ©ç”¨è¿™äº›å±æ€§æ¥æä¾›ä½ çš„å®ç°ï¼Œå¹¶ä¸å¸Œæœ›è¿™äº›å±æ€§åœ¨ç±»å‹çš„å¤–éƒ¨è¢«ä½¿ç”¨ã€‚è®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜ã€‚ </p><a id="more"></a><h2 id="ä¸€ä¸ªç®€å•çš„ä¾‹å­"><a href="#ä¸€ä¸ªç®€å•çš„ä¾‹å­" class="headerlink" title="ä¸€ä¸ªç®€å•çš„ä¾‹å­"></a>ä¸€ä¸ªç®€å•çš„ä¾‹å­</h2><p>å‡è®¾ä½ éœ€è¦åˆ›å»ºä¸€ä¸ªä¸“é—¨çš„å¯¹è±¡æ¥ç®¡ç†ä½ çš„è§†å›¾æ§åˆ¶å™¨ï¼ˆViewControllersï¼‰å¯¼èˆªï¼Œæ¯”å¦‚ä¸€ä¸ªåè°ƒå™¨ï¼ˆCoordinatorï¼‰ã€‚  </p><p>æ¯ä¸ªåè°ƒå™¨éƒ½æœ‰ä¸€ä¸ªæ ¹æ§åˆ¶å™¨ <code>UINavigationController</code>ï¼Œå¹¶å…±äº«ä¸€äº›é€šç”¨çš„åŠŸèƒ½ï¼Œæ¯”å¦‚åœ¨å®ƒä¸Šé¢æ¨è¿›ï¼ˆpushï¼‰å’Œå¼¹å‡ºï¼ˆpopï¼‰å…¶ä»– ViewControllerã€‚æ‰€ä»¥æœ€åˆå®ƒçœ‹èµ·æ¥å¯èƒ½æ˜¯è¿™æ · <a href="#foot1" id="1"><sup>[1]</sup></a>ï¼š  </p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Coordinator.swift</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">Coordinator</span> </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> navigationController: <span class="type">UINavigationController</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">  <span class="keyword">var</span> childCoordinator: <span class="type">Coordinator?</span> &#123; <span class="keyword">get</span> <span class="keyword">set</span> &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">push</span><span class="params">(viewController: UIViewController, animated: Bool)</span></span></span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">present</span><span class="params">(childViewController: UIViewController, animated: Bool)</span></span></span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">pop</span><span class="params">(animated: Bool)</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Coordinator</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">push</span><span class="params">(viewController: UIViewController, animated: Bool = <span class="literal">true</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">self</span>.navigationController.pushViewController(viewController, animated: animated)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">present</span><span class="params">(childCoordinator: Coordinator, animated: Bool)</span></span> &#123;</span><br><span class="line">    <span class="keyword">self</span>.navigationController.present(childCoordinator.navigationController, animated: animated) &#123; [<span class="keyword">weak</span> <span class="keyword">self</span>] <span class="keyword">in</span></span><br><span class="line">      <span class="keyword">self</span>?.childCoordinator = childCoordinator</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">pop</span><span class="params">(animated: Bool = <span class="literal">true</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> childCoordinator = <span class="keyword">self</span>.childCoordinator &#123;</span><br><span class="line">      <span class="keyword">self</span>.dismissViewController(animated: animated) &#123; [<span class="keyword">weak</span> <span class="keyword">self</span>] <span class="keyword">in</span></span><br><span class="line">        <span class="keyword">self</span>?.childCoordinator = <span class="literal">nil</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">self</span>.navigationController.popViewController(animated: animated)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“æˆ‘ä»¬æƒ³è¦å£°æ˜ä¸€ä¸ªæ–°çš„ <code>Coordinator</code> å¯¹è±¡æ—¶ï¼Œä¼šåƒè¿™æ ·åšï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// MainCoordinator.swift</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MainCoordinator</span>: <span class="title">Coordinator</span> </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> navigationController: <span class="type">UINavigationController</span> = <span class="type">UINavigationController</span>()</span><br><span class="line">  <span class="keyword">var</span> childCoordinator: <span class="type">Coordinator?</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">showTutorialPage1</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">let</span> vc = makeTutorialPage(<span class="number">1</span>, coordinator: <span class="keyword">self</span>)</span><br><span class="line">    <span class="keyword">self</span>.push(viewController: vc)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">showTutorialPage2</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">let</span> vc = makeTutorialPage(<span class="number">2</span>, coordinator: <span class="keyword">self</span>)</span><br><span class="line">    <span class="keyword">self</span>.push(viewController: vc)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">makeTutorialPage</span><span class="params">(<span class="number">_</span> num: Int, coordinator: Coordinator)</span></span> -&gt; <span class="type">UIViewController</span> &#123; â€¦ &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="é—®é¢˜ï¼šæ³„æ¼å®ç°ç»†èŠ‚"><a href="#é—®é¢˜ï¼šæ³„æ¼å®ç°ç»†èŠ‚" class="headerlink" title="é—®é¢˜ï¼šæ³„æ¼å®ç°ç»†èŠ‚"></a>é—®é¢˜ï¼šæ³„æ¼å®ç°ç»†èŠ‚</h2><p>è¿™ä¸ªè§£å†³æ–¹æ¡ˆåœ¨ <code>protocol</code> çš„å¯è§æ€§ä¸Šæœ‰ä¸¤ä¸ªé—®é¢˜ï¼š  </p><ul><li>æ¯å½“æˆ‘ä»¬æƒ³è¦å£°æ˜ä¸€ä¸ªæ–°çš„ <code>Coordinator</code> å¯¹è±¡ï¼Œéƒ½å¿…é¡»æ˜¾å¼çš„å£°æ˜ä¸€ä¸ª <code>let navigationController: UINavigationController</code> å±æ€§å’Œä¸€ä¸ª <code>var childCoordinator: Coordinator?</code> å±æ€§ã€‚<strong>è™½ç„¶ï¼Œåœ¨éµå®ˆåè®®çš„ç±»å‹ç°å®ä¸­ï¼Œæˆ‘ä»¬å¹¶æ²¡æœ‰æ˜¾å¼çš„ä½¿ç”¨ä»–ä»¬</strong> - ä½†å®ƒä»¬å°±åœ¨é‚£é‡Œï¼Œå› ä¸ºæˆ‘ä»¬éœ€è¦å®ƒä»¬ä½œä¸ºé»˜è®¤çš„å®ç°æ¥ä¾› <code>protocol Coordinator</code> æ­£å¸¸å·¥ä½œã€‚  </li><li>æˆ‘ä»¬å¿…é¡»å£°æ˜çš„è¿™ä¸¤ä¸ªå±æ€§å…·æœ‰ä¸ <code>MainCoordinator</code> ç›¸åŒçš„å¯è§æ€§ï¼ˆåœ¨æœ¬ä¾‹ä¸­ä¸ºéšå¼ <code>internalï¼ˆå†…éƒ¨ï¼‰</code> è®¿é—®æ§åˆ¶çº§åˆ«ï¼‰ï¼Œå› ä¸ºè¿™æ˜¯ <code>protocol Coordinator</code> çš„å¿…å¤‡æ¡ä»¶ã€‚è¿™ä½¿å¾—å®ƒä»¬å¯¹å¤–éƒ¨å¯è§ï¼Œå°±åƒåœ¨ç¼–ç æ—¶å¯ä»¥ä½¿ç”¨ <code>MainCoordinator</code>ã€‚  </li></ul><p>æ‰€ä»¥é—®é¢˜æ˜¯æˆ‘ä»¬æ¯æ¬¡éƒ½è¦å£°æ˜ä¸€äº›å±æ€§â€”â€”å³ä½¿å®ƒåªæ˜¯ä¸€äº›å®ç°ç»†èŠ‚ï¼Œè€Œä¸”è¿™äº›å®ç°ç»†èŠ‚ä¼šé€šè¿‡å¤–éƒ¨æ¥å£è¢«æ³„æ¼ï¼Œä»è€Œå…è®¸ç±»çš„è®¿é—®è€…åšä¸€äº›æœ¬ä¸åº”è¯¥è¢«å…è®¸çš„äº‹ï¼Œä¾‹å¦‚ï¼š  </p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> mainCoord = <span class="type">MainCoordinator</span>()</span><br><span class="line"><span class="comment">// è®¿é—®è€…ä¸åº”è¯¥è¢«å…è®¸ç›´æ¥è®¿é—® navigationController ï¼Œä½†æ˜¯ä»–ä»¬å¯ä»¥</span></span><br><span class="line">mainCoord.navigationController.dismissViewController(animated: <span class="literal">true</span>)</span><br><span class="line"><span class="comment">// ä»–ä»¬ä¹Ÿä¸åº”è¯¥è¢«å…è®¸åšè¿™æ ·çš„äº‹æƒ…</span></span><br><span class="line">mainCoord.childCoordinator = mainCoord</span><br></pre></td></tr></table></figure><p>ä¹Ÿè®¸ä½ ä¼šè®¤ä¸ºï¼Œæ—¢ç„¶æˆ‘ä»¬ä¸å¸Œæœ›å®ƒä»¬æ˜¯å¯è§çš„ï¼Œé‚£ä¹ˆå¯ä»¥ç›´æ¥åœ¨ç¬¬ä¸€æ®µä»£ç çš„ <code>protocol</code> ä¸­ä¸å£°æ˜è¿™ä¸¤ä¸ªå±æ€§ã€‚ä½†æ˜¯å¦‚æœæˆ‘ä»¬è¿™æ ·åšï¼Œå°†æ— æ³•é€šè¿‡ <code>extension Coordinator</code> æ¥æä¾›é»˜è®¤çš„å®ç°ï¼Œå› ä¸ºé»˜è®¤çš„å®ç°éœ€è¦è¿™ä¸¤ä¸ªå±æ€§å­˜åœ¨ä»¥ä¾¿å®ƒä»¬çš„ä»£ç è¢«ç¼–è¯‘ã€‚  </p><p>ä½ å¯èƒ½å¸Œæœ› Swift å…è®¸åœ¨åè®®ä¸­ç”³æ˜è¿™äº›å±æ€§ä¸º <code>fileprivate</code>ï¼Œä½†æ˜¯åœ¨ Swift 4 ä¸­ï¼Œä½ ä¸èƒ½åœ¨ <code>protocols</code> ä¸­ä½¿ç”¨ä»»ä½•è®¿é—®æ§åˆ¶çš„å…³é”®å­—ã€‚  </p><p>æ‰€ä»¥æˆ‘ä»¬å¦‚ä½•æ‰èƒ½è§£å†³è¿™ä¸ªâ€œæ—¢è¦æä¾›ç”¨åˆ°è¿™ä¸ªå±æ€§çš„é»˜è®¤å®ç°ï¼Œæœ‰ä¸è®©è¿™äº›å±æ€§å¯¹å¤–æš´éœ²â€çš„é—®é¢˜å‘¢ï¼Ÿ</p><h2 id="ä¸€ä¸ªè§£å†³æ–¹æ¡ˆ"><a href="#ä¸€ä¸ªè§£å†³æ–¹æ¡ˆ" class="headerlink" title="ä¸€ä¸ªè§£å†³æ–¹æ¡ˆ"></a>ä¸€ä¸ªè§£å†³æ–¹æ¡ˆ</h2><p>å®ç°è¿™ä¸€ç‚¹çš„ä¸€ä¸ªæŠ€å·§æ˜¯å°†è¿™äº›å±æ€§éšè—åœ¨ä¸­é—´å¯¹è±¡ä¸­ï¼Œå¹¶åœ¨è¯¥å¯¹è±¡ä¸­å°†å¯¹åº”çš„å±æ€§å£°æ˜ä¸º <code>fileprivate</code>ã€‚  </p><p>é€šè¿‡è¿™ç§æ–¹å¼ï¼Œå°½ç®¡æˆ‘ä»¬ä¾æ—§åœ¨å¯¹åº”ç±»å‹çš„å…¬å…±æ¥å£ä¸­å£°æ˜äº†å±æ€§ï¼Œä½†æ˜¯æ¥å£çš„è®¿é—®è€…å´ä¸èƒ½è®¿é—®è¯¥å¯¹è±¡çš„å†…éƒ¨å±æ€§ã€‚è€Œæˆ‘ä»¬å¯¹äºåè®®çš„é»˜è®¤å®ç°å´èƒ½å¤Ÿè®¿é—®å®ƒä»¬ â€”â€” åªè¦å®ƒä»¬åœ¨åŒä¸€ä¸ªæ–‡ä»¶ä¸­è¢«å£°æ˜å°±è¡Œäº†ï¼ˆå› ä¸ºå®ƒä»¬æ˜¯ <code>fileprivate</code> ï¼‰ã€‚  </p><p>çœ‹èµ·æ¥å°±åƒè¿™æ ·ï¼š  </p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Coordinator.swift</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CoordinatorComponents</span> </span>&#123;</span><br><span class="line">  <span class="keyword">fileprivate</span> <span class="keyword">let</span> navigationController: <span class="type">UINavigationController</span> = <span class="type">UINavigationController</span>()</span><br><span class="line">  <span class="keyword">fileprivate</span> <span class="keyword">var</span> childCoordinator: <span class="type">Coordinator?</span> = <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">Coordinator</span>: <span class="title">AnyObject</span> </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> coordinatorComponents: <span class="type">CoordinatorComponents</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">push</span><span class="params">(viewController: UIViewController, animated: Bool)</span></span></span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">present</span><span class="params">(childCoordinator: Coordinator, animated: Bool)</span></span></span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">pop</span><span class="params">(animated: Bool)</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Coordinator</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">push</span><span class="params">(viewController: UIViewController, animated: Bool = <span class="literal">true</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">self</span>.coordinatorComponents.navigationController.pushViewController(viewController, animated: animated)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">present</span><span class="params">(childCoordinator: Coordinator, animated: Bool = <span class="literal">true</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">let</span> childVC = childCoordinator.coordinatorComponents.navigationController</span><br><span class="line">    <span class="keyword">self</span>.coordinatorComponents.navigationController.present(childVC, animated: animated) &#123; [<span class="keyword">weak</span> <span class="keyword">self</span>] <span class="keyword">in</span></span><br><span class="line">      <span class="keyword">self</span>?.coordinatorComponents.childCoordinator = childCoordinator <span class="comment">// retain the child strongly</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">pop</span><span class="params">(animated: Bool = <span class="literal">true</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">let</span> privateAPI = <span class="keyword">self</span>.coordinatorComponents</span><br><span class="line">    <span class="keyword">if</span> privateAPI.childCoordinator != <span class="literal">nil</span> &#123;</span><br><span class="line">      privateAPI.navigationController.dismiss(animated: animated) &#123; [<span class="keyword">weak</span> privateAPI] <span class="keyword">in</span></span><br><span class="line">        privateAPI?.childCoordinator = <span class="literal">nil</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      privateAPI.navigationController.popViewController(animated: animated)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç°åœ¨ï¼Œéµå®ˆåè®®çš„ <code>MainCoordinator</code> ç±»å‹ï¼š  </p><ul><li>ä»…éœ€è¦å£°æ˜ä¸€ä¸ª <code>let coordinatorComponents = CoordinatorComponents()</code> å±æ€§ï¼Œå¹¶ä¸ç”¨çŸ¥é“ <code>CoordinatorComponents</code> ç±»å‹çš„å†…éƒ¨æœ‰äº›ä»€ä¹ˆï¼ˆéšè—äº†å®ç°ç»†èŠ‚ï¼‰ã€‚  </li><li>åœ¨ <code>MainCoordinator.swift</code> æ–‡ä»¶ä¸­ï¼Œä¸èƒ½è®¿é—® <code>coordinatorComponents</code> çš„ä»»ä½•å±æ€§ï¼Œå› ä¸ºå®ƒä»¬è¢«å£°æ˜ä¸º <code>fileprivate</code>ã€‚  </li></ul><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainCoordinator</span>: <span class="title">Coordinator</span> </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> coordinatorComponents = <span class="type">CoordinatorComponents</span>()</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">showTutorialPage1</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">let</span> vc = makeTutorialPage(<span class="number">1</span>, coordinator: <span class="keyword">self</span>)</span><br><span class="line">    <span class="keyword">self</span>.push(viewController: vc)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">showTutorialPage2</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">let</span> vc = makeTutorialPage(<span class="number">2</span>, coordinator: <span class="keyword">self</span>)</span><br><span class="line">    <span class="keyword">self</span>.push(viewController: vc)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">makeTutorialPage</span><span class="params">(<span class="number">_</span> num: Int, coordinator: Coordinator)</span></span> -&gt; <span class="type">UIViewController</span> &#123; â€¦ &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“ç„¶ï¼Œä½ ä»ç„¶éœ€è¦åœ¨éµå®ˆåè®®çš„ç±»å‹ä¸­å£°æ˜ <code>let coordinatorComponents</code> æ¥æä¾›å­˜å‚¨ï¼Œè¿™ä¸ªå£°æ˜å¿…é¡»æ˜¯å¯è§çš„ï¼ˆä¸èƒ½æ˜¯ <code>private</code>ï¼‰ï¼Œå› ä¸ºè¿™æ˜¯éµå®ˆ <code>protocol Coordinator</code> æ‰€è¦æ±‚çš„ä¸€éƒ¨åˆ†ã€‚ä½†æ˜¯ï¼š  </p><ul><li>åªéœ€è¦å£°æ˜ 1 ä¸ªå±æ€§ï¼Œå–ä»£ä¹‹å‰çš„ 2 ä¸ªï¼ˆåœ¨æ›´å¤æ‚çš„æƒ…å†µä¸‹ä¼šæœ‰æ›´å¤šï¼‰ã€‚  </li><li>æ›´é‡è¦çš„æ˜¯ï¼Œå³ä½¿å®ƒå¯ä»¥ä»éµå®ˆåè®®çš„ç±»å‹çš„å®ç°ä¸­è®¿é—®ï¼Œä¹Ÿå¯ä»¥ä»å¤–éƒ¨æ¥å£è®¿é—®ï¼Œä½ å´ä¸èƒ½å¯¹å®ƒåšä»»ä½•äº‹æƒ…ã€‚  </li></ul><p>å½“ç„¶ï¼Œä½ ä»ç„¶å¯ä»¥è®¿é—® <code>myMainCoordinator.coordinatorComponents</code>ï¼Œä½†æ˜¯ä¸èƒ½ä½¿ç”¨å®ƒåšä»»ä½•äº‹æƒ…ï¼Œå› ä¸ºå®ƒæ‰€æœ‰çš„å±æ€§éƒ½æ˜¯ <code>fileprivate</code> ï¼  </p><h2 id="ç»“è®º"><a href="#ç»“è®º" class="headerlink" title="ç»“è®º"></a>ç»“è®º</h2><p>Swift å¯èƒ½æ— æ³•æä¾›ä½ æƒ³è¦çš„æ‰€æœ‰åŠŸèƒ½ã€‚ä½ å¯èƒ½å¸Œæœ›æœ‰æœä¸€æ—¥ <code>protocols</code> å…è®¸å¯¹å®ƒå£°æ˜éœ€è¦çš„å±æ€§å’Œæ–¹æ³•ä½¿ç”¨è®¿é—®æ§åˆ¶å…³é”®å­—ï¼Œæˆ–è€…é€šè¿‡æŸç§æ–¹å¼å°†å®ƒä»¬åœ¨å…¬å…± API ä¸­éšè—ã€‚  </p><p>ä½†ä¸æ­¤åŒæ—¶ï¼ŒæŒæ¡è¿™äº›æŠ€å·§å’Œå˜é€šæ–¹æ³•å¯ä»¥ä½¿ä½ çš„å…¬å…± API æ›´å¥½ã€æ›´å®‰å…¨ï¼Œé¿å…æ³„éœ²å®ç°ç»†èŠ‚æˆ–è€…è®¿é—®åœ¨å®ç°ä¹‹å¤–ä¸åº”è¯¥è¢«ä¿®æ”¹çš„å±æ€§ï¼ŒåŒæ—¶ä»ç„¶ä½¿ç”¨ <a href="http://alisoftware.github.io/swift/protocol/2015/11/08/mixins-over-inheritance/" target="_blank" rel="noopener">Mixin pattern</a> å¹¶æä¾›é»˜è®¤å®ç°ã€‚  </p><hr><p><a id="foot1" href="#1"><sup>[1]</sup></a>.è¿™æ˜¯ä¸€ä¸ªç®€åŒ–çš„ä¾‹å­ï¼›ä¸è¦å°†æ³¨æ„åŠ›é›†ä¸­åœ¨ Coordinator çš„å®ç° - å®ƒä¸æ˜¯è¿™ä¸ªä¾‹å­çš„é‡ç‚¹ï¼Œæ›´åº”è¯¥å…³æ³¨çš„æ˜¯éœ€è¦åœ¨åè®®ä¸­å£°æ˜å…¬å¼€å¯è®¿é—®çš„å±æ€§ã€‚</p><blockquote><p>æœ¬æ–‡ç”± SwiftGG ç¿»è¯‘ç»„ç¿»è¯‘ï¼Œå·²ç»è·å¾—ä½œè€…ç¿»è¯‘æˆæƒï¼Œæœ€æ–°æ–‡ç« è¯·è®¿é—® <a href="http://swift.gg">http://swift.gg</a>ã€‚</p></blockquote>]]></content>
    
    <summary type="html">
    
      é€šè¿‡å¦ä¸€ç§æ–¹å¼æ¥æ§åˆ¶åè®®ä¸­å±æ€§å’Œæ–¹æ³•çš„è®¿é—®æƒé™
    
    </summary>
    
      <category term="Olivier Halligon" scheme="https://swift.gg/categories/Olivier-Halligon/"/>
    
      <category term="Swift" scheme="https://swift.gg/categories/Olivier-Halligon/Swift/"/>
    
    
      <category term="åè®®" scheme="https://swift.gg/tags/%E5%8D%8F%E8%AE%AE/"/>
    
  </entry>
  
  <entry>
    <title>SwiftSyntax</title>
    <link href="https://swift.gg/2019/01/25/nshipster-swiftsyntax/"/>
    <id>https://swift.gg/2019/01/25/nshipster-swiftsyntax/</id>
    <published>2019-01-25T00:00:00.000Z</published>
    <updated>2019-08-14T12:15:53.980Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ä½œè€…ï¼šMatttï¼Œ<a href="https://nshipster.com/swiftsyntax/" target="_blank" rel="noopener">åŸæ–‡é“¾æ¥</a>ï¼ŒåŸæ–‡æ—¥æœŸï¼š2018-10-22<br>è¯‘è€…ï¼š<a href="https://dingtz.com/" target="_blank" rel="noopener">jojotov</a>ï¼›æ ¡å¯¹ï¼š<a href="http://numbbbbb.com/" target="_blank" rel="noopener">numbbbbb</a>ï¼Œ<a href="http://blog.yousanflics.com.cn" target="_blank" rel="noopener">Yousanflics</a>ï¼Œ<a href="http://www.jianshu.com/users/596f2ba91ce9/latest_articles" target="_blank" rel="noopener">pmst</a>ï¼›å®šç¨¿ï¼š<a href="http://forelax.space" target="_blank" rel="noopener">Forelax</a></p></blockquote><!--æ­¤å¤„å¼€å§‹æ­£æ–‡--><p><a href="https://github.com/apple/swift-syntax" target="_blank" rel="noopener">SwiftSyntax</a> æ˜¯ä¸€ä¸ªå¯ä»¥åˆ†æã€ç”Ÿæˆä»¥åŠè½¬æ¢ Swift æºä»£ç çš„ Swift åº“ã€‚å®ƒæ˜¯åŸºäº <a href="https://github.com/apple/swift/tree/master/lib/Syntax" target="_blank" rel="noopener">libSyntax</a> åº“å¼€å‘çš„ï¼Œå¹¶äº <a href="https://github.com/apple/swift-syntax/commit/909d336aefacdcbdd45ec6130471644c1ae929f5" target="_blank" rel="noopener">2017 å¹´ 8 æœˆ</a> ä» Swift è¯­è¨€çš„ä¸»ä»“åº“ä¸­åˆ†ç¦»å‡ºæ¥ï¼Œå•ç‹¬å»ºç«‹äº†ä¸€ä¸ªä»“åº“ã€‚</p><a id="more"></a><p>æ€»çš„æ¥è¯´ï¼Œè¿™äº›åº“éƒ½æ˜¯ä¸ºäº†ç»™ç»“æ„åŒ–ç¼–è¾‘ï¼ˆstructured editingï¼‰æä¾›å®‰å…¨ã€æ­£ç¡®ä¸”ç›´è§‚çš„å·¥å…·ã€‚å…³äºç»“æ„åŒ–ç¼–è¾‘ï¼Œåœ¨ <a href="https://github.com/apple/swift/blob/master/lib/Syntax/README.md#swift-syntax-and-structured-editing-library" target="_blank" rel="noopener">thusly</a> ä¸­æœ‰å…·ä½“çš„æè¿°:</p><blockquote><p>ä»€ä¹ˆæ˜¯ç»“æ„åŒ–ç¼–è¾‘ï¼Ÿç»“æ„åŒ–ç¼–è¾‘æ˜¯ä¸€ç§ç¼–è¾‘çš„ç­–ç•¥ï¼Œå®ƒå¯¹æºä»£ç çš„<em>ç»“æ„</em>æ›´åŠ æ•æ„Ÿï¼Œè€Œæºä»£ç çš„è¡¨ç¤ºï¼ˆä¾‹å¦‚å­—ç¬¦æˆ–è€…å­—èŠ‚ï¼‰åˆ™æ²¡é‚£ä¹ˆé‡è¦ã€‚è¿™å¯ä»¥ç»†åŒ–ä¸ºä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†ï¼šæ›¿æ¢æ ‡è¯†ç¬¦ï¼Œå°†å¯¹å…¨å±€æ–¹æ³•çš„è°ƒç”¨è½¬ä¸ºå¯¹æ–¹æ³•çš„è°ƒç”¨ï¼Œæˆ–è€…æ ¹æ®å·²å®šçš„è§„åˆ™è¯†åˆ«å¹¶æ ¼å¼åŒ–æ•´ä¸ªæºæ–‡ä»¶ã€‚</p></blockquote><p>åœ¨å†™è¿™ç¯‡æ–‡ç« æ—¶ï¼ŒSwiftSyntax ä»å¤„äºåœ¨å¼€å‘ä¸­å¹¶è¿›è¡Œ API è°ƒæ•´çš„é˜¶æ®µã€‚ä¸è¿‡ç›®å‰ä½ å·²ç»å¯ä»¥ä½¿ç”¨å®ƒå¯¹ Swift ä»£ç è¿›è¡Œä¸€äº›ç¼–ç¨‹å·¥ä½œã€‚</p><p>ç›®å‰ï¼Œ<a href="https://github.com/apple/swift/tree/master/lib/Migrator" target="_blank" rel="noopener">Swift Migrator</a> å·²ç»åœ¨ä½¿ç”¨ SwiftSyntax äº†ï¼Œå¹¶ä¸”åœ¨å¯¹å†…å’Œå¯¹å¤–å±‚é¢ä¸Šï¼Œå¯¹ SwiftSyntax çš„æ¥å…¥ä¹Ÿåœ¨ä¸æ–­åœ°åŠªåŠ›ç€ã€‚</p><h2 id="SwiftSyntax-å¦‚ä½•å·¥ä½œï¼Ÿ"><a href="#SwiftSyntax-å¦‚ä½•å·¥ä½œï¼Ÿ" class="headerlink" title="SwiftSyntax å¦‚ä½•å·¥ä½œï¼Ÿ"></a>SwiftSyntax å¦‚ä½•å·¥ä½œï¼Ÿ</h2><p>ä¸ºäº†æ˜ç™½ SwiftSyntax å¦‚ä½•å·¥ä½œï¼Œæˆ‘ä»¬é¦–å…ˆè¦å›å¤´çœ‹çœ‹ Swift ç¼–è¯‘å™¨çš„æ¶æ„ï¼š</p><p><img src="https://nshipster.com/assets/swift-compilation-diagram-8af7d0078f72cdaa8f50430e608f15a9d4214f5772439d2fd6904bb5a8a53c60.png" alt></p><p>Swift ç¼–è¯‘å™¨çš„ä¸»è¦èŒè´£æ˜¯æŠŠ Swift ä»£ç è½¬æ¢ä¸ºå¯æ‰§è¡Œçš„æœºå™¨ä»£ç ã€‚æ•´ä¸ªè¿‡ç¨‹å¯ä»¥åˆ’åˆ†ä¸ºå‡ ä¸ªç¦»æ•£çš„æ­¥éª¤ï¼Œä¸€å¼€å§‹ï¼Œ<a href="https://github.com/apple/swift/tree/master/lib/Parse" target="_blank" rel="noopener">è¯­æ³•åˆ†æå™¨</a> ä¼šç”Ÿæˆä¸€ä¸ªæŠ½è±¡è¯­æ³•æ ‘ï¼ˆASTï¼‰ã€‚ä¹‹åï¼Œè¯­ä¹‰åˆ†æå™¨ä¼šè¿›è¡Œå·¥ä½œå¹¶ç”Ÿæˆä¸€ä¸ªé€šè¿‡ç±»å‹æ£€æŸ¥çš„ ASTã€‚è‡³æ­¤æ­¥éª¤ï¼Œä»£ç ä¼šé™çº§åˆ° <a href="https://github.com/apple/swift/blob/master/docs/SIL.rst" target="_blank" rel="noopener">Swift ä¸­é—´å±‚è¯­è¨€</a>ï¼›éšå SIL ä¼šç»§ç»­è½¬æ¢å¹¶ä¼˜åŒ–è‡ªèº«ï¼Œé™çº§ä¸º <a href="http://llvm.org/docs/LangRef.html" target="_blank" rel="noopener">LLVM IR</a>ï¼Œå¹¶æœ€ç»ˆç¼–è¯‘ä¸ºæœºå™¨ä»£ç ã€‚</p><p>å¯¹äºæˆ‘ä»¬çš„è®¨è®ºæ¥è¯´ï¼Œæœ€é‡è¦çš„å…³é”®ç‚¹æ˜¯ SwiftSyntax çš„æ“ä½œç›®æ ‡æ˜¯ç¼–è¯‘è¿‡ç¨‹ç¬¬ä¸€æ­¥æ‰€ç”Ÿæˆçš„ ASTã€‚ä½†ä¹Ÿç”±äºè¿™æ ·ï¼ŒSwiftSyntax æ— æ³•å‘ŠçŸ¥ä½ ä»»ä½•å…³äºä»£ç çš„è¯­ä¹‰æˆ–ç±»å‹ä¿¡æ¯ã€‚</p><p>ä¸ SwiftSyntax ç›¸åï¼Œä¸€äº›å¦‚ <a href="https://github.com/apple/swift/tree/master/tools/SourceKit" target="_blank" rel="noopener">SourceKit</a> ä¹‹ç±»çš„å·¥å…·ï¼Œæ“ä½œçš„ç›®æ ‡ä¸ºæ›´å®¹æ˜“ç†è§£çš„ Swift ä»£ç ã€‚è¿™å¯ä»¥å¸®åŠ©æ­¤ç±»å·¥å…·å®ç°ä¸€äº›ç¼–è¾‘å™¨ç›¸å…³çš„ç‰¹æ€§ï¼Œä¾‹å¦‚ä»£ç è¡¥å…¨æˆ–è€…æ–‡ä»¶ä¹‹é—´çš„è·³è½¬ã€‚è™½ç„¶ SwiftSyntax ä¸èƒ½åƒ SourceKit ä¸€æ ·å®ç°è·³è½¬æˆ–è€…è¡¥å…¨çš„åŠŸèƒ½ï¼Œä½†åœ¨è¯­æ³•å±‚é¢ä¸Šä¹Ÿæœ‰å¾ˆå¤šåº”ç”¨åœºæ™¯ï¼Œä¾‹å¦‚ä»£ç æ ¼å¼åŒ–å’Œè¯­æ³•é«˜äº®ã€‚</p><h3 id="æ­ç§˜-AST"><a href="#æ­ç§˜-AST" class="headerlink" title="æ­ç§˜ AST"></a>æ­ç§˜ AST</h3><p>æŠ½è±¡è¯­æ³•æ ‘åœ¨æŠ½è±¡å±‚é¢ä¸Šæ¯”è¾ƒéš¾ä»¥ç†è§£ã€‚å› æ­¤æˆ‘ä»¬å…ˆç”Ÿæˆä¸€ä¸ªç¤ºä¾‹æ¥ä¸€ç¹å…¶è²Œã€‚</p><p>ç•™æ„ä¸€ä¸‹å¦‚ä¸‹çš„ä¸€è¡Œ Swift ä»£ç ï¼Œå®ƒå£°æ˜äº†ä¸€ä¸ªåä¸º <code>one()</code> çš„å‡½æ•°ï¼Œå‡½æ•°è¿”å›å€¼ä¸º <code>1</code>ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">one</span><span class="params">()</span></span> -&gt; <span class="type">Int</span> &#123; <span class="keyword">return</span> <span class="number">1</span> &#125;</span><br></pre></td></tr></table></figure><p>åœ¨å‘½ä»¤è¡Œä¸­å¯¹æ­¤æ–‡ä»¶è¿è¡Œ <code>swiftc</code> å‘½ä»¤å¹¶ä¼ å…¥ <code>-frontend -emit-syntax</code> å‚æ•°ï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> xcrun swiftc -frontend -emit-syntax ./One.swift</span></span><br></pre></td></tr></table></figure><p>è¿è¡Œçš„ç»“æœä¸ºä¸€ä¸² JSON æ ¼å¼çš„ ASTã€‚å½“ä½ ç”¨ JSON æ ¼å¼æ¥å±•ç¤ºæ—¶ï¼ŒAST çš„ç»“æ„ä¼šè¡¨ç°çš„æ›´åŠ æ¸…æ™°ï¼š</p><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"kind"</span>: <span class="string">"SourceFile"</span>,</span><br><span class="line">    <span class="attr">"layout"</span>: [&#123;</span><br><span class="line">        <span class="attr">"kind"</span>: <span class="string">"CodeBlockItemList"</span>,</span><br><span class="line">        <span class="attr">"layout"</span>: [&#123;</span><br><span class="line">            <span class="attr">"kind"</span>: <span class="string">"CodeBlockItem"</span>,</span><br><span class="line">            <span class="attr">"layout"</span>: [&#123;</span><br><span class="line">                <span class="attr">"kind"</span>: <span class="string">"FunctionDecl"</span>,</span><br><span class="line">                <span class="attr">"layout"</span>: [<span class="literal">null</span>, <span class="literal">null</span>, &#123;</span><br><span class="line">                    <span class="attr">"tokenKind"</span>: &#123;</span><br><span class="line">                        <span class="attr">"kind"</span>: <span class="string">"kw_func"</span></span><br><span class="line">                    &#125;,</span><br><span class="line">                    <span class="attr">"leadingTrivia"</span>: [],</span><br><span class="line">                    <span class="attr">"trailingTrivia"</span>: [&#123;</span><br><span class="line">                        <span class="attr">"kind"</span>: <span class="string">"Space"</span>,</span><br><span class="line">                        <span class="attr">"value"</span>: <span class="number">1</span></span><br><span class="line">                    &#125;],</span><br><span class="line">                    <span class="attr">"presence"</span>: <span class="string">"Present"</span></span><br><span class="line">                &#125;, &#123;</span><br><span class="line">                    <span class="attr">"tokenKind"</span>: &#123;</span><br><span class="line">                        <span class="attr">"kind"</span>: <span class="string">"identifier"</span>,</span><br><span class="line">                        <span class="attr">"text"</span>: <span class="string">"one"</span></span><br><span class="line">                    &#125;,</span><br><span class="line">                    <span class="attr">"leadingTrivia"</span>: [],</span><br><span class="line">                    <span class="attr">"trailingTrivia"</span>: [],</span><br><span class="line">                    <span class="attr">"presence"</span>: <span class="string">"Present"</span></span><br><span class="line">                &#125;, ...</span><br></pre></td></tr></table></figure><p>Python ä¸­çš„ <code>json.tool</code> æ¨¡å—æä¾›äº†ä¾¿æ·åœ°æ ¼å¼åŒ– JSON çš„èƒ½åŠ›ã€‚ä¸”å‡ ä¹æ‰€æœ‰çš„ macOS ç³»ç»Ÿéƒ½å·²ç»é›†æˆäº†æ­¤æ¨¡å—ï¼Œå› æ­¤æ¯ä¸ªäººéƒ½å¯ä»¥ä½¿ç”¨å®ƒã€‚ä¸¾ä¸ªä¾‹å­ï¼Œä½ å¯ä»¥ä½¿ç”¨å¦‚ä¸‹çš„å‘½ä»¤å¯¹ç¼–è¯‘çš„è¾“å‡ºç»“æœä½¿ç”¨ <code>json.tool</code> æ ¼å¼åŒ–ï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> xcrun swiftc -frontend -emit-syntax ./One.swift | python -m json.tool</span></span><br></pre></td></tr></table></figure><p>åœ¨æœ€å¤–å±‚ï¼Œå¯ä»¥çœ‹åˆ° <code>SourceFile</code>ï¼Œå®ƒç”± <code>CodeBlockItemList</code> ä»¥åŠ <code>CodeBlockItemList</code> å†…éƒ¨çš„ <code>CodeBlockItem</code> è¿™å‡ ä¸ªéƒ¨åˆ†ç»„æˆã€‚å¯¹äºè¿™ä¸ªç¤ºä¾‹æ¥è¯´ï¼Œä»…æœ‰ä¸€ä¸ª <code>CodeBlockItem</code> å¯¹åº”å‡½æ•°çš„å®šä¹‰ï¼ˆ<code>FunctionDecl</code>ï¼‰ï¼Œå…¶è‡ªèº«åŒ…å«äº†å‡ ä¸ªå­ç»„ä»¶å¦‚å‡½æ•°ç­¾åã€å‚æ•°é—­åŒ…å’Œè¿”å›é—­åŒ…ã€‚</p><p>æœ¯è¯­ trivia ç”¨äºæè¿°ä»»ä½•æ²¡æœ‰å®é™…è¯­æ³•æ„ä¹‰çš„ä¸œè¥¿ï¼Œä¾‹å¦‚ç©ºæ ¼ã€‚æ¯ä¸ªæ ‡è®°ç¬¦ï¼ˆTokenï¼‰å¯ä»¥æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªè¡Œå‰å’Œè¡Œå°¾çš„ triviaã€‚ä¾‹å¦‚ï¼Œåœ¨è¿”å›çš„é—­åŒ…ï¼ˆ<code>-&gt; Int</code>ï¼‰ä¸­çš„ <code>Int</code> åçš„ç©ºæ ¼å¯ä»¥ç”¨å¦‚ä¸‹çš„è¡Œå°¾ trivia è¡¨ç¤ºï¼š</p><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"kind"</span>: <span class="string">"Space"</span>,</span><br><span class="line">  <span class="attr">"value"</span>: <span class="number">1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å¤„ç†æ–‡ä»¶ç³»ç»Ÿé™åˆ¶"><a href="#å¤„ç†æ–‡ä»¶ç³»ç»Ÿé™åˆ¶" class="headerlink" title="å¤„ç†æ–‡ä»¶ç³»ç»Ÿé™åˆ¶"></a>å¤„ç†æ–‡ä»¶ç³»ç»Ÿé™åˆ¶</h3><p>SwiftSyntax é€šè¿‡ä»£ç†ç³»ç»Ÿçš„ <code>swiftc</code> è°ƒç”¨æ¥ç”ŸæˆæŠ½è±¡è¯­æ³•æ ‘ã€‚ä½†æ˜¯ï¼Œè¿™ä¹Ÿé™åˆ¶äº†ä»£ç å¿…é¡»æ”¾åœ¨æŸä¸ªæ–‡ä»¶æ‰èƒ½è¿›è¡Œå¤„ç†ï¼Œè€Œæˆ‘ä»¬å´ç»å¸¸éœ€è¦å¯¹ä»¥å­—ç¬¦ä¸²è¡¨ç¤ºçš„ä»£ç è¿›è¡Œå¤„ç†ã€‚</p><p>ä¸ºäº†è§£å†³è¿™ä¸ªé™åˆ¶ï¼Œå…¶ä¸­ä¸€ç§åŠæ³•æ˜¯æŠŠä»£ç å†™å…¥ä¸€ä¸ªä¸´æ—¶æ–‡ä»¶å¹¶ä¼ å…¥åˆ°ç¼–è¯‘å™¨ä¸­ã€‚</p><p><a href="https://nshipster.com/nstemporarydirectory/" target="_blank" rel="noopener">æˆ‘ä»¬æ›¾ç»å°è¯•è¿‡å†™å…¥ä¸´æ—¶æ–‡ä»¶</a>ï¼Œä½†ç›®å‰ï¼Œæœ‰æ›´å¥½çš„ API å¯ä»¥å¸®åŠ©æˆ‘ä»¬å®Œæˆè¿™é¡¹å·¥ä½œï¼Œå®ƒç”±  <a href="https://github.com/apple/swift-package-manager" target="_blank" rel="noopener">Swift Package Manager</a> æœ¬èº«æä¾›ã€‚åœ¨ä½ çš„ <code>Package.swift</code> æ–‡ä»¶ä¸­ï¼Œæ·»åŠ å¦‚ä¸‹çš„åŒ…ä¾èµ–å…³ç³»ï¼Œå¹¶æŠŠ <code>Utility</code> ä¾èµ–æ·»åŠ åˆ°æ­£ç¡®çš„ target ä¸­ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">.package(url: <span class="string">"https://github.com/apple/swift-package-manager.git"</span>, from: <span class="string">"0.3.0"</span>),</span><br></pre></td></tr></table></figure><p>ç°åœ¨ï¼Œä½ å¯ä»¥åƒä¸‹é¢è¿™æ ·å¼•å…¥ <code>Basic</code> æ¨¡å—å¹¶ä½¿ç”¨ <code>TemporaryFile</code> APIï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Basic</span><br><span class="line"><span class="keyword">import</span> Foundation</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> code: <span class="type">String</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> tempfile = <span class="keyword">try</span> <span class="type">TemporaryFile</span>(deleteOnClose: <span class="literal">true</span>)</span><br><span class="line"><span class="keyword">defer</span> &#123; tempfile.fileHandle.closeFile() &#125;</span><br><span class="line">tempfile.fileHandle.write(code.data(using: .utf8)!)</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> url = <span class="type">URL</span>(fileURLWithPath: tempfile.path.asString)</span><br><span class="line"><span class="keyword">let</span> sourceFile = <span class="keyword">try</span> <span class="type">SyntaxTreeParser</span>.parse(url)</span><br></pre></td></tr></table></figure><h2 id="æˆ‘ä»¬å¯ä»¥ç”¨-SwiftSyntax-åšä»€ä¹ˆ"><a href="#æˆ‘ä»¬å¯ä»¥ç”¨-SwiftSyntax-åšä»€ä¹ˆ" class="headerlink" title="æˆ‘ä»¬å¯ä»¥ç”¨ SwiftSyntax åšä»€ä¹ˆ"></a>æˆ‘ä»¬å¯ä»¥ç”¨ SwiftSyntax åšä»€ä¹ˆ</h2><p>ç°åœ¨æˆ‘ä»¬å¯¹ SwiftSyntax å¦‚ä½•å·¥ä½œå·²ç»æœ‰äº†è¶³å¤Ÿçš„ç†è§£ï¼Œæ˜¯æ—¶å€™è®¨è®ºä¸€ä¸‹å‡ ä¸ªä½¿ç”¨å®ƒçš„æ–¹å¼äº†ï¼</p><h3 id="ç¼–å†™-Swift-ä»£ç ï¼šåœ°ç‹±æ¨¡å¼"><a href="#ç¼–å†™-Swift-ä»£ç ï¼šåœ°ç‹±æ¨¡å¼" class="headerlink" title="ç¼–å†™ Swift ä»£ç ï¼šåœ°ç‹±æ¨¡å¼"></a>ç¼–å†™ Swift ä»£ç ï¼šåœ°ç‹±æ¨¡å¼</h3><p>æˆ‘ä»¬ç¬¬ä¸€ä¸ªæƒ³åˆ°ï¼Œä½†å´æ˜¯æœ€æ²¡æœ‰å®é™…æ„ä¹‰çš„ SwiftSyntax ç”¨ä¾‹å°±æ˜¯è®©ç¼–å†™ Swift ä»£ç çš„éš¾åº¦æå‡å‡ ä¸ªæ•°é‡çº§ã€‚</p><p>åˆ©ç”¨ SwiftSyntax ä¸­çš„ <code>SyntaxFactory</code> APIsï¼Œæˆ‘ä»¬å¯ä»¥ç”Ÿæˆå®Œæ•´çš„ Swift ä»£ç ã€‚ä¸å¹¸çš„æ˜¯ï¼Œç¼–å†™è¿™æ ·çš„ä»£ç å¹¶ä¸åƒé—²åº­æ•£æ­¥èˆ¬è½»æ¾ã€‚</p><p>ç•™æ„ä¸€ä¸‹å¦‚ä¸‹çš„ç¤ºä¾‹ä»£ç ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftSyntax</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> structKeyword = <span class="type">SyntaxFactory</span>.makeStructKeyword(trailingTrivia: .spaces(<span class="number">1</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> identifier = <span class="type">SyntaxFactory</span>.makeIdentifier(<span class="string">"Example"</span>, trailingTrivia: .spaces(<span class="number">1</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> leftBrace = <span class="type">SyntaxFactory</span>.makeLeftBraceToken()</span><br><span class="line"><span class="keyword">let</span> rightBrace = <span class="type">SyntaxFactory</span>.makeRightBraceToken(leadingTrivia: .newlines(<span class="number">1</span>))</span><br><span class="line"><span class="keyword">let</span> members = <span class="type">MemberDeclBlockSyntax</span> &#123; builder <span class="keyword">in</span></span><br><span class="line">    builder.useLeftBrace(leftBrace)</span><br><span class="line">    builder.useRightBrace(rightBrace)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> structureDeclaration = <span class="type">StructDeclSyntax</span> &#123; builder <span class="keyword">in</span></span><br><span class="line">    builder.useStructKeyword(structKeyword)</span><br><span class="line">    builder.useIdentifier(identifier)</span><br><span class="line">    builder.useMembers(members)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(structureDeclaration)</span><br></pre></td></tr></table></figure><p><em>å”·ã€‚</em>é‚£æœ€åè¿™æ®µä»£ç è®©æˆ‘ä»¬å¾—åˆ°äº†ä»€ä¹ˆå‘¢ï¼Ÿ</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Example</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><em>ä»¤äººçª’æ¯çš„æ“ä½œã€‚</em></p><p>è¿™ç»ä¸æ˜¯ä¸ºäº†å–ä»£ <a href="https://nshipster.com/swift-gyb/" target="_blank" rel="noopener">GYB</a> æ¥ç”¨äºæ¯å¤©çš„ä»£ç ç”Ÿæˆã€‚ï¼ˆäº‹å®ä¸Šï¼Œ<a href="https://github.com/apple/swift/blob/master/lib/Syntax/SyntaxKind.cpp.gyb" target="_blank" rel="noopener">libSyntax</a> å’Œ <a href="https://github.com/apple/swift-syntax/blob/master/Sources/SwiftSyntax/SyntaxKind.swift.gyb" target="_blank" rel="noopener">SwiftSyntax</a> éƒ½ä½¿ç”¨äº† <code>gyb</code> æ¥ç”Ÿæˆæ¥å£ã€‚</p><p>ä½†è¿™ä¸ªæ¥å£åœ¨æŸäº›ç‰¹æ®Šçš„é—®é¢˜ä¸Šå´æ ¼å¤–æœ‰ç”¨ã€‚ä¾‹å¦‚ï¼Œä½ æˆ–è®¸ä¼šä½¿ç”¨ SwiftSyntax æ¥å®ç°ä¸€ä¸ª Swift ç¼–è¯‘å™¨çš„ <a href="https://en.wikipedia.org/wiki/Fuzzing" target="_blank" rel="noopener">æ¨¡ç³Šæµ‹è¯•</a>ï¼Œä½¿ç”¨å®ƒå¯ä»¥éšæœºç”Ÿæˆä¸€ä¸ªè¡¨é¢æœ‰æ•ˆå´å®é™…ä¸Šéå¸¸å¤æ‚çš„ç¨‹åºï¼Œä»¥æ­¤æ¥è¿›è¡Œå‹åŠ›æµ‹è¯•ã€‚</p><h2 id="é‡å†™-Swift-ä»£ç "><a href="#é‡å†™-Swift-ä»£ç " class="headerlink" title="é‡å†™ Swift ä»£ç "></a>é‡å†™ Swift ä»£ç </h2><p><a href="https://github.com/apple/swift-syntax#example" target="_blank" rel="noopener">åœ¨ SwiftSyntax çš„ README ä¸­æœ‰ä¸€ä¸ªç¤ºä¾‹</a> å±•ç¤ºäº†å¦‚ä½•ç¼–å†™ä¸€ä¸ªç¨‹åºæ¥éå†æºæ–‡ä»¶ä¸­çš„æ•´å‹å¹¶æŠŠä»–ä»¬çš„å€¼åŠ  1ã€‚</p><p>é€šè¿‡è¿™ä¸ªï¼Œä½ åº”è¯¥å·²ç»æ¨æ–­å¾—å‡ºå¦‚ä½•ä½¿ç”¨å®ƒæ¥åˆ›å»ºä¸€ä¸ªå…¸å‹çš„ <code>swift-format</code> å·¥å…·ã€‚</p><p>ä½†ç°åœ¨ï¼Œæˆ‘ä»¬å…ˆè€ƒè™‘ä¸€ä¸ªç›¸å½“<em>æ²¡æœ‰</em>æ•ˆç‡â€”â€”å¹¶ä¸”å¯èƒ½åœ¨ä¸‡åœ£èŠ‚ï¼ˆğŸƒï¼‰è¿™ç§éœ€è¦æ£è›‹çš„åœºæ™¯æ‰åˆé€‚çš„ç”¨ä¾‹ï¼Œæºä»£ç é‡å†™ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftSyntax</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ZalgoRewriter</span>: <span class="title">SyntaxRewriter</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">visit</span><span class="params">(<span class="number">_</span> token: TokenSyntax)</span></span> -&gt; <span class="type">Syntax</span> &#123;</span><br><span class="line">        <span class="keyword">guard</span> <span class="keyword">case</span> <span class="keyword">let</span> .stringLiteral(text) = token.tokenKind <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> token</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> token.withKind(.stringLiteral(zalgo(text)))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a href="https://gist.github.com/mattt/b46ab5027f1ee6ab1a45583a41240033" target="_blank" rel="noopener"><code>zalgo</code></a> å‡½æ•°æ˜¯ç”¨æ¥åšä»€ä¹ˆçš„ï¼Ÿå¯èƒ½ä¸çŸ¥é“ä¼šæ›´å¥½â€¦â€¦</p><p>ä¸ç®¡æ€æ ·ï¼Œåœ¨ä½ çš„æºä»£ç ä¸­è¿è¡Œè¿™ä¸ªé‡å†™å™¨ï¼Œå¯ä»¥æŠŠæ‰€æœ‰çš„æ–‡æœ¬å­—ç¬¦ä¸²è½¬æ¢ä¸ºåƒä¸‹é¢ä¸€æ ·çš„æ•ˆæœï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Before ğŸ‘‹ğŸ˜„</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">"Hello, world!"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// After ğŸ¦‘ğŸ˜µ</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">"HÍÍÌ‚ÌŸÍ©elÍ¬ÍœÍ†ÌµlÍÌªÌ£ÌÍ oÌ‹Ì¡ÍÌ¼Í“Ì›, wÍ¢ÍÌ½Ì‡ÍªoÌ•ÌŒÌ©Í”Ì²ÍrÌ‰Ì Ì¡Í‚Í“Ì·lÌ˜Ì†Í¯ÌŠÌ³d!"</span>)</span><br></pre></td></tr></table></figure><p><em>é¬¼é­…ä¸€èˆ¬ï¼Œå¯¹å§ï¼Ÿ</em></p><h2 id="é«˜äº®-Swift-ä»£ç "><a href="#é«˜äº®-Swift-ä»£ç " class="headerlink" title="é«˜äº® Swift ä»£ç "></a>é«˜äº® Swift ä»£ç </h2><p>è®©æˆ‘ä»¬ç”¨ä¸€ä¸ªçœŸæ­£å®ç”¨çš„ä¸œè¥¿æ¥æ€»ç»“æˆ‘ä»¬å¯¹ SwiftSyntax çš„æ¢ç©¶ï¼šä¸€ä¸ª Swift è¯­æ³•é«˜äº®å·¥å…·ã€‚</p><p>ä»è¯­æ³•é«˜äº®å·¥å…·çš„æ„ä¹‰ä¸Šæ¥è¯´ï¼Œå®ƒå¯ä»¥æŠŠæºä»£ç æŒ‰æŸç§æ–¹å¼æ ¼å¼åŒ–ä¸ºæ˜¾ç¤ºæ›´ä¸ºå‹å¥½çš„ HTMLã€‚</p><p><a href="https://github.com/NSHipster/nshipster.com" target="_blank" rel="noopener">NSHipster é€šè¿‡ Jekyll æ­å»º</a>ï¼Œå¹¶ä½¿ç”¨äº† Ruby çš„åº“ <a href="https://github.com/jneen/rouge" target="_blank" rel="noopener">Rouge</a> æ¥æ¸²æŸ“ä½ åœ¨æ¯ç¯‡æ–‡ç« ä¸­çœ‹åˆ°çš„ç¤ºä¾‹ä»£ç ã€‚å°½ç®¡å¦‚æ­¤ï¼Œç”±äº Swift çš„å¤æ‚è¯­æ³•å’Œè¿‡å¿«è¿­ä»£ï¼Œæ¸²æŸ“å‡ºæ¥çš„ HTML å¹¶ä¸æ˜¯ 100% æ­£ç¡®ã€‚</p><p>ä¸åŒäº <a href="https://github.com/jneen/rouge/blob/master/lib/rouge/lexers/swift.rb" target="_blank" rel="noopener">å¤„ç†ä¸€å †éº»çƒ¦çš„æ­£åˆ™è¡¨è¾¾å¼</a>ï¼Œæˆ‘ä»¬å¯ä»¥æ„é€ ä¸€ä¸ª <a href="https://github.com/NSHipster/SwiftSyntaxHighlighter" target="_blank" rel="noopener">è¯­æ³•é«˜äº®å™¨</a> æ¥æ”¾å¤§ SwiftSyntax å¯¹è¯­è¨€çš„ç†è§£çš„ä¼˜åŠ¿ã€‚</p><p>æ ¹æ®è¿™ä¸ªæ ¸å¿ƒç›®çš„ï¼Œå®ç°çš„æ–¹æ³•å¯ä»¥å¾ˆç›´æ¥ï¼šå®ç°ä¸€ä¸ª <code>SyntaxRewriter</code> çš„å­ç±»å¹¶é‡å†™ <code>visit(_:)</code> æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•ä¼šåœ¨éå†æºæ–‡ä»¶çš„æ¯ä¸ªæ ‡è¯†ç¬¦æ—¶è¢«è°ƒç”¨ã€‚é€šè¿‡åˆ¤æ–­æ¯ç§ä¸åŒçš„æ ‡è¯†ç¬¦ç±»å‹ï¼Œä½ å¯ä»¥æŠŠç›¸åº”çš„å¯é«˜äº®æ ‡è¯†ç¬¦æ˜ å°„ä¸º HTML æ ‡è®°ã€‚</p><p>ä¾‹å¦‚ï¼Œæ•°å­—æ–‡æœ¬å¯ä»¥ç”¨ç±»åæ˜¯ <code>m</code> å¼€å¤´çš„ <code>&lt;span&gt;</code> å…ƒç´ æ¥è¡¨ç¤ºï¼ˆ<code>mf</code> è¡¨ç¤ºæµ®ç‚¹å‹ï¼Œ<code>mi</code> è¡¨ç¤ºæ•´å‹ï¼‰ã€‚å¦‚ä¸‹æ˜¯å¯¹åº”çš„åœ¨ <code>SyntaxRewriter</code> å­ç±»ä¸­çš„ä»£ç ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftSyntax</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SwiftSyntaxHighlighter</span>: <span class="title">SyntaxRewriter</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> html: <span class="type">String</span> = <span class="string">""</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">visit</span><span class="params">(<span class="number">_</span> token: TokenSyntax)</span></span> -&gt; <span class="type">Syntax</span> &#123;</span><br><span class="line">        <span class="keyword">switch</span> token.tokenKind &#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">        <span class="keyword">case</span> .floatingLiteral(<span class="keyword">let</span> string):</span><br><span class="line">            html += <span class="string">"&lt;span class=\"mf\"&gt;\(string)&lt;/span&gt;"</span></span><br><span class="line">        <span class="keyword">case</span> .integerLiteral(<span class="keyword">let</span> string):</span><br><span class="line">            <span class="keyword">if</span> string.hasPrefix(<span class="string">"0b"</span>) &#123;</span><br><span class="line">                html += <span class="string">"&lt;span class=\"mb\"&gt;\(string)&lt;/span&gt;"</span></span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> string.hasPrefix(<span class="string">"0o"</span>) &#123;</span><br><span class="line">                html += <span class="string">"&lt;span class=\"mo\"&gt;\(string)&lt;/span&gt;"</span></span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> string.hasPrefix(<span class="string">"0x"</span>) &#123;</span><br><span class="line">                html += <span class="string">"&lt;span class=\"mh\"&gt;\(string)&lt;/span&gt;"</span></span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                html += <span class="string">"&lt;span class=\"mi\"&gt;\(string)&lt;/span&gt;"</span></span><br><span class="line">            &#125;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> token</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å°½ç®¡ <code>SyntaxRewritere</code> é’ˆå¯¹æ¯ä¸€ç§ä¸åŒç±»å‹çš„è¯­æ³•å…ƒç´ ï¼Œéƒ½å·²ç»å®ç°äº† <code>visit(:)</code> æ–¹æ³•ï¼Œä½†æˆ‘å‘ç°ä½¿ç”¨ä¸€ä¸ª <code>switch</code> è¯­å¥å¯ä»¥æ›´ç®€å•åœ°å¤„ç†æ‰€æœ‰å·¥ä½œã€‚ï¼ˆåœ¨ <code>default</code> åˆ†æ”¯ä¸­æ‰“å°å‡ºæ— æ³•å¤„ç†çš„æ ‡è®°ç¬¦ï¼Œå¯ä»¥æ›´å¥½åœ°å¸®åŠ©æˆ‘ä»¬æ‰¾åˆ°é‚£äº›æ²¡æœ‰å¤„ç†çš„æƒ…å†µï¼‰ã€‚è¿™ä¸æ˜¯æœ€ä¼˜é›…çš„å®ç°ï¼Œä½†é‰´äºæˆ‘å¯¹ SwiftSyntax ä¸è¶³çš„ç†è§£ï¼Œè¿™æ˜¯ä¸ªè¾ƒå¥½çš„å¼€ç«¯ã€‚</p><p>ä¸ç®¡æ€æ ·ï¼Œåœ¨å‡ ä¸ªå°æ—¶çš„å¼€å‘å·¥ä½œåï¼Œæˆ‘å·²ç»å¯ä»¥åœ¨ Swift å¤§é‡çš„è¯­æ³•ç‰¹æ€§ä¸­ï¼Œç”Ÿæˆå‡ºæ¯”è¾ƒç†æƒ³çš„æ¸²æŸ“è¿‡çš„è¾“å‡ºã€‚</p><p><img src="https://nshipster.com/assets/swiftsyntaxhightlighter-example-output-829aa64ab4bdf73a2e3070aab017e21e3db37ca0ee35079f0e89e22594806df0.png" alt></p><p>è¿™ä¸ªé¡¹ç›®éœ€è¦ä¸€ä¸ªåº“å’Œå‘½ä»¤è¡Œå·¥å…·çš„æ”¯æŒã€‚å¿«å» <a href="https://github.com/NSHipster/SwiftSyntaxHighlighter" target="_blank" rel="noopener">å°è¯•ä¸€ä¸‹ </a>ç„¶åè®©æˆ‘çŸ¥é“ä½ çš„æƒ³æ³•å§ï¼</p><blockquote><p>æœ¬æ–‡ç”± SwiftGG ç¿»è¯‘ç»„ç¿»è¯‘ï¼Œå·²ç»è·å¾—ä½œè€…ç¿»è¯‘æˆæƒï¼Œæœ€æ–°æ–‡ç« è¯·è®¿é—® <a href="http://swift.gg">http://swift.gg</a>ã€‚</p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;ä½œè€…ï¼šMatttï¼Œ&lt;a href=&quot;https://nshipster.com/swiftsyntax/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;åŸæ–‡é“¾æ¥&lt;/a&gt;ï¼ŒåŸæ–‡æ—¥æœŸï¼š2018-10-22&lt;br&gt;è¯‘è€…ï¼š&lt;a href=&quot;https://dingtz.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;jojotov&lt;/a&gt;ï¼›æ ¡å¯¹ï¼š&lt;a href=&quot;http://numbbbbb.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;numbbbbb&lt;/a&gt;ï¼Œ&lt;a href=&quot;http://blog.yousanflics.com.cn&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Yousanflics&lt;/a&gt;ï¼Œ&lt;a href=&quot;http://www.jianshu.com/users/596f2ba91ce9/latest_articles&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;pmst&lt;/a&gt;ï¼›å®šç¨¿ï¼š&lt;a href=&quot;http://forelax.space&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Forelax&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;!--æ­¤å¤„å¼€å§‹æ­£æ–‡--&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/apple/swift-syntax&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;SwiftSyntax&lt;/a&gt; æ˜¯ä¸€ä¸ªå¯ä»¥åˆ†æã€ç”Ÿæˆä»¥åŠè½¬æ¢ Swift æºä»£ç çš„ Swift åº“ã€‚å®ƒæ˜¯åŸºäº &lt;a href=&quot;https://github.com/apple/swift/tree/master/lib/Syntax&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;libSyntax&lt;/a&gt; åº“å¼€å‘çš„ï¼Œå¹¶äº &lt;a href=&quot;https://github.com/apple/swift-syntax/commit/909d336aefacdcbdd45ec6130471644c1ae929f5&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;2017 å¹´ 8 æœˆ&lt;/a&gt; ä» Swift è¯­è¨€çš„ä¸»ä»“åº“ä¸­åˆ†ç¦»å‡ºæ¥ï¼Œå•ç‹¬å»ºç«‹äº†ä¸€ä¸ªä»“åº“ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="Swift" scheme="https://swift.gg/categories/Swift/"/>
    
      <category term="NSHipster" scheme="https://swift.gg/categories/Swift/NSHipster/"/>
    
    
      <category term="Swift" scheme="https://swift.gg/tags/Swift/"/>
    
      <category term="NSHipster" scheme="https://swift.gg/tags/NSHipster/"/>
    
  </entry>
  
  <entry>
    <title>ä»¥æµçš„å½¢å¼æ‰§è¡Œ Multipart è¯·æ±‚</title>
    <link href="https://swift.gg/2019/01/21/streaming-multipart-requests/"/>
    <id>https://swift.gg/2019/01/21/streaming-multipart-requests/</id>
    <published>2019-01-21T00:00:00.000Z</published>
    <updated>2019-08-14T12:15:53.980Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ä½œè€…ï¼šSoroush Khanlouï¼Œ<a href="http://khanlou.com/2018/11/streaming-multipart-requests/" target="_blank" rel="noopener">åŸæ–‡é“¾æ¥</a>ï¼ŒåŸæ–‡æ—¥æœŸï¼š2018-11-14<br>è¯‘è€…ï¼š<a href="https://www.jianshu.com/u/076cc5e18bb8" target="_blank" rel="noopener">éƒ‘ä¸€ä¸€</a>ï¼›æ ¡å¯¹ï¼š<a href="http://numbbbbb.com/" target="_blank" rel="noopener">numbbbbb</a>ï¼Œ<a href="http://www.jianshu.com/users/596f2ba91ce9/latest_articles" target="_blank" rel="noopener">pmst</a>ï¼›å®šç¨¿ï¼š<a href="http://forelax.space" target="_blank" rel="noopener">Forelax</a></p></blockquote><!--æ­¤å¤„å¼€å§‹æ­£æ–‡--><p>Foundation æ¡†æ¶ä¸­çš„ URL ç±»æä¾›äº†éå¸¸å…¨é¢çš„åŠŸèƒ½ï¼Œæ­¤åè¿˜åœ¨ iOS 7 ä¸­æ–°å¢äº† URLSession ç±»ã€‚å°½ç®¡å¦‚æ­¤ï¼ŒåŸºç¡€åº“ä¸­ä»ç„¶ç¼ºå°‘ multipart æ–‡ä»¶ä¸Šä¼ çš„åŠŸèƒ½ã€‚</p><a id="more"></a><h2 id="ä»€ä¹ˆæ˜¯-multipart-è¯·æ±‚ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯-multipart-è¯·æ±‚ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯ multipart è¯·æ±‚ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯ multipart è¯·æ±‚ï¼Ÿ</h2><p>Multipart ç¼–ç å®é™…ä¸Šå°±æ˜¯åœ¨ç½‘ç»œä¸­ä¸Šä¼ å¤§å‹æ–‡ä»¶çš„æ–¹æ³•ã€‚åœ¨æµè§ˆå™¨ä¸­ï¼Œæœ‰æ—¶å€™ä½ ä¼šé€‰æ‹©ä¸€ä¸ªæ–‡ä»¶ä½œä¸ºè¡¨å•æäº¤å†…å®¹çš„ä¸€éƒ¨åˆ†ã€‚è¿™ä¸ªæ–‡ä»¶ä¾¿æ˜¯ä»¥ multipart è¯·æ±‚çš„æ–¹å¼å®ç°ä¸Šä¼ çš„ã€‚</p><p>ä¹ä¸€çœ‹ï¼Œmultipart è¯·æ±‚å’Œä¸€èˆ¬è¯·æ±‚å·®ä¸å¤šã€‚ä¸åŒä¹‹å¤„æ˜¯ multipart è¯·æ±‚é¢å¤–ä¸º <code>HTTP</code> è¯·æ±‚ä½“æŒ‡å®šäº†å”¯ä¸€ç¼–ç ã€‚åŒ JSON ç¼–ç ï¼ˆ<code>{&quot;key&quot;: &quot;value&quot;}</code>ï¼‰æˆ–è€… URL å­—ç¬¦ç¼–ç  (<code>key=value</code>) ç›¸æ¯”ï¼Œmultipart ç¼–ç å¹²çš„äº‹ç•¥å¾®æœ‰æ‰€ä¸åŒã€‚å› ä¸º multipart è¯·æ±‚ä½“å®é™…ä¸Šåªæ˜¯ä¸€ä¸²å­—èŠ‚æµï¼Œæ¥æ”¶ç«¯å®ä½“åœ¨è§£ææ•°æ®æ—¶ï¼Œéœ€è¦çŸ¥é“å­—èŠ‚æµä¸­å„ä¸ªéƒ¨åˆ†ä¹‹é—´çš„ç•Œé™ã€‚æ‰€ä»¥ multipart è¯·æ±‚éœ€è¦ä½¿ç”¨ â€œboundariesâ€ æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚åœ¨è¯·æ±‚é¦–éƒ¨çš„ <code>Content-Type</code> ä¸­ï¼Œå¯ä»¥å®šä¹‰ boundaryï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Accept: application/json</span><br><span class="line">Content-Type: multipart/form-data; boundary=khanlou.comNczcJGcxe</span><br></pre></td></tr></table></figure><p>Boundary çš„å…·ä½“å†…å®¹å¹¶ä¸é‡è¦ï¼Œå”¯ä¸€éœ€è¦æ³¨æ„çš„æ˜¯ï¼šåœ¨è¯·æ±‚ä½“ä¸­ï¼Œboundary æ˜¯ä¸èƒ½é‡å¤å‡ºç°ï¼ˆè¿™æ ·æ‰èƒ½ä½“ç° boundary çš„ä½œç”¨ï¼‰ã€‚ä½ å¯ä»¥ä½¿ç”¨ UUID ä½œä¸º boundaryã€‚</p><p>è¯·æ±‚çš„æ¯ä¸€éƒ¨åˆ†å¯ä»¥æ˜¯æ™®é€šæ•°æ®ï¼ˆæ¯”å¦‚å›¾ç‰‡ï¼‰æˆ–è€…å…ƒæ•°æ®ï¼ˆä¸€èˆ¬æ˜¯æ–‡æœ¬ï¼Œå¯¹åº”ä¸€ä¸ªåå­—ï¼Œç»„æˆä¸€ä¸ªé”®å€¼å¯¹ï¼‰ã€‚å¦‚æœæ•°æ®æ˜¯å›¾ç‰‡çš„è¯ï¼Œé‚£å®ƒçœ‹èµ·æ¥åº”è¯¥æ˜¯è¿™æ ·çš„ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">--&lt;boundary&gt;</span><br><span class="line">Content-Disposition: form-data; name=&lt;name&gt;; filename=&lt;filename.jpg&gt;</span><br><span class="line">Content-Type: image/jpeg</span><br><span class="line"></span><br><span class="line">&lt;image data&gt;</span><br></pre></td></tr></table></figure><p>å¦‚æœæ˜¯æ™®é€šæ–‡æœ¬ï¼Œåˆ™æ˜¯è¿™æ ·ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">--&lt;boundary&gt;</span><br><span class="line">Content-Disposition: form-data; name=&lt;name&gt;</span><br><span class="line">Content-Type: text/plain</span><br><span class="line"></span><br><span class="line">&lt;some text&gt;</span><br></pre></td></tr></table></figure><p>è¯·æ±‚ç»“å°¾ä¼šæœ‰ä¸€ä¸ªå¸¦ç€ä¸¤ä¸ªè¿å­—ç¬¦çš„ boundaryï¼Œ<code>--&lt;boundary&gt;--</code>ã€‚ï¼ˆæ­¤å¤„éœ€è¦æ³¨æ„ï¼Œæ‰€æœ‰æ–°è¡Œå¿…é¡»æ˜¯å›è½¦æ¢è¡Œã€‚ï¼‰</p><p>ä»¥ä¸Šå°±æ˜¯å…³äº multipart è¯·æ±‚çš„æ‰€æœ‰å†…å®¹ï¼Œå¹¶ä¸æ˜¯ç‰¹åˆ«å¤æ‚ã€‚äº‹å®ä¸Šï¼Œå½“åœ¨å†™ç¬¬ä¸€ä¸ªæœ‰å…³ multipart ç¼–ç çš„å®¢æˆ·ç«¯å®ç°æ—¶ï¼Œæˆ‘æœ‰äº›æŠµè§¦é˜…è¯» multipart/form-data çš„ <a href="https://tools.ietf.org/html/rfc7578" target="_blank" rel="noopener">RFC</a>ã€‚å¯æ˜¯åœ¨å¼€å§‹é˜…è¯»ä¹‹åï¼Œæˆ‘å¯¹è¿™ä¸ªåè®®çš„ç†è§£æ›´æ·±äº†ã€‚æ•´ä¸ªæ–‡æ¡£å¯è¯»æ€§å¾ˆå¼ºï¼Œå¾ˆè½»æ˜“å°±èƒ½ç›´è¾¾çŸ¥è¯†çš„æºå¤´ã€‚</p><p>æˆ‘åœ¨å¼€æºçš„ <a href="https://github.com/backchannel/BackchannelSDK-iOS" target="_blank" rel="noopener">Backchannel SDK</a> å®ç°äº†ä¸Šè¿°åŠŸèƒ½ã€‚<a href="https://github.com/backchannel/BackchannelSDK-iOS/blob/master/Source/Image%20Chooser/BAKUploadAttachmentRequest.m" target="_blank" rel="noopener"><code>BAKUploadAttachmentRequest</code></a> å’Œ <a href="https://github.com/backchannel/BackchannelSDK-iOS/blob/master/Source/Image%20Chooser/BAKMultipartRequestBuilder.m" target="_blank" rel="noopener"><code>BAKMultipartRequestBuilder</code></a> ç±»åŒ…å«äº†å¤„ç† mulitipart çš„æ–¹æ³•ã€‚åœ¨è¿™ä¸ªé¡¹ç›®ä¸­ï¼Œä»…ä»…åŒ…å«äº†å¤„ç†å•ä¸ªæ–‡ä»¶çš„æƒ…å†µï¼Œå¹¶ä¸”æ²¡æœ‰åŒ…æ‹¬å…ƒæ•°æ®ã€‚ä½†æ˜¯ä½œä¸ºèŒƒä¾‹ï¼Œä¾æ—§å¾ˆå¥½åœ°å±•ç¤ºäº† mulitipart è¯·æ±‚æ˜¯å¦‚ä½•æ„å»ºçš„ã€‚å¯ä»¥é€šè¿‡æ·»åŠ é¢å¤–çš„å®ç°ä»£ç ï¼Œæ¥æ”¯æŒå…ƒæ•°æ®å’Œå¤šæ–‡ä»¶çš„åŠŸèƒ½ã€‚</p><p>æ— è®ºæ˜¯ä½¿ç”¨ä¸€ä¸ªè¯·æ±‚ä¸Šä¼ å¤šä¸ªæ–‡ä»¶ï¼Œè¿˜æ˜¯å¤šä¸ªè¯·æ±‚åˆ†åˆ«å¯¹åº”ä¸Šä¼ ä¸€ä¸ªæ–‡ä»¶ï¼Œæ¥å®ç°å¤šæ–‡ä»¶ä¸Šä¼ åŠŸèƒ½ï¼Œéƒ½ä¼šç¢°åˆ°ä¸€ä¸ªé—®é¢˜ã€‚è¿™ä¸ªé—®é¢˜å°±æ˜¯ï¼Œå¦‚æœä½ å°è¯•ä¸€æ¬¡æ€§ä¸Šä¼ å¾ˆå¤šæ–‡ä»¶çš„è¯ï¼Œapp å°†ä¼šé—ªé€€ã€‚è¿™æ˜¯å› ä¸ºä½¿ç”¨ <a href="https://github.com/backchannel/BackchannelSDK-iOS/blob/master/Source/Image%20Chooser/BAKMultipartRequestBuilder.m#L66-L70" target="_blank" rel="noopener">è¯¥ç‰ˆæœ¬çš„ä»£ç </a>ï¼ŒåŠ è½½çš„æ•°æ®ä¼šç›´æ¥è¿›å…¥å†…å­˜ï¼Œåœ¨å†…å­˜æš´æ¶¨çš„æƒ…å†µä¸‹ï¼Œå³ä½¿ä½¿ç”¨å½“ä¸‹æ€§èƒ½æœ€å¼ºçš„æ——èˆ°æ‰‹æœºä¹Ÿä¼šæœ‰é—ªé€€å‘ç”Ÿã€‚</p><h2 id="å°†ç¡¬ç›˜ä¸­æ•°æ®ä»¥æµçš„å½¢å¼è¯»å–"><a href="#å°†ç¡¬ç›˜ä¸­æ•°æ®ä»¥æµçš„å½¢å¼è¯»å–" class="headerlink" title="å°†ç¡¬ç›˜ä¸­æ•°æ®ä»¥æµçš„å½¢å¼è¯»å–"></a>å°†ç¡¬ç›˜ä¸­æ•°æ®ä»¥æµçš„å½¢å¼è¯»å–</h2><p>æœ€å¸¸è§çš„è§£å†³æ–¹æ³•æ˜¯å°†ç¡¬ç›˜ä¸­çš„æ•°æ®ä»¥æµçš„å½¢å¼è¯»å–å‡ºæ¥ã€‚å…¶æ ¸å¿ƒæ€æƒ³æ˜¯æ–‡ä»¶çš„å­—èŠ‚æ•°æ®ä¼šä¸€ç›´ä¿å­˜åœ¨ç¡¬ç›˜é‡Œï¼Œç›´åˆ°è¢«è¯»å–å¹¶å‘å¾€ç½‘ç»œã€‚å†…å­˜ä¸­åªä¿ç•™äº†å¾ˆå°ä¸€éƒ¨åˆ†çš„é•œåƒæ•°æ®ã€‚</p><p>ç›®å‰ï¼Œæˆ‘æƒ³å‡ºä¸¤ç§æ–¹æ³•å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚ç¬¬ä¸€ä¸ªæ–¹æ³•ï¼ŒæŠŠ multipart è¯·æ±‚ä½“ä¸­çš„æ‰€æœ‰æ•°æ®å†™åˆ°ç¡¬ç›˜çš„ä¸€ä¸ªæ–°æ–‡ä»¶ä¸­ï¼Œå¹¶ä½¿ç”¨ URLSession çš„ <code>uploadTask(with request: URLRequest, fromFile fileURL: URL)</code> æ–¹æ³•å°†æ–‡ä»¶è½¬åŒ–ä¸ºæµã€‚è¿™ä¸ªæ–¹æ³•å¯ä»¥å¥æ•ˆï¼Œä½†æˆ‘å¹¶ä¸æƒ³ä¸ºæ¯ä¸€ä¸ªè¯·æ±‚æ–°å»ºä¸€ä¸ªæ–°æ–‡ä»¶ä¿å­˜åˆ°ç¡¬ç›˜ä¸­ã€‚å› ä¸ºè¿™æ„å‘³ç€åœ¨è¯·æ±‚å‘å‡ºåï¼Œè¿˜éœ€è¦åˆ é™¤è¿™ä¸ªæ–‡ä»¶ã€‚</p><p>ç¬¬äºŒç§æ–¹æ³•æ˜¯å°†å†…å­˜å’Œç¡¬ç›˜çš„æ•°æ®åˆå¹¶åœ¨ä¸€èµ·ï¼Œå¹¶é€šè¿‡ç»Ÿä¸€çš„æ¥å£å‘ç½‘ç»œè¾“å‡ºæ•°æ®ã€‚</p><p>å¦‚æœä½ è§‰å¾—ç¬¬äºŒç§æ–¹æ³•å¬èµ·æ¥åƒæ˜¯ <a href="http://khanlou.com/2015/10/clustering/" target="_blank" rel="noopener">ç±»ç°‡</a>ï¼Œæ­å–œä½ ï¼Œå®Œå…¨æ­£ç¡®ã€‚å¾ˆå¤šå¸¸ç”¨ Cocoa ç±»éƒ½å…è®¸åˆ›å»ºå­ç±»ï¼Œå¹¶å®ç°ä¸€äº›çˆ¶ç±»æ–¹æ³•ï¼Œä½¿å…¶å’Œçˆ¶ç±»è¡¨ç°ä¸€è‡´ã€‚å›æƒ³ä¸€ä¸‹ <code>NSArray</code> çš„ <code>-count</code> å±æ€§å’Œ <code>-objectAtIndex:</code> æ–¹æ³•ã€‚å› ä¸º <code>NSArray</code> çš„æ‰€æœ‰å…¶å®ƒæ–¹æ³•éƒ½æ˜¯åŸºäº <code>-count</code> å±æ€§å’Œ <code>-objectAtIndex:</code> æ–¹æ³•å®ç°çš„ï¼Œä½ å¯ä»¥éå¸¸è½»æ˜“åœ°åˆ›å»ºä¼˜åŒ–ç‰ˆæœ¬çš„ <code>NSArray</code> å­ç±»ã€‚</p><p>ä½ å¯ä»¥åˆ›å»ºä¸€ä¸ª <code>NSData</code> å­ç±»ï¼Œå®ƒæ— éœ€çœŸæ­£ä»ç¡¬ç›˜è¯»å–æ•°æ®ï¼Œè€Œåªæ˜¯åˆ›å»ºä¸€ä¸ªæŒ‡é’ˆç›´æ¥æŒ‡å‘ç¡¬ç›˜ä¸­çš„æ•°æ®ã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯æ˜¯ä¸éœ€è¦æŠŠæ•°æ®è½½å…¥å†…å­˜ä¸­è¿›è¡Œè¯»å–ã€‚è¿™ç§æ–¹æ³•ç§°ä¸ºå†…å­˜æ˜ å°„ï¼ŒåŸºäº Unix æ–¹æ³• <code>mmap</code>ã€‚ä½ å¯ä»¥é€šè¿‡ <code>.mappedIfSafe</code> æˆ–è€… <code>alwaysMapped</code> é€‰é¡¹ï¼Œæ¥ä½¿ç”¨ <code>NSData</code> çš„è¿™é¡¹ç‰¹æ€§ã€‚å› ä¸º <code>NSData</code> æ˜¯ä¸€ä¸ªç±»ç°‡ï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ª <code>ConcatenatedData</code> å­ç±»ï¼ˆå°±åƒ <code>FlattenCollection</code> åœ¨ Swift ä¸­çš„å·¥ä½œæ–¹å¼ï¼‰ï¼Œè¯¥å­ç±»ä¼šå°†å¤šä¸ª <code>NSData</code> å¯¹è±¡è§†ä½œä¸€ä¸ªè¿ç»­çš„ <code>NSData</code>ã€‚å®Œæˆåˆ›å»ºä»¥åï¼Œæˆ‘ä»¬å°±åšå¥½æ‰€æœ‰å‡†å¤‡æ¥è§£å†³è¿™ä¸ªé—®é¢˜å•¦ã€‚</p><p>é€šè¿‡æŸ¥çœ‹ <code>NSData</code> æ‰€æœ‰åŸç”Ÿæ–¹æ³•ï¼Œå¯ä»¥å‘ç°ï¼Œéœ€è¦å®ç°çš„æ˜¯ <code>-count</code> å’Œ <code>-bytes</code>ã€‚å®ç° <code>-count</code> å¹¶ä¸éš¾ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠæ‰€æœ‰ <code>NSData</code> å¯¹è±¡çš„å¤§å°ç›¸åŠ å¾—åˆ°ï¼›ä½†åœ¨å®ç° <code>-bytes</code> æ—¶åˆ™ä¼šæœ‰ä¸ªé—®é¢˜ã€‚ <code>-bytes</code> éœ€è¦è¿”å›ä¸€ä¸ªæŒ‡å‘ä¸€æ®µè¿ç»­ç¼“å†²åŒºçš„æŒ‡é’ˆï¼Œè€Œç›®å‰æˆ‘ä»¬å¹¶æ²¡æœ‰è¿™ä¸ªæŒ‡é’ˆã€‚</p><p>åœ¨åŸºç¡€åº“ä¸­ï¼Œæä¾›äº† <code>NSInputStream</code> ç±»ç”¨äºå¤„ç†ä¸è¿ç»­çš„æ•°æ®ã€‚éå¸¸å¹¸è¿ï¼Œ<code>NSInputStream</code> åŒæ ·æ˜¯ä¸€ä¸ªç±»ç°‡ã€‚æˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªå­ç±»ï¼Œå°†å¤šæ¡æµåˆå¹¶ã€‚åœ¨ä½¿ç”¨å­ç±»æ—¶ï¼Œæ„Ÿè§‰ä¸Šå°±åƒæ˜¯ä¸€æ¡æµã€‚é€šè¿‡ä½¿ç”¨ <code>+inputStreamWithData:</code> å’Œ <code>+inputStreamWithURL:</code> æ–¹æ³•ï¼Œå¯ä»¥è½»æ˜“åœ°åˆ›å»ºä¸€æ¡è¾“å…¥æµï¼Œç”¨æ¥ä»£è¡¨ç¡¬ç›˜ä¸­çš„æ–‡ä»¶å’Œå†…å­˜ä¸­çš„æ•°æ®ï¼ˆæ¯”å¦‚ boundariesï¼‰ã€‚</p><p>é€šè¿‡é˜…è¯»æœ€å¥½çš„ç¬¬ä¸‰æ–¹ç½‘ç»œåº“æºä»£ç ï¼Œä½ ä¼šå‘ç° <a href="https://github.com/AFNetworking/AFNetworking" target="_blank" rel="noopener">AFNetworking</a> é‡‡ç”¨äº†<a href="https://github.com/AFNetworking/AFNetworking/blob/009e3bb6673edc183c4f2baf552ad7cccba94d58/AFNetworking/AFURLRequestSerialization.m#L896-L927" target="_blank" rel="noopener">è¿™ç§æ–¹æ³•</a>ã€‚ï¼ˆ<a href="https://github.com/Alamofire/Alamofire" target="_blank" rel="noopener">Alamofire</a>ï¼ŒSwift ç‰ˆæœ¬çš„ AFNetworkingï¼Œåˆ™é‡‡ç”¨äº†ç¬¬ä¸€ç§æ–¹æ³•ï¼Œ<a href="https://github.com/Alamofire/Alamofire/blob/ff16ce9e87aeb0ee1f30b28789db1fff01e8fb02/Source/MultipartFormData.swift#L432-L455" target="_blank" rel="noopener">å°†æ•°æ®å…¨éƒ¨åŠ è½½åˆ°å†…å­˜ä¸­</a>ï¼Œä½†å¦‚æœæ•°æ®é‡å¤ªå¤§ï¼Œå°±ä¼šå†™åˆ°ç¡¬ç›˜çš„ä¸€ä¸ªæ–‡ä»¶ä¸­ã€‚ï¼‰</p><h2 id="å°†æ‰€æœ‰éƒ¨åˆ†æ‹¼æ¥èµ·æ¥"><a href="#å°†æ‰€æœ‰éƒ¨åˆ†æ‹¼æ¥èµ·æ¥" class="headerlink" title="å°†æ‰€æœ‰éƒ¨åˆ†æ‹¼æ¥èµ·æ¥"></a>å°†æ‰€æœ‰éƒ¨åˆ†æ‹¼æ¥èµ·æ¥</h2><p>ä½ å¯ä»¥åœ¨ <a href="https://gist.github.com/khanlou/8cc2e3cb23ec8d03b1fc187f5922e244" target="_blank" rel="noopener">è¿™é‡Œ</a> çœ‹çœ‹æˆ‘çš„ä¸²è¡Œè¾“å…¥æµçš„å®ç°ï¼ˆæ˜¯ç”¨ Objective-C å®ç°çš„ï¼Œä»¥åæˆ‘å¯èƒ½è¿˜ä¼šå†™ä¸€ä¸ª Swift ç‰ˆæœ¬çš„ï¼‰ã€‚</p><p>é€šè¿‡ <code>SKSerialInputStream</code> ç±»ï¼Œå¯ä»¥å°†æµç»„åˆåœ¨ä¸€èµ·ã€‚ä¸‹é¢å±•ç¤ºäº†å‰ç¼€å’Œåç¼€å±æ€§ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">MultipartComponent</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> prefixData: <span class="type">Data</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> string = <span class="string">"""</span></span><br><span class="line"><span class="string">        \(self.boundary)</span></span><br><span class="line"><span class="string">        Content-Disposition: form-data; name="\(self.name); filename="\(self.filename)"</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">return</span> string.data(using: .utf8)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> postfixData: <span class="type">Data</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"\r\n"</span>.data(using: .utf8)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å°†å…ƒæ•°æ®å’Œæ–‡ä»¶çš„ <code>dataStream</code> ç»„åˆåœ¨ä¸€èµ·ï¼Œå¾—åˆ°ä¸€æ¡è¾“å…¥æµï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">MultipartComponent</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> inputStream: <span class="type">NSInputStream</span> &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">let</span> streams = [</span><br><span class="line">            <span class="type">NSInputStream</span>(data: prefixData),</span><br><span class="line">            <span class="keyword">self</span>.fileDataStream,</span><br><span class="line">            <span class="type">NSInputStream</span>(data: postfixData),</span><br><span class="line">        ]</span><br><span class="line">    </span><br><span class="line">        <span class="keyword">return</span> <span class="type">SKSerialInputStream</span>(inputStreams: streams)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ›å»ºå¥½æ¯ä¸€éƒ¨åˆ†è¾“å…¥æµä¹‹åï¼Œå°±å¯ä»¥æŠŠæ‰€æœ‰æµç»„åˆåœ¨ä¸€èµ·ï¼Œå¾—åˆ°ä¸€æ¡å®Œæ•´è¾“å…¥æµã€‚æ­¤å¤–ï¼Œåœ¨è¯·æ±‚ç»“å°¾è¿˜éœ€è¦æ·»åŠ ä¸€ä¸ª boundaryï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">RequestBuilder</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> bodyInputStream: <span class="type">NSInputStream</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> stream = parts</span><br><span class="line">            .<span class="built_in">map</span>(&#123; $<span class="number">0</span>.inputStream &#125;)</span><br><span class="line">            + [<span class="type">NSInputStream</span>(data: <span class="string">"--\(self.boundary)--"</span>.data(using: .utf8))]</span><br><span class="line">    </span><br><span class="line">        <span class="keyword">return</span> <span class="type">SKSerialInputStream</span>(inputStreams: streams)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ€åï¼Œå°† <code>bodyInputStream</code> èµ‹å€¼ç»™ URL è¯·æ±‚çš„ <code>httpBodyStream</code> å±æ€§ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> urlRequest = <span class="type">URLRequest</span>(url: url)</span><br><span class="line"></span><br><span class="line">urlRequest.httpBodyStream = requestBuilder.bodyInputStream;</span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼Œ<code>httpBodyStream</code> å’Œ <code>httpBody</code> ä¸¤ä¸ªå±æ€§æ˜¯äº’æ–¥çš„â€”â€”ä¸¤ä¸ªå±æ€§ä¸ä¼šåŒæ—¶ç”Ÿæ•ˆã€‚è®¾ç½® <code>httpBodyStream</code> ä¼šä½¿å¾— <code>Data</code> ç‰ˆæœ¬ <code>httpBody</code> å¤±æ•ˆï¼Œåä¹‹äº¦ç„¶ã€‚</p><p>æµæ–‡ä»¶ä¸Šä¼ çš„å…³é”®æ˜¯èƒ½å¤Ÿå°†å¤šæ¡è¾“å…¥æµåˆå¹¶æˆä¸€æ¡æµã€‚<code>SKSerialInputStream</code> ç±»å®Œæˆäº†æ•´ä¸ªå·¥ä½œã€‚å°½ç®¡è¯´å­ç±»åŒ– <code>NSInputStream</code> æœ‰ä¸€äº›å›°éš¾ï¼Œå¯ä¸€æ—¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å°±ç¦»æˆåŠŸä¸è¿œå•¦ã€‚</p><h2 id="å­ç±»åŒ–è¿‡ç¨‹ä¸­éœ€è¦æ³¨æ„çš„é—®é¢˜"><a href="#å­ç±»åŒ–è¿‡ç¨‹ä¸­éœ€è¦æ³¨æ„çš„é—®é¢˜" class="headerlink" title="å­ç±»åŒ–è¿‡ç¨‹ä¸­éœ€è¦æ³¨æ„çš„é—®é¢˜"></a>å­ç±»åŒ–è¿‡ç¨‹ä¸­éœ€è¦æ³¨æ„çš„é—®é¢˜</h2><p>å­ç±»åŒ– <code>NSInputStream</code> çš„è¿‡ç¨‹ä¸ä¼šå¤ªè½»æ¾ï¼Œç”šè‡³å¯ä»¥è¯´å¾ˆå›°éš¾ã€‚ä½ å¿…é¡»å®ç° 9 ä¸ªæ–¹æ³•ã€‚å…¶ä¸­çš„ 7 ä¸ªæ–¹æ³•ï¼Œçˆ¶ç±»åªæœ‰ä¸€äº›å¾®ä¸è¶³é“çš„é»˜è®¤å®ç°ã€‚è€Œåœ¨æ–‡æ¡£ä¸­åªæåˆ°äº† 9 ä¸ªæ–¹æ³•ä¸­çš„ 3 ä¸ªï¼Œæ‰€ä»¥ä½ è¿˜å¾—å®ç° 6 ä¸ª <code>NSStream</code> ï¼ˆ<code>NSInputStream</code> çš„çˆ¶ç±»ï¼‰çš„æ–¹æ³•ï¼Œå…¶ä¸­æœ‰ 2 ä¸ªæ˜¯ run loop æ–¹æ³•ï¼Œå¹¶å…è®¸ç©ºå®ç°ã€‚åœ¨è¿™ä¹‹å‰ï¼Œä½ è¿˜éœ€è¦é¢å¤– <a href="http://blog.bjhomer.com/2011/04/subclassing-nsinputstream.html" target="_blank" rel="noopener">å®ç° 3 ä¸ªç§æœ‰æ–¹æ³•</a>ï¼Œä¸è¿‡ç°åœ¨ä¸å¿…å®ç°äº†ã€‚æ­¤å¤–ï¼Œè¿˜éœ€è¦å®šä¹‰ 3 ä¸ª<code>åªè¯»</code>å±æ€§ï¼š<code>streamStatus</code>ï¼Œ<code>streamError</code>ï¼Œ<code>delegate</code>ã€‚</p><p>åœ¨å¤„ç†å®Œä¸Šè¿°å­ç±»åŒ–ç›¸å…³çš„ç»†èŠ‚åï¼Œæ¥ä¸‹æ¥çš„æŒ‘æˆ˜æ˜¯åˆ›å»ºä¸€ä¸ª <code>NSInputStream</code> å­ç±»ï¼Œå…¶è¡Œä¸ºåº”è¯¥å’Œ API ä½¿ç”¨è€…æ‰€æœŸæœ›çš„ä¿æŒä¸€è‡´ã€‚ç„¶è€Œï¼Œè¿™ä¸ªç±»çŠ¶æ€çš„é‡åº¦è€¦åˆæ˜¯ä¸å®¹æ˜“è¢«äººå‘ç°çš„ã€‚</p><p>æœ‰ä¸€äº›çŠ¶æ€éœ€è¦ä¿è¯è¡Œä¸ºä¸€è‡´ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œ<code>hasBytesAvailable</code> æ˜¯ä¸åŒäºå…¶å®ƒçŠ¶æ€çš„ï¼Œä½†è¿˜æ˜¯å­˜åœ¨ç»†å¾®çš„è”ç³»ã€‚åœ¨æˆ‘æœ€è¿‘å‘ç°çš„ä¸€ä¸ª bug é‡Œï¼Œ<code>hasBytesAvailable</code> å±æ€§ä¼šè¿”å› <code>self.currentIndex != self.inputStreams.count</code>ï¼Œä½†æ˜¯è¿™ä¼šé€ æˆä¸€ä¸ª bugï¼Œæµä¼šä¸€ç›´å¤„äºå¼€å¯çš„çŠ¶æ€ï¼Œå¹¶æœ€ç»ˆé€ æˆè¯·æ±‚è¶…æ—¶ã€‚ä¿®å¤è¿™ä¸ª bug çš„åŠæ³•æ˜¯æ”¹ä¸ºè¿”å› <code>YES</code>ï¼Œä½†æˆ‘ä¸€ç›´æ²¡æœ‰æ‰¾åˆ°è¿™ä¸ª bug çš„æ ¹æºæ‰€åœ¨ã€‚</p><p>å¦å¤–ä¸€ä¸ªçŠ¶æ€ <code>streamStatus</code>ï¼Œå­˜åœ¨è®¸å¤šå¯èƒ½çš„å€¼ï¼Œå…¶ä¸­æ¯”è¾ƒé‡è¦çš„ä¸¤ä¸ªå€¼æ˜¯ <code>NSStreamStatusOpen</code> å’Œ <code>NSStreamStatusClosed</code>ã€‚</p><p>æœ€åä¸€ä¸ªæ¯”è¾ƒæœ‰æ„æ€çš„çŠ¶æ€æ˜¯å­—èŠ‚æ•°ï¼Œä» <code>read</code> æ–¹æ³•ä¸­è¿”å›å€¼ã€‚è¿™ä¸ªå±æ€§é™¤äº†ä¼šè¿”å›æ­£æ•´å‹æ•°ä¹‹å¤–ï¼Œè¿˜ä¼šè¿”å› -1ï¼Œ-1 ä»£è¡¨æœ‰é”™è¯¯äº§ç”Ÿï¼Œéœ€è¦è¿›ä¸€æ­¥æ£€æŸ¥éç©ºå±æ€§ <code>streamError</code> æ¥è·å–æ›´å¤šä¿¡æ¯ã€‚å­—èŠ‚æ•°è¿˜å¯ä»¥è¿”å› 0ï¼Œæ ¹æ®æ–‡æ¡£æè¿°ï¼Œè¿™æ˜¯æ ‡æ˜æµç»“å°¾çš„å¦å¤–ä¸€ç§æ–¹å¼ã€‚</p><p>æ–‡æ¡£å¹¶ä¸ä¼šå‘Šè¯‰ä½ å“ªäº›çŠ¶æ€çš„ç»„åˆæ˜¯æœ‰æ„ä¹‰çš„ã€‚æ¯”å¦‚è¯´æµäº§ç”Ÿä¸€ä¸ª <code>streamError</code>ï¼Œä½†çŠ¶æ€å´æ˜¯ <code>NSStreamStatusClosed</code>ï¼Œè€Œä¸æ˜¯ <code>NSStreamStatusError</code>ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹æ˜¯å¦ä¼šæœ‰é—®é¢˜ï¼Ÿæƒ³è¦ç®¡ç†å¥½æ‰€æœ‰çš„çŠ¶æ€éå¸¸éš¾ï¼Œä¸è¿‡åˆ°æœ€åç»ˆç©¶è¿˜æ˜¯èƒ½è§£å†³çš„ã€‚</p><p>å¯¹äº <code>SKSerialStream</code> ç±»ï¼Œæ˜¯å¦å¯ä»¥åœ¨æ‰€æœ‰æƒ…å†µä¸‹éƒ½èƒ½æ­£å¸¸å·¥ä½œï¼Œæˆ‘è¿˜ä¸æ˜¯ç‰¹åˆ«æœ‰ä¿¡å¿ƒã€‚ä½†çœ‹èµ·æ¥ï¼Œ<code>SKSerialStream</code> é€šè¿‡ä½¿ç”¨ URLSession èƒ½å¾ˆå¥½åœ°æ”¯æŒä¸Šä¼  multipart æ•°æ®ã€‚å¦‚æœä½ åœ¨ä½¿ç”¨è¿™ä»½ä»£ç çš„æ—¶å€™å‘ç°ä»»ä½•é—®é¢˜ï¼Œè¯·åŠ¡å¿…è”ç³»æˆ‘ï¼Œæˆ‘ä»¬å¯ä»¥ä¸€èµ·ä¸æ–­ä¼˜åŒ–è¿™ä¸ªç±»ã€‚</p><blockquote><p>æœ¬æ–‡ç”± SwiftGG ç¿»è¯‘ç»„ç¿»è¯‘ï¼Œå·²ç»è·å¾—ä½œè€…ç¿»è¯‘æˆæƒï¼Œæœ€æ–°æ–‡ç« è¯·è®¿é—® <a href="http://swift.gg">http://swift.gg</a>ã€‚</p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;ä½œè€…ï¼šSoroush Khanlouï¼Œ&lt;a href=&quot;http://khanlou.com/2018/11/streaming-multipart-requests/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;åŸæ–‡é“¾æ¥&lt;/a&gt;ï¼ŒåŸæ–‡æ—¥æœŸï¼š2018-11-14&lt;br&gt;è¯‘è€…ï¼š&lt;a href=&quot;https://www.jianshu.com/u/076cc5e18bb8&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;éƒ‘ä¸€ä¸€&lt;/a&gt;ï¼›æ ¡å¯¹ï¼š&lt;a href=&quot;http://numbbbbb.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;numbbbbb&lt;/a&gt;ï¼Œ&lt;a href=&quot;http://www.jianshu.com/users/596f2ba91ce9/latest_articles&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;pmst&lt;/a&gt;ï¼›å®šç¨¿ï¼š&lt;a href=&quot;http://forelax.space&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Forelax&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;!--æ­¤å¤„å¼€å§‹æ­£æ–‡--&gt;
&lt;p&gt;Foundation æ¡†æ¶ä¸­çš„ URL ç±»æä¾›äº†éå¸¸å…¨é¢çš„åŠŸèƒ½ï¼Œæ­¤åè¿˜åœ¨ iOS 7 ä¸­æ–°å¢äº† URLSession ç±»ã€‚å°½ç®¡å¦‚æ­¤ï¼ŒåŸºç¡€åº“ä¸­ä»ç„¶ç¼ºå°‘ multipart æ–‡ä»¶ä¸Šä¼ çš„åŠŸèƒ½ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="Khanlou" scheme="https://swift.gg/categories/Khanlou/"/>
    
    
      <category term="iOS å¼€å‘" scheme="https://swift.gg/tags/iOS-%E5%BC%80%E5%8F%91/"/>
    
      <category term="Swift" scheme="https://swift.gg/tags/Swift/"/>
    
      <category term="Objective-C" scheme="https://swift.gg/tags/Objective-C/"/>
    
  </entry>
  
  <entry>
    <title>Language Server Protocol</title>
    <link href="https://swift.gg/2019/01/15/nshipster-language-server-protocol/"/>
    <id>https://swift.gg/2019/01/15/nshipster-language-server-protocol/</id>
    <published>2019-01-15T00:00:00.000Z</published>
    <updated>2019-08-14T12:15:53.980Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ä½œè€…ï¼šMatttï¼Œ<a href="https://nshipster.com/language-server-protocol/" target="_blank" rel="noopener">åŸæ–‡é“¾æ¥</a>ï¼ŒåŸæ–‡æ—¥æœŸï¼š2018-11-19<br>è¯‘è€…ï¼š<a href="https://github.com/mobilefellow" target="_blank" rel="noopener">é›¨è°¨</a>ï¼›æ ¡å¯¹ï¼š<a href="http://numbbbbb.com/" target="_blank" rel="noopener">numbbbbb</a>ï¼Œ<a href="http://www.jianshu.com/users/596f2ba91ce9/latest_articles" target="_blank" rel="noopener">pmst</a>ï¼›å®šç¨¿ï¼š<a href="http://forelax.space" target="_blank" rel="noopener">Forelax</a></p></blockquote><!--æ­¤å¤„å¼€å§‹æ­£æ–‡--><p>ä¸Šä¸ªæœˆï¼Œè‹¹æœå…¬å¸ <a href="https://forums.swift.org/t/new-lsp-language-service-supporting-swift-and-c-family-languages-for-any-editor-and-platform/17024" target="_blank" rel="noopener">åœ¨ Swift.org è®ºå›ä¸Šå®£å¸ƒ</a>ï¼Œæ­£åœ¨ç€æ‰‹ä¸º Swift å’Œ C è¯­è¨€æ”¯æŒ <a href="https://microsoft.github.io/language-server-protocol/" target="_blank" rel="noopener">Language Server Protocol</a>ï¼ˆè¯­è¨€æœåŠ¡å™¨åè®®ï¼ŒLSPï¼‰ã€‚</p><blockquote><p>å¯¹äºè‹¹æœå…¬å¸è€Œè¨€ï¼Œä¸ºæ‰€æœ‰ Swift å¼€å‘è€… â€”â€” åŒ…æ‹¬éè‹¹æœå¹³å°ä¸Šçš„ â€”â€” æä¾›é«˜è´¨é‡çš„å·¥å…·æ”¯æŒéå¸¸é‡è¦ã€‚æˆ‘ä»¬å¸Œæœ›ä¸å¼€æºç¤¾åŒºåˆä½œï¼Œå°†ç²¾åŠ›é›†ä¸­åœ¨æ„å»º Xcode å’Œå…¶ä»–ç¼–è¾‘å™¨ã€å…¶ä»–å¹³å°å¯ä»¥å…±äº«çš„å…¬å…±åŸºç¡€è®¾æ–½ä¸Šã€‚ä¸ºå®ç°è¿™ä¸€ç›®æ ‡ï¼Œ[â€¦â€¦]ï¼Œæˆ‘ä»¬å†³å®šæ”¯æŒ LSPã€‚</p><p><em>Argyrios Kyrtzidisï¼Œ2018 å¹´ 10 æœˆ 15 æ—¥</em></p></blockquote><p><strong>è¿™å¯èƒ½æ˜¯è‹¹æœè‡ª 2014 å¹´å°† Swift ä½œä¸ºå¼€æºè½¯ä»¶å‘å¸ƒä»¥æ¥ï¼Œä¸º Swift åšå‡ºçš„æœ€é‡è¦çš„å†³å®šã€‚</strong> è¿™å¯¹äº APP å¼€å‘è€…æ¥è¯´æ˜¯ä¸€ä»¶å¤§äº‹ï¼Œå¯¹äºå…¶ä»–å¹³å°ä¸Šçš„ Swift å¼€å‘è€…æ¥è¯´æ›´æ˜¯ä¸€ä»¶å¤§äº‹ã€‚</p><p>ä¸ºäº†ç†è§£å…¶ä¸­çš„åŸå› ï¼Œæœ¬å‘¨çš„æ–‡ç« å°†ç ”ç©¶ Language Server Protocol è§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Œå®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Œä»¥åŠå®ƒçš„é•¿æœŸå½±å“å¯èƒ½æ˜¯ä»€ä¹ˆã€‚</p><a id="more"></a><blockquote><p><strong>æ›´æ–°</strong>ï¼šsourcekit-lsp é¡¹ç›®ç°åœ¨å·²ç»å¯ä»¥ <a href="https://github.com/apple/sourcekit-lsp" target="_blank" rel="noopener">åœ¨ GitHub ä¸Šè®¿é—®</a> äº†ã€‚</p></blockquote><hr><p>æƒ³è±¡è¿™æ ·ä¸€ä¸ªçŸ©é˜µï¼Œæ¯ä¸€è¡Œè¡¨ç¤ºä¸åŒçš„ç¼–ç¨‹è¯­è¨€ï¼ˆSwiftã€JavaScriptã€Rubyã€Python ç­‰ï¼‰ï¼Œæ¯ä¸€åˆ—è¡¨ç¤ºä¸åŒçš„ä»£ç ç¼–è¾‘å™¨ï¼ˆXcodeã€Visual Studioã€Vimã€Atom ç­‰ï¼‰ï¼Œè¿™æ ·æ¯ä¸ªå•å…ƒæ ¼è¡¨ç¤ºç‰¹å®šç¼–è¾‘å™¨å¯¹ä¸€ç§è¯­è¨€çš„æ”¯æŒçº§åˆ«ã€‚</p><p><img src="https://nshipster.com/assets/lsp-languages-times-editors-b9a398af0dea85f2ad6dcf5412fbcb451a43bc90091d5e3ab3b1140da9926b3e.svg" alt="lsp-languages-times-editors.svg"></p><p>ç„¶åï¼Œä½ å°±å‘ç°å„ç§ç»„åˆå½¢æˆäº†ä¸€ç§æ”¯ç¦»ç ´ç¢çš„å…¼å®¹ã€‚æœ‰äº›ç¼–è¾‘å™¨å’Œéƒ¨åˆ†è¯­è¨€æ·±åº¦é›†æˆï¼Œä½†é™¤æ­¤ä¹‹å¤–å‡ ä¹ä»€ä¹ˆéƒ½å¹²ä¸äº†ï¼›å…¶ä»–ç¼–è¾‘å™¨åˆ™æ¯”è¾ƒé€šç”¨ï¼Œå¯¹å¾ˆå¤šè¯­è¨€éƒ½æä¾›äº†åŸºæœ¬çš„æ”¯æŒã€‚ï¼ˆIDE è¿™ä¸ªæœ¯è¯­é€šå¸¸ç”¨æ¥æè¿°å‰è€…ã€‚)</p><p>ä¸¾ä¸ªå¥‡è‘©çš„ä¾‹å­ï¼š<em>ä½ ä¸ç”¨ Xcode æ¥å¼€å‘ APPï¼Œå´åç”¨æ¥å¹²å…¶ä»–äº‹æƒ…ã€‚</em></p><p>ä¸ºäº†æ›´å¥½åœ°æ”¯æŒæŸä¸€ç‰¹å®šçš„è¯­è¨€ï¼Œç¼–è¾‘å™¨å¿…é¡»ç¼–å†™ä¸€äº›é›†æˆä»£ç ï¼ˆintegration codeï¼‰â€”â€” è¦ä¹ˆç›´æ¥å†™åœ¨é¡¹ç›®é‡Œï¼Œè¦ä¹ˆé€šè¿‡æ’ä»¶ã€‚ç”±äºä¸åŒè¯­è¨€å’Œç¼–è¾‘å™¨çš„å®ç°æœºåˆ¶ä¸ä¸€æ ·ï¼Œå› æ­¤æ¯”æ–¹è¯´ Vim æ”¹è¿›äº†å¯¹ Ruby æ”¯æŒï¼Œä½†è¿™å¹¶ä¸èƒ½è®©å®ƒæ›´å¥½åœ°æ”¯æŒ Pythonï¼Œä¹Ÿä¸èƒ½è®© Ruby åœ¨ Atom ä¸Šè¿è¡Œåœ°æ›´å¥½ã€‚æœ€ç»ˆçš„ç»“æœæ˜¯ï¼šå¤§é‡ç²¾åŠ›æµªè´¹åœ¨äº†ä¸åŒæŠ€æœ¯çš„å…¼å®¹ä¸Šã€‚</p><p>æˆ‘ä»¬ä¸Šé¢æè¿°çš„æƒ…å†µé€šå¸¸è¢«ç§°ä¸º <em>M Ã— N é—®é¢˜</em>ï¼Œå³æœ€ç»ˆçš„é›†æˆæ–¹æ¡ˆæ•°é‡ä¸ºç¼–è¯‘å™¨æ•°é‡ M ä¸è¯­è¨€æ•°é‡ N çš„ä¹˜ç§¯ã€‚Language Server Protocol æ‰€åšçš„äº‹æƒ…å°±æ˜¯å°† M Ã— N é—®é¢˜å˜æˆ <em>M + N é—®é¢˜</em>ã€‚</p><p>ç¼–è¾‘å™¨ä¸å¿…å®ç°å¯¹æ¯ç§è¯­è¨€çš„æ”¯æŒï¼Œåªéœ€æ”¯æŒ LSP å³å¯ã€‚ä¹‹åï¼Œå®ƒå°±èƒ½åŒç­‰ç¨‹åº¦åœ°æ”¯æŒæ‰€æœ‰æ”¯æŒ LSP çš„è¯­è¨€ã€‚</p><p><img src="https://nshipster.com/assets/lsp-languages-plus-editors-904f780fa4a21e89b5b00bfe5fca39795dd54c1c4c67acf3f0fe095aaf09064d.svg" alt="lsp-languages-plus-editors.svg"></p><blockquote><p>Tomohiro Matsuyama åœ¨ 2010 å¹´å†™çš„ <a href="https://tkf.github.io/2013/06/04/Emacs-is-dead.html" target="_blank" rel="noopener">â€œEmacs ã¯æ­»ã‚“ã â€ (<em>â€œEmacs å·²æ­»â€</em>)</a> è¿™ç¯‡æ–‡ç« å°±å¯¹è¿™ç§é—®é¢˜åšå‡ºäº†ä¸€ä¸ªå¾ˆå¥½çš„è®ºè¿°ã€‚Matsuyama æè¿°äº† Emacs è„šæœ¬è¯­è¨€çš„å±€é™æ€§ï¼ˆä¸æ”¯æŒå¤šçº¿ç¨‹ã€åº•å±‚ API è¿‡å°‘ã€ç”¨æˆ·åŸºæ•°å¤ªå°ï¼‰ï¼Œä»–è®¤ä¸ºç¼–å†™æ’ä»¶çš„é¦–é€‰æ–¹æ³•åº”è¯¥æ˜¯ä¸å¤–éƒ¨ç¨‹åºè¿›è¡Œäº¤äº’ï¼Œè€Œä¸æ˜¯åŸç”Ÿå®ç°ã€‚</p></blockquote><p>Language Server Protocol ä¸ºæ”¯æŒçš„è¯­è¨€æä¾›äº†ä¸€å¥—é€šç”¨çš„åŠŸèƒ½é›†ï¼ŒåŒ…æ‹¬ï¼š</p><ul><li>è¯­æ³•é«˜äº®ï¼ˆSyntax Highlightingï¼‰</li><li>è‡ªåŠ¨æ ¼å¼åŒ–ï¼ˆAutomatic Formattingï¼‰</li><li>è‡ªåŠ¨è¡¥å…¨ï¼ˆAutocompleteï¼‰</li><li>è¯­æ³•ï¼ˆSyntaxï¼‰</li><li>å·¥å…·æç¤ºï¼ˆTooltipsï¼‰</li><li>å†…è”è¯Šæ–­ï¼ˆInline Diagnosticsï¼‰</li><li>è·³è½¬åˆ°å®šä¹‰ï¼ˆJump to Definitionï¼‰</li><li>é¡¹ç›®å†…æŸ¥æ‰¾å¼•ç”¨ï¼ˆFind References in Projectï¼‰</li><li>é«˜çº§æ–‡æœ¬å’Œç¬¦å·æœç´¢ï¼ˆAdvanced Text and Symbol Searchï¼‰</li></ul><p>å„ç§å·¥å…·å’Œç¼–è¾‘å™¨å¯ä»¥å°†ç²¾åŠ›ç”¨äºæå‡å¯ç”¨æ€§å’Œæä¾›æ›´é«˜çº§çš„åŠŸèƒ½ï¼Œè€Œä¸æ˜¯ä¸ºæ¯ç§æ–°æŠ€æœ¯å†é€ ä¸ªè½®å­ã€‚</p><h2 id="Language-Server-Protocol-çš„å·¥ä½œåŸç†"><a href="#Language-Server-Protocol-çš„å·¥ä½œåŸç†" class="headerlink" title="Language Server Protocol çš„å·¥ä½œåŸç†"></a>Language Server Protocol çš„å·¥ä½œåŸç†</h2><p>å¦‚æœä½ æ˜¯ä¸€ä¸ª iOS ç¨‹åºå‘˜ï¼Œé‚£ä¹ˆä¸€å®šå¾ˆç†Ÿæ‚‰ <em>server</em> å’Œ <em>protocol</em> è¿™ä¸¤ä¸ªæœ¯è¯­åœ¨ Web åº”ç”¨ç¨‹åºçš„ HTTP + JSON é€šä¿¡åœºæ™¯ä¸‹çš„å«ä¹‰ã€‚å®é™…ä¸Š Language Server Protocol å·®ä¸å¤šä¹Ÿæ˜¯è¿™ä¹ˆå·¥ä½œçš„ã€‚</p><p>å¯¹äº LSPï¼Œ<em>client</em> æ˜¯æŒ‡ç¼–è¾‘å™¨ â€”â€” æˆ–è€…æ›´å®½æ³›ä¸€ç‚¹ï¼Œæ˜¯æŒ‡å·¥å…·ï¼Œ<em>server</em> æ˜¯æŒ‡æœ¬åœ°ç‹¬ç«‹è¿›ç¨‹é‡Œè¿è¡Œçš„ä¸€ä¸ªå¤–éƒ¨ç¨‹åºã€‚</p><p>è‡³äºåå­—ä¸­åŒ…å« <em>protocol</em>ï¼Œæ˜¯å› ä¸º LSP ç±»ä¼¼äºä¸€ä¸ªç²¾ç®€ç‰ˆçš„ HTTPï¼š</p><ul><li>æ¯ä¸ªæ¶ˆæ¯éƒ½ç”±æŠ¥å¤´éƒ¨åˆ†å’Œå†…å®¹éƒ¨åˆ†ç»„æˆã€‚</li><li>æŠ¥å¤´éƒ¨åˆ†åŒ…å«ä¸€ä¸ªå¿…å¡«çš„ <code>Content-Length</code> å­—æ®µï¼Œç”¨äºè¯´æ˜å†…å®¹éƒ¨åˆ†çš„å¤§å°ï¼ˆä»¥å­—èŠ‚ä¸ºå•ä½ï¼‰ï¼Œä»¥åŠä¸€ä¸ªå¯é€‰çš„ <code>Content-Type</code> å­—æ®µï¼ˆé»˜è®¤å€¼ä¸º <code>application/vscode-jsonrpc; charset=utf-8</code>ï¼‰ã€‚</li><li>å†…å®¹éƒ¨åˆ†ä½¿ç”¨ <a href="https://www.jsonrpc.org/specification" target="_blank" rel="noopener">JSON-RPC</a> æè¿°è¯·æ±‚ã€å“åº”å’Œé€šçŸ¥çš„ç»“æ„ã€‚</li></ul><p>æ¯å½“å·¥å…·ä¸­å‘ç”Ÿäº†ä»€ä¹ˆäº‹æƒ…ï¼Œæ¯”å¦‚ç”¨æˆ·éœ€è¦è·³è½¬åˆ°ç¬¦å·çš„å®šä¹‰ï¼Œå·¥å…·å°±ä¼šå‘ server å‘é€ä¸€ä¸ªè¯·æ±‚ã€‚server æ¥æ”¶åˆ°è¯¥è¯·æ±‚ï¼Œç„¶åè¿”å›é€‚å½“çš„å“åº”ã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Parent</span> </span>&#123;&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Child</span>: <span class="title">Parent</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure><p><img src="https://nshipster.com/assets/lsp-jump-to-definition-f76ae15d897ab30706c101e7300cd299ad97f6b910ed79ce4890351c2805ae56.gif" alt="lsp-jump-to-definition.gif"></p><p>ä»¥ä¸‹æ˜¯ LSP å¦‚ä½•åœ¨å¹•åå®ç°è¿™ç§äº¤äº’ï¼š</p><p>é¦–å…ˆï¼Œå½“ç”¨æˆ·æ‰“å¼€ Swift ä»£ç æ—¶ï¼Œè‹¥ Swift language server å¹¶æœªè¿è¡Œï¼Œç¼–è¾‘å™¨å°†åœ¨ä¸€ä¸ªç‹¬ç«‹è¿›ç¨‹ä¸­å¯åŠ¨å®ƒï¼Œå¹¶æ‰§è¡Œä¸€äº›é¢å¤–çš„é…ç½®ã€‚</p><p>å½“ç”¨æˆ·æ‰§è¡Œ â€œè·³è½¬åˆ°å®šä¹‰ï¼ˆjump to definitionï¼‰â€ æŒ‡ä»¤æ—¶ï¼Œç¼–è¾‘å™¨å‘ Swift language server å‘é€ä»¥ä¸‹è¯·æ±‚ï¼š</p><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"jsonrpc"</span>: <span class="string">"2.0"</span>,</span><br><span class="line">  <span class="attr">"id"</span>: <span class="number">1</span>,</span><br><span class="line">  <span class="attr">"method"</span>: <span class="string">"textDocument/definition"</span>,</span><br><span class="line">  <span class="attr">"params"</span>: &#123;</span><br><span class="line">    <span class="attr">"textDocument"</span>: &#123;</span><br><span class="line">      <span class="attr">"uri"</span>: <span class="string">"file:///Users/NSHipster/Example.swift"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"position"</span>: &#123;</span><br><span class="line">      <span class="attr">"line"</span>: <span class="number">1</span>,</span><br><span class="line">      <span class="attr">"character"</span>: <span class="number">13</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ”¶åˆ°è¿™ä¸ªè¯·æ±‚åï¼ŒSwift language server ä½¿ç”¨ <a href="https://github.com/apple/swift/tree/master/tools/SourceKit" target="_blank" rel="noopener">SourceKit</a> ç­‰ç¼–è¯‘å™¨å·¥å…·æ¥æ ‡è¯†ç›¸åº”çš„ä»£ç å®ä½“ï¼Œå¹¶åœ¨ä»£ç çš„ä¸Šä¸€è¡Œæ‰¾åˆ°å…¶å£°æ˜çš„ä½ç½®ã€‚ç„¶å language server ç”¨ä»¥ä¸‹æ¶ˆæ¯è¿›è¡Œå“åº”:</p><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"jsonrpc"</span>: <span class="string">"2.0"</span>,</span><br><span class="line">  <span class="attr">"id"</span>: <span class="number">1</span>,</span><br><span class="line">  <span class="attr">"result"</span>: &#123;</span><br><span class="line">    <span class="attr">"uri"</span>: <span class="string">"file:///Users/NSHipster/Example.swift"</span>,</span><br><span class="line">    <span class="attr">"range"</span>: &#123;</span><br><span class="line">      <span class="attr">"start"</span>: &#123;</span><br><span class="line">        <span class="attr">"line"</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">"character"</span>: <span class="number">6</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">"end"</span>: &#123;</span><br><span class="line">        <span class="attr">"line"</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">"character"</span>: <span class="number">12</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ€åï¼Œç¼–è¾‘å™¨å¯¼èˆªåˆ°æ–‡ä»¶(åœ¨æœ¬ä¾‹ä¸­ï¼Œè¯¥æ–‡ä»¶å·²ç»æ‰“å¼€)ï¼Œå°†å…‰æ ‡ç§»åŠ¨åˆ°è¯¥èŒƒå›´ï¼Œå¹¶é«˜äº®æ˜¾ç¤ºå‡ºæ¥ã€‚</p><p>è¿™ç§æ–¹æ³•çš„ç¾å¦™ä¹‹å¤„åœ¨äºï¼Œç¼–è¾‘å™¨å®Œæˆæ‰€æœ‰è¿™äº›æ“ä½œæ—¶ï¼Œé™¤äº† .swift æ–‡ä»¶ä¸ Swift ä»£ç ç›¸å…³ä»¥å¤–ï¼Œå¯¹ Swift ç¼–ç¨‹è¯­è¨€ä¸€æ— æ‰€çŸ¥ã€‚ç¼–è¾‘å™¨éœ€è¦åšçš„å°±æ˜¯ä¸ language server å¯¹è¯å¹¶æ›´æ–° UIã€‚è€Œä¸”ç¼–è¾‘å™¨çŸ¥é“å¦‚ä½•åšåˆ°è¿™ä¸€ç‚¹åï¼Œå°±å¯ä»¥éµå¾ªç›¸åŒçš„è¿‡ç¨‹ï¼Œä¸ä»»ä½•å¸¦æœ‰ language server çš„è¯­è¨€æ‰€ç¼–å†™çš„ä»£ç è¿›è¡Œäº¤äº’ã€‚</p><h2 id="Clang-LLVM-é‡Œçš„-Language-Server-Protocol"><a href="#Clang-LLVM-é‡Œçš„-Language-Server-Protocol" class="headerlink" title="Clang / LLVM é‡Œçš„ Language Server Protocol"></a>Clang / LLVM é‡Œçš„ Language Server Protocol</h2><p>å¦‚æœä½ è§‰å¾—ä¹‹å‰çš„ <em>M + N</em> å›¾æœ‰ç‚¹çœ¼ç†Ÿï¼Œé‚£å¯èƒ½æ˜¯å› ä¸º LLVM ä¹Ÿé‡‡ç”¨äº†åŒæ ·çš„æ–¹æ³•ã€‚</p><p>LLVM çš„æ ¸å¿ƒæ˜¯ä¸­é—´è¡¨ç¤ºï¼ˆintermediate representationï¼ŒIRï¼‰ã€‚LLVM æ‰€æ”¯æŒçš„è¯­è¨€ä½¿ç”¨ <em>ç¼–è¯‘å™¨å‰ç«¯ï¼ˆcompiler frontendï¼‰</em> ç”Ÿæˆ IRï¼Œå†ä½¿ç”¨ <em>ç¼–è¯‘å™¨åç«¯ï¼ˆcompiler backendï¼‰</em> å°† IR ç”Ÿæˆæ‰€æ”¯æŒå¹³å°çš„æœºå™¨ç ã€‚</p><p><img src="https://nshipster.com/assets/lsp-llvm-ir-34a10847cbe6519370c1b5e92def8f82b2ebde71aa2440c88880283bd5cbaf0a.svg" alt="lsp-llvm-ir.svg"></p><blockquote><p>å¦‚æœä½ æƒ³äº†è§£ Swift ä»£ç ç¼–è¯‘çš„æ›´å¤šç»†èŠ‚ï¼Œè¯·æŸ¥çœ‹ <a href="https://nshipster.com/swiftsyntax/" target="_blank" rel="noopener">æˆ‘ä»¬å…³äº SwiftSyntax çš„æ–‡ç« </a>ã€‚</p></blockquote><p><a href="https://clang.llvm.org" target="_blank" rel="noopener">Clang</a> æ˜¯ C è¯­è¨€çš„ LLVM ç¼–è¯‘å™¨å‰ç«¯ã€‚Swift ä¸ Objective-C çš„äº’æ“ä½œæ€§ï¼ˆinter-operabilityï¼‰å°±æ˜¯é å®ƒå®ç°çš„ã€‚åœ¨æœ€è¿‘çš„ 5.0.0 ç‰ˆæœ¬ä¸­ï¼ŒClang æ·»åŠ äº†ä¸€ä¸ªåä¸º <a href="https://clang.llvm.org/extra/clangd.html" target="_blank" rel="noopener">Clangd</a> çš„æ–°å·¥å…·ï¼Œå®ƒæ˜¯ LLVM å¯¹ Language Server Protocol çš„å®ç°ã€‚</p><p>2018 å¹´ 4 æœˆï¼Œ<a href="http://lists.llvm.org/pipermail/cfe-dev/2018-April/057668.html" target="_blank" rel="noopener">è‹¹æœå…¬å¸å‘ LLVM é‚®ä»¶ç»„å®£å¸ƒ</a>ï¼Œå°†æŠŠå¼€å‘çš„é‡å¿ƒä» <a href="https://clang.llvm.org/doxygen/group__CINDEX.html" target="_blank" rel="noopener">libclang</a> è½¬å‘ Clangdï¼Œä»¥å…¶ä½œä¸ºåˆ›å»ºäº¤äº’å·¥å…·çš„ä¸»è¦æ–¹å¼ã€‚</p><p>ç°åœ¨ä½ å¯èƒ½ä¼šæƒ³ï¼Œ<em>â€œé‚£åˆæ€æ ·ï¼Ÿâ€</em> è‹¹æœå…¬å¸æ˜¯ LLVM é¡¹ç›®æœ€é‡è¦çš„æ”¯æŒè€…ä¹‹ä¸€ï¼Œè¯¥é¡¹ç›®åˆ›å§‹äºº Chris Lattner å·²ç»åœ¨è‹¹æœå…¬å¸å·¥ä½œäº†åå¤šå¹´ã€‚è‹¹æœå…¬å¸å†³å®šä»ä¸é€æ˜çš„ Clang å·¥å…·åˆ‡æ¢åˆ°å¦ä¸€ä¸ªï¼Œä¼¼ä¹æ˜¯ä¸€ä¸ªå®ç°ç»†èŠ‚äº†(å¯ä»¥è¿™ä¹ˆè¯´)ã€‚</p><p>è¿™ä¸ªå®˜å®£å¾ˆæœ‰è¶£çš„ä¸€ç‚¹æ˜¯ï¼ŒClangd ä¼¼ä¹å®Œå…¨æ˜¯åœ¨è‹¹æœä»¥å¤–å¼€å‘çš„ï¼Œè°·æ­Œå’Œå…¶ä»–å…¬å¸ä¹Ÿåšå‡ºäº†é‡å¤§è´¡çŒ®ã€‚è¿™ä¸ªå®˜å®£æ ‡å¿—ç€æœªæ¥å·¥å…·å¼€å‘æ–¹å‘çš„é‡å¤§è½¬å˜ â€”â€” å…­ä¸ªæœˆå Swift.org è®ºå›å°†è¯å®è¿™ä¸€ç‚¹ã€‚</p><h2 id="è‹¹æœæ”¯æŒ-Language-Server-Protocol-çš„æ½œåœ¨å½±å“"><a href="#è‹¹æœæ”¯æŒ-Language-Server-Protocol-çš„æ½œåœ¨å½±å“" class="headerlink" title="è‹¹æœæ”¯æŒ Language Server Protocol çš„æ½œåœ¨å½±å“"></a>è‹¹æœæ”¯æŒ Language Server Protocol çš„æ½œåœ¨å½±å“</h2><p>æ ¹æ®è‹¹æœå…¬å¸ 10 æœˆä»½å‘å¸ƒçš„ LSP å…¬å‘Šï¼Œæˆ‘ä»¬é¢„è®¡åœ¨æœªæ¥å‡ å‘¨å†…ï¼ˆæ’°å†™æœ¬æ–‡æ—¶ï¼Œæœ€æ—© 11 æœˆä¸­æ—¬ï¼‰å°†çœ‹åˆ°è¯¥é¡¹ç›®çš„é¦–æ‰¹ä»£ç ã€‚</p><p>è¦æ„Ÿå—è¿™äº›å‘å±•çš„å…¨éƒ¨å½±å“è¿˜éœ€è¦ä¸€äº›æ—¶é—´ï¼Œä½†è¯·ç›¸ä¿¡æˆ‘ï¼šä½ çš„è€å¿ƒæ˜¯å€¼å¾—çš„ã€‚æˆ‘ç›¸ä¿¡ä»¥ä¸‹æ˜¯ LSP åœ¨æœªæ¥å‡ ä¸ªæœˆå’Œå‡ å¹´å°†ä¼šå‘ç”Ÿçš„ä¸€äº›äº‹æƒ…ã€‚</p><h3 id="Swift-å˜æˆä¸€ç§æ›´åŠ é€šç”¨çš„ç¼–ç¨‹è¯­è¨€"><a href="#Swift-å˜æˆä¸€ç§æ›´åŠ é€šç”¨çš„ç¼–ç¨‹è¯­è¨€" class="headerlink" title="Swift å˜æˆä¸€ç§æ›´åŠ é€šç”¨çš„ç¼–ç¨‹è¯­è¨€"></a>Swift å˜æˆä¸€ç§æ›´åŠ é€šç”¨çš„ç¼–ç¨‹è¯­è¨€</h3><p>è™½ç„¶ Swift ä¸»è¦ç”¨äº APP å¼€å‘ï¼Œä½†å®ƒä»ä¸€å¼€å§‹å°±è¢«è®¾è®¡æˆä¸€ç§åŠŸèƒ½å¼ºå¤§çš„é€šç”¨ç¼–ç¨‹è¯­è¨€ã€‚åœ¨ <a href="https://www.tensorflow.org/swift/" target="_blank" rel="noopener">Swift for TensorFlow</a>ã€<br><a href="https://github.com/apple/swift-nio" target="_blank" rel="noopener">SwiftNIO</a> å’Œå…¶ä»–é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬æ­£å¼€å§‹çœ‹åˆ° Swift æ‰¿è¯ºçš„åœ¨ App Store ä¹‹å¤–çš„ä½¿ç”¨ã€‚</p><p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œé˜»ç¢ Swift è¢«ä¸»æµé‡‡ç”¨çš„æœ€å¤§å› ç´ ä¹‹ä¸€æ˜¯å®ƒå¯¹ Xcode çš„ä¾èµ–ã€‚</p><p>äººä»¬ä¼šæœ‰å¾ˆå¤šè´¨ç–‘ï¼Œå½“æœ‰é‚£ä¹ˆå¤šä¼˜ç§€çš„ã€é—¨æ§›ä½å¾ˆå¤šçš„æ›¿ä»£æ–¹æ¡ˆå¯é€‰çš„æƒ…å†µä¸‹ï¼Œä¸ºä»€ä¹ˆè¿˜è¦è®© Web å¼€å‘è€…æˆ–æœºå™¨å­¦ä¹ å·¥ç¨‹å¸ˆä»…ä»…ä¸ºäº†å°è¯• Swift è€Œå»ä¸‹è½½ Xcodeï¼Ÿæ”¯æŒ Language Server Protocol å¯ä»¥è®©è‹¹æœç”Ÿæ€åœˆä»¥å¤–çš„äººæ›´å®¹æ˜“åœ°ä½¿ç”¨ä»–ä»¬ç†Ÿæ‚‰å·¥å…·å»æ„Ÿå— Swiftã€‚</p><h3 id="Xcode-å˜å¾—æ›´å¥½"><a href="#Xcode-å˜å¾—æ›´å¥½" class="headerlink" title="Xcode å˜å¾—æ›´å¥½"></a>Xcode å˜å¾—æ›´å¥½</h3><p>æ”¯æŒ LSP ä¸ä»…ä»…æ˜¯è®© Swift åœ¨å…¶ä»–ç¼–è¾‘å™¨ä¸­è¿è¡Œåœ°æ›´å¥½ï¼ŒXcode ä¹Ÿå°†å—ç›ŠåŒªæµ…ã€‚</p><p>çœ‹çœ‹è‹¹æœ Swift é¡¹ç›®è´Ÿè´£äºº Ted Kremenek çš„ <a href="https://forums.swift.org/t/new-lsp-language-service-supporting-swift-and-c-family-languages-for-any-editor-and-platform/17024/29" target="_blank" rel="noopener">è¿™ç¯‡è®ºå›å¸–å­</a>:</p><blockquote><p>@akyrtzi æ‰€æè¿°çš„ LSP æœåŠ¡å°†æ¯”ä»Šå¤©çš„ SourceKit æ›´å¼ºå¤§ã€‚</p></blockquote><p>LSP å¯¹ Xcode å›¢é˜Ÿæ¥è¯´æ˜¯ä¸€ä¸ªæœºé‡ï¼Œè®©ä»–ä»¬ä½¿ç”¨ä¸€ç§æ–°çš„æ–¹æ³•å®ç° Swift é›†æˆï¼Œå¹¶å¯ä»¥å°†å…¶åº”ç”¨åœ¨è¯­è¨€å’Œå·¥å…·è‡ª 1.0 ç‰ˆæœ¬å‘å¸ƒä»¥æ¥å››å¹´ä¸­çš„æ‰€æœ‰æ”¹è¿›ä¸Šã€‚</p><h3 id="Xcodeï¼ˆæœ€ç»ˆï¼‰å˜å¾—æ›´å¼ºå¤§"><a href="#Xcodeï¼ˆæœ€ç»ˆï¼‰å˜å¾—æ›´å¼ºå¤§" class="headerlink" title="Xcodeï¼ˆæœ€ç»ˆï¼‰å˜å¾—æ›´å¼ºå¤§"></a>Xcodeï¼ˆæœ€ç»ˆï¼‰å˜å¾—æ›´å¼ºå¤§</h3><p>LSP çš„å¥½å¤„å¹¶ä¸é™äº Swift å’Œ Objective-Cï¼Œ<a href="https://forums.swift.org/t/new-lsp-language-service-supporting-swift-and-c-family-languages-for-any-editor-and-platform/17024/33" target="_blank" rel="noopener">Argyrios åœ¨é‚£ä¸ªå¸–å­çš„å¦ä¸€ä¸ªç•™è¨€ä¸­æŒ‡å‡º</a>ï¼š</p><blockquote><p>Xcode ä½¿ç”¨æˆ‘ä»¬æ–°çš„ LSP æœåŠ¡ï¼Œè¿™æ„å‘³ç€å®ƒä¹Ÿå¯ä»¥ä½¿ç”¨å…¶ä»– LSP æœåŠ¡ï¼Œæˆ‘ä»¬å¯¹æ­¤å¾ˆæ„Ÿå…´è¶£ï¼Œä¸è¿‡ç›®å‰æš‚æ— å…·ä½“è®¡åˆ’ã€‚</p></blockquote><p>ç›®å‰çš„å·¥ä½œé‡ç‚¹æ˜¯æ”¹è¿› Swiftã€‚ä½†æ˜¯ï¼Œä¸€æ—¦å®ç°äº†è¿™ä¸€ç‚¹ï¼Œå°±åº”è¯¥èƒ½ç›¸å¯¹ç®€å•åœ°å°†è¿™äº›ä¼˜åŒ–è½¬ç§»åˆ°æ”¯æŒ LSP çš„å…¶ä»–è¯­è¨€ä¸­ã€‚</p><hr><p>è½¯ä»¶çš„æ¶æ„åæ˜ äº†åˆ›å»ºå®ƒçš„ç»„ç»‡çš„ç»“æ„å’Œä»·å€¼ã€‚åœ¨æŸç§ç¨‹åº¦ä¸Šï¼Œåä¹‹äº¦ç„¶ã€‚</p><p>é€šè¿‡è®© Xcode æ”¯æŒå¼€æ”¾çš„ Language Server Protocol æ ‡å‡†ï¼Œè‹¹æœæ­£åœ¨å±¥è¡Œå…¶åœ¨è‹¹æœç”Ÿæ€ç³»ç»Ÿä¹‹å¤–çš„å¹³å°ä¸Šå®ç° Swift æˆåŠŸçš„æ‰¿è¯ºã€‚æˆ‘è®¤ä¸ºè¿™æ˜¯å¯è¡Œçš„ï¼šå·¥å…·ï¼ˆæˆ–ç¼ºå°‘å·¥å…·ï¼‰é€šå¸¸æ˜¯æŠ€æœ¯è·å¾—äººå¿ƒçš„å…³é”®å†³å®šå› ç´ ã€‚ä½†æˆ–è®¸æ›´é‡è¦çš„æ˜¯ï¼Œæˆ‘è®¤ä¸ºè¿™ä¸€å†³å®šè¡¨æ˜ï¼Œå…¬å¸å†…éƒ¨ï¼ˆè‡³å°‘æ˜¯ä¸€å°éƒ¨åˆ†ï¼‰å¯¹åˆä½œå’Œé€æ˜åº¦çš„æ„æ„¿æœ‰æ‰€å¢å¼ºã€‚</p><blockquote><p>æœ¬æ–‡ç”± SwiftGG ç¿»è¯‘ç»„ç¿»è¯‘ï¼Œå·²ç»è·å¾—ä½œè€…ç¿»è¯‘æˆæƒï¼Œæœ€æ–°æ–‡ç« è¯·è®¿é—® <a href="http://swift.gg">http://swift.gg</a>ã€‚</p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;ä½œè€…ï¼šMatttï¼Œ&lt;a href=&quot;https://nshipster.com/language-server-protocol/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;åŸæ–‡é“¾æ¥&lt;/a&gt;ï¼ŒåŸæ–‡æ—¥æœŸï¼š2018-11-19&lt;br&gt;è¯‘è€…ï¼š&lt;a href=&quot;https://github.com/mobilefellow&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;é›¨è°¨&lt;/a&gt;ï¼›æ ¡å¯¹ï¼š&lt;a href=&quot;http://numbbbbb.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;numbbbbb&lt;/a&gt;ï¼Œ&lt;a href=&quot;http://www.jianshu.com/users/596f2ba91ce9/latest_articles&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;pmst&lt;/a&gt;ï¼›å®šç¨¿ï¼š&lt;a href=&quot;http://forelax.space&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Forelax&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;!--æ­¤å¤„å¼€å§‹æ­£æ–‡--&gt;
&lt;p&gt;ä¸Šä¸ªæœˆï¼Œè‹¹æœå…¬å¸ &lt;a href=&quot;https://forums.swift.org/t/new-lsp-language-service-supporting-swift-and-c-family-languages-for-any-editor-and-platform/17024&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;åœ¨ Swift.org è®ºå›ä¸Šå®£å¸ƒ&lt;/a&gt;ï¼Œæ­£åœ¨ç€æ‰‹ä¸º Swift å’Œ C è¯­è¨€æ”¯æŒ &lt;a href=&quot;https://microsoft.github.io/language-server-protocol/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Language Server Protocol&lt;/a&gt;ï¼ˆè¯­è¨€æœåŠ¡å™¨åè®®ï¼ŒLSPï¼‰ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;å¯¹äºè‹¹æœå…¬å¸è€Œè¨€ï¼Œä¸ºæ‰€æœ‰ Swift å¼€å‘è€… â€”â€” åŒ…æ‹¬éè‹¹æœå¹³å°ä¸Šçš„ â€”â€” æä¾›é«˜è´¨é‡çš„å·¥å…·æ”¯æŒéå¸¸é‡è¦ã€‚æˆ‘ä»¬å¸Œæœ›ä¸å¼€æºç¤¾åŒºåˆä½œï¼Œå°†ç²¾åŠ›é›†ä¸­åœ¨æ„å»º Xcode å’Œå…¶ä»–ç¼–è¾‘å™¨ã€å…¶ä»–å¹³å°å¯ä»¥å…±äº«çš„å…¬å…±åŸºç¡€è®¾æ–½ä¸Šã€‚ä¸ºå®ç°è¿™ä¸€ç›®æ ‡ï¼Œ[â€¦â€¦]ï¼Œæˆ‘ä»¬å†³å®šæ”¯æŒ LSPã€‚&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Argyrios Kyrtzidisï¼Œ2018 å¹´ 10 æœˆ 15 æ—¥&lt;/em&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;è¿™å¯èƒ½æ˜¯è‹¹æœè‡ª 2014 å¹´å°† Swift ä½œä¸ºå¼€æºè½¯ä»¶å‘å¸ƒä»¥æ¥ï¼Œä¸º Swift åšå‡ºçš„æœ€é‡è¦çš„å†³å®šã€‚&lt;/strong&gt; è¿™å¯¹äº APP å¼€å‘è€…æ¥è¯´æ˜¯ä¸€ä»¶å¤§äº‹ï¼Œå¯¹äºå…¶ä»–å¹³å°ä¸Šçš„ Swift å¼€å‘è€…æ¥è¯´æ›´æ˜¯ä¸€ä»¶å¤§äº‹ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†ç†è§£å…¶ä¸­çš„åŸå› ï¼Œæœ¬å‘¨çš„æ–‡ç« å°†ç ”ç©¶ Language Server Protocol è§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Œå®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Œä»¥åŠå®ƒçš„é•¿æœŸå½±å“å¯èƒ½æ˜¯ä»€ä¹ˆã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="Swift" scheme="https://swift.gg/categories/Swift/"/>
    
      <category term="NSHipster" scheme="https://swift.gg/categories/Swift/NSHipster/"/>
    
    
      <category term="Swift" scheme="https://swift.gg/tags/Swift/"/>
    
      <category term="NSHipster" scheme="https://swift.gg/tags/NSHipster/"/>
    
  </entry>
  
  <entry>
    <title>Swift å‚»ç“œæŠ€å·§ #6ï¼šæœ‰åŠ¨ç”»æˆ–æ— åŠ¨ç”»</title>
    <link href="https://swift.gg/2019/01/07/stupid-swift-tricks-6-animations/"/>
    <id>https://swift.gg/2019/01/07/stupid-swift-tricks-6-animations/</id>
    <published>2019-01-07T00:00:00.000Z</published>
    <updated>2019-08-14T12:15:53.980Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ä½œè€…ï¼šWooji Juiceï¼Œ<a href="http://www.wooji-juice.com/blog/stupid-swift-tricks-6-animations.html" target="_blank" rel="noopener">åŸæ–‡é“¾æ¥</a>ï¼ŒåŸæ–‡æ—¥æœŸï¼š2018-11-14<br>è¯‘è€…ï¼š<a href="https://github.com/alejx" target="_blank" rel="noopener">çŸ³æ¦´</a>ï¼›æ ¡å¯¹ï¼š<a href="http://numbbbbb.com/" target="_blank" rel="noopener">numbbbbb</a>ï¼Œ<a href="https://github.com/Cee" target="_blank" rel="noopener">Cee</a>ï¼›å®šç¨¿ï¼š<a href="http://forelax.space" target="_blank" rel="noopener">Forelax</a></p></blockquote><!--æ­¤å¤„å¼€å§‹æ­£æ–‡--><p>æµç•…çš„åŠ¨ç”»ä¸€å¼€å§‹å°±è¢«è®¤ä¸ºæ˜¯ iOS åº”ç”¨çš„ç‰¹ç‚¹ä¹‹ä¸€ã€‚è¿™ä¸ä»…å½’åŠŸäº iOS ç³»ç»Ÿå¼ºå¤§çš„åŠ¨ç”»å¼•æ“ï¼ˆä»è€Œä½¿å¾— App èƒ½å¤Ÿä¸€è¾¹å±•ç¤ºæµç•…çš„åŠ¨ç”»ä¸€è¾¹åšç€å…¶ä»–çš„äº‹æƒ…ï¼‰ï¼Œè¿˜å½’åŠŸäºç³»ç»Ÿæä¾›çš„éå¸¸æ–¹ä¾¿çš„åŠ¨ç”» APIï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æ— åŠ¨ç”»</span></span><br><span class="line">doStuff()</span><br><span class="line"><span class="comment">// æœ‰åŠ¨ç”»</span></span><br><span class="line"><span class="type">UIView</span>.animate(withDuration: <span class="number">1</span>) &#123; doStuff() &#125;</span><br></pre></td></tr></table></figure><p>åªéœ€è¦å°†ä½ çš„ä»£ç æ”¾è¿› blockï¼ˆé—­åŒ…ï¼‰ä¸­ï¼Œå°±å¯ä»¥è®©å®ƒä»¬æ‹¥æœ‰æµç•…çš„ç¼“å…¥ç¼“å‡ºçš„åŠ¨ç”»æ•ˆæœã€‚</p><p>ç„¶è€Œï¼Œå¦‚æœä½ ä½¿ç”¨è¿‡è¿™å¥—ç³»ç»Ÿï¼Œä½ å¯èƒ½ä¼šé‡åˆ°ä¸€äº›é—®é¢˜ã€‚è¿™ä¸ªç³»ç»Ÿå¯ä»¥å®Œç¾åœ°å¤„ç†ç®€å•çš„æƒ…å†µï¼Œæ¯”å¦‚è®©ä¸€ä¸ªä¸œè¥¿æ·¡å…¥ã€æ·¡å‡ºï¼Œæˆ–æ”¹å˜å®ƒçš„é¢œè‰²ï¼Œä½†åœ¨æ›´å¤æ‚çš„æƒ…å†µä¸‹ï¼Œè¿™ç§æ–¹æ³•å°±ä¼šå¼€å§‹å‡ºç°é—®é¢˜ã€‚</p><a id="more"></a><p>ä¾‹å¦‚ä¸‹é¢è¿™ä¸ªä¾‹å­ï¼Œä½ æƒ³è¦æ·¡å‡ºä¸€ä¸ªå…ƒç´ ï¼Œç„¶ååˆ é™¤å®ƒã€‚<code>UIView</code> æ”¯æŒè¿™ç§æ“ä½œï¼š<br><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="type">UIView</span>.animate(withDuration: <span class="number">1</span>, animations:</span><br><span class="line">&#123;</span><br><span class="line">someting.alpha = <span class="number">0</span></span><br><span class="line">&#125;, completion:</span><br><span class="line">&#123;</span><br><span class="line">something.removeFormSuperView()</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p><p>ä½†ä½ åªèƒ½æŠŠæ‰€æœ‰ä¸œè¥¿éƒ½å†™åœ¨ <code>completion</code> block é‡Œæ—¶æ‰ä¼šå·¥ä½œã€‚åœ¨å¤§å‹é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬éœ€è¦æŠŠå¤æ‚çš„ä»»åŠ¡æ‹†è§£æˆå°çš„æ–¹æ³•ã€‚ä½†é—®é¢˜å°±åœ¨è¿™äº›æ–¹æ³•ä¸­ï¼Œåƒåœ¨ä¸Šä¸ªä¾‹å­ä¸­çš„ <code>doStuff()</code>ï¼Œæˆ‘ä»¬æ— æ³•åœ¨ <code>completion</code> block ä¸­æ·»åŠ ä»£ç ã€‚</p><p>æˆ‘ä»¬ä¹Ÿæ— æ³•å¾—çŸ¥åŠ¨ç”»æœ‰å¤šé•¿ï¼ˆç”šè‡³éƒ½ä¸çŸ¥é“æœ‰æ²¡æœ‰åŠ¨ç”»ï¼‰ï¼Œæ‰€ä»¥å¦‚æœæˆ‘ä»¬æ²¡æœ‰åŠæ³•ç®€å•åœ°å’ŒåŠ¨ç”»æ—¶é—´ä¹‹é—´åŒæ­¥ï¼ˆå¦‚åœ¨ <a href="http://www.wooji-juice.com/products/ferrite/" target="_blank" rel="noopener">ä¸€ä¸ªéŸ³é¢‘ç¼–è¾‘è½¯ä»¶</a> ä¸­è®©è¿›åº¦æ¡åŒæ­¥å‰è¿›ï¼‰ã€‚</p><p>æ€»çš„æ¥è¯´ï¼Œæˆ‘ä»¬æ— æ³•è·çŸ¥å…³äºåŠ¨ç”»çš„<em>ä¿¡æ¯</em>ï¼Œä»–ä»¬ä»…ä»…æ˜¯æ‰§è¡Œä»£ç ï¼Œè¿›è¡Œæˆ–ä¸è¿›è¡ŒåŠ¨ç”»ï¼Œå¹¶ä¸ä¼šå—æˆ‘ä»¬æ§åˆ¶ã€‚</p><p>å¦‚æœæˆ‘ä»¬åœ¨è§†å›¾ä¸­æ·»åŠ å¸¦æœ‰ Auto Layout çš„æ–°å…ƒç´ ï¼Œäº‹æƒ…å°±ä¼šå˜å¾—æ›´å¤æ‚ï¼šä½ éœ€è¦å°å¿ƒåœ°è°ƒç”¨ <code>UIView.performWithoutAnimation { }</code>ï¼Œå¦åˆ™æ–°å‡ºç°çš„è§†å›¾å°±ä¼šä» <code>(x: 0, y: 0, w: 0, h: 0)</code> ç¬ç§»åˆ°å®ƒä»¬çš„ç›®æ ‡ä½ç½®ã€‚</p><h2 id="è§†å›¾å±æ€§-Animator"><a href="#è§†å›¾å±æ€§-Animator" class="headerlink" title="è§†å›¾å±æ€§ Animator"></a>è§†å›¾å±æ€§ Animator</h2><p>å¾ˆé•¿æ—¶é—´ä»¥æ¥ï¼Œæˆ‘ä¸€ç›´åœ¨æ”¹å˜ä»£ç ä¸­åŠ¨ç”»çš„å†™æ³•ã€‚æœ€å¼€å§‹æˆ‘å†™äº†æˆ‘è‡ªå·±çš„ <code>AnimationContext</code> ç±»æ¥ååŠ©ï¼Œåæ¥è‹¹æœæä¾›äº†ä»–ä»¬åŠŸèƒ½ç›¸åŒçš„ <code>UIViewPropertyAnimator</code>ï¼Œç°åœ¨æˆ‘ä¼šåœ¨æ‰€æœ‰å¯èƒ½çš„åœ°æ–¹ä½¿ç”¨å®ƒã€‚</p><p>ä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘å‘ç°æœ€æœ‰æ•ˆçš„æ–¹æ³•æ˜¯å†™ä¸€ä¸ªã€Œå¯åŠ¨ç”»ã€çš„æ–¹æ³•å¹¶æ˜¾å¼æ¥å—ä¸€ä¸ª animator å‚æ•°ï¼š<br><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">doStuff</span><span class="params">(with animator: UIViewPropertyAnimator? = <span class="literal">nil</span>)</span></span></span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ä¹‹åæˆ‘å°±å¯ä»¥ç›´æ¥è°ƒç”¨ <code>doStuff()</code> ä¸æ·»åŠ åŠ¨ç”»å¹¶å®Œæˆä»»åŠ¡ï¼Œæˆ–è°ƒç”¨ <code>doStuff(with: UIViewPropertyAnimator(duration: 1, curve: .easeInOut))</code> æˆ–åŠ å…¶ä»–çš„å‚æ•°å»å®Œæˆä»»åŠ¡å¹¶æ·»åŠ åŠ¨ç”»ã€‚</p><p>ï¼ˆå®é™…æƒ…å†µä¸­ï¼Œä¸Šè¿°æ–¹æ³•é€šå¸¸ä¼šè¢«ç§°ä½œ <code>reflectCurrentState()</code> æˆ–å…¶ä»–ç‰¹å®šé¢†åŸŸçš„åå­—ï¼›è¯¥æ–¹æ³•æ‰§è¡Œæ‰€æœ‰å¿…è¦çš„ä¿®æ”¹ï¼Œå¹¶å°†è§†å›¾ä¸æœ€æ–°çš„æ•°æ®åŒæ­¥ã€‚è¯¥æ–¹æ³•ä¸€èˆ¬ä¸ä¼šè¢«æœ¬è§†å›¾ä»¥å¤–çš„ä»£ç è°ƒç”¨ï¼Œè€Œæ˜¯è¢«è§†å›¾è‡ªå·±è°ƒç”¨ï¼Œç„¶åä¼šæ ¹æ®éœ€è¦ç»§ç»­è°ƒç”¨å…¶ä»–å†…éƒ¨æ–¹æ³•ï¼Œæˆ–å°† animator ä¼ ç»™å…¶ä»–å†…éƒ¨æ–¹æ³•ã€‚ä¸è¿‡è¿™ä¸åœ¨æœ¬æ–‡çš„è®¨è®ºèŒƒå›´å†…ã€‚ï¼‰</p><p><code>doStuff()</code> å¯ä»¥åƒä¹‹å‰ä¸€æ ·ï¼Œå¸¦æœ‰æˆ–ä¸å¸¦æœ‰åŠ¨ç”»æ‰§è¡Œä¸€ä¸ªä»»åŠ¡ã€‚ä½†ç°åœ¨å®ƒå¸¦æœ‰äº†æ›´å¤šä¿¡æ¯ï¼šå®ƒçŸ¥é“è‡ªå·±æ˜¯å¦æ‰§è¡ŒåŠ¨ç”»ï¼›å®ƒå¯ä»¥è¯»å– animator çš„ <code>duration</code> å±æ€§ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰ã€‚ä»–å¯ä»¥è°ƒç”¨ animator çš„ <code>addAnimation</code> æ¥æ˜ç¡®åœ°æŒ‡å®šå“ªäº›ä»£ç éœ€è¦åŠ¨ç”»ï¼Œå¹¶ç›´æ¥æ‰§è¡Œä¸éœ€è¦åŠ¨ç”»çš„ä»£ç ï¼›ä»–å¯ä»¥è°ƒç”¨ <code>addCompletion</code> æ¥å¤„ç† <code>removeFromSuperView()</code> æˆ–å…¶ä»–æ–¹æ³•ã€‚</p><p>ä»¥ä¸Šéƒ½æ˜¯ç›¸æ¯”äºä¹‹å‰æ”¹è¿›çš„åœ°æ–¹ï¼Œä½†ä¹Ÿä¸æ˜¯æ²¡æœ‰é—®é¢˜ã€‚å°¤å…¶æ˜¯å®ƒå¼€å§‹å˜å¾—æœ‰ç‚¹å•°å—¦ï¼š</p><ol><li><code>doStuff(with: ...)</code> éœ€è¦å†™å…¥ä¸€ä¸ªå¾ˆé•¿çš„ <code>UIViewPropertyAnimator</code> æ„é€ å‡½æ•°ã€‚ä¸æ˜¯å¾ˆç†æƒ³ï¼Œä¸è¿‡è·Ÿä¸‹é¢æ¯”èµ·æ¥ä¸ç®—ä»€ä¹ˆï¼š</li><li>åœ¨ <code>doStuff()</code> å†…éƒ¨ï¼Œéœ€è¦æ£€æŸ¥ <code>UIViewPropertyAnimator</code> æ˜¯å¦å­˜åœ¨å¹¶è°ƒæ•´ä»£ç ã€‚</li></ol><p>æˆ‘ä»¬ä¸èƒ½ç®€å•çš„ä¾èµ– optional chainingï¼ˆå¯é€‰é“¾å¼è°ƒç”¨)ï¼ˆå¦‚ <code>animator?.addcompletion { something.removeFromSuperview() }</code>ï¼‰ï¼Œå› ä¸ºå¦‚æœ animator æ˜¯ <code>nil</code> ä¼šå¯¼è‡´ block ä¸­çš„ä»£ç è¢«ç›´æ¥è·³è¿‡ï¼Œç„¶è€Œæ— è®ºæœ‰æ²¡æœ‰åŠ¨ç”»ï¼Œæˆ‘ä»¬éƒ½å¸Œæœ›è¯¥è§†å›¾åœ¨çˆ¶è§†å›¾ä¸­è¢«ç§»é™¤ã€‚</p><p>ä¸ºäº†ä¿è¯æ­£ç¡®çš„è¡Œä¸ºï¼Œä½ çš„ä»£ç ä¼šç±»ä¼¼è¿™ä¸ªæ ·å­ï¼š<br><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">doStuff</span><span class="params">(with animator: UIViewPropertyAnimator? = <span class="literal">nil</span>)</span></span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> <span class="keyword">let</span> animator = animator</span><br><span class="line">&#123;</span><br><span class="line"><span class="number">_</span> <span class="keyword">in</span> something.removeFromSuperview()</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">something.removeFromSuperview()</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>Objective-C çˆ±å¥½è€…å³ä½¿ç§ä¸èµ· Optionalï¼ˆå¯é€‰ï¼‰ä¹Ÿç¬‘ä¸å‡ºæ¥ â€“ ä½¿ç”¨ Objective-C ä¹Ÿä¸ä¼šæ”¹å–„è¿™ç§æƒ…å†µï¼š<br><figure class="highlight objc"><table><tr><td class="code"><pre><span class="line">- (<span class="keyword">void</span>) doStuffWithAnimator: (<span class="keyword">nullable</span> <span class="built_in">UIViewPropertyAnimator</span> *) animator</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (animator != <span class="literal">nil</span>)</span><br><span class="line">&#123;</span><br><span class="line">[animator addCompletion: ^(<span class="built_in">UIViewAnimatingPosition</span> position)</span><br><span class="line">&#123;</span><br><span class="line">[something removeFromSuperview];</span><br><span class="line">&#125;];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">[something removeFromSuperView];</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ä¸€æ—¦ä½ åœ¨ç”Ÿäº§ç¯å¢ƒä¸­æƒ³ä½¿ç”¨è¿™æ ·çš„ä»£ç ï¼Œä½ æœ€ç»ˆä¼šå†™å‡ºæ›´æ‚ä¹±ã€æ›´éš¾äºé˜…è¯»å’Œç»´æŠ¤çš„ä»£ç ã€‚</p><p>å¹¸è¿çš„æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥è¿›ä¸€æ­¥çš„æ”¹è¿›è¿™æ®µä»£ç ã€‚</p><h2 id="Optional-ä¸æ˜¯-Nil-çš„å¦ä¸€ä¸ªå«æ³•"><a href="#Optional-ä¸æ˜¯-Nil-çš„å¦ä¸€ä¸ªå«æ³•" class="headerlink" title="Optional ä¸æ˜¯ Nil çš„å¦ä¸€ä¸ªå«æ³•"></a>Optional ä¸æ˜¯ <code>Nil</code> çš„å¦ä¸€ä¸ªå«æ³•</h2><p>æ”¹è¿›è¿™æ®µä»£ç çš„è¯€çªå°±åœ¨äºï¼Œ<code>UIViewPropertyAnimator</code> åœ¨è¿™é‡Œæ˜¯ Optionalï¼Œå…³é”®ç‚¹å°±åœ¨äº Optional åœ¨ Swift ä¸­çš„æ„ä¹‰ã€‚</p><p>æœ‰çš„æ—¶å€™äººä»¬ä¼šæŠ±æ€¨ Swift çš„ Optional éå¸¸çƒ¦äººï¼Œå› ä¸ºåœ¨ Objective-C ä¸­ï¼ˆObjective-C ä¸­ä½¿ç”¨ <code>nil</code> æŒ‡é’ˆæ¥æ›¿ä»£ Swift ä¸­çš„ Optionalï¼‰ä½ å¯ä»¥ç›´æ¥å¯¹æŒ‡é’ˆè°ƒç”¨æ–¹æ³•ã€‚</p><p>Objective-C ä¸ä¼šæŠ±æ€¨æŒ‡é’ˆæ˜¯ä¸æ˜¯ <code>nil</code>ï¼šå¦‚æœæŒ‡é’ˆéç©ºï¼Œæ–¹æ³•ä¼šç›´æ¥è¢«è°ƒç”¨ï¼›å¦‚æœæ˜¯ç©ºæŒ‡é’ˆï¼Œè°ƒç”¨ä¼šè¢«æ— å£°åœ°å¿½ç•¥æ‰ï¼Œä¸ç”¨ç¨‹åºå‘˜åšå…¶ä»–çš„äº‹æƒ…ã€‚</p><p>æˆ‘ä¸åŒæ„è¿™ä¸ªæ„è§ã€‚åœ¨ Swift ä¸­ï¼Œåœ¨ä½ çŸ¥é“ä½ åœ¨åšä»€ä¹ˆçš„æƒ…å†µä¸‹ï¼Œä½ åªéœ€è¦åŠ ä¸€ä¸ª <code>?</code>ï¼Œå¹¶ä¸æ˜¯ä¸€ä¸ªå¾ˆå¤§çš„è´Ÿæ‹…ã€‚ä½†æ˜¯ç”±äºæœ‰äº† Swift çš„ Optionalï¼Œæˆ‘ä»¬å¯ä»¥åšæ›´å¤šäº‹æƒ…ã€‚</p><p>å› ä¸ºåœ¨ Swift ä¸­ï¼ŒOptional æ˜¯ä¸€ä¸ªâ€œçœŸå®çš„ä¸œè¥¿â€ï¼Œè€Œä¸æ˜¯â€œç¼ºå°‘çš„ä¸œè¥¿â€ã€‚æ— è®ºä¸€ä¸ª Optional çš„å€¼æ˜¯ä»€ä¹ˆï¼Œå°±ç®—æ˜¯ <code>nil</code>ï¼Œå®ƒä¹Ÿæ˜¯ä¸€ä¸ªæšä¸¾å€¼ï¼Œä½ å¯ä»¥å¯¹å®ƒè°ƒç”¨æ–¹æ³•ï¼Œè°ƒç”¨çš„æ–¹æ³•ä¹Ÿä¼šè¢«æ‰§è¡Œã€‚<a href="http://www.wooji-juice.com/blog/stupid-swift-tricks-5-enums" target="_blank" rel="noopener">è®²çœŸçš„ï¼ŒSwift çš„æšä¸¾è¶…çº§å¥½ç”¨ï¼</a></p><p>ï¼ˆæœ‰è¶£çš„æ˜¯ï¼Œåœ¨ Objective-C ç±»ä¸­å¯¹ Swift çš„ <code>nil</code> çš„åº•å±‚è¡¨ç¤º<em>å°±æ˜¯</em>ç©ºæŒ‡é’ˆï¼Œæ‰€ä»¥å®ƒä»¬çš„æ•ˆç‡è¿˜æ˜¯å¾ˆé«˜çš„ã€‚ä½†æ˜¯è¯­æ³•å±‚é¢ï¼Œå®ƒä»¬éå¸¸çš„ä¸åŒã€‚æˆ‘ä»¬ä¼šåœ¨æ¥ä¸‹æ¥åˆ©ç”¨è¿™ä¸ªæ€§è´¨ã€‚ï¼‰</p><p>å› ä¸ºåœ¨ Swift ä¸­ï¼Œä½ å¯ä»¥å¯¹å‡ ä¹æ‰€æœ‰ç±»å‹æ·»åŠ æ‹“å±•ï¼Œä¸ä»…ä»…æ˜¯ Objective-C ç±»ã€‚ä½ å¯ä»¥ï¼š<br><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Optional</span> <span class="title">where</span> <span class="title">Wrapped</span> == <span class="title">UIViewPropertyAnimator</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="meta">@discardableResult</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">addCompletion</span><span class="params">(<span class="number">_</span> block: @escaping <span class="params">(UIViewAnimatingPosition)</span></span></span>-&gt;()) -&gt; <span class="type">Optional</span>&lt;<span class="type">UIViewPropertyAnimator</span>&gt;</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> animator = <span class="keyword">self</span></span><br><span class="line">        &#123;</span><br><span class="line">            animator.addCompletion(block)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            block(.end)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">self</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>è¿™æ®µä»£ç å°†éš¾çœ‹çš„ä»£ç ç§»åŠ¨åˆ°äº† Optional çš„åº“ä¸­ï¼ˆä½†åªé’ˆå¯¹ <code>UIViewPropertyAnimator</code>ï¼‰ã€‚ç°åœ¨ï¼Œä½ çš„è§†å›¾å¯ä»¥ï¼š<br><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">doStuff</span><span class="params">(with animator: UIViewPropertyAnimator? = <span class="literal">nil</span>)</span></span></span><br><span class="line">&#123;</span><br><span class="line">animator.addCompletion &#123; <span class="number">_</span> <span class="keyword">in</span> something.removeFromSuperview() &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ç°åœ¨å›è°ƒå‡½æ•°æ€»ä¼šè¢«æ‰§è¡Œï¼Œæ— è®ºæœ‰æ²¡æœ‰ animatorã€‚</p><p>ï¼ˆæ³¨æ„ <code>animator</code> å’Œ <code>addCompletion</code> ä¹‹é—´æ²¡æœ‰ <code>?</code>ï¼‰</p><p>å¦‚æœæœ‰ animatorï¼Œblock ä¸­çš„ä»£ç ä¼šåœ¨åŠ¨ç”»å®Œæˆæ—¶è¢«è°ƒç”¨ï¼›å¦‚æœæ²¡æœ‰ animatorï¼Œblock ä¸­çš„ä»£ç ä¼šè¢«ç«‹å³è°ƒç”¨ï¼Œå› ä¸º <code>nil</code> Optional ä»ç„¶æ˜¯ Optionalï¼Œæ‹¥æœ‰æ‰€æœ‰ Optional çš„æ–¹æ³•ï¼Œå½“ç„¶ä¹ŸåŒ…æ‹¬æˆ‘ä»¬åˆšåˆšæ·»åŠ çš„æ–¹æ³• â€“ è€Œä¸æ˜¯ä¸€ä¸ªåä¸‹æ‰€æœ‰çš„æ»šè½åˆ°å®ƒè¡¨é¢çš„æ–¹æ³•è°ƒç”¨çš„é»‘æ´ã€‚</p><p>æˆ‘è¿˜æœ‰ç±»ä¼¼çš„æ‹“å±•æ–¹æ³•æ¥æ‰§è¡Œæ€»æ˜¯éœ€è¦è¢«æ‰§è¡Œçš„ä»»åŠ¡ï¼Œæœ‰äº›æ˜¯åŠ¨ç”»çš„ä¸€éƒ¨åˆ†ï¼Œæˆ–å…¶ä»–çš„ç«‹å³æ‰§è¡Œçš„ä»£ç ï¼šå¦‚æœæˆ‘æƒ³è®©ä¸€ä¸ªå…ƒç´ ç¼“å…¥ï¼Œæˆ‘ä¼šåœ¨æŠŠå…ƒç´ æ”¾å…¥è§†å›¾ä¹‹å‰å°† alpha å€¼è®¾ç½®æˆ 0ï¼Œç„¶åè°ƒç”¨ <code>animator.perform { something.alpha = 1 }</code> æ¥ä¿è¯å®ƒæ— è®ºæœ‰æ²¡æœ‰åŠ¨ç”»éƒ½ä¼šå˜å¾—å¯è§ã€‚</p><p>ä¸ Optional æ— å…³ï¼Œæˆ‘è¿˜åœ¨ <code>UIViewPropertyAnimator</code> ä¸­æ·»åŠ äº†ä¸€äº›é™æ€æ–¹æ³•æ¥ç”Ÿæˆä¸€äº›å¸¸è§çš„åŠ¨ç”»ï¼Œå¦‚ï¼š<code>static func spring(...)</code>ã€<code>static func linear(...)</code>ã€‚Swift çš„åç§°è§£ææ–¹æ³•å†³å®šäº†ä½ å¯ä»¥å†™å‡ºæ›´ç®€æ´çš„ä»£ç ï¼Œå¦‚ï¼š<code>doStuff(with: .spring(duration: 1))</code>ã€‚</p><p>å½“ç„¶ï¼Œä»¥ä¸Šåªæ˜¯ä¸€äº›å°çš„ä»£ç æŠ€å·§ï¼Œè€Œä¸æ˜¯é‡æ–°æ„æƒ³ä»£ç æˆ–åº”ç”¨ç»“æ„ã€‚ä½†æ˜¯éšç€é¡¹ç›®çš„å¤æ‚åº¦å¢åŠ ï¼Œåƒè¿™ç§å°çš„æ”¹è¿›ä¹Ÿä¼šå åŠ èµ·æ¥ï¼Œå¸®åŠ©æˆ‘ä»¬å¯¹æŠ—ä¸æ–­å¢åŠ çš„å¤æ‚åº¦ï¼Œç»´æŒå¤§å‹é¡¹ç›®çš„å¯æ§æ€§ã€‚è°¢è°¢ä½ ï¼ŒSwiftã€‚<a href="https://www.youtube.com/watch?v=9jtU9BbReQk" target="_blank" rel="noopener">Thwift</a>.</p><blockquote><p>æœ¬æ–‡ç”± SwiftGG ç¿»è¯‘ç»„ç¿»è¯‘ï¼Œå·²ç»è·å¾—ä½œè€…ç¿»è¯‘æˆæƒï¼Œæœ€æ–°æ–‡ç« è¯·è®¿é—® <a href="http://swift.gg">http://swift.gg</a>ã€‚</p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;ä½œè€…ï¼šWooji Juiceï¼Œ&lt;a href=&quot;http://www.wooji-juice.com/blog/stupid-swift-tricks-6-animations.html&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;åŸæ–‡é“¾æ¥&lt;/a&gt;ï¼ŒåŸæ–‡æ—¥æœŸï¼š2018-11-14&lt;br&gt;è¯‘è€…ï¼š&lt;a href=&quot;https://github.com/alejx&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;çŸ³æ¦´&lt;/a&gt;ï¼›æ ¡å¯¹ï¼š&lt;a href=&quot;http://numbbbbb.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;numbbbbb&lt;/a&gt;ï¼Œ&lt;a href=&quot;https://github.com/Cee&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Cee&lt;/a&gt;ï¼›å®šç¨¿ï¼š&lt;a href=&quot;http://forelax.space&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Forelax&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;!--æ­¤å¤„å¼€å§‹æ­£æ–‡--&gt;
&lt;p&gt;æµç•…çš„åŠ¨ç”»ä¸€å¼€å§‹å°±è¢«è®¤ä¸ºæ˜¯ iOS åº”ç”¨çš„ç‰¹ç‚¹ä¹‹ä¸€ã€‚è¿™ä¸ä»…å½’åŠŸäº iOS ç³»ç»Ÿå¼ºå¤§çš„åŠ¨ç”»å¼•æ“ï¼ˆä»è€Œä½¿å¾— App èƒ½å¤Ÿä¸€è¾¹å±•ç¤ºæµç•…çš„åŠ¨ç”»ä¸€è¾¹åšç€å…¶ä»–çš„äº‹æƒ…ï¼‰ï¼Œè¿˜å½’åŠŸäºç³»ç»Ÿæä¾›çš„éå¸¸æ–¹ä¾¿çš„åŠ¨ç”» APIï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight swift&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// æ— åŠ¨ç”»&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;doStuff()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// æœ‰åŠ¨ç”»&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;type&quot;&gt;UIView&lt;/span&gt;.animate(withDuration: &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;) &amp;#123; doStuff() &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;åªéœ€è¦å°†ä½ çš„ä»£ç æ”¾è¿› blockï¼ˆé—­åŒ…ï¼‰ä¸­ï¼Œå°±å¯ä»¥è®©å®ƒä»¬æ‹¥æœ‰æµç•…çš„ç¼“å…¥ç¼“å‡ºçš„åŠ¨ç”»æ•ˆæœã€‚&lt;/p&gt;
&lt;p&gt;ç„¶è€Œï¼Œå¦‚æœä½ ä½¿ç”¨è¿‡è¿™å¥—ç³»ç»Ÿï¼Œä½ å¯èƒ½ä¼šé‡åˆ°ä¸€äº›é—®é¢˜ã€‚è¿™ä¸ªç³»ç»Ÿå¯ä»¥å®Œç¾åœ°å¤„ç†ç®€å•çš„æƒ…å†µï¼Œæ¯”å¦‚è®©ä¸€ä¸ªä¸œè¥¿æ·¡å…¥ã€æ·¡å‡ºï¼Œæˆ–æ”¹å˜å®ƒçš„é¢œè‰²ï¼Œä½†åœ¨æ›´å¤æ‚çš„æƒ…å†µä¸‹ï¼Œè¿™ç§æ–¹æ³•å°±ä¼šå¼€å§‹å‡ºç°é—®é¢˜ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="Wooji Juice" scheme="https://swift.gg/categories/Wooji-Juice/"/>
    
    
      <category term="Swift" scheme="https://swift.gg/tags/Swift/"/>
    
      <category term="æ•™ç¨‹" scheme="https://swift.gg/tags/%E6%95%99%E7%A8%8B/"/>
    
  </entry>
  
  <entry>
    <title>Hacking Hit Tests</title>
    <link href="https://swift.gg/2018/12/27/hacking-hit-tests/"/>
    <id>https://swift.gg/2018/12/27/hacking-hit-tests/</id>
    <published>2018-12-27T00:00:00.000Z</published>
    <updated>2019-08-14T12:15:52.096Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ä½œè€…ï¼šSoroush Khanlouï¼Œ<a href="http://khanlou.com/2018/09/hacking-hit-tests/" target="_blank" rel="noopener">åŸæ–‡é“¾æ¥</a>ï¼ŒåŸæ–‡æ—¥æœŸï¼š2018-09-07<br>è¯‘è€…ï¼š<a href="https://nemocdz.github.io/" target="_blank" rel="noopener">Nemocdz</a>ï¼›æ ¡å¯¹ï¼š<a href="http://blog.yousanflics.com.cn" target="_blank" rel="noopener">Yousanflics</a>ï¼Œ<a href="http://www.jianshu.com/users/596f2ba91ce9/latest_articles" target="_blank" rel="noopener">pmst</a>ï¼›å®šç¨¿ï¼š<a href="http://forelax.space" target="_blank" rel="noopener">Forelax</a></p></blockquote><!--æ­¤å¤„å¼€å§‹æ­£æ–‡--><p>å›æƒ³ <a href="https://developer.apple.com/videos/play/wwdc2015/408/" target="_blank" rel="noopener">Crusty æ•™æˆ‘ä»¬ä½¿ç”¨é¢å‘åè®®ç¼–ç¨‹</a>ä¹‹å‰çš„æ—¥å­ï¼Œæˆ‘ä»¬å¤§å¤šä½¿ç”¨ç»§æ‰¿æ¥å…±äº«ä»£ç çš„å®ç°ã€‚é€šå¸¸åœ¨ UIKit ç¼–ç¨‹ä¸­ï¼Œä½ å¯èƒ½ä¼šç”¨ <code>UIView</code> çš„å­ç±»å»æ·»åŠ ä¸€äº›å­è§†å›¾ï¼Œé‡å†™ <code>-layoutSubviews</code>ï¼Œç„¶åé‡å¤è¿™äº›å·¥ä½œã€‚ä¹Ÿè®¸ä½ è¿˜ä¼šé‡å†™ <code>-drawRect</code>ã€‚ä½†å½“ä½ éœ€è¦åšä¸€äº›ç‰¹åˆ«çš„äº‹æƒ…æ—¶ï¼Œå°±éœ€è¦çœ‹çœ‹ <code>UIView</code> ä¸­å…¶ä»–å¯ä»¥è¢«é‡å†™çš„æ–¹æ³•ã€‚</p><a id="more"></a><p><code>UIKit</code> æœ‰ä¸ªååˆ†å¤æ€ªçš„åœ°æ–¹ï¼Œé‚£æ˜¯å®ƒçš„è§¦æ‘¸äº‹ä»¶å¤„ç†ç³»ç»Ÿã€‚å®ƒä¸»è¦åŒ…æ‹¬ä¸¤ä¸ªæ–¹æ³•ï¼Œ<code>-pointInstide:withEvent:</code> å’Œ <code>-hitTest:withEvent:</code>ã€‚</p><p><code>-pointInside:</code> ä¼šå‘Šè¯‰è°ƒç”¨è€…ç»™å®šç‚¹æ˜¯å¦åŒ…å«åœ¨æŒ‡å®šçš„è§†å›¾åŒºåŸŸä¸­ã€‚è€Œ <code>-hitTest:</code> ç”¨ <code>pointInside:</code> è¿™ä¸ªæ–¹æ³•æ¥å‘Šè¯‰è°ƒç”¨è€…å“ªä¸ªå­è§†å›¾ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰æ˜¯å½“å‰è§¦æ‘¸åœ¨ç»™å®šç‚¹çš„æ¥æ”¶è€…ã€‚ç°åœ¨æˆ‘æ¯”è¾ƒæ„Ÿå…´è¶£çš„æ˜¯åé¢è¿™ä¸ªæ–¹æ³•ã€‚</p><p>è‹¹æœçš„æ–‡æ¡£å‹‰å¼ºèƒ½å¤Ÿè®©ä½ ç†è§£æ€ä¹ˆé‡æ–°å®ç°è¿™ä¸ªæ–¹æ³•ã€‚åœ¨ä½ å­¦ä¼šæ€ä¹ˆé‡æ–°å®ç°æ–¹æ³•ä¹‹å‰ï¼Œä½ éƒ½ä¸èƒ½æ”¹å˜å®ƒçš„åŠŸèƒ½ã€‚æ¥ä¸‹æ¥è®©æˆ‘ä»¬çœ‹ä¸€é <a href="https://developer.apple.com/documentation/uikit/uiview/1622469-hittest?language=objc" target="_blank" rel="noopener">æ–‡æ¡£</a>ï¼Œå¹¶å°è¯•é‡å†™è¿™ä¸ªå‡½æ•°ã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">hitTest</span><span class="params">(<span class="number">_</span> point: CGPoint, with event: UIEvent?)</span></span> -&gt; <span class="type">UIView?</span> &#123;</span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é¦–å…ˆï¼Œè®©æˆ‘ä»¬ä»æ–‡æ¡£çš„ç¬¬äºŒæ®µå¼€å§‹å§ï¼š</p><blockquote><p>è¿™ä¸ªæ–¹æ³•ä¼šå¿½ç•¥é‚£äº›éšè—çš„è§†å›¾ï¼Œç¦ç”¨ç”¨æˆ·äº¤äº’è§†å›¾å’Œ alpha ç­‰çº§å°äº 0.01 çš„è§†å›¾ã€‚</p></blockquote><p>è®©æˆ‘ä»¬é€šè¿‡ä¸€äº› <code>gurad</code> è¯­å¥æ¥å¿«é€Ÿé¢„å¤„ç†è¿™äº›å‰ææ¡ä»¶ã€‚</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">override func hitTest(_ point: CGPoint, with event: UIEvent?) -&gt; UIView? &#123;</span><br><span class="line"></span><br><span class="line">guard isUserInteractionEnabled else &#123; return nil &#125;</span><br><span class="line"></span><br><span class="line">guard !isHidden else &#123; return nil &#125;</span><br><span class="line"></span><br><span class="line">guard alpha &gt;= 0.01 else &#123; return nil &#125;</span><br><span class="line"></span><br><span class="line">// ...</span><br></pre></td></tr></table></figure><p>ç›¸å½“ç®€å•å§ã€‚é‚£æ¥ä¸‹æ¥æ˜¯ï¼Ÿ</p><blockquote><p>è¿™ä¸ªæ–¹æ³•è°ƒç”¨ <code>pointInside:withEvent:</code> æ–¹æ³•æ¥éå†æ¥æ”¶è§†å›¾å±‚çº§ä¸­æ¯ä¸€ä¸ªå­è§†å›¾ï¼Œæ¥å†³å®šå“ªä¸ªå­è§†å›¾æ¥æ¥æ”¶è¯¥è§¦æ‘¸äº‹ä»¶ã€‚</p></blockquote><p>é€å­—é˜…è¯»æ–‡æ¡£åï¼Œæ„Ÿè§‰ <code>-pointInside:</code> ä¼šåœ¨æ¯ä¸€ä¸ªå­è§†å›¾é‡Œè¢«è°ƒç”¨ï¼ˆç”¨ä¸€ä¸ª for å¾ªç¯ï¼‰ï¼Œä½†è¿™å¹¶ä¸æ˜¯å®Œå…¨æ­£ç¡®çš„ã€‚</p><p>æ„Ÿè°¢è¿™ä¸ª <a href="https://twitter.com/an0/status/1038254836016394240" target="_blank" rel="noopener">è¯»è€…</a>ã€‚é€šè¿‡ä»–åœ¨ <code>-hitTest:</code> å’Œ <code>-pointInside:</code> ä¸­æ”¾ç½®äº†æ–­ç‚¹çš„è¯•éªŒï¼Œæˆ‘ä»¬çŸ¥é“ <code>-pointInside:</code> ä¼šåœ¨ <code>self</code> ä¸­è°ƒç”¨ï¼ˆåœ¨æœ‰ä¸Šé¢é‚£äº› guard çš„æƒ…å†µä¸‹ï¼‰ï¼Œè€Œä¸æ˜¯åœ¨æ¯ä¸€ä¸ªå­è§†å›¾ä¸­ã€‚ æ‰€ä»¥åº”è¯¥æ·»åŠ å¦å¤–çš„ guard è¯­å¥ï¼Œåƒä¸‹é¢è¿™è¡Œä»£ç ä¸€æ ·ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">guard</span> <span class="keyword">self</span>.point(inside: point, with: event) <span class="keyword">else</span> &#123; <span class="keyword">return</span> <span class="literal">nil</span> &#125;</span><br></pre></td></tr></table></figure><p><code>-pointInside:</code> æ˜¯ <code>UIView</code> å¦ä¸€ä¸ªéœ€è¦é‡å†™çš„æ–¹æ³•ã€‚å®ƒçš„é»˜è®¤å®ç°ä¼šæ£€æŸ¥ä¼ å…¥çš„æŸä¸ªç‚¹æ˜¯å¦åŒ…å«åœ¨è§†å›¾çš„ <code>bounds</code> ä¸­ã€‚å¦‚æœè°ƒç”¨ <code>-pointInside</code> è¿”å› trueï¼Œé‚£ä¹ˆæ„å‘³ç€è§¦æ‘¸äº‹ä»¶å‘ç”Ÿåœ¨å®ƒçš„ bounds ä¸­ã€‚</p><p>ç†è§£å®Œè¿™ä¸ªå°å°çš„å·®åˆ«åï¼Œæˆ‘ä»¬å¯ä»¥ç»§ç»­é˜…è¯»æ–‡æ¡£äº†ï¼š</p><blockquote><p>å¦‚æœ <code>-pointInside:withEvnet:</code> è¿”å› YESï¼Œé‚£ä¹ˆå­è§†å›¾çš„å±‚çº§ä¹Ÿä¼šè¿›è¡Œç±»ä¼¼çš„éå†ç›´åˆ°æ‰¾åˆ°åŒ…å«æŒ‡å®šç‚¹çš„æœ€å‰é¢çš„è§†å›¾ã€‚</p></blockquote><p>æ‰€ä»¥ï¼Œä»è¿™é‡ŒçŸ¥é“æˆ‘ä»¬éœ€è¦éå†è§†å›¾æ ‘ã€‚è¿™æ„å‘³ç€å¾ªç¯éå†æ‰€æœ‰çš„è§†å›¾ï¼Œå¹¶è°ƒç”¨ <code>-hitTest:</code> åœ¨å®ƒä»¬æ¯ä¸€ä¸ªä¸Šå»æ‰¾åˆ°åˆé€‚çš„å­è§†å›¾ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¿™ä¸ªæ–¹æ³•æ˜¯é€’å½’çš„ã€‚</p><p>ä¸ºäº†éå†è§†å›¾å±‚çº§ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªå¾ªç¯ã€‚ç„¶è€Œï¼Œè¿™ä¸ªæ–¹æ³•å…¶ä¸­ä¸€ä¸ªæ›´åäººç±»çš„æ˜¯éœ€è¦åå‘éå†è§†å›¾ã€‚å­è§†å›¾æ•°ç»„ä¸­å°¾éƒ¨çš„è§†å›¾åè€Œä¼šå¤„åœ¨ Z è½´ä¸­<em>æ›´é«˜</em>çš„ä½ç½®ï¼Œæ‰€ä»¥å®ƒä»¬åº”è¯¥è¢«æœ€å…ˆæ£€éªŒã€‚ï¼ˆå¦‚æœæ²¡æœ‰è¿™ç¯‡ <a href="http://smnh.me/hit-testing-in-ios/" target="_blank" rel="noopener">æ–‡ç« </a>ï¼Œæˆ‘å¯è®°ä¸èµ·è¿™ä¸ªç‚¹ã€‚ï¼‰</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ...</span></span><br><span class="line"><span class="keyword">for</span> subview <span class="keyword">in</span> subviews.reversed() &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ...</span></span><br></pre></td></tr></table></figure><p>ä¼ å…¥çš„åæ ‡ç‚¹ä¼šè½¬æ¢åˆ°<em>å½“å‰</em>è§†å›¾çš„åæ ‡ç³»ä¸­ï¼Œè€Œéæˆ‘ä»¬å…³å¿ƒå­è§†å›¾ä¸­ã€‚å¹¸è¿çš„æ˜¯ï¼ŒUIKit ç»™äº†ä¸€ä¸ªå¤„ç†å‡½æ•°ï¼Œå»è½¬æ¢åæ ‡ç‚¹çš„å‚è€ƒç³»åˆ°å…¶ä»–ä»»ä½•çš„è§†å›¾çš„ frame çš„å‚è€ƒç³»ä¸­ã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ...</span></span><br><span class="line"><span class="keyword">for</span> subview <span class="keyword">in</span> subviews.reversed() &#123;</span><br><span class="line"><span class="keyword">let</span> convertedPoint = subview.convert(point, from: <span class="keyword">self</span>)</span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ...</span></span><br></pre></td></tr></table></figure><p>ä¸€æ—¦æœ‰äº†è½¬æ¢åçš„åæ ‡ç‚¹ï¼Œæˆ‘ä»¬å°±å¯ä»¥å¾ˆç®€å•åœ°è¯¢é—®æ¯ä¸€ä¸ªå­è§†å›¾è¯¥ç‚¹çš„ç›®æ ‡è§†å›¾ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœç‚¹å¤„äºè¯¥è§†å›¾å¤–éƒ¨ï¼ˆä¹Ÿå°±æ˜¯è¯´ï¼Œ<code>-pointInside:</code> è¿”å› <em>false</em>ï¼‰ï¼Œ<code>-hitTest</code> ä¼šè¿”å› nilã€‚è¿™æ—¶å°±åº”è¯¥æ£€æŸ¥å±‚çº§é‡Œçš„ä¸‹ä¸€ä¸ªå­è§†å›¾ã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ...</span></span><br><span class="line"><span class="keyword">let</span> convertedPoint = subview.convert(point, from: <span class="keyword">self</span>)</span><br><span class="line"><span class="keyword">if</span> <span class="keyword">let</span> candidate = subview.hitTest(convertedPoint, with: event) &#123;</span><br><span class="line"><span class="keyword">return</span> candidate</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//...</span></span><br></pre></td></tr></table></figure><p>ä¸€æ—¦æˆ‘ä»¬æœ‰äº†åˆé€‚çš„å¾ªç¯è¯­å¥ï¼Œæœ€åä¸€ä»¶éœ€è¦åšçš„äº‹æ˜¯ <code>return self</code>ã€‚å¦‚æœè§†å›¾æ˜¯å¯è¢«ç‚¹å‡»ï¼ˆè¢«æˆ‘ä»¬çš„ <code>guard</code> è¯­å¥æ–­è¨€è¿‡çš„æƒ…å†µï¼‰ï¼Œä½†å´æ²¡æœ‰å­è§†å›¾æƒ³è¦å¤„ç†è¿™ä¸ªè§¦æ‘¸çš„è¯ï¼Œæ„å‘³ç€å½“å‰è§†å›¾ï¼Œä¹Ÿå°±æ˜¯ <code>self</code>ï¼Œæ˜¯è¿™ä¸ªè§¦æ‘¸æ­£ç¡®çš„ç›®æ ‡ã€‚</p><p>è¿™æ˜¯å®Œæ•´çš„ç®—æ³•ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">hitTest</span><span class="params">(<span class="number">_</span> point: CGPoint, with event: UIEvent?)</span></span> -&gt; <span class="type">UIView?</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">guard</span> isUserInteractionEnabled <span class="keyword">else</span> &#123; <span class="keyword">return</span> <span class="literal">nil</span> &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">guard</span> !isHidden <span class="keyword">else</span> &#123; <span class="keyword">return</span> <span class="literal">nil</span> &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">guard</span> alpha &gt;= <span class="number">0.01</span> <span class="keyword">else</span> &#123; <span class="keyword">return</span> <span class="literal">nil</span> &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">guard</span> <span class="keyword">self</span>.point(inside: point, with: event) <span class="keyword">else</span> &#123; <span class="keyword">return</span> <span class="literal">nil</span> &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> subview <span class="keyword">in</span> subviews.reversed() &#123;</span><br><span class="line"><span class="keyword">let</span> convertedPoint = subview.convert(point, from: <span class="keyword">self</span>)</span><br><span class="line"><span class="keyword">if</span> <span class="keyword">let</span> candidate = subview.hitTest(convertedPoint, with: event) &#123;</span><br><span class="line"><span class="keyword">return</span> candidate</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">self</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç°åœ¨æˆ‘ä»¬æœ‰äº†ä¸€ä¸ªå‚è€ƒçš„å®ç°ï¼Œå¯ä»¥å¼€å§‹ä¿®æ”¹å®ƒæ¥å®ç°å…·ä½“çš„è¡Œä¸ºã€‚</p><p>åœ¨ä¹‹å‰çš„è¿™ç¯‡æ’­å®¢<a href="http://khanlou.com/2013/04/changing-the-size-of-a-paging-scroll-view/" target="_blank" rel="noopener">ã€ŠChanging the size of a paging scroll viewã€‹</a>ä¸­ï¼Œæˆ‘å°±å·²ç»è®¨è®ºè¿‡å…¶ä¸­ä¸€ç§è¡Œä¸ºã€‚æˆ‘è°ˆåˆ°ä¸€ç§â€œè½åå¹¶è¯¥è¢«åºŸå¼ƒâ€çš„æ–¹æ³•æ¥äº§ç”Ÿè¿™ç§æ•ˆæœã€‚æœ¬è´¨ä¸Šï¼Œä½ å¿…é¡»ï¼š</p><ol><li>å…³æ‰ <code>clipsToBounds</code></li><li>åœ¨æ»‘åŠ¨åŒºåŸŸä¸­æ”¾ä¸€ä¸ªééšè—è§†å›¾</li><li>åœ¨ééšè—è§†å›¾ä¸Šé‡å†™ <code>-hitTest:</code> æ¥ä¼ é€’æ‰€æœ‰è§¦æ‘¸åˆ° scrollview ä¸­</li></ol><p><code>-hitTest:</code> æ–¹æ³•æ˜¯è¿™ç§æŠ€æœ¯çš„åŸºçŸ³ã€‚å› ä¸ºåœ¨ UIKit ä¸­ï¼ŒhitTest æ–¹æ³•ä¼šä»£ç†ç»™æ¯ä¸€ä¸ªè§†å›¾å»å®ç°ï¼Œå†³å®šè§¦æ‘¸äº‹ä»¶ä¼ é€’ç»™å“ªä¸ªè§†å›¾æ¥æ”¶ã€‚è¿™å¯ä»¥è®©ä½ å»é‡å†™é»˜è®¤çš„å®ç°ï¼ˆæœŸæœ›å’Œæ™®é€šçš„å®ç°ï¼‰å¹¶æ›¿æ¢å®ƒä¸ºä½ æƒ³åšçš„ï¼Œç”šè‡³è¿”å›ä¸€ä¸ªä¸æ˜¯åŸå§‹è§†å›¾çš„å­è§†å›¾ã€‚å¤šä¹ˆç–¯ç‹‚ã€‚</p><p>è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹å¦ä¸€ä¸ªä¾‹å­ã€‚å¦‚æœä½ å·²ç»ç”¨è¿‡ <a href="http://beacon.party/" target="_blank" rel="noopener">Beacon</a> ä»Šå¹´çš„ç‰ˆæœ¬ï¼Œä½ ä¼šæ³¨æ„åˆ°æ»‘åŠ¨åˆ é™¤äº‹ä»¶è¡Œä¸ºçš„ç‰©ç†æ•ˆæœæ„Ÿè§‰ä¸Šå’Œå…¶ä»–ç”¨åŸç”Ÿç³»ç»Ÿå®ç°çš„æ•ˆæœæœ‰ç‚¹ä¸ä¸€æ ·ã€‚è¿™æ˜¯å› ä¸ºç”¨ç³»ç»Ÿçš„é€”å¾„ä¸èƒ½å®Œå…¨è·å¾—æˆ‘ä»¬æƒ³è¦çš„è¡¨ç°ï¼Œæ‰€ä»¥éœ€è¦è‡ªå·±é‡æ–°å®ç°è¿™ä¸ªåŠŸèƒ½ã€‚</p><p>å¦‚ä½ æ‰€æƒ³ï¼Œé‡å†™æ»‘åŠ¨å’Œåå¼¹ç‰©ç†æ•ˆæœä¸éœ€è¦é‚£ä¹ˆå¤æ‚ï¼Œæ‰€ä»¥æˆ‘ä»¬ç”¨ä¸€ä¸ª <code>UIScrollView</code> å’Œå°† <code>pagingEnabled</code> è®¾ä¸º true æ¥è·å¾—å°½å¯èƒ½è‡ªç”±çš„åå¼¹åŠ›ã€‚ç”¨å’Œ<a href="http://khanlou.com/2013/04/changing-the-size-of-a-paging-scroll-view/" target="_blank" rel="noopener">è¿™ç¯‡æ—§åšå®¢</a>é‡Œè¯´çš„ç±»ä¼¼çš„æŠ€æœ¯ï¼Œå°†æ»‘åŠ¨çš„è§†å›¾çš„ <code>bounds</code> è®¾ç½®å¾—æ›´å°ä¸€äº›å¹¶å°† <code>panGestureRecognizer</code> ç§»åˆ°äº‹ä»¶çš„ cell é¡¶å±‚çš„ä¸€ä¸ªè¦†ç›–è§†å›¾ä¸­ï¼Œæ¥è®¾ç½®ä¸€ä¸ªè‡ªå®šä¹‰é¡µé¢å¤§å°ã€‚</p><p>ç„¶è€Œï¼Œå½“è¦†ç›–è§†å›¾æ­£ç¡®çš„ä¼ é€’è§¦æ‘¸äº‹ä»¶åˆ° scroll view æ—¶ï¼Œé‚£é‡Œä¼šæœ‰è¦†ç›–è§†å›¾ä¸èƒ½æ­£ç¡®æ‹¦æˆªçš„å…¶ä»–äº‹ä»¶ã€‚cell åŒ…å«ç€æŒ‰é’®ï¼Œåƒ â€œjoin eventâ€ æŒ‰é’®å’Œ â€œdelete eventâ€ æŒ‰é’®ï¼Œéƒ½éœ€è¦æ¥æ”¶è§¦æ‘¸ã€‚æœ‰å‡ ç§è‡ªå®šä¹‰å®ç°åœ¨ <code>-hitTest:</code> ä¸­å¯ä»¥å¤„ç†è¿™ç§æƒ…å†µï¼Œå…¶ä¸­ä¸€ç§å®ç°å°±æ˜¯ç›´æ¥æ£€æŸ¥è¿™ä¸¤ä¸ªæŒ‰é’®çš„å­è§†å›¾ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">hitTest</span><span class="params">(<span class="number">_</span> point: CGPoint, with event: UIEvent?)</span></span> -&gt; <span class="type">UIView?</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">guard</span> isUserInteractionEnabled <span class="keyword">else</span> &#123; <span class="keyword">return</span> <span class="literal">nil</span> &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">guard</span> !isHidden <span class="keyword">else</span> &#123; <span class="keyword">return</span> <span class="literal">nil</span> &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">guard</span> alpha &gt;= <span class="number">0.01</span> <span class="keyword">else</span> &#123; <span class="keyword">return</span> <span class="literal">nil</span> &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">guard</span> <span class="keyword">self</span>.point(inside: point, with: event) <span class="keyword">else</span> &#123; <span class="keyword">return</span> <span class="literal">nil</span> &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> joinButton.point(inside: convert(point, to: joinButton), with: event) &#123;</span><br><span class="line"><span class="keyword">return</span> joinButton</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> isDeleteButtonOpen &amp;&amp; deleteButton.point(inside: convert(point, to: deleteButton), with: event) &#123;</span><br><span class="line"><span class="keyword">return</span> deleteButton</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">super</span>.hitTest(point, with: event)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ç§æ–¹æ³•ä¼šæ­£ç¡®åœ°ä¼ é€’æ­£ç¡®çš„ç‚¹å‡»äº‹ä»¶åˆ°æ­£ç¡®çš„çš„æŒ‰é’®ä¸­ï¼Œè€Œä¸”ä¸ç”¨æ‰“æ–­æ˜¾ç¤ºåˆ é™¤æŒ‰é’®çš„æ»‘åŠ¨è¡¨ç°ã€‚ï¼ˆä½ å¯ä»¥å°è¯•åªå¿½ç•¥ <code>deletionOverlay</code>ï¼Œä¸è¿‡å®ƒä¸ä¼šæ­£ç¡®çš„ä¼ é€’æ»‘åŠ¨äº‹ä»¶ã€‚ï¼‰</p><p><code>-hitTest:</code> æ˜¯è§†å›¾ä¸­ä¸€ä¸ªå¾ˆå°‘é‡å†™çš„åœ°æ–¹ï¼Œä½†æ˜¯åœ¨éœ€è¦æ—¶ï¼Œå¯ä»¥æä¾›å…¶ä»–å·¥å…·å¾ˆéš¾åšåˆ°çš„è¡Œä¸ºã€‚ç†è§£å¦‚ä½•è‡ªå·±å®ç°æœ‰åŠ©äºéšæ„æ›¿æ¢å®ƒã€‚ä½ å¯ä»¥ç”¨è¿™ä¸ªæŠ€æœ¯å»æ‰©å¤§ç‚¹å‡»çš„ç›®æ ‡åŒºåŸŸï¼Œå»é™¤è§¦æ‘¸å¤„ç†ä¸­çš„æŸäº›å­è§†å›¾ï¼Œè€Œä¸ç”¨æŠŠå®ƒä»¬ä»å¯è§çš„å±‚çº§ä¸­å»æ‰ï¼Œåˆæˆ–æ˜¯ç”¨ä¸€ä¸ªè§†å›¾ä½œä¸ºå¦ä¸€ä¸ªå°†å“åº”è§¦æ‘¸çš„è§†å›¾çš„å…œåº•ã€‚æ‰€æœ‰ä¸œè¥¿éƒ½æ˜¯å¯èƒ½çš„ã€‚</p><blockquote><p>æœ¬æ–‡ç”± SwiftGG ç¿»è¯‘ç»„ç¿»è¯‘ï¼Œå·²ç»è·å¾—ä½œè€…ç¿»è¯‘æˆæƒï¼Œæœ€æ–°æ–‡ç« è¯·è®¿é—® <a href="http://swift.gg">http://swift.gg</a>ã€‚</p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;ä½œè€…ï¼šSoroush Khanlouï¼Œ&lt;a href=&quot;http://khanlou.com/2018/09/hacking-hit-tests/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;åŸæ–‡é“¾æ¥&lt;/a&gt;ï¼ŒåŸæ–‡æ—¥æœŸï¼š2018-09-07&lt;br&gt;è¯‘è€…ï¼š&lt;a href=&quot;https://nemocdz.github.io/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Nemocdz&lt;/a&gt;ï¼›æ ¡å¯¹ï¼š&lt;a href=&quot;http://blog.yousanflics.com.cn&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Yousanflics&lt;/a&gt;ï¼Œ&lt;a href=&quot;http://www.jianshu.com/users/596f2ba91ce9/latest_articles&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;pmst&lt;/a&gt;ï¼›å®šç¨¿ï¼š&lt;a href=&quot;http://forelax.space&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Forelax&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;!--æ­¤å¤„å¼€å§‹æ­£æ–‡--&gt;
&lt;p&gt;å›æƒ³ &lt;a href=&quot;https://developer.apple.com/videos/play/wwdc2015/408/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Crusty æ•™æˆ‘ä»¬ä½¿ç”¨é¢å‘åè®®ç¼–ç¨‹&lt;/a&gt;ä¹‹å‰çš„æ—¥å­ï¼Œæˆ‘ä»¬å¤§å¤šä½¿ç”¨ç»§æ‰¿æ¥å…±äº«ä»£ç çš„å®ç°ã€‚é€šå¸¸åœ¨ UIKit ç¼–ç¨‹ä¸­ï¼Œä½ å¯èƒ½ä¼šç”¨ &lt;code&gt;UIView&lt;/code&gt; çš„å­ç±»å»æ·»åŠ ä¸€äº›å­è§†å›¾ï¼Œé‡å†™ &lt;code&gt;-layoutSubviews&lt;/code&gt;ï¼Œç„¶åé‡å¤è¿™äº›å·¥ä½œã€‚ä¹Ÿè®¸ä½ è¿˜ä¼šé‡å†™ &lt;code&gt;-drawRect&lt;/code&gt;ã€‚ä½†å½“ä½ éœ€è¦åšä¸€äº›ç‰¹åˆ«çš„äº‹æƒ…æ—¶ï¼Œå°±éœ€è¦çœ‹çœ‹ &lt;code&gt;UIView&lt;/code&gt; ä¸­å…¶ä»–å¯ä»¥è¢«é‡å†™çš„æ–¹æ³•ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="KHANLOU" scheme="https://swift.gg/categories/KHANLOU/"/>
    
    
      <category term="iOSå¼€å‘" scheme="https://swift.gg/tags/iOS%E5%BC%80%E5%8F%91/"/>
    
  </entry>
  
  <entry>
    <title>å›ºå®šå¤§å°çš„æ•°ç»„</title>
    <link href="https://swift.gg/2018/12/24/fixed-sized-arrays/"/>
    <id>https://swift.gg/2018/12/24/fixed-sized-arrays/</id>
    <published>2018-12-24T00:00:00.000Z</published>
    <updated>2019-08-14T12:15:52.096Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ä½œè€…ï¼šRuss Bishopï¼Œ<a href="http://www.russbishop.net/fixed-sized-arrays" target="_blank" rel="noopener">åŸæ–‡é“¾æ¥</a>ï¼ŒåŸæ–‡æ—¥æœŸï¼š2018-10-30<br>è¯‘è€…ï¼š<a href="https://github.com/zhongWJ" target="_blank" rel="noopener">zhongWJ</a>ï¼›æ ¡å¯¹ï¼š<a href="http://numbbbbb.com/" target="_blank" rel="noopener">numbbbbb</a>ï¼Œ<a href="https://github.com/Cee" target="_blank" rel="noopener">Cee</a>ï¼›å®šç¨¿ï¼š<a href="http://forelax.space" target="_blank" rel="noopener">Forelax</a></p></blockquote><!--æ­¤å¤„å¼€å§‹æ­£æ–‡--><p>å‡è®¾æˆ‘ä»¬æƒ³è¦ç”¨ <code>statfs()</code> æ–¹æ³•æ¥ç¡®å®šæŸä¸ªæŒ‚è½½ç‚¹æ‰€å¯¹åº”çš„ <code>BSD</code> è®¾å¤‡åã€‚ä¾‹å¦‚æŒ‚è½½ç‚¹ <code>/Volumes/MyDisk</code> å¯¹åº”çš„ <code>BSD</code> è®¾å¤‡æ˜¯ <code>/dev/disk6s2</code>ã€‚</p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">statfs</span> <span class="title">fsinfo</span>;</span></span><br><span class="line"><span class="keyword">if</span> (statfs(path, &amp;fsinfo) != <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="comment">//é”™è¯¯</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><a id="more"></a><p>åŒç­‰çš„ Swift ä»£ç å¦‚ä¸‹ï¼Œåªä¸è¿‡å¤šäº†ä¸ª <code>POSIX</code> é”™è¯¯å¸®åŠ©æ–¹æ³•ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">posix_expects_zero</span>&lt;R: BinaryInteger&gt;<span class="params">(<span class="number">_</span> f: @autoclosure <span class="params">()</span></span></span> <span class="keyword">throws</span> -&gt; <span class="type">R</span>) <span class="keyword">throws</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> returncode = <span class="keyword">try</span> f()</span><br><span class="line">    <span class="keyword">if</span> returncode != <span class="number">0</span> &#123;</span><br><span class="line">        <span class="comment">// å¦‚æœéœ€è¦ï¼Œè¯·åœ¨æ­¤å¤„æ›¿æ¢ä¸ºè‡ªå®šä¹‰çš„é”™è¯¯ç±»å‹ã€‚</span></span><br><span class="line">        <span class="comment">// NSError ä¼šè‡ªåŠ¨å¸®æˆ‘ä»¬é€šè¿‡é”™è¯¯ç å¾—åˆ°å¯¹åº”çš„ C å­—ç¬¦ä¸²é”™è¯¯æ¶ˆæ¯ã€‚</span></span><br><span class="line">        <span class="keyword">throw</span> <span class="type">NSError</span>(</span><br><span class="line">            domain: <span class="type">NSPOSIXErrorDomain</span>,</span><br><span class="line">            code: <span class="built_in">numericCast</span>(returncode),</span><br><span class="line">            userInfo: <span class="literal">nil</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// é‡‡ç”¨é»˜è®¤çš„ç©ºåˆå§‹åŒ–æ–¹æ³•ã€‚Swift èƒ½æ¨æ–­å‡ºç»“æ„ä½“ç±»å‹ï¼Œ</span></span><br><span class="line"><span class="comment">// ä½†ä¸ºäº†è¡¨ç¤ºå¾—æ›´æ¸…æ¥šï¼Œè¿™é‡Œæ˜¾å¼æŒ‡å®šç±»å‹</span></span><br><span class="line"><span class="keyword">var</span> fsinfo: statfs = statfs()</span><br><span class="line">statfs(path, &amp;fsinfo)</span><br></pre></td></tr></table></figure><h2 id="C-çš„å¼•å…¥ç‰©"><a href="#C-çš„å¼•å…¥ç‰©" class="headerlink" title="C çš„å¼•å…¥ç‰©"></a>C çš„å¼•å…¥ç‰©</h2><p><code>statfs()</code> å‡½æ•°åœ¨ C è¯­è¨€çš„å®šä¹‰æ˜¯ <code>int statfs(const char *path, struct statfs *info)</code>ã€‚<code>statfs</code> ç»“æ„ä½“æœ‰å¤šä¸ªå­—æ®µï¼Œä½†æˆ‘ä»¬åªå…³æ³¨ <code>mount-from-name</code>ï¼š</p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">statfs</span> &#123;</span></span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">    <span class="keyword">char</span> f_mntfromname[MAXPATHLEN];</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>åœ¨è‹¹æœå¹³å°ä¸Š MAXPATHLEN == PATH_MAX == 1024ã€‚</p><p>å¦‚æœä½ åœ¨ä»£ç é‡Œç¡¬ç¼–ç  1024 è€Œä¸æ˜¯ç”¨æ›´åˆé€‚çš„å®ï¼Œå°å¿ƒæˆ‘çš„é¬¼é­‚ä¼šç¼ ç€ä½ å’Œä½ çš„å®¶æ—åäºŒä»£å“¦ã€‚</p></blockquote><p>å™¢å“¦ã€‚ä¸€ä¸ªå›ºå®šå¤§å°çš„æ•°ç»„ã€‚å½“è¢«å¼•å…¥ Swift ä¸­æ—¶ï¼Œå®ƒä¼šè¢«å½“åšä¸€ä¸ªæœ‰ 1024 ä¸ªå…ƒç´ çš„å…ƒç»„ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">var</span> f_mntfromname: (<span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>, <span class="type">Int8</span>)</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªç±»å‹ä¸æ˜¯å¾ˆå®ç”¨ã€‚é‚£æˆ‘ä»¬èƒ½ä¸èƒ½åšç‚¹ä»€ä¹ˆå‘¢ï¼Ÿç”±äºè¿™ç¯‡åšå®¢çš„å­˜åœ¨ï¼Œä½ å¯èƒ½å·²ç»çŒœåˆ°ç­”æ¡ˆæ˜¯ã€Œ<em>æ˜¯</em>ã€ã€‚</p><h2 id="C-å­—ç¬¦ä¸²"><a href="#C-å­—ç¬¦ä¸²" class="headerlink" title="C å­—ç¬¦ä¸²"></a>C å­—ç¬¦ä¸²</h2><p>è¿™ä¸ªå›ºå®šå¤§å°çš„æ•°ç»„åŒ…å«äº† <code>char</code>ã€‚ç”±äºæ–‡æ¡£æœªæ›¾æåŠï¼Œæ‰€ä»¥æˆ‘ä»¬å¹¶ä¸çŸ¥é“æ˜¯å¦é€šè¿‡ç©ºå­—ç¬¦æ¥è¡¨ç¤ºæ•°ç»„çš„ç»ˆæ­¢ã€‚ä»¤äººæ¼ç«çš„æ˜¯ï¼Œæ–‡æ¡£æš—ç¤ºåœ¨ 64 ä½ç³»ç»Ÿä¸Šï¼Œ<code>f_fstypename</code> å­—æ®µæ˜¯ç”±ç©ºå­—ç¬¦ç»ˆæ­¢ï¼Œä½†å¯¹äº mount to/from ä¸¤ä¸ªå­—æ®µå´åªå­—æœªæã€‚è¿™ä¸¤ä¸ªå­—æ®µæ˜¯æ ¹æ®è¢«å®šä¹‰ä¸º <code>PATH_MAX</code> çš„ <code>MAXPATHLEN</code> å®æ¥å®šä¹‰çš„è€Œä¸æ˜¯ç›´æ¥æ ¹æ® <code>PATH_MAX</code> å®ï¼Œè€Œ <code>PATH_MAX</code> å®é€šå¸¸æš—ç¤ºæ•°ç»„ç”±ç©ºå­—ç¬¦æ¥è¡¨ç¤ºç»ˆæ­¢ã€‚æˆ‘ä»¬æ˜¯ä¸æ˜¯åº”è¯¥ä»ä¸­å¾—åˆ°ä¸€ç‚¹å¯å‘å‘¢ï¼Ÿ</p><p>å¯¹äºå›ºå®šå¤§å°çš„æ•°ç»„ï¼Œæœ‰ä¸€äº› C API ä»ç„¶é‡‡ç”¨ç©ºç»ˆæ­¢ç¬¦ï¼ˆæ‰€ä»¥çœŸå®çš„å­—ç¬¦ä¸²é•¿åº¦æœ€é•¿å¯ä»¥æ˜¯ <code>sizeof(array) - 1</code>ï¼‰ï¼Œè€Œå¦ä¸€äº›åˆ™ä¹æ„å¡«å……æ•´ä¸ªç¼“å†²åŒºï¼ˆæ‰€ä»¥ä¸ä»¥ç©ºå­—ç¬¦ç»“å°¾çš„å­—ç¬¦ä¸²é•¿åº¦æœ€é•¿å¯ä»¥æ˜¯ <code>sizeof(array)</code>ï¼‰ã€‚è¿™å°±æ˜¯é‚£ç§æœ‰å®³çš„ç»Šè„šçŸ³ï¼Œå®ƒè®©ä½ çš„ç¨‹åºçœ‹èµ·æ¥è¿è¡Œæ­£å¸¸å¹¶é€šè¿‡æ‰€æœ‰æµ‹è¯•ï¼Œç„¶åç¢°åˆ°æŸäº›æ–°çš„ FizzyWizz ç¡¬ç›˜ç³»ç»Ÿä¼šæœ‰çš„å¥‡æ€ªçš„è¾¹ç•Œæƒ…å†µæ—¶ï¼Œå½“çªç„¶ç¢°åˆ°ä¸€ä¸ªåˆšå¥½ç”± 1024 ä¸ªå­—ç¬¦ç»„æˆçš„åç§°ç‰¹åˆ«é•¿çš„ BSD è®¾å¤‡æ—¶ï¼Œç»“æœå°±æ˜¯ä½ çš„ç¨‹åºå‡ºç°äº†ã€Œ<em>å¯åˆ©ç”¨å†…å­˜æŸå</em>ã€é”™è¯¯ã€‚</p><p>è¿™äº›å€¼å¾ˆæœ‰å¯èƒ½æ˜¯ç©ºå­—ç¬¦ç»ˆæ­¢çš„ï¼ˆä¹Ÿå¯èƒ½ä¸æ˜¯ï¼‰ï¼Œä½†æˆ‘ä¼šå‘Šè¯‰ä½ å¦‚ä½•æ¥å¤„ç†è¿™ä¸ªé—®é¢˜ï¼Œä»¥ä¾¿åœ¨ä¸¤ç§æƒ…å†µä¸‹éƒ½é€‚ç”¨ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬å†ä¹Ÿä¸éœ€è¦è€ƒè™‘è¿™ä¸ªé—®é¢˜ï¼Œä»è€Œé™ä½å¤§è„‘è´Ÿè·ã€‚åœ¨å…¶ä»–åœºæ™¯å¤ç”¨è¿™ä¸ªä»£ç çš„äººä¹Ÿä¸éœ€è¦å†è€ƒè™‘è¿™ä¸ªé—®é¢˜äº†ã€‚æ—¢ç„¶æœ‰è¿™ä¹ˆå¤§çš„å¥½å¤„ï¼Œä½•ä¸é©¬ä¸Šå¼€å§‹ï¼Ÿ</p><p>åé¢˜äº†ï¼Œè®©æˆ‘ä»¬å›åˆ°æ­£é¢˜â€¦â€¦</p><h2 id="éƒ¨åˆ†è§£å†³æ–¹æ¡ˆ"><a href="#éƒ¨åˆ†è§£å†³æ–¹æ¡ˆ" class="headerlink" title="éƒ¨åˆ†è§£å†³æ–¹æ¡ˆ"></a>éƒ¨åˆ†è§£å†³æ–¹æ¡ˆ</h2><p>é¦–å…ˆæˆ‘ä»¬éœ€è¦è®¡ç®—å­—æ®µçš„åç§»é‡ã€‚ç”¨æ–°çš„ <code>MemoryLayout.offset</code> æ–¹æ³•å¯ä»¥å¾—åˆ°ç»“æœï¼š<code>MemoryLayout&lt;statfs&gt;.offset(of: \Darwin.statfs.f_mntfromname)!</code>ã€‚ç”±äºç»“æ„ä½“å’Œå‡½æ•°åå­—ç›¸åŒï¼Œå½“æˆ‘ä»¬æ„é€ å…³é”®è·¯å¾„æ—¶ï¼Œéœ€è¦æä¾›å®Œæ•´çš„è·¯å¾„åï¼ˆfully-qualified nameï¼‰ï¼Œå¦åˆ™ä¼šå¾—åˆ°ã€Œ<em>æ— æ³•ç¡®å®šæœ‰æ­§ä¹‰çš„å¼•ç”¨è·¯å¾„</em>ã€çš„é”™è¯¯ã€‚æˆ‘ä»¬å¯ä»¥å¼ºåˆ¶è§£åŒ…è¿”å›å€¼å› ä¸ºæˆ‘ä»¬çŸ¥é“å…³é”®è·¯å¾„æœ‰æ•ˆå¹¶ä¸”å­—æ®µæœ‰åç§»é‡ã€‚</p><p>å°†å­—æ®µçš„å†…å­˜å¸ƒå±€åç§»é‡åŠ ä¸Š <code>withUnsafePointer</code> æŒ‡é’ˆå°±å¯ä»¥å¾—åˆ°ä¸€ä¸ªæŒ‡å‘ç»“æ„ä½“å­—æ®µèµ·å§‹å†…å­˜çš„æŒ‡é’ˆã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™ç§æ–¹å¼åˆ›å»ºä¸€ä¸ªå­—ç¬¦ä¸²å¯¹è±¡ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">return</span> <span class="built_in">withUnsafePointer</span>(to: fsinfo, &#123; (ptr) -&gt; <span class="type">String?</span> <span class="keyword">in</span></span><br><span class="line">    <span class="keyword">let</span> offset = <span class="type">MemoryLayout</span>&lt;statfs&gt;.offset(of: \<span class="type">Darwin</span>.statfs.f_mntfromname)!</span><br><span class="line">    <span class="keyword">let</span> fieldPtr = (<span class="type">UnsafeRawPointer</span>(ptr) + offset).assumingMemoryBound(to: <span class="type">UInt8</span>.<span class="keyword">self</span>)</span><br><span class="line">    <span class="keyword">if</span> fieldPtr[<span class="built_in">count</span> - <span class="number">1</span>] != <span class="number">0</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> data = <span class="type">Data</span>(bytes: <span class="type">UnsafeRawPointer</span>(fieldPtr), <span class="built_in">count</span>: <span class="built_in">count</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="type">String</span>(data: data, encoding: .utf8)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="type">String</span>(cString: fieldPtr)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬é¦–å…ˆå¿«é€Ÿæ£€æŸ¥äº†ç¼“å†²åŒºæ˜¯å¦æ˜¯ç©ºå­—ç¬¦ç»“å°¾ã€‚å¦‚æœæ˜¯ï¼Œå°±é‡‡ç”¨ C å­—ç¬¦ä¸²è¿™æ¡æ·å¾„ã€‚åä¹‹ï¼Œä¸ºäº†ä¾¿äºä½¿ç”¨ String çš„é•¿åº¦é™åˆ¶æ„é€ æ–¹æ³•ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª Data å®ä¾‹ã€‚çœ‹èµ·æ¥ç”¨ <code>Data(bytesNoCopy:count:deallocator:)</code> ä¹Ÿè¡Œï¼Œä½† <code>String(data:encoding:)</code> åˆå§‹åŒ–æ–¹æ³•å¹¶ä¸ä¿è¯æ‹·è´ Data åº•å±‚çš„ç¼“å†²åŒºï¼Œ<code>Data</code> çš„æ„é€ è¿‡ç¨‹ä¹ŸåŒæ ·å¦‚æ­¤ã€‚è™½ç„¶è¿™ç§æƒ…å†µæå°‘è§ï¼Œæˆ‘ä»¬è¿˜æ˜¯è°¨æ…ä¸ºå¥½ã€‚ï¼ˆå‡å¦‚ç›®å‰çš„æ–¹æ³•ä¼šå¯¼è‡´æ€§èƒ½é—®é¢˜ï¼Œæˆ‘å¯èƒ½ä¼šèŠ±æ—¶é—´è°ƒç ”å…¶ä»–æ–¹æ¡ˆã€‚ï¼‰</p><p>æœ‰ä¸€ç§å¯èƒ½æƒ…å†µæ˜¯ï¼Œå…ˆå†™å…¥ç”±ç©ºå­—ç¬¦ç»ˆæ­¢çš„è¾ƒçŸ­çš„å­—ç¬¦ä¸²åˆ°ç¼“å†²åŒºï¼Œå‰©ä½™çš„éƒ¨åˆ†åˆ™æ˜¯è¢«åƒåœ¾æ•°æ®å¡«å……ã€‚ç”±äº Swift åœ¨åˆå§‹åŒ–ç»“æ„ä½“æ—¶ä¼šå¼ºåˆ¶æ¸…é™¤å†…å­˜ï¼Œæ‰€ä»¥åªæœ‰å½“å†…æ ¸æ‹·è´åƒåœ¾æ•°æ®åˆ°è¿™å—åœ°å€æ—¶ï¼Œä¸Šè¿°æƒ…å†µæ‰å¯èƒ½å‘ç”Ÿã€‚æˆ‘ä»¬å¯ä»¥å¿½ç•¥è¿™ç§æƒ…å†µï¼Œå› ä¸ºå†…æ ¸ä¼šå°½é‡é¿å…æ³„æ¼å†…æ ¸å†…å­˜åˆ°ç”¨æˆ·ç©ºé—´ï¼Œå¦åˆ™æˆ‘ä»¬å°±åªèƒ½ç”¨æ›´è€—æ—¶çš„æ–¹å¼äº†ã€‚ï¼ˆå°†è¿™äº›å­—èŠ‚è½¬æ¢ä¸ºå­—ç¬¦ä¸²çš„æ–¹å¼æ•°ä¸èƒœæ•°ï¼Œæˆ‘è¿™é‡Œå°±ä¸ä¸€ä¸€åˆ—ä¸¾äº†ã€‚ï¼‰</p><p>ç°åœ¨æˆ‘ä»¬æ¥å®ç° <code>statfs</code> çš„æ‰©å±•ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">statfs</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> mntfromname: <span class="type">String?</span> &#123;</span><br><span class="line">        <span class="keyword">mutating</span> <span class="keyword">get</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">withUnsafePointer</span>(to: fsinfo, &#123; (ptr) -&gt; <span class="type">String?</span> <span class="keyword">in</span></span><br><span class="line">                <span class="keyword">let</span> offset = <span class="type">MemoryLayout</span>&lt;statfs&gt;.offset(of: \<span class="type">Darwin</span>.statfs.f_mntfromname)!</span><br><span class="line">                <span class="keyword">let</span> fieldPtr = (<span class="type">UnsafeRawPointer</span>(ptr) + offset).assumingMemoryBound(to: <span class="type">UInt8</span>.<span class="keyword">self</span>)</span><br><span class="line">                <span class="keyword">let</span> <span class="built_in">count</span> = <span class="type">Int</span>(<span class="type">MAXPATHLEN</span>)</span><br><span class="line">                <span class="keyword">if</span> fieldPtr[<span class="built_in">count</span> - <span class="number">1</span>] != <span class="number">0</span> &#123;</span><br><span class="line">                    <span class="keyword">let</span> data = <span class="type">Data</span>(bytes: <span class="type">UnsafeRawPointer</span>(fieldPtr), <span class="built_in">count</span>: <span class="built_in">count</span>)</span><br><span class="line">                    <span class="keyword">return</span> <span class="type">String</span>(data: data, encoding: .utf8)</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="type">String</span>(cString: fieldPtr)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ®µä»£ç å¾ˆç®¡ç”¨ï¼Œä½†å‡å¦‚æˆ‘ä»¬ä¹Ÿæƒ³å¤„ç†åˆ«çš„å­—æ®µï¼Œä¾‹å¦‚ <code>f_mntoname</code> å‘¢ï¼Ÿå¤åˆ¶ä»£ç ä¼¼ä¹ä¸æ€ä¹ˆå¥½ï¼Œæ‰€ä»¥è®©è¿™æ®µä»£ç æ”¯æŒæ³›å‹ï¼Œä½¿ä¹‹æ›´åŠ é€šç”¨æ‰å¯¹ï¼›æˆ‘ä»¬åªéœ€è¦æ¥å— key path å’Œ count ä½œä¸ºå‚æ•°ï¼Œå†ç¨ä½œä¿®æ”¹å°±å¯ä»¥äº†ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">fixedArrayToString</span>&lt;T&gt;<span class="params">(t: T, keyPath: PartialKeyPath&lt;T&gt;, <span class="built_in">count</span>: Int)</span></span> -&gt; <span class="type">String?</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">withUnsafePointer</span>(to: t) &#123; (ptr) -&gt; <span class="type">String?</span> <span class="keyword">in</span></span><br><span class="line">        <span class="keyword">let</span> offset = <span class="type">MemoryLayout</span>&lt;<span class="type">T</span>&gt;.offset(of: keyPath)!</span><br><span class="line">        <span class="keyword">let</span> fieldPtr = (<span class="type">UnsafeRawPointer</span>(ptr) + offset).assumingMemoryBound(to: <span class="type">UInt8</span>.<span class="keyword">self</span>)</span><br><span class="line">        <span class="keyword">if</span> fieldPtr[<span class="built_in">count</span> - <span class="number">1</span>] != <span class="number">0</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> data = <span class="type">Data</span>(bytes: <span class="type">UnsafeRawPointer</span>(fieldPtr), <span class="built_in">count</span>: <span class="built_in">count</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="type">String</span>(data: data, encoding: .utf8)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="type">String</span>(cString: fieldPtr)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">statfs</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> mntfromname: <span class="type">String?</span> &#123;</span><br><span class="line">        <span class="keyword">get</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> fixedArrayToString(</span><br><span class="line">                t: <span class="keyword">self</span>,</span><br><span class="line">                keyPath: \<span class="type">Darwin</span>.statfs.f_mntfromname,</span><br><span class="line">                <span class="built_in">count</span>: <span class="type">Int</span>(<span class="type">MAXPATHLEN</span>))</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> mntonname: <span class="type">String?</span> &#123;</span><br><span class="line">        <span class="keyword">get</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> fixedArrayToString(</span><br><span class="line">                t: <span class="keyword">self</span>,</span><br><span class="line">                keyPath: \<span class="type">Darwin</span>.statfs.f_mntonname,</span><br><span class="line">                <span class="built_in">count</span>: <span class="type">Int</span>(<span class="type">MAXPATHLEN</span>))</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ç»“è¯­"><a href="#ç»“è¯­" class="headerlink" title="ç»“è¯­"></a>ç»“è¯­</h2><p>ç°åœ¨ä½ çŸ¥é“æ€ä¹ˆæŠŠæœ‰ N ä¸ªå…ƒç´ çš„å…ƒç»„å˜æˆæ›´å®ç”¨çš„ä¸œè¥¿äº†å§ã€‚</p><blockquote><p>æœ¬æ–‡ç”± SwiftGG ç¿»è¯‘ç»„ç¿»è¯‘ï¼Œå·²ç»è·å¾—ä½œè€…ç¿»è¯‘æˆæƒï¼Œæœ€æ–°æ–‡ç« è¯·è®¿é—® <a href="http://swift.gg">http://swift.gg</a>ã€‚</p></blockquote>]]></content>
    
    <summary type="html">
    
      å¦‚ä½•åœ¨ Swift ä¸­å¤„ç†ä» C è¯­è¨€å¼•å…¥çš„å›ºå®šå¤§å°æ•°ç»„
    
    </summary>
    
      <category term="Swift" scheme="https://swift.gg/categories/Swift/"/>
    
    
      <category term="Swift" scheme="https://swift.gg/tags/Swift/"/>
    
  </entry>
  
  <entry>
    <title>Swift å±æ€§è§‚å¯Ÿå™¨</title>
    <link href="https://swift.gg/2018/12/17/swift-property-observers/"/>
    <id>https://swift.gg/2018/12/17/swift-property-observers/</id>
    <published>2018-12-17T00:00:00.000Z</published>
    <updated>2019-08-14T12:15:52.096Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ä½œè€…ï¼šMatttï¼Œ<a href="https://nshipster.com/swift-property-observers/" target="_blank" rel="noopener">åŸæ–‡é“¾æ¥</a>ï¼ŒåŸæ–‡æ—¥æœŸï¼š2018-08-20<br>è¯‘è€…ï¼š<a href="http://wuqiuhao.github.io" target="_blank" rel="noopener">Hale</a>ï¼›æ ¡å¯¹ï¼š<a href="http://numbbbbb.com/" target="_blank" rel="noopener">numbbbbb</a>ï¼Œ<a href="http://www.jianshu.com/users/596f2ba91ce9/latest_articles" target="_blank" rel="noopener">pmst</a>ï¼Œ<a href="http://blog.yousanflics.com.cn" target="_blank" rel="noopener">Yousanflics</a>ï¼›å®šç¨¿ï¼š<a href="http://forelax.space" target="_blank" rel="noopener">Forelax</a></p></blockquote><!--æ­¤å¤„å¼€å§‹æ­£æ–‡--><p>åˆ°äº† 20 ä¸–çºª 30 å¹´ä»£ï¼ŒRube Goldberg å·²æˆä¸ºå®¶å–»æˆ·æ™“çš„åå­—ï¼Œä¸ <a href="https://upload.wikimedia.org/wikipedia/commons/a/a9/Rube_Goldberg%27s_%22Self-Operating_Napkin%22_%28cropped%29.gif" target="_blank" rel="noopener">â€œè‡ªè¥é¤å·¾â€</a> ç­‰æ¼«ç”»ä¸­æç»˜çš„å¥‡å¼‚å¤æ‚å’Œå¼‚æƒ³å¤©å¼€çš„å‘æ˜åŒä¹‰ã€‚å¤§çº¦åœ¨åŒä¸€æ—¶æœŸï¼Œé˜¿å°”ä¼¯ç‰¹Â·çˆ±å› æ–¯å¦å¯¹å°¼å°”æ–¯Â·ç»å°”é‡å­åŠ›å­¦çš„æ™®éè§£é‡Šè¿›è¡Œäº† <a href="https://en.wikipedia.org/wiki/EPR_paradox" target="_blank" rel="noopener">æ‰¹åˆ¤</a>ï¼Œå¹¶ä»ä¸­æå‡ºäº†â€œé¬¼é­…ä¼¼çš„è¿œè·ä½œç”¨â€è¿™ä¸€è¯æ±‡ã€‚</p><p>è¿‘ä¸€ä¸ªä¸–çºªä¹‹åï¼Œç°ä»£è½¯ä»¶å¼€å‘å·²ç»è¢«è§†ä¸ºå¯èƒ½æˆä¸º Goldbergian è£…ç½®çš„å…¸èŒƒâ€”â€”é€šè¿‡é‡å­è®¡ç®—æœºç›¸ä¿¡æˆ‘ä»¬ä¼šè¶Šæ¥è¶Šæ¥è¿‘è¿™ä¸ªé¬¼é­…çš„é¢†åŸŸã€‚</p><p>ä½œä¸ºè½¯ä»¶å¼€å‘äººå‘˜ï¼Œæˆ‘ä»¬æå€¡å°½å¯èƒ½å‡å°‘ä»£ç ä¸­çš„è¿œç¨‹æ“ä½œã€‚è¿™æ˜¯æ ¹æ®ä¸€äº›ä¼—æ‰€å‘¨çŸ¥çš„è§„èŒƒæ³•åˆ™å¾—å‡ºçš„ï¼Œå¦‚ <a href="https://en.wikipedia.org/wiki/Single_responsibility_principle" target="_blank" rel="noopener">å•ä¸€èŒè´£åŸåˆ™</a>ã€<a href="https://en.wikipedia.org/wiki/Principle_of_least_astonishment" target="_blank" rel="noopener">æœ€å°‘æ„å¤–åŸåˆ™</a> å’Œ <a href="https://en.wikipedia.org/wiki/Law_of_Demeter" target="_blank" rel="noopener">ç¬›ç±³ç‰¹æ³•åˆ™</a>ã€‚å°½ç®¡å®ƒä»¬å¯èƒ½ä¼šå¯¹ä»£ç äº§ç”Ÿä¸€å®šçš„å‰¯ä½œç”¨ï¼Œä½†æ›´å¤šçš„æ—¶å€™è¿™äº›åŸåˆ™èƒ½ä½¿ä»£ç é€»è¾‘å˜å¾—æ¸…æ™°ã€‚</p><p>è¿™æ˜¯æœ¬å‘¨å…³äº Swift å±æ€§è§‚å¯Ÿæ–‡ç« çš„ç„¦ç‚¹ï¼Œå®ƒæå‡ºäº†ä¸€ç§å†…ç½®çš„è½»é‡çº§æ›¿ä»£æ–¹æ¡ˆï¼Œé€‚ç”¨äºæ›´æ­£å¼çš„è§£å†³æ–¹æ¡ˆï¼Œå¦‚æ¨¡å‹ - è§†å›¾ - è§†å›¾æ¨¡å‹ï¼ˆMVVMï¼‰å‡½æ•°å“åº”å¼ç¼–ç¨‹ï¼ˆFRPï¼‰ã€‚</p><a id="more"></a><p>Swift ä¸­æœ‰ä¸¤ç§å±æ€§ï¼š<em>å­˜å‚¨å±æ€§</em>ï¼Œå®ƒä»¬å°†çŠ¶æ€å’Œå¯¹è±¡ç›¸å…³è”ï¼›<em>è®¡ç®—å±æ€§</em>ï¼Œåˆ™æ ¹æ®è¯¥çŠ¶æ€æ‰§è¡Œè®¡ç®—ã€‚ä¾‹å¦‚ï¼Œ</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">S</span> </span>&#123;</span><br><span class="line">    <span class="comment">// å­˜å‚¨å±æ€§</span></span><br><span class="line">    <span class="keyword">var</span> stored: <span class="type">String</span> = <span class="string">"stored"</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// è®¡ç®—å±æ€§</span></span><br><span class="line">    <span class="keyword">var</span> computed: <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"computed"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“ä½ å£°æ˜ä¸€ä¸ªå­˜å‚¨å±æ€§ï¼Œä½ å¯ä»¥ä½¿ç”¨é—­åŒ…å®šä¹‰ä¸€ä¸ª <em>å±æ€§è§‚å¯Ÿå™¨</em>ï¼Œè¯¥é—­åŒ…ä¸­çš„ä»£ç ä¼šåœ¨å±æ€§è¢«è®¾å€¼çš„æ—¶å€™æ‰§è¡Œã€‚<code>willSet</code> è§‚å¯Ÿå™¨ä¼šåœ¨å±æ€§è¢«èµ‹æ–°å€¼ä¹‹å‰è¢«è¿è¡Œï¼Œ<code>didSet</code> è§‚å¯Ÿå™¨åˆ™ä¼šåœ¨å±æ€§è¢«èµ‹æ–°å€¼ä¹‹åè¿è¡Œã€‚æ— è®ºæ–°å€¼æ˜¯å¦ç­‰äºå±æ€§çš„æ—§å€¼å®ƒä»¬éƒ½ä¼šè¢«æ‰§è¡Œã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">S</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> stored: <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">willSet</span> &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"willSet was called"</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"stored is now equal to \(self.stored)"</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"stored will be set to \(newValue)"</span>)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">didSet</span> &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"didSet was called"</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"stored is now equal to \(self.stored)"</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"stored was previously set to \(oldValue)"</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¾‹å¦‚ï¼Œè¿è¡Œä¸‹é¢çš„ä»£ç åœ¨æ§åˆ¶å°çš„è¾“å‡ºå¦‚ä¸‹ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> s = <span class="type">S</span>(stored: <span class="string">"first"</span>)</span><br><span class="line">s.stored = <span class="string">"second"</span></span><br></pre></td></tr></table></figure><ul><li>willSet was called</li><li>stored is now equal to first</li><li>stored will be set to second</li><li>didSet was called</li><li>stored is now equal to second</li><li>stored was previously set to first</li></ul><blockquote><p>éœ€è¦æ³¨æ„çš„æ˜¯å½“å±æ€§åœ¨åˆå§‹åŒ–æ–¹æ³•ä¸­è¿›è¡Œèµ‹å€¼æ—¶ï¼Œä¸ä¼šè§¦å‘è§‚å¯Ÿå™¨çš„ä»£ç ã€‚ä» Swift4.2 å¼€å§‹ï¼Œä½ å¯ä»¥å°†èµ‹å€¼é€»è¾‘åŒ…è£…åœ¨ <code>defer</code> ä»£ç å—æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä½†è¿™æ˜¯ <a href="https://twitter.com/jckarter/status/926459181661536256" target="_blank" rel="noopener">ä¸€ä¸ªå¾ˆå¿«å°±ä¼šè¢«ä¿®å¤çš„é—®é¢˜</a>ï¼Œå› æ­¤ä½ ä¸éœ€è¦ä¾èµ–äºè¿™ç§è¡Œä¸ºã€‚</p></blockquote><p>Swift çš„å±æ€§è§‚å¯Ÿå™¨ä»ä¸€å¼€å§‹å°±æ˜¯è¯­è¨€çš„ä¸€éƒ¨åˆ†ã€‚ä¸ºäº†æ›´å¥½åœ°ç†è§£å…¶åŸç†ï¼Œè®©æˆ‘ä»¬å¿«é€Ÿäº†è§£ä¸€ä¸‹å®ƒåœ¨ Objective-C ä¸­çš„å·¥ä½œåŸç†ã€‚</p><h1 id="Objective-C-ä¸­çš„å±æ€§"><a href="#Objective-C-ä¸­çš„å±æ€§" class="headerlink" title="Objective-C ä¸­çš„å±æ€§"></a>Objective-C ä¸­çš„å±æ€§</h1><p>ä»æŸç§æ„ä¹‰ä¸Šè¯´ï¼ŒObjective-C ä¸­çš„æ‰€æœ‰å±æ€§éƒ½æ˜¯è¢«è®¡ç®—å‡ºæ¥çš„ã€‚æ¯æ¬¡é€šè¿‡ç‚¹è¯­æ³•è®¿é—®å±æ€§æ—¶ï¼Œéƒ½ä¼šè½¬æ¢ä¸ºç­‰æ•ˆçš„ getter æˆ– setter æ–¹æ³•è°ƒç”¨ã€‚è¿™äº›è°ƒç”¨æœ€ç»ˆè¢«ç¼–è¯‘æˆæ¶ˆæ¯å‘é€ï¼Œéšåå†æ‰§è¡Œè¯»å–æˆ–å†™å…¥å®ä¾‹å˜é‡çš„æ–¹æ³•ã€‚</p><figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ç‚¹è¯­æ³•è®¿é—®</span></span><br><span class="line">person.name = <span class="string">@"Johnny"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ...ç­‰ä»·äº</span></span><br><span class="line">[person setName:<span class="string">@"Johnny"</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// ...å®ƒè¢«ç¼–è¯‘æˆ</span></span><br><span class="line">objc_msgSend(person, <span class="keyword">@selector</span>(setName:), <span class="string">@"Johnny"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ...æœ€ç»ˆå®ç°</span></span><br><span class="line">person-&gt;_name = <span class="string">@"Johnny"</span>;</span><br></pre></td></tr></table></figure><p>ç¼–ç¨‹è¿‡ç¨‹ä¸­æˆ‘ä»¬é€šå¸¸æƒ³è¦é¿å…å¼•å…¥å‰¯ä½œç”¨ï¼Œå› ä¸ºå®ƒä¼šå¯¼è‡´éš¾ä»¥æ¨æ–­ç¨‹åºçš„è¡Œä¸ºã€‚ä½†å¾ˆå¤š Objective-C å¼€å‘è€…å·²ç»ä¾èµ–äºè¿™ç§ç‰¹æ€§ï¼Œä»–ä»¬ä¼šæ ¹æ®éœ€è¦åœ¨ getter æˆ– setter ä¸­æ³¨å…¥å„ç§é¢å¤–çš„è¡Œä¸ºã€‚</p><p>Swift çš„å±æ€§è®¾è®¡ä½¿è¿™äº›æ¨¡å¼æ›´åŠ æ ‡å‡†åŒ–ï¼Œå¹¶å¯¹è£…é¥°çŠ¶æ€è®¿é—®ï¼ˆå­˜å‚¨å±æ€§ï¼‰çš„å‰¯ä½œç”¨å’Œé‡å®šå‘çŠ¶æ€è®¿é—®ï¼ˆè®¡ç®—å±æ€§ï¼‰çš„å‰¯ä½œç”¨è¿›è¡Œäº†åŒºåˆ†ã€‚å¯¹äºå­˜å‚¨å±æ€§ï¼Œ<code>willSet</code> å’Œ <code>didSet</code> è§‚å¯Ÿå™¨å°†æ›¿æ¢ä½ åœ¨ ivar è®¿é—®æ—¶çš„ä»£ç ã€‚å¯¹äºè®¡ç®—å±æ€§ï¼Œ<code>get</code> å’Œ <code>set</code> è®¿é—®å™¨å¯èƒ½ä¼šæ›¿æ¢åœ¨ Objective-C ä¸­å®ç°çš„ä¸€äº› <code>@dynamic</code> å±æ€§ã€‚</p><p>æ­£å› ä¸ºå¦‚æ­¤ï¼Œæˆ‘ä»¬æ‰å¯ä»¥è·å–æ›´ä¸€è‡´çš„è¯­ä¹‰ï¼Œå¹¶æ›´å¥½åœ°ä¿è¯é”®å€¼è§‚å¯Ÿï¼ˆKVOï¼‰å’Œå¥å€¼ç¼–ç ï¼ˆKVCï¼‰ç­‰å±æ€§äº¤äº’æœºåˆ¶ã€‚</p><p>é‚£ä¹ˆä½ å¯ä»¥ä½¿ç”¨ Swift å±æ€§è§‚å¯Ÿå™¨åšäº›ä»€ä¹ˆå‘¢ï¼Ÿä»¥ä¸‹æ˜¯ä¸€äº›ä¾›ä½ å‚è€ƒçš„æƒ³æ³•ï¼š</p><h1 id="æ ‡å‡†åŒ–æˆ–éªŒè¯å€¼"><a href="#æ ‡å‡†åŒ–æˆ–éªŒè¯å€¼" class="headerlink" title="æ ‡å‡†åŒ–æˆ–éªŒè¯å€¼"></a>æ ‡å‡†åŒ–æˆ–éªŒè¯å€¼</h1><p>æœ‰æ—¶ï¼Œä½ å¸Œæœ›å¯¹ç±»å‹ç¡®å®šçš„å€¼å¢åŠ é¢å¤–çš„çº¦æŸã€‚</p><p>ä¾‹å¦‚ï¼Œä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªå’Œæ”¿åºœæœºæ„å¯¹æ¥çš„åº”ç”¨ç¨‹åºï¼Œä½ éœ€è¦ä¿è¯ç”¨æˆ·å¡«å†™äº†æ‰€æœ‰çš„å¿…å¡«é¡¹å¹¶ä¸”ä¸åŒ…å«éæ³•çš„å€¼æ‰èƒ½æäº¤è¡¨å•ã€‚</p><p>å¦‚æœä¸€ä¸ªè¡¨å•è¦æ±‚åç§°å­—æ®µä½¿ç”¨å¤§å†™å­—æ¯ä¸”ä¸ä½¿ç”¨é‡éŸ³ç¬¦å·ï¼Œä½ å¯ä»¥ä½¿ç”¨ <code>didSet</code> å±æ€§è§‚å¯Ÿå™¨è‡ªåŠ¨å»é™¤é‡éŸ³ç¬¦å·å¹¶è½¬åŒ–ä¸ºå¤§å†™ã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> name: <span class="type">String?</span> &#123;</span><br><span class="line">    <span class="keyword">didSet</span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.name = <span class="keyword">self</span>.name?</span><br><span class="line">                        .applyingTransform(.stripDiacritics,</span><br><span class="line">                                            <span class="built_in">reverse</span>: <span class="literal">false</span>)?</span><br><span class="line">                        .uppercased()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¹¸è¿çš„æ˜¯åœ¨è§‚å¯Ÿå™¨å†…éƒ¨è®¾ç½®å±æ€§ä¸ä¼šè§¦å‘é¢å¤–çš„å›è°ƒï¼Œæ‰€ä»¥ä¸Šé¢çš„ä»£ç ä¸­ä¸ä¼šäº§ç”Ÿæ— é™å¾ªç¯ã€‚æˆ‘ä»¬ä¹‹æ‰€ä»¥ä¸ä½¿ç”¨ <code>willSet</code> è§‚å¯Ÿå™¨æ˜¯å› ä¸ºå³ä½¿æˆ‘ä»¬åœ¨å…¶å›è°ƒä¸­è¿›è¡Œä»»ä½•èµ‹å€¼ï¼Œéƒ½ä¼šåœ¨å±æ€§è¢«èµ‹äºˆ <code>newValue</code> æ—¶è¦†ç›–ã€‚</p><p>è™½ç„¶è¿™ç§æ–¹æ³•å¯ä»¥è§£å†³ä¸€æ¬¡æ€§é—®é¢˜ï¼Œä½†åƒè¿™æ ·éœ€è¦é‡å¤ä½¿ç”¨çš„ä¸šåŠ¡é€»è¾‘å¯ä»¥å°è£…åˆ°ä¸€ä¸ªç±»å‹ä¸­ã€‚</p><p>æ›´å¥½çš„è®¾è®¡æ˜¯åˆ›å»ºä¸€ä¸ª <code>NormalizedText</code> ç±»å‹ï¼Œå®ƒå°è£…äº†è¦ä»¥è¿™ç§å½¢å¼è¾“å…¥çš„æ–‡æœ¬çš„è§„åˆ™ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">NormalizedText</span> </span>&#123;</span><br><span class="line">    <span class="class"><span class="keyword">enum</span> <span class="title">Error</span>: <span class="title">Swift</span>.<span class="title">Error</span> </span>&#123;</span><br><span class="line">        <span class="keyword">case</span> empty</span><br><span class="line">        <span class="keyword">case</span> excessiveLength</span><br><span class="line">        <span class="keyword">case</span> unsupportedCharacters</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">let</span> maximumLength = <span class="number">32</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> value: <span class="type">String</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">init</span>(<span class="number">_</span> string: <span class="type">String</span>) <span class="keyword">throws</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> string.isEmpty &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="type">Error</span>.empty</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">guard</span> <span class="keyword">let</span> value = string.applyingTransform(.stripDiacritics,</span><br><span class="line">                                                   <span class="built_in">reverse</span>: <span class="literal">false</span>)?</span><br><span class="line">                                .uppercased(),</span><br><span class="line">              value.canBeConverted(to: .ascii)</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">             <span class="keyword">throw</span> <span class="type">Error</span>.unsupportedCharacters</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">guard</span> value.<span class="built_in">count</span> &lt; <span class="type">NormalizedText</span>.maximumLength <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="type">Error</span>.excessiveLength</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">self</span>.value = value</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸€ä¸ªå¯æŠ›å‡ºå¼‚å¸¸çš„åˆå§‹åŒ–æ–¹æ³•å¯ä»¥å‘è°ƒç”¨è€…å‘é€é”™è¯¯ä¿¡æ¯ï¼Œè¿™æ˜¯ <code>didSet</code> è§‚å¯Ÿå™¨æ— æ³•åšåˆ°çš„ã€‚ç°åœ¨é¢å¯¹ <a href="https://zh.wikipedia.org/wiki/%E5%85%B0%E9%9F%A6%E5%B0%94%E6%99%AE%E5%B0%94%E5%8F%A4%E5%9B%A0%E5%90%89%E5%B0%94%E6%88%88%E6%A0%BC%E9%87%8C%E6%83%A0%E5%B0%94%E6%81%A9%E5%BE%B7%E7%BD%97%E5%B8%83%E5%B0%94%E5%85%B0%E8%92%82%E8%A5%BF%E5%88%A9%E5%A5%A5%E6%88%88%E6%88%88%E6%88%88%E8%B5%AB" target="_blank" rel="noopener">å…°éŸ¦å°”æ™®å°”å¤å› å‰å°”æˆˆæ ¼é‡Œæƒ å°”æ©å¾·ç½—å¸ƒå°”å…°è’‚è¥¿åˆ©å¥¥æˆˆæˆˆæˆˆèµ«</a> çš„ <em>çº¦ç¿°å°¼</em> è¿™æ ·çš„éº»çƒ¦åˆ¶é€ è€…ï¼Œæˆ‘ä»¬èƒ½ä¸ºä»–åšäº›ä»€ä¹ˆï¼ï¼ˆæ¢è¨€ä¹‹ï¼Œä»¥åˆç†çš„æ–¹å¼ä¼ è¾¾é”™è¯¯æ¯”æä¾›æ— æ•ˆçš„æ•°æ®æ›´å¥½ï¼‰</p><h1 id="ä¼ æ’­ä¾èµ–çŠ¶æ€"><a href="#ä¼ æ’­ä¾èµ–çŠ¶æ€" class="headerlink" title="ä¼ æ’­ä¾èµ–çŠ¶æ€"></a>ä¼ æ’­ä¾èµ–çŠ¶æ€</h1><p>å±æ€§è§‚å¯Ÿå™¨çš„å¦ä¸€ä¸ªæ½œåœ¨ç”¨ä¾‹æ˜¯å°†çŠ¶æ€ä¼ æ’­åˆ°ä¾èµ–äºè§†å›¾æ§åˆ¶å™¨çš„ç»„ä»¶ã€‚</p><p>è€ƒè™‘ä¸‹é¢çš„ <code>Track</code> æ¨¡å‹ç¤ºä¾‹å’Œä¸€ä¸ªå‘ˆç°å®ƒçš„ <code>TrackViewController</code>ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Track</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> title: <span class="type">String</span></span><br><span class="line">    <span class="keyword">var</span> audioURL: <span class="type">URL</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TrackViewController</span>: <span class="title">UIViewController</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> player: <span class="type">AVPlayer?</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> track: <span class="type">Track?</span> &#123;</span><br><span class="line">        <span class="keyword">willSet</span> &#123;</span><br><span class="line">            <span class="keyword">self</span>.player?.pause()</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">didSet</span> &#123;</span><br><span class="line">            <span class="keyword">guard</span> <span class="keyword">let</span> track = <span class="keyword">self</span>.track <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">self</span>.title = track.title</span><br><span class="line"></span><br><span class="line">            <span class="keyword">let</span> item = <span class="type">AVPlayerItem</span>(url: track.audioURL)</span><br><span class="line">            <span class="keyword">self</span>.player = <span class="type">AVPlayer</span>(playerItem: item)</span><br><span class="line">            <span class="keyword">self</span>.player?.play()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“è§†å›¾æ§åˆ¶å™¨çš„ <code>track</code> å±æ€§è¢«èµ‹å€¼ï¼Œä»¥ä¸‹äº‹æƒ…ä¼šè‡ªåŠ¨å‘ç”Ÿï¼š</p><ul><li>ä¹‹å‰è½¨é“çš„éŸ³é¢‘éƒ½ä¼šæš‚åœ</li><li>è§†å›¾æ§åˆ¶å™¨çš„ <code>title</code> ä¼šè¢«è®¾ç½®ä¸ºæ–°è½¨é“å¯¹è±¡çš„æ ‡é¢˜</li><li>æ–°è½¨é“å¯¹è±¡çš„éŸ³é¢‘ä¿¡æ¯ä¼šè¢«åŠ è½½å¹¶æ’­æ”¾</li></ul><p>å¾ˆé…·, å¯¹å—?</p><p>ä½ ç”šè‡³å¯ä»¥åƒ <a href="https://www.youtube.com/watch?v=TVAhhVrpkwM" target="_blank" rel="noopener"><em>æ•é¼ è®°</em> ä¸­æç»˜çš„åœºæ™¯</a> ä¸€æ ·ï¼Œå°†è¡Œä¸ºä¸å¤šä¸ªè§‚å¯Ÿå±æ€§çº§è”èµ·æ¥ã€‚</p><p>å½“ç„¶ï¼Œè§‚å¯Ÿå™¨ä¹Ÿå­˜åœ¨ä¸€å®šçš„å‰¯ä½œç”¨ï¼Œå®ƒä½¿å¾—æœ‰äº›å¤æ‚çš„è¡Œä¸ºéš¾ä»¥è¢«æ¨æ–­ï¼Œè¿™æ˜¯æˆ‘ä»¬åœ¨ç¼–ç¨‹ä¸­éœ€è¦é¿å…çš„ã€‚ä»Šååœ¨ä½¿ç”¨è¿™ä¸€ç‰¹æ€§çš„åŒæ—¶ä¹Ÿéœ€è¦æ³¨æ„è¿™ä¸€ç‚¹ã€‚</p><p>ç„¶è€Œï¼Œåœ¨è¿™æ‘‡æ‘‡æ¬²å çš„æŠ½è±¡å¡”çš„é¡¶ç«¯ï¼Œä¸€å®šé™åº¦çš„ç³»ç»Ÿæ··ä¹±æ˜¯è¯±äººçš„ï¼Œæœ‰æ—¶æ˜¯å€¼å¾—çš„ã€‚ä¸€ç›´éµå¾ªè§„åˆ™çš„æ˜¯æ³¢å°”ç†è®ºè€Œéçˆ±å› æ–¯å¦ã€‚</p><blockquote><p>æœ¬æ–‡ç”± SwiftGG ç¿»è¯‘ç»„ç¿»è¯‘ï¼Œå·²ç»è·å¾—ä½œè€…ç¿»è¯‘æˆæƒï¼Œæœ€æ–°æ–‡ç« è¯·è®¿é—® <a href="http://swift.gg">http://swift.gg</a>ã€‚</p></blockquote>]]></content>
    
    <summary type="html">
    
      æœ¬æ–‡ä»‹ç»äº† Swift ä¸­çš„å±æ€§è§‚å¯Ÿå™¨ï¼Œå¹¶ä»‹ç»äº†ä¸€äº›æ¯”è¾ƒå¸¸è§çš„é€‚ç”¨åœºæ™¯ã€‚
    
    </summary>
    
      <category term="Swift" scheme="https://swift.gg/categories/Swift/"/>
    
      <category term="NSHipster" scheme="https://swift.gg/categories/Swift/NSHipster/"/>
    
    
      <category term="Swift" scheme="https://swift.gg/tags/Swift/"/>
    
      <category term="NSHipster" scheme="https://swift.gg/tags/NSHipster/"/>
    
  </entry>
  
  <entry>
    <title>å¸ƒéš†è¿‡æ»¤å™¨ä¸ Swift 4.2</title>
    <link href="https://swift.gg/2018/12/13/bloom-filters/"/>
    <id>https://swift.gg/2018/12/13/bloom-filters/</id>
    <published>2018-12-13T00:00:00.000Z</published>
    <updated>2019-08-14T12:15:52.096Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ä½œè€…ï¼šSoroush Khanlouï¼Œ<a href="http://khanlou.com/2018/09/bloom-filters/" target="_blank" rel="noopener">åŸæ–‡é“¾æ¥</a>ï¼ŒåŸæ–‡æ—¥æœŸï¼š2018-09-19<br>è¯‘è€…ï¼š<a href="https://github.com/WAMaker" target="_blank" rel="noopener">WAMaker</a>ï¼›æ ¡å¯¹ï¼š<a href="http://numbbbbb.com/" target="_blank" rel="noopener">numbbbbb</a>ï¼Œ<a href="http://linusling.com" target="_blank" rel="noopener">å°é“åŒ Linus</a>ï¼›å®šç¨¿ï¼š<a href="http://forelax.space" target="_blank" rel="noopener">Forelax</a></p></blockquote><!--æ­¤å¤„å¼€å§‹æ­£æ–‡--><p>Swift 4.2 ä¸ºå“ˆå¸Œçš„å®ç°å¸¦æ¥äº†ä¸€äº›æ–°çš„å˜åŒ–ã€‚åœ¨æ­¤ä¹‹å‰ï¼Œå“ˆå¸Œäº¤ç”±å¯¹è±¡æœ¬èº«å…¨æƒä»£ç†ã€‚å½“ä½ å‘å¯¹è±¡ç´¢å– <code>å“ˆå¸Œå€¼ï¼ˆhashValueï¼‰</code>æ—¶ï¼Œå®ƒä¼šæŠŠå¤„ç†å¥½çš„æ•´å‹å€¼ä½œä¸ºå“ˆå¸Œå€¼è¿”å›ã€‚è€Œç°åœ¨ï¼Œå®ç°äº† <code>Hashable</code> åè®®çš„å¯¹è±¡åˆ™æè¿°äº†å®ƒçš„å‚æ•°æ˜¯å¦‚ä½•ç»„åˆï¼Œå¹¶ä¼ é€’ç»™ä½œä¸ºå…¥å‚çš„ <code>Hasher</code> å¯¹è±¡ã€‚è¿™æ ·åšæœ‰ä»¥ä¸‹å‡ ç‚¹å¥½å¤„ï¼š</p><ul><li>å†™å‡ºå¥½çš„å“ˆå¸Œç®—æ³•å¾ˆéš¾ã€‚Swift çš„ä½¿ç”¨è€…ä¸éœ€è¦çŸ¥é“å¦‚ä½•ç»„åˆå‚æ•°æ¥è·å¾—æ›´å¥½çš„å“ˆå¸Œå€¼ã€‚</li><li>å‡ºäºä¸æå€¡ç”¨æˆ·ä»¥ä»»ä½•å½¢å¼å­˜å‚¨å“ˆå¸Œå€¼ï¼Œä»¥åŠ <a href="https://twitter.com/jckarter/status/1042453831496327168" target="_blank" rel="noopener">ä¸€äº›å®‰å…¨æ–¹é¢å› ç´ </a> çš„è€ƒè™‘ï¼Œå“ˆå¸Œå€¼åœ¨ç¨‹åºæ¯æ¬¡è¿è¡Œçš„æ—¶å€™éƒ½åº”è¯¥æœ‰æ‰€ä¸åŒã€‚æè¿°æ€§çš„å“ˆå¸Œå…è®¸å“ˆå¸Œå‡½æ•°çš„ç§å­åœ¨æ¯æ¬¡ç¨‹åºè¿è¡Œçš„æ—¶å€™å‘ç”Ÿæ”¹å˜ã€‚</li><li>èƒ½å®ç°æ›´å¤šæœ‰æ„æ€çš„æ•°æ®ç»“æ„ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬è¿™ç¯‡æ–‡ç« æ¥ä¸‹æ¥ä¼šèšç„¦çš„ã€‚</li></ul><a id="more"></a><p>æˆ‘ä¹‹å‰å†™è¿‡ä¸€ç¯‡å…³äº <a href="http://khanlou.com/2016/07/implementing-dictionary-in-swift/" target="_blank" rel="noopener">å¦‚ä½•ä½¿ç”¨ Swift çš„ <code>Hashable</code> åè®®ä»é›¶å®ç° <code>Dictionary</code></a> çš„æ–‡ç« ï¼ˆå…ˆé˜…è¯»å®ƒä¼šå¸®åŠ©ä½ é˜…è¯»æœ¬æ–‡ï¼Œä½†è¿™ä¸æ˜¯å¿…é¡»çš„ï¼‰ã€‚ä»Šå¤©ï¼Œæˆ‘æƒ³è°ˆè®ºä¸€ç§ä¸åŒç±»å‹çš„ï¼ŒåŸºäºæ¦‚ç‡æ€§è€Œéæ˜ç¡®æ€§çš„æ•°æ®ç»“æ„ï¼šå¸ƒéš†è¿‡æ»¤å™¨ï¼ˆBloom Filtersï¼‰ã€‚æˆ‘ä»¬ä¼šä½¿ç”¨ Swift 4.2 çš„æ–°ç‰¹æ€§ï¼ŒåŒ…æ‹¬æ–°çš„å“ˆå¸Œæ¨¡å‹æ¥æ„å»ºå®ƒã€‚</p><p>å¸ƒéš†è¿‡æ»¤å™¨å¾ˆæ€ªå¼‚ã€‚æƒ³è±¡è¿™æ ·ä¸€ç§æ•°æ®ç»“æ„ï¼š</p><ul><li>ä½ èƒ½å¤Ÿå¾€é‡Œæ’å…¥æ•°æ®</li><li>ä½ èƒ½å¤ŸæŸ¥è¯¢ä¸€ä¸ªå€¼æ˜¯å¦å­˜åœ¨</li><li>åªéœ€è¦å°‘é‡å­˜å‚¨èµ„æºå°±èƒ½å­˜å‚¨å¤§é‡å¯¹è±¡</li></ul><p>ä½†æ˜¯ï¼š</p><ul><li>ä½ ä¸èƒ½æšä¸¾å…¶ä¸­çš„å¯¹è±¡</li><li>å®ƒæœ‰æ—¶ä¼šå‡ºç°è¯¯æŠ¥ï¼ˆä½†ä¸ä¼šå‡ºç°æ¼æŠ¥ï¼‰</li><li>ä½ ä¸èƒ½ä»ä¸­ç§»é™¤æ•°æ®</li></ul><p>ä»€ä¹ˆæ—¶å€™ä¼šæƒ³è¦è¿™ç§æ•°æ®ç»“æ„å‘¢ï¼ŸMedium ä½¿ç”¨å®ƒä»¬æ¥ <a href="https://blog.medium.com/what-are-bloom-filters-1ec2a50c68ff" target="_blank" rel="noopener">è·Ÿè¸ªåšæ–‡çš„é˜…è¯»çŠ¶æ€</a>ã€‚å¿…åº”ä½¿ç”¨å®ƒä»¬åš <a href="https://www.youtube.com/watch?v=80LKF2qph6I" target="_blank" rel="noopener">æœç´¢ç´¢å¼•</a>ã€‚ä½ å¯ä»¥ä½¿ç”¨å®ƒä»¬æ¥æ„å»ºä¸€ä¸ªç¼“å­˜ï¼Œåœ¨æ— éœ€è®¿é—®æ•°æ®åº“çš„æƒ…å†µä¸‹å°±èƒ½åˆ¤æ–­ç”¨æˆ·åæ˜¯å¦æœ‰æ•ˆï¼ˆä¾‹å¦‚åœ¨ @-mention ä¸­ï¼‰ã€‚åƒæœåŠ¡å™¨è¿™æ ·å¯èƒ½æ‹¥æœ‰å·¨å¤§çš„è§„æ¨¡ï¼Œå´ä¸ä¸€å®šæœ‰å·¨å¤§èµ„æºçš„åœºæ™¯ä¸­ï¼Œå®ƒä»¬ä¼šéå¸¸æœ‰ç”¨ã€‚</p><p>ï¼ˆå¦‚æœä½ ä¹‹å‰åšè¿‡å›¾å½¢æ–¹é¢çš„å·¥ä½œï¼Œå¯èƒ½å¥½å¥‡å®ƒæ˜¯å¦‚ä½•ä¸ <a href="https://en.wikipedia.org/wiki/Bloom_(shader_effect" target="_blank" rel="noopener">é«˜å…‰è¿‡æ»¤å™¨</a>) äº§ç”Ÿè”ç³»çš„ã€‚ç­”æ¡ˆæ˜¯æ²¡æœ‰è”ç³»ã€‚é«˜å…‰è¿‡æ»¤å™¨ï¼ˆbloom filtersï¼‰æ˜¯å°å†™çš„ bï¼Œè€Œå¸ƒéš†è¿‡æ»¤å™¨ï¼ˆBloom Filtersï¼‰æ˜¯ç”±ä¸€ä¸ªå«å¸ƒéš†çš„äººå‘½åçš„ã€‚å®Œå…¨æ˜¯ä¸ªå·§åˆã€‚ï¼‰</p><p>é‚£å®ƒä»¬æ˜¯å¦‚ä½•è¿ä½œçš„å‘¢ï¼Ÿ</p><p>å°†å¯¹è±¡æ”¾å…¥å¸ƒéš†è¿‡æ»¤å™¨å¦‚åŒå°†å®ƒæ”¾å…¥é›†åˆæˆ–å­—å…¸ï¼šè®¡ç®—å¯¹è±¡çš„å“ˆå¸Œå€¼ï¼Œå¹¶æ ¹æ®å­˜å‚¨æ•°ç»„çš„å¤§å°å¯¹å“ˆå¸Œå€¼æ±‚ä½™ã€‚å°±è¿™ç‚¹è€Œè¨€ï¼Œä½¿ç”¨å¸ƒéš†è¿‡æ»¤å™¨åªéœ€è¦ä¿®æ”¹è¯¥ç´¢å¼•å¤„çš„å€¼ï¼šå°† false æ”¹ä¸º trueï¼Œè€Œä¸ç”¨åƒä½¿ç”¨é›†åˆæˆ–å­—å…¸é‚£æ ·ï¼ŒæŠŠå¯¹è±¡å­˜æ”¾åˆ°ç´¢å¼•ä½ç½®ã€‚</p><p>æˆ‘ä»¬å…ˆé€šè¿‡ä¸€ä¸ªç®€å•çš„ä¾‹å­æ¥ç†è§£è¿‡æ»¤å™¨æ˜¯å¦‚æœè¿ä½œçš„ï¼Œä¹‹åå†å¯¹å®ƒè¿›è¡Œæ‰©å±•ã€‚æƒ³è±¡ä¸€ä¸ªæ‹¥æœ‰ 8 ä¸ª false å€¼çš„å¸ƒå°”æ•°ç»„ï¼ˆæˆ–ç§°ä¹‹ä¸º <a href="https://gist.github.com/natecook1000/552dc3d23d2fc4a54d2e9fcd309e59e9" target="_blank" rel="noopener">æ¯”ç‰¹æ•°ç»„</a>ï¼‰ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">| 0 | 1 | 2 | 3 | 4 | 5 | 6 | 7 |</span><br><span class="line">---------------------------------</span><br><span class="line">|   |   |   |   |   |   |   |   |</span><br></pre></td></tr></table></figure><p>å®ƒä»£è¡¨äº†æˆ‘ä»¬çš„å¸ƒéš†è¿‡æ»¤å™¨ã€‚æˆ‘æƒ³è¦æ’å…¥å­—ç¬¦ä¸²â€œsoroushâ€ã€‚å®ƒçš„å“ˆå¸Œå€¼æ˜¯ 9192644045266971309ï¼Œå½“è¿™ä¸ªå€¼ä½™ 8 æ—¶å¾—åˆ° 5ã€‚æˆ‘ä»¬ä¿®æ”¹é‚£ä¸€ä½çš„å€¼ã€‚</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">| 0 | 1 | 2 | 3 | 4 | 5 | 6 | 7 |</span><br><span class="line">---------------------------------</span><br><span class="line">|   |   |   |   |   | * |   |   |</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥æˆ‘æƒ³è¦æ’å…¥å­—ç¬¦ä¸²â€œswiftâ€ï¼Œå®ƒçš„å“ˆå¸Œå€¼æ˜¯ 7052914221234348788ï¼Œä½™ 8 å¾— 4ï¼Œä¿®æ”¹ç´¢å¼• 4 çš„å€¼ã€‚</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">| 0 | 1 | 2 | 3 | 4 | 5 | 6 | 7 |</span><br><span class="line">---------------------------------</span><br><span class="line">|   |   |   |   | * | * |   |   |</span><br></pre></td></tr></table></figure><p>è¦æµ‹è¯•å¸ƒéš†è¿‡æ»¤å™¨æ˜¯å¦åŒ…å«â€œsoroushâ€ï¼Œæˆ‘å†æ¬¡è®¡ç®—å®ƒçš„å“ˆå¸Œå€¼å¹¶æ±‚ä½™ï¼Œä»æ—§å¾—åˆ°ä½™æ•° 5ï¼Œå¯¹åº”å€¼æ˜¯ trueã€‚â€œsoroushâ€ç¡®å®åœ¨å¸ƒéš†è¿‡æ»¤å™¨ä¸­ã€‚</p><p>ç„¶è€Œä»…ä»…æµ‹è¯•èƒ½å¤Ÿé€šè¿‡çš„ç”¨ä¾‹æ˜¯ä¸å¤Ÿçš„ï¼Œæˆ‘ä»¬éœ€è¦å†™ä¸€äº›ä¼šå¯¼è‡´å¤±è´¥çš„ç”¨ä¾‹ã€‚æµ‹è¯•å­—ç¬¦ä¸²â€œkhanlouâ€å–ä½™å¾—åˆ°çš„ç´¢å¼•å€¼æ˜¯ 2ï¼Œå› æ­¤æˆ‘ä»¬çŸ¥é“å®ƒä¸åœ¨å¸ƒéš†è¿‡æ»¤å™¨ä¸­ã€‚åˆ°æ­¤ä¸ºæ­¢ä¸€åˆ‡éƒ½å¥½ã€‚æ¥ä¸‹å»ä¸€ä¸ªæµ‹è¯•ï¼šå¯¹â€œhashableâ€å­—ç¬¦ä¸²å–ä½™å¾—åˆ°çš„ç´¢å¼•å€¼æ˜¯ 5ï¼Œè¿™å°±å‘ç”Ÿäº†ä¸€æ¬¡å†²çªï¼å³ä½¿è¿™ä¸ªå€¼ä»æ¥æ²¡æœ‰è¢«åŠ å…¥è¿‡ï¼Œè¿‡æ»¤å™¨ä»è¿”å›äº† trueã€‚è¿™ä¾¿æ˜¯å¸ƒéš†è¿‡æ»¤å™¨ä¼šå‘ç”Ÿè¯¯æŠ¥çš„ä¾‹å­ã€‚</p><p>æœ‰ä¸¤ä¸ªä¸»è¦çš„ç­–ç•¥å¯ä»¥å°½å¯èƒ½å‡å°‘è¯¯æŠ¥ã€‚ç¬¬ä¸€ä¸ªç­–ç•¥ï¼Œä¹Ÿæ˜¯ä¸¤ä¸ªç­–ç•¥ä¸­ç›¸å¯¹æœ‰è¶£çš„ï¼šæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸åŒçš„å“ˆå¸Œå‡½æ•°è®¡ç®—ä¸¤æ¬¡æˆ–ä¸‰æ¬¡å“ˆå¸Œå€¼è€Œéä¸€æ¬¡ã€‚åªè¦å®ƒä»¬éƒ½æ˜¯è¡¨ç°è‰¯å¥½çš„å“ˆå¸Œå‡½æ•°ï¼ˆå‡åŒ€åˆ†å¸ƒï¼Œä¸€è‡´æ€§ï¼Œæœ€å°çš„ç¢°æ’å‡ ç‡ï¼‰ï¼Œæˆ‘ä»¬å°±èƒ½ä¸ºæ¯ä¸ªå€¼ç”Ÿæˆå¤šä¸ªç´¢å¼•æ”¹å˜å¸ƒå°”å€¼ã€‚è¿™æ¬¡ï¼Œæˆ‘ä»¬è®¡ç®—ä¸¤æ¬¡â€œsoroushâ€çš„å“ˆå¸Œå€¼ï¼Œç”Ÿæˆ 2 ä¸ªç´¢å¼•å¹¶æ”¹å˜å¸ƒå°”å€¼ã€‚è¿™æ—¶ï¼Œå½“æˆ‘ä»¬æ£€æŸ¥â€œkhanlouâ€æ˜¯å¦åœ¨å¸ƒéš†è¿‡æ»¤å™¨ä¸­ï¼Œå…¶ä¸­ä¸€ä¸ªå“ˆå¸Œå€¼å¯èƒ½ä¼šå’Œâ€œsoroushâ€çš„ä¸€ä¸ªå“ˆå¸Œå€¼å†²çªï¼Œä½†ä¸¤ä¸ªå€¼åŒæ—¶å‘ç”Ÿå†²çªçš„å¯èƒ½æ€§å°±ä¼šå˜å¾—å¾ˆå°ã€‚ä½ å¯ä»¥æŠŠè¿™ä¸ªæ•°å­—æ‰©å¤§ã€‚åœ¨ä¸‹é¢çš„ä»£ç æˆ‘ä¼šåš 3 æ¬¡å“ˆå¸Œè®¡ç®—ï¼Œä½†ä½ å¯ä»¥åšæ›´å¤šæ¬¡ã€‚</p><p>å½“ç„¶ï¼Œå¦‚æœä½ è®¡ç®—æ›´å¤šæ¬¡å“ˆå¸Œå€¼ï¼Œæ¯ä¸ªå…ƒç´ åœ¨å¸ƒå°”æ•°ç»„ä¸­ä¼šå æ®æ›´å¤šçš„ç©ºé—´ã€‚äº‹å®ä¸Šï¼Œç°åœ¨çš„æ•°æ®å‡ ä¹ä¸å ç”¨ç©ºé—´ã€‚8 ä¸ªå¸ƒå°”å€¼çš„æ•°ç»„å¯¹åº” 1 å­—èŠ‚ã€‚æ‰€ä»¥ç¬¬äºŒä¸ªå‡å°è¯¯æŠ¥çš„ç­–ç•¥æ˜¯æ‰©å¤§æ•°ç»„çš„è§„æ¨¡ã€‚æˆ‘ä»¬èƒ½å°†æ•°ç»„å˜å¾—è¶³å¤Ÿå¤§è€Œä¸ç”¨æ‹…å¿ƒå®ƒçš„ç©ºé—´æ¶ˆè€—ã€‚ä¸‹é¢çš„ä»£ç ä¸­æˆ‘ä»¬ä¼šé»˜è®¤ä½¿ç”¨ 512 æ¯”ç‰¹å¤§å°çš„æ•°ç»„ã€‚</p><p>ç°åœ¨ï¼Œå³ä½¿åŒæ—¶ä½¿ç”¨è¿™äº›ç­–ç•¥ï¼Œä½ ä¾ç„¶ä¼šå¾—åˆ°å†²çªï¼Œå³è¯¯æŠ¥ï¼Œä½†å†²çªçš„å‡ ç‡ä¼šå‡å°ã€‚è¿™æ˜¯å¸ƒéš†è¿‡æ»¤å™¨çš„ä¸€ä¸ªç¼ºé™·ï¼Œä½†åœ¨åˆé€‚çš„åœºæ™¯ç”¨å®ƒæ¥èŠ‚çœé€Ÿåº¦ä¸ç©ºé—´æ˜¯ä¸€ç¬”ä¸é”™çš„äº¤æ˜“ã€‚</p><p>åœ¨å¼€å§‹å…·ä½“çš„ä»£ç ä¹‹å‰æˆ‘æœ‰å¦å¤–ä¸‰ç‚¹æƒ³è¦è°ˆè°ˆã€‚é¦–å…ˆï¼Œä½ ä¸èƒ½æ”¹å˜å¸ƒéš†è¿‡æ»¤å™¨çš„å¤§å°ã€‚å½“ä½ å¯¹å“ˆå¸Œå€¼å–ä½™æ—¶ï¼Œè¿™æ˜¯åœ¨ç ´åä¿¡æ¯ï¼Œåœ¨ä¸ä¿ç•™åŸå§‹å“ˆå¸Œå€¼çš„æƒ…å†µä¸‹ä½ ä¸èƒ½å›æº¯ä¹‹å‰çš„ä¿¡æ¯ â€”â€” ä¿ç•™åŸå§‹å€¼ç›¸å½“äºå¦å†³äº†è¿™ä¸ªæ•°æ®ç»“æ„èŠ‚çº¦ç©ºé—´çš„ä¼˜åŠ¿ã€‚</p><p>å…¶æ¬¡ï¼Œä½ èƒ½çœ‹åˆ°æƒ³è¦æšä¸¾å¸ƒéš†è¿‡æ»¤å™¨æ‰€æœ‰çš„å€¼æ˜¯å¤šä¹ˆå¼‚æƒ³å¤©å¼€ã€‚ä½ ä¸å†æ‹¥æœ‰è¿™äº›å€¼ï¼Œåªæ˜¯å®ƒä»¬ä»¥å“ˆå¸Œå½¢å¼å­˜åœ¨çš„æ›¿ä»£å“ã€‚</p><p>æœ€åï¼Œä½ åŒæ ·èƒ½çœ‹åˆ°æƒ³è¦ä»å¸ƒéš†è¿‡æ»¤å™¨ä¸­ç§»é™¤å…ƒç´ æ˜¯ä¸å¯èƒ½çš„ã€‚å¦‚æœæƒ³å°†å¸ƒå°”å€¼å˜å› falseï¼Œä½ å¹¶ä¸çŸ¥é“æ˜¯å“ªäº›å€¼å°†å®ƒå˜ä¸º trueã€‚æ˜¯å‡†å¤‡ç§»é™¤çš„å€¼è¿˜æ˜¯å…¶å®ƒå€¼ï¼Ÿè¿™æ ·åšä¼šé€ æˆæ¼æŠ¥å’Œè¯¯æŠ¥ã€‚ï¼ˆè¿™å¯¹ä½ æ¥è¯´å¯èƒ½æ˜¯å€¼å¾—æƒè¡¡çš„ï¼‰ä½ å¯ä»¥åœ¨æ¯ä¸ªç´¢å¼•ä¸Šä¿ç•™è®¡æ•°è€Œéå¸ƒå°”å€¼æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œè™½ç„¶ä¿ç•™è®¡æ•°è¿˜æ˜¯ä¼šå¸¦æ¥å­˜å‚¨é—®é¢˜ï¼Œä½†æ ¹æ®ä½¿ç”¨åœºæ™¯çš„ä¸åŒï¼Œè¿™æ ·åšæˆ–è®¸æ˜¯å€¼å¾—çš„ã€‚</p><p>åºŸè¯ä¸å¤šè¯´ï¼Œè®©æˆ‘ä»¬å¼€å§‹ç€æ‰‹ç¼–ç ã€‚æˆ‘åœ¨è¿™é‡Œåšçš„ä¸€äº›å†³ç­–å’Œä½ å¯èƒ½ä¼šåšçš„æœ‰æ‰€ä¸åŒï¼Œç¬¬ä¸€ä¸ªä¸åŒå°±æ˜¯è¦ä¸è¦è®©å¯¹è±¡æ”¯æŒèŒƒå‹ã€‚æˆ‘è®¤ä¸ºè®©å¯¹è±¡åŒ…å«æ›´å¤šå…³äºå®ƒéœ€è¦å­˜å‚¨å†…å®¹çš„å…ƒæ•°æ®æ˜¯æœ‰æ„ä¹‰çš„ï¼Œä½†å¦‚æœä½ å‘ç°è¿™æ ·åšé™åˆ¶å¤ªå¤šï¼Œä½ å¯ä»¥æ”¹å˜å®ƒã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">BloomFilter</span>&lt;<span class="title">Element</span>: <span class="title">Hashable</span>&gt; </span>&#123;</span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬éœ€è¦å­˜å‚¨ä¸¤ç§ä¸»è¦çš„æ•°æ®ã€‚ç¬¬ä¸€ä¸ªæ˜¯ <code>data</code>ï¼Œç”¨äºè¡¨ç¤ºæ¯”ç‰¹æ•°ç»„ã€‚å®ƒå­˜å‚¨äº†æ‰€æœ‰å’Œå“ˆå¸Œå€¼æœ‰å…³çš„æ ‡è®°ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">var</span> data: [<span class="type">Bool</span>]</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦ä¸åŒçš„å“ˆå¸Œå‡½æ•°ã€‚ä¸€äº›å¸ƒéš†è¿‡æ»¤å™¨ç¡®å®ä¼šä½¿ç”¨ä¸åŒçš„æ–¹æ³•è®¡ç®—å“ˆå¸Œå€¼ï¼Œä½†æˆ‘è§‰å¾—ä½¿ç”¨ç›¸åŒçš„ç®—æ³•ï¼ŒåŒæ—¶æ··å…¥ä¸€ä¸ªéšæœºç”Ÿæˆçš„å€¼ä¼šæ›´ç®€å•ã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">let</span> seeds: [<span class="type">Int</span>]</span><br></pre></td></tr></table></figure><p>å½“åˆå§‹åŒ–å¸ƒéš†è¿‡æ»¤å™¨æ—¶ï¼Œæˆ‘ä»¬éœ€è¦åˆå§‹åŒ–è¿™ä¸¤ä¸ªå®ä¾‹å˜é‡ã€‚æ¯”ç‰¹æ•°ç»„ä¼šç®€å•çš„é‡å¤ <code>false</code> å€¼æ¥åˆå§‹åŒ–ï¼Œè€Œç§å­å€¼åˆ™ä½¿ç”¨ Swift 4.2 çš„æ–° API <code>Int.random</code> æ¥ç”Ÿæˆæˆ‘ä»¬éœ€è¦çš„ç§å­å€¼ã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">init</span>(size: <span class="type">Int</span>, hashCount: <span class="type">Int</span>) &#123;</span><br><span class="line">data = <span class="type">Array</span>(repeating: <span class="literal">false</span>, <span class="built_in">count</span>: size)</span><br><span class="line">seeds = (<span class="number">0</span>..&lt;hashCount).<span class="built_in">map</span>(&#123; <span class="number">_</span> <span class="keyword">in</span> <span class="type">Int</span>.random(<span class="keyword">in</span>: <span class="number">0</span>..&lt;<span class="type">Int</span>.<span class="built_in">max</span>) &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŒæ—¶ï¼Œåˆ›å»ºä¸€ä¸ªå¸¦æœ‰é»˜è®¤å€¼çš„ä¾¿åˆ©æ„é€ å™¨ã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">init</span>() &#123;</span><br><span class="line"><span class="keyword">self</span>.<span class="keyword">init</span>(size: <span class="number">512</span>, hashCount: <span class="number">3</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬è¦å®ç°ä¸¤ä¸ªä¸»è¦çš„æ–¹æ³•ï¼š<code>insert</code> å’Œ <code>contains</code>ã€‚å®ƒä»¬éƒ½éœ€è¦æ¥æ”¶å…ƒç´ ä½œä¸ºå‚æ•°å¹¶ä¸ºæ¯ä¸€ä¸ªç§å­å€¼è®¡ç®—å‡ºå¯¹åº”çš„å“ˆå¸Œå€¼ã€‚ç§æœ‰çš„å¸®åŠ©æ–¹æ³•ä¼šå¾ˆæœ‰ç”¨ã€‚ç”±äºç§å­å€¼ä»£è¡¨äº†â€œä¸åŒçš„â€å“ˆå¸Œå‡½æ•°ï¼Œæˆ‘ä»¬å°±éœ€è¦ä¸ºæ¯ä¸€ä¸ªç§å­ç”Ÿæˆå¯¹åº”çš„å“ˆå¸Œå€¼ã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">hashes</span><span class="params">(<span class="keyword">for</span> element: Element)</span></span> -&gt; [<span class="type">Int</span>] &#123;</span><br><span class="line"><span class="keyword">return</span> seeds.<span class="built_in">map</span>(&#123; seed -&gt; <span class="type">Int</span> <span class="keyword">in</span></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line">&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¦å®ç°å‡½æ•°ä¸»ä½“ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ª <code>Hasher</code> å¯¹è±¡ï¼ˆSwift 4.2 æ–°ç‰¹æ€§ï¼‰ï¼Œå°†æƒ³è¦è¿›è¡Œå“ˆå¸Œè®¡ç®—çš„å¯¹è±¡ä¼ ç»™å®ƒã€‚å¸¦ä¸Šç§å­ç¡®ä¿äº†ç”Ÿæˆçš„å“ˆå¸Œå€¼ä¸ä¼šå†²çªã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">hashes</span><span class="params">(<span class="keyword">for</span> element: Element)</span></span> -&gt; [<span class="type">Int</span>] &#123;</span><br><span class="line"><span class="keyword">return</span> seeds.<span class="built_in">map</span>(&#123; seed -&gt; <span class="type">Int</span> <span class="keyword">in</span></span><br><span class="line"><span class="keyword">var</span> hasher = <span class="type">Hasher</span>()</span><br><span class="line">hasher.combine(element)</span><br><span class="line">hasher.combine(seed)</span><br><span class="line"><span class="keyword">let</span> hashValue = <span class="built_in">abs</span>(hasher.finalize())</span><br><span class="line"><span class="keyword">return</span> hashValue</span><br><span class="line">&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŒæ—¶ï¼Œæ³¨æ„å“ˆå¸Œå€¼çš„ç»å¯¹å€¼ã€‚å“ˆå¸Œè®¡ç®—æœ‰å¯èƒ½äº§ç”Ÿè´Ÿæ•°ï¼Œè¿™ä¼šå¯¼è‡´æˆ‘ä»¬çš„æ•°ç»„è®¿é—®å´©æºƒã€‚å–ç»å¯¹å€¼æ“ä½œå‡å°‘äº† 1 æ¯”ç‰¹çš„ä¿¡æ¯ç†µï¼Œå¯¹æˆ‘ä»¬æ¥è¯´æ˜¯æœ‰ç›Šçš„ã€‚</p><p>ç†æƒ³çš„æƒ…å†µæ˜¯ä½ èƒ½å¤Ÿä½¿ç”¨ç§å­æ¥åˆå§‹åŒ– <code>Hasher</code> è€Œä¸æ˜¯æŠŠå®ƒæ··åˆè¿›å»ã€‚Swift çš„ <code>Hasher</code> ä¼šåœ¨æ¯æ¬¡ç¨‹åºå¯åŠ¨çš„æ—¶å€™è¢«åˆ†é…ä¸€ä¸ªä¸åŒçš„ç§å­ï¼ˆé™¤éä½  <a href="https://github.com/apple/swift-evolution/blob/master/proposals/0206-hashable-enhancements.md#effect-on-abi-stability" target="_blank" rel="noopener">è®¾ç½®å›ºå®šçš„ç¯å¢ƒå˜é‡</a> è®©ç§å­åœ¨ä¸åŒå¯åŠ¨é—´ä¿æŒä¸€è‡´ï¼Œè€Œè¿™æ ·åšé€šå¸¸æ˜¯ä¸€äº›æµ‹è¯•ç›®çš„ï¼‰ï¼Œæ„å‘³ç€ä½ ä¸èƒ½æŠŠè¿™äº›å€¼å†™åˆ°ç£ç›˜ä¸Šã€‚å¦‚æœæˆ‘ä»¬æ§åˆ¶äº† <code>Hasher</code> çš„ç§å­ï¼Œæˆ‘ä»¬å°±èƒ½å°†è¿™äº›å€¼å†™åˆ°ç£ç›˜ä¸Šäº†ã€‚è€Œå°±åƒè¿™ä¸ªå¸ƒéš†è¿‡æ»¤å™¨å±•ç¤ºçš„é‚£æ ·ï¼Œå®ƒåº”è¯¥åªè¢«ç”¨äºå†…å­˜ç¼“å­˜ã€‚</p><p><code>hashes(for:)</code> æ–¹æ³•å®Œæˆäº†å¾ˆå¤šç¹é‡çš„å·¥ä½œï¼Œè®© <code>insert</code> æ–¹æ³•éå¸¸ç®€æ´ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">mutating</span> <span class="function"><span class="keyword">func</span> <span class="title">insert</span><span class="params">(<span class="number">_</span> element: Element)</span></span> &#123;</span><br><span class="line">hashes(<span class="keyword">for</span>: element)</span><br><span class="line">.forEach(&#123; hash <span class="keyword">in</span></span><br><span class="line">data[hash % data.<span class="built_in">count</span>] = <span class="literal">true</span></span><br><span class="line">&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç”Ÿæˆæ‰€æœ‰çš„å“ˆå¸Œå€¼ï¼Œåˆ†åˆ«ä½™ä¸Š <code>data</code> æ•°ç»„çš„é•¿åº¦ï¼Œå¹¶è®¾ç½®å¯¹åº”ç´¢å¼•ä½çš„å€¼ä¸º <code>true</code>ã€‚</p><p><code>contains</code> æ–¹æ³•ä¹ŸåŒæ ·ç®€å•ï¼ŒåŒæ—¶ä¹Ÿç»™äº†æˆ‘ä»¬ä½¿ç”¨ Swift 4.2 å¦ä¸€ä¸ªæ–°ç‰¹æ€§ <code>allSatisfy</code> çš„æœºä¼šã€‚è¿™ä¸ªæ–°æ–¹æ³•å¯ä»¥åˆ¤æ–­åºåˆ—ä¸­çš„æ‰€æœ‰å¯¹è±¡æ˜¯å¦éƒ½é€šè¿‡äº†æŸé¡¹ç”¨ block è¡¨ç¤ºçš„æµ‹è¯•ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">contains</span><span class="params">(<span class="number">_</span> element: Element)</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line"><span class="keyword">return</span> hashes(<span class="keyword">for</span>: element)</span><br><span class="line">.allSatisfy(&#123; hash <span class="keyword">in</span></span><br><span class="line">data[hash % data.<span class="built_in">count</span>]</span><br><span class="line">&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å› ä¸º <code>data[hash % data.count]</code> çš„ç»“æœå·²ç»æ˜¯å¸ƒå°”å€¼äº†ï¼Œå®ƒä¸ <code>allSatisfy</code> ååˆ†å¥‘åˆã€‚</p><p>ä½ ä¹Ÿå¯ä»¥æ·»åŠ  <code>isEmpty</code> æ–¹æ³•ç”¨æ¥æ£€æµ‹ <code>data</code> ä¸­çš„æ‰€æœ‰å€¼æ˜¯å¦éƒ½æ˜¯ falseã€‚</p><p>å¸ƒéš†è¿‡æ»¤å™¨æ˜¯ä¸€ç§å¥‡æ€ªçš„æ•°æ®ç»“æ„ã€‚æˆ‘ä»¬æ¥è§¦çš„å¤§å¤šæ•°æ•°æ®ç»“æ„éƒ½æ˜¯æ˜ç¡®æ€§çš„ã€‚å½“æŠŠä¸€ä¸ªå¯¹è±¡æ”¾å…¥å­—å…¸ä¸­æ—¶ï¼Œä½ çŸ¥é“é‚£ä¸ªå€¼ä¹‹åä¸€ç›´åœ¨é‚£å„¿ã€‚è€Œå¸ƒéš†è¿‡æ»¤å™¨æ˜¯æ¦‚ç‡æ€§çš„ï¼Œç‰ºç‰²ç¡®å®šæ€§æ¥æ¢å–ç©ºé—´å’Œé€Ÿåº¦ã€‚å¸ƒéš†è¿‡æ»¤å™¨ä¸æ˜¯ä½ ä¼šæ¯å¤©ç”¨çš„æ•°æ®ç»“æ„ï¼Œä½†å½“ä½ ç¡®å®éœ€è¦å®ƒæ—¶ï¼Œå°±ä¼šæ„Ÿå—åˆ°æœ‰å®ƒçœŸå¥½ã€‚</p><blockquote><p>æœ¬æ–‡ç”± SwiftGG ç¿»è¯‘ç»„ç¿»è¯‘ï¼Œå·²ç»è·å¾—ä½œè€…ç¿»è¯‘æˆæƒï¼Œæœ€æ–°æ–‡ç« è¯·è®¿é—® <a href="http://swift.gg">http://swift.gg</a>ã€‚</p></blockquote>]]></content>
    
    <summary type="html">
    
      æœ¬æ–‡æè¿°äº†å¦‚ä½•ä½¿ç”¨ Swift 4.2 æ–°ç‰¹æ€§ Hashable å®ç°å¸ƒéš†è¿‡æ»¤å™¨ã€‚
    
    </summary>
    
      <category term="Khanlou" scheme="https://swift.gg/categories/Khanlou/"/>
    
    
      <category term="Swift" scheme="https://swift.gg/tags/Swift/"/>
    
  </entry>
  
  <entry>
    <title>è®©æˆ‘ä»¬æ„å»ºä¸€ä¸ªSwift.Array</title>
    <link href="https://swift.gg/2018/12/06/friday-qa-2015-04-17-lets-build-swiftarray/"/>
    <id>https://swift.gg/2018/12/06/friday-qa-2015-04-17-lets-build-swiftarray/</id>
    <published>2018-12-06T00:00:00.000Z</published>
    <updated>2019-08-14T12:15:52.092Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ä½œè€…ï¼šMike Ashï¼Œ<a href="https://www.mikeash.com/pyblog/friday-qa-2015-04-17-lets-build-swiftarray.html" target="_blank" rel="noopener">åŸæ–‡é“¾æ¥</a>ï¼ŒåŸæ–‡æ—¥æœŸï¼š2015-04-17<br>è¯‘è€…ï¼š<a href="https://github.com/dzyding" target="_blank" rel="noopener">ç°s</a>ï¼›æ ¡å¯¹ï¼š<a href="http://numbbbbb.com/" target="_blank" rel="noopener">numbbbbb</a>ï¼Œ<a href="http://forelax.space" target="_blank" rel="noopener">Forelax</a>ï¼›å®šç¨¿ï¼š<a href="http://forelax.space" target="_blank" rel="noopener">Forelax</a></p></blockquote><!--æ­¤å¤„å¼€å§‹æ­£æ–‡--><p>Swift 1.2 ç°å·²ç»ä½œä¸º Xcode 6.3 çš„ä¸€éƒ¨åˆ†è€Œå‘å¸ƒï¼Œåœ¨æ–°çš„ API ä¸­æœ‰ä¸€ä¸ªå…è®¸æˆ‘ä»¬ä½¿ç”¨å€¼ç±»å‹å»ºç«‹é«˜æ•ˆçš„æ•°æ®ç»“æ„ï¼Œæ¯”å¦‚ Swift æ ‡å‡†åº“ä¸­çš„ <code>Array</code> ç±»å‹ã€‚ä»Šå¤©ï¼Œæˆ‘ä»¬å°†é‡æ–°ç°å® <code>Array</code> çš„æ ¸å¿ƒåŠŸèƒ½ã€‚</p><a id="more"></a><h2 id="å€¼ç±»å‹å’Œå¼•ç”¨ç±»å‹"><a href="#å€¼ç±»å‹å’Œå¼•ç”¨ç±»å‹" class="headerlink" title="å€¼ç±»å‹å’Œå¼•ç”¨ç±»å‹"></a>å€¼ç±»å‹å’Œå¼•ç”¨ç±»å‹</h2><p>åœ¨æˆ‘ä»¬å¼€å§‹ä¹‹å‰ï¼Œå¿«é€Ÿçš„å¤ä¹ ä¸€ä¸‹å€¼ç±»å‹å’Œå¼•ç”¨ç±»å‹ã€‚åœ¨ objc ä»¥åŠå¤§éƒ¨åˆ†å…¶ä»–é¢å‘å¯¹è±¡çš„è¯­è¨€ä¸­ï¼Œæˆ‘ä»¬æ‰€ä½¿ç”¨å¯¹è±¡çš„æŒ‡é’ˆæˆ–è€…å¼•ç”¨éƒ½å±äº <strong>å¼•ç”¨ç±»å‹</strong>ã€‚ä½ å¯ä»¥æŠŠä¸€ä¸ªå¯¹è±¡çš„å¼•ç”¨èµ‹å€¼ç»™ä¸€ä¸ªå˜é‡ï¼š</p><figure class="highlight objc"><table><tr><td class="code"><pre><span class="line">MyClass *a = ...;</span><br></pre></td></tr></table></figure><p>ç°åœ¨ä½ å¯ä»¥å°†è¿™ä¸ªå˜é‡çš„å€¼å¤åˆ¶ç»™å¦ä¸€ä¸ªå˜é‡ï¼š</p><figure class="highlight objc"><table><tr><td class="code"><pre><span class="line">MyClass *b = a;</span><br></pre></td></tr></table></figure><p>ç°åœ¨ a å’Œ b éƒ½æŒ‡å‘åŒä¸€ä¸ªå¯¹è±¡ã€‚å¦‚æœè¿™ä¸ªå¯¹è±¡æ˜¯å¯å˜çš„ï¼Œé‚£ä¹ˆå¯¹å…¶ä¸­ä¸€ä¸ªå˜é‡çš„æ”¹å˜åŒæ ·ä¼šå‘ç”Ÿåœ¨å¦ä¸€ä¸ªå˜é‡ä¸Šã€‚</p><p><strong>å€¼ç±»å‹</strong> å°±æ˜¯ç±»ä¼¼ Objective-C ä¸­ <code>int</code> è¿™æ ·çš„å­˜åœ¨ã€‚ä½¿ç”¨å€¼ç±»å‹ï¼Œå˜é‡åŒ…å«çš„æ˜¯çœŸå®çš„å€¼ï¼Œå¹¶ä¸æ˜¯å€¼çš„å¼•ç”¨ã€‚å½“ä½ ç”¨ = ç»™å¦ä¸€ä¸ªå˜é‡èµ‹å€¼ï¼Œæ˜¯å°†å€¼çš„æ‹·è´å‰¯æœ¬èµ‹å€¼ç»™äº†å¦ä¸€ä¸ªå˜é‡ã€‚æ¯”å¦‚ï¼š</p><figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="keyword">int</span> a = <span class="number">42</span>;</span><br><span class="line"><span class="keyword">int</span> b = a;</span><br><span class="line">b++;</span><br></pre></td></tr></table></figure><p>ç°åœ¨ï¼Œb çš„å€¼æ˜¯ 43ï¼Œä½†æ˜¯ a ä¾ç„¶æ˜¯ 42ã€‚  </p><p>åœ¨ Swift ä¸­ï¼Œ<code>class</code> å±äºå¼•ç”¨ç±»å‹ï¼Œ<code>struct</code> å±äºå€¼ç±»å‹ã€‚<br>å¦‚æœä½ ä½¿ç”¨ = å°†ä¸€ä¸ª <code>class</code> å®ä¾‹çš„å¼•ç”¨èµ‹å€¼ç»™å¦ä¸€ä¸ªå˜é‡ï¼Œä½ å°†å¾—åˆ°è¿™ä¸ªå®ä¾‹çš„ä¸€ä¸ªæ–°å¼•ç”¨ã€‚å¯¹è¿™ä¸ªå®ä¾‹çš„ä¿®æ”¹å¯¹æ¯ä¸€ä¸ªå¼•ç”¨å¯è§ã€‚<br>å¦‚æœä½ ä½¿ç”¨ = å°†ä¸€ä¸ª <code>struct</code> å®ä¾‹çš„å¼•ç”¨èµ‹å€¼ç»™å¦ä¸€ä¸ªå˜é‡ï¼Œä½ å°†å¾—åˆ°è¿™ä¸ªå®ä¾‹çš„ä¸€ä¸ªå‰¯æœ¬ï¼Œä¸åŸå§‹æ•°æ®ç›¸äº’ç‹¬ç«‹ã€‚  </p><p>ä¸å¤§å¤šæ•°è¯­è¨€ä¸åŒï¼ŒSwift æ ‡å‡†åº“ä¸­çš„æ•°ç»„å’Œå­—å…¸éƒ½æ˜¯å€¼ç±»å‹ã€‚æ¯”å¦‚ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> a = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line"><span class="keyword">var</span> b = a</span><br><span class="line">b.append(<span class="number">4</span>)</span><br></pre></td></tr></table></figure><p>åœ¨å¤§éƒ¨åˆ†è¯­è¨€ä¸­ï¼Œè¿™æ®µä»£ç ï¼ˆæˆ–è€…ç­‰æ•ˆçš„ä»£ç ï¼‰è¿è¡Œä»¥åï¼Œ a å’Œ b å°†éƒ½æ˜¯ä¸€ä¸ªæŒ‡å‘æ•°ç»„ <code>[1, 2, 3, 4]</code> çš„å¼•ç”¨ã€‚ä½†æ˜¯åœ¨ Swift ä¸­ï¼Œa æ˜¯æŒ‡å‘æ•°ç»„ <code>[1, 2, 3]</code> çš„å¼•ç”¨ï¼Œb æ˜¯æŒ‡å‘æ•°ç»„ <code>[1, 2, 3, 4]</code> çš„å¼•ç”¨ã€‚</p><h2 id="å€¼ç±»å‹çš„å®ç°"><a href="#å€¼ç±»å‹çš„å®ç°" class="headerlink" title="å€¼ç±»å‹çš„å®ç°"></a>å€¼ç±»å‹çš„å®ç°</h2><p>å¦‚æœä½ çš„å¯¹è±¡æ‹¥æœ‰çš„å±æ€§æ˜¯å›ºå®šçš„ï¼Œåœ¨ Swift ä¸­æŠŠå®ƒç”³æ˜æˆå€¼ç±»å‹æ˜¯å¾ˆç®€å•çš„ï¼šåªéœ€è¦æŠŠæ‰€æœ‰çš„å±æ€§æ”¾å…¥ä¸€ä¸ª <code>struct</code> ä¸­å³å¯ã€‚æ¯”å¦‚ï¼Œå¦‚æœä½ éœ€è¦ä¸€ä¸ª 2D çš„ <code>Point</code> å€¼ç±»å‹ï¼Œä½ å¯ä»¥ç®€å•çš„ç”³æ˜ä¸€ä¸ª <code>struct</code> åŒ…å« x å’Œ y ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Point</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> x: <span class="type">Int</span></span><br><span class="line">    <span class="keyword">var</span> y: <span class="type">Int</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¾ˆå¿«çš„ï¼Œä½ å°±ç”³æ˜äº†ä¸€ä¸ªå€¼ç±»å‹ã€‚ä½†æ˜¯å¦‚ä½•å®ç°ç±»ä¼¼ <code>Array</code> è¿™æ ·çš„å€¼ç±»å‹å‘¢ï¼Ÿä½ æ— æ³•æŠŠæ•°ç»„é‡Œé¢æ‰€æœ‰æ•°æ®æ”¾å…¥ <code>struct</code> çš„ç”³æ˜ä¸­ï¼Œå› ä¸ºåœ¨å†™ä»£ç çš„è¿‡ç¨‹ä¸­ä½ æ— æ³•é¢„æ–™ä½ å°†ä¼šåœ¨æ•°ç»„ä¸­æ”¾å¤šå°‘æ•°æ®ã€‚ä½ å¯ä»¥åˆ›å»ºä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘æ‰€æœ‰çš„æ•°æ®ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Array</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> ptr: <span class="type">UnsafeMutablePointer</span>&lt;<span class="type">T</span>&gt;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŒæ—¶ï¼Œä½ éœ€è¦åœ¨è¯¥ <code>struct</code> æ¯æ¬¡<strong>åˆ†é…</strong>å’Œ<strong>é”€æ¯</strong>çš„æ—¶å€™è¿›è¡Œä¸€äº›ç‰¹æ®Šæ“ä½œã€‚  </p><ul><li>åœ¨åˆ†é…çš„è¿‡ç¨‹ä¸­ï¼Œä½ éœ€è¦æŠŠåŒ…å«çš„æ•°æ®æ‹·è´ä¸€ä»½æ”¾åˆ°ä¸€ä¸ªæ–°çš„å†…å­˜åœ°å€ï¼Œè¿™æ—¶æ–°çš„ <code>struct</code> å°±ä¸ä¼šå’ŒåŸæ•°æ®å…±äº«åŒä¸€ä»½æ•°æ®äº†ã€‚  </li><li>åœ¨é”€æ¯çš„è¿‡ç¨‹ä¸­ï¼Œ<code>ptr</code> æŒ‡é’ˆä¹Ÿéœ€è¦æ­£å¸¸é”€æ¯ã€‚  </li></ul><p>åœ¨ Swift ä¸­ä¸å…è®¸å¯¹ <code>struct</code> çš„åˆ†é…å’Œé”€æ¯è¿‡ç¨‹è¿›è¡Œè‡ªå®šä¹‰ã€‚</p><p>é”€æ¯æ“ä½œå¯ä»¥ä½¿ç”¨ä¸€ä¸ª <code>class</code> å®ç°ï¼Œå®ƒæä¾›äº† <code>deinit</code>ã€‚åŒæ—¶å¯ä»¥åœ¨è¿™é‡Œå¯¹æŒ‡é’ˆè¿›è¡Œé”€æ¯ã€‚<code>class</code> å¹¶ä¸æ˜¯å€¼ç±»å‹ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥å°† <code>class</code> ä½œä¸ºä¸€ä¸ªå†…éƒ¨å±æ€§æä¾›ç»™ <code>struct</code> ä½¿ç”¨ï¼Œå¹¶æŠŠæ•°ç»„ä½œä¸º <code>struct</code> æš´éœ²ç»™å¤–éƒ¨æ¥å£ã€‚çœ‹èµ·æ¥å°±åƒè¿™æ ·ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ArrayImpl</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> ptr: <span class="type">UnsafeMutablePointer</span>&lt;<span class="type">T</span>&gt;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">deinit</span> &#123;</span><br><span class="line">        ptr.destroy(...)</span><br><span class="line">        ptr.dealloc(...)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Array</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> impl: <span class="type">ArrayImpl</span>&lt;<span class="type">T</span>&gt;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ—¶åœ¨ <code>Array</code> ä¸­ç”³æ˜çš„æ–¹æ³•ï¼Œå®ƒçš„å®é™…æ“ä½œéƒ½æ˜¯åœ¨ <code>ArrayImpl</code> ä¸Šè¿›è¡Œçš„ã€‚</p><p>åˆ°è¿™é‡Œå°±å¯ä»¥ç»“æŸäº†å—ï¼Ÿå°½ç®¡æˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ <code>struct</code>ï¼Œ ä½†æ˜¯ä½¿ç”¨çš„ä¾æ—§æ˜¯å¼•ç”¨ç±»å‹ã€‚å¦‚æœå°†è¿™ä¸ª <code>struct</code> æ‹·è´ä¸€ä»½ï¼Œæˆ‘ä»¬å°†è·å¾—ä¸€ä¸ªæ–°çš„ <code>struct</code>ï¼ŒæŒæœ‰çš„ä»ç„¶æ˜¯ä¹‹å‰çš„ <code>ArrayImpl</code>ã€‚ç”±äºæˆ‘ä»¬æ— æ³•è‡ªå®šä¹‰ <code>struct</code> çš„åˆ†é…è¿‡ç¨‹ï¼Œæ‰€ä»¥æ²¡æœ‰åŠæ³•åŒæ ·æŠŠ <code>ArrayImpl</code> ä¹Ÿæ‹·è´ä¸€ä»½ã€‚  </p><p>è¿™ä¸ªé—®é¢˜çš„è§£å†³æ–¹æ³•æ˜¯æ”¾å¼ƒåœ¨åˆ†é…çš„è¿‡ç¨‹ä¸­è¿›è¡Œæ‹·è´ï¼Œè€Œæ˜¯åœ¨ <code>ArrayImpl</code> å‘ç”Ÿæ”¹å˜çš„æ—¶å€™è¿›è¡Œæ‹·è´ã€‚å…³é”®åœ¨äºï¼Œå°±ç®—ä¸€ä¸ªæ‹·è´å‰¯æœ¬ä¸åŸå§‹æ•°æ®å…±äº«ä¸€ä¸ªå¼•ç”¨ï¼Œä½†æ˜¯åªè¦è¿™ä¸ªå¼•ç”¨çš„æ•°æ®ä¸å‘ç”Ÿæ”¹å˜ï¼Œå€¼ç±»å‹çš„è¯­ä¹‰å°±ä¾æ—§æˆç«‹ã€‚åªæœ‰å½“è¿™ä¸ªå…±äº«æ•°æ®çš„å€¼å‘ç”Ÿæ”¹å˜æ—¶ï¼Œå€¼ç±»å‹å’Œå¼•ç”¨ç±»å‹æ‰æœ‰äº†æ˜æ˜¾çš„åŒºåˆ«ã€‚  </p><p>æ¯”å¦‚ï¼Œåœ¨å®ç° <code>append</code> æ–¹æ³•çš„æ—¶å€™ä½ å¯ä»¥å…ˆå¯¹ <code>ArrayImpl</code> è¿›è¡Œ <code>copy</code> (å‡è®¾ <code>ArrayImpl</code> çš„å®ç°ä¸­æœ‰ä¸€ä¸ª <code>copy</code> æ–¹æ³•ï¼Œé‚£ä¹ˆå°† <code>impl</code> å¼•ç”¨æ”¹ä¸ºåŸå§‹å€¼çš„ <code>copy</code>)ï¼š  </p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">mutating</span> <span class="function"><span class="keyword">func</span> <span class="title">append</span><span class="params">(value: T)</span></span> &#123;</span><br><span class="line">    impl = impl.copy()</span><br><span class="line">    impl.append(value)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ · Array å°±æ˜¯ä¸€ä¸ªå€¼ç±»å‹äº†ã€‚å°½ç®¡ a å’Œ b åœ¨åˆšèµ‹å€¼å®Œæ—¶ä»ç„¶å…±äº«åŒä¸€ä¸ª <code>impl</code> å¼•ç”¨ ï¼Œä½†æ˜¯ä»»ä½•ä¼šæ”¹å˜ <code>impl</code> çš„æ–¹æ³•éƒ½å°†å¯¹å…¶è¿›è¡Œä¸€æ¬¡ <code>copy</code>ï¼Œå› æ­¤ä¿ç•™äº†ä¸å…±äº«æ•°æ®çš„é”™è§‰ã€‚  </p><p>ç°åœ¨å¯ä»¥æ­£å¸¸å·¥ä½œäº†ï¼Œä½†æ˜¯æ•ˆç‡å´éå¸¸ä½ã€‚æ¯”å¦‚ï¼š  </p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> a: [<span class="type">Int</span>] = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="number">0</span>..&lt;<span class="number">1000</span> &#123;</span><br><span class="line">    a.append(i)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å°½ç®¡ä½¿ç”¨è€…æ— æ³•çœ‹åˆ°å®ƒï¼Œä½†æ˜¯å®ƒå°†åœ¨å¾ªç¯çš„æ¯æ¬¡è¿­ä»£ä¸­å¤åˆ¶å†…å­˜ä¸­çš„æ•°æ®ï¼Œç„¶åç«‹å³é”€æ¯ä¹‹å‰çš„æ•°æ®å†…å­˜ã€‚å¦‚ä½•æ‰èƒ½ä¼˜åŒ–å®ƒå‘¢ï¼Ÿ</p><h2 id="isUniquelyReferenced"><a href="#isUniquelyReferenced" class="headerlink" title="isUniquelyReferenced"></a>isUniquelyReferenced</h2><p>è¿™æ˜¯ä¸€ä¸ª Swift 1.2 ä¸­æ–°å¼•å…¥çš„ APIã€‚å®ƒæ¼‚äº®çš„å®ç°äº†å®ƒå­—é¢ä¸Šçš„æ„æ€ã€‚èµ‹äºˆå®ƒä¸€ä¸ªå¯¹è±¡çš„å¼•ç”¨ç„¶åå®ƒå°†å‘Šè¯‰ä½ è¿™ä¸ªå¼•ç”¨æ˜¯å¦ä¸ºç‹¬ç«‹çš„ã€‚å…·ä½“æ¥è¯´ï¼Œå½“è¿™ä¸ªå¯¹è±¡æœ‰ä¸”ä»…æœ‰ä¸€ä¸ªå¼ºå¼•ç”¨æ—¶ï¼Œå°±ä¼šè¿”å› <code>true</code>ã€‚  </p><p>æˆ‘ä»¬çŒœæµ‹è¿™ä¸ª API ä¼šæ£€æŸ¥å¯¹è±¡çš„å¼•ç”¨è®¡æ•°ï¼Œå¹¶ä¸”åœ¨å¼•ç”¨è®¡æ•°ä¸º 1 çš„æ—¶å€™è¿”å› <code>true</code> ã€‚é‚£ Swift ä¸ºä»€ä¹ˆä¸ç›´æ¥æä¾›ä¸€ä¸ªæ¥å£æ¥æŸ¥è¯¢å¼•ç”¨è®¡æ•°å‘¢ï¼Ÿå¯èƒ½åœ¨å®ç°ä¸Šè¿™ä¸ªæ¥å£ä¸å¤ªå¥½åšï¼Œå¹¶ä¸”å¼•ç”¨è®¡æ•°å±äºæ¯”è¾ƒå®¹æ˜“è¢«æ»¥ç”¨çš„ä¿¡æ¯ï¼Œæ‰€ä»¥ Swift æä¾›äº†è¿™ä¸ªå°è£…è¿‡çš„ï¼Œæ›´åŠ å®‰å…¨çš„æ¥å£ã€‚</p><p>ä½¿ç”¨è¿™ä¸ª APIï¼Œä¹‹å‰å¯¹ <code>append</code> æ–¹æ³•çš„å®ç°å°†å¯ä»¥æ”¹æˆåªæœ‰åœ¨éœ€è¦çš„æ—¶å€™æ‰å¯¹å†…å­˜ä¸­çš„æ•°æ®è¿›è¡Œå¤åˆ¶: </p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">    <span class="keyword">mutating</span> <span class="function"><span class="keyword">func</span> <span class="title">append</span><span class="params">(value: T)</span></span> &#123;</span><br><span class="line">        <span class="keyword">if</span> !isUniquelyReferencedNonObjc(&amp;impl) &#123;</span><br><span class="line">            impl = impl.copy()</span><br><span class="line">        &#125;</span><br><span class="line">        impl.append(value)</span><br><span class="line">    &#125;</span><br><span class="line">``` </span><br><span class="line"></span><br><span class="line">è¿™ä¸ª <span class="type">API</span> å®é™…ä¸Šæ˜¯ä¸€ç»„ä¸‰ä¸ªæ–¹æ³•ä¸­çš„ä¸€ä¸ªã€‚å­˜åœ¨äº <span class="type">Xcode</span> è‡ªå¸¦çš„ <span class="type">Swift</span> æ ‡å‡†åº“ä¸­:  </span><br><span class="line"></span><br><span class="line">```swift</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">isUniquelyReferenced</span>&lt;T : NonObjectiveCBase&gt;<span class="params">(<span class="keyword">inout</span> object: T)</span></span> -&gt; <span class="type">Bool</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">isUniquelyReferencedNonObjC</span>&lt;T&gt;<span class="params">(<span class="keyword">inout</span> object: T?)</span></span> -&gt; <span class="type">Bool</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">isUniquelyReferencedNonObjC</span>&lt;T&gt;<span class="params">(<span class="keyword">inout</span> object: T)</span></span> -&gt; <span class="type">Bool</span></span><br></pre></td></tr></table></figure><p>è¿™äº›æ–¹æ³•åªèƒ½ä½œç”¨åœ¨çº¯ Swift class ä¸­ï¼Œå¹¶ä¸æ”¯æŒ @objc ç±»å‹ã€‚ç¬¬ä¸€ä¸ªæ–¹æ³•å¿…é¡»ç¡®ä¿ T ä¸º <code>NonObjectiveCBase</code> çš„å­ç±»ã€‚å¦å¤–ä¸¤ä¸ªæ–¹æ³•å¯¹å‚æ•°çš„ç±»å‹å¹¶ä¸åšè¦æ±‚ï¼Œåªæ˜¯å½“ç±»å‹ä¸º @objc æ—¶ç›´æ¥è¿”å› falseã€‚  </p><p>æˆ‘æ— æ³•è®©æˆ‘çš„ä»£ç ä»¥ <code>NonObjectiveCBase</code> ç±»å‹æ¥ç¼–è¯‘ï¼Œæ‰€ä»¥ä½¿ç”¨äº† <code>isUniquelyReferencedNonObjC</code> æ¥ä»£æ›¿ã€‚ä»åŠŸèƒ½ä¸Šæ¥è¯´ï¼Œå®ƒä»¬å¹¶æ²¡æœ‰åŒºåˆ«ã€‚  </p><blockquote><p>è¯‘è€…æ³¨ï¼š<br>æ–‡ç« ä¸­æ‰€é˜è¿°çš„ <code>isUniquelyReferencedNonObjC</code> API å·²ç»åœ¨ Swift 3.1 çš„æ—¶å€™è¢«æ›¿æ¢ä¸º <code>isKnownUniquelyReferenced</code><br>è¯¦æƒ…å¯ä»¥å‚è€ƒ swift-evolution ä¸­çš„è¿™æ¡ <a href="https://github.com/apple/swift-evolution/blob/master/proposals/0125-remove-nonobjectivecbase.md" target="_blank" rel="noopener">å»ºè®®</a></p></blockquote><h2 id="ArrayImpl"><a href="#ArrayImpl" class="headerlink" title="ArrayImpl"></a>ArrayImpl</h2><p>è®©æˆ‘ä»¬å¼€å§‹å®ç° Swift.Arrayï¼Œé¦–å…ˆä» <code>ArrayImpl</code> å¼€å§‹ï¼Œç„¶åæ‰æ˜¯ <code>Array</code>ã€‚  </p><p>åœ¨è¿™é‡Œæˆ‘å¹¶ä¸ä¼šé‡æ–°å®ç° <code>Array</code> å®Œæ•´çš„ APIï¼Œåªæ˜¯å®ç°æ»¡è¶³å…¶æ­£å¸¸è¿è¡Œçš„åŸºæœ¬åŠŸèƒ½ï¼Œå¹¶å±•ç¤ºå®ƒæ¶‰åŠçš„åŸç†ã€‚  </p><p><code>ArrayImpl</code> æœ‰ä¸‰ä¸ªå±æ€§ï¼šæŒ‡é’ˆï¼Œæ•°ç»„å…ƒç´ çš„æ€»æ•°ï¼Œä»¥åŠå·²ç”³è¯·å†…å­˜ç©ºé—´ä¸­çš„å‰©ä½™å®¹é‡ã€‚åªæœ‰æŒ‡é’ˆå’Œå…ƒç´ çš„æ€»æ•°æ˜¯å¿…é¡»çš„ï¼Œä½†æ˜¯ç›¸æ¯”ç”³è¯·æ›´å¤šçš„å†…å­˜ç©ºé—´ï¼Œå®æ—¶ç›‘æ§å‰©ä½™å®¹é‡å¹¶æŒ‰éœ€ç”³è¯·ï¼Œæˆ‘ä»¬å¯ä»¥é¿å…ä¸€å¤§ç¬”æ˜‚è´µçš„å†…å­˜é‡æ–°åˆ†é…ã€‚ä¸‹é¢æ˜¯ç±»å¼€å§‹çš„éƒ¨åˆ†ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ArrayImpl</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> space: <span class="type">Int</span></span><br><span class="line">    <span class="keyword">var</span> <span class="built_in">count</span>: <span class="type">Int</span></span><br><span class="line">    <span class="keyword">var</span> ptr: <span class="type">UnsafeMutablePointer</span>&lt;<span class="type">T</span>&gt;</span><br></pre></td></tr></table></figure><p>åœ¨ <code>init</code> æ–¹æ³•ä¸­éœ€è¦ä¸€ä¸ªè®¡æ•°å’Œä¸€ä¸ªæŒ‡é’ˆï¼Œç„¶åå°†æŒ‡é’ˆæ‰€æŒ‡å‘çš„å†…å®¹å¤åˆ¶åˆ°æ–°çš„å¯¹è±¡ã€‚æ–¹æ³•æä¾›äº†é»˜è®¤å€¼ 0 å’Œ nil ï¼Œæ‰€ä»¥ <code>init</code> å¯ä»¥åœ¨ä¸ä¼ å…¥ä»»ä½•å‚æ•°çš„æƒ…å†µä¸‹è¢«ç”¨æ¥åˆ›å»ºä¸€ä¸ªæ‹¥æœ‰ç©ºæ•°ç»„çš„å®ä¾‹ï¼š  </p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">        <span class="keyword">init</span>(<span class="built_in">count</span>: <span class="type">Int</span> = <span class="number">0</span>, ptr: <span class="type">UnsafeMutablePointer</span>&lt;<span class="type">T</span>&gt; = <span class="literal">nil</span>) &#123;</span><br><span class="line">            <span class="keyword">self</span>.<span class="built_in">count</span> = <span class="built_in">count</span></span><br><span class="line">            <span class="keyword">self</span>.space = <span class="built_in">count</span></span><br><span class="line">            </span><br><span class="line">            <span class="keyword">self</span>.ptr = <span class="type">UnsafeMutablePointer</span>&lt;<span class="type">T</span>&gt;.alloc(<span class="built_in">count</span>)</span><br><span class="line">            <span class="keyword">self</span>.ptr.initializeFrom(ptr, <span class="built_in">count</span>: <span class="built_in">count</span>)</span><br><span class="line">        &#125;</span><br><span class="line">```  </span><br><span class="line"></span><br><span class="line">`initializeFrom` æ–¹æ³•å¯ä»¥å°†æ•°æ®å¤åˆ¶åˆ°æ–°çš„æŒ‡é’ˆã€‚æ³¨æ„åŒºåˆ† `<span class="type">UnsafeMutablePointer</span>` å¤„äºä¸åŒèµ‹å€¼æ–¹å¼ä¹‹é—´çš„ä¸åŒï¼Œè¿™å¯¹äºç¡®ä¿å®ƒä»¬æ­£å¸¸å·¥ä½œä»¥åŠé¿å…å´©æºƒååˆ†é‡è¦ã€‚ä¸åŒä¹‹å¤„åœ¨äºæ•°æ®å†…å­˜æ˜¯å¦è¢«å¤„ç†ä¸ºåˆå§‹åŒ–æˆ–æœªåˆå§‹åŒ–ã€‚åœ¨è°ƒç”¨ `alloc` æ—¶ï¼Œç”Ÿæˆçš„æŒ‡é’ˆå¤„äºæœªåˆå§‹åŒ–çš„çŠ¶æ€ï¼Œå¹¶ä¸”å¯èƒ½è¢«åƒåœ¾æ•°æ®å¡«æ»¡ã€‚ä¸€ä¸ªç®€å•çš„èµ‹å€¼ï¼Œä¾‹å¦‚ `ptr.memory = ...` ï¼Œæ­¤æ—¶æ˜¯ä¸åˆæ³•çš„ï¼Œå› ä¸ºèµ‹å€¼æ“ä½œå°†ä¼šåœ¨å¤åˆ¶æ–°çš„å€¼ä¹‹å‰ææ„å·²ç»å­˜åœ¨çš„å€¼ã€‚å¦‚æœæ˜¯ç±»ä¼¼ `int` è¿™æ ·çš„åŸºç¡€æ•°æ®ç±»å‹å°†æ²¡ä»€ä¹ˆé—®é¢˜ï¼Œä½†æ˜¯å¦‚æœä½ æ“ä½œçš„æ˜¯ä¸€ä¸ªå¤æ‚æ•°æ®ç±»å‹å®ƒå°†å´©æºƒã€‚åœ¨è¿™é‡Œ `initializeFrom` å°†ç›®æ ‡æŒ‡é’ˆè§†ä¸ºæœªåˆå§‹åŒ–çš„å†…å­˜ï¼Œè€Œè¿™æ­£æ˜¯å®ƒçš„æœ¬è´¨ã€‚  </span><br><span class="line"></span><br><span class="line">æ¥ä¸‹æ¥æ˜¯ä¸€ä¸ªæ”¹å˜è¿‡çš„ `append` æ–¹æ³•ã€‚å®ƒåšçš„ç¬¬ä¸€ä»¶äº‹æ˜¯æ£€æŸ¥æŒ‡é’ˆæ˜¯å¦éœ€è¦é‡æ–°åˆ†é…ã€‚å¦‚æœæ²¡æœ‰å‰©ä½™çš„ç©ºé—´å¯ç”¨ï¼Œæˆ‘ä»¬éœ€è¦ä¸€å—æ–°çš„å†…å­˜ï¼š</span><br><span class="line"></span><br><span class="line">```swift</span><br><span class="line">        <span class="function"><span class="keyword">func</span> <span class="title">append</span><span class="params">(obj: T)</span></span> &#123;</span><br><span class="line">            <span class="keyword">if</span> space == <span class="built_in">count</span> &#123;</span><br><span class="line">                <span class="comment">// åœ¨æ–°çš„å†…å­˜åˆ†é…ä¸­ï¼Œæˆ‘ä»¬å°†ç”³è¯·ä¸¤å€çš„å®¹é‡ï¼Œå¹¶ä¸”æœ€å°å€¼ä¸º 16 :</span></span><br><span class="line">                <span class="keyword">let</span> newSpace = <span class="built_in">max</span>(space * <span class="number">2</span>, <span class="number">16</span>)</span><br><span class="line">                <span class="keyword">let</span> newPtr = <span class="type">UnsafeMutablePointer</span>&lt;<span class="type">T</span>&gt;.alloc(newSpace)</span><br><span class="line">                <span class="comment">// ä»æ—§çš„å†…å­˜ä¸­å°†æ•°æ®æ‹·è´åˆ°æ–°çš„åœ°å€</span></span><br><span class="line">                newPtr.moveInitializeFrom(ptr, <span class="built_in">count</span>: <span class="built_in">count</span>)</span><br><span class="line">                <span class="comment">/*</span></span><br><span class="line"><span class="comment">                è¿™æ˜¯å¦ä¸€ç§èµ‹å€¼ï¼Œå®ƒä¸ä»…æŠŠç›®çš„æŒ‡é’ˆçœ‹åšæ˜¯æœªåˆå§‹åŒ–çš„ï¼Œå¹¶ä¸”ä¼šæŠŠæ•°æ®æºé”€æ¯ã€‚  </span></span><br><span class="line"><span class="comment">                å®ƒèŠ‚çœäº†æˆ‘ä»¬å•ç‹¬å†™ä»£ç æ¥é”€æ¯æ—§å†…å­˜çš„æ“ä½œï¼ŒåŒæ—¶å¯èƒ½æ›´åŠ é«˜æ•ˆã€‚  </span></span><br><span class="line"><span class="comment">                éšç€æ•°æ®çš„ç§»åŠ¨å®Œæˆï¼Œæ—§æŒ‡é’ˆå°†å¯ä»¥è¢«é‡Šæ”¾ï¼Œæ–°çš„æ•°æ®å°†è¢«èµ‹å€¼ç»™ç±»çš„å±æ€§ï¼š</span></span><br><span class="line"><span class="comment">                */</span></span><br><span class="line">                ptr.dealloc(space)</span><br><span class="line">                ptr = newPtr</span><br><span class="line">                space = newSpace</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// ç°åœ¨æˆ‘ä»¬ç¡®ä¿¡æœ‰è¶³å¤Ÿçš„ç©ºé—´ï¼Œæ‰€ä»¥å¯ä»¥æŠŠæ–°çš„å€¼æ”¾åœ¨å†…å­˜çš„æœ€åé¢å¹¶ä¸”é€’å¢ count å±æ€§çš„å€¼:</span></span><br><span class="line">            (ptr + <span class="built_in">count</span>).initialize(obj)</span><br><span class="line">            <span class="built_in">count</span>++</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure><p>æ”¹å˜è¿‡çš„ <code>remove</code> æ–¹æ³•å°†æ›´ä¸ºç®€æ´ï¼Œå› ä¸ºæ²¡æœ‰å¿…è¦é‡æ–°åˆ†é…å†…å­˜ã€‚é¦–å…ˆï¼Œä»–å°†åœ¨ç§»é™¤ä¸€ä¸ªå€¼ä¹‹å‰å…ˆå°†å…¶é”€æ¯ï¼š  </p><blockquote><p>è¯‘è€…æ³¨ï¼š<br>è¿™é‡Œçš„ # å·ä¸ç”¨ç†ä¼šï¼Œåœ¨æ—©æœŸçš„ Swift ç‰ˆæœ¬ä¸­å®ƒè¡¨ç¤ºå†…å¤–å‚æ•°åŒåï¼‰**</p></blockquote><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">remove</span><span class="params">(# index: Int)</span></span> &#123;</span><br><span class="line">    (ptr + index).destroy()</span><br><span class="line">    <span class="comment">// moveInitializeFrom æ–¹æ³•è´Ÿè´£å°†æ‰€æœ‰åœ¨è¢«ç§»é™¤å…ƒç´ ä¹‹åçš„å…ƒç´ å¾€å‰æŒªä¸€ä¸ªä½ç½®</span></span><br><span class="line">    (ptr + index).moveInitializeFrom(ptr + index + <span class="number">1</span>, <span class="built_in">count</span>: <span class="built_in">count</span> - index - <span class="number">1</span>)</span><br><span class="line">    <span class="comment">// é€’å‡ count å±æ€§çš„å€¼æ¥ä½“ç°è¿™æ¬¡åˆ é™¤æ“ä½œ</span></span><br><span class="line">    <span class="built_in">count</span>--</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬åŒæ ·éœ€è¦ä¸€ä¸ª <code>copy</code> æ–¹æ³•æ¥ç¡®ä¿å½“éœ€è¦çš„æ—¶å€™å¯ä»¥ä»æ•°æ®å†…å­˜ä¸­å¤åˆ¶ä¸€ä»½ã€‚å®é™…å…³äºå¤åˆ¶çš„ä»£ç å­˜åœ¨äº <code>init</code> æ–¹æ³•ä¸­ï¼Œæ‰€ä»¥æˆ‘ä»¬åªéœ€è¦åˆ›å»ºä¸€ä¸ªå®ä¾‹ä¹Ÿå°±ç›¸å½“äºæ‰§è¡Œäº†ä¸€æ¬¡å¤åˆ¶ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">copy</span><span class="params">()</span></span> -&gt; <span class="type">ArrayImpl</span>&lt;<span class="type">T</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="type">ArrayImpl</span>&lt;<span class="type">T</span>&gt;(<span class="built_in">count</span>: <span class="built_in">count</span>, ptr: ptr)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·ï¼Œæˆ‘ä»¬å°±åŸºæœ¬ä¸Šå®Œæˆäº†æ‰€æœ‰çš„äº‹æƒ…ã€‚æˆ‘ä»¬åªéœ€è¦ç¡®ä¿åœ¨å®ƒè‡ªå·±å°†è¦è¢«é”€æ¯ï¼Œè°ƒç”¨ <code>deinit</code> æ–¹æ³•ä¹‹åé”€æ¯æ‰€æœ‰æ•°ç»„ä¸­çš„å…ƒç´ å¹¶é‡Šæ”¾æŒ‡é’ˆï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">    <span class="keyword">deinit</span> &#123;</span><br><span class="line">        ptr.destroy(<span class="built_in">count</span>)</span><br><span class="line">        ptr.dealloc(space)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è®©æˆ‘ä»¬æŠŠå®ƒç§»åˆ° <code>Array struct</code>ã€‚å®ƒå”¯ä¸€çš„å±æ€§å°±æ˜¯ä¸€ä¸ª <code>ArrayImpl</code>ã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Array</span>&lt;<span class="title">T</span>&gt;: <span class="title">SequenceType</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> impl: <span class="type">ArrayImpl</span>&lt;<span class="type">T</span>&gt; = <span class="type">ArrayImpl</span>&lt;<span class="type">T</span>&gt;()</span><br></pre></td></tr></table></figure><p>æ‰€æœ‰ <code>mutating</code> ç±»å‹çš„æ–¹æ³•éƒ½å°†ä»¥æ£€æŸ¥ <code>impl</code> æ˜¯ä¸æ˜¯ç‹¬ç«‹çš„å¼•ç”¨ä¸ºå¼€å§‹ï¼Œå¹¶åœ¨ä¸æ˜¯çš„æ—¶å€™è¿›è¡Œå¤åˆ¶æ“ä½œã€‚å°†æŠŠå®ƒå°è£…æˆä¸€ä¸ªå‡½æ•°æä¾›ç»™å…¶ä»–çš„æ–¹æ³•ä½¿ç”¨ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">mutating</span> <span class="function"><span class="keyword">func</span> <span class="title">ensureUnique</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> !<span class="built_in">isUniquelyReferencedNonObjC</span>(&amp;impl) &#123;</span><br><span class="line">        impl = impl.copy()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>append</code> æ–¹æ³•ç°åœ¨åªè°ƒç”¨äº† <code>ensureUnique</code> æ–¹æ³•ï¼Œç„¶åè°ƒç”¨ <code>ArrayImpl</code> çš„ <code>append</code> æ–¹æ³•ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">mutating</span> <span class="function"><span class="keyword">func</span> <span class="title">append</span><span class="params">(value: T)</span></span> &#123;</span><br><span class="line">    ensureUnique()</span><br><span class="line">    impl.append(value)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>remove</code> æ–¹æ³•ä¹Ÿæ˜¯ä¸€æ ·ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">mutating</span> <span class="function"><span class="keyword">func</span> <span class="title">remove</span><span class="params">(# index: Int)</span></span> &#123;</span><br><span class="line">    ensureUnique()</span><br><span class="line">    impl.remove(index: index)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>count</code> å±æ€§ç›´æ¥é€šè¿‡ <code>ArrayImpl&#39;s</code> æ¥è¿”å›ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="built_in">count</span>: <span class="type">Int</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> impl.<span class="built_in">count</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸‹æ ‡æ“ä½œç›´æ¥é€šè¿‡åº•å±‚æŒ‡é’ˆæ¥è¿›è¡Œè®¿é—®ã€‚å¦‚æœæˆ‘ä»¬æ˜¯åœ¨å†™çœŸå®çš„ä»£ç ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬ä¼šéœ€è¦è¿›è¡Œä¸€ä¸ªèŒƒå›´çš„æ£€æŸ¥ï¼ˆ<code>remove</code> æ–¹æ³•ä¸­ä¹Ÿæ˜¯ï¼‰ï¼Œä½†æ˜¯åœ¨è¿™ä¸ªä¾‹å­ä¸­æˆ‘ä»¬å°†å®ƒçœç•¥äº†ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">subscript</span>(index: <span class="type">Int</span>) -&gt; <span class="type">T</span> &#123;</span><br><span class="line">    <span class="keyword">get</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> impl.ptr[index]</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">mutating</span> <span class="keyword">set</span> &#123;</span><br><span class="line">        ensureUnique()</span><br><span class="line">        impl.ptr[index] = newValue</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ€åï¼Œ<code>Array</code> éµå¾ª <code>SequenceType</code> åè®®ä»¥æ”¯æŒ <code>for in</code> å¾ªç¯ã€‚å…¶å¿…é¡»å®ç° <code>Generator typealias</code> å’Œ <code>generate</code> æ–¹æ³•ã€‚å†…ç½®çš„ <code>GeneratorOf</code> ç±»å‹ä½¿å…¶å¾ˆå®¹æ˜“å®ç°ã€‚<code>GeneratorOf</code> ä½¿ç”¨ä¸€ä¸ªä»£ç å—ç¡®ä¿åœ¨å…¶æ¯æ¬¡è¢«è®¿é—®çš„æ—¶å€™è¿”å›é›†åˆä¸­çš„ä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œæˆ–è€…å½“åˆ°è¾¾ç»“å°¾çš„æ—¶å€™è¿”å› <code>nil</code>ï¼Œå¹¶åˆ›é€ ä¸€ä¸ª <code>GeneratorType</code> æ¥å°è£…è¯¥ä»£ç å—ï¼š  </p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">typealias</span> <span class="type">Generator</span> = <span class="type">GeneratorOf</span>&lt;<span class="type">T</span>&gt;</span><br></pre></td></tr></table></figure><p><code>generate</code> æ–¹æ³•ä» 0 å¼€å§‹é€’å¢ç›´åˆ°è¿è¡Œè‡³ç»“å°¾ï¼Œç„¶åå¼€å§‹è¿”å› <code>nil</code>ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">generate</span><span class="params">()</span></span> -&gt; <span class="type">Generator</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> index = <span class="number">0</span></span><br><span class="line">        <span class="keyword">return</span> <span class="type">GeneratorOf</span>&lt;<span class="type">T</span>&gt;(&#123;</span><br><span class="line">            <span class="keyword">if</span> index &lt; <span class="keyword">self</span>.<span class="built_in">count</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">self</span>[index++]</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™å°±æ˜¯å®ƒçš„å…¨éƒ¨ï¼</p><h2 id="Array"><a href="#Array" class="headerlink" title="Array"></a>Array</h2><p>æˆ‘ä»¬çš„ <code>Array</code> æ˜¯ä¸€ä¸ªç¬¦åˆ <code>CollectionType</code> åè®®çš„é€šç”¨ <code>struct</code>ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Array</span>&lt;<span class="title">T</span>&gt;: <span class="title">CollectionType</span> </span>&#123;</span><br></pre></td></tr></table></figure><p>å®ƒå”¯ä¸€æ‹¥æœ‰çš„å±æ€§æ˜¯ä¸€ä¸ªåº•å±‚ <code>ArrayImpl</code> çš„å¼•ç”¨ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">var</span> impl: <span class="type">ArrayImpl</span>&lt;<span class="type">T</span>&gt; = <span class="type">ArrayImpl</span>&lt;<span class="type">T</span>&gt;()</span><br></pre></td></tr></table></figure><p>ä»»ä½•ä¸€ä¸ªæ–¹æ³•å¦‚æœä¼šæ”¹å˜è¿™ä¸ªæ•°ç»„å¿…é¡»å…ˆæ£€æŸ¥è¿™ä¸ª <code>impl</code> æ˜¯å¦ä¸ºä¸€ä¸ªç‹¬ç«‹çš„å¼•ç”¨ï¼Œå¹¶åœ¨å®ƒä¸æ˜¯çš„æ—¶å€™è¿›è¡Œå¤åˆ¶ã€‚è¿™ä¸ªåŠŸèƒ½è¢«å°è£…æˆä¸€ä¸ªç§æœ‰çš„æ–¹æ³•æä¾›ç»™å…¶ä»–çš„æ–¹æ³•ä½¿ç”¨ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">mutating</span> <span class="function"><span class="keyword">func</span> <span class="title">ensureUnique</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> !<span class="built_in">isUniquelyReferencedNonObjC</span>(&amp;impl) &#123;</span><br><span class="line">        impl = impl.copy()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>append</code> æ–¹æ³•ä¼šä½¿ç”¨ <code>ensureUnique</code> ç„¶åè°ƒç”¨ <code>impl</code> ä¸­çš„ <code>append</code>ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">mutating</span> <span class="function"><span class="keyword">func</span> <span class="title">append</span><span class="params">(value: T)</span></span> &#123;</span><br><span class="line">    ensureUnique()</span><br><span class="line">    impl.append(value)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>remove</code> çš„å®ç°åŸºæœ¬æ˜¯ç›¸åŒçš„ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">mutating</span> <span class="function"><span class="keyword">func</span> <span class="title">remove</span><span class="params">(# index: Int)</span></span> &#123;</span><br><span class="line">    ensureUnique()</span><br><span class="line">    impl.remove(index: index)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>count</code> å±æ€§æ˜¯ä¸€ä¸ªè®¡ç®—æ€§å±æ€§ï¼Œå®ƒå°†ç›´æ¥é€šè¿‡ <code>impl</code> æ¥è°ƒç”¨ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="built_in">count</span>: <span class="type">Int</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> impl.<span class="built_in">count</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸‹æ ‡æ“ä½œå°†ç›´æ¥é€šè¿‡ <code>impl</code> æ¥ä¿®æ”¹åº•å±‚çš„æ•°æ®å­˜å‚¨ã€‚é€šå¸¸è¿™ç§ç›´æ¥ä»ç±»çš„å¤–éƒ¨è¿›è¡Œè®¿é—®çš„æ–¹å¼æ˜¯ä¸€ä¸ªåä¸»æ„ï¼Œä½†æ˜¯ <code>Array</code> å’Œ <code>ArrayImpl</code> è”ç³»çš„å¤ªè¿‡ç´§å¯†ï¼Œæ‰€ä»¥çœ‹èµ·æ¥å¹¶ä¸æ˜¯å¾ˆç³Ÿç³•ã€‚<code>subscript</code> ä¸­ <code>set</code> çš„éƒ¨åˆ†ä¼šæ”¹å˜æ•°ç»„ï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨ <code>ensureUnique</code> æ¥ä¿æŒå€¼è¯­ä¹‰ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">subscript</span>(index: <span class="type">Int</span>) -&gt; <span class="type">T</span> &#123;</span><br><span class="line">    <span class="keyword">get</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> impl.ptr[index]</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">mutating</span> <span class="keyword">set</span> &#123;</span><br><span class="line">        ensureUnique()</span><br><span class="line">        impl.ptr[index] = newValue</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>CollectionType</code> åè®®éœ€è¦ä¸€ä¸ª <code>Index typealias</code>ã€‚å¯¹äº <code>Array</code> æ¥è¯´ï¼Œè¿™ä¸ªç´¢å¼•ç±»å‹å°±æ˜¯ <code>Int</code>ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">typealias</span> <span class="type">Index</span> = <span class="type">Int</span></span><br></pre></td></tr></table></figure><p>å®ƒåŒæ—¶ä¹Ÿéœ€è¦ä¸€äº›å±æ€§æ¥æä¾›ä¸€ä¸ªå¼€å§‹å’Œç»“æŸçš„ç´¢å¼•ã€‚å¯¹äº <code>Array</code> ä¿©è¯´ï¼Œå¼€å§‹çš„ç´¢å¼•ä¸º 0 ï¼Œç»“æŸçš„ç´¢å¼•å°±æ˜¯æ•°ç»„ä¸­å…ƒç´ çš„ä¸ªæ•°ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> startIndex: <span class="type">Index</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">&#125;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">var</span> endIndex: <span class="type">Index</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">count</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>CollectionType</code> åè®®åŒ…å« <code>SequenceType</code> åè®®ï¼Œå®ƒä½¿å¾—å¯¹è±¡å¯ä»¥è¢«ç”¨äº <code>for/in</code> å¾ªç¯ã€‚å®ƒçš„å·¥ä½œåŸç†æ˜¯è®©åºåˆ—æä¾›ä¸€ä¸ªç”Ÿæˆå™¨ï¼Œè¯¥ç”Ÿæˆå™¨æ˜¯ä¸€ä¸ªå¯ä»¥è¿”å›åºåˆ—ä¸­è¿ç»­å…ƒç´ çš„å¯¹è±¡ã€‚ç”Ÿæˆå™¨çš„ç±»å‹ç”±é‡‡ç”¨åè®®çš„ç±»å‹æ¥å®šä¹‰ã€‚<code>Array</code> ä¸­é‡‡ç”¨çš„æ˜¯ <code>GeneratorOf</code>ï¼Œå®ƒæ˜¯ä¸€ä¸ªç®€å•çš„å°è£…ç”¨æ¥æ”¯æŒä½¿ç”¨ä¸€ä¸ªé—­åŒ…åˆ›å»ºç”Ÿæˆå™¨ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">typealias</span> <span class="type">Generator</span> = <span class="type">GeneratorOf</span>&lt;<span class="type">T</span>&gt;</span><br></pre></td></tr></table></figure><p><code>generate</code> æ–¹æ³•å°†ä¼šè¿”å›ä¸€ä¸ªç”Ÿæˆå™¨ã€‚å®ƒä½¿ç”¨ <code>GeneratorOf</code> å¹¶ä¸”æä¾›ä¸€ä¸ªé—­åŒ…æ¥é€’å¢ä¸‹æ ‡ï¼Œç›´åˆ°ä¸‹æ ‡åˆ°è¾¾æ•°ç»„çš„ç»“å°¾ã€‚é€šè¿‡åœ¨é—­åŒ…çš„å¤–é¢å£°æ˜ä¸€ä¸ª <code>index</code>ï¼Œä½¿å®ƒåœ¨è°ƒç”¨ä¸­è¢«æ•è·ï¼Œå¹¶ä¸”å®ƒçš„å€¼æŒç»­å­˜åœ¨ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">generate</span><span class="params">()</span></span> -&gt; <span class="type">Generator</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> index = <span class="number">0</span></span><br><span class="line">        <span class="keyword">return</span> <span class="type">GeneratorOf</span>&lt;<span class="type">T</span>&gt;&#123;</span><br><span class="line">            <span class="keyword">if</span> index &lt; <span class="keyword">self</span>.<span class="built_in">count</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">self</span>[index++]</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·å°±å®Œæˆäº† <code>Array</code> çš„å®ç°ã€‚</p><h2 id="å®Œæ•´çš„å®ç°å’Œæµ‹è¯•ä»£ç "><a href="#å®Œæ•´çš„å®ç°å’Œæµ‹è¯•ä»£ç " class="headerlink" title="å®Œæ•´çš„å®ç°å’Œæµ‹è¯•ä»£ç "></a>å®Œæ•´çš„å®ç°å’Œæµ‹è¯•ä»£ç </h2><p>è¿™é‡Œæä¾›äº†å®Œæ•´çš„å®ç°ï¼Œé™„åŠ ä¸€äº›æµ‹è¯•æ¥ç¡®ä¿æ‰€æœ‰çš„è¿™äº›æ­£å¸¸è¿è¡Œï¼Œæˆ‘æ”¾åœ¨äº† GitHub ä¸Šé¢ï¼š  </p><p><a href="https://gist.github.com/mikeash/63a791f2aec3318c7c5c" target="_blank" rel="noopener">https://gist.github.com/mikeash/63a791f2aec3318c7c5c</a></p><h2 id="ç»“è¯­"><a href="#ç»“è¯­" class="headerlink" title="ç»“è¯­"></a>ç»“è¯­</h2><p>åœ¨ Swift 1.2 ä¸­æ·»åŠ çš„ <code>isUniquelyReferenced</code> æ˜¯ä¸€ä¸ªå¹¿å—å¥½è¯„çš„æ”¹å˜ï¼Œå®ƒè®©æˆ‘ä»¬å¯ä»¥å®ç°å¾ˆå¤šçœŸæ­£æœ‰è¶£çš„å€¼ç±»å‹ï¼ŒåŒ…æ‹¬å¯¹æ ‡å‡†åº“ä¸­å€¼ç±»å‹é›†åˆçš„å¤åˆ¶ã€‚  </p><p>ä»Šå¤©å°±åˆ°è¿™é‡Œã€‚ä¸‹æ¬¡å†æ¥æ‰¾ä¹è¶£ï¼ŒåŠŸèƒ½ï¼Œä»¥åŠæœ‰è¶£çš„åŠŸèƒ½ã€‚å¦‚æœä½ æœ‰æ„Ÿå…´è¶£çš„ä¸»é¢˜ï¼Œè¯·å‘ç»™æˆ‘ä»¬ï¼é‚®ç®±åœ°å€ï¼š<a href="mailto:mike@mikeash.com" target="_blank" rel="noopener">mike@mikeash.com</a>ã€‚</p><blockquote><p>æœ¬æ–‡ç”± SwiftGG ç¿»è¯‘ç»„ç¿»è¯‘ï¼Œå·²ç»è·å¾—ä½œè€…ç¿»è¯‘æˆæƒï¼Œæœ€æ–°æ–‡ç« è¯·è®¿é—® <a href="http://swift.gg">http://swift.gg</a>ã€‚</p></blockquote>]]></content>
    
    <summary type="html">
    
      ç®€è¿°Swiftæ ‡å‡†åº“ä¸­Arrayçš„å®ç°é€»è¾‘
    
    </summary>
    
      <category term="Mike Ash" scheme="https://swift.gg/categories/Mike-Ash/"/>
    
    
      <category term="Swift è§£æ" scheme="https://swift.gg/tags/Swift-%E8%A7%A3%E6%9E%90/"/>
    
  </entry>
  
</feed>
